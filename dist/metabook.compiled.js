window._metabook_amalgam=document&&document.currentScript&&document.currentScript.src;var fdjt="undefined"===typeof fdjt?{}:fdjt,fdjt_versions="undefined"===typeof fdjt_versions?[]:fdjt_versions||[];
(function(){fdjt_versions.decl=function(a,n){if(!fdjt_versions[a]||fdjt_versions[a]<n)fdjt_versions[a]=n};Array.prototype.indexOf||(Array.prototype.indexOf=function(a,n){n||(n=0);for(var h=this.length;n<h;){if(this[n]===a)return n;n++}return-1});Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var n=[],h;for(h in a)Object.prototype.hasOwnProperty.call(a,h)&&n.push(h);return n});String.prototype.trim||(String.prototype.trim=function(){var a=
/^\s+/,n=/\s+$/;return function(){return this.replace(a,"").replace(n,"")}})})();(function(){function a(a,c){return function(){a.apply(c,arguments)}}function n(g){if("object"!==typeof this)throw new TypeError('Use "new" to make Promises');if("function"!==typeof g)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];x(g,a(m,this),a(e,this))}function h(a){var c=this;null===this._state?this._deferreds.push(a):u(function(){var b=c._state?a.onFulfilled:a.onRejected;if(null===b)(c._state?a.resolve:a.reject)(c._value);else{var d;try{d=b(c._value)}catch(e){a.reject(e);
return}a.resolve(d)}})}function m(g){try{if(g===this)throw new TypeError("A promise cannot be resolved with itself.");if(g&&("object"===typeof g||"function"===typeof g)){var c=g.then;if("function"===typeof c){x(a(c,g),a(m,this),a(e,this));return}}this._state=!0;this._value=g;v.call(this)}catch(b){e.call(this,b)}}function e(a){this._state=!1;this._value=a;v.call(this)}function v(){for(var a=0,c=this._deferreds.length;a<c;a++)h.call(this,this._deferreds[a]);this._deferreds=null}function k(a,c,b,d){this.onFulfilled=
"function"===typeof a?a:null;this.onRejected="function"===typeof c?c:null;this.resolve=b;this.reject=d}function x(a,c,b){var d=!1;try{a(function(a){d||(d=!0,c(a))},function(a){d||(d=!0,b(a))})}catch(e){d||(d=!0,b(e))}}var p;p="object"===typeof window&&window?window:global;var u=p.Promise&&p.Promise.immediateFn||p.setImmediate||function(a){setTimeout(a,1)},q=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};n.prototype["catch"]=function(a){return this.then(null,
a)};n.prototype.then=function(a,c){var b=this;return new n(function(d,e){h.call(b,new k(a,c,d,e))})};n.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&q(arguments[0])?arguments[0]:arguments);return new n(function(c,b){function d(f,D){try{if(D&&("object"===typeof D||"function"===typeof D)){var J=D.then;if("function"===typeof J){J.call(D,function(a){d(f,a)},b);return}}a[f]=D;0===--e&&c(a)}catch(G){b(G)}}if(0===a.length)return c([]);for(var e=a.length,u=0;u<a.length;u++)d(u,a[u])})};
n.resolve=function(a){return a&&"object"===typeof a&&a.constructor===n?a:new n(function(c){c(a)})};n.reject=function(a){return new n(function(c,b){b(a)})};n.race=function(a){return new n(function(c,b){for(var d=0,e=a.length;d<e;d++)a[d].then(c,b)})};"undefined"!==typeof module&&module.exports?module.exports=n:p.Promise||(p.Promise=n)})();fdjt.Async=fdjt.ASync=fdjt.async=function(){function a(a,m){return new Promise(function(k,h){setTimeout(function(){var p;try{p=m?a.call(null,m):a(),k(p)}catch(u){h(u)}},1)})}function n(){return(new Date).getTime()}function h(a,m,k,h,p,u){function q(){for(var d=n()+m,A=!1;c<b;){var w=a[c++];if(w){if("number"===typeof w){A=w;break}else try{w()}catch(f){u(f)}if(n()>d)break}}!(c<b)||h&&h()?(clearTimeout(g),g=!1,p(!1)):g=setTimeout(q,A||k)}var g=!1;"number"!==typeof m&&(m=100);"number"!==typeof k&&(k=
100);var c=0,b=a.length;return q()}function m(a,m,k,h,p,u,q,g,c){function b(){try{var G=n(),y=G,E=G+u;for(k&&k(0===d?"start":"resume",d,A,w,f,D);d<A&&(y=n())<E;){var F=m[d];k&&(c&&0===d%c||d+1===A)&&k("element",d,A,F,f,y-D);try{a(F)}catch(O){var M={elt:F,i:d,lim:A,vec:m};if(g&&g(O,F,M))continue;if(p)return p(O);throw O;}k&&(c&&0===d%c||d+1===A)&&k("after",d,A,F,f+(n()-G),D,n()-y);d++}w+=1;if(d<A)f+=y-G,k&&k("suspend",d,A,w,f,D),J=setTimeout(b,q);else{y=n();f+=y-G;clearTimeout(J);J=!1;k&&k("finishing",
d,A,w,f,D);var I=h&&n()-y,y=n();f+=y-G;k&&k("done",d,A,w,f,D,I);h&&h.call&&h(m,y-D,f)}}catch(t){p&&p(t)}}var d=0,A=m.length,w=0,f=0,D=n(),J=!1;u||(u=100);q||(q=u);c||(c=0);J=setTimeout(b,q)}a.timeslice=function(a,m){m||(m={});var k=m.slice||100,x=m.space||100,p=m.stop||!1;return new Promise(function(u,q){h(a,k,x,p,u,q)})};a.slowmap=function(a,h,k){k||(k={});var x=k.slice,p=k.space,u=k.onerr,q=k.watchfn,g=k.watch,c=k.hasOwnProperty("sync")?k.sync:k.hasOwnProperty("async")?!k.async:!1,b=k.done;1>g&&
(g*=h.length);return new Promise(function(d,k){if(c){for(var w=0,f=h.length;w<f;){var D=h[w++];try{a(h[D])}catch(J){var G={elt:D,i:w,lim:f,vec:h};if(!u||!u(J,D,G)){if(k)return k(J);throw J;}}}d&&d(h)}else m(a,h,q,b?function(){b();d&&d(h)}:d,k,x,p,u,g)})};a.debounce=function(a,m,k){var h;return function(){var p=this,u=arguments,q=k&&!h;clearTimeout(h);h=setTimeout(function(){h=null;k||a.apply(p,u)},m);q&&a.apply(p,u)}};a.poll=function(a,m,k,h,p){var u=Number(new Date)+(h||2E3);p=p||100;(function g(){a()?
m():Number(new Date)<u?setTimeout(g,p):k(Error("timed out for "+a+": "+arguments))})()};a.once=function(a,m){var k;return function(){a&&(k=a.apply(m||this,arguments),a=null);return k}};return a}();(function(a){function n(a){"string"!==typeof a&&(a=String(a));if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function h(a){"string"!==typeof a&&(a=String(a));return a}function m(a){this.map={};a instanceof m?a.forEach(function(a,b){this.append(b,a)},this):a&&Object.getOwnPropertyNames(a).forEach(function(b){this.append(b,a[b])},this)}function e(a){if(a.bodyUsed)return Promise.reject(new TypeError("Already read"));a.bodyUsed=
!0}function v(a){return new Promise(function(b,d){a.onload=function(){b(a.result)};a.onerror=function(){d(a.error)}})}function k(a){var b=new FileReader;b.readAsArrayBuffer(a);return v(b)}function x(){this.bodyUsed=!1;this._initBody=function(a){this._bodyInit=a;if("string"===typeof a)this._bodyText=a;else if(d.blob&&Blob.prototype.isPrototypeOf(a))this._bodyBlob=a;else if(d.formData&&FormData.prototype.isPrototypeOf(a))this._bodyFormData=a;else if(!a)this._bodyText="";else if(!d.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(a))throw Error("unsupported BodyInit type");
};d.blob?(this.blob=function(){var a=e(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(k)},this.text=function(){var a=e(this);if(a)return a;if(this._bodyBlob){var a=this._bodyBlob,b=new FileReader;b.readAsText(a);return v(b)}if(this._bodyFormData)throw Error("could not read FormData body as text");
return Promise.resolve(this._bodyText)}):this.text=function(){var a=e(this);return a?a:Promise.resolve(this._bodyText)};d.formData&&(this.formData=function(){return this.text().then(u)});this.json=function(){return this.text().then(JSON.parse)};return this}function p(a,b){b=b||{};var d=b.body;if(p.prototype.isPrototypeOf(a)){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url;this.credentials=a.credentials;b.headers||(this.headers=new m(a.headers));this.method=a.method;this.mode=a.mode;
d||(d=a._bodyInit,a.bodyUsed=!0)}else this.url=a;this.credentials=b.credentials||this.credentials||"omit";if(b.headers||!this.headers)this.headers=new m(b.headers);var c=b.method||this.method||"GET",y=c.toUpperCase();this.method=-1<A.indexOf(y)?y:c;this.mode=b.mode||this.mode||null;this.referrer=null;if(("GET"===this.method||"HEAD"===this.method)&&d)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(d)}function u(a){var b=new FormData;a.trim().split("&").forEach(function(a){if(a){var f=
a.split("=");a=f.shift().replace(/\+/g," ");f=f.join("=").replace(/\+/g," ");b.append(decodeURIComponent(a),decodeURIComponent(f))}});return b}function q(a){var b=new m;a.getAllResponseHeaders().trim().split("\n").forEach(function(a){var f=a.trim().split(":");a=f.shift().trim();f=f.join(":").trim();b.append(a,f)});return b}function g(a,b){b||(b={});this._initBody(a);this.type="default";this.status=b.status;this.ok=200<=this.status&&300>this.status;this.statusText=b.statusText;this.headers=b.headers instanceof
m?b.headers:new m(b.headers);this.url=b.url||""}if(!a.fetch){m.prototype.append=function(a,b){a=n(a);b=h(b);var d=this.map[a];d||(d=[],this.map[a]=d);d.push(b)};m.prototype["delete"]=function(a){delete this.map[n(a)]};m.prototype.get=function(a){return(a=this.map[n(a)])?a[0]:null};m.prototype.getAll=function(a){return this.map[n(a)]||[]};m.prototype.has=function(a){return this.map.hasOwnProperty(n(a))};m.prototype.set=function(a,b){this.map[n(a)]=[h(b)]};m.prototype.forEach=function(a,b){Object.getOwnPropertyNames(this.map).forEach(function(d){this.map[d].forEach(function(c){a.call(b,
c,d,this)},this)},this)};var c;if(c="FileReader"in a&&"Blob"in a)try{new Blob,c=!0}catch(b){c=!1}var d={blob:c,formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a},A="DELETE GET HEAD OPTIONS POST PUT".split(" ");p.prototype.clone=function(){return new p(this)};x.call(p.prototype);x.call(g.prototype);g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})};g.error=function(){var a=new g(null,{status:0,statusText:""});
a.type="error";return a};var w=[301,302,303,307,308];g.redirect=function(a,b){if(-1===w.indexOf(b))throw new RangeError("Invalid status code");return new g(null,{status:b,headers:{location:a}})};a.Headers=m;a.Request=p;a.Response=g;a.fetch=function(a,b){return new Promise(function(c,G){var y;y=p.prototype.isPrototypeOf(a)&&!b?a:new p(a,b);var e=new XMLHttpRequest;e.onload=function(){var a=1223===e.status?204:e.status;if(100>a||599<a)G(new TypeError("Network request failed"));else{var b=e.statusText,
D=q(e),d;d="responseURL"in e?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):void 0;c(new g("response"in e?e.response:e.responseText,{status:a,statusText:b,headers:D,url:d}))}};e.onerror=function(){G(new TypeError("Network request failed"))};e.open(y.method,y.url,!0);"include"===y.credentials&&(e.withCredentials=!0);"responseType"in e&&d.blob&&(e.responseType="blob");y.headers.forEach(function(a,b){e.setRequestHeader(b,a)}).xhr.send("undefined"===
typeof y._bodyInit?null:y._bodyInit)})};a.fetch.polyfill=!0}})(self||window||this);var idbModules={};
(function(a){var n=function(){this.length=0;this._items=[]};n.prototype={contains:function(a){return-1!==this._items.indexOf(a)},item:function(a){return this._items[a]},indexOf:function(a){return this._items.indexOf(a)},push:function(a){this._items.push(a);this.length+=1},splice:function(){this._items.splice.apply(this._items,arguments);this.length=this._items.length}};a.util={throwDOMException:function(h,m,e){var v=new DOMException.constructor(0,m);v.name=h;v.message=m;v.stack=arguments.callee.caller;
a.DEBUG&&console.log(h,m,e,v);throw v;},callback:function(a,m,e,v){e.target=m;"function"===typeof m[a]&&m[a].apply(m,[e]);"function"===typeof v&&v()},quote:function(a){return"'"+a+"'"},StringList:n}})(idbModules);(function(a){var n=function(){return{encode:function(a){return JSON.stringify(a)},decode:function(a){return JSON.parse(a)}}}();a.Sca=n})(idbModules);
(function(a){var n=" number string boolean object undefined".split(" "),h=function(){return{encode:function(a){return n.indexOf(typeof a)+"-"+JSON.stringify(a)},decode:function(a){return"undefined"===typeof a?void 0:JSON.parse(a.substring(2))}}},m={number:h("number"),"boolean":h(),object:h(),string:{encode:function(a){return n.indexOf("string")+"-"+a},decode:function(a){return""+a.substring(2)}},undefined:{encode:function(a){return n.indexOf("undefined")+"-undefined"},decode:function(a){}}},h=function(){return{encode:function(a){return m[typeof a].encode(a)},
decode:function(a){return m[n[a.substring(0,1)]].decode(a)}}}();a.Key=h})(idbModules);(function(a,n){a.Event=function(a,m){return{type:a,debug:m,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}}})(idbModules);(function(a){var n=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null;this.readyState="pending"},h=function(){this.onblocked=this.onupgradeneeded=null};h.prototype=n;a.IDBRequest=n;a.IDBOpenRequest=h})(idbModules);
(function(a,n){var h=function(a,e,h,k){this.lower=a;this.upper=e;this.lowerOpen=h;this.upperOpen=k};h.only=function(a){return new h(a,a,!0,!0)};h.lowerBound=function(a,e){return new h(a,n,e,n)};h.upperBound=function(a){return new h(n,a,n,open)};h.bound=function(a,e,v,k){return new h(a,e,v,k)};a.IDBKeyRange=h})(idbModules);
(function(a,n){function h(m,e,h,k,x,p){this.__range=m;this.source=this.__idbObjectStore=h;this.__req=k;this.key=n;this.direction=e;this.__keyColumnName=x;this.__valueColumnName=p;this.source.transaction.__active||a.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active.");this.__offset=-1;this.__lastKeyContinued=n;this["continue"]()}h.prototype.__find=function(m,e,h,k){var x=this,p=["SELECT * FROM ",a.util.quote(x.__idbObjectStore.name)],u=
[];p.push("WHERE ",x.__keyColumnName," NOT NULL");x.__range&&(x.__range.lower||x.__range.upper)&&(p.push("AND"),x.__range.lower&&(p.push(x.__keyColumnName+(x.__range.lowerOpen?" >=":" >")+" ?"),u.push(a.Key.encode(x.__range.lower))),x.__range.lower&&x.__range.upper&&p.push("AND"),x.__range.upper&&(p.push(x.__keyColumnName+(x.__range.upperOpen?" <= ":" < ")+" ?"),u.push(a.Key.encode(x.__range.upper))));"undefined"!==typeof m&&(x.__lastKeyContinued=m,x.__offset=0);x.__lastKeyContinued!==n&&(p.push("AND "+
x.__keyColumnName+" >= ?"),u.push(a.Key.encode(x.__lastKeyContinued)));p.push("ORDER BY ",x.__keyColumnName);p.push("LIMIT 1 OFFSET "+x.__offset);a.DEBUG&&console.log(p.join(" "),u);e.executeSql(p.join(" "),u,function(e,g){if(1===g.rows.length){var c=a.Key.decode(g.rows.item(0)[x.__keyColumnName]),b="value"===x.__valueColumnName?a.Sca.decode(g.rows.item(0)[x.__valueColumnName]):a.Key.decode(g.rows.item(0)[x.__valueColumnName]);h(c,b)}else a.DEBUG&&console.log("Reached end of cursors"),h(n,n)},function(e,
g){a.DEBUG&&console.log("Could not execute Cursor.continue");k(g)})};h.prototype["continue"]=function(a){var e=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(h,k,x,p){e.__offset++;e.__find(a,h,function(a,k){e.key=a;e.value=k;x("undefined"!==typeof e.key?e:n,e.__req)},function(a){p(a)})})};h.prototype.advance=function(m){0>=m&&a.util.throwDOMException("Type Error - Count is invalid - 0 or negative",m);var e=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(a,
k,h,p){e.__offset+=m;e.__find(n,a,function(a,k){e.key=a;e.value=k;h("undefined"!==typeof e.key?e:n,e.__req)},function(a){p(a)})})};h.prototype.update=function(m){var e=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(h,k,x,p){e.__find(n,h,function(k,q){var g="UPDATE "+a.util.quote(e.__idbObjectStore.name)+" SET value = ? WHERE key = ?";a.DEBUG&&console.log(g,m,k);h.executeSql(g,[a.Sca.encode(m),a.Key.encode(k)],function(a,b){1===b.rowsAffected?x(k):p("No rowns with key found"+
k)},function(a,b){p(b)})},function(a){p(a)})})};h.prototype["delete"]=function(){var h=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,v,k,x){h.__find(n,e,function(p,u){var q="DELETE FROM  "+a.util.quote(h.__idbObjectStore.name)+" WHERE key = ?";a.DEBUG&&console.log(q,p);e.executeSql(q,[a.Key.encode(p)],function(a,c){1===c.rowsAffected?k(n):x("No rowns with key found"+p)},function(a,c){x(c)})},function(a){x(a)})})};a.IDBCursor=h})(idbModules);
(function(a,n){function h(a,e){this.indexName=a;this.__idbObjectStore=this.source=e}h.prototype.__createIndex=function(h,e,v){var k=this,n=k.__idbObjectStore.transaction;n.__addToTransactionQueue(function(p,u,q,g){k.__idbObjectStore.__getStoreProps(p,function(){function c(){a.util.throwDOMException(0,"Could not create new index",arguments)}2!==n.mode&&a.util.throwDOMException(0,"Invalid State error, not a version transaction",k.transaction);var b=JSON.parse(k.__idbObjectStore.__storeProps.indexList);
"undefined"!==typeof b[h]&&a.util.throwDOMException(0,"Index already exists on store",b);b[h]={columnName:h,keyPath:e,optionalParams:v};k.__idbObjectStore.__storeProps.indexList=JSON.stringify(b);b=["ALTER TABLE",a.util.quote(k.__idbObjectStore.name),"ADD",h,"BLOB"].join(" ");a.DEBUG&&console.log(b);p.executeSql(b,[],function(b,g){b.executeSql("SELECT * FROM "+a.util.quote(k.__idbObjectStore.name),[],function(b,d){(function J(G){if(G<d.rows.length)try{a.Sca.decode(d.rows.item(G).value);var y=eval("value['"+
e+"']");b.executeSql("UPDATE "+a.util.quote(k.__idbObjectStore.name)+" set "+h+" = ? where key = ?",[a.Key.encode(y),d.rows.item(G).key],function(a,b){J(G+1)},c)}catch(g){J(G+1)}else a.DEBUG&&console.log("Updating the indexes in table",k.__idbObjectStore.__storeProps),b.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[k.__idbObjectStore.__storeProps.indexList,k.__idbObjectStore.name],function(){k.__idbObjectStore.__setReadyState("createIndex",!0);q(k)},c)})(0)},c)},c)},"createObjectStore")})};
h.prototype.openCursor=function(h,e){var v=new a.IDBRequest;new a.IDBCursor(h,e,this.source,v,this.indexName,"value");return v};h.prototype.openKeyCursor=function(h,e){var v=new a.IDBRequest;new a.IDBCursor(h,e,this.source,v,this.indexName,"key");return v};h.prototype.__fetchIndexData=function(h,e){var v=this;return v.__idbObjectStore.transaction.__addToTransactionQueue(function(k,x,p,u){x=["SELECT * FROM ",a.util.quote(v.__idbObjectStore.name)," WHERE",v.indexName,"NOT NULL"];var q=[];"undefined"!==
typeof h&&(x.push("AND",v.indexName," = ?"),q.push(a.Key.encode(h)));a.DEBUG&&console.log("Trying to fetch data for Index",x.join(" "),q);k.executeSql(x.join(" "),q,function(g,c){var b;b="count"===typeof e?c.rows.length:0===c.rows.length?n:"key"===e?a.Key.decode(c.rows.item(0).key):a.Sca.decode(c.rows.item(0).value);p(b)},u)})};h.prototype.get=function(a){return this.__fetchIndexData(a,"value")};h.prototype.getKey=function(a){return this.__fetchIndexData(a,"key")};h.prototype.count=function(a){return this.__fetchIndexData(a,
"count")};a.IDBIndex=h})(idbModules);
(function(a){var n=function(h,m,e){this.name=h;this.transaction=m;this.__ready={};this.__setReadyState("createObjectStore","undefined"===typeof e?!0:e);this.indexNames=new a.util.StringList};n.prototype.__setReadyState=function(a,m){this.__ready[a]=m};n.prototype.__waitForReady=function(h,m){var e=!0;if("undefined"!==typeof m)e="undefined"===typeof this.__ready[m]?!0:this.__ready[m];else for(var v in this.__ready)this.__ready[v]||(e=!1);if(e)h();else{a.DEBUG&&console.log("Waiting for to be ready",
m);var k=this;window.setTimeout(function(){k.__waitForReady(h,m)},100)}};n.prototype.__getStoreProps=function(h,m,e){var v=this;this.__waitForReady(function(){v.__storeProps?(a.DEBUG&&console.log("Store properties - cached",v.__storeProps),m(v.__storeProps)):h.executeSql("SELECT * FROM __sys__ where name = ?",[v.name],function(e,h){1!==h.rows.length?m():(v.__storeProps={name:h.rows.item(0).name,indexList:h.rows.item(0).indexList,autoInc:h.rows.item(0).autoInc,keyPath:h.rows.item(0).keyPath},a.DEBUG&&
console.log("Store properties",v.__storeProps),m(v.__storeProps))},function(){m()})},e)};n.prototype.__deriveKey=function(h,m,e,v){function k(){h.executeSql("SELECT * FROM sqlite_sequence where name like ?",[n.name],function(a,e){1!==e.rows.length?v(0):v(e.rows.item(0).seq)},function(e,k){a.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",k)})}var n=this;n.__getStoreProps(h,function(h){h||a.util.throwDOMException(0,"Data Error - Could not locate defination for this table",
h);if(h.keyPath)if("undefined"!==typeof e&&a.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",h),m)try{var u=eval("value['"+h.keyPath+"']");u?v(u):"true"===h.autoInc?k():a.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(q){a.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",q)}else a.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not");else"undefined"!==typeof e?
v(e):"false"===h.autoInc?a.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",h):k()})};n.prototype.__insertData=function(h,m,e,v,k){var n={};"undefined"!==typeof e&&(n.key=a.Key.encode(e));var p=JSON.parse(this.__storeProps.indexList),u;for(u in p)try{n[p[u].columnName]=a.Key.encode(eval("value['"+p[u].keyPath+"']"))}catch(q){k(q)}var g=["INSERT INTO ",a.util.quote(this.name),"("],c=[" VALUES ("],p=[];for(u in n)g.push(u+
","),c.push("?,"),p.push(n[u]);g.push("value )");c.push("?)");p.push(a.Sca.encode(m));m=g.join(" ")+c.join(" ");a.DEBUG&&console.log("SQL for adding",m,p);h.executeSql(m,p,function(a,d){v(e)},function(a,d){k(d)})};n.prototype.add=function(a,m){var e=this;return e.transaction.__addToTransactionQueue(function(v,k,n,p){e.__deriveKey(v,a,m,function(k){e.__insertData(v,a,k,n,p)})})};n.prototype.put=function(h,m){var e=this;return e.transaction.__addToTransactionQueue(function(v,k,n,p){e.__deriveKey(v,
h,m,function(k){var q="DELETE FROM "+a.util.quote(e.name)+" where key = ?";v.executeSql(q,[a.Key.encode(k)],function(g,c){a.DEBUG&&console.log("Did the row with the",k,"exist? ",c.rowsAffected);e.__insertData(g,h,k,n,p)},function(a,c){p(c)})})})};n.prototype.get=function(h){var m=this;return m.transaction.__addToTransactionQueue(function(e,v,k,n){m.__waitForReady(function(){var p=a.Key.encode(h);a.DEBUG&&console.log("Fetching",m.name,p);e.executeSql("SELECT * FROM "+a.util.quote(m.name)+" where key = ?",
[p],function(e,q){a.DEBUG&&console.log("Fetched data",q);try{if(0===q.rows.length)return k();k(a.Sca.decode(q.rows.item(0).value))}catch(g){a.DEBUG&&console.log(g),k(void 0)}},function(a,e){n(e)})})})};n.prototype["delete"]=function(h){var m=this;return m.transaction.__addToTransactionQueue(function(e,v,k,n){m.__waitForReady(function(){var p=a.Key.encode(h);a.DEBUG&&console.log("Fetching",m.name,p);e.executeSql("DELETE FROM "+a.util.quote(m.name)+" where key = ?",[p],function(e,q){a.DEBUG&&console.log("Deleted from database",
q.rowsAffected);k()},function(a,e){n(e)})})})};n.prototype.clear=function(){var h=this;return h.transaction.__addToTransactionQueue(function(m,e,v,k){h.__waitForReady(function(){m.executeSql("DELETE FROM "+a.util.quote(h.name),[],function(e,k){a.DEBUG&&console.log("Cleared all records from database",k.rowsAffected);v()},function(a,e){k(e)})})})};n.prototype.count=function(h){var m=this;return m.transaction.__addToTransactionQueue(function(e,v,k,n){m.__waitForReady(function(){var p="SELECT * FROM "+
a.util.quote(m.name)+("undefined"!==typeof h?" WHERE key = ?":""),u=[];"undefined"!==typeof h&&u.push(a.Key.encode(h));e.executeSql(p,u,function(a,e){k(e.rows.length)},function(a,e){n(e)})})})};n.prototype.openCursor=function(h,m){var e=new a.IDBRequest;new a.IDBCursor(h,m,this,e,"key","value");return e};n.prototype.index=function(h){return new a.IDBIndex(h,this)};n.prototype.createIndex=function(h,m,e){e=e||{};this.__setReadyState("createIndex",!1);var v=new a.IDBIndex(h,this);this.__waitForReady(function(){v.__createIndex(h,
m,e)},"createObjectStore");this.indexNames.push(h);return v};n.prototype.deleteIndex=function(h){var m=new a.IDBIndex(h,this,!1);m.__deleteIndex(h);return m};a.IDBObjectStore=n})(idbModules);
(function(a){var n=function(h,m,e){if("number"===typeof m)this.mode=m,2!==m&&a.DEBUG&&console.log("Mode should be a string, but was specified as ",m);else if("string"===typeof m)switch(m){case "readonly":this.mode=1;break;case "readwrite":this.mode=0;break;default:this.mode=0}this.storeNames="string"===typeof h?[h]:h;for(h=0;h<this.storeNames.length;h++)e.objectStoreNames.contains(this.storeNames[h])||a.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",
this.storeNames[h]);this.__active=!0;this.__running=!1;this.__requests=[];this.__aborted=!1;this.db=e;this.onabort=this.onerror=this.oncomplete=this.error=null};n.prototype.__executeRequests=function(){if(this.__running&&2!==this.mode)a.DEBUG&&console.log("Looks like the request set is already running",this.mode);else{this.__running=!0;var h=this;window.setTimeout(function(){2===h.mode||h.__active||a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",
h.__active);h.db.__db.transaction(function(m){function e(e,g){g&&(k.req=g);k.req.readyState="done";k.req.result=e;delete k.req.error;var c=a.Event("success");a.util.callback("onsuccess",k.req,c);n++;p()}function v(e){k.req.readyState="done";k.req.error="DOMError";var g=a.Event("error",arguments);a.util.callback("onerror",k.req,g);n++;p()}h.__tx=m;var k=null,n=0;try{var p=function(){n>=h.__requests.length?(h.__active=!1,h.__requests=[]):(k=h.__requests[n],k.op(m,k.args,e,v))};p()}catch(u){a.DEBUG&&
console.log("An exception occured in transaction",arguments),"function"===typeof h.onerror&&h.onerror()}},function(){a.DEBUG&&console.log("An error in transaction",arguments);"function"===typeof h.onerror&&h.onerror()},function(){a.DEBUG&&console.log("Transaction completed",arguments);"function"===typeof h.oncomplete&&h.oncomplete()})},1)}};n.prototype.__addToTransactionQueue=function(h,m){this.__active||2===this.mode||a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",
this.__mode);var e=new a.IDBRequest;e.source=this.db;this.__requests.push({op:h,args:m,req:e});this.__executeRequests();return e};n.prototype.objectStore=function(h){return new a.IDBObjectStore(h,this)};n.prototype.abort=function(){!this.__active&&a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)};n.prototype.READ_ONLY=0;n.prototype.READ_WRITE=1;n.prototype.VERSION_CHANGE=2;a.IDBTransaction=n})(idbModules);
(function(a){var n=function(h,m,e,n){this.__db=h;this.version=e;this.__storeProperties=n;this.objectStoreNames=new a.util.StringList;for(h=0;h<n.rows.length;h++)this.objectStoreNames.push(n.rows.item(h).name);this.name=m;this.onabort=this.onerror=this.onversionchange=null};n.prototype.createObjectStore=function(h,m){var e=this;m=m||{};m.keyPath=m.keyPath||null;var n=new a.IDBObjectStore(h,e.__versionTransaction,!1);e.__versionTransaction.__addToTransactionQueue(function(k,x,p,u){function q(){a.util.throwDOMException(0,
"Could not create new object store",arguments)}e.__versionTransaction||a.util.throwDOMException(0,"Invalid State error",e.transaction);x=["CREATE TABLE",a.util.quote(h),"(key BLOB",m.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");a.DEBUG&&console.log(x);k.executeSql(x,[],function(a,c){a.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[h,m.keyPath,m.autoIncrement?!0:!1,"{}"],function(){n.__setReadyState("createObjectStore",!0);p(n)},q)},q)});e.objectStoreNames.push(h);
return n};n.prototype.deleteObjectStore=function(h){var m=function(){a.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},e=this;!e.objectStoreNames.contains(h)&&m("Object Store does not exist");e.objectStoreNames.splice(e.objectStoreNames.indexOf(h),1);e.__versionTransaction.__addToTransactionQueue(function(n,k,x,p){e.__versionTransaction||a.util.throwDOMException(0,"Invalid State error",e.transaction);e.__db.transaction(function(e){e.executeSql("SELECT * FROM __sys__ where name = ?",
[h],function(e,g){0<g.rows.length&&e.executeSql("DROP TABLE "+a.util.quote(h),[],function(){e.executeSql("DELETE FROM __sys__ WHERE name = ?",[h],function(){},m)},m)})})})};n.prototype.close=function(){};n.prototype.transaction=function(h,m){return new a.IDBTransaction(h,m||1,this)};a.IDBDatabase=n})(idbModules);
(function(a){if(window.openDatabase){var n=window.openDatabase("__sysdb__",1,"System Database",4194304);n.transaction(function(h){h.executeSql("SELECT * FROM dbVersions",[],function(a,e){},function(){n.transaction(function(h){h.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){},function(){a.util.throwDOMException("Could not create table __sysdb__ to save DB versions")})})})},function(){a.DEBUG&&console.log("Error in sysdb transaction - when selecting from dbVersions",
arguments)});a.shimIndexedDB={open:function(h,m){function e(){if(!x){var e=a.Event("error",arguments);k.readyState="done";k.error="DOMError";a.util.callback("onerror",k,e);x=!0}}function v(p){var u=window.openDatabase(h,1,h,4194304);k.readyState="done";"undefined"===typeof m&&(m=p||1);(0>=m||p>m)&&a.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",m);u.transaction(function(q){q.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",
[],function(){q.executeSql("SELECT * FROM __sys__",[],function(g,c){var b=a.Event("success");k.source=k.result=new a.IDBDatabase(u,h,m,c);p<m?n.transaction(function(b){b.executeSql("UPDATE dbVersions set version = ? where name = ?",[m,h],function(){var b=a.Event("upgradeneeded");b.oldVersion=p;b.newVersion=m;k.transaction=k.result.__versionTransaction=new a.IDBTransaction([],2,k.source);a.util.callback("onupgradeneeded",k,b,function(){var b=a.Event("success");a.util.callback("onsuccess",k,b)})},e)},
e):a.util.callback("onsuccess",k,b)},e)},e)},e)}var k=new a.IDBOpenRequest,x=!1;n.transaction(function(a){a.executeSql("SELECT * FROM dbVersions where name = ?",[h],function(a,k){0===k.rows.length?a.executeSql("INSERT INTO dbVersions VALUES (?,?)",[h,m||1],function(){v(0)},e):v(k.rows.item(0).version)},e)},e);return k},deleteDatabase:function(h){function m(e){if(!k){v.readyState="done";v.error="DOMError";var u=a.Event("error");u.message=e;u.debug=arguments;a.util.callback("onerror",v,u);k=!0}}function e(){n.transaction(function(e){e.executeSql("DELETE FROM dbVersions where name = ? ",
[h],function(){v.result=void 0;var e=a.Event("success");e.newVersion=null;e.oldVersion=x;a.util.callback("onsuccess",v,e)},m)},m)}var v=new a.IDBOpenRequest,k=!1,x=null;n.transaction(function(k){k.executeSql("SELECT * FROM dbVersions where name = ?",[h],function(k,q){if(0===q.rows.length){v.result=void 0;var g=a.Event("success");g.newVersion=null;g.oldVersion=x;a.util.callback("onsuccess",v,g)}else x=q.rows.item(0).version,window.openDatabase(h,1,h,4194304).transaction(function(c){c.executeSql("SELECT * FROM __sys__",
[],function(b,d){var c=d.rows;(function f(D){D>=c.length?b.executeSql("DROP TABLE __sys__",[],function(){e()},m):b.executeSql("DROP TABLE "+a.util.quote(c.item(D).name),[],function(){f(D+1)},function(){f(D+1)})})(0)},function(a){e()})},m)})},m);return v},cmp:function(h,m){return a.Key.encode(h)>a.Key.encode(m)?1:h===m?0:-1}}}})(idbModules);
(function(a,n){"undefined"!==typeof a.openDatabase&&(a.shimIndexedDB=n.shimIndexedDB,a.shimIndexedDB&&(a.shimIndexedDB.__useShim=function(){a.indexedDB=n.shimIndexedDB;a.IDBDatabase=n.IDBDatabase;a.IDBTransaction=n.IDBTransaction;a.IDBCursor=n.IDBCursor;a.IDBKeyRange=n.IDBKeyRange},a.shimIndexedDB.__debug=function(a){n.DEBUG=a}));a.indexedDB=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.oIndexedDB||a.msIndexedDB;"undefined"===typeof a.indexedDB&&"undefined"!==typeof a.openDatabase?a.shimIndexedDB.__useShim():
(a.IDBDatabase=a.IDBDatabase||a.webkitIDBDatabase,a.IDBTransaction=a.IDBTransaction||a.webkitIDBTransaction,a.IDBCursor=a.IDBCursor||a.webkitIDBCursor,a.IDBKeyRange=a.IDBKeyRange||a.webkitIDBKeyRange,a.IDBTransaction.READ_ONLY=a.IDBTransaction.READ_ONLY||"readonly",a.IDBTransaction.READ_WRITE=a.IDBTransaction.READ_WRITE||"readwrite")})(window,idbModules);fdjt.charnames={AElig:"\u00c6",Aacgr:"\u0386",Aacute:"\u00c1",Abreve:"\u0102",Acirc:"\u00c2",Acy:"\u0410",Agr:"\u0391",Agrave:"\u00c0",Alpha:"\u0391",Amacr:"\u0100",Aogon:"\u0104",Aring:"\u00c5",Atilde:"\u00c3",Auml:"\u00c4",Barwed:"\u2306",Bcy:"\u0411",Beta:"\u0392",Bgr:"\u0392",CHcy:"\u0427",Cacute:"\u0106",Cap:"\u22d2",Ccaron:"\u010c",Ccedil:"\u00c7",Ccirc:"\u0108",Cdot:"\u010a",Chi:"\u03a7",Cup:"\u22d3",DJcy:"\u0402",DScy:"\u0405",DZcy:"\u040f",Dagger:"\u2021",Dcaron:"\u010e",Dcy:"\u0414",Delta:"\u0394",
Dgr:"\u0394",Dot:"\u00a8",DotDot:"\u20dc",Dstrok:"\u0110",EEacgr:"\u0389",EEgr:"\u0397",ENG:"\u014a",ETH:"\u00d0",Eacgr:"\u0388",Eacute:"\u00c9",Ecaron:"\u011a",Ecirc:"\u00ca",Ecy:"\u042d",Edot:"\u0116",Egr:"\u0395",Egrave:"\u00c8",Emacr:"\u0112",Eogon:"\u0118",Epsilon:"\u0395",Eta:"\u0397",Euml:"\u00cb",Fcy:"\u0424",GJcy:"\u0403",Gamma:"\u0393",Gbreve:"\u011e",Gcedil:"\u0122",Gcirc:"\u011c",Gcy:"\u0413",Gdot:"\u0120",Gg:"\u22d9",Ggr:"\u0393",Gt:"\u226b",HARDcy:"\u042a",Hcirc:"\u0124",Hstrok:"\u0126",
IEcy:"\u0415",IJlig:"\u0132",IOcy:"\u0401",Iacgr:"\u038a",Iacute:"\u00cd",Icirc:"\u00ce",Icy:"\u0418",Idigr:"\u03aa",Idot:"\u0130",Igr:"\u0399",Igrave:"\u00cc",Imacr:"\u012a",Iogon:"\u012e",Iota:"\u0399",Itilde:"\u0128",Iukcy:"\u0406",Iuml:"\u00cf",Jcirc:"\u0134",Jcy:"\u0419",Jsercy:"\u0408",Jukcy:"\u0404",KHcy:"\u0425",KHgr:"\u03a7",KJcy:"\u040c",Kappa:"\u039a",Kcedil:"\u0136",Kcy:"\u041a",Kgr:"\u039a",LJcy:"\u0409",Lacute:"\u0139",Lambda:"\u039b",Larr:"\u219e",Lcaron:"\u013d",Lcedil:"\u013b",Lcy:"\u041b",
Lgr:"\u039b",Ll:"\u22d8",Lmidot:"\u013f",Lstrok:"\u0141",Lt:"\u226a",Mcy:"\u041c",Mgr:"\u039c",Mu:"\u039c",NJcy:"\u040a",Nacute:"\u0143",Ncaron:"\u0147",Ncedil:"\u0145",Ncy:"\u041d",Ngr:"\u039d",Ntilde:"\u00d1",Nu:"\u039d",OElig:"\u0152",OHacgr:"\u038f",OHgr:"\u03a9",Oacgr:"\u038c",Oacute:"\u00d3",Ocirc:"\u00d4",Ocy:"\u041e",Odblac:"\u0150",Ogr:"\u039f",Ograve:"\u00d2",Omacr:"\u014c",Omega:"\u03a9",Omicron:"\u039f",Oslash:"\u00d8",Otilde:"\u00d5",Ouml:"\u00d6",PHgr:"\u03a6",PSgr:"\u03a8",Pcy:"\u041f",
Pgr:"\u03a0",Phi:"\u03a6",Pi:"\u03a0",Prime:"\u2033",Psi:"\u03a8",Racute:"\u0154",Rarr:"\u21a0",Rcaron:"\u0158",Rcedil:"\u0156",Rcy:"\u0420",Rgr:"\u03a1",Rho:"\u03a1",SHCHcy:"\u0429",SHcy:"\u0428",SOFTcy:"\u042c",Sacute:"\u015a",Scaron:"\u0160",Scedil:"\u015e",Scirc:"\u015c",Scy:"\u0421",Sgr:"\u03a3",Sigma:"\u03a3",Sub:"\u22d0",Sup:"\u22d1",THORN:"\u00de",THgr:"\u0398",TSHcy:"\u040b",TScy:"\u0426",Tau:"\u03a4",Tcaron:"\u0164",Tcedil:"\u0162",Tcy:"\u0422",Tgr:"\u03a4",Theta:"\u0398",Tstrok:"\u0166",
Uacgr:"\u038e",Uacute:"\u00da",Ubrcy:"\u040e",Ubreve:"\u016c",Ucirc:"\u00db",Ucy:"\u0423",Udblac:"\u0170",Ugr:"\u03a5",Ugrave:"\u00d9",Umacr:"\u016a",Uogon:"\u0172",Upsi:"\u03a5",Upsilon:"\u03a5",Uring:"\u016e",Utilde:"\u0168",Uuml:"\u00dc",Vcy:"\u0412",Vdash:"\u22a9",Verbar:"\u2016",Vvdash:"\u22aa",Wcirc:"\u0174",Xgr:"\u039e",Xi:"\u039e",YAcy:"\u042f",YIcy:"\u0407",YUcy:"\u042e",Yacute:"\u00dd",Ycirc:"\u0176",Ycy:"\u042b",Yuml:"\u0178",ZHcy:"\u0416",Zacute:"\u0179",Zcaron:"\u017d",Zcy:"\u0417",Zdot:"\u017b",
Zeta:"\u0396",Zgr:"\u0396",aacgr:"\u03ac",aacute:"\u00e1",abreve:"\u0103",acirc:"\u00e2",acute:"\u00b4",acy:"\u0430",aelig:"\u00e6",agr:"\u03b1",agrave:"\u00e0",alefsym:"\u2135",aleph:"\u2135",alpha:"\u03b1",amacr:"\u0101",amalg:"\u2210",amp:"&",and:"\u2227",ang:"\u2220",ang90:"\u221f",angmsd:"\u2221",angsph:"\u2222",angst:"\u212b",aogon:"\u0105",ap:"\u2248",ape:"\u224a",apos:"'",aposmod:"\u02bc",aring:"\u00e5",ast:"*",asymp:"\u2248",atilde:"\u00e3",auml:"\u00e4","b.Delta":"\u0394","b.Gamma":"\u0393",
"b.Lambda":"\u039b","b.Omega":"\u03a9","b.Phi":"\u03a6","b.Pi":"\u03a0","b.Psi":"\u03a8","b.Sigma":"\u03a3","b.Theta":"\u0398","b.Upsi":"\u03a5","b.Xi":"\u039e","b.alpha":"\u03b1","b.beta":"\u03b2","b.chi":"\u03c7","b.delta":"\u03b4","b.epsi":"\u03b5","b.epsis":"\u03b5","b.epsiv":"\u03b5","b.eta":"\u03b7","b.gamma":"\u03b3","b.gammad":"\u03dc","b.iota":"\u03b9","b.kappa":"\u03ba","b.kappav":"\u03f0","b.lambda":"\u03bb","b.mu":"\u03bc","b.nu":"\u03bd","b.omega":"\u03ce","b.phis":"\u03c6","b.phiv":"\u03d5",
"b.pi":"\u03c0","b.piv":"\u03d6","b.psi":"\u03c8","b.rho":"\u03c1","b.rhov":"\u03f1","b.sigma":"\u03c3","b.sigmav":"\u03c2","b.tau":"\u03c4","b.thetas":"\u03b8","b.thetav":"\u03d1","b.upsi":"\u03c5","b.xi":"\u03be","b.zeta":"\u03b6",barwed:"\u22bc",bcong:"\u224c",bcy:"\u0431",bdquo:"\u201e",becaus:"\u2235",bepsi:"\u220d",bernou:"\u212c",beta:"\u03b2",beth:"\u2136",bgr:"\u03b2",blackstar:"\u2726",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bottom:"\u22a5",bowtie:"\u22c8",
boxDL:"\u2557",boxDR:"\u2554",boxDl:"\u2556",boxDr:"\u2553",boxH:"\u2550",boxHD:"\u2566",boxHU:"\u2569",boxHd:"\u2564",boxHu:"\u2567",boxUL:"\u255d",boxUR:"\u255a",boxUl:"\u255c",boxUr:"\u2559",boxV:"\u2551",boxVH:"\u256c",boxVL:"\u2563",boxVR:"\u2560",boxVh:"\u256b",boxVl:"\u2562",boxVr:"\u255f",boxdL:"\u2555",boxdR:"\u2552",boxdl:"\u2510",boxdr:"\u250c",boxh:"\u2500",boxhD:"\u2565",boxhU:"\u2568",boxhd:"\u252c",boxhu:"\u2534",boxuL:"\u255b",boxuR:"\u2558",boxul:"\u2518",boxur:"\u2514",boxv:"\u2502",
boxvH:"\u256a",boxvL:"\u2561",boxvR:"\u255e",boxvh:"\u253c",boxvl:"\u2524",boxvr:"\u251c",bprime:"\u2035",breve:"\u02d8",brvbar:"\u00a6",bsim:"\u223d",bsime:"\u22cd",bsol:"\\",bull:"\u2022",bump:"\u224e",bumpe:"\u224f",cacute:"\u0107",cap:"\u2229",caret:"\u2041",caron:"\u02c7",ccaron:"\u010d",ccedil:"\u00e7",ccirc:"\u0109",cdot:"\u010b",cedil:"\u00b8",cent:"\u00a2",chcy:"\u0447",check:"\u2713",chi:"\u03c7",cir:"\u25cb",circ:"\u02c6",cire:"\u2257",clubs:"\u2663",colon:":",colone:"\u2254",comma:",",
commat:"@",comp:"\u2201",compfn:"\u2218",cong:"\u2245",conint:"\u222e",coprod:"\u2210",copy:"\u00a9",copysr:"\u2117",crarr:"\u21b5",cross:"\u2717",cuepr:"\u22de",cuesc:"\u22df",cularr:"\u21b6",cup:"\u222a",cupre:"\u227c",curarr:"\u21b7",curren:"\u00a4",cuvee:"\u22ce",cuwed:"\u22cf",dArr:"\u21d3",dagger:"\u2020",daleth:"\u2138",darr:"\u2193",darr2:"\u21ca",dash:"\u2010",dashv:"\u22a3",dblac:"\u02dd",dcaron:"\u010f",dcy:"\u0434",deg:"\u00b0",delta:"\u03b4",dgr:"\u03b4",dharl:"\u21c3",dharr:"\u21c2",
diam:"\u22c4",diams:"\u2666",die:"\u00a8",divide:"\u00f7",divonx:"\u22c7",djcy:"\u0452",dlarr:"\u2199",dlcorn:"\u231e",dlcrop:"\u230d",dollar:"$",dot:"\u02d9",drarr:"\u2198",drcorn:"\u231f",drcrop:"\u230c",dscy:"\u0455",dstrok:"\u0111",dtri:"\u25bf",dtrif:"\u25be",dzcy:"\u045f",eDot:"\u2251",eacgr:"\u03ad",eacute:"\u00e9",ecaron:"\u011b",ecir:"\u2256",ecirc:"\u00ea",ecolon:"\u2255",ecy:"\u044d",edot:"\u0117",eeacgr:"\u03ae",eegr:"\u03b7",efDot:"\u2252",egr:"\u03b5",egrave:"\u00e8",egs:"\u22dd",ell:"\u2113",
els:"\u22dc",emacr:"\u0113",empty:"\u2205",emsp:"\u2003",emsp13:"\u2004",emsp14:"\u2005",eng:"\u014b",ensp:"\u2002",eogon:"\u0119",epsi:"\u03b5",epsilon:"\u03b5",epsis:"\u220a",epsiv:"\u03bf",equals:"=",equiv:"\u2261",erDot:"\u2253",esdot:"\u2250",eta:"\u03b7",eth:"\u00f0",euml:"\u00eb",euro:"\u20ac",excl:"!",exist:"\u2203",fcy:"\u0444",female:"\u2640",ffilig:"\ufb03",fflig:"\ufb00",ffllig:"\ufb04",filig:"\ufb01",flat:"\u266d",fllig:"\ufb02",fnof:"\u0192",forall:"\u2200",fork:"\u22d4",frac12:"\u00bd",
frac13:"\u2153",frac14:"\u00bc",frac15:"\u2155",frac16:"\u2159",frac18:"\u215b",frac23:"\u2154",frac25:"\u2156",frac34:"\u00be",frac35:"\u2157",frac38:"\u215c",frac45:"\u2158",frac56:"\u215a",frac58:"\u215d",frac78:"\u215e",frasl:"\u2044",frown:"\u2322",gE:"\u2267",gEl:"\u2a8c",gacute:"\u01f5",gamma:"\u03b3",gammad:"\u03dc",gap:"\u2a86",gbreve:"\u011f",gcedil:"\u0123",gcirc:"\u011d",gcy:"\u0433",gdot:"\u0121",ge:"\u2265",gel:"\u22db",ges:"\u2265",ggr:"\u03b3",gimel:"\u2137",gjcy:"\u0453",gl:"\u2277",
gnE:"\u2269",gnap:"\u2a8a",gne:"\u2269",gnsim:"\u22e7",grave:"`",gsdot:"\u22d7",gsim:"\u2273",gt:">",gvnE:"\u2269",hArr:"\u21d4",hairsp:"\u200a",half:"\u00bd",hamilt:"\u210b",hardcy:"\u044a",harr:"\u2194",harrw:"\u21ad",hcirc:"\u0125",hearts:"\u2665",hellip:"\u2026",horbar:"\u2015",hstrok:"\u0127",hybull:"\u2043",hyphen:"-",iacgr:"\u03af",iacute:"\u00ed",icirc:"\u00ee",icy:"\u0438",idiagr:"\u0390",idigr:"\u03ca",iecy:"\u0435",iexcl:"\u00a1",iff:"\u21d4",igr:"\u03b9",igrave:"\u00ec",ijlig:"\u0133",
imacr:"\u012b",image:"\u2111",incare:"\u2105",infin:"\u221e",inodot:"\u0131","int":"\u222b",intcal:"\u22ba",iocy:"\u0451",iogon:"\u012f",iota:"\u03b9",iquest:"\u00bf",isin:"\u2208",itilde:"\u0129",iukcy:"\u0456",iuml:"\u00ef",jcirc:"\u0135",jcy:"\u0439",jsercy:"\u0458",jukcy:"\u0454",kappa:"\u03ba",kappav:"\u03f0",kcedil:"\u0137",kcy:"\u043a",kgr:"\u03ba",kgreen:"\u0138",khcy:"\u0445",khgr:"\u03c7",kjcy:"\u045c",lAarr:"\u21da",lArr:"\u21d0",lE:"\u2266",lEg:"\u2a8b",lacute:"\u013a",lagran:"\u2112",
lambda:"\u03bb",lang:"\u2329",lap:"\u2a85",laquo:"\u00ab",larr:"\u2190",larr2:"\u21c7",larrhk:"\u21a9",larrlp:"\u21ab",larrtl:"\u21a2",lcaron:"\u013e",lcedil:"\u013c",lceil:"\u2308",lcub:"{",lcy:"\u043b",ldot:"\u22d6",ldquo:"\u201c",ldquor:"\u201e",le:"\u2264",leg:"\u22da",les:"\u2264",lfloor:"\u230a",lg:"\u2276",lgr:"\u03bb",lhard:"\u21bd",lharu:"\u21bc",lhblk:"\u2584",ljcy:"\u0459",lmidot:"\u0140",lnE:"\u2268",lnap:"\u2a89",lne:"\u2268",lnsim:"\u22e6",lowast:"\u2217",lowbar:"_",loz:"\u25ca",lozf:"\u2726",
lpar:"(",lrarr2:"\u21c6",lrhar2:"\u21cb",lrm:"\u200e",lsaquo:"\u2039",lsh:"\u21b0",lsim:"\u2272",lsqb:"[",lsquo:"\u2018",lsquor:"\u201a",lstrok:"\u0142",lt:"<",lthree:"\u22cb",ltimes:"\u22c9",ltri:"\u25c3",ltrie:"\u22b4",ltrif:"\u25c2",lvnE:"\u2268",macr:"\u00af",male:"\u2642",malt:"\u2720",map:"\u21a6",marker:"\u25ae",mcy:"\u043c",mdash:"\u2014",mgr:"\u03bc",micro:"\u00b5",mid:"\u2223",middot:"\u00b7",minus:"\u2212",minusb:"\u229f",mldr:"\u2026",mnplus:"\u2213",models:"\u22a7",mu:"\u03bc",mumap:"\u22b8",
nVDash:"\u22af",nVdash:"\u22ae",nabla:"\u2207",nacute:"\u0144",nap:"\u2249",napos:"\u0149",natur:"\u266e",nbsp:"\u00a0",ncaron:"\u0148",ncedil:"\u0146",ncong:"\u2247",ncy:"\u043d",ndash:"\u2013",ne:"\u2260",nearr:"\u2197",nequiv:"\u2262",nexist:"\u2204",nge:"\u2271",nges:"\u2271",ngr:"\u03bd",ngt:"\u226f",nhArr:"\u21ce",nharr:"\u21ae",ni:"\u220b",njcy:"\u045a",nlArr:"\u21cd",nlarr:"\u219a",nldr:"\u2025",nle:"\u2270",nles:"\u2270",nlt:"\u226e",nltri:"\u22ea",nltrie:"\u22ec",nmid:"\u2224",not:"\u00ac",
notin:"\u2209",npar:"\u2226",npr:"\u2280",npre:"\u22e0",nrArr:"\u21cf",nrarr:"\u219b",nrtri:"\u22eb",nrtrie:"\u22ed",nsc:"\u2281",nsce:"\u22e1",nsim:"\u2241",nsime:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsub:"\u2284",nsubE:"\u2288",nsube:"\u2288",nsup:"\u2285",nsupE:"\u2289",nsupe:"\u2289",ntilde:"\u00f1",nu:"\u03bd",num:"#",numero:"\u2116",numsp:"\u2007",nvDash:"\u22ad",nvdash:"\u22ac",oS:"\u24c8",oacgr:"\u03cc",oacute:"\u00f3",oast:"\u229b",ocir:"\u229a",ocirc:"\u00f4",ocy:"\u043e",odash:"\u229d",
odblac:"\u0151",odot:"\u2299",oelig:"\u0153",ogon:"\u02db",ogr:"\u03bf",ograve:"\u00f2",ohacgr:"\u03ce",ohgr:"\u03c9",ohm:"\u2126",olarr:"\u21ba",oline:"\u203e",omacr:"\u014d",omega:"\u03c9",omicron:"\u03bf",ominus:"\u2296",oplus:"\u2295",or:"\u2228",orarr:"\u21bb",order:"\u2134",ordf:"\u00aa",ordm:"\u00ba",oslash:"\u00f8",osol:"\u2298",otilde:"\u00f5",otimes:"\u2297",ouml:"\u00f6",par:"\u2225",para:"\u00b6",part:"\u2202",pcy:"\u043f",percnt:"%",period:".",permil:"\u2030",perp:"\u22a5",pgr:"\u03c0",
phgr:"\u03c6",phi:"\u03c6",phis:"\u03c6",phiv:"\u03d5",phmmat:"\u2133",phone:"\u260e",pi:"\u03c0",piv:"\u03d6",planck:"\u210f",plus:"+",plusb:"\u229e",plusdo:"\u2214",plusmn:"\u00b1",pound:"\u00a3",pr:"\u227a",prap:"\u2ab7",pre:"\u227c",prime:"\u2032",prnE:"\u2ab5",prnap:"\u2ab9",prnsim:"\u22e8",prod:"\u220f",prop:"\u221d",prsim:"\u227e",psgr:"\u03c8",psi:"\u03c8",puncsp:"\u2008",quest:"?",quot:'"',rAarr:"\u21db",rArr:"\u21d2",racute:"\u0155",radic:"\u221a",rang:"\u232a",raquo:"\u00bb",rarr:"\u2192",
rarr2:"\u21c9",rarrhk:"\u21aa",rarrlp:"\u21ac",rarrtl:"\u21a3",rarrw:"\u219d",rcaron:"\u0159",rcedil:"\u0157",rceil:"\u2309",rcub:"}",rcy:"\u0440",rdquo:"\u201d",rdquor:"\u201c",real:"\u211c",rect:"\u25ad",reg:"\u00ae",rfloor:"\u230b",rgr:"\u03c1",rhard:"\u21c1",rharu:"\u21c0",rho:"\u03c1",rhov:"\u03f1",ring:"\u02da",rlarr2:"\u21c4",rlhar2:"\u21cc",rlm:"\u200f",rpar:")",rpargt:"\u2994",rsaquo:"\u203a",rsh:"\u21b1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2018",rthree:"\u22cc",rtimes:"\u22ca",rtri:"\u25b9",
rtrie:"\u22b5",rtrif:"\u25b8",rx:"\u211e",sacute:"\u015b",samalg:"\u2210",sbquo:"\u201a",sbsol:"\\",sc:"\u227b",scap:"\u2ab8",scaron:"\u0161",sccue:"\u227d",sce:"\u227d",scedil:"\u015f",scirc:"\u015d",scnE:"\u2ab6",scnap:"\u2aba",scnsim:"\u22e9",scsim:"\u227f",scy:"\u0441",sdot:"\u22c5",sdotb:"\u22a1",sect:"\u00a7",semi:";",setmn:"\u2216",sext:"\u2736",sfgr:"\u03c2",sfrown:"\u2322",sgr:"\u03c3",sharp:"\u266f",shchcy:"\u0449",shcy:"\u0448",shy:"\u00ad",sigma:"\u03c3",sigmaf:"\u03c2",sigmav:"\u03c2",
sim:"\u223c",sime:"\u2243",smid:"\u2223",smile:"\u2323",softcy:"\u044c",sol:"/",spades:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcup:"\u2294",sqsub:"\u228f",sqsube:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",squ:"\u25a1",square:"\u25a1",squf:"\u25aa",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22c6",star:"\u2606",starf:"\u2605",sub:"\u2282",subE:"\u2286",sube:"\u2286",subnE:"\u228a",subne:"\u228a",sum:"\u2211",sung:"\u266a",sup:"\u2283",sup1:"\u00b9",sup2:"\u00b2",sup3:"\u00b3",supE:"\u2287",supe:"\u2287",
supnE:"\u228b",supne:"\u228b",szlig:"\u00df",target:"\u2316",tau:"\u03c4",tcaron:"\u0165",tcedil:"\u0163",tcy:"\u0442",tdot:"\u20db",telrec:"\u2315",tgr:"\u03c4",there4:"\u2234",theta:"\u03b8",thetas:"\u03b8",thetasym:"\u03d1",thetav:"\u03d1",thgr:"\u03b8",thinsp:"\u2009",thkap:"\u2248",thksim:"\u223c",thorn:"\u00fe",tilde:"\u02dc",times:"\u00d7",timesb:"\u22a0",top:"\u22a4",tprime:"\u2034",trade:"\u2122",trie:"\u225c",tscy:"\u0446",tshcy:"\u045b",tstrok:"\u0167",twixt:"\u226c",uArr:"\u21d1",uacgr:"\u03cd",
uacute:"\u00fa",uarr:"\u2191",uarr2:"\u21c8",ubrcy:"\u045e",ubreve:"\u016d",ucirc:"\u00fb",ucy:"\u0443",udblac:"\u0171",udiagr:"\u03b0",udigr:"\u03cb",ugr:"\u03c5",ugrave:"\u00f9",uharl:"\u21bf",uharr:"\u21be",uhblk:"\u2580",ulcorn:"\u231c",ulcrop:"\u230f",umacr:"\u016b",uml:"\u00a8",uogon:"\u0173",uplus:"\u228e",upsi:"\u03c5",upsih:"\u03d2",upsilon:"\u03c5",urcorn:"\u231d",urcrop:"\u230e",uring:"\u016f",utilde:"\u0169",utri:"\u25b5",utrif:"\u25b4",uuml:"\u00fc",vArr:"\u21d5",vDash:"\u22a8",varr:"\u2195",
vcy:"\u0432",vdash:"\u22a2",veebar:"\u22bb",vellip:"\u22ee",verbar:"|",vltri:"\u22b2",vprime:"\u2032",vprop:"\u221d",vrtri:"\u22b3",vsubnE:"\u228a",vsubne:"\u228a",vsupnE:"\u228b",vsupne:"\u228b",wcirc:"\u0175",wedgeq:"\u2259",weierp:"\u2118",whitestar:"\u2727",wreath:"\u2240",xcirc:"\u25cb",xdtri:"\u25bd",xgr:"\u03be",xhArr:"\u2194",xharr:"\u2194",xi:"\u03be",xlArr:"\u21d0",xrArr:"\u21d2",xutri:"\u25b3",yacute:"\u00fd",yacy:"\u044f",ycirc:"\u0177",ycy:"\u044b",yen:"\u00a5",yicy:"\u0457",yucy:"\u044e",
yuml:"\u00ff",zacute:"\u017a",zcaron:"\u017e",zcy:"\u0437",zdot:"\u017c",zeta:"\u03b6",zgr:"\u03b6",zhcy:"\u0436",zwj:"\u200d",zwnj:"\u200c"};fdjt.String=function(){function a(b){if("string"!==typeof b&&!(b instanceof String))return n(b);for(var d="",c,f=b.indexOf("%"),e=1;0<=f;){0<f&&(d+=b.slice(0,f));if("%"===b[f+1])d+="%";else if("o"===b[f+1])if(c=arguments[e++],"string"===typeof c)d=d+"'"+c+"'";else if("number"===typeof c)d+=c;else if(Array.isArray(c)){for(var g=0,k=c.length,d=d+"[";g<k;)d=d+(0<g?",":"")+n(c[g++]);d+="]"}else d+=n(c);else if("j"===b[f+1])if(c=arguments[e++],Array.isArray(c))for(g=0,k=c.length,d+="[";g<k;)d=d+(0<g?",":
"")+JSON.stringify(c[g++]);else if("object"===typeof c){g=!1;try{g=JSON.stringify(c)}catch(w){var g={},u;for(u in c)if(c.hasOwnProperty(u)){var k=c[u],t;if(Array.isArray(k)){t=[];for(var A=0,h=k.length;A<h;){var q=k[A++],p;try{p=a(q)}catch(m){p=q.toString()}t.push(p)}}else try{t=a(k)}catch(V){t=k.toString()}g[u]=t}g=JSON.stringify(g)}d+=g}else d+=JSON.stringify(c);else"x"===b[f+1]&&"number"===typeof arguments[e]&&0<=arguments[e]&&0<=arguments[e]%1?(c=arguments[e++],d+=c.toString(16)):arguments[e]?
d+=arguments[e++]:"undefined"===typeof arguments[e]?(d+="?undef?",e++):d+=arguments[e++];b=b.slice(f+2);f=b.indexOf("%")}return d+b}function n(a){if("undefined"===typeof a)return"?undef?";if(a){if("number"===typeof a)return""+a;if(a.tagName){var b="["+a.tagName;a.className&&(b=b+"."+a.className.replace(/\s+/g,"."));a.id&&(b=b+"#"+a.id);a.name&&(b=b+"[name="+a.name+"]");(a=a.innerText?a.innerText.trim():e(a.innerHTML).trim())&&0!==a.length&&(b=32>a.length?b+"'"+a.replace(/\n/g,"\\n")+"'":b+"'"+a.slice(0,
16).replace(/\n/g,"\\n")+"'...");return b+"]"}if(a.nodeType)return 3===a.nodeType?'["'+a.nodeValue+'"]':"<"+a.nodeType+">";if(a.oid)return a.oid;if(a._fdjtid)return"#@"+a._fdjtid;if(a.type&&(a.target||a.srcElement)){b="["+a.type+"@"+n(a.target||a.srcElement);if((a.target||a.srcElement).nodeType){var d="(m="+(!0===a.shiftKey?"s":"")+(!0===a.ctrlKey?"c":"")+(!0===a.metaKey?"m":"")+(!0===a.altKey?"a":"")+("undefined"!==typeof a.button?",b="+a.button:"")+("undefined"!==typeof a.which?",w="+a.which:""),
c=a.clientX,f=a.clientY;if("number"===typeof c||"number"===typeof f)d=d+",cx="+c+",cy="+f;a.touches&&(d=d+",touches="+a.touches.length);a.keyCode&&(d=d+",kc="+a.keyCode);a.charCode&&(d=d+",cc="+a.charCode);a=d+")"}else a="";return b+a+"]"}return""+a}return a}function h(a){var b=0,d=a.length;if(0>=d)return a;for(;b<d&&-1<" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(b));)b++;if(b===d)return"";
for(var c=d-1;c>b&&-1<" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(c));)c--;return 0<b||c<d?a.slice(b,c+1):a}function m(a){a=a.replace(/\s+/g," ");var b=0,d=a.length;if(0>=d)return a;for(;b<d&&-1<" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(b));)b++;if(b===d)return"";for(var c=
d-1;c>b&&-1<" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(c));)c--;return 0<b||c<d?a.slice(b,c+1):a}function e(a){return a.replace(/<[^>]*>/g,"")}function v(a,b){return String.fromCharCode(parseInt(b,10))}function k(a,b){return String.fromCharCode(parseInt(b,16))}function x(a,b){return fdjt.charnames[b]||"&"+b+";"}function p(a,b){return w.hasOwnProperty(b)?w[b]:"&"+b+";"}function u(a,b){return 0===
a.indexOf(b)}function q(a,b){if(a.indexOf)return 0<=a.indexOf(b);for(var d=0,c=a.length;d<c;){if(a[d]===b)return!0;d++}return!1}function g(a,b,d){var c=a.strings;if(d===b.length){if(c.indexOf?0<=c.indexOf(b):q(c,b))return!1;c.push(b);return!0}if(a.splits){var f=b[d],e=a[f];e||(e={strings:[]},e.splitchar=f,a[f]=e,a.splits.push(e));return g(e,b,d+1)?(c.push(b),!0):!1}if(5>a.strings.length){if(c.indexOf?0<=c.indexOf(b):q(c,b))return!1;c.push(b);return!0}a.splits=[];c=a.strings;for(f=0;f<c.length;)g(a,
c[f++],d);return g(a,b,d)}function c(a,b,d,f){f||(f=b.length);if(d===f)return a.strings;if(5>=a.strings.length){d=a.strings;f=[];for(a=0;a<d.length;){var e=d[a++];u(e,b)&&f.push(e)}return f.length?f:!1}return(a=a[b[d]])?c(a,b,d+1,f):!1}function b(a){return(a+"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var d=/[^ \n\r\t\f\x0b\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff]/g;a.nbsp="\u00a0";a.middot="\u00b7";
a.emdash="\u2013";a.endash="\u2014";a.lsq="\u2018";a.rsq="\u2019";a.ldq="\u201c";a.rdq="\u201d";a.truncate=function(a,b){b||(b=42);return a.length<b?a:a.slice(0,b)};var A=Math.floor;a.ellipsize=function(a,b,d){var c,f;"number"!==typeof d&&(d=.1);if(!b)return a;if("number"!==typeof b)if(b.constructor===Array)c=b[0]||0,f=b[1]||0,b=f+c;else return a;if(b){if(a.length<b+A(d*b))return a;if(c&&f){var e=a.length;0!==/\s/.test(a[c])&&(b=a.slice(0,c),d=b.search(/\s+\w+$/),c=0<d?d:c);0===/\s/.test(a[e-f])?
f=e-f:(b=a.slice(e-f),d=b.search(/\s+/),f=0<d?e-f+d:f);return[a.slice(0,c),a.slice(f)]}if(0===/\s/.test(a[b]))return a.slice(0,b);b=a.slice(0,b);d=b.search(/\s+\w+$/);return 0<d?b.slice(0,d):b}return a};a.isEmpty=function(a){if("string"===typeof a){var b;if(0===a.length)return!0;b=a.search(d);if(0>b)return!0;if("&"!==a[b])return!1;a=a.replace(/&nbsp;/g,"\u00a0");b=a.search(d);return 0>b}return!1};a.findSplit=function(a,b,d){for(var c=0;0<=(c=a.indexOf(b,c));)if(d&&0<c&&a[c-1]===d)c+=1;else return c;
return-1};a.split=function(a,b,d,c){if(c||d){for(var f=[],e=0,g;0<=(g=a.indexOf(b,e));)d&&0<g&&a[g-1]===d||(c&&g>e?f.push(c(a.slice(e,g))):g>e&&f.push(a.slice(e,g))),e=g+1;a.length>e&&(c?f.push(c(a.slice(e))):f.push(a.slice(e)));return f}return a.split(b)};a.semiSplit=function(a,b,d){if(d||b){for(var c=[],f=0,e;0<=(e=a.indexOf(";",f));)b&&0<e&&a[e-1]===b||(d&&e>f?c.push(d(a.slice(f,e))):e>f&&c.push(a.slice(f,e))),f=e+1;a.length>f&&(d?c.push(d(a.slice(f))):c.push(a.slice(f)));return c}return a.split(";")};
a.lineSplit=function(a,b,d){if(d||b){for(var c=[],f=0,e;0<=(e=a.indexOf("\n",f));)b&&0<e&&a[e-1]===b||(d&&e>f?c.push(d(a.slice(f,e))):e>f&&c.push(a.slice(f,e))),f=e+1;a.length>f&&(d?c.push(d(a.slice(f))):c.push(a.slice(f)));return c}return a.split("\n")};a.trim=h;a.stdspace=m;a.stdcap=function(a){if(!(0<=a.search(/(^|\s)[ABCDEFGHIJKLMNOPQRSTUVWXYZ]/g)))return a.replace(/\s+/g," ").replace(/(^ | $)/g,"");a=a.split(/\s+/g);for(var b=0,d=a.length;b<d;){var c=a[b];0<=c.slice(1).search(/[ABCDEFGHIJKLMNOPQRSTUVWXYZ]/)||
(a[b]=c[0].toUpperCase()+c.slice(1));b++}return a.join(" ")};a.flatten=function(a){return a.replace(/\s+/g," ")};a.oneline=function(a){a=h(a);return a.replace(/\s*[\f\n\r]+\s+/gm," //\u00b7 ").replace(/\s*[\f\n\r]+\s*/gm," // ").replace(/\s\s+/g,"")};a.stripMarkup=e;a.unEscape=function(a){return 0<=a.indexOf("\\")?a.replace(/\\(.)/g,"$1"):a};a.normString=function(a){return a.replace(/\W*\s\W*/g," ").toLowerCase()};var w={};a.entities=w;a.decodeEntities=function(a){return a.replace(/&#(\d+);/g,v).replace(/&#x([0123456789ABCDEFabcdef]+);/g,
k).replace(/&([abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.]+)/g,x).replace(/&([A-Za-z][A-Za-z0-9-_.]+;)/g,p)};a.expandEntities=function(a){return a.replace(/&([A-Za-z][A-Za-z0-9-_.]+);/g,p)};var f=/^\d+(\.\d+)$/;a.getMatch=function(a,b,d,c){a=b.exec(a);"undefined"===typeof d&&(d=0);return a&&a.length>d?c?a[d]:f.test(a[d])?parseFloat(a[d]):a[d]:!1};a.segment=function(a,b,d,c){d&&(a=a.slice(d));d=[];a=a.split(new RegExp("("+("string"===typeof b?b:b.source)+")","string"===typeof b?"":b.ignoreCase?
"i":""));b=0;for(var f=a.length,e=!1;b<f;){var g=a[b++],k=a[b++];!g||0>g.search(/\S/)||(g.length&&"\\"===g.slice(-1)&&(2>g.length||"\\"!==g.slice(-2,-1))?(g=g.slice(0,-1)+k,e=e?e+g:g):e?(c?d.push(e+g):d.push(m(e+g)),e=!1):c?d.push(g):d.push(m(g)))}return d};a.padNum=function(a,b,d){!d&&0>b&&(d=-b,b=0);b-=10>a?1:100>a?2:1E3>a?3:1E4>a?4:1E5>a?5:1E6>a?6:1E6>a?7:1E8>a?8:1E9>a?9:1E10>a?10:11;a=a.toString();var c=a.indexOf("."),f="",e="",g;if(d)if(0<=c&&c+d<a.length)a=a.slice(0,c+d+1);else if(0>c||a.length<
c+d+1)for(g=0,d=c+d+1-a.length,0>c&&(e+=".");g<d;)e+="0",g++;switch(b){case 0:f="";break;case 1:f="0";break;case 2:f="00";break;case 3:f="000";break;case 4:f="0000";break;case 5:f="00000";break;case 6:f="000000";break;case 7:f="0000000";break;case 8:f="00000000";break;case 9:f="000000000";break;case 10:f="0000000000";break;default:for(g=0;g<b;)f+="0",g++}return f+a+e};a.precString=function(a,b){var d=a.toString(),c="";if("number"===typeof b&&0<=b&&100>b){var f=d.indexOf(".");if(0<=f&&f+b<d.length)d=
d.slice(0,f+b+1);else if(0>f||d.length<f+b+1){var e=0,g=f+b+1-d.length;for(0>f&&(c=".");e<=g;)c+="0",e++}}return d+c};a.getInitials=function(a,b){for(var d=a.split(/\W/),c="",f=0,e=b&&b<d.length?b:d.length;f<e;){var g=d[f++];g.length&&(c+=g.slice(0,1))}return c};a.hasPrefix=u;a.hasSuffix=function(a,b){return a.lastIndexOf(b)===a.length-b.length};a.commonPrefix=function(a,b,d,c){for(var f=0,e=-1;f<a.length&&f<b.length;)if(a[f]===b[f]||c&&a[f].toLowerCase()===b[f].toLowerCase())d?(d===a[f]&&(e=f-1),
f++):e=f++;else break;return 0<=e?a.slice(0,e+1):!1};a.commonSuffix=function(a,b,d,c){for(var f=a.length,e=b.length,g=0;0<=f&&0<=e;)if(a[f]===b[e]||c&&a[f].toLowerCase()===b[f].toLowerCase())d?d===a[f]&&(g=f+1):g=f,f--,e--;else break;return 0<g?a.slice(g):!1};a.stripSuffix=function(a){var b=a.search(/\.\w+$/);return 0<b?a.slice(0,b):a};a.prefixAdd=function(a,b,d){if("number"!==typeof d||0>d)d=0;return g(a,b,d)};a.prefixFind=function(a,b,d,f){if("number"!==typeof d||0>d)d=0;f||(f=b.length);return c(a,
b,d,f)};a.paraHash=function(a){a=("string"===typeof a.innerText?a.innerText:e(a.innerHTML)).split(/\W*\S+\W*/g);var b=a.length;return"_H"+(0<b?a[0][0]:".")+(1<b?a[1][0]:".")+(2<b?a[2][0]:".")+(3<b?a[3][0]:".")+(0<b?a[b-1][0]:".")+(1<b?a[b-2][0]:".")+(2<b?a[b-3][0]:".")+(3<b?a[b-4][0]:".")};a.escapeRegExp=b;a.escapeRX=b;a.templates={};a.fillIn=function(a,b){var d=!1;if("string"===typeof b){var c=b;b=a;a=c}!a&&b&&b.template?a=b.template:!b&&a.template&&(b=a,a=b.template);if("string"!==typeof a)if(3===
a.nodeType)d=a,a=d.nodeValue;else if(1===a.nodeType)d=a,a=d.innerHTML;else{fdjt.Log.warn("Bad argument %o to Template",a);return}var c=a.match(/\{\{\w+(\|([^\}])*)?\}\}/gm),f={};if(c&&c.length)for(var e=0,g=c.length;e<g;){var k=c[e++].slice(2,-2),w=k.search(/\|/),t=0<=w?k.slice(0,w):k;f[k]||f[t]||(b.hasOwnProperty(t)?(w=b[t],f[t]=k,w&&(a=a.replace(new RegExp("\\{\\{"+t+"(\\|[^\\}]*)?\\}\\}","gm"),w.toString()))):0<w?(t=k.slice(w+1),a=a.replace("{{"+k+"}}",t),f[k]=k):fdjt.Log.warn("No data for %s in %j to substitute for %s",
t,b,"{{"+k+"}}"))}return d?(3===d.nodeType?d.nodeValue=a:d.innerHTML=a,d):a};return a}();fdjt.Time=function(){function a(){return(new Date).getTime()}function n(a){var e=new Date;"number"===typeof a&&(a=131592918600>a?new Date(1E3*a):new Date(a));if(43200<(e.getTime()-a.getTime())/1E3)return a.toDateString();var e=a.getHours(),h=a.getMinutes();return a.toDateString()+" ("+(10>e?"0":"")+e+":"+(0===h?"00":(10>h?"0":"")+h)+")"}var h=a.loaded=(new Date).getTime();a.tick=function(){return Math.floor((new Date).getTime()/1E3)};a.dateString=function(a){"number"===typeof a&&(a=131592918600>a?
new Date(1E3*a):new Date(a));return a.toDateString()};a.timeString=function(a){"number"===typeof a&&(a=131592918600>a?new Date(1E3*a):new Date(a));return a.toString()};a.shortString=n;a.tick2shortstring=function(a){return n(new Date(1E3*a))};var m=!1;a.compactString=function(a,e){"number"===typeof a&&(a=131592918600>a?new Date(1E3*a):new Date(a));var h=a.toLocaleDateString();"undefined"===typeof e&&(m?e=m:m=(new Date).toLocaleDateString());var u=h!==e,q=a.getHours(),g=a.getMinutes(),c=a.getSeconds();
return(u?h:"")+(u?" - ":"")+(10>q?"0":"")+q+":"+(0===g?"00":(10>g?"0":"")+g)+":"+(0===c?"00":(10>c?"0":"")+c)};a.tick2string=function(a){return(new Date(1E3*a)).toString()};a.tick2date=function(a){return(new Date(1E3*a)).toDateString()};a.tick2locale=function(a){return(new Date(1E3*a)).toLocaleString()};a.tick2time=function(a){return(new Date(1E3*a)).toTimeString()};var e=fdjt.String;a.secs2string=function(a){var h,p;if(1>a)return e("%f seconds",a);if(1===a)return e("%f second",a);if(10>a)return e("%f seconds",
a);if(60>a)return e("~%d seconds",Math.round(a/60));if(120>a)return h=Math.floor(a/60),a=Math.round(a-60*h),1===a?"one minute, one second":e("one minute, %d seconds",a);if(3600>a)return h=Math.floor(a/60),e("~%d minutes",h);if(7200>a)return h=Math.floor(a/3600),h=Math.round((a-3600*h)/60),1===h?"one hour and one minutes":e("one hour, %d minutes",h);if(86400>a)return h=Math.floor(a/3600),e("~%d hours",h);if(172800>a)return h=Math.floor((a-86400)/3600),1===h?"one day and one hour":e("one day, %d hours",
h);if(604800>a)return p=Math.floor(a/86400),e("%d days",p);if(1209600>a)return p=Math.floor((a-604800)/86400),1===p?"one week and one day":e("one week and %d days",p);h=Math.floor(a/604800);p=Math.round((a-604800*p)/604800);return e("%d weeks, %d days",h,p)};a.secs2short=function(a){if(.001>a)return Math.round(1E6*a)+"us";if(.1>a)return Math.round(1E3*a)+"ms";if(120>a)return Math.round(100*a)/100+"s";var e=Math.floor(a/60);return e+"m, "+Math.round(100*(a-60*e))/100+"s"};a.runTimes=function(a,e){for(var h=
e,u="",q=2;q<arguments.length;)var g=arguments[q++],c=arguments[q++],u=u+"; "+g+": "+(c.getTime()-h.getTime())/1E3+"s",h=c;return a+" "+(h.getTime()-e.getTime())/1E3+"s"+u};a.diffTime=function(a,e){e||(e=new Date);var h=a.getTime()-e.getTime();return 0<h?h/1E3:-(h/1E3)};a.ET=function(a){a||(a=new Date);return(a.getTime()-h)/1E3};var v=/(EST|EDT|PDT|PST|CST|CDT|ECT|GMT|Z|([+-]\d\d?(:\d+)?))$/i;a.parse=function(e){var h=!1;try{h=Date.parse?new Date(Date.parse(e)):new Date(e)}catch(m){fdjt.Log("Error parsing time '%s': %o",
e,m)}if(h instanceof Date&&!isNaN(h.getYear()))return h;h=e.search(v);if(0<h)return a.parse(e.slice(0,h));fdjt.Log("Couldn't parse time '%s'",e);return e};a.timeslice=fdjt.Async.timeslice;a.slowmap=fdjt.Async.slowmap;return a}();fdjt.ET=fdjt.Time.ET;fdjt.Template=function(){function a(h,m,e){var v=!1;if("string"===typeof m){var k=m;m=h;h=k}!h&&m&&m.template&&(h=m.template);if("string"!==typeof h)if(3===h.nodeType)v=h,h=v.nodeValue;else if(1===h.nodeType)v=h,h=v.innerHTML;else{fdjt.Log.warn("Bad argument %o to Template",h);return}a.localTemplates.hasOwnProperty(h)?h=a.localTemplates[h]:n.hasOwnProperty(h)&&(h=n[h]);var k=h.match(/\{\{\w+\}\}/gm),x={};if(k)for(var p=0,u=k.length;p<u;){var q=k[p++].slice(2,-2),g=new RegExp("\\{\\{"+q+"\\}\\}","gm");
if(!x[q])if(m.hasOwnProperty(q)||e&&e.hasOwnProperty(q)){var c=m[q]||e&&e[q]||"";x[q]=q;h=h.replace(g,c.toString())}else fdjt.Log.warn("No data for %s in %s to use in %s",q,m,h),x[q]=q}return v?(3===v.nodeType?v.nodeValue=h:v.innerHTML=h,v):h}var n={};fdjt.Templates=n;a.localTemplates={};a.toDOM=function(h,m,e){h=a(h,m);m=e?e.nodeType?e:"string"===typeof e?document.createElement(e):document.createElement("div"):document.createElement("div");m.innerHTML=h;if(e&&e.nodeType)return m;if(m.childNodes){if(1===
m.childNodes.length)return m.childNodes[0];e=document.createDocumentFragment;h=[];m=m.childNodes;for(var n=0,k=m.length;n<k;)h.push(m[n++]);for(n=0;n<k;)e.appendChild(h[n++]);return e}return!1};return a}();fdjt.Hash||(fdjt.Hash=function(){function a(a){var z=Array(a.length>>2),b;for(b=0;b<z.length;b++)z[b]=0;for(b=0;b<8*a.length;b+=8)z[b>>5]|=(a.charCodeAt(b/8)&255)<<24-b%32;return z}function n(a){for(var z="",b=0;b<32*a.length;b+=8)z+=String.fromCharCode(a[b>>5]>>>24-b%32&255);return z}function h(a,z){"undefined"===typeof z&&(z=r);for(var b=z?"0123456789ABCDEF":"0123456789abcdef",l="",d,c=0;c<a.length;c++)d=a.charCodeAt(c),l+=b.charAt(d>>>4&15)+b.charAt(d&15);return l}function m(a,z){z||(z=da);for(var b=
"",l=a.length,d=0;d<l;d+=3)for(var c=a.charCodeAt(d)<<16|(d+1<l?a.charCodeAt(d+1)<<8:0)|(d+2<l?a.charCodeAt(d+2):0),f=0;4>f;f++)b=8*d+6*f>8*a.length?b+z:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>>6*(3-f)&63);return b}function e(a,z){if(!z)return X?X(a):h(a);var b=z.length,l,d,c,f,e,r=Array(Math.ceil(a.length/2));for(l=0;l<r.length;l++)r[l]=a.charCodeAt(2*l)<<8|a.charCodeAt(2*l+1);var g=Math.ceil(8*a.length/(Math.log(z.length)/Math.log(2))),t=Array(g);for(d=0;d<
g;d++){e=[];for(l=f=0;l<r.length;l++)if(f=(f<<16)+r[l],c=Math.floor(f/b),f-=c*b,0<e.length||0<c)e[e.length]=c;t[d]=f;r=e}b="";for(l=t.length-1;0<=l;l--)b+=z.charAt(t[l]);return b}function v(a){for(var b="",l=-1,d,c;++l<a.length;)d=a.charCodeAt(l),c=l+1<a.length?a.charCodeAt(l+1):0,55296<=d&&56319>=d&&56320<=c&&57343>=c&&(d=65536+((d&1023)<<10)+(c&1023),l++),127>=d?b+=String.fromCharCode(d):2047>=d?b+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?b+=String.fromCharCode(224|d>>>12&15,128|d>>>
6&63,128|d&63):2097151>=d&&(b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return b}function k(a){var b=Array(a.length>>2),l;for(l=0;l<b.length;l++)b[l]=0;for(l=0;l<8*a.length;l+=8)b[l>>5]|=(a.charCodeAt(l/8)&255)<<l%32;return b}function x(a){for(var b="",l=0;l<32*a.length;l+=8)b+=String.fromCharCode(a[l>>5]>>>l%32&255);return b}function p(a,b){var l=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(l>>16)<<16|l&65535}function u(a,b){return a<<b|a>>>32-b}function q(a){return x(c(k(a),
8*a.length))}function g(a,b){var l=k(a);16<l.length&&(l=c(l,8*a.length));for(var d=Array(16),f=Array(16),e=0;16>e;e++)d[e]=l[e]^909522486,f[e]=l[e]^1549556828;l=c(d.concat(k(b)),512+8*b.length);return x(c(f.concat(l),640))}function c(a,z){a[z>>5]|=128<<z%32;a[(z+64>>>9<<4)+14]=z;for(var l=1732584193,c=-271733879,f=-1732584194,e=271733878,r=0;r<a.length;r+=16)var g=l,t=c,B=f,h=e,l=d(l,c,f,e,a[r+0],7,-680876936),e=d(e,l,c,f,a[r+1],12,-389564586),f=d(f,e,l,c,a[r+2],17,606105819),c=d(c,f,e,l,a[r+3],22,
-1044525330),l=d(l,c,f,e,a[r+4],7,-176418897),e=d(e,l,c,f,a[r+5],12,1200080426),f=d(f,e,l,c,a[r+6],17,-1473231341),c=d(c,f,e,l,a[r+7],22,-45705983),l=d(l,c,f,e,a[r+8],7,1770035416),e=d(e,l,c,f,a[r+9],12,-1958414417),f=d(f,e,l,c,a[r+10],17,-42063),c=d(c,f,e,l,a[r+11],22,-1990404162),l=d(l,c,f,e,a[r+12],7,1804603682),e=d(e,l,c,f,a[r+13],12,-40341101),f=d(f,e,l,c,a[r+14],17,-1502002290),c=d(c,f,e,l,a[r+15],22,1236535329),l=A(l,c,f,e,a[r+1],5,-165796510),e=A(e,l,c,f,a[r+6],9,-1069501632),f=A(f,e,l,c,
a[r+11],14,643717713),c=A(c,f,e,l,a[r+0],20,-373897302),l=A(l,c,f,e,a[r+5],5,-701558691),e=A(e,l,c,f,a[r+10],9,38016083),f=A(f,e,l,c,a[r+15],14,-660478335),c=A(c,f,e,l,a[r+4],20,-405537848),l=A(l,c,f,e,a[r+9],5,568446438),e=A(e,l,c,f,a[r+14],9,-1019803690),f=A(f,e,l,c,a[r+3],14,-187363961),c=A(c,f,e,l,a[r+8],20,1163531501),l=A(l,c,f,e,a[r+13],5,-1444681467),e=A(e,l,c,f,a[r+2],9,-51403784),f=A(f,e,l,c,a[r+7],14,1735328473),c=A(c,f,e,l,a[r+12],20,-1926607734),l=b(c^f^e,l,c,a[r+5],4,-378558),e=b(l^c^
f,e,l,a[r+8],11,-2022574463),f=b(e^l^c,f,e,a[r+11],16,1839030562),c=b(f^e^l,c,f,a[r+14],23,-35309556),l=b(c^f^e,l,c,a[r+1],4,-1530992060),e=b(l^c^f,e,l,a[r+4],11,1272893353),f=b(e^l^c,f,e,a[r+7],16,-155497632),c=b(f^e^l,c,f,a[r+10],23,-1094730640),l=b(c^f^e,l,c,a[r+13],4,681279174),e=b(l^c^f,e,l,a[r+0],11,-358537222),f=b(e^l^c,f,e,a[r+3],16,-722521979),c=b(f^e^l,c,f,a[r+6],23,76029189),l=b(c^f^e,l,c,a[r+9],4,-640364487),e=b(l^c^f,e,l,a[r+12],11,-421815835),f=b(e^l^c,f,e,a[r+15],16,530742520),c=b(f^
e^l,c,f,a[r+2],23,-995338651),l=w(l,c,f,e,a[r+0],6,-198630844),e=w(e,l,c,f,a[r+7],10,1126891415),f=w(f,e,l,c,a[r+14],15,-1416354905),c=w(c,f,e,l,a[r+5],21,-57434055),l=w(l,c,f,e,a[r+12],6,1700485571),e=w(e,l,c,f,a[r+3],10,-1894986606),f=w(f,e,l,c,a[r+10],15,-1051523),c=w(c,f,e,l,a[r+1],21,-2054922799),l=w(l,c,f,e,a[r+8],6,1873313359),e=w(e,l,c,f,a[r+15],10,-30611744),f=w(f,e,l,c,a[r+6],15,-1560198380),c=w(c,f,e,l,a[r+13],21,1309151649),l=w(l,c,f,e,a[r+4],6,-145523070),e=w(e,l,c,f,a[r+11],10,-1120210379),
f=w(f,e,l,c,a[r+2],15,718787259),c=w(c,f,e,l,a[r+9],21,-343485551),l=p(l,g),c=p(c,t),f=p(f,B),e=p(e,h);return[l,c,f,e]}function b(a,l,b,d,c,f){return p(u(p(p(l,a),p(d,f)),c),b)}function d(a,l,d,c,f,e,r){return b(l&d|~l&c,a,l,f,e,r)}function A(a,l,d,c,f,e,r){return b(l&c|d&~c,a,l,f,e,r)}function w(a,l,c,d,f,e,r){return b(c^(l|~d),a,l,f,e,r)}function f(a){return x(J(k(a),8*a.length))}function D(a,l){var b=k(a);16<b.length&&(b=J(b,8*a.length));for(var c=Array(16),d=Array(16),f=0;16>f;f++)c[f]=b[f]^909522486,
d[f]=b[f]^1549556828;b=J(c.concat(k(l)),512+8*l.length);return x(J(d.concat(b),672))}function J(a,l){a[l>>5]|=128<<l%32;a[(l+64>>>9<<4)+14]=l;for(var b=1732584193,c=4023233417,d=2562383102,f=271733878,e=3285377520,r=0;r<a.length;r+=16){for(var g,t=b,B=c,h=d,w=f,X=e,V=b,A=c,N=d,da=f,k=e,q=0;79>=q;++q)g=p(t,G(q,B,h,w)),g=p(g,a[r+S[q]]),g=p(g,0<=q&&15>=q?0:16<=q&&31>=q?1518500249:32<=q&&47>=q?1859775393:48<=q&&63>=q?2400959708:64<=q&&79>=q?2840853838:"rmd160_K1: j out of range"),g=p(u(g,ga[q]),X),t=
X,X=w,w=u(h,10),h=B,B=g,g=p(V,G(79-q,A,N,da)),g=p(g,a[r+oa[q]]),g=p(g,0<=q&&15>=q?1352829926:16<=q&&31>=q?1548603684:32<=q&&47>=q?1836072691:48<=q&&63>=q?2053994217:64<=q&&79>=q?0:"rmd160_K2: j out of range"),g=p(u(g,ca[q]),k),V=k,k=da,da=u(N,10),N=A,A=g;g=p(c,p(h,da));c=p(d,p(w,k));d=p(f,p(X,V));f=p(e,p(t,A));e=p(b,p(B,N));b=g}return[b,c,d,f,e]}function G(a,l,b,c){return 0<=a&&15>=a?l^b^c:16<=a&&31>=a?l&b|~l&c:32<=a&&47>=a?(l|~b)^c:48<=a&&63>=a?l&c|b&~c:64<=a&&79>=a?l^(b|~c):"rmd160_f: j out of range"}
function y(l){return n(F(a(l),8*l.length))}function E(l,b){var c=a(l);16<c.length&&(c=F(c,8*l.length));for(var d=Array(16),f=Array(16),e=0;16>e;e++)d[e]=c[e]^909522486,f[e]=c[e]^1549556828;c=F(d.concat(a(b)),512+8*b.length);return n(F(f.concat(c),672))}function F(a,l){a[l>>5]|=128<<24-l%32;a[(l+64>>9<<4)+15]=l;for(var b=Array(80),c=1732584193,d=-271733879,f=-1732584194,e=271733878,r=-1009589776,g=0;g<a.length;g+=16){for(var t=c,B=d,h=f,w=e,X=r,q=0;80>q;q++){b[q]=16>q?a[g+q]:u(b[q-3]^b[q-8]^b[q-14]^
b[q-16],1);var V=u(c,5),A;A=20>q?d&f|~d&e:40>q?d^f^e:60>q?d&f|d&e|f&e:d^f^e;V=p(p(V,A),p(p(r,b[q]),20>q?1518500249:40>q?1859775393:60>q?-1894007588:-899497514));r=e;e=f;f=u(d,30);d=c;c=V}c=p(c,t);d=p(d,B);f=p(f,h);e=p(e,w);r=p(r,X)}return[c,d,f,e,r]}function O(l){return n(t(a(l),8*l.length))}function M(l,b){var c=a(l);16<c.length&&(c=t(c,8*l.length));for(var d=Array(16),f=Array(16),e=0;16>e;e++)d[e]=c[e]^909522486,f[e]=c[e]^1549556828;c=t(d.concat(a(b)),512+8*b.length);return n(t(f.concat(c),768))}
function I(a,l){return a>>>l|a<<32-l}function t(a,l){var b=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],c=Array(64),d,f,e,r,g,t,B,h,w,q,X,V;a[l>>5]|=128<<24-l%32;a[(l+64>>9<<4)+15]=l;for(w=0;w<a.length;w+=16){d=b[0];f=b[1];e=b[2];r=b[3];g=b[4];t=b[5];B=b[6];h=b[7];for(q=0;64>q;q++){if(16>q)c[q]=a[q+w];else{X=q;V=c[q-2];V=I(V,17)^I(V,19)^V>>>10;V=p(V,c[q-7]);var A;A=c[q-15];A=I(A,7)^I(A,18)^A>>>3;c[X]=p(p(V,A),c[q-16])}X=g;X=I(X,6)^I(X,11)^I(X,25);X=p(p(p(p(h,
X),g&t^~g&B),Ma[q]),c[q]);h=d;h=I(h,2)^I(h,13)^I(h,22);V=p(h,d&f^d&e^f&e);h=B;B=t;t=g;g=p(r,X);r=e;e=f;f=d;d=p(X,V)}b[0]=p(d,b[0]);b[1]=p(f,b[1]);b[2]=p(e,b[2]);b[3]=p(r,b[3]);b[4]=p(g,b[4]);b[5]=p(t,b[5]);b[6]=p(B,b[6]);b[7]=p(h,b[7])}return b}function T(l){return n(P(a(l),8*l.length))}function K(l,b){var c=a(l);32<c.length&&(c=P(c,8*l.length));for(var d=Array(32),f=Array(32),e=0;32>e;e++)d[e]=c[e]^909522486,f[e]=c[e]^1549556828;c=P(d.concat(a(b)),1024+8*b.length);return n(P(f.concat(c),1536))}function P(a,
b){void 0===l&&(l=[new C(1116352408,-685199838),new C(1899447441,602891725),new C(-1245643825,-330482897),new C(-373957723,-2121671748),new C(961987163,-213338824),new C(1508970993,-1241133031),new C(-1841331548,-1357295717),new C(-1424204075,-630357736),new C(-670586216,-1560083902),new C(310598401,1164996542),new C(607225278,1323610764),new C(1426881987,-704662302),new C(1925078388,-226784913),new C(-2132889090,991336113),new C(-1680079193,633803317),new C(-1046744716,-815192428),new C(-459576895,
-1628353838),new C(-272742522,944711139),new C(264347078,-1953704523),new C(604807628,2007800933),new C(770255983,1495990901),new C(1249150122,1856431235),new C(1555081692,-1119749164),new C(1996064986,-2096016459),new C(-1740746414,-295247957),new C(-1473132947,766784016),new C(-1341970488,-1728372417),new C(-1084653625,-1091629340),new C(-958395405,1034457026),new C(-710438585,-1828018395),new C(113926993,-536640913),new C(338241895,168717936),new C(666307205,1188179964),new C(773529912,1546045734),
new C(1294757372,1522805485),new C(1396182291,-1651133473),new C(1695183700,-1951439906),new C(1986661051,1014477480),new C(-2117940946,1206759142),new C(-1838011259,344077627),new C(-1564481375,1290863460),new C(-1474664885,-1136513023),new C(-1035236496,-789014639),new C(-949202525,106217008),new C(-778901479,-688958952),new C(-694614492,1432725776),new C(-200395387,1467031594),new C(275423344,851169720),new C(430227734,-1194143544),new C(506948616,1363258195),new C(659060556,-544281703),new C(883997877,
-509917016),new C(958139571,-976659869),new C(1322822218,-482243893),new C(1537002063,2003034995),new C(1747873779,-692930397),new C(1955562222,1575990012),new C(2024104815,1125592928),new C(-2067236844,-1578062990),new C(-1933114872,442776044),new C(-1866530822,593698344),new C(-1538233109,-561857047),new C(-1090935817,-1295615723),new C(-965641998,-479046869),new C(-903397682,-366583396),new C(-779700025,566280711),new C(-354779690,-840897762),new C(-176337025,-294727304),new C(116418474,1914138554),
new C(174292421,-1563912026),new C(289380356,-1090974290),new C(460393269,320620315),new C(685471733,587496836),new C(852142971,1086792851),new C(1017036298,365543100),new C(1126000580,-1676669620),new C(1288033470,-885112138),new C(1501505948,-60457430),new C(1607167915,987167468),new C(1816402316,1246189591)]);var c=[new C(1779033703,-205731576),new C(-1150833019,-2067093701),new C(1013904242,-23791573),new C(-1521486534,1595750129),new C(1359893119,-1377402159),new C(-1694144372,725511199),new C(528734635,
-79577749),new C(1541459225,327033209)],d=new C(0,0),f=new C(0,0),e=new C(0,0),r=new C(0,0),g=new C(0,0),t=new C(0,0),h=new C(0,0),q=new C(0,0),w=new C(0,0),X=new C(0,0),A=new C(0,0),u=new C(0,0),da=new C(0,0),k=new C(0,0),y=new C(0,0),G=new C(0,0),E=new C(0,0),I,F,m=Array(80);for(F=0;80>F;F++)m[F]=new C(0,0);a[b>>5]|=128<<24-(b&31);a[(b+128>>10<<5)+31]=b;for(F=0;F<a.length;F+=32){U(e,c[0]);U(r,c[1]);U(g,c[2]);U(t,c[3]);U(h,c[4]);U(q,c[5]);U(w,c[6]);U(X,c[7]);for(I=0;16>I;I++)m[I].h=a[F+2*I],m[I].l=
a[F+2*I+1];for(I=16;80>I;I++){V(y,m[I-2],19);B(G,m[I-2],29);var p=E,S=m[I-2];p.l=S.l>>>6|S.h<<26;p.h=S.h>>>6;u.l=y.l^G.l^E.l;u.h=y.h^G.h^E.h;V(y,m[I-15],1);V(G,m[I-15],8);p=E;S=m[I-15];p.l=S.l>>>7|S.h<<25;p.h=S.h>>>7;A.l=y.l^G.l^E.l;A.h=y.h^G.h^E.h;var p=m[I],n=m[I-7],M=m[I-16],S=(u.l&65535)+(n.l&65535)+(A.l&65535)+(M.l&65535),K=(u.l>>>16)+(n.l>>>16)+(A.l>>>16)+(M.l>>>16)+(S>>>16),P=(u.h&65535)+(n.h&65535)+(A.h&65535)+(M.h&65535)+(K>>>16),n=(u.h>>>16)+(n.h>>>16)+(A.h>>>16)+(M.h>>>16)+(P>>>16);p.l=
S&65535|K<<16;p.h=P&65535|n<<16}for(I=0;80>I;I++)da.l=h.l&q.l^~h.l&w.l,da.h=h.h&q.h^~h.h&w.h,V(y,h,14),V(G,h,18),B(E,h,9),u.l=y.l^G.l^E.l,u.h=y.h^G.h^E.h,V(y,e,28),B(G,e,2),B(E,e,7),A.l=y.l^G.l^E.l,A.h=y.h^G.h^E.h,k.l=e.l&r.l^e.l&g.l^r.l&g.l,k.h=e.h&r.h^e.h&g.h^r.h&g.h,p=d,n=l[I],M=m[I],S=(X.l&65535)+(u.l&65535)+(da.l&65535)+(n.l&65535)+(M.l&65535),K=(X.l>>>16)+(u.l>>>16)+(da.l>>>16)+(n.l>>>16)+(M.l>>>16)+(S>>>16),P=(X.h&65535)+(u.h&65535)+(da.h&65535)+(n.h&65535)+(M.h&65535)+(K>>>16),n=(X.h>>>16)+
(u.h>>>16)+(da.h>>>16)+(n.h>>>16)+(M.h>>>16)+(P>>>16),p.l=S&65535|K<<16,p.h=P&65535|n<<16,N(f,A,k),U(X,w),U(w,q),U(q,h),N(h,t,d),U(t,g),U(g,r),U(r,e),N(e,d,f);N(c[0],c[0],e);N(c[1],c[1],r);N(c[2],c[2],g);N(c[3],c[3],t);N(c[4],c[4],h);N(c[5],c[5],q);N(c[6],c[6],w);N(c[7],c[7],X)}d=Array(16);for(F=0;8>F;F++)d[2*F]=c[F].h,d[2*F+1]=c[F].l;return d}function C(a,l){this.h=a;this.l=l}function U(a,l){a.h=l.h;a.l=l.l}function V(a,l,b){a.l=l.l>>>b|l.h<<32-b;a.h=l.h>>>b|l.l<<32-b}function B(a,l,b){a.l=l.h>>>
b|l.l<<32-b;a.h=l.l>>>b|l.h<<32-b}function N(a,l,b){var c=(l.l&65535)+(b.l&65535),d=(l.l>>>16)+(b.l>>>16)+(c>>>16),f=(l.h&65535)+(b.h&65535)+(d>>>16);l=(l.h>>>16)+(b.h>>>16)+(f>>>16);a.l=c&65535|d<<16;a.h=f&65535|l<<16}var r=0,da="",X=!1,S=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],oa=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,
12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],ga=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],ca=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,
9,12,5,14,6,8,13,6,5,15,13,11,11],Ma=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,
-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],l;return{_get_hexcase_:function(){return r},_set_hexcase_:function(a){r=a},_get_padchar_:function(){return da},_set_padchar_:function(a){da=a},_get_outenc_:function(){},_set_outenc_:function(a){X="string"===typeof a?fdjt.Hash[a]||!1:a},hex:h,b64:"rst2b64",base64:"rst2b64",
array:k,binl:k,hex_md5:function(a){return h(q(v(a)))},b64_md5:function(a){return m(q(v(a)))},md5:function(a,l){return e(q(v(a)),l)},hex_hmac_md5:function(a,l){return h(g(v(a),v(l)))},b64_hmac_md5:function(a,l){return m(g(v(a),v(l)))},hmac_md5:function(a,l,b){return e(g(v(a),v(l)),b)},hex_rmd160:function(a){return h(f(v(a)))},b64_rmd160:function(a){return m(f(v(a)))},rmd160:function(a,l){return e(f(v(a)),l)},hex_hmac_rmd160:function(a,l){return h(D(v(a),v(l)))},b64_hmac_rmd160:function(a,l){return m(D(v(a),
v(l)))},hmac_rmd160:function(a,l,b){return e(D(v(a),v(l)),b)},hex_sha1:function(a){return h(y(v(a)))},b64_sha1:function(a){return m(y(v(a)))},sha1:function(a,l){return e(y(v(a)),l)},hex_hmac_sha1:function(a,l){return h(E(v(a),v(l)))},b64_hmac_sha1:function(a,l){return m(E(v(a),v(l)))},hmac_sha1:function(a,l,b){return e(E(v(a),v(l)),b)},hex_sha256:function(a){return h(O(v(a)))},b64_sha256:function(a){return m(O(v(a)))},sha256:function(a,l){return e(O(v(a)),l)},hex_hmac_sha256:function(a,l){return h(M(v(a),
v(l)))},b64_hmac_sha256:function(a,l){return m(M(v(a),v(l)))},hmac_sha256:function(a,l,b){return e(M(v(a),v(l)),b)},hex_sha512:function(a){return h(T(v(a)))},b64_sha512:function(a){return m(T(v(a)))},sha512:function(a,l){return e(T(v(a)),l)},hex_hmac_sha512:function(a,l){return h(K(v(a),v(l)))},b64_hmac_sha512:function(a,l){return m(K(v(a),v(l)))},hmac_sha512:function(a,l,b){return e(K(v(a),v(l)),b)}}}());fdjt.Log=function(){function a(x){var p=!1,u=k(),q=new Date;(a.doformat||x.search("%j"))&&"undefined"!==typeof h&&(p=h.apply(null,arguments));a.console_fn&&(p?a.console_fn.call(a.console,p):a.console_fn.apply(a.console,arguments));if(a.logurl){var g="["+u+"s "+v(q,!1)+"] "+h.apply(null,arguments);window.console&&window.console.log("remote logging %s",g);var c=new XMLHttpRequest;c.open("POST",a.logurl,!a.logsync);c.setRequestHeader("Content-type","text; charset=utf-8");c.send(g)}if(a.console){var g=
a.console,c=fdjt.DOM("span.time",u),b=fdjt.DOM("span.abstime",v(q)),q=fdjt.DOM("div.fdjtlog");q.innerHTML=p?p:h.apply(null,arguments);fdjt.DOM.prepend(q,c);fdjt.DOM.prepend(q,b);"string"===typeof g&&(g=(g=document.getElementById(g))?a.console=g:!1);g&&!g.nodeType&&(g=!1);g&&a.livelog?(n(g),g.appendChild(q),g.appendChild(document.createTextNode("\n"))):g&&0!==g.offsetHeight?(n(g),g.appendChild(q),g.appendChild(document.createTextNode("\n"))):m.push(q)}if(a.useconsole||!a.console&&!a.console_fn){if("undefined"===
typeof e)if(window.console&&window.console.log)if(window.console.count)e=!0;else{e=!0;try{window.console.log("Testing console")}catch(d){e=!1}}else e=!1;if(e)if(window.console.log.call)if(p)window.console.log.call(window.console,"["+u+"s] "+p);else{p=Array(arguments.length+1);p[0]="[%fs] "+x;p[1]=u;u=1;for(q=arguments.length;u<q;)p[u+1]=arguments[u],u++;window.console.log.apply(window.console,p)}else window.console.log("["+u+"s] "+h.apply(null,arguments))}}function n(a){if(m&&m.length){var e=document.createDocumentFragment(),
h=m;m=!1;for(var q=0,g=h.length;q<g;)e.appendChild(h[q++]),e.appendChild(document.createTextNode("\n"));a.appendChild(e);m=[]}}var h=fdjt.String,m=[],e,v=fdjt.Time.compactString,k=fdjt.ET;a.console=null;a.update=function(){a.console&&n(a.console)};a.warn=function(){if(!a.console_fn&&!window.console&&window.console.log&&window.console.log.count){var e=h.apply(null,arguments);window.alert(e)}else a.apply(null,arguments)};a.uhoh=function(){a.debugging&&a.warn.call(null,arguments)};a.bkpt=function(){var e=
!1;a.doformat&&"undefined"!==typeof h&&(e=h.apply(null,arguments));a.console_fn?e?a.console_fn(a.console,e):a.console_fn.apply(a.console,arguments):window.console&&window.console.log&&window.console.count&&(e?window.console.log.call(window.console,e):window.console.log.apply(window.console,arguments))};a.useconsole=!0;fdjt.Trace=fdjt.Log;a.getBacklog=function(){return m};return a}(window,document);(function(){function a(a,c,b){a=c.exec(a);"undefined"===typeof b&&(b=0);return a&&a.length>b?a[b]:!1}function n(a){a=a.replace(/\s+/g," ");var c=0,b=a.length;if(0>=b)return a;for(;c<b&&-1<"\n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(c));)c++;if(c===b)return"";for(var d=b-1;d>c&&-1<"\n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(d));)d--;
return 0<c||d<b?a.slice(c,d+1):a}function h(a){if("number"!==typeof a&&"string"===typeof a){a.indexOf("_")&&(a=a.replace(/_/g,"."));if(!/^\d+\.?$/.exec(a))if(u.exec(a))a=u.exec(a)[1];else return a;try{return parseFloat(a)||a}catch(c){return a}}else return a}function m(){if(!fdjt.device||!fdjt.device.started){var g=window.navigator,c=g.userAgent,b=a(c,/\bAndroid +(\d+\.\d+)\b/g,1),d=a(c,/\bAppleWebKit\/(\d+\.\d+)\b/g,1),A=a(c,/\bGecko\/(\d+)\b/gi,1,!0),w=a(c,/\bChrome\/(\d+\.\d+(.\d+)*)\b/g,1),f=a(c,
/\bFirefox\/(\d+\.\d+(.\d+)*)\b/gi,1),u=a(c,/\bSafari\/(\d+\.\d+(.\d+)*)\b/gi,1),k=a(c,/\bMac OS X \/(\d+\_\d+)\b/gi,1,!0),G=u&&a(c,/\bMobile\/(\w+)\b/gi,1,!0),y=d&&a(c,/\bMobile\/(\w+)\b/gi,1,!0),E=a(c,/\bMobile\/(\w+)\b/gi,1,!0),F=a(c,/\bVersion\/(\d+\.\d+)\b/gi,1),m=a(c,/\bOS (\d+_\d+(_\d)*)\b/gi,1),p=/ubuntu/gi.test(c),I=/redhat/gi.test(c),t=/linux/gi.test(c),v=/Macintosh/gi.test(c),K=/Touchpad/gi.test(c),P=/iphone/gi.test(c),C=/ipad/gi.test(c),x=P||C||b||K,c=(P||C)&&(a(c,/\bVersion\/(\d+\.\d+)\b/gi,
1)||!0),A=n((b?" Android/"+b:"")+(d?" WebKit/"+d:"")+(A?" Gecko/"+A:"")+(w?" Chrome/"+w:"")+(f?" Firefox/"+f:"")+(u?" Safari/"+u:"")+(G?" MobileSafari/"+G:"")+(y?" MobileWebKit/"+y:"")+(c?" IOS/"+c:"")+(k?" OSX/"+k:"")+(g.platform?" "+g.platform:"")+(P?" iPhone":"")+(C?" iPad":"")+(K?" TouchPad":"")+(x?" touch":" mouse"));g.vendor&&(q.vendor=g.vendor);g.platform&&(q.platform=g.platform);g.oscpu&&(q.oscpu=g.oscpu);g.cookieEnabled&&(q.cookies=g.cookieEnabled);g.doNotTrack&&(q.notrack=g.doNotTrack);
g.standalone&&(q.standalone=g.standalone);q.string=A;b&&(q.android=h(b),q.android_version=b);c&&(q.ios=h(m)||c,q.ios_version=c,P&&(q.iphone=c),C&&(q.ipad=c));w&&(q.chrome_version=w,q.chrome=h(w));C&&(q.iPad=!0);P&&(q.iPhone=!0);k&&(q.osx=h(k),q.osx_version=k);d&&(q.webkit=h(d),q.webkit_version=d);u&&(q.safari=h(u),q.safari_version=u);G&&(q.mobilesafari_version=G,q.mobilesafari=h(G));y&&(q.mobilewebkit_version=y,q.mobilewebkit=h(y));E&&(q.mobile=E);F&&(q.version=F);v&&(q.isMacintosh=!0);p&&(q.ubuntu=
!0);I&&(q.redhat=!0);t&&(q.linux=!0);x?q.touch=!0:q.mouse=!0;e("Device: %j",q)}}var e=fdjt.Log,v=!1,k=[],x=[],p={};fdjt.addInit=function(a,c,b){var d;a&&a.call?d=!0:(e.warn("Bad argument to addInit(): %s",c||"anonymous",a),d=!1);if(d){d=c&&p[c];for(var h=0,q=k.length;h<q;){if(d&&k[h]===d||k[h]===a){v?(e.warn("Replacing init %s which has already run",c),b&&(e.warn("Running the new version"),k[h]=a,c&&(p[c]=a),a())):(k[h]=a,c&&(p[c]=a));return}h++}c&&(p[c]=a);k.push(a);v?(a(),x.push(!0)):x.push(!1)}};
fdjt.Init=function(){var a=[];if(v)return!1;for(var c in p)p.hasOwnProperty(c)&&a.push(c);0===a.length?e("Running %d DOM inits",k.length):a.length===k.length?e("Running %d DOM inits (%s)",k.length,a.join()):e("Running %d DOM inits (including %s)",k.length,a.join());a=0;for(c=k.length;a<c;)x[a]||(x[a]=!0,k[a]()),a++;v=!0};var u=/^(\d+(\.\d+)).*/,q=fdjt.device||(fdjt.device={});"undefined"!==typeof window&&window.navigator&&window.navigator.appVersion&&m()})();fdjt.State=function(){function a(b,c,d){if(1===arguments.length)return window.sessionStorage&&v(b)||window.sessionStorage&&p(b)||n(b);if(d)if(window.localStorage)c?x(b,c):u(b);else{var f=a.domain||location.hostname,g=a.path||"/",q=a.duration||220752E3;c?h(b,c,q,g,f):m(b,g,f)}else c?window.sessionStorage?e(b,c):h(b,c):window.sessionStorage?k(b):m(b)}function n(a,b){try{var c=document.cookie,d=c.search(new RegExp("(^|(; ))"+a+"=","g")),f;if(0<=d){var e=c.indexOf("=",d)+1,g=c.indexOf(";",e);f=0<g?c.slice(e,
g):c.slice(e)}else return!1;return b?JSON.parse(decodeURIComponent(f)):decodeURIComponent(f)}catch(t){return!1}}function h(a,b,c,f,e){try{if(b){var g="string"===typeof b?b:b.toJSON?b.toJSON():b.toString?b.toString():b,h=a+"="+encodeURIComponent(g);if(c)if("string"===typeof c)h=h+"; "+c;else if(c.toGMTString)h=h+"; expires="+c.toGMTString();else if("number"===typeof c)if(0<c){var t=new Date;t.setTime(t.getTime()+c);h=h+"; expires="+t.toGMTString}else h+="; expires=Sun 1 Jan 2000 00:00:00 UTC";f&&(h=
h+"; path="+f);e&&(h=h+"; domain="+e);document.cookie=h}else m(a,f,e)}catch(q){d.warn("Error setting cookie %s",a)}}function m(a,b,c){try{var f=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT";b&&(f=f=f+"; path="+b);c&&(f=f=f+"; domain="+c);document.cookie=f}catch(e){d.warn("Error clearing cookie %s: %s",a,e)}n(a)&&(a=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie=a)}function e(a,b,c){c&&(b=JSON.stringify(b));window.sessionStorage?window.sessionStorage[a]=
b:h(a,b)}function v(a,b){var c=window.sessionStorage?window.sessionStorage[a]:n(a);return c?b?JSON.parse(c):c:!1}function k(a){if(window.sessionStorage)return window.sessionStorage.removeItem(a);m(a)}function x(a,b,c){if(!a)throw{error:"bad name",name:a};if("undefined"===typeof b)throw{error:"undefined value",name:a};if(b){if(c&&(b=JSON.stringify(b)),window.localStorage)if(a instanceof RegExp){c=[];for(var d=window.localStorage,f=0,e=d.length;f<e;){var g=d.key(f++);0<=g.search(a)&&c.push(g)}f=0;for(e=
c.length;f<e;)d[c[f++]]=b}else window.localStorage[a]=b}else u(a)}function p(a,b){if(a){if(window.localStorage){if(a instanceof RegExp){for(var c=window.localStorage,d=0,f=c.length;d<f;){var e=c.key(d++);if(0<=e.search(a))return b?JSON.parse(c[e]):c[e]}return!1}return(c=window.localStorage[a])?b?JSON.parse(c):c:!1}return!1}throw{error:"bad name",name:a};}function u(a){if(window.localStorage)if(a instanceof RegExp){for(var b=[],c=window.localStorage,d=0,f=c.length;d<f;){var e=c.key(d++);0<=e.search(a)&&
b.push(e)}d=0;for(f=b.length;d<f;)c.removeItem(b[d++])}else return window.localStorage.removeItem(a);else return!1}function q(a,b,c,d,f,e){var h=[];b=encodeURIComponent(b);d=new RegExp("(&|^)"+b+"(=|&|$)",d?"g":"gi");for(e=a.search(d);0<=e;){var t=e+b.length,q=a.slice(t+1),w=q.search(/(&|$)/g);if("="===a[t]){if(0>=w?h.push(""):(h.push(q.slice(0,w)),w=w+t+1),!c)break}else if(c)h.push(a.slice(e,w));else return f?a.slice(e,w):g(a.slice(e,w));0<w&&(a=a.slice(w),e=a.search(d))}if(!f)for(a=0,f=h.length;a<
f;)h[a]=g(h[a]),a++;return c?h:h.length?h[0]:!1}function g(a){return decodeURIComponent?decodeURIComponent(a):a.replace(/%3A/gi,":").replace(/%2F/gi,"/").replace(/%3F/gi,"?").replace(/%3D/gi,"=").replace(/%20/gi," ").replace(/%40/gi,"@").replace(/%23/gi,"#")}function c(a){if(a){if("string"===typeof a)return new RegExp("\\b"+a+"\\b","gi");if(a.length){for(var b="\\b(",c=0;c<a.length;){var d=a[c];0<c&&(b+="|");b=b+"("+d+")";c++}return new RegExp(b+")\\b","gi")}return!1}return a}function b(a,b){return a.length===
b?a:a.length>b?a.slice(0,b):"000000000000000000000000000000000000000000000000000000000000000".slice(0,b-a.length)+a}var d=fdjt.Log,A=fdjt.String;a.domain=!1;a.path=!1;a.duration=!1;a.getCookie=n;a.setCookie=h;a.clearCookie=m;a.setSession=e;a.getSession=v;a.existsSession=function(a){if(a){if(window.sessionStorage){if(a instanceof RegExp){for(var b=window.sessionStorage,c=0,d=b.length;c<d;)if(0<=b.key(c++).search(a))return!0;return!1}return"undefined"===typeof window.sessionStorage[a]?!1:!0}return!1}throw{error:"bad name",
name:a};};a.dropSession=k;a.clearSession=function(){if(window.sessionStorage){for(var a=window.localStorage,b=0,c=a.length,d=[];b<c;)d.push(a.key(b++));for(b=0;b<c;)a.removeItem(d[b++])}};a.listSession=function(a){var b=[];"string"===typeof a&&(a=new RegExp("^"+A.escapeRX(a),"g"));if(window.sessionStorage){var c=window.sessionStorage,d=0,f=c.length,e=!1;if(!a)for(;d<f;)b.push(c.key(d++));else if(a instanceof RegExp)for(;d<f;)e=c.key(d++),0<=e.search(a)&&b.push(e)}return b};a.setLocal=x;a.getLocal=
p;a.pushLocal=function(a,b){if(!a)throw{error:"bad name",name:a};var c=window.localStorage[a],d=!1;if(c)if(d=JSON.parse(c),Array.isArray(d)||(d=[d]),0>d.indexOf(b))d.push(b);else return!1;else d=[b];window.localStorage[a]=JSON.stringify(d);return!0};a.removeLocal=function(a,b){if(!a)throw{error:"bad name",name:a};var c=window.localStorage[a];if(c){var c=JSON.parse(c),d;if(c===b){u(a);return}if(Array.isArray(c))d=c.indexOf(b);else return;if(0>d)return;c.splice(d,1);window.localStorage[a]=JSON.stringify(c)}return!0};
a.existsLocal=function(a){if(a){if(window.localStorage){if(a instanceof RegExp){for(var b=window.localStorage,c=0,d=b.length;c<d;)if(0<=b.key(c++).search(a))return!0;return!1}return"undefined"===typeof window.localStorage[a]?!1:!0}return!1}throw{error:"bad name",name:a};};a.findLocal=function(a,b,c){if(window.localStorage){for(var d={},f=window.localStorage,e=0,g=f.length;e<g;){var t=f.key(e++);if(!a||0<=t.search(a)){var h=f[t];if(!b||0<=h.search(b)){if(c)try{h=JSON.parse(h)}catch(q){}d[t]=h}}}return d}return!1};
a.dropLocal=u;a.listLocal=function(a){var b=[];"string"===typeof a&&(a=new RegExp("^"+A.escapeRX(a),"g"));if(window.localStorage){var c=window.localStorage,d=0,f=c.length,e=!1;if(!a)for(;d<f;)b.push(c.key(d++));else if(a instanceof RegExp)for(;d<f;)e=c.key(d++),0<=e.search(a)&&b.push(e)}return b};a.clearLocal=function(){if(window.localStorage){for(var a=window.localStorage,b=0,c=a.length,d=[];b<c;)d.push(a.key(b++));for(b=0;b<c;)a.removeItem(d[b++])}};a.getParam=q;a.getQuery=function(a,b,c,d){if(!location.search)return b?
[]:!1;var f=location.search;"?"===f[0]&&(f=f.slice(1));return q(f,a,b,c,d)};a.getHash=function(a,b,c,d){if(!location.hash)return b?[]:!1;var f=location.hash;"#"===f[0]&&f.slice(1);return q(location.hash,a,b,c,d)};a.testOption=function(a,b){for(var d=a&&new RegExp("\\b"+a+"\\b"),f=b&&c(b),e=2;e<arguments.length;){var g=arguments[e++];if(g)if("string"===typeof g){if(d&&0<=g.search(d))return!0;if(f&&0<=g.search(f))break}else if(g.length){d=0;for(f=g.length;d<f;){if(a&&g[d]===a)return!0;if(b&&g[d]===
b)break;else d++}break}}return!1};a.argVec=function(a,b){for(var c=b||0,d=Array(a.length-c);c<a.length;)d[c-b]=a[c],c++;return d};var w=b((Math.floor(65536*Math.random()).toString(16)+Math.floor(65536*Math.random()).toString(16)+Math.floor(65536*Math.random()).toString(16)+(Math.floor(65536*Math.random())|1)).toString(16),12),f=Math.floor(16384*Math.random()),D=1,J=(new Date).getTime();a.getNodeID=function(){return w};a.setNodeID=function(a){if("number"===typeof a)w=b(a.toString(16),12);else if("string"===
typeof a)if(0>a.search(/[^0123456789abcdefABCDEF]/))w=b(a,12);else throw{error:"invalid node id",value:a};else throw{error:"invalid node id",value:a};};a.getUUID=function(a){var c=(new Date).getTime();c<J?(c*=1E4,f++):c===J?c=1E4*c+D++:(c*=1E4,D=1);a||(a=w);var c=(c+122192928E9).toString(16),d=c.length;15>d&&(c="000000000000000000000000000000000000000000000000000000000000000".slice(0,15-d)+c);return c.slice(7)+"-"+c.slice(3,7)+"-1"+c.slice(0,3)+"-"+(32768+f%16384).toString(16)+"-"+(a?"number"===typeof a?
b(a.toString(16),12):b(a,12):w)};a.versionInfo=function(){for(var a=navigator.userAgent,b={},c;0<=(c=a.search(/\w+\/\d/g));){var d=a.indexOf("/",c),f=a.slice(d+1),e=f.search(/\W/),g=f.slice(0,e);try{b[a.slice(c,d)]=parseInt(g,10)}catch(t){b[a.slice(c,d)]=g}a=f.slice(e)}b.browser=b.Chrome?"Chrome":b.Opera?"Opera":b.Safari?"Safari":b.Safari&&b.Mobile?"MobileSafari":b.Firefox?"Firefox":b.Explorer||b.IE||b.InternetExplorer||b.MSIE?"IE":b.Mozilla?"Mozilla":"Browser";b.platform=navigator.platform||"Turing";
return b};a.getStyleTag=function(){var a=window.getComputedStyle(document.body,":after").getPropertyValue("content");return a=a.replace(/"/g,"")};a.getURL=function(a,b){var c=window.location.href,d=c.indexOf("#"),f=c.indexOf("?"),e=b&&0<=d&&c.slice(d+1),g=a&&0<=f&&(0<=d?c.slice(f+1,d):c.slice(f+1)),c=0<=f?c.slice(0,f):0<=d?c.slice(0,d):c;return c+(g?"?"+g:"")+(e?"#"+e:"")};return a}();
fdjt.iDB=function(){var a={},n=fdjt.device;!window.indexedDB||n.ios&&n.standalone?(a.indexedDB=idbModules.shimIndexedDB,a.IDBDatabase=idbModules.IDBDatabase,a.IDBTransaction=idbModules.IDBTransaction,a.IDBCursor=idbModules.IDBCursor,a.IDBKeyRange=idbModules.IDBKeyRange):(a.indexedDB=window.indexedDB,a.IDBDatabase=window.IDBDatabase,a.IDBTransaction=window.IDBTransaction,a.IDBCursor=window.IDBCursor,a.IDBKeyRange=window.IDBKeyRange,a.IDBTransaction=window.IDBTransaction,a.IDBTransaction=window.IDBTransaction);
return a}();var _fdjt_init;
fdjt.DOM=function(){function a(a){var b;if(a.nodeType)b=a;else{if("string"===typeof a&&"<"===a[0]){b=document.createDocumentFragment();b.innerHTML=a;var l=b.childNodes;return 1===l.length?l[0]:b}if("string"!==typeof a||"#"!==a[0]||!(b=document.getElementById(a.slice(1))))if("string"===typeof a){l=a.match(ba);if(!l)return Ja.warn("bad CSS spec"),!1;var c=!1;b=document.createElement(l[0]);for(var d=1,f=l.length;d<f;){var e=l[d++];if("#"===e[0])b.id=e.slice(1);else if("."===e[0])c=c?c+" "+e.slice(1):
e.slice(1);else if("["===e[0]){var z=e.indexOf("=");if(0>z)b.setAttribute(e.slice(1,e.length-1),e.slice(1,e.length-1));else{var r=e.slice(z+1,e.length-1);if("'"===r[0]&&"'"===r[r.length-1]||'"'===r[0]&&'"'===r[r.length-1])r=r.slice(1,r.length-1);b.setAttribute(e.slice(1,z),r)}}}c&&(b.className=c)}else for(l in b=document.createElement(a.tagName||"span"),a)"tagName"!==l&&b.setAttribute(l,a[l])}l=1;for(c=arguments.length;l<c;)h(b,arguments[l++]);return b}function n(a){return a&&(document.getElementById(a)||
"#"===a[0]&&document.getElementById(a.slice(1)))}function h(a,b,l){if(0===b)a.appendChild(document.createTextNode("0"));else if(b)if(b.nodeType)a.appendChild(b);else if("string"===typeof b)a.appendChild(document.createTextNode(b));else{if(b.toDOM)return h(a,b.toDOM());if(b.toHTML)return h(a,b.toHTML());if(b.length&&(!l||l<b.length)){var c=window.DocumentFragment&&a instanceof window.DocumentFragment?a:document.createDocumentFragment();b=window.NodeList&&b instanceof window.NodeList?v(b):b;var d=b.length;
for("undefined"===typeof l&&(l=0);l<d;){var f=b[l++];"string"===typeof f?c.appendChild(document.createTextNode(f)):"number"===typeof f?c.appendChild(document.createTextNode(f.toString())):f&&(f.nodeType?c.appendChild(f):f.length?h(c,f,0):f.toDOM?h(c,f.toDOM()):f.toHTML?h(c,f.toHTML()):f.toString?c.appendChild(document.createTextNode(f.toString())):c.appendChild(document.createTextNode(""+f)))}a!==c&&a.appendChild(c)}else b.length||a.appendChild(document.createTextNode(""+b))}else return;return a}
function m(a,b,l){var c=a.parentNode;if(!b.nodeType||b!==a){if(b.nodeType)c.insertBefore(b,a);else if("string"===typeof b)c.insertBefore(document.createTextNode(b),a);else{if(b.toDOM)return m(a,b.toDOM());if(b.toHTML)return m(a,c,b.toHTML());if(1<b.length-l){var d=window.documentFragment&&c instanceof window.DocumentFragment?c:document.createDocumentFragment();h(d,b,l);c.insertBefore(d,a);return a}if(b.length){b=b[l];if(b===a)return;c.insertBefore(b,a)}else c.insertBefore(document.createTextNode(""+
b),a)}return c}}function e(a){return Sa.call(a)}function v(a,b){return a.constructor===Array||a instanceof Array?b?a.slice(b):a:Sa.call(a,b||0)}function k(a,b){"undefined"===typeof b&&(b=0);if(0===a)return 0;if(a){if("none"===a||"auto"===a)return b;if("number"===typeof a)return a;if("string"===typeof a){var l=a.length,c=!1,c=2<l&&"x"===a[l-1]&&"p"===a[l-2]?parseInt(a.slice(0,-2),10):parseInt(a,10);return 0===c?0:isNaN(c)?b:"number"===typeof c?c:b}return!1}return b}function x(a){var b=new RegExp("\\b"+
a+"\\b","g");return xa[a]=b}function p(a,b,l,c){var d=[],d=0<=b.search(/(\.|#|\[|,)/g)?J(a,b):a.getElementsByClassName?a.getElementsByClassName(b):J();if(0===d.length)return c?[]:!1;if(c){a=[];b=0;for(c=c.length;b<c;){var f=d[b++].innerText;l?a.push(JSON.parse(f)):a.push(f)}return a}return l?JSON.parse(d[0].innerText):d[0].innerText}function u(a,b,l){if(a&&("string"!==typeof a||(a=document.getElementById(a)))){a=l?a.getAttribute(l)||"":a.className;if("string"!==typeof a||""===a)return!1;if(!0===b||
a===b)return!0;if("string"===typeof b){if(0>a.indexOf(" "))return!1;b=xa[b]||x(b)}return 0<=a.search(b)?!0:!1}}function q(a,b,l){if(a&&b){if("string"===typeof a){if(!(a=document.getElementById(a)))return}else{if(window.NodeList&&a instanceof window.NodeList)return q(v(a),b,l);if(a.length&&!a.nodeType){a=v(a);for(var c=0,d=a.length;c<d;)q(a[c++],b,l||!1);return}if(!l&&a.classList&&"string"===typeof b){a.classList.contains(b)||a.classList.add(b);return}}if((c=(l?a.getAttribute(l)||"":a.className)||
null)&&"string"!==typeof c)return Ja.warn("Non string classname for %o",a),!1;if(!c)return a.className=b,!0;var d=xa[b]||x(b),f=c;if(c===b||0<=c.search(d))return!1;f=b+" "+c;l?(a.setAttribute(l,f),a.className=a.className):a.className=f;return!0}}function g(a,b,l,c){if(a){if("string"===typeof a){if(!(a=document.getElementById(a)))return}else{if(window.NodeList&&a instanceof window.NodeList)return g(v(a),b,l);if(a.length&&!a.nodeType){a=v(a);c=0;for(var d=a.length;c<d;)g(a[c++],b,l||!1);return}if(!l&&
a.classList&&"string"===typeof b){a.classList.contains(b)&&a.classList.remove(b);return}}d=(l?a.getAttribute(l)||"":a.className)||null;if("string"!==typeof d||""===d)return!1;var f="string"===typeof b?xa[b]||x(b):b,e=d;if(d===b)e="";else if(0<=d.search(f))e=d.replace(f,"");else return!1;e&&(e=e.replace(Oa," ").replace(eb,""));l?e?(a.setAttribute(l,e),a.className=a.className):c||(a.removeAttribute(l),a.className=a.className):a.className=e?e:"";return!0}}function c(a,b,l,d){if("string"===typeof a)a=
document.getElementById(a);else{if(window.NodeList&&a instanceof window.NodeList)return c(v(a),b,l);if(a.length&&!a.nodeType){a=v(a);d=0;for(var f=a.length;d<f;)c(a[d++],b,l||!1);return}if(!l&&a.classList&&"string"===typeof b){a.classList.toggle(b);return}}f=(l?a.getAttribute(l)||"":a.className)||null;if("string"!==typeof f||""===f)return l?a.setAttribute(l,b):a.className=b,!0;var e="string"===typeof b?xa[b]||x(b):b,z=f;if(f===b)z="";else if(0<=f.search(e))z=f.replace(e,"");else return l?a.setAttribute(l,
f+" "+b):a.className=f+" "+b,!0;z&&(z=z.replace(Oa," ").replace(eb,""));l?z?(a.setAttribute(l,z),a.className=a.className):d||(a.removeAttribute(l),a.className=a.className):a.className=z;return!1}function b(a,b,l,d,f){(a=D(a,b))&&c(a,l,d,f)}function d(a,b){var l,c;if(a){if(fb[a])return fb[a];if(!(this instanceof d))return d.call(new d,a)}else return this;if(Array.isArray(a)||"string"===typeof a&&0<a.indexOf(",")){var f=[],e=[];if("string"===typeof a)e=a.split(",");else for(l=0,c=a.length;l<c;)"string"!==
typeof a[l]?l++:0<=a[l].indexOf(",")?e=e.concat(a[l++].split(",")):e.push(a[l++]);l=0;for(c=e.length;l<c;){var z;z=e[l++];var r=z.search(/\S/),aa=z.search(/\s+$/g);z=0===r&&0>aa?z:z.slice(r,aa);(z=new d(z))&&f.push(z)}this.compound=f;fb[a]=this;this.spec="string"===typeof a?a:e.join(",");return this}f=a.match(ba);e=[];z=[];r=!1;f||Ja.warn("Couldn't parse spec %s",a);if(f)for(l=0,c=f.length,"."!==f[0][0]&&"#"!==f[0][0]&&"["!==f[0][0]&&(this.tag=b?f[0]:f[0].toUpperCase(),l=1);l<c;)if("#"===f[l][0])this.id=
f[l++].slice(1);else if("."===f[l][0])z.push(f[l].slice(1)),e.push(x(f[l++].slice(1)));else if("["===f[l][0]){var aa=f[l++],g=aa.length-1;r||(r={});var t=aa.indexOf("=");0>t?r[aa.slice(1,g)]=!0:"~"===aa[t+1]?r[aa.slice(1,t)]=x(aa.slice(t+2,g)):r[aa.slice(1,t)]=aa.slice(t+1,g)}else Ja.uhoh("weird elts %o",f[l++]);e.length&&(this.classes=e,this.classnames=z);r&&(this.attribs=r);this.rank=[0,this.id?1:0,z.length+r.length,1];fb[a]=this;this.spec=a;return this}function A(a,b,l){if(1===a.nodeType){var c=
a.className;"string"===typeof c&&0<=c.search(b)&&l.push(a);if(a=a.childNodes)for(var c=0,d=a.length;c<d;)A(a[c++],b,l)}}function w(a,b,l){if(1===a.nodeType&&(("string"===typeof b?a.tagName.toLowerString()===b:b instanceof RegExp&&b.match(a.tagName))&&l.push(a),a=a.childNodes))for(var c=0,d=a.length;c<d;)w(a[c++],b,l)}function f(a,b,l,c){if(1===a.nodeType&&(a.getAttribute(b)&&("string"===typeof l?a.getAttribute(b)===l:0<=a.getAttribute(b).search(l))&&c.push(a),a=a.childNodes))for(var d=0,e=a.length;d<
e;)f(a[d++],b,l,c)}function D(a,b){"string"===typeof a&&(a="#"===a[0]?document.getElementById(a.slice(1)):document.getElementById(a));if(a&&b){if(b.nodeType){for(;a;){if(a===b)return b;a=a.parentNode}return!1}if("function"===typeof b){for(;a;){if(b(a))return a;a=a.parentNode}return!1}if(b instanceof d){for(;a;){if(1===a.nodeType&&b.match(a))return a;a=a.parentNode}return!1}if(b instanceof RegExp){for(;a;){if(1===a.nodeType&&a.className&&b.test(a.className))return a;a=a.parentNode}return!1}if("string"===
typeof b)return D(a,new d(b));throw{error:"invalid parent spec"};}return!1}function J(a,b,l,c){"string"===typeof a&&(a=n(a));if(!a)return[];c||(c=[]);if(l){if("string"!==typeof l)throw{error:"bad selector arg",selector:b};l=l||!1;var e=c;l?"class"===l?A(a,b,e):"tagName"===l?w(a,b,e):f(a,l,b,e):A(a,b,e)}else if("function"===typeof b)y(a,b,c);else if(b instanceof RegExp)E(a,b,c);else{if(b instanceof d)return b.find(a,c);if("string"===typeof b)return za&&a.querySelectorAll?a.querySelectorAll(b):J(a,
new d(b),!1,c);if(b.length)for(var e=0,z=b.length;e<z;)J(a,b[e++],l,c)}return c}function G(a,b){var l=J(a,b);return l.length?l[0]:!1}function y(a,b,l){if(1===a.nodeType&&(b(a)&&l.push(a),a=a.childNodes))for(var c=0,d=a.length;c<d;)y(a[c++],b,l)}function E(a,b,l){if(1===a.nodeType){var c=a.className;"string"===typeof c&&0<=c.search(b)&&l.push(a);if(a=a.childNodes)for(var c=0,d=a.length;c<d;)E(a[c++],b,l)}}function F(a){if(a instanceof Array)for(var b=0,l=a.length;b<l;)F(a[b++]);else b=a,"string"===
typeof a&&(b="#"===a[0]?document.getElementById(a.slice(1)):document.getElementById(a)),b&&b.parentNode?b.parentNode.removeChild(b):b?Ja.uhoh("Looks like %o has already been removed (no parent)",b):Ja.uhoh("Can't find %o to remove it",a)}function O(a,b){if(a){if("string"===typeof a){var l=a.search(/\w/g);if(0>a.search(/\W/g))return b+"."+a;if(0!==l)return b+a}else a.tagName||(a.tagName=b);return a}return b}function M(a,b,l){var c=[];if("string"===typeof a){var d=document.getElementById(a);d||Ja.warn("Couldn't resolve %s to an object",
a);a=d}if(!a)return c;for(var d=a.getElementsByTagName("input"),f=0,e=d.length;f<e;)b&&d[f].name!==b||l&&d[f].type!==l?f++:c.push(d[f++]);if(!l||"textarea"===l||"text"===l)for(d=a.getElementsByTagName("textarea"),f=0,e=d.length;f<e;)b&&d[f].name!==b||l&&d[f].type!==l?f++:c.push(d[f++]);if(!l||"button"===l||"submit"===l)for(d=a.getElementsByTagName("button"),f=0,e=d.length;f<e;)b&&d[f].name!==b||l&&d[f].type!==l?f++:c.push(d[f++]);if(!l||"select"===l)for(d=a.getElementsByTagName("select"),f=0,e=d.length;f<
e;)b&&d[f].name!==b?f++:c.push(d[f++]);return c}function I(a,b,l){"string"===typeof a&&(a=document.getElementById(a));if(!a)return[];var c=[];a=a.getElementsByTagName("input");for(var d=0,f=a.length;d<f;){var e=a[d++];e.name===b&&e.value===l&&c.push(e)}return c}function t(a,b){"string"===typeof a&&(a=document.getElementById(a));if(!a)return a;if(1!==a.nodeType)throw"Not an element";var l=window.getComputedStyle&&window.getComputedStyle(a,null)||a.currentStyle;return l?b?l[b]:l:!1}function T(a){a=
a.style;var b;if(!a)return!1;var l=0,c=a.length;if(0===c)return!1;for(;l<c;){var d=a[l],f=a[d];b=0===l?d+": "+f:b+"; "+d+": "+f;l++}return b}function K(a,b,l,c){if(a.nodeType){if(3===a.nodeType)return b?a.nodeValue.replace(/\s+/," "):a.nodeValue;if(1===a.nodeType){l=a.childNodes;var d=t(a),f=d.display,e=d.position,z=a.className,r="",aa="";"normal"!==d.whiteSpace&&(b=!1);if("none"===f||"static"!==e&&""!==e||"string"===typeof z&&("fdjtskiptext"===z||0<=z.search(/\bfdjtskiptext\b/)))return"";if(!l||
0===l.length)return c?a.alt?"["+a.alt+"]":"[?]":"";f&&"inline"!==f&&(b?aa=" ":"block"===f||"table"===f||"preformatted"===f?aa=r="\n":"table-row"===f?aa="\n":"table-cell"===f&&(r="\t"));for(a=0;a<l.length;)d=l[a++],d.nodeType&&(3===d.nodeType?r=b?r+d.nodeValue.replace(/\s+/," "):r+d.nodeValue:1===d.nodeType&&(d=K(d,b,!0,c))&&(r+=d));return r+aa}}else return a.toString()}function P(a,b){if(a)"string"===typeof a&&(a=document.getElementById(a));else return this;if(a){var l=a.offsetTop,c=a.offsetLeft,
d=a.offsetWidth,f=a.offsetHeight,e=b&&b.offsetParent;this.elt=a;this.root=b;if(a===b)l=c=0;else for(a=a.offsetParent;a&&(!b||a!==b&&a!==e);)l+=a.offsetTop,c+=a.offsetLeft,a=a.offsetParent;this.left=c;this.top=l;this.width=d;this.height=f;this.right=c+d;this.bottom=l+f;return this}}function C(a,b,l){l=l?[]:!1;if(a)"string"===typeof a&&(a=document.getElementById(a));else return this;var c=a.offsetTop,d=a.offsetLeft,f=a.offsetWidth,e=a.offsetHeight,z=b&&b.offsetParent,r=t(a);this.elt=a;this.root=b;if(a===
b)c=d=0;else for(a=a.offsetParent;a&&(!b||a!==b&&a!==z);)l&&l.push(a),c+=a.offsetTop,d+=a.offsetLeft,a=a.offsetParent;this.left=d;this.top=c;this.width=f;this.height=e;this.right=d+f;this.bottom=c+e;if(r){a=k(r.marginTop);b=k(r.marginRight);var c=k(r.marginBottom),d=k(r.marginLeft),z=k(r.paddingTop),aa=k(r.paddingRight),g=k(r.paddingBottom),B=k(r.paddingLeft),h=k(r.borderTopWidth),q=k(r.borderRightWidth),w=k(r.borderBottomWidth),X=k(r.borderLeftWidth),u=f+d+b,V=e+a+c,f=f-(X+B+q+aa),e=e-(h+z+w+g),
A=r.lineHeight,r=r.fontSize,da=!1,da="normal"===A?k(r):0<A.search(/px$/)?k(A):0<A.search(/%$/)?parseFloat(A.slice(0,-1))/100*k(r):k(r);this.top_margin=a;this.bottom_margin=c;this.left_margin=d;this.right_margin=b;this.top_border=h;this.bottom_border=w;this.left_border=X;this.right_border=q;this.top_padding=z;this.bottom_padding=g;this.left_padding=B;this.right_padding=aa;this.outer_height=V;this.outer_width=u;this.inner_height=e;this.inner_width=f;this.line_height=da}l&&(this.stack=l);return this}
function U(a,b,l){return l?new C(a,b):new P(a,b)}function V(a){if(3===a.nodeType)return a.nodeValue.length;if(1!==a.nodeType)return 0;var b=t(a),l=b.display,b=b.position;if("none"===l||""!==b&&"static"!==b||"string"!==typeof a.className||"fdjtskiptext"===a.className||"string"===typeof a.className&&0<=a.className.search(/\bfdjtskiptext/))return 0;if(a.getAttribute("data-locwidth"))return parseInt(a.getAttribute("data-locwidth"));if(a.childNodes){b=a.childNodes;a="inline"===l?0:/^(li|td|dt|dd|label|input)$/i.exec(a.tagName)?
1:2;for(var l=0,c=b.length,d=0;l<c;){var f=b[l++];3===f.nodeType?d+=f.nodeValue.length:1===f.nodeType&&(d+=V(f))}return d+2*a}return a.alt?a.alt.length+2:3}function B(a,b,l,c){if(a===c)return!1;if(3===a.nodeType)return 0<=a.nodeValue.search(/\w/g);if(1!==a.nodeType)return!1;if(l&&l.match&&l.match(a)||0===a.tagName.search(Y))return!0;if(!("string"===typeof a.className&&0<=a.className.search(/\bfdjtskiptext\b/g))&&a.childNodes&&a.childNodes.length){a=a.childNodes;for(var d=0;d<a.length;){var f=a[d++];
if(f===c)break;else if(3===f.nodeType){if(0<=f.nodeValue.search(/\w/g))return!0}else if(1===f.nodeType&&b&&B(f,b,l,c))return!0}}return!1}function N(a,b,l){a||(a=document);if("string"===typeof a){var c=n(a);if(!a){Ja.warn("Can't find #%s",a);return}a=c}else{if(Array.isArray&&Array.isArray(a)||window.NodeList&&a instanceof window.NodeList){for(var c=0,d=a.length;c<d;)N(a[c++],b,l);return}if(a!==window&&!a.nodeType){Ja.warn("Bad target(s) arg to addListener(%s) %o",b,a);return}}if("title"===b)"string"===
typeof l&&(a.title=a.title?"("+l+") "+a.title:l);else if("="===b[0])a[b.slice(1)]=l;else{if(a.addEventListener)return a.addEventListener(b,l,!1);if(a.attachEvent)return a.attachEvent("on"+b,l);Ja.warn("This node never listens: %o",a)}}function r(a,b){if(b)for(var l in b)if(b.hasOwnProperty(l)){var c=!1;if(b[l].call)if(Ga.exec(l))N(a,l,b[l]);else if(c=Ea.exec(l)){var d=c[2],f=b[l],c=a.querySelectorAll(c[1]);N(c,d,f)}}}function da(a,b,l){a||(a=document);if("string"===typeof a){var c=n(a);if(!a){Ja("Can't find #%s",
a);return}a=c}else{if(Array.isArray&&Array.isArray(a)||window.NodeList&&a instanceof window.NodeList){for(var c=0,d=a.length;c<d;)da(a[c++],b,l);return}if(a!==window&&!a.nodeType){Ja.warn("Bad target(s) arg to removeListener(%s) %o",b,a);return}}if(a.removeEventListener)return a.removeEventListener(b,l,!1);if(a.detachEvent)return a.detachEvent("on"+b,l);Ja.warn("This node never listens: %o",a)}function X(a){a=a||window.event;return a.target||a.srcElement}function S(a){var b=!1,l=!1,c=!1,d=!1;a=a.childNodes;
for(var f=0,e=a.length;f<e;){var z=a[f++];if("number"===typeof z.offsetLeft){var r=t(z);if("static"===r.position){var aa=z.offsetLeft-k(r.marginLeft),g=z.offsetTop-k(r.marginTop),B=z.offsetLeft+z.offsetWidth+k(r.marginRight),z=z.offsetTop+z.offsetHeight+k(r.marginBottom);!1===b?(b=aa,c=B,l=g,d=z):(aa<b&&(b=aa),g<l&&(l=g),B>c&&(c=B),z>d&&(d=z))}}}return{left:b,right:c,top:l,bottom:d,width:c-b,height:d-l}}function oa(b,l){var c=a.getChildren(b,"IMG"),d=c.length;if(l){b.scale=l;b.style.fontSize=l+"%";
var f=10*Math.round(l/10);a.addClass(b,"fdjtscaled");a.swapClass(b,/\bfdjtscale\d+\b/,"fdjtscale"+f)}else if(b.scale)delete b.scale,b.style.fontSize="",a.dropClass(b,"fdjtscaled"),a.dropClass(b,/\bfdjtscale\d+\b/);else return;for(f=0;f<d;){var e=c[f++];if(!a.hasClass(e,"nofdjtscale")&&!a.hasClass(e,"noautoscale")&&(e.style.maxWidth=e.style.width=e.style.maxHeight=e.style.height="",l)){var z=e.offsetHeight;e.style.maxWidth=e.style.width=Math.round(l/100*e.offsetWidth)+"px";e.style.maxHeight=e.style.height=
Math.round(l/100*z)+"px"}}}function ga(b,l,c,d){c||(c=b.getAttribute("data-origin"));d||(d=b.getAttribute("data-shrink"));l||(l=b.getAttribute("data-fudge"));var f=b.firstChild;(f="fdjtadjusted"===f.className?f:G(b,"fdjtadjusted"))&&f.setAttribute("style","");var e=U(b,!1,!0),z=S(b),r=l?l*e.inner_width:e.inner_width;l=l?l*e.inner_height:e.inner_height;if(!(z.height<=l&&z.width<=r&&(!d||z.height<l&&z.height>=.9*l||z.width<e.inner_width&&z.width>=.9*l))){if(!f){d=[];for(var f=b.childNodes,e=0,aa=f.length;e<
aa;)d.push(f[e++]);f=a("div.fdjtadjusted");e=0;for(aa=d.length;e<aa;)f.appendChild(d[e++]);b.appendChild(f)}b=r/z.width;z=l/z.height;b=b<z?b:z;f.style[a.transform]="scale("+b+","+b+")";f.style[a.transformOrigin]=c||"50% 0%"}}function ca(){for(var b=a.$(".fdjtadjustfit"),l=0,c=b.length;l<c;)ga(b[l++])}function Ma(a,b){b||(u(a,"fdjtadjusted")?(b=a,a=b.parentNode):b="fdjtadjusted"===a.firstChild.className?a.firstChild:G(a,"fdjtadjusted"));if(a&&b){for(var l=[],c=b.childNodes,d=0,f=c.length;d<f;)l.push(c[d++]);
c=document.createDocumentFragment();d=0;for(f=l.length;d<f;)c.appendChild(l[d++]);a.replaceChild(c,b);return a}return!1}function l(a,b){var l,c;l=[];"string"===typeof a&&"undefined"===typeof b&&("^"===a[0]?(b=!1,a=a.slice(1)):"~"===a[0]&&(b=!0,a=a.slice(1)));"undefined"===typeof b&&(b=!0);if("string"!==typeof a)return a;if("{"===a[0]){c=!1;var d=a.indexOf("}");2<d&&(c=a.slice(1,d));l=c&&Pa[c]||[];return new RegExp("\\b("+va(c)+"|"+l.join("|")+")[.]"+a.slice(d+1)+"\\b",b?"i":"")}if("="===a[0])return new RegExp("\\b"+
va(a.slice(1))+"\\b",b?"i":"");if("*"===a[0]&&"."===a[1])return new RegExp("\\b([^.]\\.)?"+a.slice(2)+"\\b",b?"i":"");if(0<a.indexOf(".")){d=a.indexOf(".");l=a.slice(0,d);if(c=wa[l])l=c&&Pa[c]?Pa[c]:[l];else return new RegExp("\\b"+va(a)+"\\b",b?"i":"");return new RegExp("\\b("+va(c)+"|"+l.join("|")+")\\."+a.slice(d+1)+"\\b",b?"i":"")}return new RegExp("\\b"+a+"\\b",b?"i":"")}function aa(a,b,c,d){var f=[],e=document.getElementsByTagName?document.getElementsByTagName("META"):J(document,"META");a=l(a,
c);for(c=0;c<e.length;){var z=e[c++];if(z&&z.name&&0<=z.name.search(a))if(b)d?f.push(z):f.push(z.content);else return d?z:z.content}return b?f:!1}function z(a,b,c,d,f){var e=[],z=document.getElementsByTagName?document.getElementsByTagName("LINK"):document.body&&document.body.getElementsByTagName?document.body.getElementsByTagName("LINK"):J(document,"LINK");a=l(a,c);for(c=0;c<z.length;){var r=z[c++];if(r&&r.rel&&0<=r.rel.search(a))if(b)d?e.push(r):f?e.push(r.getAttribute("href")):e.push(r.href);else return d?
r:f?r.getAttribute("href"):r.href}return b?e:!1}function Ca(a){for(;a;){if(a.nextSibling)return a.nextSibling;a=a.parentNode}return!1}function Ka(a){if(a.nextElementSibling)return a.nextElementSibling;for(;a=a.nextSibling;){if(!a)return null;if(1===a.nodeType)break}return a}function Va(a){if(a.childNodes&&0<a.childNodes.length)return a.childNodes[0];for(;a;){if(a.nextSibling)return a.nextSibling;a=a.parentNode}return!1}function Ra(a,b){var l,c,d;if(b){c=0;for(l=a;c<b;)l=Ra(l),c++;return l}if(sa){if(a.children&&
0<a.children.length)return a.children[0];if(l=a.nextElementSibling)return l;for(;a=a.parentNode;)if(l=a.nextElementSibling)return l}else{if(a.childNodes){var f=a.childNodes;c=0;for(d=f.length;c<d;)if((l=f[c++])&&1===l.nodeType)return l}for(;l=a.nextSibling;)if(1===l.nodeType)return l;for(;a=a.parentNode;)if(l=Ka(a))return l}return!1}function fa(a){for(;a;){if(a.previousSibling)return a.previousSibling;a=a.parentNode}return!1}function ua(a){if(sa)return a.previousElementSibling;for(;a=a.previousSibling;){if(!a)return null;
if(1===a.nodeType)break}return a?a:a.parentNode}function bb(a){if(a.previousSibling){a=a.previousSibling;if(1!==a.nodeType)return a;for(;a;){var b=a.childNodes;if(b)if(0===b.length)break;else a=b[b.length-1];else break}return a}return a.parentNode}function Ia(a){return sa?a.previousElementSibling?hb(a.previousElementSibling):a.parentNode:a.previousElementSibling||a.previousSibling?(a=a.previousElementSibling||a.previousSibling,1===a.nodeType?hb(a):a):a.parentNode}function hb(a){if(1===a.nodeType){if(a.childNodes){var b=
a.childNodes;if(!b.length)return a;for(var l=b.length-1;0<=l;){var c=hb(b[l--]);if(c)return c}}return a}return!1}function Za(a){if("string"!==typeof a||(a=document.getElementById(a)))return a||(a=window),a.hasOwnProperty("innerHeight")?a.innerHeight:a.document&&window.document.documentElement&&window.document.documentElement.clientHeight?window.document.documentElement.clientHeight:a.offsetHeight}function ab(a){if("string"!==typeof a||(a=document.getElementById(a)))return a||(a=window),a.hasOwnProperty("innerWidth")?
a.innerWidth:a.document&&window.document.documentElement&&window.document.documentElement.clientWidth?window.document.documentElement.clientWidth:a.offsetWidth}function $a(a,b,l){b||(b=!1);l||(l=!1);a.id&&(l&&a.setAttribute(l,a.id),a.id="",a.removeAttribute("id"));b&&a.name&&(a.name=null);if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var c=0,d=a.length;c<d;){var f=a[c++];1===f.nodeType&&$a(f,b,l)}}}function nb(a,b){a=a.toLowerCase();if(document.styleSheets)for(var l=0;l<document.styleSheets.length;l++)for(var c=
document.styleSheets[l],d=c.cssRules||c.rules,f=d&&d.length,e=0;e<f;){if(d[e]){var z=d[e];if(z.selectorText.toLowerCase()===a)return"delete"===b?(c.cssRules&&c.deleteRule(e),!0):z}e++}return!1}function La(){var a=document.documentElement||document.body;"undefined"===typeof Qa&&(Qa=document.implementation&&document.implementation.hasFeature?!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"):"Microsoft Internet Explorer"===navigator.appName?!0:navigator.mimeTypes["image/svg+xml"]?
!1:!0);Qa?(q(a,"_NOSVG"),g(a,"_USESVG")):(g(a,"_NOSVG"),q(a,"_USESVG"));return!Qa}function Na(){for(var a=ia.hasSuffix,b=fdjt.$("IMG"),l=0,c=b.length;l<c;){var d=b[l++],f=d.src;f&&!a(f,".svg")&&!a(f,".svgz")&&d.getAttribute("svg")&&(f=d.getAttribute("svg"),d.setAttribute("bmp",d.src),d.src=f)}}function H(a,b){var l,c;b||(b="");if(!a.nodeType&&a.length)for(l=0,c=a.length;l<c;)b=H(a[l++],b);else if(3===a.nodeType){var d=a.nodeValue;d&&(b+=d)}else if(1===a.nodeType){l=t(a);d=a.childNodes;if("string"===
typeof a.className&&0<=a.className.search(/\bfdjtskiptext\b/)||"none"===l.display||"hidden"===l.visibility||"static"!==l.position&&""!==l.position)return b;l=0;for(c=d.length;l<c;){var f=d[l++];3===f.nodeType?(f=f.nodeValue)&&(b+=f):b=H(f,b)}}return b}function W(a,b,l,c){var d,f;if(l>b)return!1;if(!a.nodeType&&a.length){d=0;for(f=a.length;d<f&&(l=W(a[d++],b,l,c),"number"===typeof l););return l}if(3===a.nodeType)return c=a.nodeValue,b<l+c.length?{node:a,off:b-l}:b===l+c.length?{node:a,off:b-l,atend:!0}:
l+c.length;if(1===a.nodeType){d=t(a);var e=a.childNodes;if("string"===typeof a.className&&0<=a.className.search(/\bfdjtskiptext\b/)||"none"===d.display||"hidden"===d.visibility||"static"!==d.position&&""!==d.position)return l;d=0;for(f=e.length;d<f;)if(l=W(e[d++],b,l,c),"number"!==typeof l){if(c&&l.atend)for(l=b;d<f;)if((a=W(e[d++],l,b,c))&&"number"!==typeof a)return a;break}}return l}function ha(a,b,l){l=W(a,b,l||0);return"number"!==typeof l?l:{node:a,off:b}}function Ha(a,b,l){l||(l=0);if(a===b)return[l];
if(3===a.nodeType)return l+a.nodeValue.length;if(1===a.nodeType){a=a.childNodes;for(var c=0,d=a.length;c<d;){var f=a[c++];l=Ha(f,b,l);if("number"!==typeof l)break}}return l}function ka(a,b){var l=Ha(a,b,0);return l?l[0]:!1}function Q(a){for(;a&&!a.id;)a=a.parentNode;return a}function L(a,b,l,c){return b?(a=a.replace("\u00ad",""),(l||"")+a.replace(/\S/g,"$&\u00ad?").replace(/([()\[\]\.\?\+\*])\u00ad\?/gm,"[$1]").replace("\u00ad? "," ").replace(/\s+/g,"(\\s+)")+(c||"")):(l||"")+a.replace(/[()\[\]\.\?\+\*]/gm,
"[$&]").replace(/\s+/g,"(\\s+)")+(c||"")}function Z(a,b,l,c,d){"undefined"===typeof l&&(l=!0);return new RegExp(L(a,l,c,d),b?"igm":"gm")}function na(a){return a?3===a.nodeType?a:1===a.nodeType?na(a.firstChild):!1:!1}function ma(a){a=document.createElement("input");for(var b=0,l=Fa.length;b<l;){var c=Fa[b++];try{a.type=c}catch(d){}if(a.type===c)for(var f=J(document.body,".fdjt"+c+"input"),e=0,z=f.length;e<z;){var r=f[e++];"INPUT"===r.tagName&&(r.type=c)}}}function ib(a,b){if("string"===typeof a&&0===
a.search("data:")){if(!b){var l=/data:([^;]+);/.exec(a);l&&(b=l[1])}for(var c=a.split(","),l=atob(c[1]),l=0<=c[0].indexOf("base64")?atob(c[1]):window.unescape(c[1]),c=new ArrayBuffer(l.length),d=new Uint8Array(c),f=0;f<l.length;f++)d[f]=l.charCodeAt(f);return new Blob([c],{type:b||"application"})}return!1}function Ba(){var a=fdjt.device,b=fdjt.cxprefix||"_",l=document.documentElement;a.ios&&q(l,b+"IOS");a.touch&&q(l,b+"TOUCH");a.mouse&&q(l,b+"MOUSE");a.android&&q(l,b+"Android")}function pa(a){q(document.body,
"_FOCUS")}function ta(a){g(document.body,"_FOCUS")}var za=!0,ia=fdjt.String,Ja=fdjt.Log,Sa=Array.prototype.slice,ba=/((^|[.#])[^.#\[\s]+)|(\[[^ \]=]+=[^\]]+\])|(\[[^ \]=]+\])/ig;a.useNative=function(a){if("undefined"===typeof a)return za;za=a};a.clone=function(a){return a.cloneNode(!0)};a.ie=function(){if("Microsoft Internet Explorer"===navigator.appName){var a=/MSIE ([0-9]{1,}[\.0-9]{0,})/,a=null!==a.exec(navigator.userAgent)?parseFloat(a.$1):1;0>=a&&(a=1);return a}return 0}();a.iem=Math.floor(a.ie);
fdjt.ID=n;a.appendArray=h;a.toArray=e;a.Array=v;a.slice=v;a.wrapChildren=function(b,l){l||(l="div.fdjtwrapper");var c=G(b,l);if(c&&c.nodeType&&c.parentNode===b)return c;c=a(l,e(b.childNodes));b.appendChild(c);return c};a.unwrapChildren=function(a,b){"string"===typeof a?a=b?fdjt.DOM.getChildren(b,a):fdjt.DOM.$(a):a.nodeType&&(a=[a]);for(var l=0,c=a.length;l<c;){var d=a[l++],f=document.createDocumentFragment();h(f,e(d.childNodes));d.parentNode.replaceChild(f,d)}};a.parsePX=k;a.getLineHeight=function(a,
b){b||(b=t(a));var l=b.lineHeight,c=b.fontSize;return"normal"===l?k(c):0<l.search(/px$/)?k(l):0<l.search(/%$/)?parseFloat(l.slice(0,-1))/100*k(c):k(c)};var Oa=/(\s)+/,eb=/^(\s)+|(\s)+$/,xa={};a.nodeString=function(a){if(3===a.nodeType)return"<'"+a.value+"'>";if(1===a.nodeType){var b="<"+a.tagName;a.id&&(b=b+"#"+a.id);"input"===a.tagName?(b=b+"[type="+a.type+"]",b=b+"[name="+a.name+"]"):"textarea"===a.tagName?b=b+"[name="+a.name+"]":"img"===a.tagName&&(a.alt?b=b+"[alt="+a.alt+"]":a.src&&(b=b+"[src="+
a.src+"]"));"string"===typeof a.className&&(b=b+"."+a.className.replace(/\s+/g,"."));return b+">"}return a.toString()};a.make=function(b,l,c,d){b=a(b);d||(d=c);c&&fdjt.Template(l,c);d.id&&!b.id&&(b.id=d.id);d.title&&!b.title&&(b.title=d.title);d.name&&!b.name&&(b.name=d.name);d.href&&!b.href&&(b.href=d.href);d.value&&!b.value&&(b.value=d.value);d.src&&!b.src&&(b.src=d.src);d.alt&&!b.alt&&(b.alt=d.alt);r(b,d);return b};a.getElementValues=p;a.getElementValue=function(a,b,l){return p(a,b,l,!1)};a.hasClass=
u;a.addClass=q;a.aC=q;a.classAdder=function(a,b){return function(){a&&q(a,b)}};a.dropClass=g;a.dC=g;a.classDropper=function(a,b){return function(){a&&g(a,b)}};a.swapClass=function(a,b,l,c){g(a,b,c);q(a,l,c)};a.setClass=function(a,b,l){"string"===typeof a&&(a=document.getElementById(a));l?q(a,b):g(a,b)};a.toggleClass=c;a.tC=c;a.toggleParent=b;a.tP=b;var Aa=a.text_input_types=/text|url|email|search|tel|number|range|password/i;a.isTextInput=function(a){return"INPUT"===a.tagName&&0===a.type.search(Aa)||
"TEXTAREA"===a.tagName};a.isImage=function(a){return"IMG"===a.tagName};var fb={};d.prototype.match=function(a){if(a.matches)return a.matches(this.spec);if(a.matchesSelector)return a.matchesSelector(this.spec);var b,l;if(this.compound){var c=this.compound;b=0;for(l=c.length;b<l;)if(c[b++].match(a))return!0;return!1}if(this.tag&&this.tag!==a.tagName||this.id&&this.id!==a.id)return!1;if(this.classes)if("string"===typeof a.className){var d=a.className,f=this.classes;b=0;for(l=f.length;b<l;)if(0>d.search(f[b++]))return!1}else return!1;
if(this.attribs)for(c in b=this.attribs,b)if(b.hasOwnProperty(c)){l=a.getAttribute(c);if(!l)return!1;d=this[c];if(!0!==d)if("string"===typeof d){if(d!==l)return!1}else if(0>l.search(d))return!1}return!0};d.prototype.find=function(a,b){var l,c,d;b||(b=[]);if(this.compound){l=this.compound;c=0;for(d=l.length;c<d;)l[c++].find(a,b);return b}if(this.id)return(l=document.getElementById(this.id))&&this.match(l)&&b.push(l),b;l=[];c=this.classnames;d=this.attribs;if(this.classes)a.getElementsByClassName?l=
a.getElementsByClassName(c[0]):A(a,this.classes[0],l);else if(this.tag&&a.getElementsByTagName)l=a.getElementsByTagName(this.tag);else if(this.attribs){d=this.attribs;for(var z in d)if(d.hasOwnProperty(z)){f(a,z,d[z],l);break}}else this.tag&&w(a,this.tag,l);if(0===l.length)return l;if(this.tag&&!this.classes&&!this.attribs||!this.tag&&this.classes&&1===this.classes.length&&!this.attribs){if(b.length){c=b;d=0;for(z=l.length;d<z;)c.push(l[d]),d++;return c}return l instanceof Array?l:e(l)}c=0;for(d=
l.length;c<d;)z=l[c++],this.match(z)&&b.push(z);return b};a.Selector=d;a.sel=function(a){if(a){if(a instanceof d)return a;if(a instanceof Array)return a.length?new d(a.join(",")):!1;if("string"===typeof a)return new d(a);Ja.warn("Non selector spec: %o",a)}return!1};a.getParent=D;a.hasParent=D;a.$P=D;a.inherits=function(a,b){var l=new d(b);return l.match(a)?a:D(a,l)};a.getParents=function(a,b){for(var l=[],c=a,d=!1;d=D(c,b);)l.push(d),c=d.parentNode;return l};a.getChildNodes=function(a){return 1!==
a.nodeType?[]:a.childNodes?e(a.childNodes):[]};a.getChildren=J;fdjt.$=a.$=function(a,b){return e(J(b||document,a))};fdjt.$1=a.$1=a.getChild=a.getFirstChild=G;a.getAttrib=function(a,b,l){var c;l&&a.getAttributeByNS&&(c=a.getAttributeNS(b,l));return c?c:a.getAttribute(b)||a.getAttribute("data-"+b)};a.findAttrib=function(a,b,l){for(var c="data-"+b;a;){if(l&&a.getAttributeNS&&a.getAttributeNS(b,l))return a.getAttributeNS(b,l);if(a.getAttribute){if(a.getAttribute(b))return a.getAttribute(b);if(a.getAttribute(c))return a.getAttribute(c)}a=
a.parentNode}return!1};a.getFirstElement=function(a){return a.firstElementChild?a.firstElementChild:a.children&&a.children.length?a.children[0]:!1};a.getLastElement=function(a){return a.lastElementChild?a.lastElementChild:a.children&&a.children.length?a.children[a.children.length-1]:!1};a.replace=function(a,b,l){var c=a;"string"===typeof a&&(c="#"===a[0]?document.getElementById(a.slice(1)):document.getElementById(a));c?(c.parentNode.replaceChild(b,c),l||!c.id||b.id||(b.id=c.id)):Ja.uhoh("Can't find %o to replace it with %o",
a,b)};a.remove=F;a.removeChildren=function(a){for(var b=a.childNodes,l=b.length-1;0<=l;)a.removeChild(b[l--])};a.append=function(a){"string"===typeof a&&(a=document.getElementById(a));h(a,Sa.call(arguments),1)};a.prepend=function(a){"string"===typeof a&&(a=document.getElementById(a));a.firstChild?m(a.firstChild,Sa.call(arguments),1):h(a,Sa.call(arguments),1)};a.insertBefore=function(a){"string"===typeof a&&(a=document.getElementById(a));m(a,Sa.call(arguments),1)};a.insertAfter=function(a){"string"===
typeof a&&(a=document.getElementById(a));a.nextSibling?m(a.nextSibling,Sa.call(arguments),1):h(a.parentNode,Sa.call(arguments),1)};a.Input=function(b,l,c,d){0!==b.search(/\w/)&&(b="INPUT"+b);b=a(b);b.name=l;c&&(b.value=c);d&&(b.title=d);return b};a.Checkbox=function(b,l,c){var d=a("INPUT");d.type="checkbox";d.name=b;l&&(d.value=l);d.checked=c?!0:!1;return d};a.Anchor=function(b,l){l=O(l,"A");var c=a(l);c.href=b;h(c,Sa.call(arguments),2);return c};a.Image=function(b,l,c,d){l=O(l,"IMG");var f=a(l);
f.src=b;c&&(f.alt=c);d&&(f.title=d);h(f,Sa.call(arguments),4);return f};a.getInputs=M;a.getInput=function(a,b,l){var c=M(a,b||!1,l||!1);return c&&1===c.length?c[0]:c&&c.length?(Ja.warn("Ambiguous input reference name=%o type=%o under %o",b,l,a),c[0]):!1};a.getInputValues=function(a,b){for(var l=[],c=a.getElementsByTagName("input"),d=0,f=c.length;d<f;){var e=c[d++];e.name===b&&("checkbox"!==e.type&&"radio"!==e.type||e.checked)&&l.push(e.value)}return l};a.getInputValue=function(a,b,l){var c=0;a=a.getElementsByTagName("input");
for(var d=0,f=a.length;d<f;){var e=a[d++];if(!e.disabled&&e.name===b&&("checkbox"!==e.type&&"radio"!==e.type||e.checked))if(l){if(c===l)return e.value;c++}else return e.value}return!1};a.getInputsFor=I;a.getInputFor=function(a,b,l){return(l=I(a,b||!1,l||!1))&&1===l.length?l[0]:l&&l.length?(Ja.warn("Ambiguous input reference name=%o name=%o under %o",b,b,a),l[0]):!1};a.setInputs=function(b,l){if(l)for(var c=a.$(b),d=0,f=c.length;d<f;)c[d++].value=l};a.getStyle=t;a.styleString=T;var kb={DIV:"block",
P:"block",BLOCKQUOTE:"block",H1:"block",H2:"block",H3:"block",H4:"block",H5:"block",H6:"block",H7:"block",H8:"block",UL:"block",LI:"list-item",DL:"block",DT:"list-item",DD:"list-item",SPAN:"inline",EM:"inline",STRONG:"inline",TT:"inline",DEFN:"inline",A:"inline",TD:"table-cell",TR:"table-row",TABLE:"table",PRE:"preformatted"};a.getDisplay=function(a){return a&&a.nodeType&&1===a.nodeType?window.getComputedStyle&&window.getComputedStyle(a,null)&&window.getComputedStyle(a,null).display||kb[a.tagName]||
"inline":!1};a.textify=K;P.prototype.width=P.prototype.height=P.prototype.left=P.prototype.right=P.prototype.top=P.prototype.bottom=0;C.prototype=new P;C.top_margin=C.bottom_margin=C.left_margin=C.right_margin=C.top_border=C.bottom_border=C.left_border=C.right_border=C.top_padding=C.bottom_padding=C.left_padding=C.right_padding=C.outer_height=C.outer_width=C.inner_height=C.inner_width=C.line_height=0;a.getGeometry=U;a.XGeometry=C;a.Geometry=P;a.geomString=function(a){return+("number"===typeof a.width?
a.width:NaN)+"x"+("number"===typeof a.height?a.height:"?")+"@l:"+("number"===typeof a.left?a.left:"?")+",t:"+("number"===typeof a.top?a.top:"?")+"/r:"+("number"===typeof a.right?a.right:"?")+",b:"+("number"===typeof a.bottom?a.bottom:"?")};a.isVisible=function(a,b){b||(b=!1);if(a.offsetParent&&a.offsetParent!==document.body){var l=a.offsetParent,c=a.offsetTop,d=c+a.offsetHeight,f=a.offsetLeft,e=f+a.offsetWidth,z=l.scrollLeft,r=z+l.clientWidth,aa=l.scrollTop,l=aa+l.clientHeight;return b?(f>=z&&f<=
r||e>=z&&e<=r||f<z&&e>r)&&(c>=aa&&c<=l||d>=aa&&d<=l||c<=aa&&d>=l):f>=z&&f<=r&&e>=z&&e<=r&&c>=aa&&c<=l&&d>=aa&&d<=l}c=a.offsetTop;d=a.offsetLeft;f=a.offsetWidth;e=a.offsetHeight;z=window.pageXOffset||document.documentElement.scrollLeft||0;r=window.pageYOffset||document.documentElement.scrollTop||0;aa=z+document.documentElement.clientWidth;for(l=r+document.documentElement.clientHeight;a.offsetParent&&a!==window;)a=a.offsetParent,c+=a.offsetTop,d+=a.offsetLeft;a&&a!==window&&a!==document.body&&(a.scrollTop||
a.scrollLeft)&&(Ja("Adjusting for inner DIV"),z=a.scrollLeft,r=a.scrollTop,aa=z+a.scrollWidth,l=r+a.scrollHeight);return b?c>r&&c<l&&d>z&&d<aa||c+e>r&&c+e<l&&d+f>z&&d+f<aa||(c<r||d<z)&&c+e>l&&d+f>aa:c>r&&d>z&&c+e<=l&&d+f<=aa};a.isAtTop=function(a,b){b||(b=50);for(var l=a.offsetTop,c=window.pageYOffset||document.documentElement.scrollTop||0,d=c+document.documentElement.clientHeight;a.offsetParent;)a=a.offsetParent,l+=a.offsetTop;return l>c&&l<d&&l<c+b};a.textWidth=V;a.countBreaks=function(a){if("string"===
typeof a)return a.match(/\W*\s+\W*/g).length;if(!a.nodeType)return 0;if(1!==a.nodeType)return 3===a.nodeType?a.nodeValue.match(/\W*\s+\W*/g).length:0};var Y=/(img|object|svg|hr)/i;a.hasContent=B;a.hasText=function(a){if(a.childNodes){a=a.childNodes;for(var b=0;b<a.length;){var l=a[b++];if(3===l.nodeType&&0<=l.nodeValue.search(/\w/g))return!0}}return!1};a.refresh=function(a){a.className=a.className};a.setAttrib=function(a,b,l){"string"===typeof a&&n(a)&&(a=n(a));a.setAttribute(b,l);a.className=a.className};
a.dropAttrib=function(a,b){"string"===typeof a&&n(a)&&(a=n(a));a.removeAttribute(b);a.className=a.className};a.overflowing=function(a){return a.scrollHeight>a.clientHeight};a.voverflow=function(a){return a.scrollHeight/a.clientHeight};a.hoverflow=function(a){return a.scrollWidth/a.clientWidth};a.addListener=N;a.defListeners=function(a,b){if(a&&b)for(var l in b)if(b.hasOwnProperty(l)){var c=b[l],d=a[l];d&&a.hasOwnProperty(l)||(a[l]=d={});for(var f in c)c.hasOwnProperty(f)&&(d[f]=c[f])}};var Ga=/^([^:]+)$/,
Ea=/^([^: ]+):([^: ]+)$/;a.addListeners=r;a.removeListener=da;a.T=X;a.eventTarget=X;a.getTarget=X;a.cancel=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1;a.cancelBubble=!0};a.triggerClick=function(a){if(document.createEvent){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}else Ja.warn("Couldn't trigger click")};a.pageScroll=function(a,b){var l=a.clientHeight,c=a.scrollHeight,d=a.scrollTop+l*b;l>=c||(a.scrollTop=0>d?0:d+l>=
c?c-l:d)};a.getInsideBounds=S;a.applyScale=oa;a.adjustToFit=function(b,l,c){var d=b.traceadjust||a.trace_adjust||"string"===typeof b.className&&0<=b.className.search(/\btraceadjust\b/)||!1,f=t(b),e=U(b),z=f.maxHeight&&k(f.maxHeight)||e.height,e=f.maxWidth&&k(f.maxWidth)||e.width,r=l||.1;l=b.scale||100;var aa=S(b),g=(a.parsePX(f.paddingLeft)||0)+(a.parsePX(f.paddingRight)||0)+(a.parsePX(f.borderLeftWidth)||0)+(a.parsePX(f.borderRightWidth)||0)+c;c=(a.parsePX(f.paddingTop)||0)+(a.parsePX(f.paddingBottom)||
0)+(a.parsePX(f.borderTopWidth)||0)+(a.parsePX(f.borderBottomWidth)||0)+c;e-=g;z-=c;c=1>=aa.height/z&&1>=aa.width/e;d&&Ja("Adjust (%o) %s cur=%o%s, best=%o~%o, limit=%ox%o=%o, box=%ox%o=%o, style=%s",r,a.nodeString(b),l,c?" (fits)":"",b.bestscale||-1,b.bestfit||-1,e,z,e*z,aa.width,aa.height,aa.width*aa.height,T(b));if(c&&(f=Math.max(1-aa.width/e,1-aa.height/z),g=b.bestfit||1.5,d&&(b.bestscale?Ja("%s %o~%o vs. %o~%o",f<r?"Good enough!":f<g?"Better!":"Worse!",l,f,b.bestscale,b.bestfit):Ja("First fit %o~%o",
l,f)),f<g&&(b.bestscale=l,b.bestfit=f),f<r)){b.goodscale=l;return}r=z/aa.height;f=e/aa.width;z=c?l*Math.sqrt(e*z/(aa.width*aa.height)):r<f?l*r:l*f;d&&Ja("[%fs] Trying newscale=%o, rw=%o rh=%o",fdjt.ET(),z,f,r);oa(b,z,d)};a.adjustInside=function(b,l,c,d,f){function e(){var a=U(l),aa=U(b,l),g=t(l),B=a.width-(k(g.paddingLeft,0)+k(g.borderLeft,0)+k(g.paddingRight,0)+k(g.borderRight,0)),a=a.height-(k(g.paddingTop,0)+k(g.borderTop,0)+k(g.paddingBottom,0)+k(g.borderBottom,0));z&&Ja("adjustInside scale=%o step=%o min=%o pad=%o [l%o,t%o,r%o,b%o] << %ox%o < %ox%o",
r,c,d,f,aa.left,aa.top,aa.right,aa.bottom,B*f,a*f,B,a);0<=aa.top&&aa.bottom<=f*a&&0<=aa.left&&aa.right<=f*B||r<=d||(r-=c,oa(b,r,z),setTimeout(e,10))}var z=b.traceadjust||l.traceadjust||a.trace_adjust||"string"===typeof b.className&&0<=b.className.search(/\btraceadjust\b/)||"string"===typeof l.className&&0<=l.className.search(/\btraceadjust\b/)||!1;c||(c=5);d||(d=50);f||(f=1);var r=100;setTimeout(e,10)};a.insideBounds=S;a.finishScale=function(b){var l=b.traceadjust||a.trace_adjust||!1;b.bestscale?
(b.scale!==b.bestscale&&oa(b,b.bestscale,l),l&&Ja("Final scale %o~%o for %o style=%s",b.bestscale,b.bestfit,a.nodeString(b),a.styleString(b)),delete b.bestscale,delete b.bestfit,delete b.goodscale):(oa(b,!1,l),Ja("No good scaling for %o style=%s",a.nodeString(b),a.styleString(b)))};a.scaleToFit=function(b,l,c){a.addClass(b,"fdjtadjustfit");l&&"number"!==typeof l&&(l=.9);l&&b.setAttribute("data-fudge",l);c&&b.setAttribute("data-origin",c);ga(b,l,c);return b};a.scaleToFit.scaleNode=a.scaleToFit.adjust=
ga;a.scaleToFit.revert=Ma;a.scaleToFit.revertAll=function(){for(var b=a.$(".fdjtadjusted"),l=0,c=b.length;l<c;){var d=b[l++];Ma(d.parentNode,d)}};fdjt.addInit(ca);a.addListener(window,"resize",ca);a.getHTML=function(){for(var a=document.childNodes,b=0,l=a.length;b<l;){if("HTML"===a[b].tagName)return a[b];b++}return!1};a.getHEAD=function(){for(var a=document.childNodes,b=0,l=a.length;b<l;)if("HTML"===a[b].tagName){a=a[b].childNodes;b=0;for(l=a.length;b<l;){if("HEAD"===a[b].tagName)return a[b];b++}break}else b++;
return!1};var Pa={},la={},wa={};a.addAppSchema=function(a,b){wa[a]=b};var va=ia.escapeRX;a.getMeta=aa;a.getMetaElts=function(a){return aa(a,!0,void 0,!0)};a.getLink=z;a.getLinks=function(a){return z(a,!0)};a.getLinkElts=function(a){return z(a,!0,void 0,!0)};var sa=document&&document.body&&document.body.childNodes&&document.body.children;a.nextElt=Ka;a.forwardElt=Ra;a.forward=function(a,b,l){if(!b)return l?Ra(a):Va(a);for(a=l?Ra(a):Va(a);a;){if(b(a))return a;a=l?Ka(a):Ca(a)}return!1};a.next=function(a,
b,l){if(!b)return l?sa?a.nextElementSibling:Ka(a):Ca(a);for(a=l?sa?a.nextElementSibling:Ka(a):a.nextSibling||Ca(a);a;){if(b(a))return a;a=l?a.nextElementSibling||Ka(a):a.nextSibling||Ca(a)}return!1};a.prevElt=ua;a.backwardElt=Ia;a.backward=function(a,b,l){if(!b)return l?Ia(a):bb(a);for(a=l?Ia(a):bb(a);a;){if(b(a))return a;a=l?Ka(a):Ca(a)}return!1};a.prev=function(a,b,l){if(!b)return l?sa?a.previousElementSibling:ua(a):fa(a);for(a=l?sa?a.previousElementSibling:ua(a):fa(a);a;){if(b(a))return a;a=l?
sa?a.previousElementSibling:ua(a):fa(a)}return!1};a.viewTop=function(a){if("string"!==typeof a||(a=document.getElementById(a)))return!a||a===window||window.Window&&a instanceof window.Window?(a=a||window,a.pageYOffset||a.scrollY||a.document.documentElement.scrollTop||0):a.scrollTop};a.viewLeft=function(a){if("string"!==typeof a||(a=document.getElementById(a)))return!a||a===window||window.Window&&a instanceof window.Window?(a=a||window,a.pageXOffset||a.scrollX||a.document.documentElement.scrollLeft||
0):a.scrollLeft};a.viewHeight=Za;a.viewWidth=ab;a.getOrientation=function(a){if("string"!==typeof a||(a=document.getElementById(a))){a||(a=window);if(a.hasOwnProperty("orientation"))return 90===a.orientation||-90===a.orientation?"landscape":"portrait";var b=ab(a);a=Za(a);return b>a?"landscape":"portrait"}};var R=0,Ya=Math.floor(1E5*Math.random());a.getNodeID=function(a){var b=a.id,l;if(!b){for(b="TMPID_"+Ya+"_"+R++;!(l=document.getElementById(b))||l===a;)b="TMPID_"+Ya+"_"+R++,(l=document.getElementById(b))&&
l!==a||(Ya=Math.floor(1E5*Math.random())),b="TMPID_"+Ya+"_"+R++;a.id=b}return b};a.stripIDs=$a;a.getCSSRule=nb;a.dropCSSRule=function(a){return nb(a,"delete")};a.addCSSRule=function(b,l,c){if(!c){c=n("FDJTSTYLES");if(!c){var d=document.getElementsByTagName("HEAD");if(0===d.length)return;d=d[0];c=a("style#FDJTSTYLES");d.appendChild(c)}c=c.sheet}if(c&&(c.insertRule||c.addRule)){var d=c.cssRules||c.rules,f=d.length;c.insertRule?c.insertRule(b+" {"+l+"}",f):c.addRule(b,l,f);return d[f]}return!1};var Qa;
a.useSVG=Na;a.useBMP=function(){for(var a=ia.hasSuffix,b=fdjt.$("IMG"),l=0,c=b.length;l<c;){var d=b[l++],f=d.src;f&&(a(f,".svg")||a(f,".svgz"))&&(f=d.getAttribute("bmp"))&&(d.setAttribute("svg",d.src),d.src=f)}};a.prefSVG=function(){Qa||Na()};a.checkSVG=La;a.init=fdjt.Init;a.addInit=fdjt.addInit;fdjt.addInit(function(){sa=document&&document.body&&document.body.childNodes&&document.body.children},"checkChildren");fdjt.addInit(La,"checkSVG");0<=navigator.userAgent.search("WebKit")?(a.transition||(a.transition=
"-webkit-transition"),a.transitionProperty||(a.transitionProperty="-webkit-transition-property"),a.transitionDuration||(a.transitionDuration="-webkit-transition-duration"),a.transitionDelay||(a.transitionDelay="-webkit-transition-delay"),a.transitionTiming||(a.transitionTiming="-webkit-transition-timing-function"),a.transform||(a.transform="-webkit-transform"),a.transformOrigin||(a.transformOrigin="-webkit-transform-origin"),a.columnWidth||(a.columnWidth="-webkit-column-width"),a.columnGap||(a.columnGap=
"-webkit-column-gap")):0<=navigator.userAgent.search("Mozilla")?(a.transition||(a.transition="-moz-transition"),a.transitionProperty||(a.transitionProperty="-moz-transition-property"),a.transitionDuration||(a.transitionDuration="-moz-transition-duration"),a.transitionDelay||(a.transitionDelay="-moz-transition-delay"),a.transitionTiming||(a.transitionTiming="-moz-transition-timing-function"),a.transform||(a.transform="-moz-transform"),a.transformOrigin||(a.transformOrigin="-moz-transform-origin"),
a.columnWidth||(a.columnWidth="MozColumnWidth"),a.columnGap||(a.columnGap="MozColumnGap")):(a.transition||(a.transition="transition"),a.transitionProperty||(a.transitionProperty="transition-property"),a.transitionDuration||(a.transitionDuration="transition-duration"),a.transitionDelay||(a.transitionDelay="transition-delay"),a.transitionTiming||(a.transitionTiming="transition-timing-function"),a.transform||(a.transform="transform"),a.transformOrigin||(a.transformOrigin="-moz-transform-origin"));"undefined"!==
typeof document.hidden?(a.isHidden="hidden",a.vischange="visibilitychange"):"undefined"!==typeof document.webkitHidden?(a.isHidden="webkitHidden",a.vischange="webkitvisibilitychange"):"undefined"!==typeof document.mozHidden?(a.isHidden="mozHidden",a.vischange="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(a.isHidden="msHidden",a.vischange="msvisibilitychange"):(a.isHidden=!1,a.vischange=!1);a.getSelectedRange=function(a){if(!a)if(window.getSelection)a=window.getSelection();else if(document.selection)a=
document.selection.createRange();else return!1;if(!a)return!1;if(a.getRangeAt)return a.rangeCount?a.getRangeAt(0):!1;if(document.createRange){var b=document.createRange();b.setStart(a.anchorNode,a.anchorOffset);b.setEnd(a.focusNode,a.focusOffset);return b}return!1};a.rangeIsEmpty=function(a){return a?a.startContainer===a.endContainer&&a.startOffset===a.endOffset?!0:!1:!0};a.clearSelection=function(a){a||(a=document.selection||window.getSelection());a.removeAllRanges?a.removeAllRanges():a.empty&&a.empty()};
a.node2text=H;a.textPos=ha;a.refineRange=function(a){if(3===a.startContainer.nodeType&&3===a.endContainer.nodeType)return a;var b=ha(a.startContainer,a.startOffset);a=ha(a.endContainer,a.endOffset);var l=document.createRange();l.setStart(b.node,b.off);l.setEnd(a.node,a.off);return l};a.textOff=ka;a.getRangeInfo=function(a,b){var l=a.startContainer;b||(b=Q(l));var c=ka(b,l,0),d=a.endContainer,f=l===d?b:D(d,b)?b:Q(d),l=l===d?c:ka(f,d,0);return{start:c+a.startOffset,starts_in:b.id,ends_in:f.id,end:l+
a.endOffset}};a.getRegexString=L;a.textRegExp=Z;a.wordRegExp=function(a,b,l){"undefined"===typeof l&&(l=!0);return new RegExp(L(a,l,"\\b","\\b"),b?"igm":"gm")};a.findString=function(a,b,l,c){"undefined"===typeof l&&(l=0);"undefined"===typeof c&&(c=1);b=b.replace(/\u00ad/mg,"");var d=!1,d=H(a),f=0===l?d:d.slice(l),e=f.replace(/\u00ad/mg,"");for(b="string"===typeof b?Z(b,!1,!1):b;d=b.exec(e);){if(1===c){c=d.index;if(e!==f)for(e=0;e<c;)"\u00ad"===f[e]&&c++,e++;f=c+l;l=W(a,f,0,!0);a=W(a,f+d[0].length,
0);if(!l||!a)break;d=document.createRange();l.atend?(f=na(l.node.nextSibling))?d.setStart(f,0):d.setStart(l.node,l.off):d.setStart(l.node,l.off);d.setEnd(a.node,a.off);return d}c--;l=d.index+d[0].length;e=e.slice(l)}return!1};a.findMatches=function(a,b,l,c){"undefined"===typeof l&&(l=0);"undefined"===typeof c&&(c=-1);var d=!1,f=[],e=H(a),e=0===l?e:e.slice(l);for(b="string"===typeof b?Z(b):b;0!==c&&(d=b.exec(e));){var z=d.index+l,r=W(a,z,0),z=W(a,z+d[0].length,0);if(!r||!z)return!1;var aa=document.createRange();
if("number"===typeof r)aa.setStart(a,r);else if(r.atend){var g=na(r.node.nextSibling);g?aa.setStart(g,0):aa.setStart(r.node,r.off)}else aa.setStart(r.node,r.off);"number"===typeof z?aa.setEnd(a,z):aa.setEnd(z.node,z.off);f.push(aa);c--}return f};var ja=["transitionend","webkitTransitionEnd","mozTransitionEnd","oTransitionEnd","msTransitionEnd"];fdjt.addInit(function(){var b=document.createElement("div");if(b.removeEventListener){var l=function(c){a.transitionEnd=c.type;c=0;for(var d=ja.length;c<d;)b&&
b.removeEventListener?b.removeEventListener(ja[c++],l):c++};b.setAttribute("style","position:absolute;top:0px;transition:top 1ms ease;-webkit-transition:top 1ms ease;-moz-transition:top 1ms ease;-o-transition:top 1ms ease;-ms-transition:top 1ms ease;");for(var c=0,d=ja.length;c<d;)b.addEventListener(ja[c++],l,!1);document.documentElement.appendChild(b);setTimeout(function(){b.style.top="100px";setTimeout(function(){b.parentNode.removeChild(b);b=l=null},2E3)},0)}},"checkTransitionEvents");var Fa="email number range tel url datetime datetime-local date time week month".split(" ");
a.setupCustomInputs=ma;fdjt.addInit(ma,"CustomInputs");a.text_types=/\b(text|email|number|range|tel|url|datetime|datetime-local|date|time|week|month)\b/i;fdjt.addInit(function(){var a="media";if(window.matchMedia){var b=window.matchMedia("handheld");b.match&&(a+=" handheld");b=window.matchMedia("(max-width:500px)");b.match&&(a+=" narrow");b=window.matchMedia("(min-width:1000px)");b.match&&(a+=" wide");b=window.matchMedia("(-webkit-min-device-pixel-ratio:1.5),(-min-resolution:15dp)");b.match&&(a+=
" hires")}fdjt.media=a},"matchMedia");fdjt.getMediaState=function(){return window.getComputedStyle(document.body,":before").content};a.insertText=function(a,b,l){var c=a.selectionStart,d=a.value;a.value=d&&"number"===typeof c&&0<=c?d.slice(0,c)+b+d.slice(c):b;"number"===typeof l&&(a.selectionEnd=a.selectionStart=c+l)};fdjt.addInit(function(){for(var a=document.getElementsByTagName&&document.getElementsByTagName("link")||document.head.getElementsByTagName&&document.head.getElementsByTagName("link")||
J(document,"link"),b=0,l=a.length;b<l;){var c=a[b++];if(c.rel&&c.href&&0===c.rel.search("schema.")){var d=c.rel.slice(7),c=c.href;la[d]?Ja.warn("Conflicting schemas for %s",d):(Pa[c]?Pa[c].push(d):Pa[c]=[d],la[d]=c)}}},"MetaSchemas");fdjt.noinit&&"undefined"!==typeof _fdjt_init&&_fdjt_init||a.addListener(window,"load",a.init);a.playAudio=function(a){(a=document.getElementById(a))&&a.play&&(a.paused||(a.pause(),a.currentTime=0),a.play())};a.tweakImage=function(a,b,l){var c=a.style;c.maxHeight=c.minHeight=
"inherit";c.maxWidth=c.minWidth="inherit";var d=a.offsetWidth;a=a.offsetHeight;b/=d;l/=a;b<l?(c.width=Math.round(d*b)+"px",c.height="auto"):(c.height=Math.round(a*l)+"px",c.width="auto")};ia.makeBlob=ib;a.data2URL=function(a){return URL&&URL.createObjectURL?URL.createObjectURL(ib(a)):a};a.addUXClasses=Ba;a.addUSClasses=Ba;a.addCXClasses=Ba;fdjt.addInit(Ba,"AddUXClasses");a.focus=function(a){var b=document.getElementById(a);b&&setTimeout(function(){b.focus()},10)};a.blur=function(a){var b=document.getElementById(a);
b&&setTimeout(function(){b.blur()},10)};fdjt.addInit(function(){pa();N(window,"focus",pa);N(window,"blur",ta)});a.trace_adjust=!1;return a}();
(function(){function a(a){var e=(new Date).getTime(),u=Math.max(0,16-(e-h)),q=window.setTimeout(function(){a(e+u)},u);h=e+u;return q}function n(a){clearTimeout(a)}for(var h=0,m=window.requestAnimationFrame&&function(a){window.requestAnimationFrame(a)},e=window.cancelAnimationFrame&&function(a){window.cancelAnimationFrame(a)},v=["webkit","moz","ms","o"],k=0;k<v.length&&!window.requestAnimationFrame;++k)m=m||window[v[k]+"RequestAnimationFrame"],e=e||window[v[k]+"CancelAnimationFrame"]||window[v[k]+
"CancelRequestAnimationFrame"];m||(m=a,e=n);fdjt.DOM.rAF=fdjt.DOM.requestAnimationFrame=m;fdjt.DOM.cAF=fdjt.DOM.cancelAnimationFrame=e})();(function(){function a(a,b,d,g,h,f,q,u,m,p){d=e(a.scrollWidth);var n=e(a.scrollHeight),v,x,M=a.style;"number"!==typeof m&&(m=1);if(d<=q&&n<=u&&n>=u-m)return g;if(d>q||n>u)b=-b;0<b&&(M.maxWidth=e(q)+"px");g||(g=100,M.fontSize=g+"%");h||(h=20);f||(f=150);x=g+b;M.fontSize=x+"%";m=e(a.scrollWidth);for(v=e(a.scrollHeight);g>=h&&g<=f&&(0<b?m<q&&v<u:m>q||v>u);)g=x,x+=b,M.fontSize=x+"%",p&&k("Adjust %o to %dx%d %o: size=%d=%d+(%d), %dx%d => %dx%d",a.parentNode,q,u,a,x,g,b,d,n,m,v),m=e(a.scrollWidth),v=e(a.scrollHeight);
M.maxWidth="";return 0<b?(M.fontSize=g+"%",g):x}function n(c,b,d,e){var h=c.offsetHeight,f=c.offsetWidth,q=g(c,"_fdjtlog"),m="";if(0===h||0===f)if(m=c.style.display,c.style.display="initial",h=c.offsetHeight,f=c.offsetWidth,0===h||0===f){c.style.display=m;return}if(0===h||0===f)c.style.display=m;else{var n=p(c,"div.fdjtfontwrapper"),y=n.style,E=100;y.boxSizing="border-box";y.padding=y.margin="0px";y.fontSize=E+"%";y.transitionProperty="none";y.transitionDuration="0s";y[v.transitionProperty]="none";
y[v.transitionDuration]="0s";y.visibility="visible";if(0===h||0===f)c.removeChild(n),v.append(c,Array.prototype.slice.call(n.childNodes)),c.style.display=m;else return b=b||c.getAttribute("data-minfont")||20,d=d||c.getAttribute("data-maxfont")||200,"number"!==typeof e&&(e=c.getAttribute("data-fudge")),"string"===typeof b&&(b=parseFloat(b,10)),"string"===typeof d&&(d=parseFloat(d,10)),"string"===typeof e&&(e=parseInt(e,10)),"number"!==typeof e&&(e=2),y.width=y.height="100%",y.width=y.height="100%",
y.maxWidth=y.maxHeight="100%",f=n.offsetWidth,h=n.offsetHeight,y.width=y.height="",E=a(n,10,!1,E,b,d,f,h,e,q),E=a(n,5,!1,E,b,d,f,h,e,q),E=a(n,1,!1,E,b,d,f,h,e,q),y.maxWidth=y.maxHeight="",c.style.display=m,100===E?(q&&k("No need to resize %o towards %dx%d",c,f,h),c.removeChild(n),v.append(c,Array.prototype.slice.call(n.childNodes))):(y.width="",y.height="",y.maxWidth="",y.maxHeight="",q&&k("Adjusted (%s) %o towards %dx%d, wrapper @ %d,%d",y.fontSize,c,f,h,n.scrollWidth,n.scrollHeight),y.transitionProperty=
"",y.transitionDuration="",y[v.transitionProperty]="",y[v.transitionDuration]="",u(n)[v.transitionProperty]?(y.fontSize="",y.visibility="",y.fontSize=E+"%"):y.visibility=""),E}}function h(a,b){var d=[];a?"string"===typeof a?document.getElementByID(a)?d=[document.getElementByID(a)]:(v.autofont=v.autofont+","+a,d=v.$(a)):d=1===a.nodeType?(new q(v.autofont)).match(a)?[a]:v.getChildren(a,v.autofont):v.$(v.autofont):d=v.$(v.autofont);var e=0,g=d.length;if(g)for(;e<g;)n(d[e++]);else b&&n(b)}function m(a){if(a&&
1===a.nodeType){var b=u(a);if(a.childNodes&&a.childNodes.length)for(var d=a.childNodes,e=0,g=d.length;e<g;){var f=d[e++];1===f.nodeType&&m(f)}"block"!==b.display&&"inline-block"!==b.display||"absolute"!==b.position&&"fixed"!==b.position||n(a)}}var e=Math.floor,v=fdjt.DOM,k=fdjt.Log,x=v.getFirstChild,p=v.wrapChildren,u=v.getStyle,q=v.Selector,g=v.hasClass;v.adjustFontSize=v.tweakFontSize=n;v.resetFontSize=function(a){if(a=x(a,".fdjtfontwrapper"))a.style.fontSize="100%"};v.autofont=".fdjtadjustfont,.adjustfont";
v.tweakFont=v.tweakFonts=v.adjustFont=v.adjustFonts=h;v.adjustLayoutFonts=function(a){var b=v.getChildren(a,v.autofont),d=0,e=b.length;if(0===e)m(a);else for(;d<e;)n(b[d++])};fdjt.addInit(function(){v.noautofontadjust||(h(),v.addListener(window,"resize",h))},"adjustFonts")})();"undefined"===typeof window||window.JSON||(window.JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function n(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var e=x[a];return"string"===typeof e?e:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function h(a,e){var g,c,b,d,A=v,w,f=e[a];f&&"object"===typeof f&&"function"===typeof f.toJSON&&(f=f.toJSON(a));"function"===typeof p&&(f=p.call(e,a,f));switch(typeof f){case "string":return n(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);
case "object":if(!f)return"null";v+=k;w=[];if("[object Array]"===Object.prototype.toString.apply(f)){d=f.length;for(g=0;g<d;g+=1)w[g]=h(g,f)||"null";b=0===w.length?"[]":v?"[\n"+v+w.join(",\n"+v)+"\n"+A+"]":"["+w.join(",")+"]";v=A;return b}if(p&&"object"===typeof p)for(d=p.length,g=0;g<d;g+=1)c=p[g],"string"===typeof c&&(b=h(c,f))&&w.push(n(c)+(v?": ":":")+b);else for(c in f)Object.hasOwnProperty.call(f,c)&&(b=h(c,f))&&w.push(n(c)+(v?": ":":")+b);b=0===w.length?"{}":v?"{\n"+v+w.join(",\n"+v)+"\n"+
A+"}":"{"+w.join(",")+"}";v=A;return b}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var m=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,v,k,x={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},p;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,e,g){var c;k=v="";if("number"===typeof g)for(c=0;c<g;c+=1)k+=" ";else"string"===typeof g&&(k=g);if((p=e)&&"function"!==typeof e&&("object"!==typeof e||"number"!==typeof e.length))throw Error("JSON.stringify");return h("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,e){function g(a,c){var h,w,f=a[c];if(f&&"object"===typeof f)for(h in f)Object.hasOwnProperty.call(f,h)&&(w=g(f,h),void 0!==w?f[h]=w:delete f[h]);return e.call(a,c,f)}var c;m.lastIndex=0;m.test(a)&&(a=a.replace(m,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return c=eval("("+a+")"),"function"===typeof e?g({"":c},""):c;throw new SyntaxError("JSON.parse");})})();fdjt.JSON||(fdjt.JSON=JSON);fdjt.RefDB=function(){function a(a,b){var c=this;U[a]?(c=U[a],b&&c.init?c.xinits?c.xinits.push(b):c.xinits=[b]:b?c.init=b:b={}):b&&b.aliases&&n(b.aliases)?(c=n(b.aliases),0<=c.aliases.indexOf(c.name)&&(c.name=a),b&&c.init?c.xinits?c.xinits.push(b):c.xinits=[b]:b?c.init=b:b={}):(b||(b={}),c.name=a,U[a]=c,V.push(c),c.aliases=[],c.complete=!1,c.refs={},c.altrefs={},c.allrefs=[],c.loaded=[],c.changes=[],c.changed=!1,c.storage=b.storage||!1,c.absrefs=b.absrefs||!1,c.oidrefs=b.oidrefs||!1,c.onload=[],c.onloadnames=
{},c.onadd={},c.ondrop={},c.indices={});b.hasOwnProperty("absrefs")&&(c.absrefs=b.absrefs);if(b.aliases)for(var d=b.aliases,f=0,e=d.length;f<e;){var r=d[f++];d[r]?d[r]!==c&&C("Alias %s for %o already associated with %o",r,c,d[r]):(d[r]=c,c.aliases.push(r))}if(b.onload){var d=b.onload,g;for(g in d)if(d.hasOwnProperty(g))c.onLoad(d[g],g)}if(b.indices)for(g=b.indices,d=0,f=g.length;d<f;)e=g[d++],"string"!==typeof e?C("Complex indices not yet handled!"):(this.indices[e]=new G).fordb=c;return c}function n(a){for(var b=
0,c=a.length;b<c;){var d=a[b++];if(d=U[d])return d}return!1}function h(a){return U.hasOwnProperty(a)&&U[a]||N.hasOwnProperty(a)&&N[a]||!1}function m(b,c,d,f){"function"!==typeof d&&(d=a);if(b){if(b instanceof e)return b;if("object"===typeof b&&b.id)return v(b,c);if(c&&c.refs.hasOwnProperty(b))return c.refs[b];if(c&&c.probe(b))return c.probe(b);if("string"===typeof b&&ga.exec(b)){var r=b.indexOf("@");1===r&&":"===b[0]&&(b=b.slice(1),r=0);if(0<r){var g=!1,t=b.slice(r+1),B;h(t)||(ga.exec(t)?(B=m(t))?
f=!0:t=b.slice(r+1):t=b.slice(r+1));g=c&&c.name===t?c:h(t);b=b.slice(0,r);g?c=g:f?(C("Creating forced RefDB domain %s for reference %s",t,b),c=a.open(t,d)):c=h(t);c&&B&&(c.origin=B,B.name&&(c.fullname=B.name));b=b.slice(0,r)}else 0>r?(g=0===b.search(":#U")?b.slice(3):0===b.search("#U")?b.slice(2):0===b.search("U")?b.slice(1):b,r=g.indexOf("t"),t=b.length-2,r=0<r?"UUID"+g.slice(r):!1,t=0<t?"-UUIDTYPE="+g.slice(t):!1,(g=r&&(U[r]||N[r])||t&&(U[t]||N[t]))?c=g:f&&r&&d&&(C("Creating forced RefDB domain %s for reference %s",
r,b),c=new d(r),r&&c.addAlias(r))):"@"===b[1]?(c=b.indexOf("/"),d=b.slice(0,c),(r=N[d])?c=r:(c=ca(b.slice(0,c),!0))?c=new a(c,{aliases:[d]}):(C("Can't find domain for atid %s when resolving %s",d,b),c=!1)):("/"===b[1]?(c=b.slice(2).indexOf("/"),0<c&&(c+=2)):c=b.indexOf("/"),c=b.slice(r,c+1),c=U[c]||N[c]||d&&new d(c))}}else return b;return c?c.refs.hasOwnProperty(b)?c.refs[b]:f?c.ref(b):!1:!1}function e(a,b,c){if(0===arguments.length)return this;var d=a.indexOf("@");if(1<d&&"\\"!==a[d-1]){var f=a.slice(d+
1);f!==b.name&&0>b.aliases.indexOf(f)&&C("Reference to %s being handled by %s",a,b);a=a.slice(0,d)}return b.refs.hasOwnProperty(a)?b.refs[a]:c?(c._id=a,c._db=b,b.absrefs||(c._domain=b.name),b.refs[a]=c,b.allrefs.push(c),c):!b.refclass||this instanceof b.refclass?(this._id=a,this._db=b,b.absrefs||(this._domain=b.name),b.refs[a]=this,b.allrefs.push(this),this):new b.refclass(a,b)}function v(b,c,d){var f=!1;b._domain&&(f=a.probe(b._domain)||new a(b._domain));return f?f.ref(b._id):a.resolve(b._id,c,d||
a,!0)}function k(a,b,c){if("undefined"===typeof a||"number"===typeof a||null===a||a instanceof e)return a;if(a instanceof Array){for(var d=0,f=a.length,r=!1;d<f;){var g=a[d++],t=g;if(null===g)t=void 0;else if(g instanceof e)t=g;else if("object"===typeof g&&g._id){var B=v(g,b);if(B){for(var h in g)g.hasOwnProperty(h)&&"_id"!==h&&"_db"!==h&&(B[h]=k(g[h],b,c));t=B}}else c&&"string"===typeof g&&ga.exec(g)&&(t=m(g,b)||g);"undefined"===typeof t?r||(r=a.slice(0,d-1)):r?r.push(t):t!==g&&(r=a.slice(0,d-1),
r.push(t))}return r?r:a}if("object"===typeof a&&a._id){h=v(a,b);for(d in a)a.hasOwnProperty(d)&&"_id"!==d&&"_db"!==d&&(h[d]=k(a[d],b,c));return h}return c&&"string"===typeof a&&ga.exec(a)?m(a,b)||a:a}function x(a,b,c,d,f){(c=m(a._id,a._domain||c,c.constructor,!0))?(b.push(c),c.Import(a,d||!1,f)):C("Couldn't resolve database for %o",a._id)}function p(a,b){if(a instanceof e)return a._db===b?{_id:a._id}:a._db.absrefs?{_id:a._id}:{_id:a._id,_domain:a._domain||a._db.name};if(a instanceof Array){for(var c=
0,d=a.length,f=!1;c<d;){var r=a[c++],g=p(r,b);r!==g?(f||(f=a.slice(0,c-1)),f.push(g)):f&&f.push(r)}return f||a}if("object"===typeof a){c=!1;d=[];for(f in a)if(a.hasOwnProperty(f))if(g=a[f],r=p(g,b),g!==r){if(!c&&(c={},d.length))for(var g=0,t=d.length;g<t;){var B=d[g++];c[B]=a[B]}c[f]=r}else c?c[f]=g:d.push(f);return c||a}return a}function u(a,b){if(b.atid)return b.atid;var c=a["atid("+b.name+")"];if(c)b.atid=c;else{var d=a["atid.count"];d?(d=parseInt(d,10),c=b.atid="@@"+d,a["atid("+b.name+")"]=c,
a["atid.count"]=d+1):(c=1,a["atid.count"]="2")}return c}function q(a,b){return a instanceof e?a._db===b?"@"+a._id:a._domain?"@"+a._id+"@"+a._domain:"@"+a._id:"number"===typeof a?"#"+a:"string"===typeof a?'"'+a:a.toJSON?"{"+a.toJSON():"&"+a.toString()}function g(a,b,c){return 0<=a.indexOf(b,c||0)}function c(a,b,c){return a.indexOf(b,c||0)}function b(a,b){return a===b?0:typeof a===typeof b?"number"===typeof a?a-b:"string"===typeof a?a<b?-1:1:a._qid?b._qid?a._qid<b._qid?-1:1:-1:b._qid?1:a._fdjtid&&b._fdjtid?
a._fdjtid<b._fdjtid?-1:1:0:typeof a<typeof b?-1:1}function d(a,c){"string"===typeof a&&(a=[a]);"string"===typeof c&&(c=[c]);if(!a||0===a.length)return[];if(!c||0===c.length)return a;a._sortlen!==a.length&&(a=w(a));c._sortlen!==c.length&&(c=w(c));for(var d=[],f=0,e=0,r=a.length,g=c.length,t=a._allstrings&&c._allstrings,B=!0;f<r&&e<g;)a[f]===c[e]?(f++,e++):(t?a[f]<c[e]:0>b(a[f],c[e]))?(B&&"string"!==typeof a[f]&&(B=!1),d.push(a[f]),f++):e++;if(!B||a._allstrings)d=d.concat(a.slice(f));else for(;f<r;)e=
a[f++],B&&"string"!==typeof e&&(B=!1),d.push(e);d._allstrings=B;d._sortlen=d.length;return d}function A(a,c){var d=[];d._sortlen=0;a instanceof Array||(a=[a]);c instanceof Array||(c=[c]);if(!a||0===a.length){if(!c||0===c.length)return d;d=d.concat(c);return c._sortlen?(d._sortlen=c._sortlen,d._allstrings=c._allstrings,d):f(d)}if(!c||0===c.length)return A(c,a);a._sortlen!==a.length&&(a=f(a));c._sortlen!==c.length&&(c=f(c));for(var e=0,r=0,g=a.length,t=c.length,B=a._allstrings&&c._allstrings;e<g&&r<
t;)a[e]===c[r]?(d.push(a[e]),e++,r++):(B?a[e]<c[r]:0>b(a[e],c[r]))?d.push(a[e++]):d.push(c[r++]);for(;e<g;)d.push(a[e++]);for(;r<t;)d.push(c[r++]);d._allstrings=B;d._sortlen=d.length;return d}function w(a){var b=[];b._sortlen=0;if(0===arguments.length)return b;if(1===arguments.length){if(a){if(a instanceof Array)return a.length&&a._sortlen!==a.length?"number"===typeof a._sortlen?f(a):f([].concat(a)):a;b=[a];"string"===typeof a&&(b._allstrings=!0);b._sortlen=1}return b}for(var c=0,d=arguments.length,
b=[];c<d;){var e=arguments[c++];e&&(e instanceof Array?b=b.concat(e):b.push(e))}return f(b)}function f(a){var c;if(a._sortlen!==(c=a.length))if(0===c)a._sortlen=0;else if(1===c)c=a[0],a._sortlen=1,a._allstrings="string"===typeof c,"object"!==typeof c||c._qid||c._fdjtid||(c.getQID?c._qid=c.getQID():c._fdjtid=++Ma);else{c=!0;for(var d=0,f=a.length;d<f;){var e=a[d++];c&&"string"!==typeof e&&(c=!1,"object"!==typeof e||e._qid||e._fdjtid||(e.getQID?e._qid=e.getQID():e._fdjtid=++Ma))}a._allstrings=c;if(1===
f)return a;c?a.sort():a.sort(b);d=c=1;f=a.length;for(e=a[0];c<f;)a[c]!==e?a[d++]=e=a[c++]:c++;a._sortlen=a.length=d}return a}function D(a,b){if(b instanceof Array){var c=!1,d;for(d in b)D(a,d)&&(c=!0);return c}if(a.indexOf){if(0<=a.indexOf(b))return!1}else{c=0;for(d=a.length;c<d;){if(a[c]===b)return!1;c++}"string"!==typeof b&&(a._allstrings=!1)}a.push(b);return!0}function J(a,b){if(b instanceof Array){var c=!1,d;for(d in b)J(a,d)&&(c=!0);return c}if(a.indexOf){c=a.indexOf(b);if(0>c)return!1;a.splice(c,
1);return!0}c=0;for(d=a.length;c<d;){if(a[c]===b)return a.splice(c,1),!0;c++}return!1}function G(){return this}function y(){return this}function E(a){this._db=a;return this}function F(a,b,c){if(0===arguments.length)return this;a&&(this.dbs=a);b&&(this.clauses=b instanceof Array?b:[b]);c&&(this.weights=c);var d=0,f=a.length;if(1<f)for(;d<f;)if(a[d].absrefs)d++;else return this;this.uniqueids=!0;return this}function O(a,b){return b.weight-a.weight}var M=fdjt.State,I=fdjt.Time,t=fdjt.Async,T=fdjt.DOM,
K=fdjt.JSON,P=fdjt.Log,C=P.warn,U={},V=[],B=[],N={},r=fdjt.iDB.indexedDB;a.prototype.name=a.prototype.aliases=a.prototype.refs=a.prototype.altrefs=a.prototype.allrefs=a.prototype.loaded=a.prototype.changes=a.prototype.changed=a.prototype.storage=a.prototype.absrefs=a.prototype.oidrefs=a.prototype.onload=a.prototype.onadd=a.prototype.indices=a.prototype.complete=!1;var da=a.REFINDEX=2,X=a.REFLOAD=4,S=a.REFSTRINGS=8,oa=da|S;a.open=function(b,c){c||(c=a);return U.hasOwnProperty(b)&&U[b]||N.hasOwnProperty(b)&&
N[b]||new c(b)};a.probe=h;a.prototype.addAlias=function(a){N[a]?N[a]!==this&&C("Alias %s for %o already associated with %o",a,this,N[a]):(N[a]=this,this.aliases.push(a))};a.prototype.toString=function(){return"RefDB("+this.name+")"};a.prototype.ref=function(a){if("string"!==typeof a){if(a instanceof e)return a;throw Error("Not a reference");}":"===a[0]&&"@"===a[1]&&(a=a.slice(1));var b=this.refs;return b.hasOwnProperty(a)&&b[a]||this.refclass&&new this.refclass(a,this)||new e(a,this)};a.prototype.probe=
function(a){if("string"!==typeof a)return a instanceof e?a:!1;":"===a[0]&&"@"===a[1]&&(a=a.slice(1));var b=this.refs;return b.hasOwnProperty(a)&&b[a]};a.prototype.drop=function(a){var b=0,c=this.refs,d=this.altrefs;a instanceof Array||(a=[a]);for(var f=0,r=a.length;f<r;){var g=a[f++],t;g instanceof e?t=g._id:(t=g,g=this.probe(t));if(g){b++;var B=g.aliases,h=this.allrefs.indexOf(g);0<=h&&this.allrefs.splice(h,1);h=this.changes.indexOf(g);0<=h&&this.changes.splice(h,1);h=this.loaded.indexOf(g);0<=h&&
this.loaded.splice(h,1);delete c[t];if(this.storage instanceof Storage){var g=this.storage,h="allids("+this.name+")",q=g[h],q=q&&K.parse(q),w=q.indexOf(t);0<=w&&(q.splice(w,1),g.setItem(h,K.stringify(q)),g.removeItem(t))}if(B)for(t=0,g=B.length;t<g;)delete d[B[t++]]}}return b};a.prototype.clearOffline=function(a){if(!this.storage)return!1;if(Storage&&this.storage instanceof Storage){var b=this.storage,c="allids("+this.name+")",d=this.storage[c];d&&(d=K.parse(d));if(d)for(var f=0,e=d.length;f<e;)delete b[d[f++]];
delete b[c];a&&setTimeout(a,5)}else if(!(this.storage instanceof r))return!1};a.prototype.onLoad=function(a,b,c){if(b&&this.onloadnames[b]){var d=this.onloadnames[b];if(d===a)return;var f=this.onload.indexOf(d);if(0>d){C("Couldn't replace named onload method %s for <RefDB %s>",b,this.name);return}this.onload[f]=a}else this.onload.push(a);b&&(this.onloadnames[b]=a);c||(b=[].concat(this.loaded),t.slowmap(a,b))};a.prototype.onAdd=function(a,b){this.onadd[a]=b};a.prototype.onDrop=function(a,b){this.ondrop[a]=
b};var ga=/^(((:|)@(([0-9a-fA-F]+\/[0-9a-fA-F]+)|(\/\w+\/.*)|(@\d+\/.*)))|((U|#U|:#U|)[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12})|((U|#U|:#U|)[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}t[0-9a-zA-Z]+)|([^@]+@.+))$/,ca=M.getLocal;a.resolve=m;a.ref=m;fdjt.Ref=a.Ref=e;e.prototype._db=e.prototype._domain=e.prototype._qid=e.prototype._id=!1;e.prototype.toString=function(){return this._qid?this._qid:this._domain?this._id+"@"+this._domain:this._db.absrefs?
this._id:this._id+"@"+this._db.name};e.prototype.getQID=function(){return this._qid?this._qid:this._domain?this._qid=this._id+"@"+this._domain:this._db.absrefs?this._qid=this._id:this._qid=this._id+"@"+this._db.name};e.prototype.addAlias=function(a){var b=this._db.refs;if(b.hasOwnProperty(a)){if(b[a]===this)return!1;throw{error:"Ref alias conflict"};}if(this._db.altrefs.hasOwnProperty(a)){if(this._db.altrefs[a]===this)return!1;throw{error:"Ref alias conflict"};}this._db.altrefs[a]=this;return!0};
e.prototype.Import=function(a,b,c){var f=this._db,e=this._live,r=f.indices,g=f.onload,t=e&&f.onadd,B=e&&f.ondrop,h=a.aliases;"undefined"===typeof c&&(c=oa);"undefined"===typeof b&&(b=this.import_rules||f.import_rules);var q=0!==(c&da),w=0!==(c&X);c=0!==(c&S);if(h)for(var V=0,u=h.length;V<u;){var N=h[V++],A=f.refs.hasOwnProperty(N)&&f.refs[N]||f.altrefs.hasOwnProperty(N)&&f.altrefs[N];A&&A!==this?C("Ambiguous ref %s in %s refers to both %o and %o",N,f,A.name,this.name):h[N]=this}h=I();w&&!this._live&&
(this._live=h);for(var m in a)if("aliases"!==m&&"_id"!==m&&a.hasOwnProperty(m))if(u=a[m],V=b&&b[m],"undefined"!==typeof u&&(V&&(u=V(this,m,u,a,q)),u=k(u,f,c)),N=e&&this[m],this[m]=u,N){V=d(N,u||[]);u=u?d(u,N):[];q&&r[m]&&(u.length&&this.indexRef(m,u,r[m],f),V.length&&this.dropIndexRef(m,V,r[m],f));if(u.length&&t[m])for(var N=t[m],A=0,p=u.length;A<p;)N(u[A++]);if(V.length&&B[m])for(u=B[m],N=0,A=V.length;N<A;)u(V[N++])}else u&&q&&r[m]&&this.indexRef(m,u,r[m],f);if(w){if(g)for(a=0,b=g.length;a<b;)(0,g[a++])(this,
h);if(this._onload){g=this._onload.fns;a=0;for(b=g.length;a<b;)g[a++](this,h);delete this._onload}}w||this._changed||(this._changed=h,f.changes.push(this),f.changed||(f.changed=h,f.changes.push(f)))};e.prototype.importValue=function(a,b){return k(this._db,a,b)};a.prototype.importValue=function(a,b){return k(a,this,b)};a.prototype.Import=function(a,b,c,d){var f=[],e=this;if(!(a instanceof Array))return x(a,f,e,b,c),d&&d.call&&setTimeout(function(){d(f[0])}),f[0];if(!d||7>=a.length){for(var r=0,g=a.length;r<
g;)x(a[r++],f,e,b,c);d&&d.call&&setTimeout(function(){d(f)},10);return f}d.call?t.slowmap(function(a){x(a,f,e,b,c)},a,{done:function(){d(f)}}):t.slowmap(function(a){x(a,f,e,b,c)},a)};e.prototype.onLoad=function(a,b){this._live?a(this):this._onload?this._onload[b]||(b&&(this._onload[b]=a),this._onload.fns.push(a)):(this._onload={fns:[a]},b&&(this._onload[b]=a))};e.Export=e.prototype.Export=function(a){var b=this._id,c={_id:this._id};a||(a=this.export_rules||b.export_rules);b.absrefs||(this._domain=
b.name);for(var d in this)if("_"!==d[0]&&this.hasOwnProperty(d)){var b=this[d],f=a&&a[d];f&&(b=f(b,d,c));"undefined"!==typeof b&&(c[d]="number"===typeof b||"string"===typeof b?b:b instanceof e?b._db.absrefs?{_id:b._id}:{_id:b._id,_domain:b._domain||b._db.name}:p(b,this._db))}return c};e.exportValue=p;a.prototype.exportValue=function(a){return p(a,this)};a.prototype.load=function(a,b,c){function d(){b&&(c?b.apply(null,c):b())}if(this.storage&&this.storage instanceof Storage){if(a)if(!0===a){var f=
this.storage["allids("+this.name+")"];a=f?K.parse(f).concat(this.allrefs):[].concat(this.allrefs)}else a instanceof e?a=[a]:"string"===typeof a?a=[a]:"undefined"===typeof a.length&&(a=[a]);else a=[].concat(this.allrefs);for(var r=this.storage,g=this.loaded,B=this,h=this.absrefs,f=this.refs,q=!1,w=[],V=0,N=a.length;V<N;){var k=a[V++],A=k;"string"===typeof k&&(A=f[k]);A instanceof e&&A._live||w.push(k)}if(w.length)return t.slowmap(function(a){var b=a;"string"===typeof b&&(b=B.ref(b,!1,!0));b?b._live||
(g.push(b),h?a=r[b._id]:(q||(q=B.atid?B.atid:B.atid=u(r,B)),a=r[q+"("+b._id+")"]),a?b.Import(K.parse(a),!1,X|da):C("No item stored for %s",b._id)):C("Couldn't resolve ref to %s",a)},w,b?c?{done:d}:{done:b}:!1);d();return new Promise(function(b){b(a)})}};a.prototype.load=function(a){return this.storage instanceof Storage?this.loadFromStorage(a):!1};a.prototype.loadFromStorage=function(a){var b=this,c=this.storage,d=this.loaded,f=b.atid||(b.atid=u(c,b)),r=[],g=b.refs,B=b.absrefs;a?!0===a?a=K.parse(c["allids("+
b.name+")"]||"[]").concat(b.allrefs):Array.isArray(a)||(a=[a]):a=[].concat(b.allrefs);for(var h=0,q=a.length;h<q;){var w=a[h++],V=w;"string"===typeof w&&(V=g[w]);V instanceof e&&V._live||r.push(w)}return r.length?t.slowmap(function(a){var l=a;"string"===typeof l&&(l=b.ref(l,!1,!0));l?!l._live&&(a=B?c[l._id]:c[f+"("+l._id+")"])&&(d.push(l),l.Import(K.parse(a),!1,X|da)):C("Couldn't resolve ref to %s",a)},r):new Promise(function(b){for(var c=[],d=0,f=a.length;d<f;){var e=a[d++];V="string"===typeof V?
g[e]:e;c.push(V)}return b(c)})};a.prototype.loadref=function(a){"string"===typeof a&&(a=this.ref(a));return a.load()};e.prototype.load=function(){var a=this,b=this._db;return new Promise(function(c){if(a._live)return c(a);b.load(a).then(function(){c(a)})})};a.load=function(b,c,d,f){if("string"===typeof b){if(c=a.resolve(b,!1,c||a,!0))return c.load(d,f);throw{error:"Couldn't resolve "+b};}if(b instanceof e)return b.load(d,f);if(b instanceof Array){d={};for(var r=[],g=0,t=b.length;g<t;){var B=b[g++],
h=!1;"string"===typeof B?h=a.resolve(B,!1,c||a,!0):B instanceof e&&(h=B);if(h&&!h._live){var B=h._db,q=B.name;d[q]?d[q].push(h):(d[q]=[h],r.push(B))}}g=0;for(t=r.length;g<t;)b=r[g++],b.load(d[b.name],f);return d}return!1};a.prototype.saveToStorage=function(a,b){var c=this,d=this.storage,f=this.atid,e=[];return new Promise(function(r){for(var g=0,t=a.length;g<t;){var h=a[g++];"string"===typeof h&&(h=c.ref(h));if(h._live&&(!h._saved||h._changed)){var q=h.Export();q._saved=I.tick();if(c.absrefs)e.push(h._id),
d.setItem(h._id,K.stringify(q));else{f||(f=h.atid?h.atid:h.atid=u(d,h));var w=f+"("+h._id+")";e.push(w);d.setItem(w,K.stringify(q))}h._changed=!1}}if(b){g=c.changes;t=[];h=0;for(q=g.length;h<q;)w=g[h++],w._changed&&t.push(w);c.changes=t;0===t.length&&(c.changed=!1,g=B.indexOf(c),0<=g&&B.splice(g,1))}g=(g=d["allids("+c.name+")"])?K.parse(g):[];t=g.length;g=A(g,e);g.length!==t&&d.setItem("allids("+c.name+")",K.stringify(g));r&&fdjt.ASync(r)})};a.prototype.save=function(a,b){function c(f){if(d.storage instanceof
Storage)d.saveToStorage(a,b).then(function(){d.changed=!1;d.changes=[];var a=B.indexOf(d);0<=a&&B.splice(a,1);f&&f()});else if(!(d.storage instanceof window.indexedDB))return f()}var d=this,f=this.storage;!0===a?a=this.allrefs:a||(a=this.changes);return f?new Promise(c):!1};e.prototype.save=function(){var a=this,b=this._db;return new Promise(function(c){return a._changed?b.save([a]).then(function(){c(a)}):c(a)})};a.getKeyString=q;e.prototype.indexRef=function(a,b,c,d){var f=[],r=this._db,g=!d||r===
d||r.absrefs?this._id:this._qid||this.getQID&&this.getQID();d||(d=r);var t=d.indices;c||(c=t.hasOwnProperty(a)&&t[a]);if(!c)return C("No index on %s for %o in %o",a,this,d),!1;if(b instanceof e)f=r===b._db?["@"+b._id]:["@"+(b._qid||b.getQID())];else if(b instanceof Array)for(a=0,d=b.length;a<d;)r=b[a++],r instanceof e?f.push("@"+(r._qid||r.getQID())):"number"===typeof r?f=["#"+r]:"string"===typeof r?f=['"'+r]:r._qid?f.push("@"+(r._qid||r.getQID())):r.getQID&&f.push("@"+r.getQID());else f="number"===
typeof b?["#"+b]:"string"===typeof b?['"'+b]:["?"+b.toString()];if(f.length){b=0;for(a=f.length;b<a;)d=f[b++],(r=c[d])?r.push(g):c[d]=[g];return f.length}return!1};e.prototype.dropIndexRef=function(a,b,c,d){d||(d=this._db);c||(c=d.indices[a]);if(!c)return!1;a=[];if(b instanceof e)a=this._db===b._db?["@"+b._id]:["@"+(b._qid||b.getQID())];else if(b instanceof Array){d=0;for(var f=b.length;d<f;){var r=b[d++];r instanceof e?a.push("@"+(r._qid||r.getQID())):"number"===typeof r?a=["#"+b]:"string"===typeof r?
a=['"'+b]:r._qid?a.push("@"+(r._qid||r.getQID())):r.getQID&&a.push("@"+r.getQID())}}else"number"===typeof b?a=["#"+b]:"string"===typeof b&&(a=['"'+b]);if(a.length){d=b=0;for(f=a.length;d<f;){var r=a[d++],g=c[r];if(g){var t=g.indexOf(this._id);0>t||(g.splice(t,1),0===g.length&&delete c[r],b++)}}return b}return!1};a.prototype.find=function(a,b){var c=this.indices[a];return c?(c=c.getItem(b,this))?f(c):[]:[]};a.prototype.findRefs=function(a,b){var c=this.indices[a];if(c){var c=c.getItem(b,this),d=[];
if(c)for(var f=0,e=c.length;f<e;){var r=c[f++];r&&("string"===typeof r?(r=this.probe(r))&&d.push(r):d.push(r))}return w(d)}return[]};a.prototype.count=function(a,b){var c=this.indices[a];return c?(c=c.getItem(b,this))?c.length||0:0:0};a.prototype.addIndex=function(a,b){b||(b=G);if(this.indices.hasOwnProperty(a))return this.indices[a];var c=this.indices[a]=new b;c.fordb=this;return c};var Ma=1;a.compare=b;a.intersection=function(a,c){"string"===typeof a&&(a=[a]);"string"===typeof c&&(c=[c]);if(!a||
0===a.length||!c||0===c.length)return[];a._sortlen!==a.length&&(a=w(a));c._sortlen!==c.length&&(c=w(c));for(var d=[],f=0,e=0,r=a.length,g=c.length,t=a._allstrings&&c._allstrings,B=!0;f<r&&e<g;)a[f]===c[e]?(B&&"string"!==typeof a[f]&&(B=!1),d.push(a[f]),f++,e++):(t?a[f]<c[e]:0>b(a[f],c[e]))?f++:e++;d._allstrings=B;d._sortlen=d.length;return d};a.difference=d;a.union=function(a,c){"string"===typeof a&&(a=[a]);"string"===typeof c&&(c=[c]);if(!a||0===a.length)return c;if(!c||0===c.length)return a;a._sortlen!==
a.length&&(a=w(a));c._sortlen!==c.length&&(c=w(c));for(var d=[],f=0,e=0,r=a.length,g=c.length,t=a._allstrings&&c._allstrings;f<r&&e<g;)a[f]===c[e]?(d.push(a[f]),f++,e++):(t?a[f]<c[e]:0>b(a[f],c[e]))?d.push(a[f++]):d.push(c[e++]);for(;f<r;)d.push(a[f++]);for(;e<g;)d.push(c[e++]);d._allstrings=t;d._sortlen=d.length;return d};a.merge=A;a.overlaps=function(a,c){"string"===typeof a&&(a=[a]);"string"===typeof c&&(c=[c]);if(!a||0===a.length||!c||0===c.length)return!1;a._sortlen!==a.length&&(a=w(a));c._sortlen!==
c.length&&(c=w(c));for(var d=0,f=0,e=a.length,r=c.length,g=a._allstrings&&c._allstrings;d<e&&f<r;){if(a[d]===c[f])return!0;(g?a[d]<c[f]:0>b(a[d],c[f]))?d++:f++}return!1};a.Set=w;fdjt.Set=w;a.toSet=w;e.prototype.get=function(a){if(this.hasOwnProperty(a))return this[a];if(this._live)return!1};e.prototype.getSet=function(a){if(this.hasOwnProperty(a))return a=this[a],a instanceof Array?a._sortlen===a.length?a:f(a):f([a]);if(this._live)return[]};e.prototype.getArray=function(a){if(this.hasOwnProperty(a))return a=
this[a],a instanceof Array?a:[a];if(this._live)return[]};e.prototype.getValue=function(a){var b=this;return new Promise(function(c,d){return b.hasOwnProperty(a)?c(b[a]):b._live?c(void 0):b._db.storage?b.load().then(function(b){return c(b[a])}).catch(d):c(void 0)})};e.prototype.getValues=function(a){var b=this;return new Promise(function(c,d){b.getValue(a).then(function(a){a=Array.isArray(a)?a._sortlen&&a._sortlen===a.length?c(a):c(f(a)):c([a]);return a}).catch(d)})};e.prototype.add=function(a,b,c){function d(f){if(b instanceof
Array&&"number"===typeof b._sortlen)for(var g=0,t=b.length;g<t;)e.add(a,b[g++],c);else{if("aliases"===a){if(r.refs[b]===e||r.altrefs[b]===e)return f&&f(!1);r.altrefs[b]=e;e.aliases?e.aliases.push(b):e.aliases=[b];return f&&f(!0)}if(e.hasOwnProperty(a)){g=e[a];if(g===b)return f&&f(!1);if(g instanceof Array){if(!D(g,b))return f&&f(!1)}else e[a]=w([g,b])}else e[a]=b instanceof Array&&"number"!==typeof b._sortlen?w([b]):b}e._changed||(g=I(),r.changed||B.push(r),r.changed=g,e._changed=g,r.changes.push(e));
if(r.onadd.hasOwnProperty(a))r.onadd[a](e,a,b);c&&r.indices[a]&&e.indexRef(a,e[a],r.indices[a]);f&&f(!0)}function f(){d(!1)}var e=this,r=this._db;"undefined"===typeof c?c=r.indices.hasOwnProperty(a)?!0:!1:c&&!r.indices.hasOwnProperty(a)&&r.addIndex(a);return b instanceof Array&&0===b._sortlen?new Promise(function(a){return a(!1)}):!this._live&&this._db.storage?(this._onload?this._onload.push(f):this._onload=[f],this.load()):new Promise(d)};e.prototype.drop=function(a,b,c){function d(f){if(e.hasOwnProperty(a)){var g=
e[a];if(g===b)delete e[a];else if(g instanceof Array){if(!J(g,b))return f&&f(!1);0===g.length&&delete e[a]}else return f&&f(!1)}else return f&&f(!1);if(r.ondrop.hasOwnProperty(a))r.ondrop[a](e,a,b);e._changed||(g=I(),r.changed&&(r.changed=g,B.push(r)),e._changed=g,r.changes.push(e));c&&r.indices[a]&&e.indexRefDrop(a,r.indices[a]);return f&&f(!0)}function f(){d(!1)}var e=this,r=this._db;"undefined"===typeof c&&(c=!0);return"_id"===a?new Promise(function(a){a(!1)}):!this._live&&this._db.storage?(this._onload?
this._onload.push(f):this._onload=[f],this.load()):new Promise(d)};e.prototype.test=function(a,b){if(this.hasOwnProperty(a)){if("undefined"===typeof b)return!0;var c=this[a];if(c===b||c instanceof Array&&g(c,b))return!0}if(this._live)return!1};e.prototype.store=function(a,b){var c=[],f=[];if(this.hasOwnProperty(a)){f=this[a];if(f===b)return!1;c=d(b,f);f=d(f,b)}else c=b instanceof Array?b:[b];for(var e=0,r=f.length;e<r;)this.drop(a,f[e++]);e=0;for(r=c.length;e<r;)this.add(a,c[e++]);return!0};e.prototype.toHTML=
function(){var a=!1;return this._db.forHTML&&this._db.forHTML(this)||this._db.forDOM&&(a=this._db.forDOM(this))&&a.outerHTML||this._id||this.oid||this.uuid};e.prototype.toDOM=function(){return this._db.forDOM&&this._db.forDOM(this)||this._db.forHTML&&T(this._db.forHTML(this))||T("span.fdjtref",this._id||this.oid||this.uuid)};G.prototype.get=function(a){var b=q(a,this.fordb);if(this.hasOwnProperty(b))return this[b];if("string"===typeof a)return this[a]||this["@"+a]};G.prototype.getItem=G.prototype.get;
G.prototype.set=function(a,b){this[q(a,this.fordb)]=b instanceof Array?[b]:b};G.prototype.setItem=G.prototype.set;G.prototype.increment=function(a,b){var c=q(a,this.fordb),d=this[c],f;this[c]=d?f=d+b:f=b;return f};G.prototype.add=function(a,b){var c=q(a,this.fordb);if(this.hasOwnProperty(c)){var d=this[c];if(d===b)return!1;if(d instanceof Array){if(g(d,b))return!1;d.push(b);return!0}this[c]=f([d,b]);return!0}this[c]=b instanceof Array?f([b]):b};G.prototype.drop=function(a,b){var c=q(a,this.fordb);
if(this.hasOwnProperty(c)){var d=this[c];if(d===b)return delete this[c],!0;if(d instanceof Array){var f=d.indexOf(b);if(0>f)return!1;d.splice(f,1);d._sortlen&&d._sortlen--;1===d.length&&(d[0]instanceof Array||(this[c]=d[0]));return!0}}return!1};fdjt.Map=G;a.ObjectMap=G;a.fdjtMap=G;y.prototype.get=function(a){if("string"===typeof a&&this.hasOwnProperty(a))return this[a]};y.prototype.getItem=y.prototype.get;y.prototype.set=function(a,b){"string"===typeof a&&(this[a]=b instanceof Array?[b]:b)};y.prototype.setItem=
y.prototype.set;y.prototype.increment=function(a,b){if("string"===typeof a){var c=this[a],d;this[a]=c?d=c+b:d=b;return d}};y.prototype.add=function(a,b){if("string"===typeof a){if(this.hasOwnProperty(a)){var c=this[a];if(c===b)return!1;if(c instanceof Array){if(g(c,b))return!1;c.push(b);return!0}this[a]=f([c,b]);return!0}this[a]=b instanceof Array?f([b]):b}};y.prototype.drop=function(a,b){if("string"===typeof a){if(this.hasOwnProperty(a)){var c=this[a];if(c===b)return delete this[a],!0;if(c instanceof
Array){var d=c.indexOf(b);if(0>d)return!1;c.splice(d,1);c._sortlen&&c._sortlen--;1===c.length&&(c[0]instanceof Array||(this[a]=c[0]));return!0}}return!1}};fdjt.StringMap=y;a.StringMap=y;E.prototype.get=function(a){if("string"===typeof a){if(this.hasOwnProperty(a))return this[a]}else if(a instanceof e)return this[this.uniqueids&&a._id||a._qid||a.getQID()]};E.prototype.set=function(a,b){if("string"===typeof a)this[a]=b;else if(a instanceof e)this[a._qid||this.uniqueid&&a._id||a.getQID()]=b;else return!1};
E.prototype.increment=function(a,b){if("string"===typeof a)this.hasOwnProperty(a)?this[a]+=b:this[a]=b;else if(a instanceof e){var c=a._qid||this.uniqueids&&a._id||a.getQID();this[c]=(this[c]||0)+b}else return!1};fdjt.RefMap=a.RefMap=E;a.add=function(a,b,c,d){if(2===arguments.length)return D(a,b);if(a instanceof e)return a.add.apply(a,arguments);d?a.hasOwnProperty(b)?g(a[b],c)||a[b].push(c):a[b]=Array(c):a.hasOwnProperty(b)?a[b].push(c):a[b]=Array(c);a._all&&!g(a._all,b)&&a._all.push(b)};a.drop=function(a,
b,d){if(2===arguments.length)return J(a,b);if(a instanceof e)return a.drop.apply(a,arguments);if(!d)a[b]=[];else if(a.hasOwnProperty(b)){var f=a[b],r=c(f,d);0>r||f.splice(r,1)}};a.test=function(a,b,d){return 2===arguments.length?g(a,b):a instanceof e?a.test.apply(a,arguments):"undefined"===typeof d?(a.hasOwnProperty?a.hasOwnProperty(b):a[b])&&0<a[b].length:a.hasOwnProperty(b)?0>c(a[b],d)?!1:!0:!1};a.insert=function(a,b){0>c(a,b)&&a.push(b)};a.remove=function(a,b,d){var f=c(a,b);if(0>f)return a;a.splice(f,
1);if(d)for(d--;0<d&&0<=(f=c(a,b,f));)a.splice(f,1),d--;return a};a.indexOf=function(a,b,c){return c?a.indexOf(b,c):a.indexOf(b)};a.contains=g;a.position=c;a.countKeys=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.localKeys=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};a.Query=F;F.prototype.uniqueids=!1;F.prototype.execute=function(){if(this.scores)return this;var a=this.dbs,b=this.clauses;if(!a||!a.length){var c=this.results=w();C("No dbs for query %o!",
this);return c}if(!b||!b.length){for(var c=w(),d=0,e=a.length;d<e;)c=A(c,f(a[d++].allrefs));return this.results=c}var r=this._weights||this.weights,g=1===a.length||this.uniqueids,c=new E,d=new E,e=w(),t={};d.uniqueids=c.uniqueids=g;for(var B=0,h=b.length;B<h;){var q=b[B++],V=q.fields,X=q.values,u=q.weights,q=[];V instanceof Array||(V=[V]);X instanceof Array||(X=[X]);for(var N=0,k=V.length;N<k;)for(var da=V[N++],m=u&&u[da]||r&&r[da]||this.default_weight||1,p=0,n=X.length;p<n;)for(var I=X[p++],S=0,
K=a.length;S<K;){var P=a[S++],v=P.find(da,I);v&&v.length&&q.push({field:da,hits:f(v),weight:m,value:I,db:P})}q.sort(O);V=0;X=q.length;for(u={};V<X;)if(N=q[V++],da=N.hits,m=N.db,k=m.absrefs,p=0,n=da.length,g||k)for(;p<n;)I=da[p++],u[I]||(u[I]=I,t[I]||(e.push(m.ref(I)),t[I]=I),d[I]=(d[I]||0)+1,c[I]=(c[I]||0)+N.weight);else I=da[p++],da=m.ref(I),k=da._qid||k&&da._id||da.getQID(),u[k]||(u[k]=k,t[k]||(e.push(da),t[k]=k),d[k]=(d[k]||0)+1,c[k]=(c[k]||0)+N.weight)}if(1<h){a=this.results=[];b=new E;r=new E;
g=0;for(t=e.length;g<t;)B=e[g++],h=d.get(B),2<=h&&(q=c.get(B),b.set(B,q),r.set(B,h),a.push(B));a._allstrings=!1;a._sortlen=a.length;this.results=a;this.scores=b;this.counts=r}else this.results=f(e),this.scores=c,this.counts=d;return this};a.useIndexedDB=function(a,b,c,d){b&&!d&&"number"!==typeof b&&b.version?(d=b,b=d.version):d||(d={});c||(c=d.init||!1);b||(b=1);var f=d.trace,e=a+":"+b;return new Promise(function(g,t){if("undefined"===typeof r||!r.open)if(P.warn("No indexedDB implementation for opening %:",
e),t)t(Error("No indexedDB implementation"));else throw Error("No indexedDB implementation");try{var B=r.open(a,b),h=!1,q=setTimeout(function(){h=!0;P.warn("Init timeout for indexedDB %s",e);t(Error("Init timeout"))},d.timeout||15E3);B.onerror=function(a){h=!0;C("Error initializing indexedDB: %o",a.errorCode);q&&clearTimeout(q);return t?t(a):a};B.onsuccess=function(a){if(h)P("Discarding indexedDB %s after failure!",e);else return a=a.target.result,q&&clearTimeout(q),f&&P("Got existing IndexedDB %s %o",
e,a),g?g(a):a};B.onupgradeneeded=function(d){var f=d.target.result;if(c)if(B.onsuccess=function(){return g?g(f):f},B.onerror=function(a){P("Error upgrading %s %o",e,a);if(t)t(a);else throw Error("Error upgrading %s",e);},c.call)try{return c(f),g?g(f):f}catch(r){P("Error upgrading %s:%d: %o",a,b,r),t&&t(r)}else if(t)t(Error("Bad indexDB init: %o",c));else throw Error("Bad indexDB init: %o",c);else return g(f);return f}}catch(w){P("usingIndexedDB failed: %o",w),t&&t(w)}})};return a}();fdjt.Ajax=function(){function a(a,c){var e=a,g=!1;"&"===a[-1]?g=!1:0<=a.indexOf("?")?g=!0:e=a+"?";if("string"===typeof c)e=e+(g?"&":"")+c;else if(c.length)for(var f=0;f<c.length;)c[f]&&(e=e+(g?"&":"")+encodeURIComponent(c[f])+"="+encodeURIComponent(c[f+1]),g=!0),f+=2;else for(f in c)c.hasOwnProperty(f)&&(e=e+(g?"&":"")+encodeURIComponent(f)+"="+encodeURIComponent(c[f]),g=!0);return e}function n(b,c,e,g,f,h){var q="number"===typeof h?h:h&&h.timeout;"number"===typeof h?h={}:h||(h={});var u=new XMLHttpRequest,
k=h.success;c=e?a(c,e):c;u.onreadystatechange=function(){if(4===u.readyState){var a=u.status;(k?k.call?k(u):Array.isArray(k)?0<=k.indexOf(a):200<=a&&300>a||304===a:200<=a&&300>a||304===a)?b(u):g&&g(u)}};q&&(u.timeout=q,g&&(u.ontimeout=function(a){g(u)}));u.open("GET",c);h.hasOwnProperty("credentials")?u.withCredentials=h.credentials:u.withCredentials=!0;if(f)for(var m in f)f.hasOwnProperty(m)&&u.setRequestHeader(m,f[m]);u.send(null);return u}function h(a,d,e){if(d&&c(d))return!1;var g=fdjt.DOM("SCRIPT");
d&&(g.id=d);e&&(g.oncleanup=e);g.language="javascript";g.src=a;document.body.appendChild(g)}function m(a){if(a=c(a)){if(a.oncleanup)a.oncleanup();q.remove(a)}}function e(a){fdjt.UI.AutoPrompt.cleanup(a);for(var c=!1,e=q.getChildren(a,"INPUT"),g=0;g<e.length;){var f=e[g++];!f.disabled&&(/(radio)|(checkbox)/i.exec(f.type)?f.checked:1)&&(c=(c?c+"&":"")+f.name+"="+encodeURIComponent(f.value))}e=q.getChildren(a,"TEXTAREA");for(g=0;g<e.length;)f=e[g++],f.disabled||(c=(c?c+"&":"")+f.name+"="+encodeURIComponent(f.value));
a=q.getChildren(a,"SELECT");for(g=0;g<a.length;)for(var f=a[g++],e=f.name,f=q.getChildren(f,"OPTION"),h=0;h<f.length;){var u=f[h++];u.selected&&(c=(c?c+"&":"")+e+"="+encodeURIComponent(u.value))}return c}function v(a,c,e,g){g&&(c=c.toLowerCase());a.hasOwnProperty(c)?(g=a[c],g.push?g.push(e):a[c]=[g,e]):a[c]=e}function k(a,c,h){var u=a.getAttribute("ajaxaction")||a.action;if(!u)return!1;var f=a.getAttribute("synchronous"),k=!1,m=!1,p=new XMLHttpRequest,n=e(a);q.addClass(a,"submitting");f?"GET"===a.method?
p.open("GET",u+"?"+n,!1):"PUT"===a.method?p.open("PUT",u,!1):p.open("POST",u,!1):"GET"===a.method?p.open("GET",u+"?"+n):"PUT"===a.method?p.open("PUT",u):p.open("POST",u);p.onreadystatechange=function(){4===p.readyState&&200<=p.status&&300>p.status?(q.dropClass(a,"submitting"),k=!0,c&&c(p,a),m=!0):4===p.readyState&&(g("Failed callback (%d,%d) %o for %o, not calling %o",p.readyState,4===p.readyState&&p.status,p,u,c),q.dropClass(a,"submitting"),c&&c(p,a),m=!0)};h&&h.accept&&p.setRequestHeader("Accept",
h.accepts);h&&h.hasOwnProperty("creds")?p.withCredentials=h.creds:p.withCredentials=!0;try{"GET"===a.method?p.send():(p.setRequestHeader("Content-type","application/x-www-form-urlencoded"),p.send(n)),k=!0}catch(v){}f&&!m&&4===p.readyState&&200<=p.status&&300>p.status&&(q.dropClass(a,"submitting"),k=!0,c&&c(p,a));return k}function x(a){var c=a.getAttribute("jsonpuri");if(!c)return!1;var u=a.id?"JSONP"+a.id:"FORMJSONP",k=e(a);q.addClass(a,"submitting");try{h(c+"?"+k,u,function(){fdjt.DOM.dropClass(a,
"submitting")})}catch(f){return m(u),g.warn("Attempted JSONP call signalled %o",f),!1}return!0}function p(a,c){var e=a.length;c||(c=0);for(var g=Array(e-c);c<e;)g[c]=a[c],c++;return g}function u(b,c,e){var g=new XMLHttpRequest;c=a(c,e);g.open("GET",c,!1);g.send(null);return b?b(g):g}var q=fdjt.DOM,g=fdjt.Log,c=fdjt.ID;n.textCall=function(a,c){return n(function(c){a(c.responseText)},c,q.Array(arguments,2))};n.jsonCall=function(a,c){return n(function(c){a(JSON.parse(c.responseText))},c,q.Array(arguments,
2))};n.xmlCall=function(a,c){return n(function(c){a(c.responseXML)},c,q.Array(arguments,2))};n.fetch=function(a,c,e,g){return new Promise(function(f,h){n(function(a){f(a)},a,c,function(a){h(a)},e,g)})};n.fetchText=function(a,c,e,g){return new Promise(function(f,h){n(function(a){f(a.responseText)},a,c,function(a){h(a)},e,g)})};n.fetchJSON=function(a,c,e,g){return new Promise(function(f,h){n(function(a){f(JSON.parse(a.responseText))},a,c,function(a){h(a)},e,g)})};n.fetchXML=function(a,c,e,g){return new Promise(function(f,
h){n(function(a){f(JSON.parse(a.responseXML))},a,c,function(a){h(a)},e,g)})};n.jsonpCall=h;n.jsonpFinish=m;n.formParams=e;n.formJSON=function(a,c){fdjt.UI.AutoPrompt.cleanup(a);for(var e={},g=q.getChildren(a,"INPUT"),f=0;f<g.length;){var h=g[f++];!h.disabled&&("radio"===h.type||"checkbox"===h.type?h.checked:1)&&v(e,h.name,h.value,c||!1)}g=q.getChildren(a,"TEXTAREA");for(f=0;f<g.length;)h=g[f++],h.disabled||v(e,h.name,h.value,c||!1);g=q.getChildren(a,"SELECT");for(f=0;f<g.length;)for(var u=g[f++],
h=u.name,u=q.getChildren(u,"OPTION"),k=0;k<u.length;){var m=u[k++];m.selected&&v(e,h,m.value,c||!1)}return e};n.formSubmit=k;n.get=function(a){return u(!1,a,p(arguments,1))};n.getText=function(a){return u(function(a){return a.responseText},a,p(arguments,1))};n.getJSON=function(a){return u(function(a){return JSON.parse(a.responseText)},a,q.Array(arguments,1))};n.getXML=function(a){return u(function(a){return a.responseXML},a,q.Array(arguments,1))};n.onsubmit=function(a,c){a=a||window.event||null;var e=
a.nodeType?a:fdjt.UI.T(a);fdjt.UI.AutoPrompt.cleanup(e);if(q.hasClass(e,"submitting"))return q.dropClass(e,"submitting"),e.fdjtsubmit=!1;e.fdjtsubmit=!0;q.addClass(e,"submitting");return k(e,c)||x(e)?(fdjt.UI.cancel(a),!0):!1};return n}();var WSN=function(){function a(e,q,g,c){if(""===e)return e;if(!e&&this instanceof a)return q&&(this.sortfn=q),g&&(this.wordfn=g),c&&(this.keepdup=c),this;if(!e)return e;"undefined"===typeof q&&(q=a.sortfn||!1);"undefined"===typeof g&&(g=a.wordfn||!1);"undefined"===typeof c&&(c=a.keepdup||!1);if("string"===typeof e){e=p(e).toLowerCase().replace(x,"");e.trim?e=e.trim():(0<e.search(/\S/)&&(e=e.slice(e.search(/\S/))),0<e.search(/\s+$/)&&(e=e.slice(0,e.search(/\s+$/))));if(""===e)return"";e=e.split(/\W*\s+\W*/g);
var b,d=[],k;k=e.length;var w,f;if(0===k)return"";e[0]=e[0].replace(/^\W+/,"");1<k&&(e[k-1]=e[k-1].replace(/\W+$/,""));if(g){if("number"===typeof g)for(w=0,f=e.length;w<f;)k=e[w++],b.length>g&&d.push(k);else if(g.call)for(w=0,f=e.length;w<f;)(k=g(e[w++]))&&d.push(k),w++;else for(w=0,f=e.length;w<f;)b=e[w++],k=g[b],""!==k&&(k&&"string"===typeof k?d.push(k):d.push(b));d.length&&(e=d)}g=q;!0===q?g=n:q===h&&(g=!1);if(q&&c)return e.sort(g).join(" ");if(q){a:if(q=e.sort(g),c=0,g=q.length,b=!1,!(2>g))for(;c<
g;)if(b&&q[c]===b){c=q[0];g=[c];b=1;for(e=q.length;b<e;)q[b]===c?b++:g.push(c=q[b++]);q=g;break a}else b=q[c++];return q.join(" ")}return e.join(" ")}if(e.nodeType){if(3===e.nodeType)return a(e.nodeValue);if(1===e.nodeType)return a(m(e))}throw Error("bad arg to WSN");}function n(a,e){var g=a.length,c=e.length;return g===c?a>e?-1:a<e?1:0:g>c?-1:1}function h(a,e){return a>e?-1:a<e?1:0}function m(a,e){if(a.nodeType){if(3===a.nodeType)return e?e+a.nodeValue:a.nodeValue;if(1===a.nodeType){var g=a.childNodes,
c=window.getComputedStyle?window.getComputedStyle(a):{position:"static",display:"block"};if("static"!==c.position)return e||"";"inline"!==c.display?e="\n"+(e||""):e||(e="");for(var c=0,b=g.length;c<b;){var d=g[c++];3===d.nodeType?e+=d.nodeValue:1===d.nodeType&&(e=m(d,e))}return e}return e?e:""}return e||""}function e(e,h,g,c,b){"undefined"===typeof h&&(h=a.hashfn||!1);"undefined"===typeof g&&(g=a.sortfn||!1);"undefined"===typeof c&&(c=a.wordfn||!1);"undefined"===typeof b&&(b=a.keepdup||!1);return(e=
a(e,g,c,b))?h?h(e):e:e}function v(e,h,g,c,b){"undefined"===typeof h&&(h=a.hashfn||!1);"undefined"===typeof g&&(g=a.sortfn||!1);"undefined"===typeof c&&(c=a.wordfn||!1);"undefined"===typeof b&&(b=a.keepdup||!1);for(var d={},k=0,m=e.length;k<m;){var f=e[k++],p=a(f,g,c,b),p=h?h(p):p;d[p]=f}return d}var k=fdjt.Hash,x=/(\pM)/g,p=fdjt.String.decodeEntities;a.lensort=n;a.nativesort=h;a.prototype.textify=a.textify=m;a.fuddle=function(e,h){return a(e,h||n)};a.md5ID=function(){var e=a.apply(null,arguments);
if(e){if(a.md5)return a.md5(e);if(k&&k.hex_md5)return k.hex_md5(e);throw Error("No MD5 implementation");}return e};a.sha1ID=function(){var e=a.apply(null,arguments);if(e){if(a.sha1)return a.md5(e);if(k&&k.hex_sha1)return k.hex_sha1(e);throw Error("No SHA1 implementation");}return e};a.hash=e;a.prototype.Hash=function(h){return e(h,this.hashfn||a.hashfn||!1,this.sortfn||a.sortfn||!1,this.wordfn||a.wordfn||!1,this.keepdup||a.keepdup||!1)};a.maphash=v;a.prototype.maphash=function(e){return v(e,this.hashfn||
a.hashfn||!1,this.sortfn||a.sortfn||!1,this.wordfn||a.wordfn||!1,this.keepdup||a.keepdup||!1)};a.mapMD5=function(e,h,g,c){return v(e,a.md5||k&&k.hex_md5,h,g,c)};a.mapSHA1=function(e,h,g,c){return v(e,a.sha1||k&&k.hex_sha1,h,g,c)};a.md5=k&&k.hex_md5;a.sha1=k&&k.hex_sha1;return a}();fdjt.WSN=WSN;fdjt.TextIndex=function(){function a(k){function q(a,b){for(var c=h(a).split(/\b/g),e=[],g=0,q=c.length;g<q;){var k=c[g++],B=/[A-Z][^A-Z]/.exec(k),N=c[g];if(!(0>k.search(/\w/)||(N&&x.exec(N)&&g+1<q&&0<=c[g+1].search(/\w/)&&(k=k+N+c[g+1],g+=2),2>k.length||m.hasOwnProperty(k)||B&&m.hasOwnProperty(k.toLowerCase()))))if(d)for(B=0,N=d.length;B<N;)d[B++](k);else if(e.push(k),f.hasOwnProperty(k)&&(B=f[k],"string"===typeof B?e.push(B):e=e.concat(B)),w)for(B=0,N=w.length;B<N;){var r=w[B++](k);"string"===typeof r?
e.push(r):e=e.concat(r)}}c=0;g=e.length;n.hasOwnProperty(b)?n[b]=n[b].concat(e):(n[b]=e,y.push(b));for(;c<g;)q=e[c++],p.hasOwnProperty(q)?p[q].push(b):(v.push(q),p[q]=[b])}function g(a){if(m.hasOwnProperty(a))return!0;if(d)for(var b=0,c=d.length;b<c;)if(d[b++](a))return!0;return!1}function c(a){for(var b=f[a]||[],c=0,d=w.length;c<d;){var e=w[c++](a);e&&("string"===typeof e?b.push(e):b=b.concat(e))}return b}function b(){for(var a=0,b=v.length;a<b;){var c=v[a++];if(0===c.search(/[A-Z][a-z]/)){var d=
c.toLowerCase();p.hasOwnProperty(d)&&(p[d]=p[d].concat(p[c]))}}}k||(k={});var d=k.stopfns||!1,m={},w=k.rootfns||!1,f={},p={},n={},v=[],y=[],E,F,x=/^[-'_@.\/]$/;if(this instanceof a){this._indexer=q;if(k.stopwords){var M=k.stopwords;E=0;for(F=M.length;E<F;){var I=M[E++];m[I]=I}}if(k.stdstops)for(E=0,F=e.length;E<F;)M=e[E++],m[M]=M;this.capwords=k.capwords||{};this.termindex=p;this.idterms=n;this.allterms=v;this.allids=y;this.opts=k;this.stopWord=g;this.getRoots=c;this.mergeTerms=b;this.finishIndex=
function(){for(var a=[],b={},c=0,d=v.length,f=[],e=this.capwords;c<d;){var g=v[c++];if(0===g.search(/[A-Z][a-z]/)){var h=g.toLowerCase();p.hasOwnProperty(h)?e.hasOwnProperty(g)?(b[g]=p[g],a.push(g)):f.push(g):(b[g]=p[g],a.push(g))}else b[g]=p[g],a.push(g)}c=0;for(d=f.length;c<d;)e=f[c++],g=e.toLowerCase(),b[g]=b[g].concat(p[e]);this.termindex=p=b;this.allterms=v=a};return this}return new a(k)}for(var n=fdjt.String,h=n.stdspace,m=fdjt.DOM.textify,e="a i -- am an as at be by d' de di do ex he if in is it me my no o' of on or so t' to up us we ya ye any are but can cum des did ere fer few for had has her him his hoo how i'd i'm its lot may nor not off our qua s/p she ten the via was who why yet you 'tis amid atop been both does doth down d\u2019 each even from haec hast hath have he'd he's here hers i'll i're i've into it'd it's last less like many mine miss more most must near nigh none o'er once only onto ours over o\u2019 past port reg. sans says some such thae than that thee them then they thir this thou thro thru thus till unto upon upto we'd were what when whom will wilt with your yous zero abaft aboon about above adown afore after ain't along among anear anent aught baith being below can't circa could didst doest doeth don't every fewer fifty forty gonna he'll he're he've her'n his'n isn't it'll maybe might neath never noone one's other our'n round shall shalt she'd she's since their there these those thro' today under until we'll we're we've where which while who'd who's whose whoso won't would you'd yours youse aboard across allyou amidst anyone aren't around before behind beside beyond cannot contra couple didn't during either eleven except google hadn't hasn't having inside itself myriad myself no-one nobody o\u2019er quibus she'll she're she've should sundry that'd that's theirs they'd thirty this'd thwart tother toward twelve twenty unless unlike versus wasn't what's whence whilst withal within you'll you're you've your'n against ain\u2019t amongst another anybody astride athwart because beneath besides between betwixt can\u2019t despite doesn't don\u2019t haven't herself himself hisself however hundred isn\u2019t neither nothing oneself ourself outside outwith pending perhaps several someone that'll there's they'll they're they've this'll through thro\u2019 thyself towards weren't whereby wherein whereof whereon whereto whether whoever without won\u2019t you-all aren\u2019t didn\u2019t hadn\u2019t hasn\u2019t wasn\u2019t doesn\u2019t haven\u2019t weren\u2019t".split(" "),
v={},k=0,x=e.length;k<x;){var p=e[k++];0>p.indexOf("'")&&(v[p]=p)}a.default_stops=v;a.prototype.indexText=function(a,e){var g=this._indexer;if("string"===typeof a)e&&g(a,e);else if(a.nodeType)e||(e=a.id),e&&g(m(a),e);else if(a.length)for(var c=0,b=a.length;c<b;){var d=a[c++];1===d.nodeType&&d.id&&g(m(d),d.id)}};a.prototype.prefixTree=function(){if(this.prefixtree)return this.prefixtree;for(var a=this.prefixtree={strings:[]},e=n.prefixAdd,g=this.allterms,c=0,b=g.length;c<b;){var d=g[c++];e(a,d,0)}return a};
return a}();fdjt.UI||(fdjt.UI={});fdjt.UI.CoHi||(fdjt.UI.CoHi={classname:"cohi"});fdjt.UI.AutoPrompt||(fdjt.UI.AutoPrompt={});fdjt.UI.InputHelp||(fdjt.UI.InputHelp={});fdjt.UI.Ellipsis||(fdjt.UI.Ellipsis={});fdjt.UI.Expansion||(fdjt.UI.Expansion={});fdjt.UI.Collapsible||(fdjt.UI.Collapsible={});fdjt.UI.Tabs||(fdjt.UI.Tabs={});fdjt.UI.MultiText||(fdjt.UI.MultiText={});fdjt.UI.Reticle||(fdjt.UI.Reticle={});fdjt.UI.FocusBox||(fdjt.UI.FocusBox={});
(function(){function a(a,v){var k=v||h.CoHi.classname,x=a.name||a,p=m[k],u;if(p!==x){if(p){var q=document.getElementsByName(p),p=0;for(u=q.length;p<u;)n.dropClass(q[p++],k)}m[k]=x||!1;if(x)for(x=document.getElementsByName(x),u=x.length,p=0;p<u;)n.addClass(x[p++],k)}}var n=fdjt.DOM,h=fdjt.UI,m={};h.CoHi.highlight=a;h.CoHi.onmouseover=function(e,h){for(var k=n.T(e);k;){if(3===k.nodeType)k=k.parentNode;else if(1!==k.nodeType){k=!1;break}if("INPUT"===k.tagName||"TEXTAREA"===k.tagName||"A"===k.tagName&&
k.href)return;if(k.name||k.getAttribute("name"))break;else k=k.parentNode}k&&a(k.name||k.getAttribute("name"),h)};h.CoHi.onmouseout=function(e,m){a(!1,m||h.CoHi.classname)}})();
fdjt.UI.Highlight=function(){function a(e,h,g){if(1===e.nodeType){if(e.childNodes)for(var c=e.childNodes,b=0,d=c.length;b<d;)a(c[b++],h,g);e.className&&e.className.search&&0<=e.className.search(h)&&g.push(e)}}function n(a){var e=a.childNodes;if(e){for(var g=document.createDocumentFragment(),c=[],b=0,d=e&&e.length;b<d;)c.push(e[b++]);b=0;for(d=c.length;b<d;)g.appendChild(c[b++]);v.replace(a,g)}else v.remove(a)}function h(a,e,g,c){e||(e="fdjthighlight");var b=!1;if(3===a.nodeType)if(0<=a.nodeValue.search(/\S/g))b=
v("span."+e);else var b=p(a.parentNode),d=a.nextSibling,h=a.prevSibling,m=d&&1===d.nodeType&&p(d),f=h&&1===h.nodeType&&p(h),m=m&&m.display,f=f&&f.display,b="normal"!==b.whiteSpace?v("span."+e):d||h?"inline"!==m&&"table-cell"!==m&&"inline"!==f&&"table-cell"!==f?!1:v("span."+e):v("span."+e);else{if(1!==a.nodeType||k(a,e))return a;k(a,"fdjtskiptext")||(h=p(a),d=h.display,h=h.position,"static"!==h&&""!==h)||("block"===d?b=v("div."+e):"inline"===d&&(b=v("span."+e)))}if(!b)return a;g&&(b.title=g);if(c)for(var n in c)c.hasOwnProperty(n)&&
b.setAttribute(n,c[n]);v.replace(a,b);b.appendChild(a);return b}function m(a,e,g,c,b,d){var h=a.nodeValue,k=a.parentNode;if(!1===g||"undefined"===typeof g)g=h.length;if(e!==g){var f;if(f=0<e)f=h.slice(0,e),f=document.createTextNode(f);e=h.slice(e,g);c=v("span."+(c||"fdjthighlight"),e);b&&(c.title=b);if(d)for(var m in d)d.hasOwnProperty(m)&&c.setAttribute(m,d[m]);if(b=g<h.length)g=h.slice(g),b=document.createTextNode(g);g=b;f&&g?(k.replaceChild(g,a),k.insertBefore(c,g),k.insertBefore(f,c)):f?(k.replaceChild(c,
a),k.insertBefore(f,c)):g?(k.replaceChild(g,a),k.insertBefore(c,g)):k.replaceChild(c,a);return c}}function e(a,e,g,c){a=v.refineRange(a);var b=a.startContainer,d=a.endContainer;if(b===d)return[m(b,a.startOffset,a.endOffset,e,g,c)];for(var k=[],p=b;p&&!p.nextSibling;)p=p.parentNode;for(p=p.nextSibling;p&&p!==d;)if(x(d,p))p=p.firstChild;else{for(var f=p;f&&!f.nextSibling;)f=f.parentNode;f=f.nextSibling;k.push(h(p,e,g,c));p=f}k.push(m(b,a.startOffset,!1,e,g,c));k.push(m(d,0,a.endOffset,e,g,c));return k}
var v=fdjt.DOM,k=v.hasClass,x=v.getParent,p=v.getStyle;e.clear=function(e,h){var g=[];e===h||k(e,h)?g=[e]:a(e,new RegExp("\\b"+h+"\\b","g"),g);for(var c=0,b=g.length;c<b;)n(g[c++])};e.remove=n;return e.highlight=e}();
(function(){function a(a){return 1===a.nodeType&&"INPUT"===a.tagName&&("checkbox"===a.type||"radio"===a.type)}function n(c){if(a(c))return c;var b=q(c,a);if(b)return b;b=g(c,"input");if(b.length){c=0;for(var d=b.length;c<d;){if(a(b[c]))return b[c];c++}}return!1}function h(c,b){var d,e;if("string"===typeof c)c=k(c);else if(c.length){d=0;for(e=c.length;d<e;)h(c[d++],b);return}if(c&&c.nodeType){var m=x(c,"checkspan")?c:q(c,".checkspan");if(!m)return!1;var f=a(c)&&c||n(c)||n(m);if(!f)return!1;if(x(m,
"isdisabled")){if(f.disabled)return!1;u(m,"isdisabled")}else if(f.disabled)return p(m,"isdisabled"),!1;d=x(m,"ischecked");var v=!1,J=[];"undefined"===typeof b&&(b=d);f.checked!==b?(f.checked=b,v=!0):d!==f.checked&&(v=!0);b?p(m,"ischecked"):u(m,"ischecked");if(v&&"radio"===f.type){(d=f.form)||(d=q(f,".fdjtinputs"));d||(d=m.parentNode);var G=f.name,y=g(d,"input");d=0;for(e=y.length;d<e;){var E=y[d++];if(E!==f&&"radio"===E.type&&E.name===G){var F=q(E,".checkspan");F!==m&&x(F,"ischecked")&&(E.checked||
J.push(E))}}}v&&(m=document.createEvent("HTMLEvents"),m.initEvent("change",!1,!0),f.dispatchEvent(m));if(J.length)for(d=0,e=J.length;d<e;)f=J[d++],m=q(f,".checkspan"),u(m,"ischecked"),m=document.createEvent("HTMLEvents"),m.initEvent("change",!1,!0),f.dispatchEvent(m)}}function m(){for(var a=fdjt.$(".checkspan"),b=0,d=a.length;b<d;)for(var g=a[b++],h=e.getInputs(g),f=0,k=h.length;f<k;){var m=h[f++];if("radio"===m.type||"checkspan"===m.type){m.checked&&p(g,"ischecked");m.disabled&&p(g,"isdisabled");
break}}}var e=fdjt.DOM,v=fdjt.UI,k=fdjt.ID,x=e.hasClass,p=e.addClass,u=e.dropClass,q=e.getParent,g=e.getChildren;v.CheckSpan=function(a,b,d,g){var h=e.Input("input[type=checkbox]",b,d),f=e(a||"span.checkspan",h);g?(h.checked=!0,e.addClass(f,"ischecked")):h.checked=!1;4<arguments.length&&e.appendArray(f,arguments,4);return f};v.CheckSpan.set=h;v.CheckSpan.onclick=function(a){a=a||window.event;a=a.target||a.srcTarget;if("TEXTAREA"!==a.tagName&&"SELECT"!==a.tagName&&"OPTION"!==a.tagName&&("INPUT"!==
a.tagName||"checkbox"===a.type||"radio"===a.type)){var b="A"===a.tagName?a:q(a,"A");if(!b||!b.href)if(b=q(a,".checkspan"))return b=x(b,"ischecked"),h(a,!b),!1}};v.CheckSpan.changed=function(a){a=a||window.event;a=v.T(a);if("radio"===a.type||"checkbox"===a.type){var b=q(a,".checkspan");b&&(a.checked?p:u)(b,"ischecked")}if("radio"===a.type)for(var b=a.form,d=document.getElementsByName(a.name),g=0,h=d.length;g<h;){var f=d[g++];f!==a&&f.form===b&&"radio"===f.type&&(f=e.getParent(f,".checkspan"),u(f,"ischecked"))}};
v.CheckSpan.initCheckspans=m;fdjt.addInit(m,"CheckSpans",!1)})();
fdjt.UI.ProgressBar=function(){function a(a){"undefined"===typeof a?a=h("div.fdjtprogress",h("div.indicator"),h("div.message")):"string"===typeof a&&(a=h("div.fdjtprogress",h("HR"),h("div.message",a)));this.dom=a;return this}function n(a,e,n){"string"===typeof a&&(a=document.getElementById(a));"number"===typeof n&&(e=e/n*100);a&&(a=a.dom||a,a.nodeType&&(h.getChildren(a,"div.indicator")[0].style.width=e+"%"))}var h=fdjt.DOM;a.setProgress=n;a.setMessage=function(a){"string"===typeof a&&(a=document.getElementById(a));
if(a){var e=a.dom||a;if(e.nodeType){var n=h.getChildren(e,".message")[0],k=h("div.message");h.appendArray(k,h.Array(arguments,1));e.replaceChild(k,n)}}};a.prototype.setProgress=function(a,e){n(this.dom,a,e)};a.prototype.setMessage=function(){var a=this.dom,e=h.getChildren(a,".message")[0],n=h("div.message");h.appendArray(n,h.Array(arguments));a.replaceChild(n,e)};return a}();
(function(){function a(a){for(a=k.T(a);a;)if(1!==a.nodeType||"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||!a.getAttribute("helptext"))a=a.parentNode;else{(a=x(a.getAttribute("helptext")))&&k.addClass(a,"showhelp");break}}function n(c){c=c||window.event||null;var b=k.T(c);b&&p(b,"isempty")&&(b.value="",q(b,"isempty"));a(c)}function h(a){for(a=k.T(a);a;)if(1!==a.nodeType||"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||!a.getAttribute("HELPTEXT"))a=a.parentNode;else{(a=x(a.getAttribute("HELPTEXT")))&&
q(a,"showhelp");break}}function m(a){var b=k.T(a);if(""===b.value){u(b,"isempty");var d=b.prompt||b.getAttribute("prompt")||b.title;d&&(b.value=d)}else q(b,"isempty");h(a)}function e(a){if(a=k.getChildren(a,".isempty"))for(var b=0,d=a.length;b<d;)a[b++].value=""}function v(a){a=k.T(a);e(a)}var k=fdjt.DOM,x=fdjt.ID,p=k.hasClass,u=k.addClass,q=k.dropClass,g=fdjt.String.isEmpty;fdjt.UI.AutoPrompt.setup=function(a,b){for(var d="FORM"===a.tagName?[a]:k.getChildren(a||document.body,"FORM"),e=0,h=d.length;e<
h;){var f=d[e++],q=k.getChildren(f,"INPUT.autoprompt,TEXTAREA.autoprompt");if(q.length){for(var p=0,x=q.length;p<x;){var y=q[p++];y.blur();if(g(y.value)){u(y,"isempty");var E=y.prompt||y.getAttribute("prompt")||y.title;E&&(y.value=E)}b||(k.addListener(y,"focus",n),k.addListener(y,"blur",m))}b||k.addListener(f,"submit",v)}}};fdjt.UI.AutoPrompt.onfocus=n;fdjt.UI.AutoPrompt.onblur=m;fdjt.UI.AutoPrompt.onsubmit=v;fdjt.UI.AutoPrompt.cleanup=e;fdjt.UI.InputHelp.onfocus=a;fdjt.UI.InputHelp.onblur=h})();
(function(){function a(a){a=h.T(a);var m=[];if("TEXTAREA"===a.tagName||"INPUT"===a.tagName&&/text|email/i.exec(a.type)){for(;a;){var k=a.className;k&&"string"===typeof k&&0<=k.search(/\bfdjtfoci\b/)&&0>k.search(/\bfdjtfocus\b/)&&m.push(a);a=a.parentNode}m.length&&setTimeout(function(){for(var a=0;a<m.length;){var e=m[a++];e.className+=" fdjtfocus"}},300)}}function n(a){a=h.T(a);var m=[];if("TEXTAREA"===a.tagName||"INPUT"===a.tagName&&/text|email/i.exec(a.type)){for(;a;){var k=a.className;k&&"string"===
typeof k&&0<=k.search(/\bfdjtfocus\b/)&&m.push(a);a=a.parentNode}m.length&&setTimeout(function(){for(var a=0;a<m.length;){var e=m[a++];e.className=e.className.replace(/ fdjtfocus\b/,"")}},300)}}var h=fdjt.UI,m=fdjt.DOM.addListener;h.focusin=a;m(window,"focusin",a);h.focusout=n;m(window,"focusout",n)})();
(function(){var a=fdjt.DOM,n=fdjt.UI,h=fdjt.String.isEmpty,m=a.hasClass;n.MultiText.keypress=function(e,v,k,x){e=e||event;var p=e.charCode,u=String.fromCharCode(p),q=n.T(e);v instanceof RegExp?(k=v,v=!1):v&&v.call&&(x=v,v=!1);!v&&q.getAttribute("data-sepchars")&&(v=q.getAttribute("data-sepchars"));if(13===p&&h(q.value)&&m(q,"fdjtentersubmit"))fdjt.UI.cancel(e),q.form.submit();else if(13===p||v&&0<=v.indexOf(u)){!k&&q.getAttribute("data-separator")&&(k=new RegExp(q.getAttribute("data-separator"),"g"));
v=q.getAttribute("data-checkspec")||"div.checkspan";k=k?q.value.split(k):[q.value];p=0;for(u=k.length;p<u;){var g=k[p++];if(x)a(q.parentNode,"\n",x(q.name,g));else{var c=a.Input("[type='checkbox']",q.name,g),g=a(v,c,g);c.checked=!0;a.addClass(g,"ischecked");a(q.parentNode,"\n",g)}}n.cancel(e);q.value=""}}})();
(function(){function a(a,e,g){g||(g=n.findAttrib(a,"shownclass","http://fdjt.org/")||"fdjtshown");for(var c=!1,b=n.getChildren(a,".tab"),d=0;d<b.length;){var m=b[d++];if(m.getAttribute("contentid")===e)x(m,g),c=!0;else if(k(m,g)){p(m,g);var w=(m=n.getAttrib(m,"contentid"))&&v(m);w?p(w,g):h.warn("No reference for tab content %o",m)}else p(m,g)}v(e)?c?x(e,g):h.warn("a tab for %s was not found in %o",e,a):h.warn("No reference for tab content %o",e)}var n=fdjt.DOM,h=fdjt.Log,m=fdjt.State,e=fdjt.UI,v=
fdjt.ID,k=n.hasClass,x=n.addClass,p=n.dropClass;e.Tabs.click=function(a,q){var g=e.T(a);q||(q=n.findAttrib(g,"shownclass","http://fdjt.org/")||"fdjtshown");if(g){for(var c=!1;g.parentNode&&!(c=n.getAttrib(g,"contentid"));)g=g.parentNode;if(c){var b=document.getElementById(c),d=n.getParent(g,".tabs")||g.parentNode,d=n.getChildren(d,".tab")||d.childNodes;if(null===b)h("No content for "+c);else{for(var v=0;v<d.length;){var w=d[v++],f;if(1===w.nodeType&&(f=n.getAttrib(w,"contentid"))&&f){var D=document.getElementById(f);
w!==g&&k(w,q)&&(p(w,q),D&&p(D,q))}}k(g,q)?(p(g,q),p(b,q)):(x(g,q),x(b,q));if(g=n.findAttrib(g,"tabstate"))"#"===g?(b={},e.scrollSave(b),document.location.hash=g+c,e.scrollRestore(b)):m.setCookie(g,c);return!1}}}};e.Tabs.selectTab=a;e.Tabs.setup=function(h){h?"string"===typeof h&&(h=v(h)):h=n.$(".tabs[tabstate]");if(h&&h.getAttribute("tabstate")){var k=h.getAttribute("tabstate"),g=!1;if("#"===k){g=document.location.hash;"#"===g[0]&&(g=g.slice(1));k=g&&v(g);if(!k)return;var c={};e.scrollSave(c);window.scrollTo(0,
0);n.isVisible(k)||e.scrollRestore(c)}else g=m.getQuery(k)||m.getCookie(k);g&&("#"===g[0]&&(g=g.slice(1)),g&&a(h,g))}};e.Tabs.getSelected=function(a){a=n.getChildren(a,".tab");for(var e=0;e<a.length;){var g=a[e++];if(k(g,"shown"))return g.getAttribute("contentid")}return!1}})();
(function(){var a=fdjt.DOM,n=fdjt.UI;n.Expansion.toggle=function(h,m,e){h=h||window.event;h=n.T(h);(m=a.getParent(h,m||".fdjtexpands"))&&a.toggleClass(m,e||"fdjtexpanded")};n.Expansion.onclick=n.Expansion.toggle;n.Collapsible.click=function(h){h=h||window.event;var m=n.T(h);!n.isDefaultClickable(m)&&(m=a.getParent(m,".collapsible"))&&(n.cancel(h),a.toggleClass(m,"expanded"))};n.Collapsible.focus=function(h){h=h||window.event;h=n.T(h);(h=a.getParent(h,".collapsible"))&&a.toggleClass(h,"expanded")};
n.toggleParent=function(h,m,e){h=n.T(h);(m=a.getParent(h,m))&&a.toggleClass(m,e)}})();
(function(){function a(a){a?(a.scrollX=!1,a.scrollY=!1):k=!1}function n(a){a?(a.scrollX=window.scrollX,a.scrollY=window.scrollY):(k||(k={}),k.scrollX=window.scrollX,k.scrollY=window.scrollY)}function h(a,h){if(0===h||h||!e.isVisible(a)){for(var k=a.offsetTop,g=a.offsetHeight;a.offsetParent;)a=a.offsetParent,k+=a.offsetTop;var c=e.viewHeight();window.scrollTo(0,g/3*2<c/2-50?k+g/3-c/2:g<c-100?k-(50+g/2):k-50)}}function m(a){x&&(x=!1);if(a&&"number"===typeof a.scrollX)return window.scrollTo(a.scrollX,
a.scrollY),!0;if(!k||"number"!==typeof k.scrollY&&"number"!==typeof k.scrollX)return!1;window.scrollTo(k.scrollX,k.scrollY);k=!1;return!0}var e=fdjt.DOM,v=fdjt.UI,k=!1,x=!1;v.scrollTo=function(k,m,q,g,c){a(g);m&&(document.location.hash=m);q?setTimeout(function(){h(q,c);e.isVisible(k)||h(k,c)},100):setTimeout(function(){h(k,c)},100)};v.scrollSave=n;v.scrollRestore=m;v.scrollIntoView=h;v.scrollPreview=function(a,m,q){a?a!==x&&(k||n(),"number"===typeof a?window.scrollTo("number"===typeof m&&m||0,a):
h(a,q),x=a):(e.dropClass(document.body,"preview"),x&&x.className&&e.dropClass(x,"previewing"),x=!1)};v.scrollRestore=m})();
(function(){function a(e,n,k){var x=m(e),p=x.display;if("block"===p||"table-row"===p||"list-item"===p||"preformatted"===p){p=h(e,k);if(p.top>n)return e;if(p.bottom>n){if("avoid"===x.pageBreakInside)return e;for(var x=e.childNodes,p=0,u=x.length;p<u;){var q=x[p++];if(q=1===q.nodeType&&a(q,n,k))return q}return e}}return!1}var n=fdjt.DOM,h=n.getGeometry,m=n.getStyle;fdjt.UI.smartScroll=function(e,m,k){"undefined"===typeof k&&(k=e);if(0>=m)e.scrollTop=0;else{var n=a(k,m,k);n?(k=h(n,k||e),e.scrollTop=
k-top-m<e.offsetTop/4?k.top:m):e.scrollTop=m}}})();(function(){fdjt.UI.Delay=function(a,n,h){setTimeout(h,a)};fdjt.UI.Delayed=function(a,n){n||(n=25);setTimeout(a,n)}})();
(function(){var a=fdjt.DOM,n=fdjt.UI;n.dosubmit=function(h){h=h||window.event;h=n.T(h);h=a.getParent(h,"FORM");var m=document.createEvent("HTMLEvents");m.initEvent("submit",!1,!0);h.dispatchEvent(m);h.submit()};n.forceSubmit=function(a){var m=document.createEvent("HTMLEvents");m.initEvent("submit",!1,!0);a.dispatchEvent(m)};n.submitOnEnter=function(h){h=h||window.event;if(13===(h.keyCode||h.charCode)){var m=n.T(h),m=a.getParent(m,"FORM");n.cancel(h);m.submit()}};n.checkFileInputs=function(h){h=h||
window.event;for(var m=n.T(h),m=a.getInputs(m,!1,"file"),e=0,v=m.length;e<v;){var k=m[e++];k.value&&""!==k.value||(n.cancel(h),(fdjt.UI.alert||window.alert)("You need to specify a file!"))}}})();(function(){var a=fdjt.DOM,n=a.addClass,h=a.dropClass,m=a.getGeometry,e=a.getInsideBounds;fdjt.UI.Overflow=function(a){var k=m(a);e(a).bottom>k.bottom?n(a,"overflow"):h(a,"overflow")}})();
(function(){function a(a,e){x&&(x.style.left=a+"px");p&&(p.style.top=e+"px")}function n(){e()}function h(e,g,c){a(g||e.clientX,c||e.clientY)}function m(a){"undefined"===typeof a&&(a=!u);a?(x&&v.addClass(x,"highlight"),p&&v.addClass(p,"highlight"),u=!0):(x&&v.dropClass(x,"highlight"),p&&v.dropClass(p,"highlight"),u=!1)}function e(a){"undefined"===typeof a&&(a=1500);u||(m(!0),setTimeout(function(){m(!1)},a))}var v=fdjt.DOM,k=fdjt.UI,x=!1,p=!1,u=!1;k.Reticle.setup=function(){x||(x=v("div.reticle.vertical#VRETICLE",
" "),v.prepend(document.body,x));p||(p=v("div.reticle.horizontal#HRETICLE"," "),v.prepend(document.body,p));v.addListener(document,"mousemove",h);v.addListener(document,"click",n);k.Reticle.live=!0};k.Reticle.highlight=m;k.Reticle.flash=e;k.Reticle.onmousemove=h;k.Reticle.setXY=a;k.Reticle.live=!1})();(function(){var a=fdjt.DOM,n=fdjt.UI;n.uploadSpecified=function(h){h=h||window.event;(h=a.getParent(n.T(h),".fileuploader"))&&a.addClass(h,"inuse")}})();
(function(){function a(m,e){"string"===typeof m&&(m=h(m));if(!m)return!1;e||(e=m.getAttribute("data-interval")?parseInt(m.getAttribute("data-interval"),10):a.interval);m.getAttribute("data-images")||m.setAttribute("data-images",m.src);m.defaultsrc||(m.defaultsrc=m.src);var n=m.getAttribute("data-images").split("|");if(0===n.length)return!1;var k=0;return setInterval(function(){m.src===n[k]?k++:m.src=n[k++];k>=n.length&&(k=0)},e)}var n=fdjt.UI,h=fdjt.ID;a.reset=function(a){a.defaultsrc&&(a.src=a.defaultsrc)};
a.interval=1E3;n.ImageSwap=a})();
(function(){var a=fdjt.DOM,n=fdjt.UI,h=fdjt.ID,m=a.hasClass;n.T=function(a){a=a||window.event;return a.target||a.srcElement};n.noDefault=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1;return!1};n.cancelBubble=n.noBubble=function(a){a=a||window.event;a.stopPropagation?a.stopPropagation():a.canceBubble=!0};n.cancel=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;return!1};n.isClickable=
function(a){for(window.Event&&a instanceof window.Event&&(a=n.T(a));a;){if("A"===a.tagName&&a.href||"INPUT"===a.tagName||"BUTTON"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"OPTION"===a.tagName||m(a,"checkspan")||m(a,"clickable")||m(a,"isclickable")||a.onclick)return!0;a=a.parentNode}return!1};n.isDefaultClickable=function(a){for(window.Event&&a instanceof window.Event&&(a=n.T(a));a;){if("A"===a.tagName&&a.href||"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"OPTION"===
a.tagName||m(a,"isclickable"))return!0;a=a.parentNode}return!1};n.submitEvent=function(a){for(a=a.nodeType?a:n.T(a);a&&"FORM"!==a.tagName;)a=a.parentNode;if(a){var h=document.createEvent("HTMLEvents");h.initEvent("submit",!0,!0);a.dispatchEvent(h)}};n.focusEvent=function(a){a=a.nodeType?a:n.T(a);var h=document.createEvent("HTMLEvents");h.initEvent("focus",!0,!0);a.dispatchEvent(h)};n.disableForm=function(e){"string"===typeof e&&(e=h(e));if(e){e=a.getChildren(e,"button,input,optgroup,option,select,textarea");
for(var m=0,k=e.length;m<k;)e[m++].disabled=!0}}})();
(function(){function a(a,c,b,d,e){d=k(c,b,d||.2);var q="string"!==typeof d,f=c.length;e||(e=n);if("string"===typeof d&&d.length===f)return a?m(a,c):document.createTextNode(c);b=q?d[0]:d;d=q?d[1]:"";var p=Math.round(100*(b.length+d.length)/f);a&&u(v,"ellipsis");v=q?c.slice(b.length,f-d.length):c.slice(b.length);v=m("span.elided",v);q=m("span.elision",h("\u00a0\u2026\u2190%d%% more\u2192\u2026",100-p));p=m("span.delision",h("\u00a0\u2192\u2026hide %d%%\u2026\u2190\u00a0",100-p));q.title="show elided text";
p.title="hide elided text";q.onclick=e;p.onclick=e;var v=m(a||"span.ellipsis",b," ",q,p,v," ",d);a&&u(v,"ellipsis");v.title=h.stdspace(c);return v}function n(a){var c=!1;if(a)"string"===typeof a?a=v(a):a.nodeType||(c=a,a=e.T(a));else if(c=window.event||!1)a=e.T(c);else return;if(a=x(a,".ellipsis"))c&&e.cancel(c),p(a,"expanded")?(u(a,"compact"),q(a,"expanded")):(u(a,"expanded"),q(a,"compact"))}var h=fdjt.String,m=fdjt.DOM,e=fdjt.UI,v=fdjt.ID,k=h.ellipsize,x=m.getParent,p=m.hasClass,u=m.addClass,q=
m.dropClass;e.Ellipsis=a;a.expand=function(a){"string"===typeof a&&(a=v(a));a=x(a,".ellipsis");u(a,"expanded");q(a,"compact")};a.contract=function(a){"string"===typeof a&&(a=v(a));a=x(a,".ellipsis");u(a,"compact");q(a,"expanded")};a.toggle=n})();(function(){function a(a){a=a||window.event;a=h.T(a);""!==a.value&&(a=n.getParent(a,"FORM"))&&a.submit()}var n=fdjt.DOM,h=fdjt.UI;fdjt.addInit(function(){for(var h=n.$(".fdjtselectsubmit"),e=0,v=h.length;e<v;)n.addListener(h[e++],"change",a)},"selectsubmit")})();
(function(){var a=fdjt.DOM,n=fdjt.UI,h=a.getParent,m=a.addClass,e=a.dropClass;n.updatePasswordVisibility=function(a,e,h){a=a||window.event;"string"===typeof e&&(e=document.getElementById(e));e&&(a=n.T(a),e.type=h?a.checked?"PASSWORD":"TEXT":a.checked?"TEXT":"PASSWORD",setTimeout(function(){e.focus()},1E3))};n.uploadSelected=function(e){e=e||window.event;e=n.T(e);(e=a.getParent(e,".upload"))&&a.addClass(e,"uploading")};n.FocusBox.focus=function(a){a=a||window.event;a=n.T(a);(a=h(a,".focusbox"))&&m(a,
"focused")};n.FocusBox.blur=function(a){a=a||window.event;a=n.T(a);var k=h(a,".focusbox");k&&setTimeout(function(){e(k,"focused")},200)}})();
(function(){function a(a){a=a?fdjt.keeptime?n.getChildren(a,".fdjtime"):n.getChildren(a,"time,.fdjtime"):fdjt.keeptime?n.$(".fdjtime"):n.$("time,.fdjtime");for(var h=0,k=a.length;h<k;){var x=a[h++],p=x.getAttribute("datetime")||x.getAttribute("data-datetime")||x.getAttribute("data-time"),u=p&&new Date(p),q=u&&"nogood"!==(u.getYear()||"nogood");p||(p=x.innerText,(q=(u=new Date(p))&&"nogood"!==(u.getYear()||"nogood"))&&("TIME"===x.tagName?x.setAttribute("datetime",p):x.setAttribute("data-datetime",
p)));q&&(x.title||(x.title=u.toGMTString()),m(x,"fdjtkeeptext")||(m(x,"fdjtisotime")?u.toISOString&&(x.innerHTML=u.toISOString()):m(x,"fdjtutctime")?u.toUTCString&&(x.innerHTML=u.toUTCString()):m(x,"fdjtdate")?u.toDateString&&(x.innerHTML=u.toDateString()):m(x,"fdjtdateortime")?u.toDateString&&u.toTimeString&&(u.toDateString()===(new Date).toDateString?x.innerHTML=u.toTimeString():x.innerHTML=u.toDateString()):m(x,"fdjtlocaletime")?u.toLocaleString&&(x.innerHTML=u.toLocaleString()):m(x,"fdjtlocaledate")?
u.toLocaleDate&&(x.innerHTML=u.toLocaleDate()):m(x,"fdjtlocaledateortime")?(u.toLocaleDateString&&u.toTimeString&&(u.toDateString()===(new Date).toDateString?x.innerHTML=u.toLocaleTimeString():x.innerHTML=u.toLocaleDateString()),u.toLocaleDate&&(x.innerHTML=u.toLocaleDate())):(m(x,"fdjthumantime"),x.innerHTML=u.toDateString&&u.toLocaleTimeString?u.toDateString()+" ("+u.toLocaleTimeString()+")":u.toLocaleString?u.toLocaleString():u.toString())))}}var n=fdjt.DOM,h=fdjt.UI,m=n.hasClass;fdjt.initTimeElements=
a;fdjt.autoInitTimeElements=function(){n.addListener(document.body,"DOMNodeInserted",function(e){e=e||window.event;a(h.T(e))})};fdjt.addInit(a,"TimeElements",!1)})();(function(){var a=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;fdjt.UI.vibrate=function(n){if(!a)return!1;a(n);return!0}})();
fdjt.disenableInputs=fdjt.UI.disenableInputs=function(){var a=fdjt.DOM,n=a.getStyle,h=a.hasClass,m=a.$;return function(a){for(var v=m("input,select,button,textarea",a),k=0,x=v.length;k<x;){var p=v[k++];if(!h(p,"fdjtignore")){for(var u=p,q=!1;u&&u!==a;){if("none"===n(u).display){q=!0;break}u=u.parentNode}p.disabled=q}}}}();fdjt.showPage=fdjt.UI.showPage=function(){function a(a){var b;(b="string"===typeof a?document.getElementById(a):a.nodeType?a:fdjt.UI.T(a)?fdjt.UI.T(a):!1)?b=f.getParent(b,".fdjtpage")||b:D.warn("Bad showPage container arg %s",a);return b}function n(a,b,c){b||(b=a.offsetHeight);return c?a.scrollHeight>b-c:a.scrollHeight>b}function h(a,b,c){"undefined"===typeof b&&(b=!0);"undefined"===typeof c&&(c=!0);return c&&a.scrollHeight>a.offsetHeight||b&&a.scrollWidth>a.offsetWidth}function m(b,d,h){if(b=a(b)){h=
"number"!==typeof h?1:0>h?-1:1;var r=t(E(b,".fdjtshow")),da=y(b,".fdjtstartofpage"),X=y(b,".fdjtendofpage"),S=y(b,".fdjtpageinfo"),w=g(b),ga=w.length,K,C=0>h?"fdjtstartofpage":"fdjtendofpage",l=T(b,!1,!0).bottom_padding,A,z=fdjt.device.touch?"touchstart":"click";if(0!==w.length&&(d?"number"===typeof d&&0<d&&1>d?(K=Math.round(d*w.length),d=w[K]):"number"===typeof d?(K=d-1,d=w[K]):d.nodeType&&(d=q(b,d),K=w.indexOf(d)):(K=0,d=w[0]),!(!d||0>K||K>=ga||0===K&&0>h))){O(b,"fdjtpage");A=b.offsetHeight;O(b,
"formatting");S||(S=u(b,K,ga));r.length&&(F(r,"fdjtshow"),F(r,"fdjtoversize"));da&&F(da,"fdjtstartofpage");X&&F(X,"fdjtendofpage");O(d,"fdjtshow");O(d,0>h?"fdjtendofpage":"fdjtstartofpage");d.offsetHeight>A&&O(d,"fdjtoversize");if(0>h&&M(d,/fdjtpagebreak(auto)?/)||n(b,A,l))return F(b,"formatting"),K;d=c(b,w,K,h,A,l);r=w[d];if(0<h&&M(r,"fdjtpagehead"))for(;d>K&&M(r,"fdjtpagehead");)F(r,"fdjtshow"),F(r,C),d--,r=w[d],O(r,C);if(0<h&&M(r,"fdjtpagekeep"))for(;d<K&&M(r,"fdjtpagekeep");)F(r,"fdjtshow"),F(r,
C),d++,r=w[d],O(r,C);C=w=!1;0===K?(O(b,"fdjtfirstpage"),w=!0):F(b,"fdjtfirstpage");d>=ga-1?(O(b,"fdjtlastpage"),C=!0):F(b,"fdjtlastpage");if(0>h&&0===d)return F(b,"formatting"),m(b,0,1);h=K<=d?K:d;K=K>d?K:d;da=f("span.count",f("strong","/"),ga);r=f("span.value",Math.floor(h/ga*100));da=f("span.pct",r,"%",da);X=f("span.button.forward"," \u300b");l=f("span.button.backward","\u300a ");S.innerHTML="";f.append(S,l,da,X);S.title=J("Items %d through %d of %d",h,K,ga);r.setAttribute("contentEditable","true");
I(r,"blur",v);I(r,"keyup",P);I(r,"keypress",P);I(r,"keydown",e);I(da,z,k);w?l.innerHTML="\u00b7 ":I(l,z,p);C?X.innerHTML="\u00b7 ":I(X,z,x);O(b,"fdjtpagechange");setTimeout(function(){F(b,"fdjtpagechange")},1E3);F(b,"formatting");return d}}}function e(a){var b=w.T(a),c=K(b,".fdjtpage");if(c){var d=a.keyCode;b._savedHTML||(b._savedHTML=b.innerHTML);if(13===d){try{var e=f.textify(b),g=parseFloat(e)/100;"number"!==typeof g||Number.isNaN(g)?(b.innerHTML=b._savedHTML,b._savedHTML=!1):m(c,g,1);b.blur()}catch(h){b._savedHTML&&
(b.innerHTML=b._savedHTML,b._savedHTML=!1),b.blur()}C(a)}else 27===d&&(b._savedHTML&&(b.innerHTML=b._savedHTML,b._savedHTML=!1),b.blur(),C(a))}}function v(a){a=w.T(a);var b=K(a,".fdjtpageinfo");b&&F(b,"fdjteditpageinfo");a._savedHTML&&(a.innerHTML=a._savedHTML,a._savedHTML=!1)}function k(a){var b=w.T(a),c=f.getChild(b,"span.value");(b=K(b,".fdjtpageinfo"))&&O(b,"fdjteditpageinfo");c&&c.focus();(b=window.getSelection&&window.getSelection())&&b.anchorNode&&K(b.anchorNode,c)&&(c=b.anchorNode,3===c.nodeType&&
b.extend(c,c.nodeValue.length));C(a)}function x(a){fdjt.UI.cancel(a);b(a)}function p(a){fdjt.UI.cancel(a);d(a)}function u(a,b,c){b=f("div.fdjtpageinfo",b+1,"/",c);a.appendChild(b);return b}function q(a,b){for(var c=b,d=c.parentNode;d&&d!==a;)c=d,d=c.parentNode;return d===a?c:!1}function g(a){var b=[],c=a.childNodes;O(a,"getvisible");for(var d=0,f=c.length;d<f;){var e=c[d++];if(1===e.nodeType){var g=G(e);"none"===g.display||g.position&&"static"!==g.position||("always"===g.pageBreakBefore?O(e,"fdjtpagebreakauto"):
F(e,"fdjtpagebreakauto"),b.push(e))}}F(a,"getvisible");return b}function c(a,b,c,d,f,e){var g=b.length,h=b[c+d],t=b[c],k=0>d?"fdjtstartofpage":"fdjtendofpage";c+=d;for(O(t,k);0<=c&&c<g&&!(0<d&&M(h,/fdjtpagebreak(auto)?/));){F(t,k);O(h,"fdjtshow");O(h,k);h.offsetHeight>f&&O(h,"fdjtoversize");if(n(a,f,e)){O(t,k);F(h,"fdjtshow");h.style.display="";F(h,k);break}if(0>d&&M(h,/fdjtpagebreak(auto)?/))return c;c+=d;t=h;h=b[c]}return c-d}function b(b){if(b=a(b)){F(b,"fdjtpagechange");var c=y(b,".fdjtendofpage");
return c?M(b,"fdjtlastpage")?!1:c.nextSibling?m(b,c.nextSibling):!1:m(b)}}function d(b){if(b=a(b)){F(b,"fdjtpagechange");var c=y(b,".fdjtstartofpage");return c?M(b,"fdjtfirstpage")?!1:c.previousSibling?m(b,c.previousSibling,-1):!1:m(b)}}function A(b){if(b=a(b)){var c=y(b,".fdjtstartofpage");if(c.hidden){for(;c;)if(1!==c.nodeType)c=c.nextSibling;else if(c.hidden)c=c.nextSibling;else return m(b,c);m(b)}else m(b,c)}}var w=fdjt.UI,f=fdjt.DOM,D=fdjt.Log,J=fdjt.String,G=f.getStyle,y=f.getChild,E=f.getChildren,
F=f.dropClass,O=f.addClass,M=f.hasClass,I=f.addListener,t=f.toArray,T=f.getGeometry,K=f.getParent,P=w.cancelBubble,C=w.cancel,U=f.adjustFonts;m.isOversize=h;m.checkOversize=function(a){var b=a.style.overflow||"";a.style.overflow="auto";h(a)&&(O(a,"fdjtoversize"),h(a)&&U(a));a.style.overflow=b};m.forward=b;m.fastForward=function(b){if(b=a(b)){var c=y(b,".fdjtendofpage");if(!c)return m(b);if(M(b,"fdjtlastpage"))return!1;if(c.nextSibling){var d=g(b),c=d.indexOf(c);return m(b,d[Math.floor(c+(d.length-
c)/2)],1)}return!1}};m.backward=d;m.fastBackward=function(b){if(b=a(b)){var c=y(b,".fdjtstartofpage");if(!c)return m(b);if(M(b,"fdjtfirstpage"))return!1;if(c.previousSibling){var d=g(b),c=d.indexOf(c);return m(b,d[Math.floor(c/2)],-1)}return!1}};m.update=A;m.check=function(b){if(b=a(b))M(b,"fdjtpage")?b.offsetHeight&&M(b,"needsresize")&&(F(b,"needsresize"),A(b)):b.offsetHeight&&m(b)};m.showNode=function(b,c){if(b=a(b)){if(!M(b,"fdjtpage"))if(b.offsetHeight)m(b);else return!1;for(var d=c.parentNode;d&&
d!==b;)c=d,d=c.parentNode;if(d)return M(c,"fdjtshown")?!1:m(b,c)}};return m}();fdjt.Dialog=function(){function a(a){a?"string"===typeof a&&(a={spec:a}):a={};var c=b(a.spec||"div.fdjtdialog");a.classes&&(c.className=(c.className||"")+(c.className?" ":"")+a.classes);a.style&&c.setAttribute("style",a.style);if(!(a.modal||a.keep||G(c,"fdjtmodal")||G(c,"fdjtkeep"))){var d=b("div.countdown","Closing\u2026");d.id="FDJTCOUNTDOWN"+O++;c.appendChild(d)}a.modal||a.noclose||G(c,"fdjtmodal")||(d=b.Image("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyEAYAAAE5qGRkAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAASAAAAEgARslrPgAAEXpJREFUeNrdXGl4VEW6fqv3bCT0SQjhVADpCggMuywiUTbZAoRNFlkER8SZwUdnrtuMy+idcUZFwHEYERdAkR1kcxRkXwVBWYSw5DSE5DQQyOmsnd677o9Ah5vcvt2ns3Cf+/7Jw6n63u99vzpL1anTALeh5NH2rNPGKQgBe6f0NhmW+D8HDygLxRKmG3JQUShljHPlEjWzjmszgwGt6Xi2Mfb5YLuTprM2xU2rGS20NWudNSPYIV+0sfYrtwX/XUgtLK304VCKoNhpf7ZoohIMUGgy6+QvqdlPEwy4JE5kIwwzwCHhg7VmuOCHt3IjABOcmkQlIJayQZ+uqc7wmliZodO/FMxQSpuyLg570EJb0cnaTj4bbK+k/ZjlozHVBCW0NUt33heyqhm0M5s1fR2iBbmT+s4BQZBlSSIkqKBGe8iGmqhJhJqBoQhUZ1DtIXrU1K6coxms5dq+Ecd/Tw+xdxNoqBoETzXSE4/xE1m7gpHN4YRh4uFgYDEdwB5buS9IvE7cw9bGvRwk7IHJ+LSsIBgfByCmeGmtItdSuI9qWVr2RHRCGuI2rw1ryQ0/tKUJQgv5unQxqaJmsyZUHPk1/4ov3fFJxLUvBkX++t2hmquv0s30T2ypccGdUvAfyYvkWWdisKcfgLdiU/D0aY9byJi88K5SX4f4VK+7Lspx7LGP+9QqXa3TygsvnI7rQnO5ULLFtwhnyN6eWlj6tKf5IbhhXLHkzvFaV47SXcxkC0yeiEsVAsp+ms7EL14JOrE/Rxey38VM4m9gPnZUBm9cIa/dUMQ1K2FCIZKWyiTqm0Qo4hqI+m4U8b1FraJwqCkkauuRljLsINZ1jBrfQYONQYOdRQ19HWjg5meQMC5JLXHYfn744Sv1Visppc0YHWeLtvZBnmtUYOnloYUpbUW3ZWPMu7UeuaU0kbH14R9M9QTlFn2Z2ROSaumwiXb2q+WtavYnxUnp/dhU4/aAlefhmGtopIlIKlqhybonzT75sPTzpGV1FW5/QpTZo3F/5gtIH1ypeDPiQC8CSF72QHBo7DqabKkcfoQXwkQ6f/ugaiU6JCF9tSwkymelvY+nhxX+Cn3QsjbuU/4iCsirFU+pzueFBw57QGgu35SuC9qQ55id0Cw2O+sEL8Jp7P2mh+pEJ1CB/JVDhKFyieSZtlOZKPZik2Pfw2JyDSccL6rm8yMOvOSk0Ey+KFmbdq/ZHPnz+JxYxjQj3WhOOqDNNoNqIWqhgw6a0m5CopwnXUo6Fa57xEZqGZMos+RnT0JTuMjAzWui5QlCCx08ZR8ISXKelJ/4e7XhGrUBwQr8k8fh4R11ntIFkQc3+Mb2UeuJtKN9NBUsM01JfBliyCFncRS53Lf/GiMSxtAB2s+mmIvl76WLs8OOeOhH6As03rLKmIY/Iom84bqmWrYHDjgrDglpcrFkS8hUXDSWJTxWCQfMSF0Xo5aOiEhD/CfHzC75uHRqTp9a7UHhs8T5ll+M/fE+WUjGuvaqFk7ghc+RKZjlQikv/lC47koubcs0kz+DGZVos/rXqtM1hxEtF6ebvbJV2vNbmSgBmsj0oy6iGAlotbVtxEw+EAQqVwupcoF0Oe5x1cZrGjsmVlicU4aDkftJp1XfRhzohgvashu1Ti27nvZjxrFX+Q3kIf3rlnc1VYBXrhcEuUSyxk2sq/Cwxs6JlZaC6WY0J23JgC+VYIMWfpCyDUKSfF3KTXwsPNFZamDp32YrT9IKy1/19Xd3UmuomGayfvu2FS1JT2Vm7dnIA/OpkTXZtq/mZM3+gVjIsoz3N5oBP23DHtxTPWksoiJjvMw+TJzHSnQna/avfnlxlqaz9ltLEIcUNBv5SM2OfDrpgYuuc8okOs1y1nClwQyU0p5M3J2KEnhwa0D1bZ6AAEjgq8g/0NPbXHlafN+yQHfXKwU97cS6bJ3Fb6AYjlFLI8wXINuQiymGs+aZcoz0F2+XOhsopqlswC6GAPQoGJQbNoAAILjFd6EQTt1TGp6HEngHd1aZV8NHIQOrPZ2VvmI3yzDd36I2cI22Yxm7ScQG7oAD4EjRrATh53vs1AiiXCDlxP4eWujgrjyjWsk2cotYvS/a19KW7Gl9XqRh9kTagXXe2QxGOMAHBlTnLebf8w/7fG7eInusCT86g9eIkCTnSQVxXWBADAKVR1WRcuj4YHDs9TS3d6GnLJ8b0kKOgI1msAe2/5tfRhkqBxeq1U/m4iHM6btMYLYO1hHHguuY0FOUCtqSdXBmwY0APKZvVJji4KjkbszjX+r1yaL8uPUhn0G5KLrZwO1bkUwsyB86SrWBf0CD9L7Pmv9Tzpf2/rCoVns4AqWStmAZrmw4oQE3blaZ3wcXbuLajn/BhGZoMfQ51QY6Ygw/+WCh+Ya8yJpwtHnIfpESKvk0hbV0jkccjDCYNqgVpBpOCLje7zWByqclx+G3wxpWy69cpxaW7uwEA9wwmtTfHMIJSuX56Jc53+yzaaTlh16IOC7ahEohbc/SXDHQoRxxxso6O4jDRBQ+vEowyQuk8oNTVRegrvmVIprOMnglCDg41K8z2oFC0/8Jc5F8VLq0/8todUS91FUCopdptr4RrYE74BchI7DvoyIvPWiZpmJSWLMgqg2U0kQmbvbBhwTEZGujTVzbEQiAHNIaE3gr/QxzhbzQutv3U70bURTahrHNBIAHyFb/JI5cEQFwiozFy6jQlZv3y3OlG/6Hw4eFM1BERZaxSQYBAR8jqhamBaD1OuEH4NerOQU5gIKAggS+Vdsvpa18wdohkB+qc8hrRLlCzUzY9ETUBq7xDXzXoHZCkixLFw2x0MAPv6dIBQMBkK4RUEFG+88Xj0nvn0E0IU+1WkaUG5SxzhtGogli0XTMctUGfuGn+f5HM4VOtj7W1nsu3TksNJWvS1eMKVVvED3DVLLGBj7nVm7xe+zvpP+c8bP2vf/JdZWBC5Qx8/plSIEL5gkzVRvI5+f5yiGPCt1sCdbeO3eF664U03TW2pOKADh0+hsR56lSvAk+tMcx3fNCM3mnJPjzieKnqazH+hMogR6lE9S/rNbwFWj56LtCU9sAac+uVyINu73ppLGX0RYsw7sVPmjAdVmqchP8wPPJ25q+GosGpdDBNWqPagMBaKAb2k2tgaCGqsoGzE3ka1KufhT80MHvtasi4XhQ0y3QM3DroV537wKKjDlzARDAxEIKuI8fR96wcnOZLU3y7WiiugChNFWNkN5eRluyDM9M+BAA14f+suIAjDznkSbCWNlqNRwor15YCbJNkmIyoIUGenft23I+v4KYEdn1bSBYoKqMXnMTOV/KNayAHxx+b611ELkfduj6f3fHQFhixU5bsDbuJfZYGmspHN67voWHw+0RMiiltAVr55ulHBZzLe5H/qPOxEqWuM2SHdNDuUqTWNI3e2ttUp6nSSxlw0dKX3ED0xm2Nrbxxoa9Ge3FlsavV/xUZJ32dr/r/RtljDsVq1jKWi3Pt38tGtjjulcj5Q05Qyly0YEsNmYRuYpfkLJuPpJhhH7k5YgVO8DRct1xbIAdy6b3FP4gO6VWnjqvGu4VFCudxwYmDEQLfIHA5g6oRAnkgf8MG8jBAdih5QVgy+JwCB3Jiae/EUbZzucW+SbU7F69OX2A7mErTJd5L8zF4nUmOFCGm6PSwiaMDAFcRTKwrgOZgz8iZvp483F5kvSLJ+rXeg0NZR59yzIufi1mYjfZu2UWNLgMYaCjzsRV70evIwAnYpaW4gG+ma+Y01nIs2Vau/i8RHHRrsy8djUcKIJ54uRG8svRBCa0WjeevM1nkwtT3zC/aXs51+br1kj5a0Fx089Yq9jRcOFN+Lbq4AMQM2hjoyQnKEM5NCj/sEv19KRYPMpaDfsRnIyA9utnwBELTUzEy8w6guMS9Ehccw2P8I04M+M5wWPrLnm9DVYQew79OEMb14vH4RPedcsVxOMmSgfdbCS/VV/Eeoqfwg3+C982bLbQ3ZZs7fJjn9CfoTShyZb8EWO4DIH0WT8NXjgQGzu+EaQSEHgQgzS0X92bvISH8NbMMvMieaHUzRP5M6wGlNz0zmxI3HtoyhOR9/UKEFxBYEi9v1sMCSMI4ounws838/dGXBUSbT2sQ44erm0+Qtg70ydY5xG7+CHshmPDFngBkJgPG8EKAYEbF3CTn1k5E1MwDG/N6irky1us73hDroCUt0UTK49ri6kkBVkbX0ACOK4Nnd0IequQAB90JSnkBbREnxHLzB/KP0rLfwi7/xD1rMeeQnuzzKyZ/CpsKNx4DU4AAeOOBjdaNWtx4iA0KF+5lN8ibnhn/otYeQ9+Td8V07GdtNv8M9IgQj/kQoPruQM/YuErPUpa4LfQDEs1++TnpctH26ilqbdpqFJITYxkWeFDIlpt2AAT9NCZXmq0gjQ2tDBAX/odLuBB/smIdUIfeaU188jyutI22LpA+VosYv1GX0Rv0ha2tYNgQiy0poK6M98jGEDAS0rhB/ipUR2EJLnAmnBI/VdfYdBoCzXlNBUtzux3kAo9saypgB4+xJr+0lj5VYPDiECpFev5OXQceVX4jc0kbTs0qKHT3rOVs3KFTrV4sx9BDI6R7uuSoIcLTsPme6UHOmjgLH+eNMdD/HTWEbNTXm1NPni8sWVEvW9YV5Cdgfn85PZxiIcV5p2NN/sJBRuKkbJxBucYzHceabz1SM26NFYi+0DxRcsrpoP8W/IBWbw2Bw6kImX00/fKeBjcwAU0hWbpFvIGfIHtc54z75bPX27jc9ed+n9Hwz3UC2gM6206BAMEONachA6AK3tuQxuqd1RtlJ+GCW1Q+tkm8lfM40t+87n5HbmXdZxPru909Tft9dBVLMY4Gm78DYlrUuFBCeLHRP6b1/rDndtNswZhJ+AAzpEWcCD1s0Vwk3gMfuaAmRfI0lv+nLrTRwllmbiJ7TMMxxAyBS+sc8OEZJRk746WTzXccMHjeB05PAf2UT+RoaQb7hd685sAilcxAAREr/qroihRiTIkwPvpV9oZOI7Jz7yUdFCOl94NlKolivzTkzzahWUas6HHTUirJsAELeLGTWskw4AfZSivmA4X/4pvGLNWaGkbbc3c7Q3V3W4Uyy0lE228kGSQ7isWwA8dNIb3G0ntJSShIyxL3OQK6U6Sf/eqmRX8PXelf1u4wNDflL5H/826GOdhIl5F4leDkYAiXJvQtZEMAQEE4K44jjOo4CfHPS0MksusyTtPRUtnN9OHWedJhTwHeXB8+Tr0CIAYlkTLpwIEBLuQgPvAPj5GWuEosuaeM1+XPdJc/+rane8IXiXmsIcMa3gv0gu2lQKaIgm6CYMbQXAVNHDB6yhGCT+M1mPThfts7aT9O+u+IVQDd74TKU6lTZlhSn9+CXFo88Vr8APw6Qc0uM+qin+LJkhB18Wz8Hd8QqbMfV94Xe6ZOz4wgyiXaDv2q5VzIMAB1+OL/1tYQ8IFDfzOM0jhhxGbPVAw2NKlczuVuhOrw+0BIvYfRCvTTy5DRzIArb/qX/W5iPZEI8mwIYAHoFswuHqDKoca2JgxfdEMAnLWcBBoETAeqbeUfnD4KkXSjBeAjGtnhk0jXdmh/od0DYzgFURodxY/tTkvgR3isoXwwwe/vv5+RuZBJVA2DN/wlfCNrBRm24ZLeQcPhn6GVNLxzDx2KVz4CUmrOoDDB40p8s9onAhA63BgNd/OD0yYLbxo62xN3b464vj/I7g9QCa7m2otFdNdKEUa6fL5M9ABIPrFkRPBDWepA6eQyn8YPV8YLJ+1tjzw55rdIt+gEmhbNmHsJZ4LJ06vvlL1gxDjkGAHLfTwOkcilm/FzfHjBYOtk+T87sl7XdD6xu0BMtpt4hXLkWlOGElfMmXZYGighV5XPe2vhBeB8q44z3NgH7VBGGITpJL9GQ0mTLlFm7DYcX+yC/QPlpzhYf8LhP+v4IEe3Xt0h95uoZls2rRnlSPiQcupR6Iu/H8B7AjpZA9bJIMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTQtMTItMzFUMTI6NDQ6NTYtMDU6MDBEL5TZAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTEyLTMxVDEyOjQ0OjU2LTA1OjAwNXIsZQAAADh0RVh0c3ZnOmJhc2UtdXJpAGZpbGU6Ly8vc3JjL2dyYXBoaWNzL3RhcmdldHMvZmRqdC9yZWR4LnN2Z3qXB16JAAAAAElFTkSuQmCC",
"closebutton","Close"),E(d,"click",e),E(d,"touchend",e),E(d,"touchstart",A.cancel),d.title="click to close",c.appendChild(d));a.title&&(a.title.nodeType?g.push(a.title):(g=D(a.title,a,a.data),c.title=g,c.appendChild(b("div.title",g))));for(var g=[],g=1,d=arguments.length,h=!0;g<d;){var k=arguments[g++];if(k.nodeType){h=!1;break}else if("string"===typeof k&&0<=k.indexOf("<")){h=!1;break}}h?(h=b("P"),c.appendChild(h)):h=c;for(g=1;g<d;)if(k=arguments[g++])if(k.nodeType)h.appendChild(k);else if("string"===
typeof k){var k=J[k]||k,m=0<=k.indexOf("<"),B=0<=k.search("{{");m&&B?h.appendChild(f.toDOM(k,a)):m?b.append(h,k):B?h.appendChild(document.createTextNode(D(k,a))):h.appendChild(document.createTextNode(k))}else h.appendChild(document.createTextNode(k.toString));a.id&&!c.id&&(c.id=a.id);b.addListeners(c,a);return c}function n(a){a=(a=a||window.event)?a.nodeType?a:A.T(a):w("FDJTALERT")||w("FDJTDIALOG");if(a=b.getParent(a,".fdjtdialog")){var c=b.getChild(a,".countdown");if(c&&c.id){var d=M[c.id];d&&clearInterval(d);
delete M[c.id]}m(a);b.remove(a)}}function h(a,c){var d=(a=a||window.event)?a.nodeType?a:A.T(a):w("FDJTALERT")||w("FDJTDIALOG");a&&!a.nodeType&&A.cancel(a);var f=b.getParent(d,".fdjtdialog");f&&(m(f),c?b.remove(f):b.transitionEnd&&!b.hasClass(f,"closing")?(b.addListener(f,b.transitionEnd,function(){b.remove(f)}),b.addClass(f,"closing")):b.remove(f))}function m(a){if(a=b.getChild(a,".countdown")){var c=M[a.id];delete M[a.id];c&&clearInterval(c)}}function e(a){a=a||window.event;A.cancel(a);h(a)}function v(a){a=
a||window.event;var c=A.T(a),c=b.getParent(c,".fdjtdialog");m(c);c.style[b.transitionDelay]="";c.style[b.transitionDuration]="";b.dropClass(c,"countdown");b.dropClass(c,"closing");A.cancel(a)}function k(){var c=b.toArray(arguments),c=a.apply(null,[{}].concat(c));y(c,"fdjtalert")}function x(){var c=w("FDJTALERT");c&&(c.id="",b.dropClass(c,"closing"),n(c));c=b.toArray(arguments);c=a.apply(null,[{}].concat(c));c.id="FDJTALERT";b.prepend(document.body,c);return c}function p(a,c,d){var f=b.getChild(a,
".countdown");f.innerHTML="\u2026"+c+"\u2026";var e=c;a.style[b.transitionDelay]=e/2+"s";a.style[b.transitionDuration]=e/2+"s";var g=setInterval(function(){0>=e?(clearInterval(g),g=!1,delete M[f.id],d&&d(),b.remove(a)):f.innerHTML="\u2026"+e--+"\u2026"},1E3);M[f.id]=g;f.onclick=v;E(f,"touchend",v);E(f,"touchstart",A.cancel);setTimeout(function(){b.addClass(a,"closing")},10);return a}function u(c){var d=w("FDJTALERT");d&&(d.id="",b.dropClass(d,"closing"),n(d));d=[{timeout:c}].concat(b.slice(arguments,
1));d=a.apply(null,d);d.id="FDJTALERT";b.prepend(document.body,d);p(d,c);return d}function q(c){var d=w("FDJTMESSAGE");d&&(d.id="",b.dropClass(d,"closing"),n(d));d=b.toArray(arguments);d=a.apply(null,d);c.timeout&&p(d,c.timeout);d.id="FDJTMESSAGE";b.prepend(document.body,d);return d}function g(a,c,d){var f=a.dom;f||(f=b("button"),a.label.nodeType?f.appendChild(a.label.cloneNode(!0)):f.innerHTML=a.label?a.label:"Choice "+d);a.name&&(f.name=a.name);a.value&&(f.value=a.value);f.onmousedown=A.cancel;
f.onmouseup=A.cancel;f.tabIndex=d;a.title&&(f.title=a.title);a.classname&&y(f,a.classname);f.onclick=function(d){d=d||window.event;var e=A.T(d),e=b.getParent(e,".choices"),e=b.getChild(e,".selected");e!==f&&(e&&(b.dropClass(e,"selected"),e.blur()),b.addClass(f,"selected"),f.focus());a.handler&&a.handler();A.cancel(d);c()};E(f,"touchstart",A.cancel);E(f,"touchend",f.onclick);return f}function c(a){function c(){for(var b=0,d=h.length;b<d;){var e=h[b++];e.onclick&&F(e,"touchend",e.onclick);F(e,"touchstart",
A.cancel);e.onclick=null;e.onmousedown=null;e.onmouseup=null}m&&(F(m,"touchend",m.onclick),F(m,"touchstart",A.cancel),m.onclick=null);f&&(f.onclick=null);f&&(f.onkeydown=null);if(f)var r=setTimeout(function(){if(a.onclose)a.onclose(f);n(f);clearTimeout(r);r=!1},500)}var f=!1,e=-1,h=[],k,m=!1,B=!1;if("function"===typeof a)k=[{label:"Cancel"},{label:"OK",handler:a,isdefault:!0}];else if(a.constructor===Array)k=a;else if(a.choices)k=a.choices;else if(a.label&&a.handler)k=[{label:"Cancel"},a];else if(a.handler)k=
[{label:"Cancel"},{label:"OK",handler:a.handler,isdefault:a.isdefault}];else if(k.length)k=a;else{d.warn("Bad spec %o to fdjtUI.choose");return}a.onchoose&&(B=a.onchoose);for(var q=0,r=k.length;q<r;){var da=k[q],X=g(da,c,q);h.push(X);0>e&&da.isdefault&&(X.setAttribute("autofocus","autofocus"),b.addClass(X,"selected"),e=q);q++}0>e&&!a.nodefault&&(b.addClass(h[q],"selected"),e=0);f=I(a,b("div.message",b.slice(arguments,1)),b("div.choices",h));m=b.getChild(f,".closebutton");a.cancel?(F(m,"touchend",
m.onclick),m.onclick=c,E(m,"touchend",m.onclick)):b.remove(m);var w=a.cancel||!1;f.onkeydown=function(a){a=a||window.event;var b=a.keyCode;9===b?(a.shiftKey?e--:e++,0>e?e=h.length-1:e>=h.length&&(e=0),0<=e&&h[e].focus(),A.cancel(a)):13===b?(0<=e&&k[e]&&k[e].handler&&k[e].handler(),B&&0<=e&&k[e]&&B(k[e],f),c(),A.cancel(a)):w&&27===b&&(c(),A.cancel(a))};b.addClass(f,"fdjtconfirm");f.id="FDJTDIALOG";b.prepend(document.body,f);a.timeout&&p(f,a.timeout,function(){a.noauto?c():(0<=e&&k[e]&&k[e].handler&&
k[e].handler(),B&&0<=e&&k[e]&&B(k[e],f))});0<=e&&h[e].focus();return f}var b=fdjt.DOM,d=fdjt.Log,A=fdjt.UI,w=fdjt.ID,f=fdjt.Template,D=fdjt.Template,J=fdjt.Templates,G=b.hasClass,y=b.addClass,E=b.addListener,F=b.removeListener,O=1,M={},I=a;a.close=h;a.alertBox=k;A.alertBox=k;a.alert=x;A.alert=x;fdjt.alert=x;a.setCountdown=p;A.setCountdown=p;a.alertFor=u;A.alertFor=u;a.message=q;fdjt.message=q;a.Choice=c;a.choose=c;A.choose=c;fdjt.Choice=c;return fdjt.UI.Dialog=a}();fdjt.UI||(fdjt.UI={});
(function(){function a(a,b,c){this.dom=a||!1;this.input=b||!1;this.options=c||7;this.nodes=[];this.values=[];this.serial=++f;this.cues=[];this.displayed=[];this.known={};this.prefixtree={strings:[]};this.bykey={};this.byvalue=new P;this.selclass=this.selected=!1;c&8||(this.stringmap={});this.initialized=!1;return this}function n(a){return a.key||a.getAttribute("data-key")||a.getAttribute("key")||D(a,"variation")&&g.textify(a)||D(a,"completion")&&h(a,"")}function h(a,b){if(3===a.nodeType)return b+
a.nodeValue;if(!D(a,"variation")&&!D(a,"fdjtskiptext")&&1===a.nodeType&&a.childNodes)for(var c=a.childNodes,d=0,f=c.length;d<f;){var e=c[d++];3===e.nodeType?b+=e.nodeValue:1===e.nodeType&&(b=h(e,b))}return b}function m(a,b,c,d,f){b=(f?b.split(/\W/g):[]).concat(b);f=0;for(var e=b.length;f<e;){var g=b[f++];t(c,g,0);d[g]&&d.hasOwnProperty(g)?d[g].push(a):d[g]=Array(a);d._count++}}function e(a,b,c,d){var f=[],e=[],g=[],h=u(a);if(M(h))return[];d||(h=a.toLowerCase());a=T(b,h,0);b=!1;for(var k=[],t=[],m=
[],l=0,q=a.length;l<q;){var z=a[l++],p=z===h;b=b?K(b,z,!1,!d):z;var n=c[z];if(n)for(var I=0,w=n.length;I<w;){var A=n[I++];if(!(D(A,"hidden")||0<=f.indexOf(A)))if(D(A,"completion"))p&&(t.push(A),k.push(A)),f.push(A),m.push(z),e.push(A);else{var F=E(A,".completion");F&&D(F,"hidden")||!F||(p&&k.push(F),f.push(F),m.push(z),g.push(A))}}}k.length&&(f.exact=k);t.length&&(f.exactheads=t);f.prefix=b;f.strings=a;f.matches=e.concat(g);return f}function v(a,b,c,d){"undefined"===typeof c&&(c=b.key||n(b));d||(d=
b.value||b.getAttribute("value")||c);b._seen||(a.nodes.push(b),b._seen=!0,d&&(a.values.push(d),a.byvalue.add(d,b)),a.curstring=a.maxstring=!1,c&&k(a,b,c))}function k(a,b,c){c||(c=b.key||n(b));var d=a.options,f=a.dom,e=a.prefixtree,h=a.bykey,k=a.stringmap,t=u(c);c=d&8;var q=d&4;c||(d=t.toLowerCase(),k[d]=t,t=d);E(b,f)||g.append(f,b," ");m(b,t,e,h,q);D(b,"cue")&&a.cues.push(b);a=y(b,".variation");b=0;for(f=a.length;b<f;){var t=a[b++],p=u(t.key||n(t));c||(d=p.toLowerCase(),k[d]=p,p=d);m(t,p,e,h,q)}}
function x(a){for(var b=y(a.dom,".completion"),c=0,d=b.length;c<d;)v(a,b[c++]);a.initialized=!0}function p(a,b){var c=a.displayed,d,f;if(c)for(d=0,f=c.length;d<f;)G(c[d++],"displayed");a.displayed=c=[];if(b)for(d=0,f=b.length;d<f;){var e=b[d++];if(D(e,"completion"))J(e,"displayed"),c.push(e);else{var g=E(e,".completion");g&&!D(g,"displayed")&&(c.push(e),c.push(g),J(g,"displayed"),J(e,"displayed"))}}a.visible=!1;a.selection&&!D(a.selection,"displayed")&&(a.selectNext()||a.selectPrevious()||a.clearSelection());
a.updated&&a.updated.call(a)}function u(a){return a.replace(/\s+/," ").replace(/(^\s)|(\s$)/,"")}var q=fdjt.String,g=fdjt.DOM,c=fdjt.UI,b=fdjt.RefDB,d=fdjt.ID,A=g.requestAnimationFrame,w=fdjt.async,f=0,D=g.hasClass,J=g.addClass,G=g.dropClass,y=g.getChildren,E=g.getParent,F=g.getStyle,O=b.position,M=q.isEmpty,I=q.hasPrefix,t=q.prefixAdd,T=q.prefixFind,K=q.commonPrefix;c.FDJT_COMPLETE_OPTIONS=1;c.FDJT_COMPLETE_CLOUD=2;c.FDJT_COMPLETE_ANYWORD=4;c.FDJT_COMPLETE_MATCHCASE=8;c.FDJT_COMPLETE_EAGER=16;var P=
fdjt.Map||b.Map;a.getKey=n;a.prototype.addCompletion=function(a,b,c){this.initialized||x(this);v(this,a,b,c);this.visible&&(this.visible=!1)};a.prototype.addKeys=function(a,b){this.initialized?k(this,a,b):(x(this),v(this,a,b));this.visible&&(this.visible=!1)};a.prototype.getCompletions=function(a){if(a===this.curstring||a===this.maxstring||this.curstring&&this.maxstring&&I(a,this.curstring)&&I(this.maxstring,a))return this.result;var b,c=this;this.initialized||x(this);M(a)?(b=[],b.prefix="",b.matches=
[],this.dom&&J(this.dom,"noinput")):(b=e(a,this.prefixtree,this.bykey,this.options&8),this.dom&&G(this.dom,"noinput"),A(function(){p(c,b.matches)}));if(this.stringmap&&this.strings)for(var d=this.stringmap,f=this.strings,g=0,h=f.length;g<h;){var k=d[f[g]];k?f[g++]=k:g++}this.curstring=a;this.maxstring=b.prefix||a;return this.result=b};a.prototype.getValue=function(a){if(a.value)return a.value;if(a.getAttribute("data-value"))return a.getAttribute("data-value");if(a.getAttribute("value"))return a.getAttribute("value");
a=O(this.nodes,a);return 0>a?!1:this.values[a]};a.prototype.getKey=function(a){return a.key?a.key:a.getAttribute("data-key")?a.getAttribute("data-key"):a.getAttribute("key")?a.getAttribute("key"):n(a)};a.prototype.complete=function(a,b){var c=this;this.initialized||x(this);a||""===a||(a=this.getText?this.getText(this.input):D(this.input,"isempty")?"":this.input.value);if(M(a))return A(function(){c.displayed&&p(c,!1);J(c.dom,"noinput");G(c.dom,"nomatches");b&&w(function(){b([])})}),[];var d=this.getCompletions(a);
if(d&&0!==d.length)return A(function(){p(c,d.matches);G(c.dom,"noinput");G(c.dom,"nomatches");b&&w(function(){b(d)})}),d;A(function(){p(c,!1);G(c.dom,"noinput");J(c.dom,"nomatches");b&&w(function(){b(d)})});return[]};a.prototype.getByValue=function(a,b){this.initialized||x(this);var c=[],d=this.byvalue;b&&(b=new g.Selector(b));a instanceof Array||(a=[a]);for(var f=0,e=a.length;f<e;){var h=a[f++];if(h=d.get(h))if(h instanceof Array||(h=[h]),b)for(var k=0,t=h.length;k<t;)b.match(h[k])?c.push(h[k++]):
k++;else c=c.concat(h)}return c};a.prototype.getByKey=function(a,b){this.initialized||x(this);var c=[],d=this.bykey;b&&(b=new g.Selector(b));a instanceof Array||(a=[a]);for(var f=0,e=a.length;f<e;){var h=a[f++];if(h=d[h])if(h instanceof Array||(h=[h]),b)for(var k=0,t=h.length;k<t;)b.match(h[k])?c.push(h[k++]):k++;else c=c.concat(h)}return c};a.prototype.setCues=function(a,b){this.initialized||x(this);b||(b="cue");for(var c=[],d=this.byvalue,f=0,e=a.length;f<e;){var g=a[f++];if(g=d.get(g)){g instanceof
Array||(g=[g]);for(var h=0,k=g.length;h<k;){var t=g[h++];D(t,b)||(J(t,b),c.push(t))}}}return c};a.prototype.setClass=function(a,b){this.initialized||x(this);var c=g.getChildren(this.dom,".completion."+b);c&&c.length&&G(g.Array(c),"hidden");for(var c=[],d=this.byvalue,f=0,e=a.length;f<e;){var h=a[f++];if(h=d.get(h)){h instanceof Array||(h=[h]);for(var k=0,t=h.length;k<t;){var m=h[k++];D(m,b)||(J(m,b),c.push(m))}}}return c};a.prototype.extendClass=function(a,b){this.initialized||x(this);for(var c=[],
d=this.byvalue,f=0,e=a.length;f<e;){var g=a[f++];if(g=d.get(g)){g instanceof Array||(g=[g]);for(var h=0,k=g.length;h<k;){var t=g[h++];D(t,b)||(J(t,b),c.push(t))}}}return c};a.prototype.dropClass=function(a){var b=g.getChildren(this.dom,".completion."+a);b&&b.length&&G(g.Array(b),a)};a.prototype.docomplete=function(a,b){this.initialized||x(this);a||(a=this.input);var c=this.complete_delay||100,d=this;this.timer&&(clearTimeout(d.timer),d.timer=!1);this.timer=setTimeout(function(){a||(a=d.input);var c=
d.complete(a.value);b&&b(c)},c)};c.Completions=a;var C=g.Selector;a.prototype.getVisible=function(){if(this.visible)return this.visible;for(var a=this.dom,b=a.firstChild,c=[];b!==a;){if(1===b.nodeType){var d=D(b,"completion");d&&"none"!==F(b).display&&c.push(b);if(b.firstChild&&!d){b=b.firstChild;continue}}for(;b!==a&&!b.nextSibling;)b=b.parentNode;b!==a&&(b=b.nextSibling)}return this.visible=c};a.prototype.select=function(a){var b=!1,c=this.getVisible();a instanceof C&&(b=a,a=!1);if(!a&&b)for(var d=
0,f=c.length;d<f;){var e=c[d++];if(D(e,b)){a=e;break}}!a&&c.length&&(a=c[0]);this.selection&&G(this.selection,"selected");J(a,"selected");return this.selection=a};a.prototype.selectNext=function(a){a||(a=this.selection?this.selection:!1);for(var b=this.getVisible(),c=!1,d=!1,f=0,e=b.length;f<e;){var g=b[f++];c||(c=g);if(a)g===a&&(a=!1,d=!0);else{a=g;break}}this.selection&&G(this.selection,"selected");d||(a=c);J(a,"selected");return this.selection=a};a.prototype.selectPrevious=function(a){a||(a=this.selection?
this.selection:!1);for(var b=this.getVisible(),c=!1,d=!1,f=b.length-1;0<=f;){var e=b[f--];c||(c=e);if(a)e===a&&(a=!1,d=!0);else{a=e;break}}this.selection&&G(this.selection,"selected");d||(a=c);a&&J(a,"selected");return this.selection=a};a.prototype.clearSelection=function(a){if(a&&this.selection&&a!==this.selection)return!1;if(this.selection)return G(this.selection,"selected"),this.selection=!1,!0};var U={};c.Completions.onkey=function(b){b=b||window.event;b=c.T(b);var f=b.name,e=U[f],r=g.getAttrib(b,
"completions");if(r=r&&d(r))e&&e.dom===r||(e=new a(r,b,7),U[f]=e),e&&e.docomplete(b)};c.Completions.update=function(b){b=b||window.event;"string"===typeof b&&(b=d(b));if(b){b=b.nodeType?b:c.T(b);var f=b.name,e=U[f],r=g.getAttrib(b,"completions");if(r=r&&d(r))e&&e.dom===r||(e=new a(r,b,7),U[f]=e),e&&e.docomplete(b)}}})();fdjt.UI||(fdjt.UI={});
fdjt.TapHold=fdjt.UI.TapHold=function(){function a(a,b,c,d){return"number"===typeof a&&"number"===typeof b&&"number"===typeof c&&"number"===typeof d?B((a-c)*(a-c)+(b-d)*(b-d)):!1}function n(b,c,d){if("number"===typeof b.clientX)return b.clientX;b=b.changedTouches&&b.changedTouches.length&&b.changedTouches||b.touches&&b.touches.length&&b.touches;var f=window.pageXOffset,e=window.pageYOffset;if(b&&b.length){if(1===b.length||"number"!==typeof c||"number"!==typeof d)return b[0].pageX-f;for(var g=1,h=
b.length,k=b[0],l=a(Math.abs(k.pageX-f),Math.abs(k.pageY-e),c,d),t=l,z=k;g<h;)k=b[g++],l=a(Math.abs(k.pageX-f),Math.abs(k.pageY-e),c,d),l<t&&(z=k,t=l);return z.pageX-f}return!1}function h(a,b,c){if("number"===typeof a.clientY)return a.clientY;a=a.changedTouches&&a.changedTouches.length&&a.changedTouches||a.touches&&a.touches.length&&a.touches;var d=window.pageXOffset,f=window.pageYOffset;if(a&&a.length){if(1===a.length||"number"!==typeof b||"number"!==typeof c)return a[0].pageY-f;for(var e=1,g=a.length,
h=a[0],l=Math.abs(Math.abs(h.pageX-d)-b)+Math.abs(Math.abs(h.pageY-f)-c),k=l,t=h;e<g;)h=a[e++],l=Math.abs(Math.abs(h.pageX-d)-b)+Math.abs(Math.abs(h.pageY-f)-c),l<k&&(t=h,k=l);return t.pageY-f}return!1}function m(a,b,d,f,e,g,h,k){var l=d.id||typeof d,t=d.traced;d=d.handlers;var z=f&&T(f);a||(a=z);z=document.createEvent("UIEvent");z.initUIEvent(b,!0,!0,window,f&&f.touches&&f.touches.length||f&&f.button||0);z.clientX=e;z.clientY=g;z.ntouches=h||1;if(k)for(var m in k)k.hasOwnProperty(m)&&(z[m]=k[m]);
if(t||w)k&&"number"===typeof k.startX?c("TapHold/%s(%s) on %o @%d,%d/%d,%d from %o given %j",b,l,a,e,g,k.startX,k.startY,f||"scratch",k):k?c("TapHold/%s(%s) on %o @%d,%d from %o given %j",b,l,a,e,g,f||"scratch",k):c("TapHold/%s(%s) on %o @%d,%d from %j",b,l,a,e,g,f||"scratch");a&&O(a,document.body)||(a=document.elementFromPoint(e,g));d&&d.hasOwnProperty(b)?(z.target=a,d[b](z,a)):a.dispatchEvent(z)}function e(a,b,c,d){a=J(a,b);b=0;for(var f=a.length;b<f;){var e=a[b++],g=e.offsetLeft,h=e.offsetTop,
l=e.offsetRight,k=e.offsetBottom;if("number"===typeof g&&(1>=l-g?c>=g&&d<=l:c>=g&&d<l)&&(1>=k-h?d>=h&&d<=k:c>=h&&d<k))return e}return!1}function v(a){a=a||window.event;w&&c("TapHold/global/mouseup %o",a);1===a.button&&(N=!1)}function k(a){a=a||window.event;w&&c("TapHold/global/mousedown %o",a);1===a.button&&(N=!0)}function x(a){a=a||window.event;var b=T(a),d=a.relatedTarget||a.toElement;2<w&&c("TapHold/global/mouseout %o %o==>%o",a,b,d);b===document.documentElement&&(N=!1)}function p(a){return(a=
/\bfdjtlog(\d*)/.exec(a))&&a.length?(a="string"===typeof a[1]&&parseInt(a[1],10))&&!isNaN(a)?a:1:0}function u(a,b,c,d){(c=b[a]||c&&c[a]||d.getAttribute("data-"+a)||g[a])&&(b[a]=c);return c}function q(a,b,c){b=b.nodeType&&b||d.T(b);if(c.mute||g.mute||E(b,"fdjtmute")||E(c.container,"fdjtmute"))return!1;a=b.getAttribute("data-"+a)||c[a];"string"===typeof a&&(a=document.getElementById(a));a&&a.play()}function g(r,B){function X(){var a=ob(r,".tapholdcontext");a&&a.length&&(G(a,Na),Xa=a);G(r,Na)}function S(){Xa&&
Xa.length&&(y(Xa,Na),Xa=!1);y(r,Na)}function J(){L||y(r,Na)}function ga(a){ka&&(clearTimeout(ka),ka=!1);a&&Q&&(clearTimeout(Q),Q=!1);L&&H&&y(L,H);L=ma=!1;Z=[];W=ha=Ha=Aa=Qa=Ga=Ea=Pa=la=wa=va=sa=R=Ya=!1}function ca(a){(2<ra||2<w||a!==L&&(ra||w))&&c("TapHold/setTarget(%s) %o cur=%o",qa,a,L);L&&L!==a&&H&&y(L,"tapholdtarget");a&&H&&G(a,"tapholdtarget");a&&L&&a!==L&&(R=la,Ya=wa);ib=L;L=a;ma=A()}function Ma(a,b,c,d){"undefined"===typeof c&&(c=la);"undefined"===typeof d&&(d=wa);q("tapsound",a,La);return m(a,
"tap",La,b,c,d,sa,!1)}function l(a,b,c,d){"undefined"===typeof c&&(c=la);"undefined"===typeof d&&(d=wa);Aa=!0;q("holdsound",a,La);Na&&setTimeout(X,20);return m(a,"hold",La,b,c,d,sa,!1)}function V(a,b,d,f){var e=ma&&ib&&A()-ma;"undefined"===typeof d&&(d=la);"undefined"===typeof f&&(f=wa);q("releasesound",a,La);Na&&setTimeout(J,50);e&&200>e&&(ra&&c("TapHold(%s) %d=i<200ms, target=%o not %o",qa,e,ib,a),a=ib);return m(a,"release",La,b,d,f,sa,{startX:Ga,startY:Ea})}function z(a,b,c){c?(c.startX=Ga,c.startY=
Ea):c={startX:Ga,startY:Ea};if(b&&!c.hasOwnProperty("relatedTarget")){var d=b.relatedTarget;d!==a&&(c.relatedTarget=d)}q("slipsound",a,La);Na&&setTimeout(J,50);return m(a,"slip",La,b,la,wa,sa,c)}function Ca(a,b){q("taptapsound",a,La);return m(a,"taptap",La,b,la,wa,sa,!1)}function Ka(a,b,c,d,f,e){var l=f-c,g=e-d;Qa=A();q("swipesound",a,La);return m(a,"swipe",La,b,f,e,sa,{startX:c,startY:d,endX:f,endY:e,deltaX:l,deltaY:g})}function U(a,b){b||(b=Sa||g.interval||100);a=a||window.event;(1<ra||1<w)&&c("TapHold/startpress(%s) %o tht=%o timer=%o tt=%o touched=%o pressed=%o@%o timeout=%oms",
qa,a,L,ka,na,W,ha,Ha,b);na&&ka&&(clearTimeout(ka),ka=!1);na&&Q?(clearTimeout(Q),Q=!1,Ca(na,a),ga(!0)):W||ha||ka||(L?(W=L,Qa=ha=!1,M.live&&M.highlight(!0),Ha=A(),ka&&clearTimeout(ka),ka=setTimeout(function(){(1<ra||1<w)&&c("TapHold/startpress/timeout(%s) (%dms) %o",qa,b,a);if(0<Z.length)for(var d=Z,f=0,e=d.length;f<e;){var g=d[f++];if(f===e&&g===L)break;l(g);pa||(f<e?z(g,a,{relatedTarget:d[f]}):z(g,a))}ha=L;Z=[];Ha=L?A():!1;l(L,a);ka&&clearTimeout(ka);W=ka=!1},b)):Qa=!1)}function Ra(a){(1<ra||1<w)&&
c("TapHold/endpress(%s) %o t=%o p=%o tch=%o tm=%o ttt=%o/%o, start=%d,%d,%d/%d",qa,a,L,ha,W,ka,na,ba,Ga,Ea,Pa,A());if(ha||W||ka){var d=la,f=wa;if(ka)clearTimeout(ka),ka=!1,M.live&&setTimeout(function(){M.highlight(!1)},1500),L===W||A()-Pa<Sa/1E3?(na=L,ba&&0<ba?Q=setTimeout(function(){Q=!1;Ma(na,a,d,f)},ba):Ma(L,a,d,f)):pa||z(L,a);else if(ha){var e=b.getGeometry(r);d>=e.left&&d<=e.right&&f>=e.top&&f<=e.bottom?V(ha,a,d,f):pa?V(ha,a,d,f):z(L,a,{touch_x:d,touch_y:f})}M.live&&M.highlight(!1);ga();ca(!1);
Na&&setTimeout(S,20);Z=[]}else ga(!0)}function fa(a,b){(ra||w)&&c("TapHold/abort%s(%s) %o: th=%o t=%o p=%o",b?"("+b+")":"",qa,a,L,W,ha);ka?(clearTimeout(ka),ka=!1):pa||ha&&z(ha,a,{relatedTarget:!1});M.live&&M.highlight(!1);Ha=W=ha=na=!1;Na&&setTimeout(S,20);Z=[];ca(!1)}function ua(a){a=a||window.event;var b=a.toElement||a.relatedTarget;ea||L&&ha&&!O(b,r)&&(ea=setTimeout(bb,eb,a,b))}function bb(a,b){pa||z(ha,a,{relatedTarget:b});fa(a,"taphold_mouseout")}function Ia(a){ea&&(clearTimeout(ea),ea=!1)}
function hb(b){b=b||window.event;var d,f=b.touches&&b.touches.length||1;ta||I(b);za&&t(b);fb&&b.touches&&b.touches.length<=ia&&(0<=kb&&(fb.scrollLeft=kb-(b.touches[0].pageX-window.pageXOffset)),0<=Y&&(fb.scrollTop=Y-(b.touches[0].pageY-window.pageYOffset)));if(ha&&P>Pa)fa(b,"move/cleared");else if(!W&&!ha||N){var g=b.clientX||n(b,la,wa),k=b.clientY||h(b,la,wa),m=ha?a(g,k,R,Ya):a(g,k,Ga,Ea);b.touches||Fa||Wa?(g+=Fa,k+=Wa,d=document.elementFromPoint(g,k)):d=T(b);if(!d||!K(d)){var q=Math.abs(g-la)+Math.abs(k-
wa),B=A()-va;(2<ra||2<w)&&c("TapHold/move(%s) s=%d,%d tt=%d,%d t=%d,%d c=%d,%d d=%d thresh=%o, dt=%o md=%o, pressed=%o, touched=%o, event=%o target=%o",qa,Ga,Ea,R,Ya,la,wa,g,k,m,Oa,B,N,ha,W,b,d);if(d){var p=F(d,".tapholder");if(p!==r)(2<ra||2<w)&&Za(b,qa,r,p,L,d,Ga,Ea,R,Ya,la,wa),L&&((ra||w)&&c("setWanderTimeout(%s): h=%o!=elt=%o",qa,p,r),ea=setTimeout(function(){fa(b,"taphold_wander_timeout")},eb),ha&&(pa||z(ha,b,{relatedTarget:!1}),ca(!1)));else if(ea&&(clearTimeout(ea),ea=!1,(2<ra||2<w)&&c("Wander return(%s) %o pressed=%o, target=%o",
qa,b,ha,L),ha&&!L&&(ca(ha),l(ha,b))),W||ha)if(Oa&&ka&&m>Oa)(1<ra||1<w)&&c("TapHold/move/cancel(%s) s=%d,%d tt=%d,%d t=%d,%d c=%d,%d d=%d thresh=%o, dt=%o md=%o, event=%o",qa,Ga,Ea,R,Ya,la,wa,g,k,m,Oa,B,N,b),fa(b,"movefar"),ka&&clearTimeout(ka),Ha=W=ka=ha=!1,Z=[],!Qa&&!Aa&&0<xa&&a(Ga,Ea,g,k)>xa&&Ka(d,b,Ga,Ea,g,k),ca(!1),la=g,wa=k,va=A(),sa?f>sa&&(sa=f):sa=f;else if(q<10*ja&&0<B&&q/B<ja)(2<ra||2<w)&&c("TapHold/move/ignore(%s) s=%d,%d t=%d,%d c=%d,%d dt=%o total=%d/%o, local=%d/%o/%o, thresh=%o md=%o",
qa,Ga,Ea,la,wa,g,k,B,m,Oa,q,q/B,ja,N),la=g,wa=k,va=A(),sa?f>sa&&(sa=f):sa=f;else{if((2<ra||2<w)&&c("TapHold/move(%s) s=%d,%d t=%d,%d c=%d,%d dt=%o total=%d/%o, local=%d/%o/%o, md=%o",qa,Ga,Ea,la,wa,g,k,B,m,Oa,q,ja,q/B,N),la=g,wa=k,va=A(),sa?f>sa&&(sa=f):sa=f,d=F(d,Da),!(b.touches&&b.touches.length&&b.touches.length>ia)){if(M.live)M.onmousemove(b,la,wa);d||(d=e(r,Da,la,wa));d&&((O(d,".tapholder")&&!pa&&ca(d),b.touches&&W&&!ha&&Z[Z.length-1]!==L&&Z.push(L),N)?ha&&L!==ha&&!O(L,ha)&&!O(ha,L)&&pa?((1<
ra||1<w)&&c("TapHold/move(%s) endpress pressed=%o tt=%o %o",qa,ha,L,b),Ra(b)):ha&&L!==ha&&(pa||z(ha,b,{relatedTarget:d}),Ha=(ha=L)?A():!1,l(ha)):(pa||z(ha,b,{relatedTarget:d}),Ha=ha=!1))}}else!Qa&&!Aa&&0<xa&&a(Ga,Ea,g,k)>xa&&Ka(d,b,Ga,Ea,g,k),la=g,wa=k,va=A(),sa?f>sa&&(sa=f):sa=f}else la=g,wa=k,va=A(),sa?f>sa&&(sa=f):sa=f}}else fa(b,"move/up")}function Za(a,b,d,f,e,l,g,h,r,k,t,z){c("TapHold/move%s/farout(%s) %o %o -> %o s=%d,%d tt=%d,%d t=%d,%d",N?"/md":"",b,a,e,l,g,h,r,k,t,z);c("TapHold/move/farout(%s) target in %o, elt is %o",
b,f,d)}function ab(a,b){a=a||window.event;if(!(a.ctrlKey||a.altKey||a.metaKey||a.button||a.which&&1<a.which)){var d=a.touches&&a.touches.length||1;N=!0;P=0;la=(a.clientX||n(a)||la)+Fa;wa=(a.clientY||h(a)||wa)+Wa;Ga=R=la;Ea=Ya=wa;va=A();var f=Fa||Wa?document.elementFromPoint(la,wa):T(a);if(!f||!K(f)){sa?d>sa&&(sa=d):sa=d;ta||I(a);za&&t(a);var d=!1,e=F(f,".tapholder");(1<ra||1<w)&&c("TapHold/down(%s) %o tht=%o target=%o holder=%o elt=%o",qa,a,L,f,e,r);if(e!==r)(1<ra||1<w)&&c("TapHold/ignore(%s) %o tht=%o t=%o h=%o elt=%o",
qa,a,L,f,e,r);else{f&&(f=F(f,Da));fb&&a.touches&&a.touches.length<=ia&&(0<=kb&&(kb=fb.scrollLeft+(a.touches[0].pageX-window.pageXOffset)),0<=Y&&(Y=fb.scrollLeft+(a.touches[0].pageY-window.pageYOffset)));a.touches&&(f=document.elementFromPoint(la,wa));(1<ra||1<w)&&c("TapHold/down2(%s) %o tht=%o trg=%o s=%o,%o,%o t=%o,%o m=%o tch=%o prs=%o ttt=%o",qa,a,L,f,Ga,Ea,Pa,la,wa,N,W,ha,ba||!1);if(a.touches&&L){var l=F(r,".tapholder"),g=a.changedTouches[0];(1<ra||1<w)&&c("TapHold(%s) second touch on %o (in %o) after %o (in %o)",
qa,f,e,L,l,l===e);if(Ja&&l===e){(1<ra||1<w)&&c("TapHold(%s) touchtoo with touchtoo on %o after %o: %o",qa,f,L,a);if(Ja.call){Ja.call(La,a);return}d=document.createEvent("UIEvent");d.initUIEvent("touchtoo",!0,!0,window,0);d.screenX=g.screenX;d.screenY=g.screenY;d.clientX=g.clientX;d.clientY=g.clientY;d.ctrlKey=a.ctrlKey;d.altKey=a.altKey;d.shiftKey=a.shiftKey;d.metaKey=a.metaKey;d.touches=document.createTouchList(g);d.targetTouches=document.createTouchList(g);d.changedTouches=document.createTouchList(g);
f.dispatchEvent(d);return}l&&e&&l!==e&&((1<ra||1<w)&&c("TapHold(%s) Clearing on %o, moving %o to %o",qa,L,a,f),d=document.createEvent("TouchEvent"),d.initTouchEvent(a.type,!0,!0,window,null,g.screenX,g.screenY,g.clientX,g.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,document.createTouchList(g),document.createTouchList(g),document.createTouchList(g)))}d?(fa(a,"down/touch2"),f.dispatchEvent(d)):(ca(f),Z=[],Pa=A(),(1<ra||1<w)&&c("TapHold/down3(%s) %o t=%o x=%o y=%o t=%o touched=%o",qa,a,L,Ga,Ea,Pa,
W),jb&&jb(a)||W||U(a,b))}}}}function $a(b){b=b||window.event;N=!1;if(P>Pa)fa(b,"up");else{var d=T(b);if(!d||!K(d)){ta||I(b);za&&t(b);var f=F(d,".tapholder");if(f!==r)(1<ra||1<w)&&c("TapHold/up/ignore(%s) %o tht=%o target=%o holder=%o elt=%o",qa,b,L,d,f,r);else{d&&(d=F(d,Da));la=(b.clientX||n(b)||la)+Fa;wa=(b.clientY||h(b)||wa)+Wa;va=A();if(!d||Fa||Wa)d=e(r,Da,la,wa);(1<ra||1<w)&&c("TapHold/up(%s) %o tht=%o d=%o s=%o,%o,%o t=%o,%o m=%o touched=%o pressed=%o ttt=%o swipe_t=%o",qa,b,L,a(Ga,Ea,la,wa),
Ga,Ea,Pa,la,wa,N,W,ha,ba,Qa);if(!(b.changedTouches&&b.changedTouches.length&&b.changedTouches.length>ia)){f=Qa?0:a(Ga,Ea,la,wa);if(W||ha){if(jb&&jb(b))return;Ra(b)}else if(0<xa&&f>xa&&!Aa&&!(W&&W===r||ha&&ha===r))Ka(d,b,Ga,Ea,la,wa);else if(W||ha)jb&&jb(b)||Ra(b);ga()}}}}}function nb(a){(ra||w)&&c("TapHold/cancel(%s) %o: th=%o t=%o p=%o",qa,a,L,W,ha);ka?(clearTimeout(ka),ka=!1):ha&&V(ha,a);M.live&&M.highlight(!1);Ha=W=ha=na=!1;Na&&setTimeout(S,20);Z=[];ca(!1)}if(r){if(!(this instanceof g))return new g(r,
B);var La=this,Na="tapholding",H="tapholdtarget",W=!1,ha=!1,Ha=!1,ka=!1,Q=!1,L=!1,Z=[],na=!1,ma=!1,ib=!1,Ba=!1,pa=!1,ta=!1,za=!1,ia=1,Ja=!1,Sa=!1,ba=!1,Oa=!1,eb=!1,xa=30,Aa=!1,fb=!1,kb=0,Y=0,Ga=!1,Ea=!1,Pa=!1,la=!1,wa=!1,va=0,sa=!1,R=!1,Ya=!1,Qa=!1,ja=2,Fa=0,Wa=0,ra=0,cb=C++,qa=B&&B.id?B.id+":"+cb:r.id?"#"+r.id+":"+cb:""+cb;La.id=qa;var Xa=[],ob=b.getParents;u("tapsound",La,B,r);u("holdsound",La,B,r);u("releasesound",La,B,r);u("slipsound",La,B,r);u("taptapsound",La,B,r);u("swipesound",La,B,r);var Da=
r.getAttribute("data-touchable"),Da=B&&B.hasOwnProperty("touchable")?"string"===typeof B.touchable?b.Selector(B.touchable):B.touchable:Da?b.Selector(Da):function(a){return O(a,r)},qb=d.isClickable,jb;if(B&&B.hasOwnProperty("untouchable"))if("string"===typeof B.untouchable){var rb=b.Selector(B.untouchable);jb=function(a){return a.nodeType?rb.match(a):rb.match(T(a))}}else jb=B.untouchable;else jb=function(a){return qb(a)};B&&B.noslip&&(pa=B.noslip);B&&B.touch_xoff&&(Fa=B.touch_xoff);B&&B.touch_yoff&&
(Wa=B.touch_yoff);B&&B.hasOwnProperty("trace")?(Ba=B.trace,ra="number"===typeof Ba?Ba:Ba?2:0):ra=E(r,/\bfdjtlog\d*/g)?p(r.className):0;var ea=!1;B?B.hasOwnProperty||(B={touch:!0}):B={};Ba=B.hasOwnProperty("fortouch")?B.fortouch:D.hasOwnProperty("fortouch")?D.fortouch:!1;Sa=B.hasOwnProperty("holdmsecs")?B.holdmsecs:D.hasOwnProperty("holdmsecs")?D.holdmsecs:150;Oa=B.hasOwnProperty("movethresh")?B.movethresh:D.hasOwnProperty("movethresh")?D.movethresh:20;ba=B.hasOwnProperty("taptapmsecs")&&B.taptapmsecs;
eb=B.hasOwnProperty("wanderthresh")?B.wanderthresh:D.hasOwnProperty("wanderthresh")?D.wanderthresh:2E3;za=B.hasOwnProperty("override")?B.override:D.hasOwnProperty("override")?D.override:!1;Ja=B.hasOwnProperty("touchtoo")?B.touchtoo:D.hasOwnProperty("touchtoo")?D.touchtoo:!1;xa=B.hasOwnProperty("minswipe")?B.minswipe:D.hasOwnProperty("minswipe")?D.minswipe:30;ta=B.hasOwnProperty("bubble")?B.bubble:D.hasOwnProperty("bubble")?D.bubble:!1;ia=B.hasOwnProperty("maxtouches")?B.maxtouches:D.hasOwnProperty("maxtouches")?
D.maxtouches:1;ba&&"number"!==typeof ba&&(ba=D.taptapmsecs||200);if(fb=B.hasOwnProperty("scrolling")?B.touch:!1)fb.nodeType||(fb=r),kb=B.hasOwProperty("scrollx")&&B.scrollx?0:-1,Y=(B.hasOwProperty("scrolly")?B.scrolly:1)?0:-1;B.hasOwnProperty("holdclass")?Na=B.holdclass:D.hasOwnProperty("holdclass")&&(Na=D.holdclass);B.hasOwnProperty("touchclass")?H=B.touchclass:D.hasOwnProperty("touchclass")&&(H=D.touchclass);ja=B.hasOwnProperty("minmove")?B.minmove:D.hasOwnProperty("minmove")?D.minmove:Ba?2:0;B.hasOwnProperty("handlers")&&
(this.handlers=B.handlers);G(r,"tapholder");Ba||b.addListener(r,"mousemove",hb);b.addListener(r,"touchmove",hb);Ba||b.addListener(r,"mousedown",ab);Ba||b.addListener(r,"mouseout",ua);Ba||b.addListener(r,"mouseover",Ia);b.addListener(r,"touchstart",ab);Ba||b.addListener(r,"mouseup",$a);b.addListener(r,"touchend",$a);b.addListener(r,"touchcancel",nb);f||(D.fortouch||(b.addListener(window,"mousedown",k),b.addListener(window,"mouseup",v),b.addListener(window,"mouseout",x)),f=window);this.elt=r;this.serial=
cb;this.opts={bubble:ta,override:za,movethresh:Oa,holdmsecs:Sa,taptapmsecs:ba};this.istouched=function(){return W};this.ispressed=function(){return ha};this.clear=function(){(ra||w)&&c("TapHold/clear(%s) th=%o t=%o p=%o",qa,L,W,ha);ha&&!pa&&z(ha);Ha=W=ha=na=!1;ga(!0);ca(!1);Z=[]};this.fakePress=function(a,b){Ga=R=la=a.clientX||n(a);Ea=Ya=wa=a.clientY||h(a);va=Pa=A();var d=document.elementFromPoint(Ga,Ea);d||c("TapHold(%s): No target from %o,%o",qa,Ga,Ea);ca(d);Z=[d];(ra||w)&&c("TapHold/fakePress(%s) t=%o x=%o y=%o t=%o",
qa,L,Ga,Ea,Pa);U(a,b)};this.abort=fa;this.getState=function(){return{thid:qa,elt:r,pressed:ha,touched:W,th_target:L,th_last:ib,start_x:Ga,start_y:Ea,start_t:Pa,touch_x:la,touch_y:wa,touch_t:va,target_x:R,target_y:Ya,th_target_t:ma,trace:ra}};this.trace=function(a){var b=ra;ra="undefined"===typeof a?1:"number"===typeof a?a:a?2:0;return b};this.debug=function(){debugger};(ra||w)&&c("New TapHold(%s) for %o: %o opts %j, trace=%o/%o",qa,r,La,B||!1,ra,w);return this}c.warn("TapHold with no argument!")}
var c=fdjt.Log,b=fdjt.DOM,d=fdjt.UI,A=fdjt.ET,w=0,f=!1,D={},J=b.getChildren,G=b.addClass,y=b.dropClass,E=b.hasClass,F=b.getParent,O=b.hasParent,M=d.Reticle,I=d.noBubble,t=d.noDefault,T=d.T,K=b.isTextInput,P=0,C=1,U={shift:16,alt:18,control:17,meta:224,os:91,altgr:225,fn:-1,numlock:144,capslock:20,scrolllock:145},V;for(V in U)U.hasOwnProperty(V);var B=Math.sqrt,N=!1;g.prototype.id=g.prototype.elt=g.prototype.opts=g.prototype.handlers=!1;g.prototype.serial=0;g.prototype.istouched=g.prototype.ispressed=
g.prototype.fakepress=g.prototype.clear=g.prototype.getState=g.prototype.trace=g.prototype.abort=g.prototype.debug=!1;g.clear=function(){w&&c("TapHold.clear()");P=A()};g.trace=function(a){if("undefined"===typeof a)return w;var b=w;"number"===typeof a?w=a:a&&(w=D.traceall||2);return b};g.default_opts=D;return g}();fdjt.UI||(fdjt.UI={});
fdjt.TextSelect=fdjt.UI.Selecting=fdjt.UI.TextSelect=function(){function a(b,c){if(this instanceof a)this.serial=++V;else return new a(b,c);if("string"===typeof b){var d=document.getElementById(b);if(d)this.nodes=b=[d];else return!1}else if(b.nodeType)this.nodes=b=[b];else if(b.length)this.nodes=b;else return!1;var f=0,d=this.orig=[],e=this.wrapped=[],g=this.words=[],h=this.wrappers=[],k=this.tapholds=[];if(c&&c.hasOwnProperty("trace"))var l=c.trace,f="number"===typeof l?l:l?1:0;this.traced=f;c.onstart&&
(this.onstart=c.onstart);c.onstop&&(this.onstop=c.onstop);var t=this.prefix="fdjtSel0"+this.serial;if(c.loupe||a.loupe)l=c.loupe||a.loupe,this.loupe=l.nodeType?l:G("span.fdjtselectloupe");this.adjust=!1;C[t]=this;for(var z=t.length+1,l=0,m=b.length;l<m;){var q=b[l++],p="inline"===M(q).display?G("span.fdjtselecting"):G("div.fdjtselecting");this.loupe&&!this.loupe.parentNode&&p.appendChild(this.loupe);p.id=t+"w"+l;p.title=c&&c.title||"Tap or hold/drag to move the ends of the text range";C[p.id]=this;
h.push(p);var I=J(p,this,c);U[p.id]=I;k.push(I);(f||B)&&y("Created TapHold handler (#%d) for wrapper %s around %o",I.serial,p.id,q);q.parentNode.replaceChild(p,q);d.push(q);e.push(p);n(q,d,e,g,t);p.appendChild(q)}this.end=this.start=!1;this.max=this.min=-1;this.n_words=0;this.onchange=c&&c.onchange||!1;this.wordnum=function(a){for(var b=!1;a&&1!==a.nodeType;)a=a.parentNode;return a&&(b=a.id)&&"SPAN"===a.tagName&&0===b.search(t)?parseInt(b.slice(z),10):!1};this.startEvent=function(a,b){var c=E.T(a);
B&&y("startEvent %o, target=%o, wrappers=%o",a,c,h);for(var d=0,e=h.length;d<e;){var l=h[d++];if(F(l,c)||F(c,l)){c=U[l.id];(f||B)&&y("Using TapHold handler @%d for wrapper %s (#%d)",d-1,l.id,c.serial);c.fakePress(a,b);break}}};return this}function n(a,b,c,d,f){var e,g;if(3===a.nodeType){var h;e=a.nodeValue.split(/\b/);g=0;b=e.length;a=[];for(c=!1;g<b;){var l=e[g++];"\u00ad"===l?c?(h=e[g])?(c=c+l+h,g++):c+=l:c=l:(c&&a.push(c),c=l)}c&&a.push(c);b=[];e=0;for(g=a.length;e<g;)if(c=a[e++],0!==c.length)if(0<=
c.search(/\S/)&&0<=c.search(/\s/))for(;c.length;)l=c.search(/\s/),h=c.search(/\S/),l=0>=l?h:0>=h?l:l<h?l:h,0>=l&&(l=c.length),0<l&&(h=c.slice(0,l),h=G("span.fdjtword",h),h.id=f+"_"+d.length,d.push(h),b.push(h)),c=c.slice(l);else h=G("span.fdjtword",c),h.id=f+"_"+d.length,d.push(h),b.push(h);return G("span.fdjtselectwrap",b)}if(1===a.nodeType){if((e=a.className)&&"string"===typeof e&&("fdjtselectwrap"===e||"fdjtskiptext"===a.className||0<=a.className.search(/\bfdjtskiptext\b/)))return a;e=M(a);if(""!==
e.position&&"static"!==e.position)return a;if((l=a.childNodes)&&0!==l.length&&"fdjtselectwrap"!==a.className)for(e=0,g=l.length;e<g;){h=l[e++];var k=n(h,b,c,d,f);h!==k&&(b.push(h),c.push(k),a.replaceChild(k,h))}}return a}function h(a,b,c){for(;b<=c;)a[b++].className="fdjtselected"}function m(a,b,c){for(;b<=c;)a[b++].className="fdjtword"}function e(a){if(!a.active&&(a.active=!0,a.onstart))a.onstart()}function v(a){if(a.active&&(a.active=!1,a.onstop))a.onstop()}function k(a,b,c){for(var d=!1;a&&1!==
a.nodeType;)a=a.parentNode;if(!F(a,".fdjtselectloupe")){c.active||e(c);if(!c&&a&&(d=a.id)&&"SPAN"===a.tagName&&0===d.search("fdjtSel")){var f=d.indexOf("_");f&&(c=C[d.slice(0,f)])}if(!c){for(d=a;d&&!(d.className&&d.id&&"string"===typeof d.className&&0<=d.className.search(/\bfdjtselecting\b/));)d=d.parentNode;if(d)c=C[d.id];else return!1}if(!c)return!1;(B||c.traced)&&y("overWord %o, sel=%o, tapped=%o, adjust=%o, anchor=%o",a,c,b,c.adjust,c.anchor);if(b)x(a,c,!0);else if(c.word)x(a,c);else if(t(a,"fdjtselectstart")||
t(a,"fdjtselectend"))c.timeout&&(clearTimeout(c.timeout),c.timeout=!1),c.pending=!1,c.word=a,x(a,c);else if(c.pending!==a)if(a.offsetParent)c.timeout&&clearTimeout(c.timeout),q(a,c,!1),c.word=!1,c.pending=a,c.timeout=setTimeout(function(){c.pending===a&&(c.timeout&&clearTimeout(c.timeout),c.word=a,c.pending=!1,x(a,c))},100);else return!1;return!0}}function x(a,b,c){var d=b.start,f=b.end;if(a.offsetParent){if(b.start)if(b.anchor)d=b.anchor,f=a;else if(b.start===b.end)d=b.start,f=a;else{var e=b.wordnum(a);
if("start"===b.adjust&&e>b.max||"end"===b.adjust&&e<b.min)return;if("start"===b.adjust)d=a;else if("end"===b.adjust)f=a;else if(d===a)b.setAdjust("start");else if(f===a)b.setAdjust("end");else if(e<=b.min)d=a,b.setAdjust("start");else if(e>=b.max)f=a,b.setAdjust("end");else if(6>e-b.min)d=a,b.setAdjust("start");else if(6>b.max-e)f=a,b.setAdjust("end");else{if(c)return;e-b.min>(b.max-b.min)/2?(f=a,b.setAdjust("end")):(d=a,b.setAdjust("start"))}}else e=u(a),d=e.start,f=e.end;P(function(){b.setRange(d,
f);b.loupe&&q(a,b,c)})}}function p(a,b){if(3===a.nodeType)return 0<=a.nodeValue.search(b);if(1===a.nodeType)for(var c=a.childNodes,d=0,f=c?c.length:0;d<f;){var e=c[d++];if(3===e.nodeType){if(0<=e.nodeValue.search(b))return e}else if(1===e.nodeType&&p(e,b))return e}return!1}function u(a){var b=a,c=a,d,f;if(!p(a,/"\(\[\{/)){f=b;for(d=b.previousSibling;d;)if(1===d.nodeType&&t(d,"fdjtword"))if(p(d,/["\(\[\{]/)){b=d;break}else if(p(d,/[.;!?]/)){b=f;break}else f=d,d=d.previousSibling;else d=d.previousSibling;
d||(b=f)}if(p(a,/[.;!?]/))c=a;else{f=c;for(d=c.nextSibling;d;)if(1===d.nodeType&&t(d,"fdjtword"))if(p(d,/[".;!?]/)){c=d;break}else f=d,d=d.nextSibling;else d=d.nextSibling;d||(c=f)}return{start:b,end:c}}function q(a,b,c){var d=a.parentNode,f=b.loupe;if(f){var e=F(f,".fdjtselecting");b.loupe_timeout&&(clearTimeout(b.loupe_timeout),b.loupe_timeout=!1);if(a.offsetParent){for(var h=a.parentNode;h&&"inline"===M(h).display;)h=h.parentNode;(B||b.traced)&&y("updateLoupe(%d) over %o for %o%s",b.serial,a,b,
c?" (tapped)":"");var h=t(a,"fdjtselectend")?g(a,7,3,h):g(a,3,7,h),k=G("span.fdjtloupetext");f.innerHTML="";G.append(k,h.words);G.append(f,k);e&&d.insertBefore(f,a);f.style.display="";c&&setTimeout(function(){b.active&&v(b);b.loupe.style.display="none"},1E3)}}}function g(a,b,c,d){var f=a.id,e=f&&/(fdjtSel\d+_)(\d+)/.exec(f);if(e&&3===e.length){var f=e[1],e=parseInt(e[2],10),g=e-b;c=e+c;0>g&&(g=0);b=[];for(var h=0,l,k,t=N(a);g<c;){var m=document.getElementById(f+g);if(m&&(!d||F(m,d)))if(1===m.nodeType){var q=
N(m);if(q.bottom<t.top||q.top>=t.bottom){g++;continue}q=m.cloneNode(!0);O(q);g<e?h+=m.offsetWidth:g===e?(l=h,h=k=h+m.offsetWidth):h+=m.offsetWidth;m===a&&G.addClass(q,"fdjtselected");b.push(q)}else b.push(m.cloneNode(!0));g++}return{words:b,width:h,wordstart:l,wordend:k}}}function c(a){var b=!1;return a&&(b=a.id)&&"SPAN"===a.tagName&&0===b.search("fdjtSel")?(a=b.indexOf("_"))?C[b.slice(0,a)]||!1:!1:!1}function b(a){a=a||window.event;for(var b=E.T(a);b&&1!==b.nodeType;)b=b.parentNode;for(;b;)if(b&&
b.id&&"SPAN"===b.tagName&&0===b.id.search("fdjtSel")){var d=c(b);!d||d.anchor||d.start||(d.anchor=b);(B||d&&d.traced)&&y("TextSelect/hold %o t=%o sel=%o",a,b,d);k(b,!1,d);E.cancel(a);break}else if(1===b.nodeType)b=b.parentNode;else break}function d(a){a=a||window.event;for(var b=E.T(a);b&&1!==b.nodeType;)b=b.parentNode;for(;b;)if(b&&b.id&&"SPAN"===b.tagName&&0===b.id.search("fdjtSel")){var d=c(b);(B||d&&d.traced)&&y("TextSelect/tap %o t=%o sel=%o",a,b,d);1===d.n_words?d.setRange(!1):"fdjtselectstart"===
b.className||"fdjtselectend"===b.className?(E.cancel(a),d.setRange(b,b)):k(b,!0,d)?(d.adjust="fdjtselectstart"===b.className?"start":"fdjtselectend"===b.className?"end":!1,E.cancel(a)):d&&(d.adjust=!1);break}else if(1===b.nodeType)b=b.parentNode;else break}function A(a,b){a=a||window.event;var c=E.T(a);(B||b&&b.traced)&&y("TextSelect/release %o t=%o sel=%o",a,c,b);b&&(b.anchor=!1,b.word=!1,b.pending=!1,b.timeout&&(clearTimeout(b.timeout),b.timeout=!1),b.setAdjust(!1),b.loupe&&(b.loupe.style.display=
"none"),b.active&&v(b))}function w(a,b){a=a||window.event;var c=E.T(a);(B||b&&b.traced)&&y("TextSelect/slip %o t=%o sel=%o",a,c,b);b&&b.loupe&&(b.loupe_timeout=setTimeout(function(){b.loupe_timeout=!1;b.active&&v(b);b.loupe.style.display="none"},2E3))}function f(a,b){return function(c){A(c,a);b&&b(c,a)}}function D(a,b){return function(c){w(c,a);b&&b(c,a)}}function J(a,c,e){e||(e={});e.override=!0;e.touchable=".fdjtword,.fdjtselected,.fdjtselectstart,.fdjtselectend";var g=new E.TapHold(a,e);G.addListener(a,
"tap",e&&e.ontap||d);G.addListener(a,"hold",e&&e.onhold||b);G.addListener(a,"release",f(c,e.onrelease||!1));G.addListener(a,"slip",D(c,e.onslip||!1));return g}var G=fdjt.DOM,y=fdjt.Log,E=fdjt.UI,F=G.hasParent,O=G.stripIDs,M=G.getStyle,I=G.textify,t=G.hasClass,T=G.swapClass,K=G.dropClass,P=G.requestAnimationFrame,C={},U={},V=0,B=0;a.prototype.serial=a.prototype.traced=a.prototype.adjust=a.prototype.n_words=a.prototype.start=a.prototype.end=a.prototype.min=a.prototype.max=0;a.prototype.prefix=a.prototype.traced=
0;a.prototype.nodes=a.prototype.orig=a.prototype.wrapped=a.prototype.wrappers=a.prototype.words=a.prototype.tapholds=a.prototype.loupe=[];a.prototype.onchange=a.prototype.wordnum=a.prototype.startEvent=!1;a.prototype.toString=function(){for(var a=this.wrappers,b="TextSelect(["+this.min+("start"===this.adjust?"*":"")+","+this.max+("end"===this.adjust?"*":"")+"],",c=0,d=a.length;c<d;)a[c].id&&(b=b+(0<c?",":"")+"'"+a[c].id+"'"),c++;return b+")"};a.prototype.setRange=function(a,b){(this.trace||B)&&y("TextSelect.setRange %o %o for %o",
a,b,this);if(a){var c=this.words,d=this.wordnum(a),f=this.wordnum(b);if(f<d){var e=a;a=b;b=e;e=d;d=f;f=e}if(this.start){if(this.start===a&&this.end===b)return;var e=this.wordnum(this.start),g=this.wordnum(this.end);d>g||f<e?(m(c,e,g),h(c,d,f)):(d<e?h(c,d,e):d>e&&m(c,e,d),f>g?h(c,g,f):f<g&&m(c,f,g))}else h(c,d,f);c[f].className="fdjtselectend";c[d].className="fdjtselectstart";this.min=d;this.max=f;this.start=a;this.end=b;this.n_words=f-d+1}else this.start&&this.end&&m(this.words,this.min,this.max),
this.start=this.end=!1,this.min=this.max=-1,this.n_words=0;if(this.onchange)this.onchange()};var N=G.getGeometry;a.getSelector=c;a.prototype.setString=function(a){var b=this.wrappers,c=1===b.length&&b[0];if(!c)for(var c=G("div"),d=0,f=b.length;d<f;){var e=b[d++];c.appendChild(e.cloneNode(!0))}if((b=G.findMatches(c,a,0,1))&&0!==b.length){b=b[0];a=b.startContainer;for(b=b.endContainer;a&&1!==a.nodeType;)a=a.parentNode;for(;b&&1!==b.nodeType;)b=b.parentNode;a&&b&&a.id&&b.id&&0===a.id.search(this.prefix)&&
0===b.id.search(this.prefix)&&(a=document.getElementById(a.id),b=document.getElementById(b.id),a&&b&&this.setRange(a,b))}};a.prototype.getString=function(a,b,c){a||(a=this.start);b||(b=this.end);for(var d=this.wrappers,f=[],e=this.prefix,g=-1;a;){if(!c&&1===a.nodeType){var h=M(a);"static"===h.position&&"inline"!==h.display&&"none"!==h.display&&f.push("\n")}if(1===a.nodeType&&"SPAN"===a.tagName&&a.id&&0===a.id.search(e)&&(h=a.innerText||I(a),f.push(h.replace("\u00ad","")),a===b))break;if(a.firstChild&&
"fdjtselectloupe"!==a.className&&3!==a.firstChild.nodeType)a=a.firstChild;else if(a.nextSibling)a=a.nextSibling;else{for(;a;){a:if(g=a,h=d,h.indexOf)g=h.indexOf(g);else{for(var l=0,k=h.length;l<k;)if(h[l]===g){g=l;break a}else l++;g=-1}if(0<=g)break;else if(a.nextSibling){a=a.nextSibling;break}else a=a.parentNode}0<=g&&g+1<d.length&&(a=d[g+1])}if(!a)break}return f.join("")};a.prototype.getOffset=function(a){if(!this.start)return!1;var b=this.words[0];if(a){var c=this.words,d=0,f=c.length;if(!F(this.start,
a)||!F(this.end,a))return!1;for(;d<f&&!F(b,a);)b=c[d++]}a=this.getString(!1,!1,!0);return this.getString(b,this.end,!0).length-a.length};a.prototype.getInfo=function(a){var b=this.traced;if(!this.start)return!1;var c=this.getString(),d=this.words[0];if(a){var f=this.words,e=0,g=f.length;if(!F(this.start,a)||!F(this.end,a))return!1;for(;e<g&&!F(d,a);)d=f[e++]}a=this.getString(!1,!1,!0);d=this.getString(d,this.end,!0);(b||B)&&y("GetInfo %o: start=%o, end=%o, off=%o, string=%o",this,this.start,this.end,
d.length-a.length,c);return{start:this.start,end:this.end,off:d.length-a.length,string:c}};a.prototype.setAdjust=function(a){var b=this.traced;(B||b)&&y("TextSelect.setAdjust %o for %o",a,this);a?(this.adjust=a,T(this.nodes,/\b(fdjtadjuststart|fdjtadjustend)\b/,"fdjtadjust"+a)):(this.adjust=!1,K(this.nodes,/\b(fdjtadjuststart|fdjtadjustend)\b/))};a.prototype.clear=function(){var a=this.wrappers,b=this.orig,c=this.wrapped;if(b){for(var d=b.length-1;0<=d;){var f=b[d],e=c[d];d--;e.parentNode.replaceChild(f,
e)}d=0;for(b=a.length;d<b;)c=a[d++],delete U[c.id],delete C[c.id];if(this.onclear)for(a=this.onclear,this.onclear=!1,Array.isArray(a)||(a=[a]),d=0,b=a.length;d<b;)a[d++]();delete C[this.prefix];delete this.wrapped;delete this.orig;delete this.wrappers;delete this.nodes;delete this.words;delete this.wrappers;delete this.start;delete this.end}};a.hold_handler=b;a.handler=b;a.tap_handler=d;a.release_handler=A;a.trace=function(a,b){if("undefined"===typeof a)return B;B="number"===typeof a?a:a?1:0;b&&fdjt.TapHold.trace(b)};
return a}();(function(){fdjt.useGlobals=fdjt.dbg=function(a){var n="fdjtDOM fdjtUI fdjtTime fdjtString fdjtState fdjtLog fdjtHash fdjtAjax fdjtAsync fdjtInit fdjtDialog fdjtTemplate fdjtID fdjtRef fdjtTapHold fdjtSelecting fdjtTextIndex fdjtRefDB TextIndex RefDB CodexLayout pageShow".split(" ");a||(a=window);if(a){for(var h=0,m=n.length;h<m;){var e=n[h++],v=0===e.search("fdjt")?e.slice(4):e;fdjt[v]&&!a[e]&&(fdjt.Log("%s = fdjt.%s",e,v),a[e]=fdjt[v])}return m}fdjt.Log("Nowhere to put globals")}})();var Knodule=function(){function a(a,c){if(0===arguments.length)return this;c||(c={});c.indices=c.indices?c.indices.concat(["terms","hooks","genls","specls","allgenls"]):["terms","hooks","genls","specls","allgenls"];var e=c.language,g=k.call(this,a,c);if(e&&g.language!==e)throw{error:"language mismatch"};if(c.language&&g.language&&c.language!==g.language)throw{error:"language mismatch"};g.language=c.language?c.language:"EN";g.dterms={};g.alldterms=[];g.prime=[];g.primescores={};g.validate=!0;g.strict=
!1;g.finished=!1;g.assumed_dterms=[];g.xdterms={};g.allxdterms=[];g.allwaysIndex=new u;g.oidmap={};g.drules={};return g}function n(a,c,h){if(0===arguments.length)return this;var k=!1,f="*"===a[0]&&a.search(/[^*]/),m=!1,n=this,n=!1;"~"===a[0]?(k=!0,a=a.slice(1)):f&&(a=a.slice(f),c.primescores[a]||(f>c.primescores[a]&&(c.primescores[a]=f),m=!0));var u=a.indexOf("@");if(0===u||1===u&&":"===a[0])n=!0;else if(2<u&&"\\"!==a[u-1]){var y=a.slice(u+1);y!==c.name&&0>c.aliases.indexOf(y)&&p("Reference %s in %s is being handled by %s",
a,y,c);a=a.slice(0,u)}n||(0===a.search(q)?(n=a.indexOf("$"),h=a.slice(0,n).toUpperCase(),a=a.slice(n+1)):h=h?h.toUpperCase():c.language||"EN");a=g(a);u=h===c.language?a:h+"$"+a;n=x.call(this,u,c);n===this&&(n.dterm||(n.dterm=u),n.add("dterms",u),c.dterms.hasOwnProperty(u)||(c.dterms[u]=n,c.alldterms.push(u)),n.allways=fdjt.Set(),h&&n.add(h,a),n._live=e());k&&(n.weak=!0);f&&(n.prime=f);f&&m&&c.prime.push(n);h&&h!==c.language&&(n.language=h);return n}function h(a,c,e){for(e=a.indexOf(c,e||0);0<e&&"\\"===
a[e-1];)e=a.indexOf(c,e+1);return e}var m=fdjt.String,e=fdjt.Time,v=fdjt.Log,k=fdjt.RefDB,x=fdjt.Ref,p=v.warn,u=k.ObjectMap,q=/^(([A-Za-z]{2,3}\$)|([A-Za-z]{2,3}_[A-Za-z]{2,3}\$))/;a.prototype=new k;a.prototype.language=a.prototype.dterms=a.prototype.alldterms=a.prototype.prime=a.prototype.primescores=a.prototype.validate=a.prototype.strict=a.prototype.finished=a.prototype.assumed_dterms=a.prototype.xdterms=a.prototype.allxdterms=a.prototype.allwaysIndex=a.prototype.oidmap=a.prototype.drules=!1;a.prototype.toString=
function(){return"Knodule("+this.name+")"};var g=m.stdcap;n.prototype=new k.Ref;n.prototype.dterms=!1;a.refclass=a.prototype.refclass=n;a.KNode=n;a.Knode=n;a.prototype.KNode=a.prototype.Knode=function(a,c){return a instanceof n?a:new n(a,this,c)};a.prototype.cons=function(a,c){return new n(a,this,c)};a.prototype.probe=function(a,c){var e=this.refs,h=this.aliases;a=g(a);if(this.language!==c&&c)a=c.toUpperCase()+"$"+a;else return e.hasOwnProperty(a)&&e[a]||h.hasOwnProperty(a)&&h[a]||!1;return this.dterms[c+
"$"+a]||!1};n.prototype.add=function(a,c){var e=this._db.allwaysIndex;if(x.prototype.add.call(this,a,c)&&"genls"===a){this.allways.push(c);for(var g=this.allways=k.merge(this.allways,c.allways),f=0,h=g.length;f<h;)e.add(g[f++],this);if(f=e.get(this))for(var h=0,m=f.length;h<m;){var q=f[h++];q.allways=k.merge(q.allways,this.allways);for(var p=0,n=g.length;p<n;)e.add(g[p++],q)}return!0}return!1};n.prototype.addTerm=function(a,c,e){if("string"===typeof a&&0===a.search(q)){var g=a.indexOf("$");e=a.slice(0,
g).toUpperCase();g=a.slice(g+1);e===this._db.language?c?this.add(c,g):(this.add(e,g),this.add("terms",g)):c?this.add(c,e+"$"+g):(this.add(e,g),this.add("terms",a))}else e?(e=e.toUpperCase(),e===this._db.language?c?this.add(c,a):this.add("terms",a):c?this.add(c,e+"$"+a):this.add("terms",e+"$"+a)):c?this.add(c,a):(this.add(this._db.language,a),this.add("terms",a))};n.prototype.tagString=function(b){if(this.oid)return this.oid;if(this.uuid)return this.uuid;if(this._qid)return this._qid;b||(b=a.current||
!1);return b===this._db?this._id:this._db.absrefs?this._id:this._domain?this._id+"@"+this._domain:this._id+"@"+this._db.name};n.prototype.toPlaintext=function(){var a="",c=this[this._db.language||"EN"],e=0;"string"===typeof c&&(c=[c]);for(var g=0;g<c.length;)a=a+(0<e?"|":"")+c[g++],e++;c=this.genls;"string"===typeof c&&(c=[c]);if(c&&c.length)for(g=0;g<c.length;)a=a+(0<e?"|^":"^")+c[g++].dterm,e++;c=this.specls;"string"===typeof c&&(c=[c]);if(c&&c.length)for(g=0;g<c.length;)a=a+(0<e?"|_":"_")+c[g++].dterm,
e++;return a};var c=m.segment;a.prototype.handleClause=function(a,c){var e=!1,g=!1,f=!1;0<=a.indexOf("\\")&&(a=m.unEscape(a));if(!(0===a.length||0>a.search(/[^\n\t ]/g))){switch(a[0]){case "^":"~"===a[1]?c.add("sometimes",this.KNode(a.slice(2))):"*"===a[2]?c.add("commonly",this.KNode(a.slice(2))):(e=h(a,"("),0<e?(f=h(a,")",e),0>f?v.warn("Invalid Knodule clause '%s' for %o (%s)",a,c,c.dterm):(g=this.KNode(a.slice(1,e)),e=this.KNode(a.slice(e+1,f)),e.add(g.dterm,c),c.add("genls",g))):c.add("genls",
this.KNode(a.slice(1))));break;case "_":e=this.KNode(a.slice(1));c.add("examples",e);e.add("genls",c);break;case "-":c.add("never",this.KNode(a.slice(1)));break;case "&":f=a.slice("-"===a[1]?2:1);g=this.KNode(f);"-"===a[1]?c.add("antiassocs",g):c.add("assocs",g);break;case "@":"#"===a[1]?c.add("tags",a.slice(2)):c.add("uri",a.slice(1));break;case "=":"@"===a[1]?c.oid=a.slice(1):"*"===a[1]?c.add("equiv",this.KNode(a.slice(2))):"~"===a[1]?c.add("kinda",this.KNode(a.slice(2))):"="===a[1]?c.add("identical",
this.KNode(a.slice(1))):(g=a.slice(1),e=c._db,e.dterms.hasOwnProperty(g)||(c.add("dterms",g),e.alldterms.push(g),e.dterms[g]=c));break;case "+":c.gloss="*"===a[1]?a.slice(2):"~"===a[1]?a.slice(2):a.slice(1);c.addTerm(c.gloss,"glosses");break;case "%":g=this.KNode(a.slice(1));if(c.mirror===g)break;else e=c.mirror,v.warn("Inconsistent mirrors for %s: +%s and -%s",c,g,e),e.mirror=!1;g.mirror&&(v.warn("Inconsistent mirrors for %s: +%s and -%s",g,c,g.mirror),e.mirror=!1);c.mirror=g;g.mirror=c;break;case ".":e=
h(a,"=");if(!e)throw{name:"InvalidClause",irritant:a};g=this.KNode(a.slice(1,e));e=this.KNode(a.slice(e+1));c.add(g.dterm,e);e.add("genls",g);break;case "~":g=a.slice(1);c.addTerm(g,"hooks");break;case ":":f=h(a,"=");if(0<f){g=a.slice(1,f);f=(e="+"===a[f+1])?a.slice(f+2):a.slice(f+1);if("\\"===f[0])f=f.slice(1);else if(/\d/.exec(f[0])){var k=parseFloat(f);"number"!==typeof k||!k&&0!==k||(f=k)}e?c.add(g,f):c.store(g,f)}c.add("flags",a.slice(1));break;default:e=h(a,"="),0<e?(g=this.KNode(a.slice(0,
e)),e=this.KNode(a.slice(e+1)),c.add(g.dterm,e),e.add("genls",g)):c.addTerm(a)}return c}};a.prototype.handleSubjectEntry=function(a){var d=c(a,/[|]/g),e;a:{e=g(d[0]);var h=this.probe(e);if(h)e=h;else{e=1;for(var f=d.length;e<f;)if(h=d[e++],"="===h[0]&&(h=this.probe(g(h.slice(1))))){e=h;break a}e=this.KNode(d[0])}}2<this.trace_parsing&&v("Processing subject entry %s %o %o",a,e,d);for(a=1;a<d.length;)this.handleClause(d[a++],e);2<this.trace_parsing&&v("Processed subject entry %o",e);return e};a.prototype.handleEntry=
function(b){b=b.trim();if(0===b.length)return!1;var c=b.search(/[^*]/);0<c&&(b=b.slice(c));var e=m.findSplit(b,"|"),g=m.findSplit(b,"@");if(0<g&&(0>e||g<e)){var f=b.slice(0,g),g=0>e?b.slice(g+1):b.slice(g+1,e),g=new a(g);g instanceof a?b=0>e?g.KNode(f):g.handleEntry(f+b.slice(e)):(p("Resolved %s to non-knodule %o",b,g),b=g.ref(f))}else b=this.handleSubjectEntry(b);if(c){var e=b._id,f=this.prime,g=this.primescores,h=g[e];h?c>h&&(g[e]=c,b.prime=c):(f.push(e),g[e]=c,b.prime=c)}return b};a.prototype.handleEntries=
function(a){if("string"===typeof a)return a=a.replace(/^\s*#.*$/g,"").replace(/^\s*\/\/.*$/g,""),a=c(a,/(?:\s*[\n;]\s*)+/g),1<this.trace_parsing&&v("Handling %d entries",a.length),this.handleEntries(a);if(a instanceof Array){for(var d=[],e=0;e<a.length;){var g=a[e++],f=g.length;";"===g[f-1]&&(g=g.slice(0,f-1));d[e]=this.handleEntry(g)}return d}throw{name:"TypeError",irritant:a};};a.prototype.def=a.prototype.handleSubjectEntry;a.def=function(b,c){c||(c=a.knodule);return c.def(b)};a.ref=k.ref;a.prototype.trace_parsing=
0;return a}(),KNode=Knodule.KNode,Knode=KNode;KNode!==Knode&&fdjt.Log("Weird stuff");(function(){function a(e,h,g){if(0===arguments.length)return this;var c=[],b=this.slots=[];h||(h=a.default_dbs||!1);g||(g=this.weights||{tags:1});e instanceof Array||(e=[e]);for(var d in g)g.hasOwnProperty(d)&&b.push(d);d=0;for(var k=e.length;d<k;){var p=e[d++];"string"===typeof p?c.push({fields:"strings",values:[p]}):p._db&&p._db.slots?c.push({fields:p._db.slots,values:[p]}):c.push({fields:b,values:[p]})}this.tags=e;return m.call(this,h,c,g)}var n=fdjt.RefDB,h=fdjt.Ref,m=n.Query,e=Knodule.KNode,
v=fdjt.Log.warn,k=fdjt.Set,x={"~%":1,"~%*":1,"%":4,"%*":4,"^%":2,"^%*":2,"*%":8,"*%*":6,"**%":12,"**%*":8};Knodule.addTags=function(a,k,g,c,b,d){b||(b="tags");"string"===typeof k?k=[k]:k instanceof h?k=[k]:k.length?k instanceof Array||(k=[].concat(k)):k=[k];"string"===typeof a?a=[a]:a instanceof h?a=[a]:a instanceof Array||(a=a.length?[].concat(a):[a]);for(var m=Array(k.length),p=0,f=k.length,D,J,G;p<f;){D=k[p];J=b;G=!1;if("string"===typeof D){if("*"===D[0]){var y=D.search(/[^*]/);J=D.slice(0,y)+
b;D=D.slice(y)}else"~"===D[0]&&(J="~"+b,D=D.slice(1),G=!0);0<D.indexOf("|")?c?D=c.handleEntry(D):Knodule.current&&(D=Knodule.current.handleEntry(D)):G&&c?D=c.probe(D)||D:G||c&&(D=c.ref(D))}m[p]=J;k[p]=D;p++}y=0;for(c=a.length;y<c;)p=a[y],(G=g&&"string"===typeof p?g.ref(p):n.resolve(p,!1,Knodule,!0))?a[y++]=G:(v("Couldn't resolve %s to a reference",p),y++);for(p=0;p<f;){D=k[p];J=m[p];d&&(g=J.replace(b,"%"),(g=x[g])||(g=3),d.increment(D,c*g));for(y=0;y<c;)if(G=a[y++])G.add(J,D,!0),G.alltags?G.alltags.push(D):
G.alltags=[D],D instanceof e&&(G.add("knodes",D),G.add(J+"*",D,!0)),D instanceof e&&D.allways&&G.add(J+"*",D.allways,!0);p++}};Knodule.exportTagSlot=function(a,e,g){a instanceof Array||(a=[a]);g=g.tags||(g.tags=[]);var c=e.search(/[^*~]+/),b=e.search(/[*]*$/),d=c&&e.slice(0,c);b?e.slice(c,b):c&&e.slice(c);e=0;for(b=a.length;e<b;){var h=a[e++];h&&(h="string"===typeof h?h:h._qid||h.getQID(),c?g.push(d+h):g.push(h))}};Knodule.importTagSlot=function(a,m,g,c,b){c=[];var d=[],p,w=a.tag_knodule||a._db.tag_knodule||
Knodule.tag_knodule||Knodule.current;g instanceof Array||(g=[g]);for(var f=0,x=g.length;f<x;){var J=g[f++];if(J)if(J instanceof h)c.push(J);else if("object"===typeof J&&J._id)p=a.resolve(J,w,Knodule,!0)||J._id,c.push(p);else if("string"===typeof J){var G=J.search(/[^*~]/),y=J,E=m;p=J;0<G&&(E=J.slice(0,G)+m,y=J.slice(G));J=y.indexOf("|");p=0<J?y.slice(0,J):y;p=n.resolve(p,w,Knodule,!0)||w&&w.ref(p)||p;0<J&&(p instanceof e?p._db.handleEntry(y):v("No knodule for %s",y));d.push(p);p instanceof e&&a.add("knodes",
p,b);E!==m?a.add(E,p,b):c.push(p)}else c.push(J)}a["all"+m]=k(d.concat(c));if(c.length)return c};a.prototype=new m;var p=fdjt.Map;a.prototype.getCoTags=function(a){if(this.cotags)return this.cotags;if(this.execute()){a||(a=this.results);for(var e=this.scores,g=this.slots,c=g.length,b=this.cotags=[],d=this.tagscores=new p,h=this.tagfreqs=new p,k=this._weights||this.weights,f=0,m=0,n=0,v=a.length;n<v;)for(var y=a[n++],E={},F=e&&e[y._id]||1,x=0;x<c;){var M=g[x];if(y.hasOwnProperty(M)){var I=y[M],M=k[M]||
1;I?I instanceof Array||(I=[I]):I=[];for(var t=0,T=I.length;t<T;){var K=I[t++];d.get(K)||b.push(K);if(!E[K]){var P=h.increment(K,1);P>m&&(m=P);E[K]=!0}K=d.increment(K,M*F);K>f&&(f=K)}}x++}this.max_tagfreq=m;this.max_tagscore=f;return b}return!1};a.prototype.getString=function(){for(var a=fdjt.Set(this.tags),e="",g=0,c=a.length;g<c;){0<g&&(e+=";");var b=a[g++],e="string"===typeof b?e+b:e+(b._qid||b.getQID())}return e};Knodule.TagQuery=a})();(function(){function a(a,h,m,g,c){function b(){if(a instanceof x){var b=a.dterm;d.innerHTML=b;f.setAttribute("data-key",b);f.setAttribute("data-dterm",a);if(c||g){var h=a[c];h&&"string"===typeof h&&(h=[h]);if(h)for(var k=0;k<h.length;){var m=h[k++];if(m!==b){var q=e("span.variation",m,"=");q.setAttribute("data-key",m);n.appendChild(q)}}a.about&&(f.title=a.about)}f.setAttribute("data-key",a.dterm)}else a.name&&(f.setAttribute("data-key",a.name),f.innerHTML=a.name);g&&g.addCompletion(f)}!0===g?("string"!==
typeof c&&(c=Knodule.language||"EN"),g=!1):g&&"string"!==typeof c&&(c=Knodule.language||"EN");h="string"===typeof a&&a||a._qid||a.getQID&&a.getQID()||a.toString();m=m&&e({tagName:"INPUT",type:"CHECKBOX",name:m,value:h});var d="string"===typeof a&&a||e("span.term",h),n=a instanceof x&&e("span.variations"),v="string"===typeof a,f=e(v?"span.rawterm":"span.dterm",m," ",n,v?e("span.termtext","\u201c"+d+"\u201d"):d);if(c||g)k(f,"completion"),f.setAttribute("data-value",h);if("string"===typeof a)f.setAttribute("data-key",
a),g&&g.addCompletion(f);else if(a._live)b();else a.onLoad(b);return f}function n(a,e){var h=v.getText("string"===typeof a?a:a.src),h=e.handleEntries(h);(e.trace_load||Knodule.trace_load)&&m("Parsed %d entries from %s",h.length,a.src)}var h=fdjt.String,m=fdjt.Log,e=fdjt.DOM,v=fdjt.Ajax,k=e.addClass,x=Knodule.KNode;Knodule.KNode.prototype.toDOM=Knodule.KNode.prototype.toHTML=function(){var a=e(this.prime?"span.dterm.prime":this.weak?"span.dterm.weak":"span.dterm",this.dterm);this.gloss&&(a.title=h.strip_markup(this.gloss));
a.dterm=this.dterm;return a};Knodule.HTML=a;Knodule.KNode2HTML=a;Knodule.Knode2HTML=a;Knodule.knode2HTML=a;Knodule.knodeToOption=function(a){var h;if("string"===typeof a)return h=e("OPTION",a),h.setAttribute("value",a),h;h=a.dterm;a="string"===typeof a&&a||a._qid||a.getQID&&a.getQID()||a.toString();var k=document.createDocumentFragment();h=e("option",h);h.setAttribute("value",a);k.appendChild(h);return k};Knodule.HTML.Setup=function(a){a||(a=new Knodule(document.location.href));var h=new Date,k=e.getLinks("{http://knodules.org/}knodule",
!0,!0),g=0,c,b;k&&k.length||(k=e.getLinks("knodule",!0,!0));k&&k.length||(k=e.getLinks("*.knodule",!0,!0));g=0;for(c=k.length;g<c;)n(k[g++],a);k=e.getMeta("knodef");for(g=0;g<k.length;)a.handleEntry(k[g++].content);k=document.getElementsByTagName("META");g=0;for(c=k.length;g<c;)b=k[g++],"KNODEF"===b.name&&a.handleEntry(b.content);k=document.getElementsByTagName("SCRIPT");g=0;for(c=k.length;g<c;){b=k[g++];var d=b.getAttribute("language"),v=b.type;if("text/knodule"===v||"application/knodule"===v||d&&
("knodule"===d||"KNODULE"===d||"knowlet"===d||"KNOWLET"===d))b.src?n(b,a):b.text&&(b=b.text,d=b.search("<!\\[CDATA\\["),0<=d&&(v=b.search("]]\x3e"),b=b.slice(d+9,v)),b=a.handleEntries(b),(a.trace_load||Knodule.trace_load)&&m("Parsed %d inline knodule entries",b.length))}k=new Date;(a.trace_load||Knodule.trace_load)&&m("Processed knodules in %fs",(k.getTime()-h.getTime())/1E3)}})();fdjt.CodexLayout=function(){function a(a,b,c,d){d=d||b.length;c=c||0;for(var e=document.createDocumentFragment();c<d;){var f=b[c++];f?3===f.nodeType&&0===f.nodeValue.length||e.appendChild(f):c++}a.appendChild(e)}function n(a){if("string"===typeof a){var b;if(0===a.length)return!0;b=a.search(Za);if(0>b)return!0;if("&"!==a[b])return!1;a=a.replace(/&nbsp;/g,"\u00a0");b=a.search(Za);return 0>b}return!1}function h(a){var b=r(a);return"none"===b.display||"static"!==b.position&&""!==b.position?!1:a}function m(a){if(a){if("string"===
typeof a)return"."===a[0]&&0>a.slice(1).search(/\.|#|\[/)?new RegExp("\\b"+a.slice(1)+"\\b"):new I.Selector(a);if(a instanceof RegExp||a.match)return a;if(a.length){for(var b=[],c=[],d=[],e=[],f=0,g=a.length;f<g;){var l=a[f++];"string"!==typeof l?b.push(l):"."===l[0]?0<=l.slice(1).search(/\.|#|\[/)?e.push(l):d.push(l.slice(1)):"#"===l[0]||"["===l[0]?e.push(l):d.push(l)}d.length&&c.push(new RegExp("\\b("+d.join("|")+")\\b"));e.length&&c.push(new I.Selector(e.join(", ")));return c.concat(b)}}return a}
function e(a,b){var c;if(!b)return!0;c="string"===typeof b?[b]:b instanceof Array?b:[b];for(var d=0,e=c.length;d<e;){var f=c[d++];if(a===b)return!0;if(f instanceof RegExp){if(a.className&&a.className.search&&0<=a.className.search(f))return!0}else if("string"===typeof f){if(a.className&&a.className.search&&("."===f[0]&&(f=f.slice(1)),0<=a.className.search(new RegExp("\\b"+f+"\\b"))))return!0}else if(f.match&&f.match(a))return!0}return!1}function v(a,b,c,d){"string"===typeof a&&(a=U(a));if(a&&0!==a.length)if(a.nodeType){if(1===
a.nodeType&&!S(a,"_pagescaled")&&!a.getAttribute("style")){var e=a.getAttribute("data-pagescale")||a.getAttribute("pagescale")||Ma(a,"xdatapagescale"),f=1,g=1,l=a.style,h=r(a);if(!l[I.transform]||"none"===l[I.transform]||""===l[I.transform]){e&&(g=e.split(/ |,|x/g),2===g.length?(f=k(g[0]),g=k(g[1])):g=f=k(g[0]));b*=f;c*=g;var e=a.offsetWidth,t=a.offsetHeight,f=b/e,g=c/t;"IMG"===a.tagName?(l.maxHeight=l.minHeight="inherit",l.maxWidth=l.minWidth="inherit",e=a.offsetWidth,t=a.offsetHeight,f=b/e,g=c/
t,f<g?(l.width=Math.round(e*f)+"px",l.height="auto"):(l.height=Math.round(t*g)+"px",l.width="auto")):d?(d="inline"===h.display?I("span.codexscalewrapper"):I("div.codexscalewrapper"),"inline"===h.display&&(l.display="inline-block",d.display="inline-block"),d.style.width=b+"px",d.style.height=c+"px",a.style[I.transform]="scale("+f+","+g+")",a.style[I.transformOrigin]="left"===h.textAlign?"top left":"right"===h.textAlign?"top right":"top center",a.parentNode.replaceChild(d,a)):(ab(a),"inline"===h.display&&
(l.display="inline-block"),l.width=b+"px",l.height=c+"px");oa(a,"_pagescaled")}}}else if(a.length)for(l=0,h=a.length;l<h;)v(a[l++],b,c,d||!1)}function k(a){return 0<a.search(/%$/g)?parseFloat(a.slice(0,a.length-1))/100:parseFloat(a)}function x(a,b,c){c||(c=document.body);for(;a;){if(a===b)return!0;if(a===c)return!1;if(a.previousSibling)if(3===a.previousSibling.nodeType&&n(a.previousSibling.nodeValue))a=a.previousSibling;else if(1!==a.previousSibling.nodeType||h(a.previousSibling))break;else a=a.previousSibling;
else a=a.parentNode}return 1===a.nodeType&&a.className&&a.className.search&&0<=a.className.search(/\bcodexpage\b/g)}function p(a,b,c){return a?0>a.search(Na)?a+" "+b:a.replace(Na,"")+" "+b:b}function u(a,b,c,d){if(a===document.body||"CODEXCONTENT"===a.id||S(a,"codexroot")||S(a,"codexpage"))return!1;if(B(a,b))return a;if(a.className&&a.className.search&&0<=a.className.search(/\bcodexwraptext\b/))return u(a.parentNode,b,c,d);var e=a.id,f=a.getAttribute("data-baseid");e||(e=f);var g=c[e],l=g&&g.length&&
g[g.length-1];if(!e)e=a.id="CODEXTMPID"+La++;else if(g)for(var h=g.length-1;0<=h;){if(B(g[h],b))return g[h];h--}h=a.cloneNode(!1);d=u(a.parentNode,b,c,d);var k=a.className&&a.className.search&&a.className||"",r=l&&l.className&&l.className.search&&l.className;f&&(h.codexbaseid=f);g||(a.className=p(k,"codexdupstart",H),q(a,!0),f=h.style,h.hasAttribute("data-savedstyle")||h.setAttribute("data-savedstyle",f.cssText),f.textIndent="0px",f.paddingTop="0px",f.borderTopWidth="0px",f.marginTop="0px");h.className=
p(k,"codexdupend");0<=k.search(/\bcodexdupend\b/g)&&(a.className=p(k,"codexdup"),q(a,!0));r&&0<=r.search(/\bcodexdupend\b/g)&&(l.className=r.replace(/\bcodexdupend\b/g,"codexdup"),q(l,!0));e&&(h.codexbaseid=e,h.setAttribute("data-baseid",e),h.removeAttribute("id"));g?g.push(h):c[e]=[h];d?d.appendChild(h):b.appendChild(h);return h}function q(a,b){var c=a.style;b&&!a.hasAttribute("data-savedstyle")&&a.setAttribute("data-savedstyle",c.cssText);c.paddingBottom="0px";c.borderBottomWidth="0px";c.marginBottom=
"0px"}function g(a){for(a=a.firstChild;a;){if(3===a.nodeType&&!n(a.nodeValue)||1===a.nodeType&&h(a))return a;a=a.nextSibling}return!1}function c(a,b,c,d){var e,f=!1;if(B(a,b))return a;1===a.nodeType?(e=a.className)&&"string"!==typeof e&&(f=!0):3===a.nodeType&&(0<=a.nodeValue.search(/\w/g)?(c=I(c?"div.codexwraptext":"span.codexwraptext"),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a),e="codexwraptext",a=c):a=a.cloneNode(!0));f||1===a.nodeType&&S(a,"codextextsplit")||!a.parentNode||a.id&&
d[a.id]||(a.id||(a.id="CODEXTMPID"+La++),c=document.createTextNode(""),d[a.id]=c,a.className=e?e+" codexrelocated":"codexrelocated",a.parentNode.replaceChild(c,a));b.appendChild(a);return a}function b(a,b,d,e){a=c(a,b,d,e);if(b){d=[];for(var f=a.nextSibling;f&&!(1===f.nodeType&&"string"===typeof f.className&&0<=f.className.search(/\bcodexblock\b/g));)d.push(f),f=f.nextSibling;b.appendChild(a);if(d.length)for(b=0,f=d.length;b<f;)c(d[b++],a,!1,e)}return a}function d(a,b){if(b||!S(a,"codexpagetop"))if(!a.namespaceURI||
a.namespaceURI===Ra){var c=a.getAttribute("style")||"",e=c+(c?"; ":"")+"margin-top: 0px !important;";a.hasAttribute("data-savedstyle")||a.setAttribute("data-savedstyle",c);a.setAttribute("style",e);oa(a,"codexpagetop");if(a.childNodes)for(var c=a.childNodes,e=0,f=c.length;e<f;){var g=c[e++];if(1===g.nodeType){var l=r(g);if(!("static"!==l.position&&""!==l.position||g.classname&&g.classname.search&&0<=g.className.search(/\bfdjtskiptext\b/g)))return d(g)}else if(3===g.nodeType&&!n(g.nodeValue))break}}}
function A(a,c,e,f){if(B(a,c))1!==a.nodeType||V(c,!0,!1,a)||d(a);else{for(var l=a,h=l.parentNode;h&&h!==document.body&&"CODEXCONTENT"!==h.id&&!S(h,"codexroot")&&!S(h,"codexpage")&&l===g(h);)l=h,h=l.parentNode;!h||h===document.body||"CODEXCONTENT"===h.id||S(h,"codexroot")||S(h,"codexpage")?l===a?a=l=b(a,c,!1,f):l=b(l,c,!1,f):(e=u(h,c,e,f),l===a?a=l=b(a,e||c,!1,f):l=b(l,e||c,!1,f));a&&1===a.nodeType&&!V(c,!0,!1,l)&&d(l)}return a}function w(c){function f(){}function g(a){Ta&&(3<Ta||gb&&gb.match(a))&&
qa("Moving node %o to page %o",a,ea);return A(a,ea,Da,qb)}function l(a){for(var b=0,c=a.length;b<c;){var d=a[b++],e=d.style.height;if(!(e&&""!==e&&"inherit"!==e&&"initial"!==e&&"auto"!==e||S(d,"codexoversize"))){d.style.height="auto";d.style.display="block";e=d.scrollHeight;if(!(e<va)){var f=r(d),f=va+da(f.paddingTop)+da(f.paddingBottom);e>f&&oa(d,"codexoversize")}d.style.height="";d.style.display="";(e=bb(d,".codexraggedsplit"))&&e.appendChild(I("span.codexdupleading.fdjtskiptext","leading"));d=
ua(d,".codexblock");e=0;for(f=d.length;e<f;){var g=d[e++];ga(g,"codexblock");ga(g,"codexterminal")}}}}function k(a,b,c,d,e,f){if(1===a.nodeType){var g=a.className;if("string"===typeof g){if(0<=g.search(/\bcodexdupstart\b/))e[a.id]||(e[a.id]=a,d.push(a.id),b.push(a.id));else if(0<=g.search(/\b(codexdup|codexdupend)\b/)){if(g=a.getAttribute("data-baseid"))a.codexbaseid=g,c[g]?c[g].push(a):c[g]=[a]}else a.id&&0<=g.search(/\bcodexrestore\b/)&&!f[a.id]&&(b.push(a.id),f[a.id]=a);if(a.childNodes&&a.childNodes.length){a=
a.childNodes;for(var g=0,l=a.length;g<l;){var h=a[g++];1===h.nodeType&&k(h,b,c,d,e,f)}}}}}function z(a){return new Promise(function(b,c){try{var e=document.createElement("div"),f=[],g={},l=[],h={},r={},z=[],m={},B=[];Ta&&t("Setting layout to %d characters of HTML",a.length);e.innerHTML=a;var n=e.childNodes,p=[];Ta&&t("Gathering layout info");for(var e=0,Ua=n.length;e<Ua;){var q=n[e++];p.push(q);1===q.nodeType&&(q.className&&q.className.search&&0<=q.className.search(/\bcurpage\b/)&&ga(q,"curpage"),
k(q,f,m,l,h,r))}h={};Ta&&t("Getting originals by ID");e=0;for(Ua=f.length;e<Ua;){var I=f[e++];h[I]=document.getElementById(I)}n=I=!1;Ta&&t("Moving body and container out of document");cb&&cb.parentNode&&(I=document.createTextNode(""),cb.parentNode.replaceChild(I,cb));ra.parentNode&&(n=document.createTextNode(""),ra.parentNode.replaceChild(n,ra));Ta&&t("Moving originals into layout");e=0;for(Ua=f.length;e<Ua;){var M=f[e++],F=h[M],K=r[M];if(K&&F){var C=K.className,N=K.getAttribute("style"),u=F.getAttribute("style"),
y=F.className,E=document.createTextNode(""),C=C.replace(/\bcodexrestore\b/,"");tb(F,E);qb[M]=E;tb(K,F);C&&C!==y&&(y&&"string"===typeof y&&F.setAttribute("data-savedclass",y),F.className=C);N!==u&&(u&&F.setAttribute("data-savedstyle",u),F.setAttribute("style",N));C.search&&0<=C.search(/\bcodexpagetop\b/)&&d(F,!0)}else F&&(g[M]=F,F.id&&F.removeAttribute("id"))}Ta&&t("Gathering lostids");for(var w=Y.lostids={},P=w._all_ids=[],e=0,Ua=l.length;e<Ua;){var X=l[e++],x=h[X];x&&(w[X]=x,P.push(X),x.id&&x.removeAttribute("id"))}Ta&&
t("Moving nodes around");for(var bb=ra.childNodes,e=0,Ua=bb.length;e<Ua;)z.push(bb[e++]);for(e=0;e<Ua;)ra.removeChild(z[e++]);e=0;for(Ua=p.length;e<Ua;){var H=p[e++],D=ua(H,"[pagescale],[data-pagescale]");D.length&&B.push({page:H,toscale:D});ra.appendChild(H)}Y.pages=p;Da=Y.dups=m;g._all_ids=f;Y.saved_ids=g;Y.page=p[0];Y.pagenum=parseInt(Y.page.getAttribute("data-pagenum"),10);Ta&&t("Moving origin/container back to document");n&&n.parentNode.replaceChild(ra,n);I&&I.parentNode.replaceChild(cb,I);for(var Ma=
ua(ra,".codexsplitstart"),f=0,T=Ma.length;f<T;){var G=Ma[f++],S=G.id,A=G.getAttribute("data-textsplit");S&&A&&(jb[S]=document.createTextNode(A),G.removeAttribute("data-textsplit"))}e=0;for(Ua=B.length;e<Ua;){var J=B[e++],V=J.page;V.style.opacity=0;V.style.display="block";v(J.toscale,sa,va);V.style.display="";V.style.opacity=""}}catch(W){c&&c(W);return}Ta&&t("Done restoring layout");return b?b(Y):Y})}function p(a,b){y(b.layout_id,a.id).then(function(b){a.innerHTML=b.content})}function M(a,b){if(1===
a.nodeType){if(a.id){var c=a.className;if(!(c&&"string"===typeof c&&0<=c.search(/\bcodexdup/g))&&a.id&&0!==a.id.search("CODEXTMP")){c=document.createElement(a.tagName);a.id&&(c.id=a.id);c.className="string"===typeof a.className?a.className+" codexrestore":"codexrestore";a.getAttribute("style")&&c.setAttribute("style",a.getAttribute("style"));a.parentNode.replaceChild(c,a);if(b&&b&&1===a.nodeType){var c=a.childNodes,d=[];if(c){for(var e=0,f=c.length;e<f;){var g=c[e++];1===g.nodeType&&b.match(g)&&d.push(g)}e=
0;for(f=d.length;e<f;)a.removeChild(d[e++])}}return}}c=a.childNodes;d=[];e=0;for(f=c.length;e<f;)g=c[e++],1===g.nodeType&&(b&&b.match(g)?d.push(g):M(g,b));e=0;for(f=d.length;e<f;)a.removeChild(d[e++])}}function F(a,b,c){function d(){Y.done=K();b&&b(Y);if(Y.thenfns&&Y.thenfns.length)for(var a=Y.thenfns,c=0,e=a.length;c<e;)a[c++](Y);return Y}var e=!1;if(a)if(a.hasOwnProperty("npages"))e=Y.setLayout(a);else if(a.hasOwnProperty("layout"))e=Y.setLayout(a.layout);else if(0<=a.indexOf("<"))e=Y.setLayout(a);
else return a=P.getLocal(a),Y?Y.setLayout(a,d):!1;else return t.warn("Falsy arg %s to restoreLayout",a),c(Error("Falsy arg to restoreLayout")),Y;return e.then(d).catch(c)}function u(a){if(!(2>a.length)){for(var b=[],c=0,d=a.length,e=0;c<d;){var f=a[c++],g=N(f,".codexpage"),g=g&&parseInt(g.getAttribute("data-pagenum"),10);b.push({list:f,pageno:g})}b.sort(function(a,b){return a.pageno>b.pageno?1:a.pageno<b.pageno?-1:0});c=0;for(d=b.length;c<d;)a=b[c++].list,f=H(a),e&&E(a,e),e+=f}}function E(a,b){for(var c=
document.createDocumentFragment();0<b;){var d=I("LI","empty");d.setAttribute("style","visibility: hidden !important; width: 0px !important; height: 0px !important; pointer-events: none; margin: 0px !important;");c.appendChild(d);b--}a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}function H(a,b){b||(b=0);for(var c=a.childNodes,d=0,e=c.length;d<e;){var f=c[d++];if(1===f.nodeType)if("OL"===f.tagName||"UL"===f.tagName)break;else"LI"===f.tagName?b++:b=H(f,b)}return b}function D(a,b){if(!a||
1!==a.nodeType)return!1;b||(b=r(a));return"always"===b.pageBreakBefore}function Ma(a){if(D(a))return!0;if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=0,c=a.length;b<c;){var d=a[b];if(3===d.nodeType)if(n(d.nodeValue))b++;else break;else{if(1===d.nodeType)return Ma(d);b++}}return!1}}function G(a,b){if(!a||1!==a.nodeType)return!1;b||(b=r(a));return"always"===b.pageBreakAfter}function aa(a){if(G(a))return!0;if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=a.length-1;0<=b;){var c=
a[b];if(3===c.nodeType)if(n(c.nodeValue))b--;else break;else{if(1===c.nodeType)return aa(c);b--}}return!1}}function Ca(a,b){var c=X(a,b);if(!a||1!==a.nodeType)return!1;if("IMG"===a.tagName)return!0;b||(b=r(a));return"avoid"===b.pageBreakInside||"table-row"===b.display||"block"===b.display&&a.childNodes&&a.childNodes.length&&c&&2.5*c>a.offsetHeight}function Za(a){if(!Ca(a)&&a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=0,c=a.length;b<c;){var d=a[b];if(1===d.nodeType&&(D(d)||G(d)||Za(d)))return!0;
b++}}return!1}function Na(a,b){if(!a||1!==a.nodeType)return!1;b||(b=r(a));return"avoid"===b.pageBreakBefore}function Va(a){if(Na(a))return!0;if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=0,c=a.length;b<c;){var d=a[b];if(3===d.nodeType)if(n(d.nodeValue))b++;else break;else{if(1===d.nodeType)return Va(d);b++}}return!1}}function ab(a,b){if(!a||1!==a.nodeType)return!1;if(/H\d/.exec(a.tagName))return!0;b||(b=r(a));return"avoid"===b.pageBreakAfter?!0:!1}function fa(a){if(ab(a))return!0;
if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=a.length-1;0<=b;){var c=a[b];if(3===c.nodeType)if(n(c.nodeValue))b--;else break;else{if(1===c.nodeType)return fa(c);b--}}return!1}}function Ra(a,b){if(!a||1!==a.nodeType)return!1;if(S("codexsinglepage")||S("codexfullpage")||Ea&&Ea.match(a))return!0;b||(b=r(a));return"always"===b.pageBreakBefore&&"always"===b.pageBreakAfter&&"avoid"===b.pageBreakInside}function kb(a){if(a){if("number"===typeof a)return U(wa+a);if(a.nodeType)return S(a,
"codexpage")?a:N(a,".codexpage");if("string"===typeof a)return kb(U(a));qa("Can't determine page from %o",a)}return!1}c||(c={});var Y=this;this.init=c;this.thenfns=[];var Ga=this.fullpages=m(c.fullpages||!1),Ea=this.singlepages=m(c.singlepages||!1),Pa=this.floatpages=m(c.floatpages||!1),la=this.floatblocks=m(c.floatblocks||!1),wa=this.pageprefix=c.pageprefix||"CODEXPAGE",va=this.height=c.page_height||I.viewHeight(),sa=this.width=c.page_width||I.viewWidth();this.orientation=c.orientation||(sa>va?"landscape":
"portrait");var R=c.pagefn||!1,Ya=!1;this.serialize=function(a){Ya="undefined"===typeof a?!0:a};var Qa=c.hasOwnProperty("short_page_height")&&c.short_page_height&&(1>=c.short_page_height?va*c.short_page_height:c.short_page_height),ja=this.break_blocks="undefined"===typeof c.break_blocks?!0:c.break_blocks,Fa=c.atomic||!1;"string"===typeof Fa?Fa=I.selector(Fa):Fa.length&&Fa.join&&(Fa=I.selector(Fa.join(",")));this.atomic=Fa;this.dontsave=c.dontsave||!1;var Wa=this.scale_pages=("undefined"===typeof c.use_scaling?
!0:c.use_scaling)&&("undefined"===typeof c.scale_pages?!0:c.scale_pages),ra=this.container=c.container||I("div.codexpages"),cb=this.origin=c.origin||!1,qa=this.logfn=c.logfn||w.logfn||("undefined"!==typeof t?t:f),Xa=this.pagenum=0,ob=this.pages=[],Da=this.dups={},qb=this.crumbs={};this.root=!1;var jb=this.textsplits={},rb=this.splits={},ea=this.page=c.page,db=this.prev=!1,pb=this.prevstyle=!1,lb=this.previnfo=!1,ya=this.drag=[],mb=this.floating=[];c.layout_id&&(this.layout_id=c.layout_id);this.started=
!1;var Ta=this.tracelevel=c.tracelevel||w.tracelevel||P.getLocal("codexlayout.trace",!0)||0,gb=c.track||w.track||P.getLocal("codexlayout.track")||!1,sb=c.debug||w.debug||P.getLocal("codexlayout.debug")||!1;gb&&(this.track=gb=I.Selector(gb),Ta||(Ta=this.tracelevel=1));sb?(this.debug=sb=I.Selector(sb),Ta||(Ta=this.tracelevel=1)):this.debug=!1;Ta&&oa(document.body,"debugcodexlayout");this.roots=c.roots||[];this.block_count=this.root_count=0;this.lastid=!1;this.timeslice=c.hasOwnProperty("timeslice")?
c.timeslice:w.timeslice;this.timeskip=c.hasOwnProperty("timeskip")?c.timeskip:w.timeskip;var Ua=this.pagerule=c.pagerule||!1;this.addContent=function(c,d,f,k,z,m){function p(){var a=U[L],b=ub[L],d=Q[L],e=d.terminal||!1,f=U[L+1],l=Q[L+1],h=!1;a.id&&(Y.lastid=a.id);k&&a&&(3<k||gb&&gb.match(a))&&(qa("Considering block %o (#%d from %o); page=%o",a,L,c,ea),h=!0);!a||db&&0>ya.indexOf(db)||(db&&x(db)?ya.length&&(Y.drag=ya=[]):db&&e&&d.avoidbreakbefore?0>ya.indexOf(db)&&ya.push(db):db&&d.avoidbreakafter?
0>ya.indexOf(db)&&ya.push(db):ya.length&&(Y.drag=ya=[]));a&&(d.floatpage||d.floating&&d.singlepage?(mb.push(a),a=!1):d.singlepage?(w(a,d),w(),a=!1):ea.childNodes.length&&(d.forcebreakbefore||lb&&lb.forcebreakafter||lb&&(lb.fullpage||lb.fullpage))?(Y.drag=ya=[],a=w(a,d)||a):a=g(a));if(a){var t=new Ia(a,ea),z=X(a,b),m=da(b.paddingBottom);k&&(3<k||gb&&gb.match(a))&&qa("Layout/geom %o %j",a,t);if(t.bottom-m>va||f&&t.height>3*z&&.9<(va-t.bottom)/va&&t.bottom+(new Ia(f)).height>va&&!d.avoidbreakinside&&
l.avoidbreakinside&&l.avoidbreakinside)if(f=va,t.bottom-m<=va&&(f=t.bottom-m-2*z),e)if((Qa?t.top>Qa:t.top>f-1.2*z)&&0===ya.length&&!d.avoidbreakbefore)a=w(a,d);else if(d.floating)mb.push(a),L++;else if(!ja||d.atomic||d.avoidbreakinside||S(a,"codexcantsplit"))h=a,f=d,l=ea,z=!1,ya.length&&x(ya[0],ea)?!f.avoidbreakafter&&1<(t.bottom-va)/va&&.2>(t.bottom-va)/va?(oa(ea,"codexoversize"),Y.drag=ya=[],w(),t=!1):(Y.drag=ya=[],z=w(h,f),ea===l?t=!1:(h!==z&&(f=new Da(z)),t=!ja||f.atomic||f.avoidbreakinside||
S(z,"codexcantsplit")?!1:z)):(z=w(h,f),h!==z&&(f=new Da(z)),ea===l?t=!1:(h!==z&&(f=new Da(z)),t=!ja||f.atomic||f.avoidbreakinside||S(z,"codexcantsplit")?!1:z)),t?a=t:L++;else{h&&qa("Splitting block %o @ %o",a,ea);if((t=bb(a,d,b,f))&&t!==a){Y.prev=db=a;Y.prevstyle=pb=b;Y.previnfo=lb=d;U[L]=t;ub[L]=b=r(t);Q[L]=new Da(t,b);Q[L].terminal=e;return}t=new Ia(a,ea);t.bottom>va&&(oa(ea,"codexoversize"),Y.drag=ya=[],w());L++;Y.drag=ya=[]}else h&&qa("Oversize non-terminal %o, continuing",a),L++;else{if(d.avoidbreakafter&&
!x(a,ea)){if(0===ya.length||0>ya.indexOf(a))h&&qa("Possibly dragging %o",a),ya.push(a)}else Y.drag=ya=[];L++}e&&(Y.prev=db=a,Y.prevstyle=pb=b,Y.previnfo=lb=d)}else L++}function q(a,b,c,d,e,f){var l=!1;if(!(1!==b.nodeType||b.codexui||(f||(f=r(b)),"static"!==f.position&&""!==f.position||f.float&&"none"!==f.float))){if(Fa&&Fa.match(b)||"table-row"===f.display||"BR"!==b.tagName&&"HR"!==b.tagName&&Ca(b,f)){b.offsetWidth>sa&&v(b,sa,b.offsetWidth/sa*b.offsetHeight,!0);if(0===b.offsetHeight||b.offsetHeight&&
b.offsetHeight<1.5*va){l=new Da(b,f);oa(b,"codexblock");d.push(l);c.push(b);e.push(f);l.terminal=b;g(b);u(b,a,d);return}b.childNodes&&b.childNodes.length&&(t.warn("Allowing split of huge (%d) block %o",b.offsetHeight,b),b.style.pageBreakInside="auto",f=r(b))}var h=f.display;if("BR"!==b.tagName&&"inline"!==h&&"table-cell"!==h){oa(b,"codexblock");l=new Da(b,f);c.push(b);e.push(f);d.push(l);if("block"===h||"table"===h||"list-item"===h||"table-row-group"===h){f=b.childNodes;for(var h=c.length,k=0,z=f.length;k<
z;){var m=f[k++];1===m.nodeType&&q(a,m,c,d,e)}c.length===h&&(l.terminal=b)}else l.terminal=b;l.terminal&&u(b,a,d);g(b)}else if("static"===f.position&&"A"===b.tagName){l=b.childNodes;f=0;for(h=l.length;f<h;)k=l[f++],1===k.nodeType&&(z=r(k),"inline"!==z.display&&q(a,k,c,e,d,z));g(b)}}}function Da(a,b){this.avoidbreakinside=Ca(a,b);this.forcebreakbefore=D(a,b);this.forcebreakafter=G(a,b);this.avoidbreakbefore=Na(a,b);this.avoidbreakafter=ab(a,b);this.fullpage=S(a,/\bcodexfullpage\b/)||Ga&&e(a,Ga);this.singlepage=
Ra(a,b);this.atomic=Fa&&Fa.match(a);this.floatpage=Pa&&e(a,Pa);this.floating=S(a,"codexfloat")||la&&la.match(a);return this}function F(a){for(a=a.nextSibling;a;)if(3!==a.nodeType||n(a.nodeValue)){if(1===a.nodeType&&h(a))return!1;a=a.nextSibling}else return!1;return!0}function M(a){for(a=a.previousSibling;a;)if(3!==a.nodeType&&n(a.nodeValue)){if(1===a.nodeType&&h(a))return!1;a=a.previousSibling}else return!1;return!0}function C(a,b){for(var c=b.length-1;0<=c;)if(b[c--].node===a)return b;return!1}function u(a,
b,c){if(!S(a,"codexterminal")){for(var d=a,e=document.body,f=[d],g=d.parentNode;g&&g!==e&&d!==b&&F(d);)f.push(g),d=g,g=d.parentNode;for(var e=a,g=document.body,d=[e],l=e.parentNode;l&&l!==g&&e!==b&&M(e);)d.push(l),e=l,l=e.parentNode;var l=g=e=b=!1,h=f&&C(f,c);c=d&&C(d,c);var k=0,t=f.length;if(1<t)for(;k<t;)ab(f[k])&&(g=!0),G(f[k])&&(l=!0),k++;k=0;t=d.length;if(1<t)for(;k<t;)Na(d[k])&&(b=!0),D(d[k])&&(e=!0),k++;g&&l||(g?(h&&(h.avoidbreakafter=!0),oa(f,"AVOIDBREAKAFTER")):l&&(h&&(h.forcebreakafter=
!0),oa(f,"FORCEBREAKAFTER")));b&&e||(b?(c&&(c.avoidbreakbefore=!0),oa(d,"AVOIDBREAKBEFORE")):e&&(c&&(c.forcebreakbefore=!0),oa(d,"FORCEBREAKBEFORE")));oa(a,"codexterminal")}}function y(a){if(3===a.nodeType)return 0>a.nodeValue.search(/\S/);if(1===a.nodeType){if(a.offsetHeight)return!1;if(a.childNodes&&0!==a.childNodes.length){a=a.childNodes;for(var b=0,c=a.length;b<c;)if(!y(a[b++]))return!1;return!0}return a.offsetHeight?!1:!0}return!1}function E(a){if(ea){if(a&&B(a,ea)){var b;if(!(b=ea.firstChild===
a))a:{b=ea;for(var c=a;c;)if(c===b){b=!0;break a}else{if(c.previousSibling)for(var d=c.previousSibling;d;)if(y(d)||1===d.nodeType&&!h(d))c=d,d=c.previousSibling;else{b=!1;break a}c=c.parentNode}b=!1}return b?!1:1===a.nodeType&&0===(new Ia(a,ea)).top&&"BR"!==a.tagName?!1:!0}return V(ea,!0)}return!0}function w(a,b,d){var e,f;if(ya&&ya.length&&ya.length&&x(ya[0]))return qa("Ignored call for new page @%d due to excessive drag",Xa),a&&g(a),!1;if(!a&&!d&&ea&&0===ea.childNodes.length)return a?qa("Ignored call for new page for %o on empty page %d",
a,Xa):qa("Ignored call for new page on empty page %d",a,Xa),!1;a&&3===a.nodeType&&(e=a.parentNode)&&1===e.childNodes.length&&e!==document.body&&e!==c&&!S(e,"codexpage")&&(a=e);if(a&&!d&&!E(a))return g(a);if(mb&&mb.length){var l=mb;mb=[];var h=ea;e=0;for(f=l.length;e<f;){var t=l[e++],r=!1;Ra(t)?(w(t),h=ea,d=!0):h===ea?(w(t),r=new Ia(t,ea),r.bottom>va&&(oa(ea,"codexoversize"),h=ea)):(A(t,ea),r=new Ia(t,J),r.bottom>=va&&w(t))}}if(!a||d||E(a))d=ea&&P(ea),ea&&(R&&R.call(Y,ea,Y),ea.style.height="",ga(ea,
"codexworkpage")),Y.page=ea=I("div.codexpage.codexworkpage"),W.push(ea),d&&(f=d.nodeValue,l=f.search(/[\(\[\"\\u201c\\u2018]+$/),e=I("span.codexsplitstart",f.slice(0,l)),f=I("span.codextextsplit",f.slice(l)),l=document.createDocumentFragment(),l.appendChild(e),l.appendChild(f),I.replace(d,l),ya.push(f)),Ua||(ea.style.height=va+"px",ea.style.width=sa+"px"),ea.style.height="inherit",Xa++,Y.pagenum=Xa,ea.id=wa+Xa,ea.setAttribute("data-pagenum",Xa),I(ra,ea),Y.prev=db=!1,ob.push(ea);k&&(2<k||gb&&a&&gb.match(a))&&
(a?qa("Layout/newpage %o at %o",ea,a):qa("Layout/newpage %o",ea));if(ya&&ya.length){e=0;for(f=ya.length;e<f;)g(ya[e++]);a?(d=a,b=b&&b.terminal,d&&ya.length&&b&&(1===ya.length||Na(d)||ab(ya[ya.length-1])?0>ya.indexOf(d)&&ya.push(d):Y.drag=ya=[])):(Y.prev=db=ya[ya.length-1],Y.drag=ya=[])}return a?g(a):!1}function P(a){if(3===a.nodeType)return 0<a.nodeValue.search(/[\(\[\"\\u201c\\u2018]+$/)?a:!1;if(1===a.nodeType){a=a.childNodes;var b=a.length;return 3===a[b-1].nodeType?P(a[b-1]):!1}return!1}function bb(c,
d,e,f){f||(f=va);e||r(c);if(!ja||d.avoidbreakinside||!c.childNodes||0===c.childNodes.length)return oa(c,"codexcantsplit"),w(c),c;c.id&&0!==c.id.search("CODEXTMP")&&(rb[c.id]||(rb[c.id]=c.cloneNode(!0)));d=new hb(c,ea,!0);e=d.line_height||12;if(f===va&&d.top+d.top_margin+1.2*e>va){f=ea;var g=w(c);if(f!==ea)return g;f=va+Ka(1.2*e)}g=ca(c.childNodes);c.innerHTML="";if((new Ia(c,ea)).bottom>f)return a(c,g),oa(c,"codexcantsplit"),w(c),c;f===va&&d.bottom-va<1.2*e&&d.height>3*e&&(f=va-Ka(e));if(f=H(c,g,
d,f)){if(f===c)return a(c,g),oa(c,"codexcantsplit"),w(c),c;d=f[0];Y.drag=ya=[];d=w(d);e=d.parentNode;var g=1,l=void 0,h=[];g||(g=0);l||(l=f.length);for(;g<l;)h.push(f[g++]);g=0;for(l=h.length;g<l;)b(h[g++],e,!1,qb);1<k&&qa("Layout/splitBlock %o @ %o into %o on %o",c,d,e,ea);return e}t("Tried to break %o which didn't need breaking",c);a(c,g);return c}function H(b,c,d,e){var f=!1,g=!1,l=-1,h=!1,k=!1;e||(e=va);var t=d||new Ia(b,ea);if(1===c.length)f=c[0],l=0,g=f.nodeType,b.appendChild(f);else for(k=
0,d=c.length;k<d;){var r=c[k++];b.appendChild(r);t=new Ia(b,ea);if(t.bottom>e){f=r;g=r.nodeType;l=k-1;break}}if(0>l)return!1;if(3===g)h=f,k=b;else{if(1!==g)return 0===l?b:c.slice(l);if(1===f.childNodes.length&&3===f.childNodes[0].nodeType)h=f.childNodes[0],k=f;else{if(0!==l&&V(b,!0,!1,f))return c.slice(l);a(b,c,l+1);return b}}d=r=h;for(var t=h.nodeValue.split(/(\s+)/mg),z=[],m=!1,B=0,n=t.length;B<n;){var p=t[B++],Ua;0<=(Ua=p.search(/\s/))?0===Ua?B>=n?m=p:m&&/\u00a0+/.exec(p)?m=m+p+t[B++]:(m&&z.push(m),
m=p):(m?z.push(m+p):z.push(p),m=!1):m=m?m+p:p}m&&z.push(m);if(2>z.length)return 0===l?b:c.slice(l);m=document.createTextNode(z[0]);k.replaceChild(m,r);r=m;t=new Ia(b,ea);if(t.bottom>e){k.replaceChild(d,r);if(0===l)return b;if(0===z[0].search(/^[.,;~?!:"'\u201d\u2019)\]-]/)){if(1===l)return b;k.removeChild(d);return c.slice(l-1)}return c.slice(l)}k.replaceChild(h,m);r=h;t=k;m=r;B=z.length;n=0;p=!1;Ua=m;for(var q=!1;n<B;){var Da=n+Ka((B-n)/2),q=document.createTextNode(z.slice(0,Da).join(""));t.replaceChild(q,
Ua);Ua=q;q=new Ia(b,ea);if(q.bottom>e)B=Da-1;else{q=document.createTextNode(z[Da]);t.appendChild(q);var F=new Ia(b,ea);t.removeChild(q);if(F.bottom>e){p=Da;break}else n=Da+1}}!1===p&&(p=n);m!==Ua&&t.replaceChild(m,Ua);e=p;if(0===e||e===z.length-1)return k.replaceChild(h,r),0===l?b:c.slice(l);h=z.slice(0,e).join("");e=z.slice(e).join("");z=!1;3===g?(t=I("span.codexsplitstart.codexraggedsplit"),z=t.id="CODEXTMPID"+La++,g=I("span.codextextsplit")):S(f,"codextextsplit")?(r=t=f,t.innerHTML="",k=b,g=f.cloneNode(!0),
oa(f,"codexraggedsplit"),g.id=""):(t=I("span.codexsplitstart"),g=f.cloneNode(!0),t.id?g.id="":z=t.id="CODEXTMPID"+La++);t.appendChild(document.createTextNode(h));g.innerHTML="";g.appendChild(document.createTextNode(e));t!==r&&k.replaceChild(t,r);c=c.slice(l);c[0]=g;a(b,c);z&&(jb[z]=d);return c}function T(){function a(){m(Y)}for(var b=K();L<ha&&(!d||Ya||K()-b<d);)p();z&&z(Y);L<ha?d?Y.timer=setTimeout(T,f||d):T():(b=U[ha-1],(G(b)||S(b,/\bcodexfullpage\b/)||Ga&&e(b,Ga))&&w(),Y.timer&&clearTimeout(Y.timer),
Y.timer=!1,Y.root=!1,l(W),W=[],m&&(d?setTimeout(a,10):m(Y)))}var J=!1,W=ea?[ea]:[],$a=K();ea||(w(),J=!0);d&&"number"!==typeof d&&(d=Y.timeslice);f&&"number"!==typeof f&&(f=Y.timeskip);"undefined"===typeof k&&(k=Y.tracelevel);"undefined"===typeof z&&(z=Y.progressfn||!1);Y.started||(Y.started=$a);if(N(c,".codexpage"))return l(W),W=[],m&&m(Y),!1;Y.roots.push(c);Y.root_count++;var O=($a=S(c,"codexfullpage")||Ga&&e(c,Ga))||S(c,"codexsinglepage")||Ra(c);if($a||O)Ca(c)||($a=O=!1);J?c=g(c):O?w(c):c=Ma(c)||
db&&aa(db)?w(c):g(c);var tb=ua(c,"[data-pagescale],[pagescale]");v(tb,sa,va);"IMG"===c.tagName&&($a||O)&&nb(c,sa,va);if(O)O=ea.scrollWidth,tb=ea.scrollHeight,O>sa||tb>va?oa(ea,"codexoversize"):$a&&O<.9*sa&&tb<.9*va&&oa(ea,"codexundersize"),w(),db=Y.prev=c,pb=Y.prevstyle=r(c),lb=Y.previnfo=new Da(c,pb),l(W),W=[],ya=[],m&&m(Y);else{$a=new Ia(c,ea);O=!1;if(!Za(c))if($a.bottom<=va)Va(c)?ya.push(c):ya=fa(c)?[c]:[],O=!0;else if(Fa&&Fa.match(c)||Ca(c))J||(w(c),$a=new Ia(c,ea)),$a.bottom<=va&&(ya=fa(c)?[c]:
[],O=!0);if(O)db=Y.prev=c,pb=Y.prevstyle=r(c),lb=Y.previnfo=new Da(c,pb),l(W),W=[],m&&m(Y);else{var U=[],Q=[],ub=[];q(c,c,U,Q,ub);Y.block_count+=U.length;1<k&&qa("Laying out %d blocks from %o; page=%o",U.length,c,ea);if(0===U.length)J||w(c),Y.root=!1,l(W),W=[],m&&m(Y);else{Y.root=c;var L=0,ha=U.length;Da.prototype.avoidbreakinside=Da.prototype.forcebreakbefore=Da.prototype.forcebreakafter=Da.prototype.avoidbreakbefore=Da.prototype.avoidbreakafter=Da.prototype.fullpage=Da.prototype.singlepage=Da.prototype.floatpage=
Da.prototype.floating=Da.prototype.atomic=!1;if(d)T();else{for(;L<ha;)p();l(W);m&&m(Y)}return Y}}}};var tb=I.replace;Y.setLayout=function(a){function b(c){p(c,a)}return"string"===typeof a?z(a):a.hasOwnProperty("npages")?(ra.innerHTML=a.layout,T.slowmap(b,ra.childNodes,{slice:Y.timeslice,space:Y.timeskip})):z(a.layout)};this.saveLayout=function(a,b){var c=window.location.href,d=c.indexOf("?"),e=c.indexOf("#"),d=d>=e?d:e;0<d&&(c=c.slice(0,d));b||(b=Y.layout_id||(Y.layout_id=Y.width+"x"+Y.height+"("+
c+")"));if(w.cache){for(var c=ra.cloneNode(!0),d=c.childNodes,e=0,f=d.length;e<f;){var g=d[e++];if(1===g.nodeType)for(var g=g.childNodes,l=0,h=g.length;l<h;){var k=g[l++];1===k.nodeType&&M(k,Y.dontsave||!1)}}d=ua(c,".codexsplitstart");e=0;for(f=d.length;e<f;)g=d[e++],(l=(l=g.id)&&jb[l])&&g.setAttribute("data-textsplit",l.nodeValue);J(b,c.innerHTML,!1,!1).then(function(){O(b);a(Y)}).catch(function(a){t.warn("Couldn't save layout %s: %s",b,a);return!1});return b}};this.restoreLayout=function(a){return new Promise(function(b,
c){F(a,b,c)})};var ub=I.scaleToFit.adjust;this.finishPage=function(a){a.style.display="block";var b=S(a,"codexundersize"),c=S(a,"codexoversize");if(c||b)if($a(a),Wa){var b=a.scrollWidth,d=a.scrollHeight,e=a.offsetWidth,f=a.offsetHeight;(c?d<=f&&b<=e:f<=d&&e<=b&&f>.9*d||e>.9*b)||(a.style.height="",ub(a))}Y.pagedone&&Y.pagedone(a);ga(a,"codexworkpage");a.style.display="";a.style.height=""};this.Finish=function(){for(var a in Da)if(Da.hasOwnProperty(a)){var b=Da[a],c=b[b.length-1],d=document.getElementById(a);
"OL"===d.tagName&&u([d].concat(b));if("LI"===d.tagName)for(var d=0,e=b.length;d<e;){var f=b[d++];f.hasAttribute(f,"data-savedstyle")||f.setAttribute("data-savedstyle",f.getAttribute("style")||"");f.style.listStyleType="none"}c.className=c.className.replace(/\bcodexdup\b/,"codexdupend")}if((a=ua(ea,".codexdup"))&&a.length)for(b=0,c=a.length;b<c;)d=a[b++],q(d);ea&&(R&&R.call(Y,ea,Y),ea.style.height="",ga(ea,"codexworkpage"));a=0;for(b=ob.length;a<b;)c=ob[a++],this.finishPage(c);Y.done=K();if(Y.thenfns&&
Y.thenfns.length)for(a=Y.thenfns,b=0,c=a.length;b<c;)a[b++](Y)};this.forcedBreakBefore=D;this.mustBreakBefore=Ma;this.forcedBreakAfter=G;this.mustBreakAfter=aa;this.avoidBreakInside=Ca;this.mustBreakInside=Za;this.avoidBreakBefore=Na;this.cantBreakBefore=Va;this.avoidBreakAfter=ab;this.cantBreakAfter=fa;this.checkSinglePage=Ra;this.getPage=kb;this.getDup=function(a,b){"string"===typeof a&&(a=document.getElementById(a));if(!a)return!1;if(B(a,b))return a;for(var c=Y.dups[a.id],d=0,e=c.length;d<e;){if(B(c[d],
b))return c[d];d++}return!1};this.gotoPage=function(a){var b=!1;if(a)if("number"===typeof a)b=document.getElementById(wa+a);else if(a.nodeType)b=S(a,"codexpage")?a:N(a,".codexpage");else if("string"===typeof a)b=kb(document.getElementById(a));else return qa("Can't determine page from %o",a),!1;else return!1;b&&(a=ra.getElementsByClassName("curpage"),a.length&&ga(ca(a),"curpage"),oa(b,"curpage"))};this.Revert=function(){var a,b;if(this.saved_ids){var c=this.saved_ids,d=c._all_ids,e=this.crumbs;a=0;
for(b=d.length;a<b;){var f=d[a++],g;if(e[f]){g=document.getElementById(f);var l=g.getAttribute("data-savedclass"),h=g.getAttribute("data-savedstyle"),f=e[f];l&&(g.className=l,g.removeAttribute("data-savedclass"));h&&(g.setAttribute("style",h),g.removeAttribute("data-savedstyle"));f.parentNode.replaceChild(g,f)}else c[f]&&(g=c[f],f&&(g.id=f))}c=this.lostids;d=c._all_ids;a=0;for(b=d.length;a<b;)if(e=d[a++])c[e].id=e;this.saved_ids={};this.dups={};this.lostids={}}else if(I.scaleToFit.revertAll(),a=this.crumbs,
c=K(),b=0,!(this.reverting&&1E4>c-this.reverting)){this.reverting=c;d=this.textsplits;e=ca(this.container.getElementsByClassName("_pagescaled"));b=0;for(c=e.length;b<c;)g=e[b++],l=N(g,".codexscalewrapper"),h=g.getAttribute("data-savedstyle"),ga(g,"_pagescaled"),h?g.setAttribute("style",h):g.setAttribute("style",""),l&&l.parentNode.replaceChild(g,l);b=ca(this.container.getElementsByClassName("codexcantsplit"));ga(b,"codexcantsplit");g=ca(this.container.getElementsByClassName("codexsplitstart"));b=
0;for(c=g.length;b<c;)e=g[b++],e.parentNode.replaceChild(d[e.id],e);g=ca(this.container.getElementsByClassName("codextextsplit"));b=0;for(c=g.length;b<c;)e=g[b++],e.parentNode.removeChild(e);b=ca(this.container.getElementsByClassName("codexraggedsplit"));ga(b,"codexraggedsplit");(b=ca(this.container.getElementsByClassName("codexdupleading")))&&b.length&&I.remove(b);e=ca(this.container.getElementsByClassName("codexrelocated"));b=ca(this.container.getElementsByClassName("codexdupstart"));c=ca(this.container.getElementsByClassName("codexdupend"));
g=ca(this.container.getElementsByClassName("codexdup"));l=ca(this.container.getElementsByClassName("codexpagetop"));ga(b,"codexdupstart");ga(c,"codexdupend");ga(g,"codexdup");ga(l,"codexpagetop");if(e&&e.length)for(this.logfn("Reverting layout of %d nodes and %d split texts",e.length,C.countKeys(d)),b=0,c=e.length;b<c;)if(d=e[b++],g=d.id){if(g=a[g])l=g.parentNode,S(d,/\bcodexwraptext\b/g)?l.replaceChild(d.childNodes[0],g):g.parentNode.replaceChild(d,g);ga(d,"codexrelocated")}a=I.$("[data-savedstyle]");
b=0;for(c=a.length;b<c;)d=a[b++],d.hasAttribute("data-savedstyle")&&((e=d.getAttribute("data-savedstyle"))?d.setAttribute("style",e):d.removeAttribute("style"),d.removeAttribute("data-savedstyle"));I.unwrapChildren("div.fdjtfontwrapper",this.container);this.textsplits={};this.crumbs={}}};return this}function f(a){"undefined"===typeof a?a=w.dbname:w.dbname=a;return new Promise(function(b,c){if(fa)return b(fa);if(Va&&a)try{C.useIndexedDB(a,1,function(a){a.createObjectStore("layouts",{keyPath:"layout_id"})}).then(function(a){w.layoutDB=
fa=a;w.cache=7;b(a)}).catch(function(a){t("indexedDB failed: %o",a);w.layoutDB=fa=window.localStorage;b(fa)})}catch(d){c(d)}else w.layoutDB=fa=window.localStorage,b(fa)})}function D(a,b,c,d,e){a=a.transaction(["layouts"],"readwrite").objectStore("layouts").put({layout_id:b,layout:c});a.onerror=function(a){t("Error saving layout %s: %o",b,a.target.errorCode);e&&e(a)};a.onsuccess=function(a){t("Layout %s cached",b);d&&d()}}function J(a,b){return new Promise(function(c,d){return fa?D(fa,a,b,c,d):f().then(function(e){fa=
w.layoutDB=window.LocalStorage;D(e,a,b,c,d)}).catch(function(){fa=w.layoutDB=window.LocalStorage;l(a,b);c&&c(fa)})})}function G(a){if(fa)if(window.Storage&&fa instanceof window.Storage){var b=P.dropLocal;b(a);M(a)}else{var c=fa.transaction(["layouts"],"readwrite").objectStore("layouts"),d=c.get(a),e=function(b){M(a)},f=function(b){t("Error removing laytout %s",a)};d.onerror=f;d.onsuccess=function(b){d=c["delete"](a);d.onerror=f;d.onsuccess=e}}}function y(a,b,c,d){var e=P.getLocal,f=!1;if(window.Storage&&
a instanceof window.Storage)(f=e(b)||!1)&&O(b),setTimeout(function(){c(f)},1);else if(a)(a=(a=fa.transaction(["layouts"]).objectStore("layouts"))&&a.get(b))||d("DB error"),a.onsuccess=function(a){var e=(a=a.target)&&a.result;a||d(!1);e&&O(b);e?c(e.layout):c(!1)},a.onerror=function(a){d(a)};else if(window.localStorage)(f=P.getLocal(b)||!1)&&O(b),setTimeout(function(){c(f)},0);else return d?d(!1):c?c(!1):!1}function E(a,b){return new Promise(function(c,d){return y(a,b,c,d)})}function F(a){if(fa){var b=
[];fa.transaction(["layouts"],"read").objectStore("layouts").openCursor().onsuccess=function(c){(c=c.target.result)?(b.push(c.key),c["continue"]()):a(b)}}else return!1}function O(a){l("fdjtCodex.layout("+a+")",a);aa("fdjtCodex.layouts",a)}function M(a){z("fdjtCodex.layout("+a+")",a);Ca("fdjtCodex.layouts",a);w.trace&&t("Layout %s removed",a)}var I=fdjt.DOM,t=fdjt.Log,T=fdjt.Async,K=fdjt.Time,P=fdjt.State,C=fdjt.RefDB,U=fdjt.ID,V=I.hasContent,B=I.hasParent,N=I.getParent,r=I.getStyle,da=I.parsePX,X=
I.getLineHeight,S=I.hasClass,oa=I.addClass,ga=I.dropClass,ca=I.toArray,Ma=I.getElementValue,l=P.setLocal,aa=P.pushLocal,z=P.dropLocal,Ca=P.removeLocal,Ka=Math.floor,Va=fdjt.iDB.indexedDB,Ra;document.body?Ra=document.body.namespaceURI:I.addListener(window,"load",function(){Ra=document.body.namespaceURI});var fa,ua=I.getChildren,bb=I.getChild,Ia=I.Geometry,hb=I.XGeometry,Za=/[^ \n\r\t\f\x0b\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff]/g,
ab=fdjt.DOM.adjustFontSize,$a=fdjt.DOM.adjustFonts,nb=fdjt.DOM.tweakImage,La=1,Na=/\bcodexdup(start|end)?\b/g,H=/\bcodex(dupstart|dup|dupend|relocated)\b/g;w.timeslice=50;w.timeskip=5;w.tracelevel=0;w.prototype.getDups=function(a){if(!a)return[];a.nodeType&&(a=a.id);var b=U(a);return(a=this.dups[a])?[b].concat(a):!1};w.prototype.getLayoutInfo=function(){for(var a=this.allmoves,b=this.pages.length,c=Array(b+1),d=0;d<=b;)c[d++]=[];b=0;for(d=a.length;b<d;){var e=a[b++],f=N(e,".codexpage");if(f)if(f=
parseInt(f.getAttribute("data-pagenum"),10),c[f]){var g={block:e};e.id&&(g.id=e.id);e.className&&(g.className=e.className);e.getAttribute("data-baseid")&&(g.baseid=e.getAttribute("data-baseid"));c[f].push(g)}else t.warn("weird page number: %o",f);else t.warn("Can't find page for %o",e)}return c};w.prototype.getLayoutBlocks=function(){for(var a=this.allblocks,b=[],c=0,d=a.length;c<d;){var e=a[c++],f=N(e,".codexpage"),f={pagenum:parseInt(f.getAttribute("data-pagenum"),10)},g=e.className;e.id&&(f.id=
e.id);"string"===typeof g&&(0<=g.search(/\bcodexdup/g)?f.html=e.outerHTML:(e.id&&(f.id=e.id),0<=g.search(/\bcodexpagetop\b/)&&(f.pagetop=!0),0<=g.search(/\bcodexcantsplit\b/)&&(f.cantsplit=!0)));b.push(f)}return{blocks:b,npages:this.pages.length,height:this.height,width:this.width,break_blocks:this.break_blocks}};w.cache=2;w.useIndexedDB=f;w.cacheLayout=J;w.dropLayout=G;w.fetchLayout=function(a){return f().then(function(b){return E(b,a)}).catch(function(b){t("Layout DB init failed: %o",b);return E(!1,
a)})};w.clearLayouts=function(){var a=P.getLocal("fdjtCodex.layouts",!0),b=0,c=a&&a.length;if(a){for(;b<c;)G(a[b++]);P.dropLocal("fdjtCodex.layouts")}};w.fetchAll=F;w.clearAll=function(a){F(function(b){var c=[],d=0,e=b.length;if(e){if(a)for(;d<e;){var f=b[d++];0<=f.search(a)&&c.push(f)}else c=b;if(0===c.length)t.warn("No layouts match %s",a);else for(a?t.warn("Dropping %d layouts matching %s",c.length,a):t.warn("Dropping %d layouts",c.length),d=0,e=c.length;d<e;)t.warn("Dropping layout %s",c[d]),
G(c[d++])}else t.warn("No layouts")})};w.dbname="codexlayout";return w}();"undefined"!==typeof window&&window.fdjt&&(window.CodexLayout=fdjt.CodexLayout);var Markdown;Markdown="object"===typeof exports&&"function"===typeof require?exports:{};
(function(){function a(a){return a}function n(a){return!1}function h(){}function m(){}h.prototype={chain:function(e,h){var k=this[e];if(!k)throw Error("unknown hook "+e);this[e]=k===a?h:function(a){var e=Array.prototype.slice.call(arguments,0);e[0]=k.apply(null,e);return h.apply(null,e)}},set:function(a,h){if(!this[a])throw Error("unknown hook "+a);this[a]=h},addNoop:function(e){this[e]=a},addFalse:function(a){this[a]=n}};Markdown.HookCollection=h;m.prototype={set:function(a,h){this["s_"+a]=h},get:function(a){return this["s_"+
a]}};Markdown.Converter=function(){function a(b){return b=b.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(a,b,c,d,e,f){b=b.toLowerCase();U.set(b,E(c));if(e)return d;f&&V.set(b,f.replace(/"/g,"&quot;"));return""})}function n(a){a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,k);a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,
k);a=a.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,k);a=a.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,k);return a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,k)}function k(a,b){var c;c=b.replace(/^\n+/,"");c=c.replace(/\n+$/g,"");return c="\n\n~K"+(B.push(c)-1)+"K\n\n"}function x(a,c){a=C.preBlockGamut(a,r);a=b(a);a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,"<hr />\n");a=a.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,
"<hr />\n");a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,"<hr />\n");a=d(a);a=w(a);a=G(a);a=C.postBlockGamut(a,r);a=n(a);return a=y(a,c)}function p(a){a=C.preSpanGamut(a);a=D(a);a=u(a);a=a.replace(/\\(\\)/g,P);a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,P);a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,c);a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,c);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,q);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,
q);a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,q);a=O(a);a=a.replace(/~P/g,"://");a=E(a);a=a.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4");a=a.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4");a=a.replace(/  +\n/g," <br>\n");return a=C.postSpanGamut(a)}function u(a){return a=a.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=
K(b,"!"==a.charAt(1)?"\\`*_/":"\\`*_")})}function q(a,b,c,d,e,f,h,k){void 0==k&&(k="");a=c.replace(/:\/\//g,"~P");d=d.toLowerCase();if(""==e)if(""==d&&(d=a.toLowerCase().replace(/ ?\n/g," ")),void 0!=U.get(d))e=U.get(d),void 0!=V.get(d)&&(k=V.get(d));else if(-1<b.search(/\(\s*\)$/m))e="";else return b;e=T(e);e=K(e,"*_");b='<a href="'+e+'"';""!=k&&(k=g(k),k=K(k,"*_"),b+=' title="'+k+'"');return b+(">"+a+"</a>")}function g(a){return a.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}
function c(a,b,c,d,e,f,h,k){a=c;d=d.toLowerCase();k||(k="");if(""==e)if(""==d&&(d=a.toLowerCase().replace(/ ?\n/g," ")),void 0!=U.get(d))e=U.get(d),void 0!=V.get(d)&&(k=V.get(d));else return b;a=K(g(a),"*_[]()");e=K(e,"*_");b='<img src="'+e+'" alt="'+a+'"';k=g(k);k=K(k,"*_");return b=b+(' title="'+k+'"')+" />"}function b(a){a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return"<h1>"+p(b)+"</h1>\n\n"});a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return"<h2>"+p(b)+"</h2>\n\n"});return a=
a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){a=b.length;return"<h"+a+">"+p(c)+"</h"+a+">\n\n"})}function d(a,b){a+="~0";var c=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;N?a=a.replace(c,function(a,c,d){a=-1<d.search(/[*+-]/g)?"ul":"ol";c=A(c,a,b);c=c.replace(/\s+$/,"");return"<"+a+">"+c+"</"+a+">\n"}):(c=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(c,function(a,
b,c,d){a=-1<d.search(/[*+-]/g)?"ul":"ol";c=A(c,a);return b+"<"+a+">\n"+c+"</"+a+">\n"}));return a=a.replace(/~0/,"")}function A(a,b,c){N++;a=a.replace(/\n{2,}$/,"\n");b=da[b];var e=!1;a=(a+"~0").replace(new RegExp("(^[ \\t]*)("+b+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+b+")[ \\t]+))","gm"),function(a,b,f,g){a=g;(b=/\n\n$/.test(a))||-1<a.search(/\n{2,}/)||e?a=x(I(a),!0):(a=d(I(a),!0),a=a.replace(/\n$/,""),c||(a=p(a)));e=b;return"<li>"+a+"</li>\n"});a=a.replace(/~0/g,"");N--;return a}function w(a){a=
(a+"~0").replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){a=J(I(b));a=t(a);a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");a="<pre><code>"+a+"\n</code></pre>";return"\n\n"+a+"\n\n"+c});return a=a.replace(/~0/,"")}function f(a){a=a.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(B.push(a)-1)+"K\n\n"}function D(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d,e){a=d.replace(/^([ \t]*)/g,"");a=a.replace(/[ \t]*$/g,"");a=J(a);a=a.replace(/:\/\//g,
"~P");return b+"<code>"+a+"</code>"})}function J(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");return a=K(a,"*_{}[]\\",!1)}function G(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c;c=b.replace(/^[ \t]*>[ \t]?/gm,"~0");c=c.replace(/~0/g,"");c=c.replace(/^[ \t]+$/gm,"");c=x(c);c=c.replace(/(^|\n)/g,"$1  ");c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c;c=b.replace(/^  /mg,"~0");return c=c.replace(/~0/g,"")});return f("<blockquote>\n"+
c+"\n</blockquote>")})}function y(a,b){a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");for(var c=a.split(/\n{2,}/g),d=[],e=/~K(\d+)K/,f=c.length,g=0;g<f;g++){var h=c[g];e.test(h)?d.push(h):/\S/.test(h)&&(h=p(h),h=h.replace(/^([ \t]*)/g,"<p>"),h+="</p>",d.push(h))}if(!b)for(f=d.length,g=0;g<f;g++)for(var k=!0;k;)k=!1,d[g]=d[g].replace(/~K(\d+)K/g,function(a,b){k=!0;return B[b]});return d.join("\n\n")}function E(a){a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");return a=a.replace(/<(?![a-z\/?!]|~D)/gi,
"&lt;")}function F(a,b,c,d){if(b)return a;if(")"!==d.charAt(d.length-1))return"<"+c+d+">";a=d.match(/[()]/g);for(var e=b=0;e<a.length;e++)"("===a[e]?0>=b?b=1:b++:b--;var f="";0>b&&(d=d.replace(new RegExp("\\){1,"+-b+"}$"),function(a){f=a;return""}));f&&(a=d.charAt(d.length-1),S.test(a)||(f=a+f,d=d.substr(0,d.length-1)));return"<"+c+d+">"+f}function O(a){a=a.replace(X,F);return a=a.replace(/<((https?|ftp):[^'">\s]+)>/gi,function(a,b){return'<a href="'+b+'">'+C.plainLinkText(b)+"</a>"})}function M(a){return a=
a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})}function I(a){a=a.replace(/^(\t|[ ]{1,4})/gm,"~0");return a=a.replace(/~0/g,"")}function t(a){if(!/\t/.test(a))return a;var b=["    ","   ","  "," "],c=0,d;return a.replace(/[\n\t]/g,function(a,e){if("\n"===a)return c=e+1,a;d=(e-c)%4;c=e+1;return b[d]})}function T(a){if(!a)return"";var b=a.length;return a.replace(oa,function(c,d){return"~D"==c?"%24":":"!=c||d!=b-1&&!/[0-9\/]/.test(a.charAt(d+1))?"%"+c.charCodeAt(0).toString(16):
":"})}function K(a,b,c){b="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(b="\\\\"+b);return a=a.replace(new RegExp(b,"g"),P)}function P(a,b){return"~E"+b.charCodeAt(0)+"E"}var C=this.hooks=new h;C.addNoop("plainLinkText");C.addNoop("preConversion");C.addNoop("postNormalization");C.addNoop("preBlockGamut");C.addNoop("postBlockGamut");C.addNoop("preSpanGamut");C.addNoop("postSpanGamut");C.addNoop("postConversion");var U,V,B,N;this.makeHtml=function(b){if(U)throw Error("Recursive call to converter.makeHtml");
U=new m;V=new m;B=[];N=0;b=C.preConversion(b);b=b.replace(/~/g,"~T");b=b.replace(/\$/g,"~D");b=b.replace(/\r\n/g,"\n");b=b.replace(/\r/g,"\n");b=t("\n\n"+b+"\n\n");b=b.replace(/^[ \t]+$/mg,"");b=C.postNormalization(b);b=n(b);b=a(b);b=x(b);b=M(b);b=b.replace(/~D/g,"$$");b=b.replace(/~T/g,"~");b=C.postConversion(b);B=V=U=null;return b};var r=function(a){return x(a)},da={ol:"\\d+[.]",ul:"[*+-]"},X=/(="|<)?\b(https?|ftp)(:\/\/[-A-Z0-9+&@#/%?=~_|[\]()!:,.;]*[-A-Z0-9+&@#/%=~_|[\])])(?=$|\W)/gi,S=/[-A-Z0-9+&@#/%=~_|[\])]/i,
oa=/(?:["'*()[\]:]|~D)/g}})();var metaBook={mode:!1,hudup:!1,scrolling:!1,query:!1,head:!1,target:!1,glosstarget:!1,location:!1,root:!1,start:!1,HUD:!1,locsync:!1,useidb:!1,noidb:!1,user:!1,loggedin:!1,cxthelp:!1,_setup:!1,_user_setup:!1,_gloss_setup:!1,_social_setup:!1,delay_startup:!1,connected:!1,curpage:!1,curoff:!1,curinfo:!1,curbottom:!1,last_mode:!1,last_heartmode:"about",demo:!1,taptapmsecs:200,holdmsecs:300,edgeclick:50,pagesize:250,dontanimate:!1,nativeselect:!1,minswipe:7,uisound:!1,readsound:!1,glossmodes:/(addtag)|(addoutlet)|(editdetail)|(hamburger)|(attach)/,
fullheight:!1,fullwidth:!1,handheld:!1,updatehash:!0,missing_nodes:[],cache_layout_thresh:2500,long_layout_thresh:5E3,resize_wait:500,forcelayout:!1,freezelayout:!1,persist:!1,cacheglosses:!1,saveprops:"sources outlets layers sync nodeid state".split(" "),keepdata:!1,mouse:!0,touch:!1,kbd:!1,keyboard:!0,pagers:{allglosses:"METABOOKALLGLOSSES",searchresults:"METABOOKSEARCHRESULTS",statictoc:"METABOOKSTATICTOC"},min_excerpt:3,max_excerpt:!1,queued:[],tagweights:!1,tagmaxweight:0,tagminweight:2E8,refuri:!1,
refuris:[],docuri:!1,mycopyid:!1,syncstamp:!1,update_interval:3E4,update_timeout:3E4,update_pause:18E5,sync_interval:18E4,sync_min:1E4,sync_timeout:15E3,sync_pause:3E5,UI:{handlers:{mouse:{},touch:{},kbd:{},ios:{}}},Debug:{},HTML:{},DOM:{},CSS:{},TapHold:{},slices:{},xtargets:{},xrules:[],Timeline:{},allterms:[],prefixes:{},openinbook:["https://www.youtube.com/"],srcloading:{},glossdata:{},inits:[],default_config:{layout:"bypage",bodysize:"normal",bodyfamily:"serif",bodycontrast:"high",textjustify:!1,
linespacing:"normal",uisize:"normal",dyslexical:!1,animatecontent:!0,animatehud:!0,hidesplash:!1,keyboardhelp:!0,holdmsecs:300,wandermsecs:1500,taptapmsecs:200,locsync:!0,syncinterval:60,checksync:900,glossupdate:300,cacheglosses:!0,soundeffects:!1,buzzeffects:!1,showconsole:!1,devmode:!1,controlc:!1},Trace:{startup:0,config:0,mode:!1,nav:!1,domscan:0,search:0,clouds:0,target:!1,toc:!1,storage:0,network:0,state:0,savegloss:0,glosses:0,addgloss:0,glossdata:0,slices:0,pagers:0,layout:0,knodules:0,preview:!1,
flips:!1,resize:!1,messages:!1,glossing:!1,selection:!1,highlight:0,indexing:0,zoom:0,gestures:0}};"undefined"===typeof mB&&(mB=metaBook);fdjt.DOM.noautofontadjust=!0;(function(){function a(a){return"string"===typeof a?a:a._qid?a._qid:a.getQID?(a._qid=a.getQID())||a.toString():JSON.stringify(a)}function n(b,c,d){if(d&&"string"!==typeof c)if(Array.isArray(c)){d=0;for(var e=c.length,f=[];d<e;){var g=c[d++];f.push(a(g))}c=JSON.stringify(f)}else c=a(c);C.persist?K(b,c,!1):w.setSession(b,c,!1)}function h(a,b){return C.persist?P(a)?T(a,b):w.existsSession(a)?(K(a,w.getSession(a)),T(a,b)):!1:w.getSession(a,b)||T(a,b)}function m(a){w.dropLocal(a);w.dropSession(a)}function e(){return new Promise(function(a,
b){B?a(B):V&&!C.noidb?(N.push(a),b&&r.push(b)):b&&b(!1)})}function v(a){metaBook.metaBookDB=B=a;f(function(){fdjt.CodexLayout.useIndexedDB(a.name)});var b=N;N=[];r=[];for(var c=0,d=b.length;c<d;)b[c++](a)}function k(a,b,c){var d=r;N=[];r=[];D("Error %s database %s: %o",a,b,c);a=0;for(b=d.length;a<b;)d[a++](c)}function x(a,b){if(this instanceof x){if(0===arguments.length)return this;var c=Knodule.TagQuery.call(this,a);U.search&&(c.log={});return c}return new x(a,b)}function p(a){var b;a||(a=metaBook.user);
if(a){if("string"===typeof a)return p(metaBook.sourcedb.probe(a));if(a.maker&&a.maker instanceof F)b=new Knodule(a.maker.getQID());else{if(a.maker&&"string"===typeof a.maker)return p(metaBook.sourcedb.probe(a.maker));b=a._qid?new Knodule(a._qid):a._id?new Knodule(a._i):metaBook.knodule}}else return metaBook.knodule;b.description=a.name;return b}function u(){if(metaBook.user&&!fdjt.device.standalone&&fdjt.device.mobilesafari){var a=C.mycopyid;if(a&&C.iOSKludge!==a){C.iOSKludge=a;var b=encodeURIComponent(a),
c=location.href,d=c.indexOf("?"),e=c.indexOf("#"),a=0>d?0>e?c:c.slice(0,e):c.slice(0,d),d=0>d?"":0>e?c.slice(d):c.slice(d+1,e),c=0>e?"":c.slice(e),f=!1,b="MYCOPYID="+b;if(2>=d.length)d="?"+b;else if(0<=d.search("MYCOPYID="))var f=d.search("MYCOPYID="),e=d.slice(0,f),g=d.slice(f).search("&"),l=0>g?"":d.slice(f+g),f=0>g?d.slice(f):d.slice(f,f+g),d=e+b+l;else d=d+"&"+b;f&&f===b||history.replaceState(history.state,window.title,a+("?"===d[0]?d:"?"+d)+("#"===c[0]?c:"#"+c))}}}function q(){document[J.isHidden]?
S&&(clearInterval(S),S=!1):S||(S=setInterval(function(){metaBook.user&&!fdjt.device.standalone&&!document[J.isHidden]&&fdjt.device.mobilesafari&&u()},3E5))}function g(){q();J.isHidden&&J.addListener(document,J.vischange,q);metaBook.iosAuthKludge=u;q()}function c(a){return"string"===typeof a?oa(a)?!1:a:!1}function b(a){var b;a&&"string"===typeof a&&"#"===a[0]&&(a=a.slice(1));ga||(ga=metaBook.docinfo);var c=ga&&(b=ga[a])&&b.elt;if(c&&c.id||(c=document.getElementById(a)))return c;b=document.getElementsByName(a);
if(1===b.length)return b[0];if(1<b.length)return!1;b=J.$("[data-tocid='"+a+"']");return 1===b.length?b[0]:b.length?(b=J.$(".codexdupstart[data-tocid='"+a+"']"),1===b.length?b[0]:!1):!1}function d(a,b,c,e){c||(c="tags");e||(e=metaBook.knodule);var f=metaBook.docdb;a instanceof Array||(a=[a]);Ma(a,b,f,e,c,metaBook.tagscores);for(var g=0,l=a.length;g<l;){var h=a[g++];if(h.toclevel){var k=f.find("head",h);k.length&&(k=[].concat(k));k&&k.length&&Ma(k,b,f,e,"^"+c,metaBook.tagscores);h=f.find("heads",h);
h.length&&(h=[].concat(h));h&&h.length&&d(h,b,"^"+c,e)}}}var A=fdjt.String,w=fdjt.State,f=fdjt.Async,D=fdjt.Log,J=fdjt.DOM,G=fdjt.UI,y=fdjt.ID,E=fdjt.RefDB,F=fdjt.Ref,O=fdjt.Map||E.Map,M=J.hasClass,I=J.addClass,t=J.hasParent,T=w.getLocal,K=w.setLocal,P=w.existsLocal,C=metaBook,U=metaBook.Trace,V=fdjt.iDB.indexedDB;metaBook.tagweights=new O;metaBook.tagscores=new O;metaBook.hasLocal=function(a){return C.persist?P(a):w.existsSession(a)};metaBook.saveLocal=n;metaBook.readLocal=h;metaBook.clearLocal=
m;metaBook.focusBody=function(){};var B=!1,N=[],r=[];metaBook.getDB=e;V&&!C.noidb?(O=V.open("metaBook",1),O.onerror=function(a){k("opening","metaBook",a.errorCode)},O.onsuccess=function(a){a=a.target.result;D("Using existing metaBook IndexedDB");v(a)},O.onupgradeneeded=function(a){a=a.target.result;a.onerror=function(a){k("upgrading","metaBook",a.target.errorCode)};a.onsuccess=function(a){a=a.target.result;D("Initialized metaBook indexedDB");v(a)};a.createObjectStore("glossdata",{keyPath:"url"});
a.createObjectStore("layouts",{keyPath:"layout_id"});a.createObjectStore("sources",{keyPath:"_id"});a.createObjectStore("docs",{keyPath:"_id"});a.createObjectStore("glosses",{keyPath:"glossid"})}):fdjt.CodexLayout.useIndexedDB(!1);metaBook.initDB=function(){function a(){return F.apply(this,arguments)}function b(a){var c=w.dropLocal;if(a)"string"!==typeof a&&(a=metaBook.docid),(c=T("mB("+a+").sourceid"))&&metaBook.clearLayouts(c),metaBook.sync=!1,m("mB("+a+").sources"),m("mB("+a+").outlets"),m("mB("+
a+").layers"),m("mB("+a+").etc"),m("mB("+a+").sync"),metaBook.glossdb.clearOffline(function(){m("mB("+a+").sync")}),metaBook.clearGlossData(a);else{var d=h("mB.docids",!0);if(d)for(var e=0,f=d.length;e<f;)b(d[e++]);c("mB.user");c("mB.docuris");c("mB.docids");fdjt.CodexLayout.clearLayouts();w.clearLocal();w.clearSession()}}1<U.start&&D("Initializing DB");var c=metaBook.refuri||document.location.href;0<c.indexOf("#")&&(c=c.slice(0,c.indexOf("#")));metaBook.setupGlossData();var d=metaBook.taglist||y("METABOOKTAGLIST");
d||(d=metaBook.taglist=fdjt.DOM("datalist#METABOOKTAGLIST"),document.body.appendChild(d));metaBook.docdb=new E(c+"#",{indices:"frag head heads tags tags* *tags **tags ~tags *tags **tags ~tags *tags* **tags* ~tags* ^tags ~^tags *^tags **^tags ^tags* ~^tags* *^tags* **^tags*".split(" ")});metaBook.docdb.slots=["head","heads"];var f=Knodule.knodeToOption,g=/^https:\/\/glossdata.(sbooks\.net|metabooks\.net|beingmeta\.com|bookhub\.io)\//;C.cachelink=g;c=J.getMeta("METABOOK.knodule")||J.getMeta("PUBTOOL.knodule")||
J.getMeta("~KNODULE")||c;metaBook.knodule=new Knodule(c);Knodule.current=metaBook.knodule;metaBook.BRICO=new Knodule("BRICO");metaBook.BRICO.addAlias(":@1/");metaBook.BRICO.addAlias("@1/");var l=A.stdspace,k=metaBook.glossdb=new E("glosses@"+metaBook.refuri,{indices:"frag maker outlets tags *tags **tags tags* *tags* **tags*".split(" ")});k.absrefs=!0;k.dbname="glosses";k.addAlias("glossdb");k.addAlias("-UUIDTYPE=61");k.addAlias(":@31055/");k.addAlias("@31055/");k.onLoad(function(a){var b=metaBook.docinfo[a.frag];
if(b){b&&b.starts_at&&(a.starts_at=b.starts_at+(a.exoff||0));b&&b.ends_at&&(a.ends_at=a.excerpt?b.ends_at+(a.exoff||0)+l(a.excerpt).length:b.ends_at);!a.maker&&metaBook.user&&(a.maker=metaBook.user);var c=metaBook.addTags,e=metaBook.addTag2Cloud,h=metaBook.empty_cloud,k=a.maker&&metaBook.sourcedb.ref(a.maker);if(a.links){var t=a.links,r;for(r in t)if(t.hasOwnProperty(r)&&t[r]){if(g.exec(r)){var m=r.replace("//glossdata.sbooks.net/","//glossdata.bookhub.io/");r!==m&&(t[m]=t[r],delete t[r],r=m)}t.hasOwnProperty(r)&&
g.exec(r)&&metaBook.needGlossData(r)}}k&&(metaBook.addTag2Cloud(k,metaBook.empty_cloud),metaBook.UI.addGlossSource(k,!0));var t=metaBook.getMakerKnodule(a.maker),k=k===metaBook.user,B=a.sources;if(B&&("string"===typeof B&&(B=[B]),B&&B.length))for(r=0,m=B.length;r<m;){var z=B[r++],z=metaBook.sourcedb.ref(z);metaBook.UI.addGlossSource(z,!0)}if((B=a.alltags)&&B.length){r=0;for(m=B.length;r<m;){var z=B[r++],n;n=e(z,h);k&&n&&I(n,"cue");n=e(z,metaBook.gloss_cloud);k&&n&&I(n,"cue");d.appendChild(f(z))}e=
["tags","*tags","**tags"];h=0;for(k=e.length;h<k;)m=e[h++],(r=a[m])&&r.length&&(m="+"+m,a.thread&&(c(a.thread,r,m),a.replyto!==a.thread&&c(a.replyto,r,m)),b&&c(b,r,m,t))}}else D("Gloss (onload) refers to nonexistent '%s': %o",a.frag,a)},"initgloss");metaBook.user&&C.persist&&metaBook.cacheglosses&&(C.useidb&&!C.noidb?e().then(function(a){k.storage=a}):k.storage=localStorage);a.prototype=new F;var c=Knodule.exportTagSlot,t={"*tags":c,"**tags":c,"~tags":c,"~~tags":c,tags:c,"*tags*":c,"**tags*":c,"~tags*":c,
"~~tags*":c,"tags*":c,"*tags**":c,"**tags**":c,"~tags**":c,"~~tags**":c,"tags**":c};metaBook.tag_export_rules=t;metaBook.tag_import_rules=t;a.prototype.ExportExternal=function(){return F.Export.call(this,t)};metaBook.glossdb.refclass=a;c=metaBook.sourcedb=new E("sources@"+metaBook.refuri);c.absrefs=!0;c.dbname="sources";c.oidrefs=!0;c.addAlias("@1961/");c.addAlias(":@1961/");c.addAlias("@acc/");c.addAlias(":@acc/");c.onLoad(function(a){a.pic&&"string"===typeof a.pic&&0===a.pic.search("data:")&&(a._pic=
J.data2URL(a.pic))});c.forDOM=function(a){var b="span.source"+(a.kind?".":"")+(a.kind?a.kind.slice(1).toLowerCase():""),b=J(b,a.name||a.oid||a.uuid||a.uuid);a.about&&(b.title=a.about);return b};metaBook.queued=metaBook.cacheglosses&&T("mB("+metaBook.docid+").queued",!0)||[];metaBook.setCacheGlosses=function(a){var c=metaBook.saveprops,d=C.docid;if(a){if(metaBook.user){C.useidb&&!C.noidb?e().then(function(a){metaBook.sourcedb.storage=a;metaBook.glossdb.storage=a}):(a=C.persist?window.localStorage:
window.sessionStorage,metaBook.sourcedb.storage||(metaBook.sourcedb.storage=a),metaBook.glossdb.storage||(metaBook.glossdb.storage=a));a=0;for(var f=metaBook.saveprops.length;a<f;){var g=c[a++];metaBook[g]&&n("mB("+d+")."+g,metaBook[g],!0)}metaBook.glossdb.save(!0);metaBook.sourcedb.save(!0);metaBook.queued=metaBook.queued&&metaBook.queued.length?metaBook.queued.concat(T("mB("+d+").queued",!0)||[]):T("mB("+d+").queued",!0)||[]}metaBook.cacheglosses=!0}else b(metaBook.docuri),d&&w.dropLocal("mB("+
d+").queued"),metaBook.queued=[],metaBook.cacheglosses=!1};metaBook.saveProps=function(a){var b=C.docid,c=a?Array.isArray(a)?a:[c]:metaBook.saveprops;a=0;for(var d=c.length;a<d;){var e=c[a++];metaBook[e]&&n("mB("+b+")."+e,metaBook[e],!0)}};metaBook.setPersist=function(){metaBook.persist=!0;var a=C.refuri,b=C.docuri,c=C.docid;n("mB("+c+")",b);var d=h("mB.refuris",!0),e=h("mB.docuris",!0),f=h("mB.docids",!0);d?0>d.indexOf(a)&&(d.push(a),n("mB.refuris",d,!0)):n("mB.refuris",[a],!0);e?0>e.indexOf(b)&&
(e.push(b),n("mB.docuris",e,!0)):n("mB.docuris",[b],!0);f?0>f.indexOf(c)&&(f.push(c),n("mB.docids",f,!0)):n("mB.docids",[c],!0);C.sourceid&&n("mB("+C.docid+").sourceid",C.sourceid)};metaBook.clearOffline=b;metaBook.refreshOffline=function(){var a=metaBook.docid;metaBook.sync=!1;m("mB("+a+").sources");m("mB("+a+").outlets");m("mB("+a+").layers");m("mB("+a+").etc");metaBook.glossdb.clearOffline(function(){m("mB("+a+").sync");setTimeout(metaBook.updateInfo,25)})};x.prototype.dbs=[metaBook.glossdb,metaBook.docdb];
x.prototype.weights={"+tags":8,tags:4,"+tags*":2,"tags*":2,"^+tags":2,strings:1,head:2,heads:1};x.prototype.uniqueids=!0;metaBook.query=metaBook.empty_query=new x([]);1<U.start&&D("Initialized DB")};x.prototype=new Knodule.TagQuery;metaBook.Query=x;metaBook.Query.prototype.getRefiners=function(){if(this._refiners)return this._refiners;for(var a=this.getCoTags(),b=this.tagfreqs,c=this.results.length,d=metaBook.textindex.termindex,e=metaBook.textindex.allids.length,f=0,g=a.length,h=[];f<g;){var l=a[f++];
if("string"!==typeof l)h.push(l);else{var k=b.getItem(l);if(!(k>.9*c||3>k||.1>k/c)){var t=d[l],t=t?t.length:0;0===t&&h.push(l);.4<t/e||k/c>t/e*5&&h.push(l)}}}return this._refiners=h};metaBook.getMakerKnodule=p;metaBook.trace=function(a,b){var c=b.nodeType?b:G.T(b);c?D("%s %o in %o: mode%s=%o, target=%o, head=%o skimming=%o",a,b,c,metaBook.skimpoint?"(skimming)":"",metaBook.mode,metaBook.target,metaBook.head,metaBook.skimpoint):D("%s %o: mode%s=%o, target=%o, head=%o skimming=%o",a,b,metaBook.skimpoint?
"(skimming)":"",metaBook.mode,metaBook.target,metaBook.head,metaBook.skimpoint)};var O=/https?:\/\/[^\/]+\/([^\/]+\/)*/,da=window._metabook_amalgam;metaBook.server=!1;metaBook.servers=[];metaBook.default_server="glosses.bookhub.io";metaBook.root=da&&O.exec(da)&&O.exec(da)[0]||J.getLink("METABOOK.staticroot")||"http://static.beingmeta.com/";"/"!==metaBook.root[metaBook.root.length-1]&&(metaBook.root+="/");metaBook.withsvg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image",
"1.1")||navigator.mimeTypes["image/svg+xml"];metaBook.svg=fdjt.DOM.checkSVG();w.getQuery("nosvg")?metaBook.svg=!1:w.getQuery("withsvg")&&(metaBook.svg=!0);metaBook.icon=function(a,b,c){return metaBook.root+"g/metabook/"+a+(metaBook.svg?".svgz":(b&&c?b+"x"+c:b?b+"w":c?c+"h":"")+".png")};var X=metaBook.icon;metaBook.getRefURI=function(a){for(;a&&a!==document;){if(a.getAttribute("data-refuri"))return a.getAttribute("data-refuri");if(a.getAttribute("refuri"))return a.getAttribute("refuri");a=a.parentNode}return metaBook.refuri};
metaBook.getDocURI=function(a){for(;a&&a!==document;){if(a.getAttribute("data-docuri"))return a.getAttribute("data-docuri");if(a.getAttribute("docuri"))return a.getAttribute("docuri");a=a.parentNode}return metaBook.docuri};metaBook.getRefID=function(a){return a.getAttributeNS?a.getAttributeNS("bookid")||a.getAttributeNS("data-bookid")||a.codexbaseid||a.id:a.id};metaBook.getTarget=function(a,b){a=a.nodeType?a:a.target||a.srcElement||a;var c=!1,d=!1,e=!1,f=metaBook.targetids,g=!1;if(t(a,metaBook.HUD))return!1;
for(;a;){if(a.metabookui)return!1;if(a===metaBook.docroot||a===document.body)return c;if((d=a.codexbaseid||a.id)&&(e=metaBook.docinfo[d])&&(d=e.frag||d,a.codexbaseid||0!==d.search("METABOOKTMP"))&&(!c||0!==d.search("WSN_")))if(0===d.search("WSN_"))g=a;else if(!(f&&0!==d.search(f)||M(a,"sbooknofocus")||metaBook.nofocus&&metaBook.nofocus.match(a))){if(M(a,"sbookfocus")||metaBook.focus&&metaBook.focus.match(a)||b)return a;if(c&&("SECTION"===a.tagName||a.className&&a.className.search&&0<=a.className.search(/\bhtml5section\b/i))||
c&&!fdjt.DOM.isVisible(a))return c;c||(c=a)}a=a.parentNode}return c||g};metaBook.getHead=function(a){var c=a.codexbaseid||a.id;if(c&&metaBook.docinfo[c])a=metaBook.docinfo[c];else if(c)for(;a;)if(a.id&&metaBook.docinfo[c]){a=metaBook.docinfo[c];break}else a=a.parentNode;else{for(var d=a.firstChild,e=a.nextNode;d&&d!==e&&!d.id&&!d.codexbaseid&&(3!==d.nodeType||A.isEmpty(d.nodeValue));)d=J.forward(d);if(d&&d.id&&d!==e)a=metaBook.docinfo[!1];else for(;a;)if((c=a.codexbaseid||a.id)&&metaBook.docinfo[c]){a=
metaBook.docinfo[c];break}else a=a.parentNode}return a?a.level?b(a.frag):a.head?b(a.head.frag):!1:!1};metaBook.getRef=function(a){for(;!(!a||a.about||a.getAttribute&&a.getAttribute("about"));)a=a.parentNode;if(a){var c=a.about||a.getAttribute("about");a.about||(a.about=c);return"#"===c[0]?b(c.slice(1)):b(c)}return!1};metaBook.getRefElt=function(a){for(;a&&!(a.about||a.getAttribute&&a.getAttribute("about"));)a=a.parentNode;return a||!1};metaBook.checkTarget=function(){metaBook.target&&"openglossmark"===
metaBook.mode&&!J.isVisible(metaBook.target)&&(metaBook.setMode(!1),metaBook.setMode(!0))};var S=!1;!fdjt.device.standalone&&fdjt.device.mobilesafari&&fdjt.addInit(g,"setupKludgeTimer");var oa=A.isEmpty,ga=!1;metaBook.ID=b;metaBook.getTitle=function(a,b){var d;return a.sbooktitle||((d=a.codexbaseid||a.id)&&metaBook.docinfo[d]?c(metaBook.docinfo[d].title):c(a.title))||b&&J.textify(a).replace(/\n(\s*\n)+/g,"\n").replace(/^\n+/,"").replace(/\n+$/,"").replace(/\n\n+/g," // ").replace(/\n/g," ").replace(/^\s*\/\//,
"")};metaBook.Info=function(a){return a?"string"===typeof a?metaBook.docinfo[a]||metaBook.glossdb.probe(a)||E.resolve(a):a._id?a:a.codexbaseid?metaBook.docinfo[a.codexbaseid]:a.id?metaBook.docinfo[a.id]:!1:!1};var ca=["","*","**","~","~~"];metaBook.getGlossTags=function(a){for(var b=[],c=0,d=ca.length;c<d;){var e=ca[c++],f=a[e+"tags"];if(f){f instanceof Array||(f=[f]);for(var g=0,h=f.length;g<h;){var l=f[g++];""===e?b.push(l):b.push({prefix:e,tag:l})}}}return b};metaBook.parseTag=function(a,b){var c=
"tags",d=b||metaBook.knodule;"~"===a[0]?(c="~tags",a=a.slice(1)):"*"===a[0]&&"*"===a[1]?(c="**tags",a=a.slice(2)):"*"===a[0]&&(c="*tags",a=a.slice(1));d=0<=a.indexOf("|")?d.handleSubjectEntry(a):"~tags"===c?b&&b.probe(a)||a:d.handleSubjectEntry(a);return"tags"!==c?{slot:c,tag:d}:d};var Ma=Knodule.addTags;metaBook.addTags=d;metaBook.setConnected=function(a){var b=document.documentElement||document.body;if(a&&!metaBook.connected){var c=metaBook._onconnect;metaBook._onconnect=!1;if(c&&c.length)for(var d=
0,e=c.length;d<e;)c[d++]();w.getLocal("mB("+C.docid+").queued")&&metaBook.writeQueuedGlosses()}(a&&!metaBook.connected||!a&&metaBook.connected)&&J.swapClass(b,/\b(_|cx)(CONN|DISCONN)\b/,a?"_CONN":"_DISCONN");metaBook.connected=a};metaBook.getTOCLevel=function(a,b){if(a.toclevel)return"none"===a.toclevel?a.toclevel=!1:a.toclevel;var c=a.getAttribute("toclevel")||a.getAttribute("data-toclevel");if(c)return"none"===c?!1:parseInt(c,10);if(a.className){c=a.className;if(0<=c.search(/\b(sbook|metabook|sb|mb)notoc\b/)||
0<=c.search(/\b(sbook|metabook|sb|mb)ignore\b/))return 0;var d=c.search(/\b(sbook|metabook|sb|mb)\d+(head|sect)\b/);if(0<=d)return parseInt(c.slice(d+5),10);if("number"===typeof b&&0<=c.search(/\b(sbook|metabook|sb|mb)subhead\b/))return b+1}return C.notoc&&C.notoc.match(a)||C.ignore&&C.ignore.match(a)?0:"undefined"===typeof metaBook.autotoc||metaBook.autotoc?0===a.tagName.search(/H\d/)?parseInt(a.tagName.slice(1,2),10):!1:!1};metaBook.getCoverPage=function(){if(metaBook.coverpage)return metaBook.coverpage;
var a=y("METABOOKCOVERPAGE")||y("SBOOKCOVERPAGE")||y("COVERPAGE");a&&(metaBook.coverpage=a);return a};var l=A.fillIn,aa=A.expandEntities;metaBook.fixStaticRefs=function(a){return l(aa(a).replace(/http(s)?:\/\/static.beingmeta.com\//g,metaBook.root),{bmg:metaBook.root+"g/",coverimage:metaBook.coverimage})};A.entities.beingmeta="<span class='beingmeta'>being<span class='bmm'>m<span class='bme'>e<span class='bmt'>t<span class='bma'>a</span></span></span></span></span>";A.entities.sBooks="<span class='sbooks'><em>s</em>Books</span>";
A.entities.sBook="<span class='sbooks'><em>s</em>Book</span>";A.entities.metaBooks="<span class='metabook'><span class='bmm'>m<span class='bme'>e<span class='bmt'>t<span class='bma'>a</span></span></span></span>Books</span>";A.entities.metaBook="<span class='metabook'><span class='bmm'>m<span class='bme'>e<span class='bmt'>t<span class='bma'>a</span></span></span></span>Book</span>";metaBook.urlType=function(a){return 0<a.search(/\.(jpg|jpeg)$/g)?"image/jpeg":0<a.search(/\.png$/g)?"image/png":0<a.search(/\.gif$/g)?
"image/gif":0<a.search(/\.wav$/g)?"audio/wav":0<a.search(/\.ogg$/g)?"audio/ogg":0<a.search(/\.mp3$/g)?"audio/mpeg":0<a.search(/\.mp4$/g)?"video/mp4":!1};metaBook.typeIcon=function(a,b){b||(b=64);return a?"audio/mpeg"===a?X("music",b,b):"image/"===a.slice(0,6)?X("photo",b,b):"audio/"===a.slice(0,6)?X("sound",b,b):X("diaglink",b,b):X("diaglink",b,b)};metaBook.mediaTypeClass=function(a){return a?"audio/mpeg"===a?"musiclink":"image/"===a.slice(0,6)?"imagelink":"audio/"===a.slice(0,6)?"audiolink":!1:!1}})();
fdjt.DOM.noautofontadjust=!0;fdjt.CodexLayout.dbname="metaBook";(function(){function a(b,c,f,g){g=g?" ("+g+")":"";if(1===arguments.length){metaBook.postconfig=[];d.config&&e("batch setConfig %s: %s",g,b);for(var h in b)b.hasOwnProperty(h)&&a(h,b[h]);h=metaBook.postconfig;metaBook.postconfig=!1;1<d.config&&!h&&0!==h.length&&e("batch setConfig, no post processing %s",b,g);for(var k=0,m=h.length;k<m;)1<d.config&&e("batch setConfig%s, post processing %s",h[k]),h[k++]()}else d.config&&e("setConfig%s %o=%o",g,b,c),D.hasOwnProperty(b)&&D[b]===c?d.config&&e("Redundant setConfig%s %o=%o",
g,b,c):(w[b]?(d.config&&e("setConfig%s (handler=%s) %o=%o",g,w[b],b,c),w[b](b,c)):d.config&&e("setConfig%s (no handler) %o=%o",g,b,c),D[b]=c),f&&J[b]!==c&&(J[b]=c,n(J))}function n(g){d.config&&(e("saveConfig %o",g),e("saved_config=%o",J));g?a(g):g=J;var h={},k;for(k in g)f.hasOwnProperty(k)&&g[k]!==f[k]&&!c(k)&&(h[k]=g[k]);d.config&&e("Saving config %o",h);A("mB("+b.docid+").config",JSON.stringify(h));J=h}function h(a,b){for(var c=m.$(".metabooksettings"),d=0,e=c.length;d<e;){for(var f=c[d++],f=p(f,
"input[type='CHECKBOX'],input[type='RADIO']"),g=[],h=[],k=0,n=f.length,q=!1;k<n;)q=f[k++],q.name===a&&((!0===b?/(yes|on|true)/i.exec(q.value):q.value===b)?g.push(q):h.push(q));k=0;for(n=g.length;k<n;)q=g[k++],q.checked||(G(q,".checkspan")?fdjt.UI.CheckSpan.set(q,!0):q.checked=!0);k=0;for(n=h.length;k<n;)if(q=h[k++],q.checked||"undefined"===typeof q.checked)G(q,".checkspan")?fdjt.UI.CheckSpan.set(q,!1):q.checked=!1;k=0;for(n=g.length;k<n;)q=g[k++],q.checked||(G(q,".checkspan")?fdjt.UI.CheckSpan.set(q,
!0):q.checked=!0)}}var m=fdjt.DOM,e=fdjt.Log,v=fdjt.UI,k=fdjt.State,x=fdjt.Time,p=m.getChildren,u=m.getMeta,q=fdjt.String.isEmpty,g=k.getLocal,c=k.getQuery,b=metaBook,d=metaBook.Trace,A=b.saveLocal,w={},f=metaBook.default_config,D={},J={};metaBook.addConfig=function(a,b){1<d.config&&e("Adding config handler for %s: %s",a,b);w[a]=b;D.hasOwnProperty(a)&&(1<d.config&&e("Applying config handler to current %s=%s",a,D[a]),b(a,D[a]))};metaBook.getConfig=function(a){return a?D[a]:D};metaBook.setConfig=a;
metaBook.resetConfig=function(){a(J)};metaBook.saveConfig=n;metaBook.initConfig=function(){var h,m,n,p=x(),I=g("mB("+b.docid+").config",!0)||k.getSession("mB("+b.docid+").config",!0);metaBook.postconfig=[];if(I)for(h in d.config&&e("initConfig local=%j",I),I)I.hasOwnProperty(h)&&(c(h)?(m=c(h),n="initConfig/QUERY"):(m=I[h],n="initConfig/local"),a(h,m,!1,n),metaBook.updateSettings(h,m));else I={};d.config&&e("initConfig default=%j",f);for(h in f)!f.hasOwnProperty(h)||I.hasOwnProperty(h)||c(h)||(u("METABOOK."+
h)?(m=u("METABOOK."+h),n="initConfig/HTML"):(m=f[h],n="initConfig/appdefaults"),a(h,m,!1,"initConfig/HTML"),a(h,m,!1,n),metaBook.updateSettings(h,m));h=metaBook.postconfig;metaBook.postconfig=!1;m=0;for(n=h.length;m<n;)h[m++]();(h=D.devicename)&&!q(h)&&(metaBook.deviceName=h);1<d.startup&&e("initConfig took %dms",x()-p)};var G=m.getParent,y=m.getChild;metaBook.updateConfig=function(b,c,f){"undefined"===typeof f&&(f=!1);c="string"===typeof c&&document.getElementById(c)||c.nodeType&&G(c,"input")||c.nodeType&&
y(c,"input")||c.nodeType&&y(c,"textarea")||c.nodeType&&y(c,"select")||c;d.config&&e("Update config %s",b);"radio"===c.type||"checkbox"===c.type?a(b,c.checked||!1,f,"updateConfig/checked"):a(b,c.value,f,"updateConfig/input")};metaBook.propConfig=function(a,b){metaBook[a]=b};metaBook.addConfig("keyboardhelp",function(a,b){metaBook.keyboardhelp=b;v.CheckSpan.set(document.getElementsByName("METABOOKKEYBOARDHELP"),b)});metaBook.addConfig("devicename",function(a,b){q(b)?metaBook.deviceName=!1:metaBook.deviceName=
b});metaBook.addConfig("holdmsecs",function(a,b){metaBook.holdmsecs=b;v.TapHold.default_opts.holdmsecs=b});metaBook.addConfig("wandermsecs",function(a,b){metaBook.wandermsecs=b;v.TapHold.default_opts.wanderthresh=b});metaBook.addConfig("taptapmsecs",function(a,b){metaBook.taptapmsecs=b;v.TapHold.default_opts.taptapmsecs=b});metaBook.addConfig("checksync",function(a,b){metaBook.sync_interval=b;metaBook.synctock&&(clearInterval(metaBook.synctock),metaBook.synctock=!1);b&&metaBook.locsync&&(metaBook.synctock=
setInterval(metaBook.syncState,1E3*b))});metaBook.addConfig("synctimeout",function(a,b){metaBook.sync_timeout=b});metaBook.addConfig("syncpause",function(a,b){metaBook.sunc_pause=b});metaBook.addConfig("locsync",function(a,b){!b&&metaBook.synctock?(clearInterval(metaBook.synctock),metaBook.synctock=!1):b&&!metaBook.synctock&&metaBook.sync_interval&&(metaBook.synctock=setInterval(metaBook.syncState,1E3*metaBook.sync_interval));metaBook.locsync=b;fdjt.Async(function(){metaBook.updateSettings(a,b)})});
metaBook.configChange=function(b){b=b||window.event;b=v.T(b);var c=b.name,d=b.value,e=D[c];b.checked&&e===d||(b.checked?a(c,d,!0,"configChange"):"checkbox"===b.type&&a(c,"",!0,"configChange"))};metaBook.applyMetaClass=function(a,b){b||(b=a);for(var c=u(b,!0),d=0,e=c.length;d<e;)m.addClass(m.$(c[d++]),a)};metaBook.updateSettings=h;metaBook.initSettings=function(){var a=x(),b;for(b in D)D.hasOwnProperty(b)&&h(b,D[b]);1<d.startup&&e("Finished initSettings in %dms",x()-a)}})();(function(){function a(a){var d;if(a){d="string"===typeof a?D(f(d))||metaBook.content:a;for(var e=d.codexbaseid||d.id,g=metaBook.docinfo[e];g&&!g.level;)g=g.head,e=g.frag,d=f(e);1<G.nav&&g?q("metaBook.setHead #%s %o from %o info=%o:\n%j",e||"none",d,a,g,g):G.nav&&q("metaBook.setHead #%s %o from %o",e||"none",d,a);d===metaBook.head?G.target&&q("Redundant SetHead"):g?(G.target&&metaBook.trace("metaBook.setHead",d),window.title=g.title+" ("+document.title+")",metaBook.head&&c(metaBook.head,"bookhead"),
b(d,"bookhead"),metaBook.setLocation(metaBook.location),metaBook.head=f(e),metaBook.TOC.setHead(g)):(G.target&&metaBook.trace("metaBook.setFalseHead",d),metaBook.TOC.setHead(!1),metaBook.head=!1)}}function n(a,b){if(b||metaBook.location!==a){G.toc&&q("Setting location to %o",a);for(var c=metaBook.Info(metaBook.head);c;){var d=document.getElementById("MBTOC4"+c.frag),e=c.head,f=c.starts_at,g=c.ends_at,e=100*(a-f)/(e&&e.ends_at-e.starts_at),h=!1;d&&(h=x.getFirstChild(d,".mbtoc_posbar"));G.toc&&q("For tocbar %o/%o loc=%o start=%o end=%o progress=%o",
h,!1,a,f,g,e);0<=e&&100>=e&&h&&(h.style.width=e+"%");c=c.head}metaBook.location=a}}function h(a){G.target&&metaBook.trace("metaBook.setTarget",a);if(a!==metaBook.target&&(!metaBook.target||metaBook.target.id!==a.codexbaseid)){if(metaBook.target){var d=metaBook.target,g=y(d.id);c(d,"mbtarget");c(d,"mbnewtarget");c(g,"mbtarget");c(g,"mbnewtarget");A(d,a)||m(g);metaBook.target=!1}if(!a)metaBook.UI.setTarget&&metaBook.UI.setTarget(!1);else if(!e(a)&&(a.id||a.codexbaseid)){var g=(d=a.codexbaseid||a.id)&&
f(d)||a,h=y(d);b(a,"mbtarget");b(a,"mbnewtarget");b(h,"mbtarget");b(h,"mbnewtarget");setTimeout(function(){c(a,"mbnewtarget");c(h,"mbnewtarget")},3E3);u.setCookie("mbtarget",d||a.getAttribute("data-bookid"));metaBook.target=g;metaBook.UI.setTarget&&metaBook.UI.setTarget(g);metaBook.empty_cloud&&metaBook.setCloudCuesFromTarget(metaBook.empty_cloud,g)}}}function m(a){"string"===typeof a&&(a=f(a));if(a)if(a.length){c(a,"mbhighlightpassage");for(var b=0,d=a.length;b<d;){var e=a[b++];g.Highlight.clear(e,
"mbhighlightexcerpt");g.Highlight.clear(e,"mbhighlightsearch")}}else c(a,"mbhighlightpassage"),g.Highlight.clear(a,"mbhighlightexcerpt"),g.Highlight.clear(a,"mbhighlightsearch")}function e(a){if(a.metabookui||A(a,metaBook.HUD))return!0;for(;a;){if(a.metabookui||d(a,O))return!0;a=a.parentNode}return!1}function v(a){for(var b=!1,c=0,d=x.forward;a&&200>c&&(!(b=a.codexbaseid||a.id)||!metaBook.docinfo[b]);)c++,a=d(a);return b&&metaBook.docinfo[b]?(a=metaBook.docinfo[b],{start:a.starts_at,end:a.ends_at,
len:a.ends_at-a.starts_at}):!1}function k(a){for(var b=metaBook.docinfo._allinfo,c=0,d=b.length;c<d;)if(b[c].starts_at<a)c++;else break;for(;c<d&&!(b[c].starts_at>a);)c++;return f(b[c-1].frag)}var x=fdjt.DOM,p=fdjt.String,u=fdjt.State,q=fdjt.Log,g=fdjt.UI,c=x.dropClass,b=x.addClass,d=x.hasClass,A=x.hasParent,w=metaBook,f=w.ID,D=w.getHead,J=w.getTarget,G=metaBook.Trace,y,E,F;metaBook.inits.push(function(){y=metaBook.getDups;E=metaBook.saveState;F=metaBook.setHistory});metaBook.setHead=a;metaBook.setLocation=
n;metaBook.location2pct=function(a){var b=metaBook.ends_at;a=100*a/b;100<a&&(a=100);b=Math.round(Math.log(b/40)/Math.log(10))-2;0>b&&(b=0);return Math.floor(a)===a?Math.floor(a)+"%":p.precString(a,b)+"%"};metaBook.setTarget=h;metaBook.clearHighlights=m;metaBook.findExcerpt=function(a,b,c){"string"===typeof a&&(a=f(a));if(!a)return!1;a.nodeType&&(a=y(a));var d=p.trim(b),e=0===d.search(/[.,"']/)?"(^|\\s)":"\\b",g=0<d.search(/[.,"']$/)?"($|\\s)":"\\b";b=x.textRegExp(d,!1,!0,e,g);var h=x.findMatches(a,
b,c||0,1);h&&0!==h.length||(b=x.textRegExp(d,!0,!0,e,g),h=x.findMatches(a,b,c||0,1));if(h&&h.length)return h[0];d=!1;e=-1;for(h=x.findMatches(a,b,0,1);0<h.length;){h=h[0];if(h.start_offset>c)return 0>e?d:c-e<d.start_offset-c?d:h;d=h;e=h.start_offset;h=x.findMatches(a,b,h.endOffset+1,1)}return h&&h.length?h[0]:d};var O=/(\bhud\b)|(\bglossmark\b)|(\bleading\b)/;metaBook.inUI=e;metaBook.setHashID=function(a){var b=a.codexbaseid||a.id;b&&window.location.hash!==b&&("#"!==window.location.hash[0]||window.location.hash.slice(1)!==
b)&&a!==metaBook.body&&a!==document.body&&b&&(window.location.hash=b)};metaBook.getLocInfo=v;metaBook.resolveLocation=k;metaBook.GoTo=function(b,c,d,g,m){"undefined"===typeof d&&(d=!0);"undefined"===typeof g&&(g=!0);var p,u;g&&metaBook.clearStateDialog();if(b){if("string"===typeof b)p=f(b),u=v(p),u=u.start;else if("number"===typeof b)u=b,p=d&&(d.nodeType&&d.id?d:k(b));else if(b.target&&(b.location||b.offset))p=J(b.target),b.location?u=b.location:(u=v(b.target),u=u.start+b.offset);else if(b.nodeType)p=
J(b),u=v(b),u=u.start;else{q.warn("Bad metabookGoTo %o",b);return}d&&d.nodeType?p=d:"string"===typeof d&&f(d)&&(p=f(d));var y=p&&metaBook.docinfo[p.getAttribute("data-baseid")||p.id];u&&y&&y.ends_at&&y.starts_at&&(u>y.ends_at||u<y.starts_at)&&(u=!1);var D=metaBook.bypage&&metaBook.layout&&metaBook.getPage(p,u),B=D&&parseInt(D.getAttribute("data-pagenum"),10);w.Trace.nav&&q("mB.GoTo(%s%s%s%s%s) %o location=%o page=%o pageno=%d arg=%o",c||"",c?":":"",d?"t":"",g?"s":"",m?"":"h",p,u?u:"none",D,B,b);if(p)b=
p.codexbaseid||p.id,G.nav&&q("metaBook.GoTo%s() #%o@P%o/L%o %o",c?"/"+c:"",b,B,y&&y.starts_at,p),y&&(metaBook.point=p,metaBook.hudup||metaBook.mode||(metaBook.skimpoint=!1)),a(p),n(u),d&&b&&!e(p)&&h(p),g&&d?metaBook.saveState({target:p.getAttribute("data-baseid")||p.id,location:u,page:B,npages:metaBook.pagecount},m):g?metaBook.saveState({location:u,page:B,npages:metaBook.pagecount},m):m||F({target:p.getAttribute("data-baseid")||p.id,location:u,page:B,npages:metaBook.pagecount}),D?metaBook.GoToPage(D,
c||"metabookGoTo",!1,!0):(metaBook.previewing&&metaBook.stopPreview(c?"goto/"+c:"goto",p),c=x.getGeometry(p,metaBook.content).top-(x.viewHeight()-50)/2,0>c&&(c=0),window.scrollTo(0,c)),metaBook.clearGlossmark&&metaBook.clearGlossmark(),metaBook.location=u;else{if(metaBook.layout instanceof fdjt.CodexLayout)metaBook.GoToPage(b,c,g);else if(b.nodeType){for(c=b;c&&!c.offsetTop;)c=c.parentNode;c&&(metaBook.content.style.offsetTop=-c.offsetTop)}metaBook.curpage?E({location:metaBook.location,page:metaBook.curpage,
npages:metaBook.pagecount},!0):E({location:metaBook.location},!0)}}else q.warn("falsy arg (%s) to metabookGoTo from %s",b,c)};metaBook.anchorFn=function(a){for(var b=g.T(a);b&&!b.href;)b=b.parentNode;b&&b.href&&"#"===b.href[0]&&(b=f(b.href.slice(1)))&&(metaBook.GoTo(b,"anchorFn"),g.cancel(a))};metaBook.JumpTo=function(a){metaBook.hudup&&metaBook.setMode(!1);metaBook.GoTo(a,"JumpTo")};metaBook.GoTOC=function(a){a&&metaBook.GoTo(a,"GoTOC")}})();metaBook.DOMScan=function(){function a(g,c,b){function d(a,c){if(b[a])return b[a];u.call(this,a,C);var d=v();this._live=this._changed=d;C.changes.push(this);C.changed=d;this.frag=a;b[a]=this;c.allinfo.push(this);c.locinfo.push(c.location);return this}function A(a,b){var c="undefined"===typeof b;b||(b="");if(3===a.nodeType)return b+a.nodeValue;if(1===a.nodeType){var d=y(a).position;if(c||""===d||"static"===d)for(var c=a.childNodes,d=0,e=c.length;d<e;){var f=c[d++];3===f.nodeType?b+=f.nodeValue:1===
f.nodeType&&(b=A(f,b))}}return b}function w(a){if(3===a.nodeType)return a.nodeValue.length;if(1!==a.nodeType)return 0;if(a.getAttribute("data-loclen"))return parseInt(a.getAttribute("data-loclen"),10);a=a.childNodes;for(var b=0,c=0,d=a.length;c<d;){var e=a[c++];3===e.nodeType?b+=e.nodeValue.length:1===e.nodeType&&(b+=w(e))}return b}function f(a){var b=!1;if((0===a.tagName.search(/p|h\d|blockquote|li/i)||0===y(a).display.search(/block|list-item|table|table-row/))&&a.childNodes&&a.childNodes.length&&
(b=J(a))){var c="WSN_"+b,b=c,d=1;if("WSN_"!==c){for(;O[b]||document.getElementById(b);)b=c+"_"+d++;c!==b&&(c=x.textify(a),k.warn("Duplicate WSN ID %s: %s",b,c));a.id=b;O[b]=a;return b}}}function D(a,b,c){var e=b.location,f=b.curhead,g=b.curinfo,m=b.curlevel;F||(F=n.baseid);b.nodecount++;if(3===a.nodeType)return c=G(a.nodeValue).length,b.location+=c,0;if(1!==a.nodeType)return 0;var p=a.tagName,u=a.className,y=a.id;y&&0===y.search(F)||(y=a.getAttribute("data-tocid")||a.id);if(!(metaBook.ignore&&metaBook.ignore.match(a)||
E&&a.namespaceURI!==E||u&&("string"!==typeof u||0<=u.search(/\b(metabookignore)\b/))||a.metabookui||y&&0===y.search("METABOOK"))){3<h.domscan&&k("Scanning %o level=%o, loc=%o, head=%o: %j",a,m,e,f,g);if(!y&&!F)M.push(a);else if(y)if(O[y])if(O[y]!==a){e=y+"x"+b.location;if(O[y]){for(var l=1,K=e+"x"+l;O[K];)l++,K=e+"x"+l;e=K}k.warn("Duplicate ID=%o newid=%o",y,e);y=a.id=e;c[e]||(c[e]=new d(e,b));O[e]=a}else O[y]=a;else O[y]=a;K=0;if((e=a.metabooktocloc||a.getAttribute("data-tocloc"))&&c[e]){u=c[e];
m=b.curlevel;f=b.curhead;g=b.curinfo;e=b.notoc;u=u.head;b.curinfo=u;b.curhead=u.elt||document.getElementById(u.frag);b.curlevel=u.level;b.notoc=!0;a=a.childNodes;K=0;for(u=a.length;K<u;)l=a[K++],1===l.nodeType&&D(l,b,c);b.curlevel=m;b.notoc=e;b.curhead=f;b.curinfo=g}else{e=q(a,m);l=!1;e&&!y&&M.push(a);y&&!(l=c[y])&&(T.push(y),l=new d(y,b),c[y]!==l&&window.alert("Wrong"),c[y]=l,l.elt=a);if(b.notoc||"header"===p)b.notoc=!0,e=0;b.eltcount++;l&&y&&a.id&&a.id!==y&&(l.addAlias(a.id),c[a.id]=l);l&&(l.starts_at=
b.location,l.bookhead=f.getAttribute("data-tocid")||f.id,l.headstart=g.starts_at);y&&l&&!I&&(metaBook.start=I=a);l&&e&&!l.toclevel&&(l.toclevel=e);y&&l&&(K=a.getAttribute("tags")||a.getAttribute("data-tags"))&&(l.atags=K.split(","));if(!(u&&u.search&&0<=u.search(/\b(sbook|pubtool)ignore\b/)||metaBook.ignore&&metaBook.ignore.match(a))){if(y&&e){p=y;K=e;y=m;m=c[p]||(c[p]=new d(p,b));b.headcount++;t.push(p);1<h.domscan&&k("Scanning head item %o under %o at level %d w/id=#%s ",a,f,K,p);m.starts_at=b.location;
m.level=K;m.elt=a;m.sub=[];m.frag=p;p=a.toctitle||a.getAttribute("toctitle")||a.getAttribute("data-toctitle")||a.title;if(!p){var z=x.getFirstChild(a,"H1,H2,H3,H4,H5,H6");z&&(p=z.toctitle||z.getAttribute("toctitle")||z.getAttribute("data-toctitle")||z.title);p=!p&&z?A(z):A(a)}"string"===typeof p?(p=G(p),p=""===p?!1:p):p=x.textify(p,!0);m.title=p;m.next=!1;m.prev=!1;m.sectag=m.title?"\u00a7"+G(m.title):"\u00a7Anonymous Section";if(K>y)m.head=g,m.indexRef("head",g),g.intro_ends_at||(g.intro_ends_at=
b.location),g.sub.push(m),b.lastlevel===K&&(m.prev=b.lastinfo,b.lastinfo.next=m,delete b.lastlevel,delete b.lasthead,delete b.lastinfo);else{y=g;for(g=g.level;y;){2<h.domscan&&k("Finding head@%d: s=%o, i=%j, sh=%o, cmp=%o",g,f||!1,y,g<K);if(!g||g<K)break;else if(y===U)break;else if(y.head&&y.head.level&&y.head.level>=g){k.warn("Corrupted TOCINFO at %o",a);break}else K===g&&(m.prev=y,y.next=m);y.ends_at=b.location;b.tagstack=b.tagstack.slice(0,-1);y=y.head;f=y.elt||document.getElementById(y.frag);
g=y?y.level:0}2<h.domscan&&k("Found parent: up=%o, info=%o, leel=%d, sh=%o",f||!1,y,y.level,y.head);m.head=y;m.indexRef("head",y);y.sub.push(m)}g=m.head;f=[];g.heads&&(f=f.concat(g.heads));g&&f.push(g);m.heads=f;m.indexRef("heads",f);2<h.domscan&&k("@%d: Found head=%o, headinfo=%o, book_head=%o",b.location,a,m,m.head);b.curhead=a;b.curinfo=m;b.curlevel=K;m&&(m.ends_at=b.location+w(a));b.location+=w(a)}else l&&(l.head=g,l.indexRef("head",g));if(l&&(m=a.getAttribute("data-altid")))for(m=m.split(" "),
g=0,f=m.length;g<f;)K=m[g++],c[K]||(l.addAlias(K),c[K]=l);if(u&&u.search&&0<=u.search(/\b(sbook|pubtool)terminal\b/)||u&&metaBook.terminals&&metaBook.terminals.match(a))b.location+=w(a);else for(m=a.childNodes,K=0,u=m.length;K<u;)g=m[K++],3===g.nodeType?(g=G(g.nodeValue),b.location+=g.length):1===g.nodeType&&D(g,b,c);l&&(l.ends_at=b.location);e&&(b.lasthead=a,b.lastinfo=l,b.lastlevel=e)}}}}var J=fdjt.WSN.md5ID,G=m.stdspace,y=x.getStyle,E=g.namespaceURI,F=n.baseid,O={},M=[];if("undefined"===typeof g)return this;
b||(b=this instanceof a?this:new a);g||(g=metaBook.docroot||document.body);var I=new Date,t=[],T=[];b._root=g;b._heads=t;b._ids=T;g.id||(g.id="METABOOKROOT");if(1<h.startup||h.domscan)g.id?k("Scanning %s#%s for structure and metadata",g.tagName,g.id):k("Scanning DOM for structure and metadata: %o",g);var K=g.childNodes,P={curlevel:0,idserial:0,location:0,nodecount:0,eltcount:0,headcount:0,tagstack:[],taggings:[],allinfo:[],locinfo:[],idmap:O,idstate:{prefix:!1,count:0},idstack:[{prefix:!1,count:0}],
pool:metaBook.docdb},C=new p(c);d.prototype=new u;d.prototype._id=d.prototype._domain=d.prototype._db=d.prototype.frag=d.prototype._live=d.prototype._changed=d.prototype.starts_at=d.prototype.ends_at=d.prototype.head=d.prototype.headstart=d.prototype.elt=d.prototype.title=d.prototype.bookhead=!1;C.refclass=d;b._docdb=C;var U=b[g.id]||(b[g.id]=new d(g.id,P));P.curhead=g;P.curinfo=U;U.title=g.title||document.title;U.starts_at=0;U.level=0;U.sub=[];U.head=!1;U.heads=[];U.frag=g.id;U.elt=g;P.allinfo.push(U);
P.allinfo.push(0);for(c=0;c<K.length;){var V=K[c++];V.sbookskip||V.metabookui||D(V,P,b)}b._nodecount=P.nodecount;b._headcount=P.headcount;b._eltcount=P.eltcount;b._maxloc=P.location;b._allinfo=P.allinfo;b._locinfo=P.locinfo;for(K=P.curinfo;K;)K.ends_at=P.location,K=K.head;K=new Date;(h.startup||h.domscan)&&k("Gathered metadata in %f secs over %d heads, %d nodes",(K.getTime()-I.getTime())/1E3,P.headcount,P.eltcount);b.addContent=function(a){D(a,P,b);b._nodecount=P.nodecount;b._headcount=P.headcount;
b._eltcount=P.eltcount;b._maxloc=P.location;b._allinfo=P.allinfo;b._locinfo=P.locinfo;for(a=P.curinfo;a;)a.ends_at=P.location,a=a.head};M.length&&e.slowmap(f,M);b._rootinfo=b[g.id];return b}var n=metaBook,h=n.Trace,m=fdjt.String,e=fdjt.Async,v=fdjt.Time,k=fdjt.Log,x=fdjt.DOM,p=fdjt.RefDB,u=p.Ref,q=metaBook.getTOCLevel;a.prototype.toJSON=function(){var a={constructor:"metaBook.DOMScan",frag:this.frag,head:this.bookhead,start:this.starts_at,end:this.ends_at};this.WSNID&&(a.WSNID=this.WSNID);this.headstart&&
(a.headstart=this.headstart);this.toclevel&&(a.toclevel=this.toclevel);this.title&&(a.title=this.title);return JSON.stringify(a)};a.getTOCLevel=q;return a}();(function(){function a(a){return new Promise(function(b,c){if(0===a.search(d.cachelink)){if(w[a])return b(w[a]);if("cached"!==f[a])if(f[a])D[a]?D[a].push(b):D[a]=[b];else{f[a]="fetching";var g=new XMLHttpRequest,h,k;G&&J?(h=a,k="blob"):(h="https://glossdata.bookhub.io/U/"+a.slice(29),k="");var m=d.mycopyid;m&&(h=h+"?MYCOPYID="+encodeURIComponent(m)+"&DOC="+encodeURIComponent(d.docref));A.glossdata&&x("Fetching glossdata %s (%s) to cache locally",a,k);g.onreadystatechange=function(){if(4===g.readyState&&
200===g.status)try{var d=!1,m=!1;A.glossdata&&x("Glossdata from %s (%s) status %d",h,k||"any",g.status);"blob"!==k?m=d=g.responseText:d=J?J(g.response):!1;d&&e(a,d,b);if(m)f[a]="caching",v(a,m);else{var p=new FileReader(g.response);f[a]="reading";p.onload=function(){try{d||e(a,p.result,b),f[a]="caching",v(a,p.result)}catch(c){x.warn("Error encoding %s from %s: %s",a,h,c),f[a]=!1}};p.readAsDataURL(g.response)}}catch(n){x.warn("Error fetching %s via %s: %s",a,h,n),f[a]=!1,c&&c(n)}else 4===g.readyState&&
(x.warn("Error (%d) fetching %s via %s",g.status,a,h),f[a]=!1,c&&c(g))};g.open("GET",h);g.responseType=k;g.send(null)}}})}function n(b){if(!w[b]&&"cached"!==f[b]){if(navigator.onLine)return d.mycopyid&&d.mycopyid_expires<new Date?a(b).catch(function(){h(b)}):d.getMyCopyId().then(function(c){if(c)return a(b).catch(function(a){x("Couldn't cache %s: %o",b,a);h(b)});h(b)}).catch(function(){h(b)});0===E.length&&fdjt.DOM.addListener(window,"online",m);0>E.indexOf(b)&&E.push(b)}}function h(a){E.push(a);
y||(y=setTimeout(m,6E4))}function m(){if(navigator.onLine&&E.length){y&&(clearTimeout(y),y=!1);var a=E;E=[];for(var b=0,c=a.length;b<c;)n(a[b++])}}function e(a,b,c){var e,f=d.srcloading[a],g=D[a];d.srcloading[a]=!1;D[a]=!1;w[a]=b;c&&c(b);if(f)for(c=0,e=f.length,A.glossdata&&x("Setting glossdata src for %d element(s)",e);c<e;)f[c++].src=b;if(g){c=0;for(e=g.length;c<e;)g[c++](b);d.srcloading[a]=!1}}function v(a,b){var e="gD("+a+").glossdata";metaBook.getDB().then(function(e){e=e.transaction(["glossdata"],
"readwrite").objectStore("glossdata").put({url:a,datauri:b});var g=!1;e.onerror=function(b){f[a]=!1;g=!0;x("Error saving %s in indexedDB: %o",a,b.target.errorCode)};e.onsuccess=function(){f[a]="cached";g=!0;A.glossdata&&x("Saved glossdata for %s in IndexedDB",a);A.glossdata&&x("GlossData cached for %s",a);c("mB("+d.docid+").glossdata",a)};if("done"===e.status&&!g)e.onsuccess()}).catch(function(){u(e,b)})}function k(a,c){return new Promise(function(d){metaBook.getDB().then(function(e){e.transaction(["glossdata"],
"readwrite").objectStore("glossdata").openCursor().onsuccess=function(e){var f=e.target.result;if(f)if(0<=a.indexOf(f.key))e=f["delete"](),e.onsuccess=function(){b(c,f.key);f["continue"]()},e.onerror=function(){f["continue"]()};else f["continue"]();else d()}})})}var x=fdjt.Log,p=fdjt.State,u=p.setLocal,q=p.getLocal,g=p.dropLocal,c=p.pushLocal,b=p.removeLocal,d=metaBook,A=metaBook.Trace,w=metaBook.glossdata,f={},D={},J=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL,
G=window.Blob;metaBook.setupGlossData=function(){for(var a=q("mB("+d.docid+").glossdata",!0),b=0,c=a.length;b<c;)f[a[b++]]="cached"};var y=!1,E=[];metaBook.needGlossData=n;metaBook.getGlossData=function(b){function c(e,f){d.mycopyid&&d.mycopyid_expires<new Date?setTimeout(function(){a(b).then(e).catch(f)},2E3):d.getMyCopyId().then(function(c){c?setTimeout(function(){a(b).then(e).catch(f)},2E3):f(Error("Couldn't get MYCOPYID"))}).catch(f)}return new Promise(function(a,d){if(w[b])a(w[b]);else return"cached"===
f[b]?metaBook.getDB().then(function(g){g=g.transaction(["glossdata"],"readwrite").objectStore("glossdata").get(b);g.onsuccess=function(g){if(g=g.target.result)e(b,g.datauri,a);else return x("Corrupted local glossdata cache for %s",b),f[b]=!1,c(a,d)};g.onerror=function(e){x("Error getting %s from glossdata cache: %s",b,e);f[b]=!1;return c(a,d)}}).catch(d):c(a,d)})};metaBook.clearGlossData=function(a){a="mB("+a+").glossdata";var b=q(a,!0);b&&b.length?k(b,a):g(a)}})();(function(){function a(){p("Executing %s",y.value);var a=eval(y.value),a=a.nodeType?u("%o",a):u("%j",a);p("Result is %s",a)}function n(b){1<D.gesture&&p("consolebutton_click %o",b);a()}function h(b){b=b||window.event;13!==b.keyCode||b.ctrlKey||(q.cancel(b),a(),b.shiftKey&&(y.value=""))}function m(a){a.id&&0===a.id.search("METABOOK")&&a.removeAttribute("style");if(a.childNodes){a=a.childNodes;for(var b=0,c=a.length;b<c;){var d=a[b++];1===d.nodeType&&m(d)}}}function e(a,b){for(var c=F(a.childNodes),
d=0,e=c.length;d<e;){var f=c[d++];if(1===f.nodeType&&(f.id===b.id||f.id===b.id+"HOLDER")){a.replaceChild(b,f);return}}a.appendChild(b)}function v(a){var b=q.T(a),d=c("METABOOKCOVER");metaBook.statedialog&&(fdjt.Dialog.close(metaBook.statedialog),metaBook.statedialog=!1);if(!fdjt.UI.isClickable(b)){if(w(b,c("METABOOKCOVERCONTROLS")))return k(a,b,d);w(b,".scrolling")||(metaBook.clearStateDialog(),metaBook.hideCover(),q.cancel(a))}}function k(a,b,d){for(;b&&b!==document.body&&!b.getAttribute("data-mode");)b=
b.parentNode;var e=b.getAttribute("data-mode");"layers"!==e||c("BOOKHUBAPP").src||metaBook.appinit||metaBook.initIFrameApp();var f=d.className,g=f&&O[f]&&c(O[f]),h=e&&O[e]&&c(O[e]);g&&h&&(g.style.display="block",h.style.display="block",setTimeout(function(){g.style.display="";h.style.display=""},3E3));setTimeout(function(){D.mode&&p("On %o, switching cover mode to %s from %s",a,e,f);"console"===e&&p.update();d.className=e;metaBook.mode=e},20);fdjt.UI.cancel(a);return!1}var x=fdjt.DOM,p=fdjt.Log,u=
fdjt.String,q=fdjt.UI,g=fdjt.Time,c=fdjt.ID,b=x.dropClass,d=x.addClass,A=x.hasClass,w=x.hasParent,f=x.getChildren,D=metaBook.Trace,J=metaBook.fixStaticRefs,G=x.hasContent,y=!1,E=!1;metaBook.setupCover=function(){var a=c("METABOOKFRAME"),b=g(),k=x("div#METABOOKCOVER.metabookcover"),q=c("METABOOKCOVER");2<D.startup&&p("Setting up cover");a||(a=x("div#METABOOKFRAME"),x.prepend(document.body,a));metaBook.Frame=a;metaBook.cover=k;k.innerHTML=J(metaBook.HTML.cover);var u=c("METABOOKCOVERPAGE");u?G(u,!0)||
(u.removeAttribute("style"),u=!1):metaBook.coverimage?(u=x.Image(metaBook.coverimage),u.id="METABOOKCOVERIMAGE",u=x("div.flap#METABOOKCOVERPAGE",u)):u=!1;if(u)k.setAttribute("data-defaultclass","coverpage"),d(k,"coverpage"),e(k,u);else{var w=fdjt.DOM.getChild(k,"#METABOOKCOVERCONTROLS");k.setAttribute("data-defaultclass","titlepage");d(k,"titlepage");d(w,"nocoverpage")}(w=c("METABOOKTITLE"))&&G(w,!0)?(w=w.cloneNode(!0),w.removeAttribute("style"),w.id="METABOOKTITLE"):(w=c("METABOOKTITLEPAGE")||c("PUBTOOLTITLEPAGE")||
c("TITLEPAGE"))?(w=w.cloneNode(!0),x.dropClass(w,/\b(codex|metabook)[A-Za-z0-9]+\b/),x.addClass(w,"sbooktitlepage"),x.stripIDs(w),w.setAttribute("style",""),w.id="METABOOKTITLE"):(w=metaBook.getBookInfo(),w=x("div#METABOOKTITLE.flap",x("DIV.title",w.title),x("DIV.credits",w.byline?x("DIV.byline",w.byline):w.authors&&w.authors.length?x("DIV.author",w.authors[0]):!1),x("DIV.pubinfo",w.publisher&&x("P",w.publisher))));w&&e(k,w);if(w=c("METABOOKCREDITS"))w=w.cloneNode(!0);else if(w=c("METABOOKCREDITS")||
c("SBOOKSCREDITSPAGE")||c("CREDITSPAGE"))w=w.cloneNode(!0),x.stripIDs(w),w.removeAttribute("style");if(w&&G(w,!0)){var C=k.getElementById("METABOOKCREDITS");C?C.parentNode.replaceChild(w,C):k.appendChild(w)}else w=!1;w&&e(k,w);if((C=c("METABOOKBLURB")||c("METABOOKABOUTPAGE"))&&G(C,!0))C=C.cloneNode(!0),C.id="METABOOKBLURB",C.removeAttribute("style");else var C=c("METABOOKABOUTPAGE")||c("METABOOKABOUTBOOK")||c("PUBTOOLABOUTBOOK"),A=c("METABOOKABOUTAUTHOR")||c("PUBTOOLABOUTAUTHOR"),C=C||A?x("div#METABOOKBLURB.flap.metabookblurb.scrolling",
"\n",C,"\n",A,"\n"):!1;C&&e(k,C);A=x("div#METABOOKSETTINGS.flap.scrolling");A.innerHTML=J(metaBook.HTML.settings);(metaBook.DOM.settings=A)&&e(k,A);A=x("div#METABOOKAPPHELP.flap.metabookhelp.scrolling");A.innerHTML=J(metaBook.HTML.help);A&&e(k,A);A=metaBook.DOM.console=x("div#METABOOKCONSOLE.flap.metabookconsole.scrolling");2<D.startup&&p("Setting up console %o",A);A.innerHTML=J(metaBook.HTML.console);metaBook.DOM.input_console=y=x.getChild(A,"TEXTAREA");metaBook.DOM.input_button=E=x.getChild(A,"span.button");
E.onclick=n;y.onkeypress=h;A&&e(k,A);var A=x("div#METABOOKLAYERS.flap"),F=x("iframe#BOOKHUBAPP");F.setAttribute("frameborder",0);F.setAttribute("scrolling","auto");A.appendChild(F);metaBook.DOM.sbooksapp=F;A&&e(k,A);if(A=f(k,"#METABOOKCOVERCONTROLS"))u||d(A,"nobookcover"),w||d(A,"nocredits"),C||d(A,"noblurb");metaBook.touch?x.addListener(k,"touchstart",v):x.addListener(k,"click",v);m(k);q&&q.parentNode===a?a.replaceChild(k,q):(a.appendChild(k),q&&q.parentNode.removeChild(q));metaBook.showCover();
metaBook.CSS.hidecover=x.addCSSRule("#METABOOKCOVER","opacity: 0.0; z-index: -10; pointer-events: none; height: 0px; width: 0px;");1<D.startup&&p("Cover setup done in %dms",g()-b);return k};var F=x.toArray;metaBook.resizeCover=function(a){a||(a=c("METABOOKCOVER"));if(a){var b=c("METABOOKFRAME"),d=a.style,b=b.style,e=0;a.offsetHeight||(e=1,d.zIndex=-500,d.visibility="hidden",d.opacity=0,d.display="block",d.height="100%",d.width="100%",b.display="block");a=c("METABOOKCOVERCONTROLS");var f=c("METABOOKUSERBOX");
x.adjustFontSize(a);x.adjustFontSize(f);(a=c("METABOOKTITLE"))&&!A(a,/\b(adjustfont|fdjtadjustfont)\b/)&&x.adjustFontSize(a);e&&(d.zIndex="",d.display="",d.opacity="",d.visibility="",b.display="")}};var O={coverpage:"METABOOKCOVERPAGE",titlepage:"METABOOKTITLE",creditspage:"METABOOKCREDITS",blurb:"METABOOKBLURB",help:"METABOOKAPPHELP",settings:"METABOOKSETTINGS",layers:"METABOOKLAYERS"};metaBook.addConfig("showconsole",function(a,e){var f=document.documentElement||document.body;e?d(f,"_SHOWCONSOLE"):
b(f,"_SHOWCONSOLE");(f=c("METABOOKCOVERCONTROLS"))&&x.adjustFontSize(f);fdjt.Async(function(){metaBook.updateSettings(a,e)})})})();(function(){var a=fdjt.DOM,n=fdjt.Log,h=fdjt.ID,m=fdjt.Time,e=a.dropClass,v=a.addClass,k=a.getGeometry,x=a.getChildren,p=a.getChild,u=a.toArray,q=fdjt.String.isEmpty,g=metaBook.Trace,c=metaBook.applyMetaClass,b=1,d=metaBook.fixStaticRefs;metaBook.initBody=function(){var k=document.body,w=m(),f=h("CODEXCONTENT"),D=f||a("div#CODEXCONTENT"),J,G;2<g.startup&&n("Starting initBody");v(D,"metabookcontent");v(D,"codexroot");k.setAttribute("tabindex",1);k.style.fontSize="";k.style.width="";metaBook.content=
D;var y=h("METABOOKNOTES")||a("div.metabookbackmatter#METABOOKNOTES");c("htmlbooknote");c("htmlbooknote","METABOOK.booknotes");v(a.$("span[data-type='footnote']"),"htmlbooknote");var E=x(D,".htmlbooknote");J=0;for(G=E.length;J<G;){var F=E[J++],O=b++,M="METABOOKNOTE"+O,I="METABOOKNOTE"+O+"_ref",t=F.getAttribute("data-label")||""+O,T=p(F,"label")||p(F,"summary")||p(F,".html5label")||p(F,".html5summary"),O=a.Anchor("#"+M,"A.mbnoteref.htmlnoteref",T?T.cloneNode(!0):t),t=a.Anchor("#"+I,"A.htmlackref",
T?T.cloneNode(!0):t);O.id=I;a.replace(F,O);e(F,"booknote");F="SPAN"===F.tagName?a("div.booknotebody",t,u(F.childNodes)):a("div.booknotebody",t,F);F.id=M;a.append(y,F,"\n")}if(!f){f=[];E=k.childNodes;J=0;for(G=E.length;J<G;)f.push(E[J++]);for(J=0;J<G;)E=f[J++],1!==E.nodeType?D.appendChild(E):E.id&&0===E.id.search("METABOOK")||/(META|LINK|SCRIPT)/gi.test(E.tagName)||D.appendChild(E)}J=/^http(s)?:\/\/([a-z]+.)?wikipedia.org\//;G=D.getElementsByTagName("A");f=0;for(E=G.length;f<E;)if(M=G[f++],(O=M.getAttribute("href"))&&
"#"!==O[0]&&0===O.search(/^[a-zA-Z][a-zA-Z][a-zA-Z]+:/))F=M.className,I="extref",0!==O.search(J)||(O=fdjt.DOM.textify(M),q(O))||(M.title?0<=M.title.search(/wikipedia/i)||(M.title="Wikipedia: "+M.title):M.title="From Wikipedia",I+=" wikiref"),M.className=F?F+" "+I:I,M.target="_blank";f=x(D,"a[rel='sbooknote'],a[rel='footnote'],a[rel='endnote']");J=0;for(G=f.length;J<G;)E=f[J++].href,a.hasText(E)||(E.innerHTML="Note"),E&&"#"===E[0]&&v(h(E.slice(1)),"sbooknote");y.childNodes.length&&a.append(D,"\n",
y,"\n");metaBook.coverpage=metaBook.getCoverPage();metaBook.titlepage=h("SBOOKTITLEPAGE");y=metaBook.pages=h("METABOOKPAGES")||a("div#METABOOKPAGES");y=metaBook.page=a("div#CODEXPAGE.metabookcontent",y);metaBook.body=h("METABOOKBODY");metaBook.body?metaBook.body.appendChild(y):(D=metaBook.body=a("div#METABOOKBODY.metabookbody",D,y),metaBook.textjustify&&v(D,"metabookjustify"),metaBook.bodycontrast&&v(D,"metabookcontrast"+metaBook.bodycontrast),metaBook.bodysize&&v(D,"metabookbodysize"+metaBook.bodysize),
metaBook.bodyfamily&&v(D,"metabookbodyfamily"+metaBook.bodyfamily),metaBook.bodyspacing&&v(D,"metabookbodyspacing"+metaBook.bodyspacing),k.appendChild(D));k=metaBook.menu=a("div#METABOOKMENU");k.innerHTML=d(metaBook.HTML.menu);a.prepend(h("METABOOKBODY"),k);k=a("div.mbpagecontrol#MBPAGERIGHT");D=a("div.mbpagecontrol#MBPAGELEFT");y=a("div#METABOOKPAGECONTROLS",D,k);D.setAttribute("data-tapsound","METABOOKPAGEBACKWARDAUDIO");k.setAttribute("data-tapsound","METABOOKPAGEFORWARDAUDIO");a.prepend(document.body,
y);window.scrollTo(0,0);1<g.startup&&n("initBody took %dms",m()-w);metaBook.Timeline.initBody=m()};metaBook.sizeContent=function(){var b=metaBook.sized=m(),c=metaBook.content,d=metaBook.page,e=document.body,h=a.viewHeight(),p=a.viewWidth();c.style.left=d.style.left="";c.style.right=d.style.right="";e.style.overflow="hidden";metaBook.sizeCodexPage();c=k(d,d.offsetParent,!0);e=a("DIV.codexpage.curpage");d.appendChild(e);var q=k(e,d,!0),d=c.inner_width,u=c.inner_height,p=Math.floor((p-d)/2)+q.right_border;
a.remove(e);metaBook.CSS.pagerule?(metaBook.CSS.pagerule.style.width=d+"px",metaBook.CSS.pagerule.style.height=u+"px"):metaBook.CSS.pagerule=a.addCSSRule("div.codexpage","width: "+d+"px; height: "+u+"px;");metaBook.CSS.glossmark_rule?metaBook.CSS.glossmark_rule.style.marginRight=-p+"px":metaBook.CSS.glossmark_rule=a.addCSSRule("#CODEXPAGE .glossmark","margin-right: "+-p+"px;");p=metaBook.CSS.shrinkrule;p||(p=a.addCSSRule("body.mbSHRINK #CODEXPAGE,body.mbPREVIEW #CODEXPAGE,body.mbSKIMMING #CODEXPAGE",
""),metaBook.CSS.shrinkrule=p);h=(h-150)/c.height;1<h&&(h=1);p.style[a.transform]="scale("+h+","+h+") translateZ(0)";document.body.style.overflow="";1<g.startup&&n("Content sizing took %dms",m()-b)}})();(function(){function a(a,b){a||(a=metaBook._publisher_index||window._pubtool_autoindex);if(a){if(1<F.startup||F.indexing)a._nkeys?c("Processing provided index of %d keys and %d refs",a._nkeys,a._nrefs):c("Processing provided index");E.useIndexData(a,metaBook.knodule,!1,b)}else b&&b()}function n(){(F.indexing||F.startup)&&c("Content indexing is completed");metaBook._started?h():metaBook.onsetup=h}function h(){var a=Math.max(F.startup,F.clouds),h=metaBook.addTag2Cloud,k=metaBook.empty_cloud,p=metaBook.gloss_cloud,
n=metaBook.taglist||b("METABOOKTAGLIST");n||(n=metaBook.taglist=fdjt.DOM("datalist#METABOOKTAGLIST"),document.body.appendChild(n));var q=metaBook.searchlist||b("METABOOKSEARCHLIST");q||(q=metaBook.searchlist=fdjt.DOM("datalist#METABOOKSEARCHLIST"),document.body.appendChild(q));var u=Knodule.knodeToOption;d();metaBook.empty_query.results=[].concat(metaBook.glossdb.allrefs).concat(metaBook.docdb.allrefs);var w=metaBook.searchtags=metaBook.empty_query.getCoTags(),v=metaBook.empty_query.tagfreqs;a&&c("Setting up initial tag clouds for %d tags",
w.length);J(document.body,"mbINDEXING");g(k.dom,g("div.cloudprogress","Cloud Shaping in Progress"));J(k.dom,"working");g(p.dom,g("div.cloudprogress","Cloud Shaping in Progress"));J(p.dom,"working");f.slowmap(function(a){if(a instanceof KNode){var b=h(a,k,metaBook.knodule,v,v,!1);"\u00a7"!==a._id[0]&&(n.appendChild(u(a)),q.appendChild(u(a)),a.weak||(J(b,"cue"),h(a,p)))}else"string"!==typeof a||y(a)||(b=g("OPTION",a),b.value=a,q.appendChild(b))},w,{watchfn:e,slice:200,space:20}).then(m)}function m(a){var d=
metaBook.empty_query,e=metaBook.knodule,h=metaBook.empty_cloud,k=metaBook.gloss_cloud,m=b("METABOOKSEARCHLIST"),p=Knodule.knodeToOption,n=Math.max(F.startup,F.clouds);metaBook.knodule.alldterms.slice(0,7).map(function(a){a=e.ref(a);h.getByValue(a).map(function(a){J(a,"cue")})});n&&c("Done populating clouds with %d tags",a.length);D(document.body,"mbINDEXING");d.cloud=h;g.getChild(h.dom,".showall")||g.prepend(h.dom,metaBook.UI.getShowAll(!0,h.values.length));f.slowmap(function(a){m.appendChild(p(a))},
metaBook.textindex.allterms,{slice:100,space:20});metaBook.sortCloud(h);metaBook.sortCloud(k);metaBook.sizeCloud(h,metaBook.tagfreqs,[]);metaBook.sizeCloud(k,metaBook.tagfreqs,[])}function e(a,b,d){var e=Math.max(F.startup,F.clouds),f=100*b/d;"after"===a&&(1<e&&c("Added %d (%d%% of %d tags) to clouds",b,Math.floor(f),d),w.ProgressBar.setProgress("METABOOKINDEXMESSAGE",f),w.ProgressBar.setMessage("METABOOKINDEXMESSAGE",A("Added %d tags (%d%% of %d) to clouds",b,Math.floor(f),d)))}function v(a,b,d){"suspend"===
a&&c("Processed %d/%d (%d%%) of provided tags",b,d,Math.floor(100*b/d))}function k(){for(var a=g.$(".metabooktags,.mbtags"),b=0,c=a.length;b<c;){var d=a[b++],e=metaBook.getTarget(d),e=metaBook.docinfo[e.id],f=g.textify(d),d=d.getAttribute("tagsep")||";",d=f.split(d);if(d.length)for(var f=0,h=d.length;f<h;)O(e,d[f++])}}function x(){for(var a=g.$(".metabooktag,.mbtag"),b=0,c=a.length;b<c;){var d=a[b++],e=metaBook.getTarget(d),e=metaBook.docinfo[e.id],d=g.textify(d);O(e,d)}}function p(){var a=metaBook.docinfo,
b=document.getElementsByTagName("A");if(b)for(var c=0,d=b.length;c<d;)if("tag"===b[c].rel){for(var e=b[c++],f=e;f&&!f.id;)f=f.parentNode;if(!f)break;var g=e.href,h=e.name,k=!1;h?(g=e.getAttribute("data-def")||e.getAttribute("data-def"),e=e.title,k=g?"|"===g[0]?k+g:k+"|"+g:e?"|"===e[0]?h+e:0<e.indexOf("|")?h+"|"+e:h+"|~"+e:h):g&&(h=g.search(/[^\/]+$/),k=0>h?g:g.slice(h));k&&O(a[f.id],k)}else c++}function u(a,b){function d(a,b,f){if("suspend"===a||"finishing"===a)a=100*b/f,1<e&&c("Processed %d/%d (%d%%) inline tags",
b,f,Math.floor(a)),w.ProgressBar.setProgress("METABOOKINDEXMESSAGE",a),w.ProgressBar.setMessage("METABOOKINDEXMESSAGE",A("Assimilated %d (%d%% of %d) inline tags",b,Math.floor(a),f))}var e=Math.max(F.startup,F.clouds),g=[],h=0;(1<F.startup||1<F.indexing)&&c("Applying inline tag attributes from content");for(var k in a){var m=a[k];m.atags&&(h++,g.push(m))}(F.indexing&&g.length||1<F.indexing||1<F.startup)&&c("Indexing tag attributes for %d nodes",g.length);f.slowmap(q,g,{watchfn:100<g.length&&d,done:function(){(1<
F.indexing&&g.length||24<g.length)&&c("Finished indexing tag attributes for %d nodes",g.length);b&&b()},slice:200,space:5})}function q(a){a.atags&&O(a,a.atags);if(a.sectag){O(a,a.sectag,"tags",metaBook.knodule);var b=metaBook.knodule.ref(a.sectag);metaBook.tagweights.set(b,metaBook.docdb.find("head",a).length)}}var g=fdjt.DOM,c=fdjt.Log,b=fdjt.ID,d=fdjt.Time,A=fdjt.String,w=fdjt.UI,f=fdjt.Async,D=g.dropClass,J=g.addClass,G=g.getLink,y=A.isEmpty,E=metaBook,F=E.Trace,O=metaBook.addTags;metaBook.useIndexData=
function(a,b,d,e){function g(b){var c=a[b];h++;var d=[],e=b.indexOf("|"),f=b.search(/[^*~]/),l=b,t=b,y=!1,w=!1;0<e?(l=b.slice(0,e),t=b.slice(f,e)):t=l=b.slice(f);(y=m||"~"!==b[0]?metaBook.knodule.handleSubjectEntry(b):metaBook.knodule.probe(l)||metaBook.knodule.probe(t))?(w=y.weight,q.set(y,w)):0<e&&(b=b.slice(e),e=b.search("|:weight="),0<=e&&(w=b.indexOf("|",e+1),w=0<=w?parseFloat(b.slice(e+9,w)):parseFloat(b.slice(e+9)),q.set(t,w)));w>r&&(r=w);w<u&&(u=w);y||(w=3>t.length?t:t.slice(0,3),p.push(t),
n.hasOwnProperty(w)?n[w].push(t):n[w]=[t]);w=0;b=c.length;for(k+=b;w<b;){var e=c[w++],v="string"===typeof e?e:e[0];if(f=metaBook.docinfo[v]){if("string"!==typeof e){var K=f.knodeterms,x=y?y._qid||y.getQID():t;f.knodeterms?(v=K[x])||(K[x]=v=[]):(K=f.knodeterms={},K[x]=v=[]);K=1;for(x=e.length;K<x;)v.push(e[K++])}d.push(f)}else metaBook.missing_nodes.push(v)}O(d,y||l)}var h=0,k=0,m=!1,p=metaBook.allterms,n=metaBook.prefixes,q=metaBook.tagweights,r=metaBook.tagmaxweight,u=metaBook.tagminweight;b=Math.max(F.startup,
F.indexing);d=[];if(a){for(var y in a)"_"!==y[0]&&a.hasOwnProperty(y)&&d.push(y);1E3>d.length&&(m=!0);J(document.body,"mbINDEXING");f.slowmap(g,d,{watchfn:100<d.length&&1<b&&v,slice:200,space:10}).then(function(a){c("Book index links %d keys to %d refs",h,k);D(document.body,"mbINDEXING");metaBook.tagmaxweight=r;metaBook.tagminweight=u;return e?e():a})}else e&&e()};metaBook.applyTagAttributes=u;metaBook.setupIndex=function(d){(1<F.startup||1<F.indexing)&&c("Finding and applying Technorati-style tags");
p();(1<F.startup||1<F.indexing)&&c("Finding and applying tag elements from body");x();k();u(d);if(d=metaBook._publisher_index||window._pubtool_autoindex)a(d,n),metaBook._publisher_index=!1,window._pubtool_autoindex=!1;else if(b("PUTBOOLAUTOINDEX"))d=b("PUBTOOLAUTOINDEX"),g.addListener(d,"load",function(b){a(!1,n);metaBook._publisher_index=!1;window._pubtool_autoindex=!1});else if(d=G("PUBTOOL.bookindex")){var e=document.createElement("SCRIPT");e.setAttribute("src",d);e.setAttribute("language","javascript");
e.setAttribute("async","async");g.addListener(e,"load",function(){a(!1,n);metaBook._publisher_index=!1;window._pubtool_autoindex=!1});document.body.appendChild(e)}else n()}})();(function(){function a(a,b,e){if(e||!a||!(metaBook.state===a||metaBook.state&&metaBook.state.target===a.target&&metaBook.state.location===a.location&&metaBook.state.page===a.page)){a||(a=metaBook.state);a.changed||(a.changed=q.tick());a.refuri||(a.refuri=metaBook.refuri);a.docuri||(a.docuri=metaBook.docuri);var g=a.title,h=a.target;!g&&h&&metaBook.docinfo[h]&&(a.title=g=metaBook.docinfo[h].title||metaBook.docinfo[h].head.title);f.state&&p("Setting state to %j",a);a.maxloc&&a.maxloc<a.location?a.maxloc=
a.location:a.maxloc||(a.maxloc=a.location);if(window&&window.location&&window.location.hash){var k=window.location.hash;"#"===k[0]&&(k=k.slice(1));a.hash=k}f.state&&p("saveState skiphist=%o force=%o state=%j",b,e,a);metaBook.state=a;e=JSON.stringify(a);d("mB("+c.docid+").state",e);!F&&metaBook.locsync&&metaBook.user&&(!metaBook.xstate||a.changed>metaBook.xstate.changed)&&m(!0);!b&&h&&window.history&&window.history.pushState&&n(a,h,g)}}function n(a,b,c){f.state&&(c?p("setHistory %s (%s) state=%j",
b,c,a):p("setHistory %s state=%j",b,a));if(window.history&&window.history.pushState){b||(b=a.target);c||(c=a.title);var d=x.getURL();!c&&b&&metaBook.docinfo[b]&&(a.title=c=metaBook.docinfo[b].title||metaBook.docinfo[b].head.title);!b&&a.location&&"number"===typeof a.location&&(b="SBOOKLOC"+a.location);f.state&&p("Pushing history %j %s (%s) '%s'",a,d,c);window.history.state&&window.history.state.target===a.target&&window.history.state.location===a.location||window.history.pushState(a,c,d+"#"+b)}}function h(c,
d,e){f.state&&p("Restoring (%s) state %j",d,c);c.location?metaBook.GoTo(c.location,d||"restoreState",c.target&&b(c.target),!1,!e):c.page&&metaBook.layout?(metaBook.GoToPage(c.page,d||"restoreState",!1,!e),c.target&&b(c.target)&&G(b(c.target))):c.target&&(metaBook.GoTo(c.target,d||"restoreState",!0,!1,!e),c.target&&b(c.target)&&G(b(c.target)));c.refuri||(c.refuri=metaBook.refuri);c.docuri||(c.docuri=metaBook.docuri);a(c)}function m(a){var b=I?q.tick()-I:31536E4;if(!F&&(a||metaBook.locsync)&&metaBook.user)if(O)p("Skipping state sync because one is already in process"),
M&&clearTimeout(M),setTimeout(function(){m(a)},15E3);else if(!a&&b<metaBook.sync_interval)f.state&&p("Skipping state sync because it's too soon");else if(!a&&metaBook.state&&(!k.isHidden||document[k.isHidden])&&b<5*metaBook.sync_interval)f.state&&p("Skipping state sync because page is hidden");else if(!a&&b<metaBook.sync_min)M=setTimeout(function(){m(a)},metaBook.sync_min);else if(M&&(clearTimeout(M),M=!1),(a||metaBook.locsync)&&navigator.onLine){var b=metaBook.docuri,d=f.state||f.network,g=metaBook.state,
h=metaBook.target&&metaBook.getRefURI(metaBook.target)||metaBook.refuri,t="https://sync.bookhub.io/v1/sync?",t=c.docref?t+"DOC="+encodeURIComponent(c.docref):t+"REFURI="+encodeURIComponent(h);c.docuri!==h&&(t=t+"&DOCURI="+encodeURIComponent(metaBook.docuri));t=t+"&NOW="+q.tick();metaBook.last_sync=I=q.tick();F=g;metaBook.user&&(t=t+"&SYNCUSER="+encodeURIComponent(metaBook.user._id));metaBook.mycopyid&&(t=t+"&MYCOPYID="+encodeURIComponent(metaBook.mycopyid));metaBook.deviceName&&(t=t+"&DEVICE="+encodeURIComponent(metaBook.deviceName));
metaBook.ends_at&&(t=t+"&LOCLEN="+encodeURIComponent(metaBook.ends_at));if(g){g.target&&(t=t+"&TARGET="+encodeURIComponent(g.target));if(g.location||g.hasOwnProperty("location"))t=t+"&LOCATION="+encodeURIComponent(g.location);g.changed&&(t=t+"&CHANGED="+encodeURIComponent(g.changed));g.reset&&(t+="&RESET=true")}h=new XMLHttpRequest;F=g;h.onreadystatechange=v;h.ontimeout=e;h.withCredentials=!0;h.timeout=metaBook.sync_timeout;d&&p("syncState(call) %s",t);try{h.open("GET",t,!0),h.send(),O=h}catch(n){try{p.warn("Sync request %s returned status %d %j, pausing for %ds",
b,h.status,JSON.parse(h.responseText),metaBook.sync_pause)}catch(r){p.warn("Sync request %s returned status %d, pausing for %ds",b,h.status,metaBook.sync_pause/1E3)}metaBook.locsync=!1;setTimeout(function(){metaBook.locsync=!0},metaBook.sync_pause)}}}function e(a){p.warn("Sync request timed out, pausing for %ds",metaBook.sync_pause/1E3);metaBook.locsync=!1;setTimeout(function(){metaBook.locsync=!0},metaBook.sync_pause)}function v(a){var b=u.T(a);O=!1;var c=f.state||f.network||f.startup&&1>J;if(4===
b.readyState){if(200<=b.status&&300>b.status){b=b.responseText;if(!b)return;var b=JSON.parse(b),d=q.tick();b.changed&&((c&&p("freshState %o %j\n\t%j",a,b,metaBook.state),b.changed>d+300)?p.warn("Beware of oracles (future state date): %j %s",b,new Date(1E3*b.changed)):metaBook.state?metaBook.state.changed>b.changed?metaBook.xstate=b:t&&t>b.changed||(document[k.isHidden]?metaBook.freshstate=b:(metaBook.xstate=b,t=q.tick(),metaBook.resolveXState(b))):(metaBook.xstate=b,h(b)));J++}else c&&p("syncState(callback/error) %o %d %s",
a,b.status,b.responseText);navigator.onLine&&y(!0);F=!1}}var k=fdjt.DOM,x=fdjt.State,p=fdjt.Log,u=fdjt.UI,q=fdjt.Time,g=fdjt.ID,c=metaBook,b=c.ID,d=c.saveLocal,A=c.readLocal,w=c.clearLocal,f=metaBook.Trace,D=metaBook.location2pct,J=0,G,y,E;metaBook.inits.push(function(){G=metaBook.setTarget;y=metaBook.setConnected;E=metaBook.setConfig});var F=!1;metaBook.initState=function(){var a=A("mB("+c.docid+").state",!0),e=metaBook.inithash;e?"#"===e[0]&&(e=e.slice(1)):e=!1;e&&b(e)&&(!a||a.hash&&a.hash!==e||
!a.hash&&a.target&&a.target!==e)&&(a||(a={}),a.refuri=metaBook.refuri,a.docuri=metaBook.docuri,a.target=e,a.location=!1,a.changed=q.tick(),d("mB("+c.docid+").state",a,!0));a&&(metaBook.state=a)};metaBook.saveState=a;metaBook.setHistory=n;metaBook.restoreState=h;metaBook.clearState=function(){metaBook.state=!1;w("mB("+c.docid+").state");metaBook.xstate=!1};metaBook.resetState=function(){var a=metaBook.state;a.location&&(a.maxloc=location);a.reset=!0;a=JSON.stringify(a);d("mB("+c.docid+").state",a);
m(!0)};var O=!1,M=!1,I=!1;metaBook.syncState=m;var t=!1,T=!1;metaBook.visibilityChange=function(){if(document[k.isHidden])T=q.tick();else if(!(T&&300>q.tick()-T))if(navigator.onLine)T=!1,m(!0);else if(metaBook.freshstate){var a=metaBook.freshstate;T=!1;metaBook.freshstate=!1;metaBook.xstate=a;t=q.tick();metaBook.resolveXState(a)}};metaBook.forceSync=function(){metaBook.connected?metaBook.update():metaBook._onconnect?metaBook._onconnect.push(function(){metaBook.update()}):metaBook._onconnect=[function(){metaBook.update()}];
metaBook.syncstart?m():metaBook.syncLocation()};metaBook.initLocation=function(){var a=metaBook.state;a||((a=g("METABOOKSTART")||fdjt.$1(".metabookstart")||g("SBOOKSTART")||fdjt.$1(".sbookstart")||g("SBOOKTITLEPAGE"))?(a=metaBook.getLocInfo(a),a={location:a&&a.start,changed:978307200}):a={location:1,changed:978307200});metaBook.saveState(a,!0,!0)};metaBook.resolveXState=function(a){var b=metaBook.state;if(metaBook.sync_interval)if(metaBook.statedialog)f.state&&p("resolveXState dialog exists: %o",
metaBook.statedialog);else if(f.state&&p("resolveXState state=%j, xstate=%j",b,a),b){if(a.maxloc>b.maxloc){b.maxloc=a.maxloc;var e=JSON.stringify(b);d("mB("+c.docid+").state",e)}if(!(b.changed>=a.changed||30>q.tick()-b.changed)){f.state&&p("Resolving local state %j with remote state %j",b,a);var e=[],g=a.location,h=a.maxloc;h>b.location&&e.push({label:"farthest @"+D(h),title:"your farthest location on any device/app",isdefault:!1,handler:function(){metaBook.GoTo(a.maxloc,"sync");b=metaBook.state;
b.changed=q.tick();metaBook.saveState(b,!0,!0);metaBook.hideCover()}});g!==b.location&&g!==h&&e.push({label:"latest @"+D(g),title:"the most recent location on any device/app",isdefault:!1,handler:function(){metaBook.restoreState(a);b=metaBook.state;b.changed=q.tick();metaBook.saveState(b,!0,!0);metaBook.hideCover()}});e.length&&17<b.location&&e.push({label:"current @"+(42>b.location?"start":D(b.location)),title:"the most recent location on this device",isdefault:!0,handler:function(){b.changed=q.tick();
metaBook.saveState(b,!0,!0);metaBook.hideCover()}});e.length&&e.push({label:"stop syncing",title:"stop syncing this book on this device",handler:function(){E("locsync",!1,!0)}});f.state&&p("resolveXState choices=%j",e);e.length&&(metaBook.statedialog=u.choose({choices:e,cancel:!0,timeout:7,nodefault:!0,noauto:!0,onclose:function(){metaBook.statedialog=!1},spec:"div.fdjtdialog.resolvestate#METABOOKRESOLVESTATE"},k("div","Start at")))}}else metaBook.restoreState(a)};metaBook.clearStateDialog=function(){metaBook.statedialog&&
(fdjt.Dialog.close(metaBook.statedialog),metaBook.statedialog=!1)}})();(function(){function a(a){return a instanceof g?a:"string"===typeof a?b.sourcedb.ref(a):!1}function n(c,e,g,h){var n=p(),u=document.documentElement||document.body;x("Setting up user %s (%s)",c._id,c.name||c.email);c&&(k.dropClass(u,"_NOUSER"),k.addClass(u,"_USER"));if(metaBook.user&&c._id!==metaBook.user._id)throw{error:"Can't change user"};(u=metaBook.sync)&&u>h&&x.warn("Cached user information is newer (%o) than loaded (%o)",u,h);navigator.onLine&&A("mB("+b.docid+").queued")&&metaBook.writeQueuedGlosses();
metaBook.user=metaBook.sourcedb.Import(c,!1,q.REFLOAD|q.REFSTRINGS|q.REFINDEX);e&&(metaBook.outlets=e.map(a));g&&(metaBook.layers=g.map(a));metaBook.user.save();f("mB.user",metaBook.user._id);f(metaBook.user._id,metaBook.user.Export(),!0);metaBook.locsync&&metaBook.setConfig("locsync",!0);metaBook.saveProps();d.startup&&(e=p(),x("setUser %s (%s) done in %dms",c._id,c.name||c.email,e-n));metaBook._user_setup=p();metaBook.cacheglosses&&metaBook.setCacheGlosses(!0);metaBook._ui_setup&&m();return metaBook.user}
function h(a){metaBook.nodeid||(metaBook.nodeid=a)&&metaBook.persist&&w("mB("+b.docid+").nodeid",a,!0)}function m(){if(!metaBook._user_ui_setup){var a=0,b,a=document.documentElement||document.body;1<d.startup&&x("Starting UI setup for user");var c=p();if(metaBook.user){k.addClass(a,"_NOUSER");k.dropClass(a,"_NOUSER");var e=metaBook.user.name||metaBook.user.handle||metaBook.user.email;if(e){u("METABOOKUSERNAME")&&(u("METABOOKUSERNAME").innerHTML=e);u("CODEXUSERNAME")&&(u("CODEXUSERNAME").innerHTML=
e);var f=document.getElementsByName("METABOOKUSERNAME");if(f&&f.length)for(a=0,b=f.length;a<b;)f[a++].innerHTML=e;if((f=document.getElementsByName("CODEXUSERNAME"))&&f.length)for(a=0,b=f.length;a<b;)f[a++].innerHTML=e;if((f=k.$(".metabookusername"))&&f.length)for(a=0,b=f.length;a<b;)f[a++].innerHTML=e;if((f=k.$(".codexusername"))&&f.length)for(a=0,b=f.length;a<b;)f[a++].innerHTML=e}u("SBOOKMARKUSER")&&(u("SBOOKMARKUSER").value=metaBook.user._id);a=metaBook.stylesheet;b=u("METABOOKADDGLOSSPROTOTYPE");
metaBook.user.fbid&&a.insertRule("#METABOOKHUD span.facebook_share { display: inline;}",a.cssRules.length);metaBook.user.twitterid&&a.insertRule("#METABOOKHUD span.twitter_share { display: inline;}",a.cssRules.length);metaBook.user.linkedinid&&a.insertRule("#METABOOKHUD span.linkedin_share { display: inline;}",a.cssRules.length);metaBook.user.googleid&&a.insertRule("#METABOOKHUD span.google_share { display: inline;}",a.cssRules.length);if(a=k.getInput(b,"MAKER"))a.value=metaBook.user._id;if(e=metaBook.user._pic||
metaBook.user.pic||metaBook.user.fbid&&"https://graph.facebook.com/"+metaBook.user.fbid+"/picture?type=square")if(u("SBOOKMARKIMAGE")&&(u("SBOOKMARKIMAGE").src=e),u("METABOOKUSERPIC")&&(u("METABOOKUSERPIC").src=e),f=document.getElementsByName("METABOOKUSERPIC"))for(a=0,b=f.length;a<b;)f[a++].src=e;if(e=document.getElementsByName("IDLINK"))for(a=0,b=e.length;a<b;)f=e[a++],f.target="_blank",f.title="click to edit your personal information",f.href="https://my.bookhub.io/profile";if(metaBook.user.friends)for(e=
metaBook.user.friends,f=metaBook.sourcedb,a=0,b=e.length;a<b;){var g=q.resolve(e[a++],f);metaBook.addTag2Cloud(g,metaBook.gloss_cloud);metaBook.addTag2Cloud(g,metaBook.share_cloud)}metaBook.outlets&&metaBook.addOutlets2UI(metaBook.outlets);d.startup&&(a=p(),x("Setup UI for %s (%s) in %dms",metaBook.user._id,metaBook.user.name||metaBook.user.email,a-c));metaBook._user_ui_setup=!0}else k.addClass(a,"_NOUSER")}}function e(){var c=A("mB.user"),e=metaBook.sync,f=A("mB("+b.docid+").nodeid",!0),g=c&&A(c,
!0);d.storage&&x("initOffline user=%s sync=%s nodeid=%s info=%j",c,e,f,g);if(e&&c){1<d.startup&&x("initOffline userinfo=%j",g);var c=metaBook.outlets=(A("mB("+b.docid+").outlets",!0)||[]).map(a),k=metaBook.layers=(A("mB("+b.docid+").layers",!0)||[]).map(a);g&&n(g,c,k,e);f&&h(f)}}function v(a){function b(){a._inui=f;f.id="mbOUTLET"+a.humid;f.setAttribute("data-value",a._id);f.setAttribute("data-key",a.name);f.innerHTML=a.name;a.description&&a.nick?f.title=a.name+": "+a.description:a.description?f.title=
a.description:a.nick&&(f.title=a.name);k("#METABOOKSHARECLOUD",f," ");metaBook.share_cloud.addCompletion(f)}"string"===typeof a&&(a=metaBook.sourcedb.ref(a));if(a)if(a instanceof Array)for(var c=a,d=0,e=c.length;d<e;)v(c[d++]);else if(a instanceof g&&!a._inui){var f=k("span.completion.cue.source",a._id);a.onLoad(b,"addoutlet2cloud")}}var k=fdjt.DOM,x=fdjt.Log,p=fdjt.Time,u=fdjt.ID,q=fdjt.RefDB,g=fdjt.Ref,c=fdjt.State,b=metaBook,d=b.Trace,A=c.getLocal,w=c.setLocal,f=b.saveLocal;metaBook.setUser=n;
metaBook.setNodeID=h;metaBook.setupUI4User=m;metaBook.loginUser=function(a){metaBook.user=metaBook.sourcedb.Import(a,!1,q.REFLOAD|q.REFSTRINGS|q.REFINDEX);m();metaBook._user_setup=!1};metaBook.userSetup=function(){var a=metaBook.sync=A("mB("+b.docid+").sync",!0)||0,c=p(),f=!1,g=!1;metaBook.sync&&!metaBook.persist&&metaBook.clearOffline();!metaBook.nologin&&metaBook.persist&&A("mB.user")&&(e(),d.storage&&x("Local info for %o (%s) from %o",metaBook.user._id,metaBook.user.name,metaBook.sync),metaBook.user&&
metaBook.sync&&metaBook.cacheglosses&&window._sbook_loadinfo&&(window._sbook_loadinfo=!1));if(!metaBook.nologin)if(window._sbook_loadinfo&&window._sbook_loadinfo.userinfo)f=window._sbook_loadinfo,g=f.userinfo,window._sbook_loadinfo=!1,d.storage&&x("Have window._sbook_loadinfo for %o (%s) dated %o: %j",g._id,g.name||g.email,f.sync,g),n(g,f.outlets,f.layers,f.sync),f.nodeid&&h(f.nodeid);else if(metaBook.userinfo||window._userinfo)g=metaBook.userinfo||window._userinfo,(d.storage||d.startup)&&x("Have %s for %o (%s) dated %o: %j",
metaBook.userinfo?"metaBook.userinfo":"window._userinfo",g._id,g.name||g.email,g.sync||g.modified,g),n(g,g.outlets,g.layers,g.sync||g.modified);1<d.startup&&x("userSetup done in %dms",p()-c);!metaBook.nologin&&metaBook.refuri&&window.navigator.onLine&&(metaBook.user&&a?x("Requesting additional glosses (> %s (%d)) on %s from %s for %s",p.timeString(metaBook.sync),metaBook.sync,metaBook.refuri,metaBook.server,metaBook.user._id,metaBook.user.name):metaBook.user?x("Requesting all glosses on %s from %s for %s (%s)",
metaBook.refuri,metaBook.server,metaBook.user._id,metaBook.user.name):x("No user, requesting user info and glosses from %s",metaBook.server),metaBook.updateInfo())};metaBook.initUserOffline=e;metaBook.addOutlets2UI=v})();(function(){function a(b){if(metaBook.nouser)metaBook.setConnected(!1);else{window._sbook_loadinfo!==b&&metaBook.setConnected(!0);b.sticky&&metaBook.setPersist(!0);b.mycopyid?u(b.mycopyid):b.mycopy&&u(b.mycopy);if(metaBook.user){if(b.wronguser){metaBook.clearOffline();window.location=window.location.href;return}b.userinfo&&metaBook.user&&(metaBook.user.importValue(b.userinfo),metaBook.user.save(),metaBook.setupUI4User())}else b.userinfo?metaBook.setUser(b.userinfo,b.outlets,b.layers,b.sync):(I("mB("+
E.docid+").queued")&&metaBook.glossdb.load(I("mB("+E.docid+").queued",!0)),A("METABOOKCOVER").className="bookcover",y(document.documentElement||document.body,"_NOUSER")),b.nodeid&&metaBook.setNodeID(b.nodeid);b.mycopyid&&(metaBook.mycopyid&&b.mycopyid!==metaBook.mycopyid&&c.warn("Mismatched mycopyids"),b.mycopyid!==metaBook.mycopyid&&(metaBook.mycopyid=b.mycopyid,E.iosAuthKludge&&E.iosAuthKludge()));metaBook.docinfo?b.loaded||(window._sbook_loadinfo&&window._sbook_loadinfo!==b?window._sbook_newinfo=
b:(metaBook.persist&&metaBook.cacheglosses&&b&&b.userinfo&&metaBook.user&&b.userinfo._id!==metaBook.user._id&&metaBook.clearOffline(),b.loaded=d(),metaBook.localglosses||!I("mB("+E.docid+").sync")&&!I("mB("+E.docid+").queued")||p(),F.glosses&&(c("loadInfo for %d %sglosses and %d refs (sync=%d)",b.glosses?b.glosses.length:0,metaBook.sync?"updated ":"",b.etc?b.etc.length:0,b.sync),c("loadInfo got %d sources, %d outlets, and %d layers",b.sources?b.sources.length:0,b.outlets?b.outlets.length:0,b.layers?
b.layers.length:0)),(b.glosses||b.etc)&&k(b.glosses||[],b.etc||[],function(){var a=metaBook.cacheglosses;b.etc&&v("etc",b.etc,a);b.sources&&v("sources",b.sources,a);b.outlets&&v("outlets",b.outlets,a);b.layers&&v("layers",b.layers,a);b.mycopyid&&u(b.mycopyid);metaBook.addOutlets2UI(b.outlets);b.sync&&(!metaBook.sync||b.sync>=metaBook.sync)&&metaBook.setSync(b.sync);metaBook.loaded=b.loaded=d();metaBook.slices.allglosses&&metaBook.slices.allglosses.update();if(metaBook.whenloaded){var c=metaBook.whenloaded;
metaBook.whenloaded=!1;setTimeout(c,10)}a&&(metaBook.glossdb.save(!0),metaBook.sourcedb.save(!0));metaBook.glosshash&&metaBook.showGloss(metaBook.glosshash)&&(metaBook.glosshash=!1)}))):metaBook.scandone=function(){a(b)}}}function n(a,b){function e(a){T=!1;a=JSON.parse(a.responseText);a.glosses&&a.glosses.length&&c("Received %d glosses from the server",a.glosses.length);metaBook.updatedInfo(a,m+(g?"&SYNCUSER="+g._id:"&JUSTUSER=yes"),k);g?!metaBook.ticktock&&metaBook.update_interval&&(metaBook.ticktock=
setInterval(n,1E3*metaBook.update_interval)):metaBook.user?setTimeout(n,50):c.warn("Couldn't determine user!")}function f(a){if(4===a.readyState&&500>a.status)c.warn("Ajax to %s callback failed, falling back to JSONP",m),h(m+(g?"":"&JUSTUSER=yes"),b),K=!0;else if(4===a.readyState){try{c.warn("Ajax to %s returned %d %j, taking a break",m,a.status,JSON.parse(a.responseText))}catch(d){c.warn("Ajax to %s returned %d, taking a break",m,a.status)}metaBook.ticktock&&(clearInterval(metaBook.ticktock),metaBook.ticktock=
!1);setTimeout(n,metaBook.update_pause)}}var g=metaBook.user,k=d(),m="https://"+metaBook.server+"/v1/loadinfo.js?",t=metaBook.sync?{}:!1,m=E.docref?m+"DOC="+encodeURIComponent(E.docref):m+"REFURI="+encodeURIComponent(E.refuri);E.sync&&(t["If-Modified-Since"]=(new Date(1E3*metaBook.sync)).toString());if(!T&&navigator.onLine){T=!0;var p=0,q,u=O("GLOSS",!0),p=0;for(q=u.length;p<q;)m=m+"&GLOSS="+u[p++];u=M("GLOSS");p=0;for(q=u.length;p<q;)m=m+"&GLOSS="+u[p++];metaBook.mycopyid&&(m=m+"&MYCOPYID="+encodeURIComponent(metaBook.mycopyid));
metaBook.sync&&(m=m+"&SYNC="+(metaBook.sync+1));g&&(m=m+"&SYNCUSER="+g._id);!g&&F.startup&&c("Requesting initial user info with %s using %s",K?"JSONP":"Ajax",m);if(K)h(m+(g?"":"&JUSTUSER=yes"),b);else try{J(e,m+"&CALLBACK=return"+(g?"":"&JUSTUSER=yes"),[],f,t,{timeout:metaBook.update_timeout})}catch(l){c.warn("Ajax call to %s failed, falling back to JSONP",m),h(m)}}}function h(a,b){if(navigator.onLine){b||(b="metaBook.updatedInfoJSONP");var c=A("METABOOKUPDATEINFO");0<a.indexOf("?")?"&"!==a[a.length-
1]&&(a+="&"):a+="?";a=a+"CALLBACK="+b;var d=g("script#METABOOKUPDATEINFO");d.language="javascript";d.type="text/javascript";d.setAttribute("charset","utf-8");d.setAttribute("async","async");metaBook.mycopyid?d.setAttribute("crossorigin","anonymous"):d.setAttribute("crossorigin","use-credentials");d.src=a;c?g.replace(c,d):document.body.appendChild(d)}}function m(a,b){if("string"===typeof a){var c=metaBook.sourcedb.ref(a);metaBook.persist&&c.load()}else c=metaBook.sourcedb.Import(a,!1,f.REFLOAD|f.REFSTRINGS|
f.REFINDEX),c.save();b.push(c._id)}function e(a,b){metaBook[b]=a;metaBook.cacheglosses&&t("mB("+E.docid+")."+b,a,!0)}function v(a,b,c){if(b)if(b instanceof Array){var d=[];if(7>b.length){c=0;for(var g=b.length;c<g;)m(b[c++],d);e(d,a)}else w.slowmap(function(a){m(a,d)},b,{done:function(){e(d,a)}})}else b=metaBook.sourcedb.Import(b,!1,f.REFLOAD|f.REFSTRINGS|f.REFINDEX),c&&b.save(),metaBook[a]=b._id,c&&t("mB("+E.docid+")."+a,b._id,!0)}function k(a,e,g){"undefined"===typeof g&&(g=!0);if(0!==a.length||
0!==e.length){var h=A("METABOOKNEWGLOSSES"),k=d();h&&(h.innerHTML=b("Assimilating %d new glosses",a.length),y(h,"running"));e?a.length&&c("Assimilating %d new glosses/%d sources...",a.length,e.length):a.length&&F.glosses&&c("Assimilating %d new glosses...",a.length);metaBook.sourcedb.Import(e,!1,f.REFLOAD|f.REFSTRINGS|f.REFINDEX,!0);metaBook.glossdb.Import(a,{tags:Knodule.importTagSlot},f.REFLOAD|f.REFSTRINGS|f.REFINDEX,g);e=0;g=a.length;for(var m=metaBook.syncstamp||0;e<g;){var t=a[e++],t=t.syncstamp||
t.tstamp;t>m&&(m=t)}metaBook.syncstamp=m;a.length&&c("Assimilated %d new glosses in %dms...",a.length,d()-k);G(h,"running")}}function x(){metaBook.writeQueuedGlosses();n()}function p(){if(P)return!1;P=!0;if(metaBook.sync){(F.glosses||F.startup)&&c("Starting initializing glosses from local storage");metaBook.sourcedb.load(!0);var a=metaBook.glossdb.load(!0);a&&a.then(function(){(metaBook.glossdb.allrefs.length||metaBook.sourcedb.allrefs.length)&&c("Initialized %d glosses (%d sources) from local storage",
metaBook.glossdb.allrefs.length,metaBook.sourcedb.allrefs.length)})}}function u(a){return new Promise(function(b){if(!a||a===E.mycopyid)return b(a);var d=/:x(\d+)/.exec(a),d=(d=d&&1<d.length&&parseInt(d[1]))&&new Date(1E3*d);(1<F.glosses||F.glossdata)&&c("gotMyCopyId: %s/%s, cur=%s/%s",a,d,metaBook.mycopyid,metaBook.mycopyid_expires);d||(metaBook.umycopyid=a,metaBook.saveLocal("umycopyid("+E.docuri+")",a));if(!metaBook.mycopyid||!metaBook.mycopyid_expires&&d||metaBook.mycopyid_expires&&d&&d>metaBook.mycopyid_expires)metaBook.mycopyid=
a,metaBook.mycopyid_expires=d,metaBook.saveLocal("mycopyid("+E.docuri+")",a),E.iosAuthKludge&&E.iosAuthKludge();return C&&C.length?(d=C,C=[],w.slowmap(function(b){b(a)},d).then(function(){b(a)})):b(a)})}function q(){U||(U=d(),J.fetchText("https://auth.bookhub.io/getmycopyid?DOC="+E.docref).then(function(a){u(a).then(function(){U=!1})}))}var g=fdjt.DOM,c=fdjt.Log,b=fdjt.String,d=fdjt.Time,A=fdjt.ID,w=fdjt.Async,f=fdjt.RefDB,D=fdjt.State,J=fdjt.Ajax,G=g.dropClass,y=g.addClass,E=metaBook,F=E.Trace,O=
D.getQuery,M=D.getHash,I=D.getLocal,t=metaBook.saveLocal;metaBook.loadInfo=a;var T=!1,K=!1;metaBook.updatedInfo=function(b,e,f){var g=metaBook.user;if(F.network||F.glosses&&b.glosses&&b.glosses.length||F.startup&&(!g||metaBook.update_interval&&!metaBook.ticktock&&F.startup))f?c("Response (%dms) from %s",d()-f,e||metaBook.server):c("Response from %s",e||metaBook.server);T=!1;a(b);!g&&metaBook.user?metaBook.userSetup():metaBook._ui_setup&&metaBook.setupUI4User()};metaBook.updateInfo=n;metaBook.updatedInfoJSONP=
function(a){var b=A("METABOOKUPDATEINFO");metaBook.updatedInfo(a,b&&b.src||"JSON")};metaBook.initGlosses=k;metaBook.update=x;g.addListener(window,"online",function(){return x()});metaBook.addConfig("glossupdate",function(a,b){metaBook.update_interval=b;metaBook.ticktock&&(clearInterval(metaBook.ticktock),metaBook.ticktock=!1,b&&(metaBook.ticktock=setInterval(n,1E3*b)))});metaBook.addConfig("updatetimeout",function(a,b){metaBook.update_timeout=b});metaBook.addConfig("updatepause",function(a,b){metaBook.update_pause=
b});var P=!1;metaBook.initGlossesOffline=p;var C=[];metaBook.gotMyCopyId=u;var U=!1;metaBook.getMyCopyId=function(){return new Promise(function(a){var b=new Date;if(E.mycopyid&&E.mycopyid_expires>b)return a(E.mycopyid);U||q();C.push(a)})}})();metaBook.Startup=function(){function a(){var a=X("METABOOKSPLASHPAGE");a&&a.parentNode&&a.parentNode.removeChild(a)}function n(){for(var a=metaBook.inits,b=0,c=a.length;b<c;)a[b++]()}function h(){N.console="METABOOKCONSOLELOG";N.consoletoo=!0;n();metaBook._setup_started||(metaBook._setup_started=new Date);metaBook.appsource=m();N("This is metaBook %s, built %s on %s, launched %s, from %s",fa.version,fa.buildtime,fa.buildhost,fa._setup_started.toString(),fa.root||metaBook.appsource||"somewhere");X("METABOOKBODY")&&
(metaBook.body=X("METABOOKBODY"));l("mbtrace")&&u(l("mbtrace",!0));Ma("mbtrace")&&u([Ma("mbtrace")]);ca("mbtrace")&&u([ca("mbtrace")]);A();N("Book %s (%s) %s (%s%s)",fa.docref||"@??",fa.bookbuild||"",fa.refuri,fa.sourceid,fa.sourcetime?": "+fa.sourcetime.toString():"");metaBook.initDB();metaBook.initConfig();v();k();ca("mB.user")&&(metaBook.setPersist(!0),metaBook.userSetup());metaBook.initState();metaBook.syncState();var a=fa.readLocal("mB("+fa.docid+").mycopyid")||C.getQuery("MYCOPYID");fa.gotMyCopyId(a);
metaBook.user||window._sbook_loadinfo||metaBook.userinfo||window._userinfo||ca("mB.user")||(ua.startup&&N("No local user info, requesting from bookhub server %s",fa.server),metaBook.updateInfo());fdjt.Init();f();w();x();metaBook._ui_setup=B();e();metaBook._user_setup&&metaBook.setupUI4User();metaBook.initBody();metaBook.setupGestures();metaBook.setConfig(metaBook.getConfig());1<ua.startup&&N("Initializing markup converter");var b=new Markdown.Converter;metaBook.markdown_converter=b;metaBook.md2HTML=
function(a){return b.makeHtml(a)};metaBook.md2DOM=function(a,c){var d=r("div"),e=d,f=document.createDocumentFragment();d.innerHTML=b.makeHtml(a);e=e.childNodes;d=[];c&&1===e.length&&1===e[0].nodeType&&"P"===e[0].tagName&&(e=e[0],e=e.childNodes);for(var g=0,h=e.length;g<h;)d.push(e[g++]);for(g=0;g<h;)f.appendChild(d[g++]);return f};metaBook.Timeline.sync_startup=new Date;if(metaBook.onsyncstartup)if(a=metaBook.onsyncstartup,delete metaBook.onsyncstartup,Array.isArray(a))for(var c=0,d=a.length;c<d;)a[c](),
c++;else a();ua.startup&&N("Done with sync startup")}function m(){for(var a=r.$("SCRIPT"),b=0,c=a.length;b<c;){var d=a[b++];if(d.src&&"string"===typeof d.src&&0<=d.src.search(/metabook.js(#|\?|$)/))return d.src}return!1}function e(){var a=fdjt.State.getCookie("APPMESSAGE");a&&fdjt.UI.alertFor(10,a);fdjt.State.clearCookie("APPMESSAGE","/","bookhub.io")}function v(){try{document.domain="bookhub.io"}catch(a){N.warn("Error setting document.domain")}r.addAppSchema("METABOOK","http://metabook.bookhub.io/");
r.addAppSchema("BOOKHUB","http://bookhub.io/");r.addAppSchema("PUBTOOL","http://pubtool.bookhub.io/");r.addAppSchema("DC","http://purl.org/dc/elements/1.1/");r.addAppSchema("DCTERMS","http://purl.org/dc/terms/");r.addAppSchema("OLIB","http://openlibrary.org/");r.addAppSchema("TOC","http://beingmeta.com/TOC/");r.addAppSchema("INDEX","http://beingmeta.com/INDEX/");r.addAppSchema("BM","http://beingmeta.com/");metaBook.devinfo=C.versionInfo();"http://static.beingmeta.com/"===metaBook.root&&"https:"===
window.location.protocol&&(metaBook.root="https://s3.amazonaws.com/beingmeta/static/");if(ca("mB.nologin")||l("nologin"))metaBook.nologin=!0;var b=z("BOOKHUB.server")||z("GLOSSDB");if(b)metaBook.server=b;else if(C.getCookie("METABOOKSERVER"))metaBook.server=C.getCookie("METABOOKSERVER");else if(C.getCookie("GLOSSDB"))metaBook.server=C.getCookie("GLOSSDB");else{a:{for(var b=document.domain,c=metaBook.servers,d=0;d<c.length;){if(c[d][0]===b||0<=b.search(c[d][0])||c[d][0].call&&c[d][0].call(b)){b=c[d][1];
break a}d++}b=!1}metaBook.server=b}metaBook.server||(metaBook.server=metaBook.default_server);E(metaBook.server);C.getLocal("mB.devmode")&&(Ka(document.documentElement,"_DEVMODE"),metaBook.devmode=!0);!metaBook.docroot&&z("METABOOK.rootid")&&(metaBook.docroot=oa(z("METABOOK.rootid")));metaBook.docroot=metaBook.docroot||X("METABOOKROOT")||X("CODEXCONTENT")||document.body;!metaBook.start&&z("METABOOK.startid")&&(metaBook.start=oa(z("METABOOK.startid")));metaBook.start=metaBook.start||X("METABOOKSTART")||
X("BOOKSTART");for(b=0;9>b;){c=document.body;if((d=z("TOC.head"+b,!0).concat(z("TOC.sect"+b,!0)).concat(z("tochead"+b,!0)))&&d.length)for(var e=0,f=d.length;e<f;)for(var g=r.getChildren(c,d[e++]),h=0,k=g.length;h<k;){var m=g[h++];F(m)||(m.toclevel=b)}b++}b=z("htmlbookignore",!0).concat(z("METABOOK.ignore",!0)).concat(z("PUBTOOL.ignore",!0));b.length&&(metaBook.ignore=new r.Selector(b));b=z("tocheadnone",!0).concat(z("TOC.ignore",!0)).concat(z("PUBTOOL.nothead",!0));b.length&&(metaBook.notoc=new r.Selector(b));
b=z("htmlbookterminal",!0).concat(z("METABOOK.terminal",!0)).concat(z("PUBTOOL.terminal",!0));b.length&&(metaBook.terminals=new r.Selector(b.length));b=z("htmlbooktarget",!0).concat(z("METABOOK.target",!0)).concat(z("METABOOK.idify",!0)).concat(z("PUBTOOL.idify",!0));b.length&&(metaBook.focus=new r.Selector(b));b=z("htmlbooknotarget",!0).concat(z("METABOOK.notarget",!0));b.length&&(metaBook.nofocus=new r.Selector(b))}function k(){var a=bb("mB("+fa.docid+").mycopyid");if(a){var b=/:x(\d+)/.exec(a),
b=b&&1<b.length&&parseInt(b[1]);(b&&new Date(1E3*b))>new Date&&fa.gotMyCopyId(a)}}function x(){var a=document.body,b=B();2<ua.startup&&N("Starting app setup");var c=r("STYLE");r(document.head,c);metaBook.stylesheet=c.sheet;metaBook.initHUD();metaBook.setupCover();O();I();t();metaBook.initSettings();if(metaBook.refuri&&(c=document.getElementsByName("REFURI")))for(var d=0,e=c.length;d<e;)"fillin"===c[d].value?c[d++].value=metaBook.refuri:d++;metaBook.addConfig("cacheglosses",function(a,b){metaBook.setCacheGlosses(b);
fdjt.Async(function(){metaBook.updateSettings(a,b)})});p();"undefined"!==typeof a.style["pointer-events"]&&(metaBook.demo||C.getLocal("mB.demo")||C.getCookie("crosshair")||l("crosshair"))&&da.Reticle.setup();ua.startup&&(N("App setup took %dms",B()-b),N("Body: %s",document.body.className))}function p(){var a,b,c=B(),d="string"===typeof metaBook.coverimage&&metaBook.coverimage||"string"===typeof metaBook.bookimage&&metaBook.bookimage||"string"===typeof metaBook.bookcover&&metaBook.bookcover||"string"===
typeof metaBook.coverpage&&metaBook.coverpage;if(d){var e=r.$("img.metabookbookimage");a=0;for(b=e.length;a<b;)e[a].src?a++:e[a++].src=d}if(d="string"===typeof metaBook.thumbnail&&metaBook.thumbnail)for(e=r.$("img.metabookbookthumb"),a=0,b=e.length;a<b;)e[a].src?a++:e[a++].src=d;if(d="string"===typeof metaBook.icon&&metaBook.icon)for(e=r.$("img.metabookbookicon"),a=0,b=e.length;a<b;)e[a].src?a++:e[a++].src=d;1<ua.startup&&N("Image setup took %dms",B()-c)}function u(a){for(var b=0,c=a.length;b<c;){var d=
a[b++],e=d.indexOf(":");if(0>e)ua[d]="number"===typeof ua[d]?1:!0;else{var f=d.substr(0,e),d=d.substr(e+1);ua[f]="number"===typeof ua[f]?parseInt(d,10):d}}}function q(d){var e=!1;if(!metaBook._started&&(d||!l("nometabook"))){if("null"===location.hash||"#null"===location.hash)location.hash="";location.hash&&"#"!==location.hash&&(d=location.hash,"#"===d[0]&&(d=d.slice(1)),hb.exec(location.hash)?metaBook.glosshash=d:metaBook.inithash=location.hash);metaBook._starting=B();Ka(document.body,"mbSTARTUP");
h();metaBook.resizeUI().then(function(){a()});U.timeslice([function(){var a=z("TOC.head1",!0,!0).concat(z("TOC.sect1",!0,!0)).concat(z("sbook1head",!0));a.length&&c(a,"1");a=z("TOC.head2",!0,!0).concat(z("TOC.sect2",!0,!0)).concat(z("sbook2head",!0,!0));a.length&&c(a,"2");a=z("TOC.head3",!0,!0).concat(z("TOC.sect3",!0,!0)).concat(z("sbook3head",!0));a.length&&c(a,"3");a=z("TOC.head4",!0,!0).concat(z("TOC.sect4",!0,!0)).concat(z("sbook4head",!0,!0));a.length&&c(a,"4");a=z("TOC.head5",!0,!0).concat(z("TOC.sect5",
!0,!0)).concat(z("sbook5head",!0,!0));a.length&&c(a,"5");a=z("TOC.head6",!0,!0).concat(z("TOC.sect6",!0,!0)).concat(z("sbook6head",!0,!0));a.length&&c(a,"6");a=z("TOC.head7",!0,!0).concat(z("TOC.sect7",!0,!0)).concat(z("sbook7head",!0,!0));a.length&&c(a,"7");(ua.startup||ua.domscan)&&N("Starting DOM scan with %o",metaBook.content);var b=X("METABOOKSTARTUPSCAN");Ka(b,"running");a=new metaBook.DOMScan(metaBook.content,metaBook.refuri+"#");metaBook.docinfo=a;metaBook.ends_at=metaBook.docinfo._maxloc;
(ua.startup||ua.domscan)&&N("Done with DOM scan yielding %o",a);Ra(b,"running");metaBook.state&&metaBook.state.target&&!metaBook.state.location&&(b=metaBook.docinfo[metaBook.state.target])&&b.starts_at&&(metaBook.state.location=b.starts_at,metaBook.saveState(!1,!0,!0));metaBook.scandone&&(b=metaBook.scandone,delete metaBook.scandone,b());e=a;metaBook.setupTOC(e[metaBook.content.id])},function(){U(g)},function(){var a=r.hasText,b=r.getMeta("METABOOK.index",!0).concat(r.getMeta("PUBTOOL.index",!0)).concat(r.getMeta("INDEX.include",
!0)).concat(r.getMeta("textindex",!0)),c=X("CODEXCONTENT");b.push("p,li,ul,blockquote,div");b.push("h1,h2,h3,h4,h5,h6,h7,hgroup,.sbookindex");for(var b=r.getChildren(c,b.join(",")),c=metaBook.textindex=new fdjt.TextIndex,d=0,e=b.length;d<e;){var f=b[d++];a(f)&&c.indexText(f)}c.finishIndex()},function(){for(var a=S.toSet,b=metaBook.textindex,c=metaBook.docinfo,d=b.allids,e=b.idterms,f=b.allterms,b=b.termindex,g=metaBook.docdb.addIndex("strings",S.StringMap),h=0,l=f.length;h<l;){var k=f[h++];g[k]=a(b[k])}f=
0;for(b=d.length;f<b;)if(g=d[f++],h=c[g])h.strings=a(e[g])},function(){1<ua.startup&&N("Loading sourcedb");metaBook.sourcedb.load(!0)},Knodule&&Knodule.HTML&&Knodule.HTML.Setup&&metaBook.knodule&&function(){var a=X("METABOOKSTARTUPKNO"),b=X("METABOOKSTARTUPKNODETAILS");b&&(b.innerHTML=K("Processing knodule %s",metaBook.knodule.name));Ka(a,"running");(1<ua.startup||ua.indexing)&&N("Processing knodule %s",metaBook.knodule.name);Knodule.HTML.Setup(metaBook.knodule);Ra(a,"running")},function(){if(metaBook.sync){if(metaBook.cacheglosses)return metaBook.initGlossesOffline()}else window._sbook_loadinfo&&
(metaBook.loadInfo(window._sbook_loadinfo),window._sbook_loadinfo=!1)},window._sbook_newinfo&&function(){metaBook.loadInfo(window._sbook_newinfo);window._sbook_newinfo=!1},function(){metaBook.setupIndex(e)},b],{slice:100,space:25})}}function g(){metaBook.sizeContent();metaBook.bypage?metaBook.Paginate("initial"):Ka(document.body,"_SCROLL")}function c(a,b){for(var c=0,d=a.length;c<d;)for(var e=r.$(a[c++]),f=0,g=e.length;f<g;)e[f++].setAttribute("data-toclevel",b)}function b(a){metaBook.glosshash&&
metaBook.glossdb.ref(metaBook.glosshash)?metaBook.showGloss(metaBook.glosshash)?(metaBook.glosshash=!1,metaBook.Timeline.initLocation=B()):metaBook.initLocation():metaBook.initLocation();window.onpopstate=function(a){a.state&&metaBook.restoreState(a.state,"popstate")};N("metaBook startup done");metaBook.resizeUI();metaBook.displaySync();r.dropClass(document.body,"mbSTARTUP");r.addClass(document.body,"mbREADY");X("METABOOKSPLASHPAGE")&&setTimeout(function(){Ka("METABOOKSPLASHPAGE","startupdone")},
3E3);var b=X("METABOOKREADYMESSAGE");X("METABOOKOPENTAB")?b.style.display="none":(b.innerHTML="Open",b.id="METABOOKOPENTAB");a||l("startmode")&&(a=l("startmode"));a?metaBook.setMode(a):a=metaBook.mode;metaBook._started=new Date;metaBook._starting=!1;metaBook.onsetup&&(b=metaBook.onsetup,metaBook.onsetup=!1,setTimeout(b,10));var c=b=!1,d=!1;if(b=l("APPMESSAGE"))"#{"===b.slice(0,2)&&0<(c=b.indexOf("}"))?(d="MSG_"+b.slice(2,c),ca(d)||(Ia(d,"seen"),da.alertFor(10,b.slice(c+1)))):da.alertFor(10,b);if(b=
aa("APPMESSAGE"))da.alertFor(10,b),C.clearCookie("APPMESSAGE","bookhub.io","/");!a&&location.hash&&metaBook.state&&location.hash.slice(1)!==metaBook.state.target?metaBook.hideCover():!a&&metaBook.user&&(a=bb("mB("+fa.docid+").opened",!0))&&a+54E5>B()&&metaBook.hideCover();r.vischange&&r.addListener(document,r.vischange,metaBook.visibilityChange);r.addListener(window,"resize",metaBook.resizeHandler)}function d(a){return Ca(a,!1,!0,!1,!0)}function A(){var a=J(),b=Ca("docuri",!1)||Ca("METABOOK.docuri",
!1)||Ca("BOOKHUB.docuri",!1)||Ca("PUBTOOL.docuri",!1)||Ca("canonical",!1)||J(),c=window.location.href,e=c.indexOf("#");metaBook.locuri=0<e?c.slice(0,e):c;document.body.refuri=metaBook.refuri=a;metaBook.topuri=document.location.href;metaBook.docuri=b;var f=ca("mB.refuris",!0)||[],c=ca("mB.docuris",!0)||[],e=ca("mB.docids",!0)||[],g=document.documentElement||document.querySelector&&document.querySelector("HTML");metaBook.sourceid=g.getAttribute("data-sourceid")||z("PUBTOOL.sourceid")||z("PUBTOOL.fileid")||
metaBook.docuri;var h=g.getAttribute("data-sourcetime")||z("PUBTOOL.sourcetime");h&&(metaBook.sourcetime=B.parse(h));if((h=ca("mB("+fa.docid+").sourceid"))&&h!==metaBook.sourceid){if((h=ca("mB("+h+").layouts"))&&h.length)for(var l=0,k=h.length;l<k;)ga.dropLayout(h[l++])}else Ia("mB("+fa.docid+").sourceid",metaBook.sourceid);if(g=g.getAttribute("data-buildstamp"))h=g.indexOf(" "),metaBook.buildstamp=g,0<h&&(metaBook.bookbuildhost=g.slice(0,h),metaBook.bookbuildtime=B.parse(g.slice(h+1)));metaBook.bypage=
"bypage"===metaBook.page_style;metaBook.max_excerpt=z("METABOOK.maxexcerpt")||metaBook.max_excerpt;metaBook.min_excerpt=z("METABOOK.minexcerpt")||metaBook.min_excerpt;g=z("booknote",!0).concat(z("METABOOK.booknote",!0));h=z("booknoteref",!0).concat(z("METABOOK.booknoteref",!0));metaBook.booknotes=g&&g.length?r.sel(g):!1;metaBook.booknoterefs=h&&h.length?r.sel(h):!1;0>f.indexOf(a)&&(f.push(a),Ia("mB.refuris",f,!0));0>c.indexOf(b)&&(c.push(b),Ia("mB.docuris",c,!0));var f=z("BOOKHUB.docref"),m;metaBook.docid=
f?metaBook.docref=m=f:m=b;Ia("mB("+m+")",b);0>e.indexOf(m)&&(c.push(b),Ia("mB.docuris",c,!0));if(b=d("PUBTOOL.coverpage")||d("coverpage")||d("*.coverpage"))metaBook.coverpage=b;if(b=d("PUBTOOL.coverimage")||d("coverimage")||d("*.coverimage"))metaBook.coverimage=b;if(b=d("PUBTOOL.thumbnail")||d("thumbnail")||d("*.thumbnail"))metaBook.thumbnail=b;if(b=d("PUBTOOL.icon")||d("icon")||d("*.icon"))metaBook.icon=b;if(b=z("BOOKHUB.id")||z("*.prefix")||z("*.baseid"))metaBook.baseid=b;if(b=z("BOOKHUB.idprefix")||
z("*.prefix")||z("*.idprefix")||b)metaBook.prefix=b;m=z("METABOOK.targetprefix");metaBook.targetids=m&&"*"===m?!1:m&&"/"===m[0]?new RegExp(m.slice(1,m.length-1)):m?new RegExp("^"+m):b?new RegExp("^"+b):!1;b=r.getMeta("METABOOK.adjustfont",!0);b.length&&(fdjt.DOM.autofont=fdjt.DOM.autofont+","+b.join(","));z("METABOOK.forcelayout")&&(fa.forcelayout=!0);if(b=z("METABOOK.autotoc"))metaBook.autotoc="y"===b[0]||"Y"===b[0]||"ON"===b||"on"===b||"1"===b||"enable"===b?!0:!1;metaBook.nologin||((a=z("BOOKHUB.mycopyid")||
ca("mycopyid("+a+")")||!1)&&a!==fa.mycopid&&fa.iosAuthKludge&&fa.iosAuthKludge(),fa.mycopyid=a)}function w(){var a=document.documentElement||document.body,b=navigator.userAgent,c=P;2<ua.startup&&N("Starting device setup for %s",b);var d=B();!c.touch&&l("touch")&&(c.touch=l("touch"));fdjt.TapHold.default_opts.bubble=!1;if(c.touch){r.addClass(a,"_TOUCH");fdjt.TapHold.default_opts.fortouch=!0;metaBook.ui="touch";metaBook.touch=!0;metaBook.keyboard=!1;var e=r.getHEAD(),f=z("viewport",!1,!1,!0);f||(f=
document.createElement("META"),f.setAttribute("name","viewport"),f.setAttribute("content",ab),e.appendChild(f));f=z("apple-mobile-web-app-capable",!1,!1,!0);f||(f=document.createElement("META"),f.setAttribute("name","apple-mobile-web-app-capable"),f.setAttribute("content","yes"),e.appendChild(f))}c.android?(Za.keyboardhelp=!1,metaBook.updatehash=!1):0<b.search("Safari/")&&0<b.search("Mobile/")?(D(),metaBook.updatehash=!1,Za.keyboardhelp=!1,N.doformat=!0):c.touch?(r.addClass(a,"_TOUCH"),metaBook.ui=
"touch"):metaBook.ui||(r.addClass(a,"_MOUSE"),metaBook.ui="mouse");1<ua.startup&&N("setupDevice done in %dms: %s/%dx%d %s",B()-d,metaBook.ui,r.viewWidth(),r.viewHeight(),c.string)}function f(){if(!metaBook.bookinfo){2<ua.startup&&N("Book setup");var a=metaBook.bookinfo={},b=B();a.title=z("METABOOK.title")||z("PUBTOOL.title")||z("DC.title")||z("~TITLE")||document.title||"untitled";var c=z("METABOOK.author",!0).concat(z("PUBTOOL.author",!0)).concat(z("DC.creator",!0)).concat(z("AUTHOR")).concat(z("~AUTHOR"));
c&&c.length&&(a.authors=c);a.byline=z("METABOOK.byline")||z("PUBTOOL.byline")||z("BYLINE")||c&&c.length&&c[0];a.copyright=z("PUBTOOL.copyright")||z("BOOKHUB.copyright")||z("DC.rights")||z("COPYRIGHT")||z("RIGHTS");a.publisher=z("PUBTOOL.pubname")||z("BOOKHUB.pubname")||z("DC.publisher")||z("PUBLISHER");a.pubyear=z("PUBTOOL.pubyear")||z("BOOKHUB.pubyear")||z("DC.date");a.description=z("METABOOK.description")||z("BOOKHUB.description")||z("PUBTOOL.description")||z("DC.description")||z("DESCRIPTION");
a.digitized=z("PUBTOOL.digitized")||z("DIGITIZED");a.converted=z("PUBTOOL.converted");1<ua.startup&&N("setupBook done in %dms",B()-b)}}function D(){window.scrollTo(0,1);setTimeout(function(){window.scrollTo(0,0)},0)}function J(){var a=Ca("refuri",!1,!0)||Ca("METABOOK.refuri",!1,!0)||Ca("BOOKHUB.refuri",!1,!0)||Ca("PUBTOOL.refuri",!1,!0)||z("refuri",!1,!0)||Ca("canonical",!1,!0);if(a)return decodeURI(a);var a=document.location.href,b=a.indexOf("?");0<=b&&(a=a.slice(0,b));b=a.indexOf("#");0<=b&&(a=
a.slice(0,b));return decodeURI(a)}function G(a){var b="<span class='host'>"+metaBook.server+"</span>";metaBook.server_info&&metaBook.server_info.serverip!==a.serverip&&N.warn("Server %s IP change from %s to %s:\n\t%j\n\t%j",metaBook.server,metaBook.server_info.serverip,a.serverip,metaBook.server_info,a);a.servername!==metaBook.server&&(b=b+" / <span class='host'>"+a.servername+"</span>");a.hostname!==a.servername&&(b=b+" / <span class='host'>"+a.hostname+"</span>");a.serverip&&(b=b+" / <span class='host'>"+
a.serverip+"</span>");metaBook.server_info=a;a=fdjt.DOM.$(".metabookserverinfo");for(var c=0,d=a.length;c<d;)a[c++].innerHTML="<strong>Glosses</strong> from "+b}function y(){var a=metaBook.server;r.removeListener(window,"online",y);V.jsonCall(G,"https://"+a+"/_info")}function E(){navigator.onLine?y():r.addListener(window,"online",y)}function F(a){return a.toclevel||a.getAttributeNS&&a.getAttributeNS("toclevel","http://beingmeta.com/TOC/")||a.getAttribute("toclevel")||a.getAttribute("data-toclevel")||
a.className&&a.className.search&&(0<=a.className.search(/\b(sbook|pubtool)\dhead\b/)||0<=a.className.search(/\b(sbook|pubtool)notoc\b/)||0<=a.className.search(/\b(sbook|pubtool)ignore\b/))?!0:!1}function O(){for(var a=fdjt.DOM.$(".metabookrefinfo"),b,c=B(),d=0,e=a.length;d<e;)b=a[d++],b.innerHTML="<strong>Ref:</strong>\u00a0",r.append(b,r("span.refuri",metaBook.refuri)," ",r("span.oidref",metaBook.docref));a=fdjt.DOM.$(".metabooksourceinfo");d=0;for(e=a.length;d<e;)b=a[d++],b.innerHTML="<strong>Source:</strong> ",
metaBook.sourcetime&&b.appendChild(M(metaBook.sourcetime)),r.append(b," ",r("span.uuid",metaBook.sourceid));a=fdjt.DOM.$(".metabookbuildinfo");d=0;for(e=a.length;d<e;)b=a[d++],b.innerHTML="<strong>Book Build:</strong> ",metaBook.bookbuild&&!metaBook.bookbuildhost?b.appendChild(metaBook.bookbuild):(metaBook.bookbuildtime&&b.appendChild(M(metaBook.bookbuildtime)),r.append(b," on ",r("span.host",metaBook.bookbuildhost)));a=fdjt.DOM.$(".metabookappinfo");d=0;for(e=a.length;d<e;)b=a[d++],b.innerHTML="",
r(b,r("strong","App:")," ","metaBook version ",metaBook.version," built on ",r("span.host",metaBook.buildhost),metaBook.buildtime&&" at ",M(metaBook.buildtime)," loaded from ",r("span.host",metaBook.appsource));a=fdjt.DOM.$(".metabookcopyrightinfo");d=0;for(e=a.length;d<e;)a[d++].innerHTML="Program and Interface <span class='inlinesymbol'>\u00a9</span> beingmeta, inc 2008-2015";1<ua.startup&&N("Book info setup done in %dms",B()-c)}function M(a){var b;try{return b="string"===typeof a?r("time",a):r("time",
a.toString()),"string"===typeof a?b.setAttribute("datetime",a):b.setAttribute("datetime",a.toISOString()),b}catch(c){return document.createTextNode("??time??")}}function I(){var a=B(),b=metaBook.Zoom=r("div#METABOOKZOOM.metabookzoom.metabookcontent",r("div#METABOOKZOOMBOX",r("div#METABOOKZOOMTARGET")),r("div#METABOOKZOOMCONTROLS",r("div#METABOOKZOOMCLOSE"),r("div#METABOOKUNZOOM"),r("div#METABOOKZOOMIN"),r("div#METABOOKZOOMOUT"),r("div#METABOOKZOOMHELP"),r("div#METABOOKZOOMHELPTEXT","Drag to pan, use two fingers to zoom")));
b.metabookui=!0;document.body.appendChild(b);1<ua.startup&&N("Zoom setup done in %dms",B()-a)}function t(){var a=B(),b=metaBook.Media=r("div#METABOOKMEDIA.metabookmedia.metabookcontent",r("div#METABOOKMEDIATARGET"),r("div#METABOOKCLOSEMEDIA"));b.metabookui=!0;document.body.appendChild(b);1<ua.startup&&N("Zoom setup done in %dms",B()-a)}function T(){fa._starting||fa._started||(fa.delay_startup?"number"===typeof fa.delay_startup?setTimeout(fa.Startup,fa.delay_startup):setTimeout(T,1E3):metaBook.Startup())}
var K=fdjt.String,P=fdjt.device,C=fdjt.State,U=fdjt.Async,V=fdjt.Ajax,B=fdjt.Time,N=fdjt.Log,r=fdjt.DOM,da=fdjt.UI,X=fdjt.ID,S=fdjt.RefDB,oa=metaBook.ID,ga=fdjt.CodexLayout,ca=C.getLocal,Ma=C.getSession,l=C.getQuery,aa=C.getCookie,z=r.getMeta,Ca=r.getLink,Ka=r.addClass,Va=r.swapClass,Ra=r.dropClass,fa=metaBook,ua=metaBook.Trace,bb=metaBook.readLocal,Ia=metaBook.saveLocal;metaBook.startupMessage=function(){ua.startup&&"number"===typeof ua.startup&&1<ua.startup&&N.apply(null,arguments)};metaBook.dropSplashPage=
a;metaBook.setSync=function(a){if(!a)return!1;var b=metaBook.sync;if(b&&b>a)return b;metaBook.sync=a;metaBook.persist&&Ia("mB("+fa.docid+").sync",a);return a};var hb=/G[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i;metaBook.Startup=q;var Za=metaBook.default_config;metaBook.getBookInfo=function(){metaBook.bookinfo||f();return metaBook.bookinfo};var ab="width=device-width,initial-scale=1.0,user-scalable=no";metaBook.updateServerInfo=E;metaBook.hasTOCLevel=F;metaBook.setupZoom=I;metaBook.setupMedia=
t;metaBook.addConfig("uisound",function(a,b){metaBook.uisound=b&&!0});metaBook.addConfig("readsound",function(a,b){metaBook.readsound=b&&!0});metaBook.addConfig("bodycontrast",function(a,b){var c=X("METABOOKBODY");b?Va(c,/\bmetabookcontrast[a-z]+\b/g,"metabookcontrast"+b):Ra(c,/\bmetabookcontrast[a-z]+\b/g);fdjt.Async(function(){metaBook.updateSettings(a,b)})});metaBook.enableOpenSans=function(){var a=X("METABOOKFRAME");a&&(a.style.fontFamily="'Open Sans',Verdana, Tahoma, Arial, Helvetica, sans-serif, sans",
metaBook.resizeUI())};metaBook.Setup=metaBook.StartupHandler=T;return q}();metaBook.Slice=function(){function a(a,b){for(var c=b.id;a;){if(fa(a,"codexpage")||a.getAttribute&&(a.id===c||a.getAttribute("data-baseid")===c))return a;a=a.parentNode}return b}function n(a,b,f,l){var n=a.frag||a.id,y=metaBook.docinfo[n];if(!y)return!1;var z=y.level?y:y.head,B=z&&r(z.frag),x=b&&b.scores.get(a),A=a.excerpt?a.excerpt.length:0,N=a.note&&a.note.trim(),N=N&&N.length,E=c(a),G=a.shared||[],F=b&&!l&&!a.maker&&h(r(n));"string"===typeof G&&(G=[G]);E&&(G=C.remove(G,E._qid||E._id));var E=x&&
q(a,x,b),J;J=a.maker||a.tstamp?g(a):!1;var K=t("div.mbcard_body",E,J,F,0<N&&a.maker&&e(a),0<N&&t("span.note",m(a.note))," ",a.detail&&t("span.showdetail","More")," ",(a.alltags||a.tags)&&v(a,b)," ",a.links&&p(a.links)," ",a.attachments&&p(a.attachments,"span.attachments")," ",G&&0<G.length&&k(G),0<A&&u(a.excerpt)," "),D=t(a.maker?"div.mbcard.gloss":"div.mbcard.passage",B&&w(B,a.level&&a),l&&d(y),K,t("div.fdjtclearfloats"));a.maker&&a.maker.load().then(function(b){var c=a.tstamp||a.modified||a.created;
b._live&&":PERSON"===b.kind&&(K.title=c?"gloss from "+(b.name||"someone")+" at "+I.shortString(c):"gloss from "+(b.name||"someone"),X(D,"personal"))});D.about="#"+a.frag;D.setAttribute("data-passage",n);D.setAttribute("data-location",y.starts_at);z&&D.setAttribute("data-tochead",z.frag);if(a.maker||a.tstamp)D.setAttribute("data-gloss",a._id),a.tstamp&&D.setAttribute("data-timestamp",a.tstamp);x&&D.setAttribute("data-searchscore",x);f&&(D.id=f+a.id);a._id&&(D.name=D.qref=a._id,D.setAttribute("name",
a._id));return D}function h(a,b){b||(b=80);if(!a)return!1;var c=t.textify(a),d=a.title||a.getAttribute("data-summary")||(c.length<b?c:c.slice(0,b)),d=t("span.sample",d);d.title=c;return d}function m(a){if(0===a.search(/^{(md|markdown)}/)){var b=a.indexOf("}");return metaBook.md2DOM(a.slice(b+1),!0)}return a}function e(a){a=a.maker;if(a._live)return t("span.maker",a.name||"From");var b=t("span.maker","From");a.load().then(function(a){a.name&&(b.innerHTML=a.name)});return b}function v(a,b){for(var c=
t.Image(oa("tagicon",64,64),"img.tagicon","tags"),d=b&&t("span.matches"),e=t("span.top"),f=t("span.sectags"),g=t("span.other"),h=0,l={},k="**tags *tags +tags +tags* knodes tags **tags* *tags* tags* ^tags ^tags*".split(" "),m=0,r=k.length,p=0;m<r;){var n=k[m++];if(n=a[n]){if(!Ka(n))n=[n];else if(0===n.length)continue;for(var q=0,u=n.length,p=p+u;q<u;){var w=n[q++];if(w){var y="string"===typeof w?w:w._qid||w.getQID();if(!l[y]){h++;l[y]=w;var y=w._qid&&"\u00a7"===w._qid[0],z;if(y){z=w;var B=z._id,v=
t("span.sectname",B);v.setAttribute("data-value",z._qid);20<B.length&&X(v,"longterm");z=v}else z=Knodule.HTML(w,metaBook.knodule);if(B=d)a:{for(var B=b.tags,v=0,x=B.length;v<x;){var I=B[v++];if(I===w){B=!0;break a}else if(w.allways&&0<=w.allways.indexOf(I)){B=!0;break a}}B=!1}B?t(d," ",z):y?t(f," ",z):4>h?t(e," ",z):t(g," ",z)}}}}}return p?t("span.mbcard_tags.tags",c,d,e,g,f):!1}function k(a,b){a instanceof Array||(a=[a]);if(0===a.length)return!1;for(var c=t(b||(1<a.length?"div.mbcard_audience":"span.mbcard_audience"),
1<a.length&&t("span.count",a.length," outlets")," "),d=0,e=a.length;d<e;){var f=metaBook.sourcedb.ref(a[d]),g=t("span.outlet");f._live?(t(g,f.name),g.title=f.about?"Shared with \u201c"+f.name+"\u201d \u2014 "+f.about:"Shared with \u201c"+f.name+"\u201d"):(g.setAttribute("NAME","OUTLETSPAN"+f._id),f.load().then(x));t.append(c," ",g);d++}return c}function x(a){for(var b=Ca(document.getElementsByName("OUTLETSPAN"+a._id)),c=0,d=b.length;c<d;){var e=b[c++];e.removeAttribute("NAME");t(e,a.name);e.title=
a.about?"Shared with \u201c"+a.name+"\u201d \u2014 "+a.about:"Shared with \u201c"+a.name+"\u201d"}}function p(a,b){var c=0,d;for(d in a)"_"!==d[0]&&c++;if(0===c)return!1;c=t(b||(4<c?"div.mbcard_links":"span.mbcard_links"),1<c&&t("span.count",c," links")," ");for(d in a)if("_"!==d[0]){var e=a[d],f=!1,f=0===d.search("https://glossdata.bookhub.io/")||0===d.search("https://glossdata.sbooks.net/")||0===d.search("resources/"),g,h=!1,l=!1,k=!1;if(!f){g=metaBook.inbookurls;for(var m=0,r=g;m<r;){var p=g[m++];
if("string"===typeof p){if(0===d.search(p)){f=!0;break}}else if(p.exec(d)){f=!0;break}}}"string"===typeof e?g=e:(g=e.title,h=e.icon,l=e.type);l||(l=metaBook.urlType(d));h||(h=metaBook.typeIcon(l));k||(k=metaBook.mediaTypeClass(l));e=t.Image(h);f?(f=t("span.mbmedia",e,g),f.setAttribute("data-src",d),l&&f.setAttribute("data-type",l),f.title="Reveal "+g):f=t.Anchor(d,{title:"Link to "+d,target:"_blank"},e,g);k&&X(f,k);t(c,f,"\n")}return c}function u(a){if("string"===typeof a)return K.Ellipsis("span.excerpt",
a,40);if(1===a.length)return K.Ellipsis("span.excerpt",a[0],40);for(var b=t("div.excerpts"),c=0,d=a.length;c<d;)t(b,0<c&&" ",K.Ellipsis("span.excerpt",a[c++],40));return b}function q(a,b,c){var d=t.Image(oa("goldstar",24,24),"img.inline"),e=t.Image(oa("tagicon",24,24),"img.inline"),e=(a=c&&c.counts&&c.counts.get(a))&&1<c.tags.length&&(a!==c.tags.length?t("span.note",a,e):t("span.note","all",e));return c&&c.max_score?t("span.score",e,"(",b,"/",c.max_score,d,")"):t("span.score",e,"(",b,d,")")}function g(a){var c=
a.maker,d=a.maker._id||a.maker,c=c===metaBook.user||c===metaBook.user._id||N.outlets&&0<=N.outlets.indexOf(c)||N.outlets&&0<=N.outlets.indexOf(d);var e=a.modified||a.created||a.tstamp,f=I.tick(),d=new Date(1E3*e);43200>f-e?(e=d.getHours(),d=d.getMinutes(),d=""+e+":"+(10>d?"0":"")+d):(e=d.getFullYear(),f=d.getMonth(),d=d.getDate(),d=10>e?""+d+"/"+Ra[f]+"/0"+e:""+d+"/"+Ra[f]+"/"+e);d=t("span.age",d);d.title=I.timeString(a.modified||a.created||a.tstamp);c=t("span.tool",d," ",t("span.label",c?"modify":
"respond"),c?t.Image(oa("gloss_edit_titled",64,64),"img.button","edit","tap to edit this gloss, hold to reply"):t.Image(oa("gloss_respond_titled",64,64),"img.button","reply","relay/reply to this gloss"),a.private&&t("span.private","Private"));ga(c,"tap",A);ga(c,"release",A);(a=b(a))&&t.addListener(a,"touchstart",fdjt.UI.noDefault);return[a,c]}function c(a){if(a.sources){a=a.sources;"string"===typeof a&&(a=[a]);for(var b=0,c=a.length;b<c;){var d=metaBook.sourcedb.loadref(a[b++]);if(d&&":OVERLAY"===
d.kind)return d}}return!1}function b(a){if(a._pic||a.pic)return Va(a._pic||a.pic,"img.glosspic.glossicon",a.note||a.name);if(a.links&&a.links.icon)return Va(a.links.icon,"img.glosspic.glossicon");var b=a.maker&&("string"===typeof a.maker?a.maker=N.sourcedb.ref(a.maker):a.maker);if(b&&b._live&&(b._pic||b.pic))return Va(b._pic||b.pic,"img.glosspic.userpic",b.name);if(b&&b._live&&b.fbid)return Va("https://graph.facebook.com/"+a.maker.fbid+"/picture?type=square","img.glosspic.userpic.fbpic",a.maker.name);
if(b&&b._live)return t("div.glosspic.userpic.sbooknopic",a.maker.name?aa(a.maker.name,1):"?");if(b){var c=t("div.glosspic.userpic.sbooknopic",a.maker.name?M.getInitials(a.maker.name,1):"?");b.load().then(function(b){var d=!1;b._live?b._pic||b.pic?d=Va(b._pic||b.pic,"img.glosspic.userpic",aa(a.maker.name,1),b.about?b.name+": "+b.about:b.name):b.fbid&&(d=Va("https://graph.facebook.com/"+b.fbid+"/picture?type=square","img.glosspic.userpic.fbpic",aa(a.maker.name,1),b.about?b.name+": "+b.about:b.name)):
d=!1;d&&t.replace(c,d)});return c}return!1}function d(a,b){var c=t("HR"),d=t("DIV.locbar",c),e=a.starts_at,f=a.ends_at-e;b||(b=metaBook.docinfo[document.body.id]);var g=b.starts_at,h=b.ends_at-g;c.style.width=f/h*100+"%";c.style.left=(e-g)/h*100+"%";if(c=a.id||a.frag)d.about="#"+c,c=r(c),c=metaBook.getTitle(c,!0),d.title=c;return d}function A(a){var b=K.T(a);for(K.cancel(a);b&&!b.qref;)b=b.parentNode;b&&(b=metaBook.glossdb.ref(b.qref),metaBook.setGlossTarget(b,"hold"===a.type)&&metaBook.setMode("addgloss"))}
function w(a,b){b||(b=metaBook.getHead(a));var c=t("span");c.title="this location in the structure of the book";var d=metaBook.docinfo[a.id];if(b){var e=metaBook.getTitle(b,!0),f=t("span.headtext.tocref",t("span.spacer","\u00a7"),e);f.setAttribute("data-tocref",b.id);var g=t("span.head",f);f.title="jump to the section: "+e;t.append(c," ",g);if(e=metaBook.Info(b).heads)for(f=e.length-1;0<f;){var h=e[f--],l=r(h.frag);if(l&&h.title&&l!==metaBook.docroot&&l!==document.body){l=t("span.tocref.headtext",
t("span.spacer","\u00a7"),h.title);l.setAttribute("data-tocref",h.frag);var k=t("span.head"," ",l);k.setAttribute("data-href",h.frag);l.title=h.title?"jump to the section: "+h.title:"(jump to this section)";a===b?t(g,k):t(g," \u22ef ",k);g=k}}}f=!1;g=!f;f||(f=metaBook.docinfo[metaBook.content.id]);e=t("hr.locrule");h=f.starts_at;f=f.ends_at-h;h=d.starts_at-h;l=d.ends_at-d.starts_at;k="~"+Math.ceil(l/5)+" words long ~"+Math.ceil(h/f*100)+"% along";e.setAttribute("about","#"+(d.id||d.frag));e.locstring=
k+".";e.title=(g?"this section in the book":"this passage in the section, ")+k+": click or hold to glimpse";e.style.width=l/f*100+"%";e.style.left=h/f*100+"%";c=t("div.mbcard_tochead",e,c);e=!1;g=!e;e||(e=metaBook.docinfo[metaBook.content.id]);f=e.starts_at;e=e.ends_at-f;f=d.starts_at-f;d=d.ends_at-d.starts_at;d=g?"this section is ~"+Math.ceil(d/7)+" words long and ~"+Math.ceil(f/e*100)+"% into the book":"this passage is ~"+Math.ceil(d/7)+" words long and ~"+Math.ceil(f/e*100)+"% into the section";
c.title=d;return c}function f(a,b,c,d){d||(d={});if("undefined"===typeof a)return!1;if(!(this instanceof f))return new f(a,b,c,d);if(!a)a=t("div.metabookslice");else if("string"===typeof a){if(ua.hasOwnProperty(a))return ua[a];if(document.getElementById(a))a=document.getElementById(a);else return!1}else if(a.nodeType&&1===a.nodeType&&a.id){if(ua.hasOwnProperty(a.id))return ua[a.id];ua[a.id]=a}else if(!a.nodeType||1!==a.nodeType)return!1;d.hasOwnProperty("initlayout")||(d.initLayout=!1);d.hasOwnProperty("noslip")||
(d.noslip=!1);d.hasOwnProperty("id")||(d.id=a.id);d.hasOwnProperty("holdmsecs")||(d.holdmsecs=400);d.hasOwnProperty("holdclass")&&(d.holdclass=!1);d.hasOwnProperty("touchtoo")&&(d.touchtoo=function(a){a=a||window.event;metaBook.previewing&&metaBook.stopPreview("touchtoo",!0);this.abort(a,"touchtoo")});a.id?metaBook.TapHold[a.id]=new K.TapHold(a,d):K.TapHold(a,d);metaBook.UI.addHandlers(a,"summary");this.container=a;this.cards=[];c&&(this.sortfn=c);this.byid=new fdjt.StringMap;this.byfrag=new fdjt.RefMap(N.docinfo);
this.needupdate=this.live=!1;this.addCards(b);metaBook.touch&&(d.packthresh=40);b&&b.length&&a.parentNode&&this.update();return this}function D(a){if(a.id)return a;if(a.childNodes){a=a.childNodes;for(var b=0,c=a.length;b<c;)if(1===a[b].nodeType){var d=D(a[b++]);if(d)return d}else b++}return!1}function J(a){return fa(a,"mbcard")||fa(a,"mbtoc")?a:ca(a,".mbcard,.mbtoc")||l(a,".mbcard,.mbtoc")}function G(a){var b=K.T(a);da.gestures&&T("slice_tapped %o: %o",a,b);if(metaBook.previewing)metaBook.stopPreview("slice_tapped",
!0),K.cancel(a);else if(ca(b,".ellipsis")&&(ca(b,".elision")||ca(b,".delision")))K.Ellipsis.toggle(b),K.cancel(a);else if(ca(b,".tochead"))b=(b=ca(b,".tocref"))&&b.getAttribute("data-tocref"),metaBook.SkimTo(b),K.cancel(a);else{if(ca(b,".mbmedia")){var c=ca(b,".mbmedia"),d=c.getAttribute("data-src"),e=!1,f=c.getAttribute("data-type");if(fa(c,"imagelink"))metaBook.showMedia(d,f),e=!0;else if(fa(c,"audiolink")||fa(c,"musiclink"))metaBook.showMedia(d,f),e=!0;if(e){K.cancel(a);return}}if(c=b.name&&document.getElementById(b.name)?
J(document.getElementById(b.name))||J(b):J(b))if(d=ca(c,".metabookslice"),X(d,"mbsyncslice"),d=r(c.getAttribute("data-passage")),e=(e=c.getAttribute("data-gloss"))&&metaBook.glossdb.ref(e),d){if(!e&&d)return metaBook.SkimTo(c,0),K.cancel(a);if(ca(b,".tool")){if(metaBook.setGlossTarget(e))return metaBook.setMode("addgloss"),K.cancel(a)}else{if("openglossmark"===N.mode)return N.clearGlossmark(),O(c),K.cancel(a);if(ca(b,".showdetail")){if(b=e&&e.detail)return"<"===b[0]?B("METABOOKGLOSSDETAIL").innerHTML=
e.detail:0===b.search(/^{(md|markdown)}/)?(c=b.indexOf("}"),B("METABOOKGLOSSDETAIL").innerHTML=metaBook.md2HTML(b.slice(c+1))):B("METABOOKGLOSSDETAIL").innerHTML=metaBook.md2HTML(b),metaBook.setMode("glossdetail"),K.cancel(a)}else return metaBook.SkimTo(c,0),K.cancel(a)}}}}function y(b){b=b||window.event;N.slipTimeout(!1);var c=K.T(b),d=J(c);da.gestures&&T("slice_held %o: %o, skimming=%o",b,d,metaBook.skimpoint);if(d){if(d.getAttribute("data-gloss")&&"openglossmark"===N.mode)return O(d),K.cancel(b);
(c=N.getSlice(d))&&c.setSkim(d);c=d.cloneNode(!0);c.id="METABOOKSKIM";t.replace("METABOOKSKIM",c);metaBook.previewTarget&&(c=metaBook.getDups(metaBook.previewTarget),S(c,"mbpreviewing"),metaBook.clearHighlights(c),metaBook.previewTarget=!1);var e=d.getAttribute("data-passage"),f=(c=d.getAttribute("data-gloss"))&&metaBook.glossdb.ref(c),c=r(e),g=!1,h=metaBook.getDups(e);metaBook.previewTarget=c;X(h,"mbpreviewing");f&&f.excerpt&&(f=metaBook.findExcerpt(h,f.excerpt,f.exoff))&&(h=f.startContainer,ca(h,
c)||(g=a(h,c)),K.Highlight(f,"mbhighlightexcerpt"));if(ca(d,".searchslice"))for(var d=metaBook.query.tags,e=metaBook.docinfo[e],f=e.knodeterms,h=0,l=d.length;h<l;){var k=d[h++],k=metaBook.highlightTerm(k,c,e,f);g||k&&k.length&&!ca(k[0],c)&&(g=a(k[0],c))}metaBook.startPreview(g||c,"slice_held");return K.cancel(b)}}function E(a){var b=J(K.T(a||window.event)),c=b&&b.getAttribute("data-gloss");da.gestures&&T("slice_released %o: %o, skimming=%o",a,b);metaBook.previewing&&metaBook.stopPreview("slice_released");
c&&"openglossmark"===N.mode&&O(b);K.cancel(a)}function F(a){a=a||window.event;var b=a.relatedTarget;da.gestures&&T("slice_slipped %o to %o",a,b);b&&Ma(b,".metabookslice")||N.slipTimeout(function(){da.gestures&&T("slice_slipped/timeout %o",a);metaBook.stopPreview("slice_slipped")})}function O(a){var b=(a=a.getAttribute("data-gloss"))&&N.slices.allglosses.byid[a];b&&(metaBook.setMode("allglosses"),fdjt.Async(function(){N.slices.allglosses.setSkim(b)}))}var M=fdjt.String,I=fdjt.Time,t=fdjt.DOM,T=fdjt.Log,
K=fdjt.UI,P=fdjt.showPage,C=fdjt.RefDB,U=C.Ref,V=t.$,B=fdjt.ID,N=metaBook,r=N.ID,da=N.Trace,X=t.addClass,S=t.dropClass,oa=metaBook.icon,ga=t.addListener,ca=t.getParent,Ma=t.hasParent,l=t.getChild,aa=M.getInitials,z=K.cancel,Ca=t.toArray;metaBook.renderCard=n;var Ka=Array.isArray,Va=t.Image,Ra="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),fa=t.hasClass;metaBook.UI.selectSources=function(a,b){var c=[],d=metaBook.sourcedb;if(b&&0!==b.length){for(var e=0,f=b.length;e<f;){var g=d.ref(b[e++]);
g&&c.push(g)}a.filter(function(a){return(a=a.gloss)&&(C.contains(c,a.maker)||C.overlaps(c,a.sources)||C.overlaps(c,a.shared))})}else a.filter(!1)};var ua={};f.prototype.setLive=function(a){if(a){if(this.live)return!1;this.needupdate&&this.update();return this.live=!0}return this.live?(this.live=!1,!0):!1};f.prototype.renderCard=function(a){return n(a)};f.prototype.sortfn=function(a,b){return a.hasOwnProperty("location")?b.hasOwnProperty("location")?a.location===b.location?a.timestamp?b.timestamp?
a.timestamp-b.timestamp:-1:1:a.location-b.location:-1:1};f.prototype.getCard=function(a){if(1===a.nodeType&&(fa(a,"mbcard")||fa(a,"mbtoc")))return a=a.getAttribute("data-gloss")||a.getAttribute("data-passage"),this.byid.get(a);if(1===a.nodeType){if(a.id||(a=D(a)),a)return this.byid.get(a.id)||this.byfrag.get(a.id)}else return a._qid&&this.byid.get(a._qid)||a._id&&this.byid.get(a._id)};f.prototype.update=function(){metaBook.Trace.slices&&T("Updating slice %o over %o",this,this.container);var a=this.cards,
b=[],c=[],d=this.byfrag,e=this.container;a.sort(this.sortfn);S(V(".slicenewpassage",e),"slicenewpassage");S(V(".slicenewhead",e),"slicenewhead");this.container.innerHTML="";for(var f=!1,g=!1,h=document.createDocumentFragment()||this.container,l=0,k=a.length;l<k;){var m=a[l++];m.hidden||(m.passage!==g&&(g=m.passage,d[g]=m,X(m.dom,"slicenewpassage")),m.head!==f&&(f=m.head,X(m.dom,"slicenewhead")),h.appendChild(m.dom),b.push(m),c.push(m.dom))}h!==this.container&&this.container.appendChild(h);P.update(e);
this.visible=b;this.shown=c;this.needupdate=!1};f.prototype.refresh=function(a){var b=this;if(this.needupdate||a)this.refresh_timer&&(clearTimeout(this.refresh_timer),this.refresh_timer=!1),this.refresh_timer=setTimeout(function(){b.refresh_timer=!1;b.needupdate=!1;b.update();b.needupdate&&b.refresh()},2E3)};f.prototype.filter=function(a){var b=this.cards,c=0,d=b.length;metaBook.Trace.slices&&(a?T("Filtering slice %o by %o",this.container,a):T("Restoring filtered slice %o",this.container));if(a)for(;c<
d;){var e=b[c++];a(e)?e.hidden=!1:e.hidden=!0}else for(;c<d;)delete b[c++].hidden;this.filterfn=a;this.needupdate=!0;this.update()};f.prototype.addCards=function(a,b){if(a&&(a instanceof Array||(a=[a]),0!==a.length)){b||(b=this.scores||!1);metaBook.Trace.slices&&T("Adding %d cards to slice %o with scores %o",a.length,this.container,b);for(var c=this.byid,d=this.cards,e=0,f=a.length;e<f;){var g=a[e++],h=!1,l,k,m=!1,r=!0,t=!1;g.about&&g.dom&&(h=g,l=g.dom);if(g.nodeType&&1===g.nodeType&&fa(g,"mbcard")){l=
g;k=g.name||g.getAttribute("name");if(!k)continue;(h=c[k])?(h.dom!==g&&(t=c[k].dom),l=g,h.dom=g):l=g}else g instanceof U&&(k=g._qid||g.getQID(),m=g,c[k]?(h=c[k],l=h.dom,r=!1):l=this.renderCard(g));l&&(m||(m=C.resolve(k)),h?c[k]||(c[k]=h):c[k]=h={added:I(),id:k,about:m},b&&b.get(g)&&(h.score=b.get(g)),h.dom=l,l.getAttribute("data-location")&&(h.location=parseInt(l.getAttribute("data-location"),10)),l.getAttribute("data-gloss")&&(h.gloss=metaBook.glossdb.refs[l.getAttribute("data-gloss")]),l.getAttribute("data-searchscore")&&
(h.score=parseInt(l.getAttribute("data-searchscore"),10)),l.getAttribute("data-timestamp")&&(h.timestamp=parseInt(l.getAttribute("data-timestamp"),10)),l.getAttribute("data-passage")&&(h.passage=l.getAttribute("data-passage")),l.getAttribute("data-tochead")&&(h.head=l.getAttribute("data-tochead")),this.filterfn&&(g=this.filterfn,g(h)?h.hidden=!1:h.hidden=!0),t?this.container.replaceChild(l,t):r&&d.push(h))}this.needupdate=!0;this.live&&this.refresh()}};f.prototype.setSkim=function(a){var b=this.visible,
c=this.shown,d=a.nodeType?c.indexOf(a):b.indexOf(a),e=a.nodeType?a:a.dom;if(!(0>d))return a=c[d],this.skimpoint&&S(this.skimpoint,"skimpoint"),this.skimpoint=a,this.skimpos=d,this.atStart=0===d,this.atEnd=d>=b.length-1,X(e,"skimpoint"),this.container.offsetHeight&&0===e.offsetHeight&&P.showNode(this.container,e),a};f.prototype.forward=function(a){var b=this.shown;a||(a=this.skimpoint||b[0]);a=b.indexOf(a);if(!(0>a||a+1>=this.visible.length))return this.setSkim(b[a+1])};f.prototype.backward=function(a){var b=
this.shown;a||(a=this.skimpoint||b[b.length-1]);a=b.indexOf(a);if(!(0>=a))return this.setSkim(b[a-1])};f.prototype.getInfo=function(a){"string"===typeof a&&(a=this.byid.get(a)||this.byfrag.get(a),a=Array.isArray(a)&&a.length?a[0]:a);var b;a?0>(b=this.shown.indexOf(a))&&(b=this.visible.indexOf(a)):b=this.skimpos;return 0<=b?this.visible[b]:!1};f.prototype.setLocation=function(a){var b=this.cards,c=0,d=b.length,e=!1;if(!this.skimpos||!this.cards[this.skimpos]||this.cards[this.skimpos].location!==a)for(;c<
d;){var f=b[c];if("number"!==typeof f.location)c++;else if(f.location===a){this.setSkim(f);break}else if(f.location>a){e?this.setSkim(e):this.setSkim(f);break}else e=f,c++}};metaBook.UI.getCard=J;metaBook.updateSkimmer=function(){if(N.skimming){var a=B("METABOOKSKIM"),b;N.skimming.setLocation(N.location);if(N.skimming!==N.slices.statictoc){for(var c=(b=N.skimming.skimpoint)&&b.getAttribute("data-passage"),c=c&&N.getDups(c),d=!1,e=0,f=c.length;e<f;)d?e++:Ma(c[e],".curpage")?d=c[e++]:e++;if(!d){N.setMode(!1);
return}}else b=N.skimming.skimpoint;b||N.setMode(!1);c=a.getAttribute("name");d=b.getAttribute("name");c!==d&&(b=b.cloneNode(!0),b.id&&(b.id="METABOOKSKIM"),t.replace(a,b))}};fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{summary:{tap:G,hold:y,release:E,click:function(a){a=a||window.event;var b=K.T(a);K.isClickable(b)||z(a)},slip:F}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{summary:{tap:G,hold:y,release:E,touchtoo:function(a){a=a||window.event;metaBook.previewTimeout(!1);metaBook.previewing&&
(da.gestures&&T("slice_touchtoo %o noabout",a),metaBook.stopPreview("toc_touchtoo",!0),K.cancel(a))},swipe:function(a){var b=a.deltaX,c=a.deltaY,d=t.viewWidth(),e=0>b?-b:b,f=0>c?-c:c,g=K.T(a),g=ca(g,".metabookslice");da.gestures&&T("slice_swiped d=%o,%o, ad=%o,%o, s=%o,%o vw=%o, n=%o",b,c,e,f,a.startX,a.startY,d,a.ntouches);e>2*f?b<-(metaBook.minswipe||10)?metaBook.skimming?metaBook.skimForward():(S(g,"myslicesync"),P.forward(g)):b>(metaBook.minswipe||10)&&(metaBook.skimming?metaBook.skimBackward():
(S(g,"mbyslicesync"),P.backward(g))):f>2*e&&(metaBook.hudup?c<-(metaBook.minswipe||10)?metaBook.setMode("allglosses"):c>(metaBook.minswipe||10)&&metaBook.setMode("search"):f<=(metaBook.minswipe||10)||(a.startX<d/5&&0>c?metaBook.setMode("help"):a.startX<d/5&&0<c?metaBook.setMode("statictoc"):a.startX>.8*d&&0<c?metaBook.setMode("search"):a.startX>.8*d&&0>c?metaBook.setMode("allglosses"):0<c?(metaBook.clearStateDialog(),metaBook.showCover()):metaBook.setHUD(!0)))},slip:F}});return f}();(function(){function a(a,b,c,e,h,m,t){e=new Date;var p=metaBook.sourcedb,u=metaBook.knodule;m=m||!1;var y=0,l=a.length,v=!1;m&&m.parentNode&&(v=document.createTextNode(""),m.parentNode.replaceChild(v,m));m?M(m,"completions"):m=h&&h.dom?h.dom:f("div.completions.cloud.noinput",k(z,l));var z=f("div.maxcompletemsg","There are a lot ","(",f("span.completioncount","really"),")"," of completions.  "),I=f("div.nomatchmsg","(no matches)");f.prepend(m,I,z);h||(h=new O(m));var p=x(a,b,u,p),z=17<l&&(0<p.n_primes||
p.max!==p.min||17>p.normals._count||4<l/p.normals._count);z?T(m,".showall")&&f.prepend(m,k(z,l)):f.addClass(m,"showall");a=[].concat(a);q(a);for(p=0;y<l;)(u=b.get(a[y++]))&&(p+=u);for(y=0;y<l;)u=a[y++],u=n(u,h,b,c,p/l),m.appendChild(u),m.appendChild(document.createTextNode(" "));g(h,b,t);b=new Date;A.clouds&&w("Made cloud for %d tags in %f seconds",a.length,(b.getTime()-e.getTime())/1E3);v&&v.parentNode.replaceChild(m,v);h.updated=function(){d(this)};return h}function n(a,b,c,d){d=d.get(a)||1;c=c.get(a);
a=e(a,b);b=a.title;d&&(b=b?b+"; count="+d:"count="+d);c&&c!==d&&(b=b+"; s="+c);a.title=b;1===d?M(a,"singleton"):2===d&&M(a,"doubleton");return a}function h(a,b,c,d){var e=!1,g=!1;if(a instanceof F){var h=a.dterm,k=!1;a._db===metaBook.knodule?k="index":(k=a._db.fullname?a._db.fullname:(k=metaBook.sourcedb.probe(a._db.name))?a._db.fullname=k.name:"glosses",g=f("sup","*"));b.setAttribute("data-key",h);"string"===typeof g?b.innerHTML=h+g:g?(b.innerHTML=h,b.appendChild(g)):b.innerHTML=h;(d=a[d])&&"string"===
typeof d&&(d=[d]);if(d)for(g=0;g<d.length;){var m=d[g++];if(m!==h){var t=f("span.variation",m,"=");t.setAttribute("data-key",m);e||(e=f("span.variations"));e.appendChild(t)}}a.prime?(M(b,"prime"),M(b,"cue")):a.weak&&M(b,"weak");h=0<h.search(/\.\.\.$/)?"root form":"concept";h=(a.prime?"key ":a.weak?"weak ":"")+("index"===k?"index "+h+" ":h+" (from "+k+") ");h=a.about?h+a.dterm+": "+a.about:(k=a.toPlaintext())&&k!==a.dterm?h+a.dterm+"="+a.toPlaintext():h+"'"+a.dterm+"'";b.title=h}else a.name?(M(b,"source"),
M(b,"account"),b.setAttribute("data-key",a.name),b.innerHTML=a.name):a.refuri&&(M(b,"doc"),b.setAttribute("data-key",a.refuri),c&&b.title&&c.addKeys(b,b.title),b.innerHTML=a.refuri);e&&f.prepend(b,e);c&&c.addKeys(b)}function m(a){var b=a.droplets;if(b){for(var c=0,d=b.length;c<d;){var e=b[c++];h(a,e.entry,e.cloud,e.lang)}delete a.droplets}}function e(a,b,c,d){var e;d||(d="span.completion");"string"!==typeof c&&(c=metaBook.language||Knodule.language||"EN");var g=b&&b.getByValue(a,".completion");if(g&&
g.length)return g[0];if("string"===typeof a)return c=0<a.search(/\.\.\.$/),e=f(d+(c?".rootform":".rawterm")+(20<a.length?".longterm":""),f("span.termtext","\u201c"+a+"\u201d")),e.setAttribute("data-key",a),e.setAttribute("data-value",a),e.title=c?"forms "+a:a,b&&b.addCompletion(e,a,a),e;if(a instanceof E){g=a._qid||a.getQID();e=a._id||a.dterm;if(a._db===metaBook.docdb)return c=a.title,40<c.length?f("span.name.ellipsis",c.slice(0,17),f("span.elision","\u2026"),f("span.elided",c.slice(c.length-17))):
25<c.length?f("span.name.longname",c):f("span.name",c),e=f("span.name",c),e=f(d+".sectname","\u00a7",e),e.setAttribute("data-key",c),e.setAttribute("data-value",a._qid||a.getQID()),24<c.length&&M(e,"longterm"),20<c.length&&(e.title=c),b&&b.addCompletion(e,c,a),e;e=a instanceof F?f(20<e.length?d+".dterm.longterm":d+".dterm",g):f(20<e.length?d+".longterm":d,g);a.cssclass&&M(e,a.cssclass);e.setAttribute("data-value",g);b&&b.addCompletion(e,!1,a);if(a._live)return h(a,e,b,c),e;if(a.droplets)a.droplets.push({entry:e,
lang:c,cloud:b});else return a.droplets=[{entry:e,lang:c,cloud:b}],a.onLoad(m),e}else return c=e.toString(),e=f(20<c.length?d+".weirdterm.longterm":d+".weirdterm","?"+c+"\u00bf"),e.title=c,b&&b.addCompletion(e,c,a),e}function v(a,b,c,d,g,h){c||(c=metaBook.knodule);if(a)if(a instanceof Array)for(var k=0,m=a.length;k<m;)v(a[k++],b,c,d,g,h);else return k=b.dom,a="string"===typeof a&&c?y.resolve(a,c,Knodule,!1)||a:a,b=d?n(a,b,d,g,h):e(a,b),P(b,k)||f(k,b," "),b}function k(a,b){var c=a&&f("span.showall",
f("span.showmore","more"),f("span.showless","fewer"));b&&c&&(c.title="There are "+b+" in all");c&&(c.onclick=p);return c}function x(a,b,c,d){for(var e=c=!1,f={},g=0,h=0,k=0;k<a.length;){var m=a[k++];m instanceof E&&(m.prime&&h++,m._db===d||m.weak||(f[m]=!0,g++));b&&(m=b.get(m))&&(!1===c?c=m:m<c&&(c=m),m>e&&(e=m))}f._count=g;return{normals:f,n_primes:h,min:c,max:e}}function p(a){var b=D.T(a);if(b=K(b,".completions"))D.cancel(a),f.toggleClass(b,"showall")}function u(b){if(!b.cloud)if(0===b.tags.length)b.cloud=
metaBook.empty_cloud;else{var c=b.getRefiners(),d=a(c,b.tagscores,b.tagfreqs,c.length,!1,!1,b.tags),e=d.dom;d.taphold||(d.taphold=new G(e));M(e,"searchcloud");metaBook.setupGestures(e);if(c.length>metaBook.show_refiners){var c=[].concat(c),f=b.tagscores;c.sort(function(a,b){if("string"===typeof a&&"string"===typeof b||a instanceof E&&b instanceof E){var c=f.get(a),d=f.get(b);return"number"===typeof c&&"number"===typeof d?d-c:"number"===typeof c?-1:1}return"string"===typeof a?1:-1});for(var e=0,g=
metaBook.show_refiners;e<g;){var h=c[e++],h=d.getByValue(h);M(h,"cue")}}else M(e,"showall");b.cloud=d}return b.cloud}function q(a){a.sort(function(a,b){var c=a,d=b;if(a instanceof F)if(b instanceof F)c=a.dterm,d=b.dterm;else return-1;else{if(b instanceof F)return 1;if(a instanceof E)if(b instanceof E)c=a._qid||a.getQID(),d=b._qid||b.getQID();else return-1;else{if(b instanceof E)return 1;if("string"!==typeof a||"string"!==typeof b){if("string"===typeof a)return-1;if("string"===typeof b)return 1;if(typeof a===
typeof b)return a<b?-1:a>b?1:0;c=typeof a;d=typeof b;return c<d?-1:c>d?1:0}}}if("\u00a7"===c[0]&&"\u00a7"!==d[0])return 1;if("\u00a7"===d[0]&&"\u00a7"!==c[0])return-1;0<c.search(/\w/)&&(c=c.slice(c.search(/\w/)));0<d.search(/\w/)&&(d=d.slice(d.search(/\w/)));return c<d?-1:c>d?1:0})}function g(a,b,c){var e=metaBook.tagscores,f=metaBook.tagweights,g=a.values,h=a.byvalue,k=Array(g.length),m=Array(g.length),t=0,l=g.length,p=Infinity,n=-1,q=Infinity,u=-1;for(A.clouds&&w("Sizing %d tags in cloud %o with roots %o",
g.length,a.dom,c);t<l;){var y=g[t],v,x=!1;c&&c.length&&0<=c.indexOf(y)?m[t]=k[t]=!1:(b?(x=b.get(y),(v=e.get(y))?(y=f.get(y)||1,v=x/v*y):v=!1):v=e.get(y),"number"!==typeof v||isNaN(v)?k[t]=!1:(k[t]=v,v<p&&(p=v),v>n&&(n=v)),"number"!==typeof x||isNaN(x)?m[t]=!1:(m[t]=x,x<q&&(q=x),x>u&&(u=x)));t++}A.clouds&&w("Sizing %d tags in %o with scores in [%o,%o]",g.length,a.dom,p,n);a.dom.style.display="none";for(t=0;t<l;)e=g[t],f=k[t],x=m[t],b=h.get(e),e.prime&&(M(b,"prime"),M(b,"cue")),c&&c.length&&0<=c.indexOf(e)&&
M(b,"cloudroot"),f||x?(e=50+150*(f?(f-p)/(n-p):(x-q)/(u-q)),b.style.fontSize=200>e?Math.round(e)+"%":"200%"):(M(b,"unscored"),b.style.fontSize=""),t++;A.clouds&&w("Finished computing sizes for %o using scores [%o,%o]",a.dom,p,n);a.dom.style.display="";I(a.dom,"working");A.clouds&&w("Rendered new cloud %o using scores [%o,%o]",a.dom,p,n);a.dom.parentNode&&setTimeout(function(){d(a)},50);A.clouds&&w("Finished sizing tags in %o using scores [%o,%o]",a.dom,p,n)}function c(a){metaBook.setQuery(metaBook.extendQuery(metaBook.query,
a))}function b(a,b){for(var c=t(a.dom,".cue.softcue"),d=0,e=c.length;d<e;){var f=c[d++];I(f,"cue");I(f,"softcue")}c=a.getByValue(b);d=0;for(e=c.length;d<e;)f=c[d++],C(f,"cue")||(M(f,"cue"),M(f,"softcue"))}function d(a){var b=Math.round,c=Math.sqrt;a=a.dom;var d=a.parentNode;if(d){var e=100;a.style.fontSize="";var f=a.scrollHeight,d=d.clientHeight;A.clouds&&w("Adjusting cloud %o: %o/%o",a,f,d);0===d||0===f||f<d&&f>.8*d||f>2*d||(d*=.9,e=f<d?b(c(d/f)*(e/100)*100):b(d/f*(e/100)*100),a.style.fontSize=
200<e?"200%":e+"%",A.clouds&&w("Adjusted cloud %o: %o/%o to %o%%",a,f,d,e))}else a.style.fontSize=""}var A=metaBook.Trace,w=fdjt.Log,f=fdjt.DOM,D=fdjt.UI,J=fdjt.ID,G=fdjt.TapHold,y=fdjt.RefDB,E=fdjt.Ref,F=Knodule.KNode;metaBook.search_cloud=!1;metaBook.empty_cloud||(metaBook.empty_cloud=!1);metaBook.show_refiners||(metaBook.show_refiners=25);metaBook.search_gotlucky||(metaBook.search_gotlucky=7);var O=D.Completions,M=f.addClass,I=f.dropClass,t=f.getChildren,T=f.getChild,K=f.getParent,P=f.hasParent,
C=f.hasClass,U=w,V=y.resolve;metaBook.makeCloud=a;metaBook.cloudEntry=e;metaBook.addTag2Cloud=v;metaBook.UI.getShowAll=k;metaBook.queryCloud=u;y.Query.prototype.getCloud=function(){return u(this)};metaBook.tag_sorter=function(a,b,c){if(a instanceof F){if(!(b instanceof F))return-1}else{if(b instanceof F)return 1;if(a instanceof E){if(!(b instanceof E))return-1}else{if(b instanceof E)return 1;if("string"!==typeof a||"string"!==typeof b){if(typeof a===typeof b)return a<b?-1:a>b?1:0;a=typeof a;b=typeof b;
return a<b?-1:a>b?1:0}}}var d=c.get(a);c=c.get(b);return"undefined"===typeof d?"undefined"===typeof c?("string"!==typeof a&&(a=a._qid||a.getQID(),b=b._qid||b.getQID()),a<b?-1:b>a?1:0):1:"undefined"===typeof c?-1:d===c?a<b?-1:a>b?1:0:d>c?-1:1};metaBook.sortTags=q;metaBook.sortCloud=function(a){var b=[].concat(a.values);q(b);for(var c=a.byvalue,d=document.createDocumentFragment(),e=0,f=b.length;e<f;){var g=b[e++];if(g=c.get(g))1<e&&d.appendChild(document.createTextNode(" ")),d.appendChild(g)}a.dom.appendChild(d)};
metaBook.sizeCloud=g;metaBook.UI.handlers.searchcloud_select=function(a){a=a||window.event;var b=f.T(a),d=K(b,".completion");if(C(d,"cloudroot"))A.gestures&&U("cloud tap on cloudroot %o",d);else{A.gestures&&U("cloud tap on %o",d);var e=K(b,".completions");d?(b=(metaBook.query.cloud||metaBook.query.getCloud()).getValue(d),"string"!==typeof b?c(b):0!==b.length&&(0<=b.indexOf("@")?c(V(b)):metaBook.knodule&&metaBook.knodule.probe(b)?c(metaBook.knodule.probe(b)):c(b)),D.cancel(a)):f.inherits(b,".resultcounts")?
(metaBook.showSearchResults(metaBook.query),metaBook.setMode("searchresults"),J("METABOOKSEARCHINPUT").blur(),J("METABOOKSEARCHRESULTS").focus(),D.cancel(a)):f.inherits(b,".refinercounts")?(f.toggleClass(e,"showall"),f.cancel(a)):f.inherits(b,".maxcompletemsg")&&(metaBook.touch||J("METABOOKSEARCHINPUT").focus(),f.toggleClass(e,"showall"),f.cancel(a))}};metaBook.UI.searchCloudToggle=function(){f.toggleClass(J("METABOOKSEARCHCLOUD"),"showall")};metaBook.setCloudCues=b;metaBook.setCloudCuesFromTarget=
function(a,c){var d=[],e=c.codexbaseid||c.id||c.frag,f=metaBook.docinfo[e],e=metaBook.glossdb.find("frag",e),g=metaBook.knodule;f&&f.tags&&(d=d.concat(f.tags));if(f&&f.autotags&&f.autotags.length)for(var f=f.autotags,h=0,k=f.length;h<k;){var m=g.probe(f[h]);m&&d.push(m.tagString());h++}g=0;for(f=e.length;g<f;)(h=e[g++].tags)&&(d=d.concat(h));b(a,d)};metaBook.adjustCloudFont=d;O.prototype.adjustCloudFont=function(){return d(this)}})();metaBook.TOCSlice=function(){function a(e,k,n){var g;if(g=k.toclevel){g=n;var c=h("a.mbtoc_sectname",k.title);n=h("div.mbtoc_elements");g=h("div.mbtoc",h("div.mbtoc_text",g&&g.cloneNode(!0),c),n);var c=k.starts_at,b=k.ends_at-c;if(k.sub&&k.sub.length){var d=k.sub,v=0,w=d.length;for(m(g,"mbtocbranch");v<w;){var f=d[v++],x=h("a.mbtoc_sectbrick"),J=f.starts_at,G=f.ends_at-J;x.name="MBTOC4"+f.frag;x.style.left=(J-c)/b*100+"%";x.style.width=G/b*100+"%";f.title&&(x.title=f.title);n.appendChild(x)}}b=k.head;
c=k.starts_at-b.starts_at;b=b.ends_at-b.starts_at;d=k.ends_at-k.starts_at;v=h("a.mbtoc_showsize");m(g,"mbtocleaf");v.style.width=d/b*100+"%";v.style.left=c/b*100+"%";n.appendChild(h("div.mbtoc_posbar"));n.appendChild(v);g.id="MBTOC4"+k.frag;g.setAttribute("name","MBTOC4"+k.frag);g.setAttribute("data-passage",k.frag);g.setAttribute("data-location",k.starts_at);g.setAttribute("data-level",k.toclevel);m(g,"mbtoc"+k.toclevel)}if(g=(n=g)&&{dom:n,about:k,id:k._id,head:k.frag,passage:k._id,location:k.starts_at})e.addCards([g]),
e.container.appendChild(n);n=h("span.context",h("span.tocpath","\u00a7",k.title));if(k.sub&&k.sub.length)for(k=k.sub,g=0,c=k.length;g<c;)a(e,k[g++],n);return e}function n(e,h){if(!(this instanceof n))return new n(e,h);k.call(this,h);a(this,e);return this}var h=fdjt.DOM,m=h.addClass,e=h.dropClass,v=h.$,k=metaBook.Slice,x=metaBook.icon;metaBook.navicon=function(a){switch(a){case "right":return x("skim_right",64,64);case "left":return x("skim_left",64,64);case "start":return x("skim_left_stop",64,64);
case "end":return x("skim_right_stop",64,64);default:return!1}};n.prototype=new k;n.setHead=function(a){e(v(".mblivetoc"),"mblivetoc");e(v(".mbcurtoc"),"mbcurtoc");if(a){for(var h=a;h;){for(var k=document.getElementsByName("MBTOC4"+h.frag),g=0,c=k.length;g<c;){var b=k[g++];m(b,"mblivetoc");h===a&&m(b,"mbcurtoc")}h=h.head}(h=metaBook.slices.statictoc)&&(a=h.byfrag[a.frag])&&h.setSkim(a.dom)}};n.prototype.mode="statictoc";return metaBook.TOC=n}();metaBook.setMode=function(){function a(a){if(a.frag)if(w(a.frag)){var c=f.UI.addGlossmark;!a.maker&&f.user&&(a.maker=f.user);K.addCards(a);var d=f.getDups(a.frag);G(d,"glossed");for(var e=0,h=d.length;e<h;)c(d[e++],a);a.excerpt&&(c=f.findExcerpt(d,a.excerpt,a.exoff))&&b.Highlight(c,"mbexcerpt",a.note,{"data-glossid":a._id});if(a.tags)for(c=f.gloss_cloud,d=a.tags,e=0,h=d.length;e<h;)f.cloudEntry(d[e++],c);a.tstamp>f.syncstamp&&(metaBook.syncstamp=a.tstamp)}else g("Gloss (add2UI) refers to nonexistent '%s': %o",
a.frag,a);else g.warn("Warning: skipping gloss %o with no fragment identifier",a.uuid)}function n(a,b){"undefined"===typeof b&&(b=!0);(D.gestures||D.mode)&&g("setHUD(%s) %o mode=%o hudup=%o bc=%o hc=%o",b?"clearmode":"keepmode",a,f.mode,f.hudup,document.body.className,T.className);if(a)metaBook.hudup=!0,y(document.body,/\b(openhud|openglossmark)\b/g),y(document.body,"mbSHOWHELP"),G(document.body,"hudup"),f.mode||G(document.body,"mbNOMODE");else{metaBook.hudup=!1;f.previewing&&f.stopPreview("setHUD");
y(document.body,"mbSHRINK");if(b){if(f.popmode){var c=f.popmode;f.popmode=!1;c()}y(T,"openheart");y(T,"openhead");y(T,"full");y(T,P);y(f.menu,P);y(document.body,"mbSKIMMING");y(document.body,"mbSKIMSTART");y(document.body,"mbSKIMEND");G(document.body,"mbNOMODE");metaBook.skimming=!1;metaBook.mode=!1}y(document.body,"hudup");y(document.body,"openhud");f.focusBody()}}function h(){f._started&&q.dropLocal("mB("+f.docid+").opened");n(!1);metaBook.closed=!0;f.covermode&&(G(f.cover,f.covermode),metaBook.mode=
metaBook.covermode);G(document.body,"mbCOVER")}function m(){f._started&&q.setLocal("mB("+f.docid+").opened",u());metaBook.closed=!1;y(document.body,"mbCOVER");f.mode&&(metaBook.covermode=f.mode,metaBook.mode=!1,metaBook.cover.className="")}function e(a,b){var e=f.mode;if("undefined"===typeof a)return e;"last"===a&&(a=f.last_mode);!a&&f.mode&&0<=f.mode.search(V)&&(a=f.last_mode);"none"===a&&(a=!1);"heart"===a&&(a=f.heart_mode||"statictoc");D.mode&&g("setMode %o, cur=%o dbc=%o",a,f.mode,document.body.className);
a!==f.mode&&f.previewing&&f.stopPreview("setMode");a!==f.mode&&f.popmode&&(e=f.popmode,f.popmode=!1,e());"layers"!==a||d("BOOKHUBAPP").src||f.appinit||f.initIFrameApp();"addgloss"===f.mode&&"addgloss"!==a&&E("METABOOKLIVEGLOSS","modified")&&f.submitGloss(d("METABOOKLIVEGLOSS"));a?y(document.body,"mbNOMODE"):G(document.body,"mbNOMODE");if(a){"search"===a&&(a=f.search_mode||"refinesearch");"addgloss"!==a&&y(document.body,"mbSHRINK");if(!0===a)f.hideCover(),N[f.mode]&&(e=N[f.mode],e=0<=e.search(/[.#]/)?
c.$1(e):d(e),e.blur()),y(T,P),y(f.menu,P),metaBook.mode=!1,metaBook.last_mode=!0;else{if("string"!==typeof a)throw Error("mode arg not a string");if(0<=a.search(B)){a!==f.mode&&(d("METABOOKCOVER").className=a,metaBook.mode=a,metaBook.modechange=u());"console"===a&&g.update();h();return}a!==f.mode&&(f.hideCover(),metaBook.modechange=u(),N[f.mode]&&(e=N[f.mode],e=0<=e.search(/[.#]/)?c.$1(e):d(e),e.blur()),a!==f.mode&&(metaBook.last_mode=f.mode),metaBook.mode=a)}"sbooksapp"!==a||d("BOOKHUBAPP").src||
f.appinit||k();if("refinesearch"===a||"searchresults"===a||"expandsearch"===a)metaBook.search_mode=a;"addgloss"===a?G(document.body,"openhud"):"openglossmark"===a?(G(document.body,"openhud"),G(document.body,"openglossmark")):b||n(!0);!0===a?(y(T,"openhead"),y(T,"openheart"),c.swapClass(T,P,"minimal"),c.swapClass(f.menu,P,"minimal")):"addgloss"===a?(G(T,"openhead"),y(T,"openheart")):(0>a.search(C)&&y(T,"openheart"),0>a.search(U)&&y(T,"openhead"),0<=a.search(C)&&(metaBook.heart_mode=a,G(T,"openheart")),
0<=a.search(U)&&(metaBook.head_mode=a,G(T,"openhead")));v(a)}else metaBook.last_mode=f.mode,E(document.body,"mbCOVER")&&m(),"openglossmark"===f.mode&&d("METABOOKOPENGLOSSMARK")&&(d("METABOOKOPENGLOSSMARK").id="",y(document.body,"openglossmark")),f.textinput&&f.setFocus(!1),f.focusBody(),f.skimpoint&&(e=f.getDups(f.target),f.clearHighlights(e),y(e,"mbhighlightpassage")),y(T,"openheart"),y(T,"openhead"),y(document.body,"dimmed"),y(document.body,"mbSHOWHELP"),y(document.body,"mbPREVIEW"),y(document.body,
"mbSHRINK"),y(T,P),y(f.menu,P),metaBook.cxthelp=!1,b?f.setHUD(!1):n(!1)}function v(a){D.mode&&g("changeMode %o, cur=%o dbc=%o",a,f.mode,document.body.className);y(f.menu,P);y(T,P);G(T,a);G(f.menu,a);"openglossmark"!==a&&"openglossmark"===f.mode&&(d("METABOOKOPENGLOSSMARK")&&(d("METABOOKOPENGLOSSMARK").id=""),y(document.body,"openglossmark"));if("statictoc"===a){var b=d("MBTOC4"+(f.head&&f.head.id&&f.docinfo[f.head.id]).frag),e=fdjt.ID("METABOOKSTATICTOC");E(e,"mbsyncslice")&&(fdjt.showPage.check(e),
0===b.offsetHeight&&fdjt.showPage.showNode(e,b))}else if(f.slices[a]){var b=f.location,e=f.slices[a],h=e.container;e.setLive(!0);E(h,"mbsyncslice")&&e.setLocation(b)}else f.pagers[a]&&fdjt.showPage.check(f.pagers[a]);if(N[a]){var b=N[f.mode],k=0<=b.search(/[.#]/)?c.$1(b):d(b);!k||f.touch&&!O(k,f.DOM.foot)||setTimeout(function(){f.setFocus(k)},50)}else"addgloss"===a&&f.glossform?(b=f.glossform,e=f.getGlossMode(b),f.setGlossMode(e,b)):setTimeout(f.focusBody,50);f.slices[a]&&f.slices[a].setLive(!0)}
function k(){if(!r&&!f.appinit){var a="";document.location.search&&(a="?"===document.location.search[0]?a+document.location.search.slice(1):a+document.location.search);a.length&&"&"!==a[a.length-1]&&(a+="&");var b=f.refuri,c="https://"+f.server+"/flyleaf?"+a;0>a.search("REFURI=")&&(c=c+"REFURI="+encodeURIComponent(b));0>a.search("TOPURI=")&&(c=c+"&TOPURI="+encodeURIComponent(document.location.href));document.title&&(c=c+"&DOCTITLE="+encodeURIComponent(document.title));f.user&&(c=c+"&BOOKUSER="+encodeURIComponent(f.user._id));
document.location.hash&&(c=c+"&HASH="+document.location.hash.slice(1));d("BOOKHUBAPP").src=c;r=!0}}function x(a,h){var k=d("METABOOKSKIMMER"),m=f.skimpoint,t=p(a);if(t){var n=t.getInfo(a);if(n){a=n.dom||a;t.mode&&f.mode!==t.mode&&e(t.mode);n=w(n.passage||n.id);"number"!==typeof h&&(h=0);O(a,f.DOM.allglosses)?metaBook.skimming=f.slices.allglosses:O(a,d("METABOOKSEARCHRESULTS"))?metaBook.skimming=f.slices.searchresults:O(a,d("METABOOKSTATICTOC"))?metaBook.skimming=f.slices.statictoc:f.skimming=!0;D.mode&&
g("metaBookSkim() %o (card=%o) mode=%o scn=%o/%o dir=%o",n,a,f.mode,f.skimpoint,f.target,h);if(m!==a){var l=a.cloneNode(!0);l.id="METABOOKSKIM";c.replace("METABOOKSKIM",l);l.offsetHeight>k.offsetHeight?G(k,"oversize"):y(k,"oversize");t.setSkim(a);t.atStart?d("MBPAGELEFT").innerHTML="":d("MBPAGELEFT").innerHTML="<span>-"+t.skimpos+"</span>";t.atEnd?d("MBPAGERIGHT").innerHTML="":d("MBPAGERIGHT").innerHTML="<span>"+(t.visible.length-t.skimpos-1)+"+</span>";m&&y(m,"skimpoint");a&&G(a,"skimpoint");metaBook.skimpoint=
a}k=document.body;m=d("METABOOKSKIMMER");G(k,"mbSKIMMING");t.atEnd?G(k,"mbSKIMEND"):y(k,"mbSKIMEND");t.atStart?G(k,"mbSKIMSTART"):y(k,"mbSKIMSTART");y(m,"mbfoundhighlights");f.GoTo(n,"Skim");f.target&&f.clearHighlights(f.getDups(f.target));f.setTarget(n);k=a;t=[];if(k&&E(k,"gloss"))if(t=f.glossdb.ref(k.name),t.excerpt){if(n=f.getDups(n.id),t=f.findExcerpt(n,t.excerpt,t.exoff))b.Highlight(t,"mbhighlightexcerpt"),G("METABOOKSKIMMER","mbfoundhighlights")}else"#"===k.about[0]?G(f.getDups(k.about.slice(1)),
"mbhighlightpassage"):G(f.getDups(k.about),"mbhighlightpassage");else if(k&&F(k,".searchslice")&&(n=w(k.about))){var k=f.docinfo[n.id],m=f.query.tags,l=k.knodeterms,r=0,q=m.length;if(0===q)G(f.getDups(n),"mbhighlightpassage");else for(;r<q;)var u=m[r++],u=f.highlightTerm(u,n,k,l),t=t.concat(u)}}else g.warn("No info for skimming to %s in %s",a,t)}else g.warn("Can't determine slice for skimming to %o",a)}function p(a){var b=f.slices[f.mode];return b&&b.getInfo(a)?b:a.nodeType?O(a,f.DOM.allglosses)?
f.slices.allglosses:O(a,d("METABOOKSEARCHRESULTS"))?f.searchresults:!1:"string"===typeof a?f.glossdb.probe(a)?f.slices.allglosses:f.docinfo[a]?f.slices.statictoc:!1:!1}var u=fdjt.Time,q=fdjt.State,g=fdjt.Log,c=fdjt.DOM,b=fdjt.UI,d=fdjt.ID,A=b.TapHold,w=metaBook.ID,f=metaBook,D=f.Trace,J=f.TOCSlice,G=c.addClass,y=c.dropClass,E=c.hasClass,F=c.getParent,O=c.hasParent,M=fdjt.String.hasSuffix,I=f.fixStaticRefs,t=!1,T=!1,K=!1;metaBook.initHUD=function(){function h(a){var b=a.origin;D.messages&&g("Got a message from %s with payload %j",
b,a.data);0!==b.search(/https?:\/\/[^\/]+.(bookhub\.io|metabooks\.net|sbooks\.net)/)?g.warn("Rejecting insecure message from %s: %s",b,a.data):"sbooksapp"===a.data?e("sbooksapp"):"metabooksapp"===a.data?e("sbooksapp"):"loggedin"===a.data?f.user||f.userSetup():"string"===typeof a.data&&0===a.data.search("setuser=")?f.user||(metaBook.userinfo=JSON.parse(a.data.slice(8)),f.loginUser(f.userinfo),e("welcome"),f.userSetup()):a.data.updateglosses?f.updateInfo():a.data.addlayer?f.updateInfo():a.data.droplayer||
a.data.hidelayer||a.data.showlayer?f.refreshOffline():a.data.userinfo?f.user||(metaBook.userinfo=a.data.userinfo,f.loginUser(f.userinfo),e("welcome"),f.userSetup()):a.data&&c("METABOOKINTRO",a.data)}if(!d("METABOOKHUD")){var k=u(),m=c("div#METABOOKSTARTUPMESSAGES.startupmessages");m.innerHTML=I(metaBook.HTML.messages);2<D.startup&&g("Initializing HUD layout");metaBook.HUD=T=c("div#METABOOKHUD.metabookhud");T.innerHTML=I(f.HTML.hud);T.metabookui=!0;c.append(m);d("METABOOKFRAME")?t=d("METABOOKFRAME"):
(t=c("div#METABOOKFRAME"),!f.dontanimate&&f.getConfig("animatehud")&&G(t,"_ANIMATE"),c.prepend(document.body,t));G(t,"metabookframe");G(t,"tapholdcontext");t.appendChild(m);t.appendChild(T);f.getConfig("uisize")&&G(t,"metabookuifont"+f.getConfig("uisize"));metaBook.Frame=t;d("METABOOKHUDHELP").innerHTML=I(f.HTML.hudhelp);d("METABOOKAPPHELP").innerHTML=I(f.HTML.help);m=d("METABOOKHEARTBODY");m.innerHTML=I(f.HTML.heart);metaBook.DOM.heart=m;d("METABOOKGLOSSATTACH").innerHTML=I(f.HTML.attach);metaBook.DOM.heart=
m;metaBook.DOM.head=d("METABOOKHEAD");metaBook.DOM.heart=d("METABOOKHEARTBODY");metaBook.DOM.foot=d("METABOOKFOOT");metaBook.DOM.tabs=d("METABOOKTABS");metaBook.DOM.noteshud=d("METABOOKNOTETEXT");metaBook.DOM.asidehud=d("METABOOKASIDE");metaBook.DOM.pagebar=d("METABOOKPAGEBAR");d("METABOOKSEARCH").innerHTML=I(f.HTML.searchbox);G(f.HUD,"emptysearch");d("METABOOKADDGLOSSPROTOTYPE").innerHTML=I(f.HTML.addgloss);metaBook.UI.addHandlers(T,"hud");1<D.startup&&g("Created basic HUD in %dms",u()-k);if(!f.svg){var m=
c.getChildren(T,"img"),n=0,p=m.length;for(D.startup&&g("Switching images to SVG");n<p;){var r=m[n++];r.src&&(M(r.src,".svg")||M(r.src,".svgz"))&&r.getAttribute("bmp")&&(r.src=r.getAttribute("bmp"))}}metaBook.hudtick=u();c.setInputs(".metabookrefuri",f.refuri);c.setInputs(".metabookdocuri",f.docuri);c.setInputs(".metabooktopuri",f.topuri);metaBook.DOM.allglosses=d("METABOOKALLGLOSSES");2<D.startup&&f.DOM.allglosses&&g("Setting up gloss UI %o",K);metaBook.slices.allglosses=K=new f.Slice(f.DOM.allglosses);
metaBook.slices.allglosses.mode="allglosses";metaBook.glossdb.onAdd("maker",function(a,b,c){f.sourcedb.ref(c).oninit(f.UI.addGlossSource,"newsource")});metaBook.glossdb.onAdd("sources",function(a,b,c){f.sourcedb.ref(c).oninit(f.UI.addGlossSource,"newsource")});metaBook.glossdb.onLoad(a);D.messages&&g("Setting up message listener");c.addListener(window,"message",h);metaBook.TapHold.foot=new b.TapHold(metaBook.DOM.foot,{override:!0,holdfast:!0,taptapmsecs:0,holdmsecs:150,minswipe:0});metaBook.TapHold.head=
new A(f.DOM.head,{override:!0,taptapmsecs:0,holdmsecs:200});metaBook.DOM.skimmer=d("METABOOKSKIMMER");metaBook.TapHold.skimmer=new A(f.DOM.skimmer,{taptapmsecs:300});metaBook.DOM.sources=d("METABOOKSOURCES");metaBook.TapHold.sources=new A(f.DOM.sources,{taptapmsecs:300});(f.DOM.help=d("METABOOKHELP")).innerHTML=I(f.HTML.help);m=d("METABOOKGLOSSCLOUD");metaBook.gloss_cloud=new b.Completions(m,d("METABOOKADDTAGINPUT"),b.FDJT_COMPLETE_OPTIONS|b.FDJT_COMPLETE_CLOUD|b.FDJT_COMPLETE_ANYWORD);metaBook.TapHold.gloss_cloud=
new A(f.gloss_cloud.dom);metaBook.empty_cloud=new b.Completions(d("METABOOKALLTAGS"),!1,b.FDJT_COMPLETE_OPTIONS|b.FDJT_COMPLETE_CLOUD|b.FDJT_COMPLETE_ANYWORD);f.adjustCloudFont&&(metaBook.empty_cloud.updated=function(){f.adjustCloudFont(this)});metaBook.DOM.empty_cloud=d("METABOOKALLTAGS");metaBook.TapHold.empty_cloud=new A(f.empty_cloud.dom);m=d("METABOOKSHARECLOUD");metaBook.share_cloud=new b.Completions(m,d("METABOOKADDSHAREINPUT"),b.FDJT_COMPLETE_OPTIONS|b.FDJT_COMPLETE_CLOUD|b.FDJT_COMPLETE_ANYWORD);
metaBook.DOM.share_cloud=m;metaBook.TapHold.share_cloud=new A(f.share_cloud.dom);c.setupCustomInputs(d("METABOOKHUD"));1<D.startup&&g("Initialized basic HUD in %dms",u()-k)}};metaBook.resizeHUD=function(){fdjt.DOM.adjustFonts(f.HUD)};metaBook.addGloss2UI=a;metaBook.setupTOC=function(a){var b=c("div#METABOOKSTATICTOC.metabookslice.mbtocslice.hudpanel");c.replace("METABOOKSTATICTOC",b);a=new J(a,b);metaBook.tocslice=a;metaBook.slices.statictoc=a;metaBook.setupGestures(b);return a};metaBook.setHUD=n;
metaBook.showCover=h;metaBook.hideCover=m;metaBook.toggleCover=function(){E(document.body,"mbCOVER")?m():h()};var P=/\b((search)|(refinesearch)|(expandsearch)|(searchresults)|(openglossmark)|(allglosses)|(context)|(statictoc)|(minimal)|(addgloss)|(gotoloc)|(gotoref)|(gotopage)|(shownote)|(showaside)|(glossdetail))\b/g,C=/\b((statictoc)|(search)|(refinesearch)|(expandsearch)|(searchresults)|(allglosses)|(showaside)|(glossaddtag)|(glossaddtag)|(glossaddoutlet)|(glossdetail))\b/g,U=/\b((search)|(refinesearch)|(expandsearch)|(searchresults)|(allglosses)|(addgloss)|(shownote))\b/g,
V=/\b((glossdetail))\b/g,B=/\b((welcome)|(help)|(layers)|(login)|(settings)|(cover)|(aboutsbooks)|(aboutmetabooks)|(console)|(aboutbook)|(titlepage))\b/g;metaBook.searchModes=/((refinesearch)|(searchresults)|(expandsearch))/;var N={gotopage:"METABOOKPAGEINPUT",gotoloc:"METABOOKLOCINPUT",gotoref:"METABOOKREFINPUT",search:"METABOOKSEARCHINPUT",refinesearch:"METABOOKSEARCHINPUT",expandsearch:"METABOOKSEARCHINPUT"};metaBook.toggleMode=function(a,b){f.mode?a===f.mode?b?e(!0):e(!1):"heart"===a&&0===f.mode.search(C)?
b?e(!0):e(!1):e(a):e(a)};metaBook.dropHUD=function(){return e(!1)};metaBook.toggleHUD=function(a){a=a||window.event;a&&b.isClickable(b.T(a))||(g("toggle HUD %o hudup=%o",a,f.hudup),f.hudup?n(!1,!1):n(!0))};var r=!1;metaBook.initIFrameApp=k;metaBook.selectApp=function(){"sbooksapp"===f.mode?e(!1):e("sbooksapp")};metaBook.stopSkimming=function(){var a=f.skimpoint;f.skimming&&(y(document.body,"mbSKIMMING"),f.skimming=!1,F(a,d("METABOOKALLGLOSSES"))?e("allglosses"):F(a,d("METABOOKSTATICTOC"))?e("statictoc"):
F(a,d("METABOOKSEARCHRESULTS"))&&e("searchresults"))};var da=c.requestAnimationFrame;metaBook.SkimTo=function(a,b){da(function(){x(a,b)})};metaBook.SkimTo=x;metaBook.getSlice=p;metaBook.addConfig("uisize",function(a,b){c.swapClass(f.Frame,/metabookuifont\w+/g,"metabookuifont"+b);fdjt.Async(function(){f.resizeUI()});fdjt.Async(function(){f.updateSettings(a,b)})});metaBook.addConfig("dyslexical",function(a,b){var d=document.documentElement||document.body;if(b&&"string"===typeof b&&/yes|on|t/i.exec(b)){if(E(d,
"_DYSLEXICAL"))return;metaBook.dyslexical=!0;G(d,"_DYSLEXICAL")}else if(E(d,"_DYSLEXICAL"))metaBook.dyslexical=!1,c.dropClass(d,"_DYSLEXICAL");else return;fdjt.Async(function(){f.resizeUI();f.layout&&f.Paginate("typechange")},10)});metaBook.addConfig("animatecontent",function(a,b){f.dontanimate||(b?G(document.body,"_ANIMATE"):y(document.body,"_ANIMATE"));fdjt.Async(function(){f.updateSettings(a,b)})});metaBook.addConfig("animatehud",function(a,b){f.dontanimate||(b?G("METABOOKFRAME","_ANIMATE"):y("METABOOKFRAME",
"_ANIMATE"));fdjt.Async(function(){f.updateSettings(a,b)})});metaBook.keyboardHelp=function(a,b){if(!0===a)f.keyboardHelp.timer&&(clearTimeout(f.keyboardHelp.timer),f.keyboardHelp.timer=!1),y("METABOOKKEYBOARDHELPBOX","closing"),y("METABOOKKEYBOARDHELPBOX","closed");else if(!1===a)f.keyboardHelp.timer&&(clearTimeout(f.keyboardHelp.timer),f.keyboardHelp.timer=!1),G("METABOOKKEYBOARDHELPBOX","closed"),y("METABOOKKEYBOARDHELPBOX","closing");else if(b||f.keyboardhelp)if("string"===typeof a&&(a=d(a)),
a&&a.nodeType){var e=d("METABOOKKEYBOARDHELPBOX"),g=a.cloneNode(!0);g.id="METABOOKKEYBOARDHELP";c.replace("METABOOKKEYBOARDHELP",g);c.dropClass(e,"closed");metaBook.keyboardHelp.timer=setTimeout(function(){c.addClass(e,"closing");metaBook.keyboardHelp.timer=setTimeout(function(){metaBook.keyboardHelp.timer=!1;c.swapClass(e,"closing","closed")},5E3)},5E3)}};metaBook.showGloss=function(a){if(!f.glossdb.ref(a))return!1;if((a=document.getElementsByName(a))&&a.length)for(var b=c.hasParent,d=0,g=a.length;d<
g;){var h=a[d++];if(b(h,K))return e("allglosses"),f.SkimTo(h),!0}return!1};metaBook.hideHelp=function(){c.dropClass(document.body,"mbSHOWHELP")};metaBook.showHelp=function(){c.addClass(document.body,"mbSHOWHELP")};return e}();(function(){function a(a,d){var e=window.scrollLeft||0,m=window.scrollTop||0;a?(a.frag&&(a=a.frag),"string"===typeof a&&(a=x(a)),a&&(c=a,g||(g={x:0,y:m}),e=n.getGeometry(a,k.content),u.flips&&h("startScrollPreview/%s to %d for %o",d||"nocaller",e.top-100,a),e=e.top-(n.viewHeight()-50)/2,0>e&&(e=0),window.scrollTo(0,e))):(g?(u.flips&&h("stopScrollPreview/%s to %j from %d,%d(%o)",d||"nocaller",g,e,m,c),c=!1,window.scrollTo(g.x,g.y)):(u.flips&&h("stopScrollPreview/%s to %j from %d,%d(%o)",d||"nocaller",
g,e,m,c),c=!1),g=!1)}var n=fdjt.DOM,h=fdjt.Log,m=n.dropClass,e=n.addClass,v=n.hasClass,k=metaBook,x=k.ID,p=k.getTarget,u=k.Trace,q=k.GoTo,g=!1,c=!1;metaBook.startPreview=function(b,c){var g=b.nodeType?b:x(b);(u.flips||u.preview)&&h("startPreview %o (%s)",g,c);k.skimming&&k.stopSkimming();if(k.layout instanceof fdjt.CodexLayout){var m=p(g)&&k.getDups(g);k.startPagePreview(g,c);e(g,"mbpreviewing");m&&e(m,"mbpreviewing")}else a(g,c),e(g,"mbpreviewing");metaBook.previewing=g;e(document.body,"mbPREVIEW");
v(g,"codexpage")&&e(document.body,"mbPAGEPREVIEW");return g};metaBook.stopPreview=function(b,c){for(var e=n.$(".mbpreviewing"),p=0,f=e.length;p<f;){var v=e[p++];m(v,"mbpreviewing");k.clearHighlights(v)}c&&!c.nodeType&&(c=k.previewTarget||k.previewing);(u.flips||u.preview)&&h("stopPreview/%s jump to %o, pt=%o, p=%o",b||"nocaller",c,k.previewTarget,k.previewing);k.layout instanceof fdjt.CodexLayout?k.stopPagePreview(b,c):(c&&c===k.previewing&&(g=!1),a(!1,b));k.previewing=!1;k.previewTarget=!1;m(document.body,
"mbPREVIEW");m(document.body,"mbPAGEPREVIEW");c&&(k.hudup&&k.setHUD(!1),q(c));return!1}})();(function(){function a(){var a=g.layout;q.resize&&v("Real resize w/layout=%o",a);y&&(clearTimeout(y),y=!1);m();g.resizeUI();g.sizeContent();a&&g.scaleLayout(!1);if(g.touch&&(g.textinput||document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable)))q.resize&&v("Resize for soft keyboard, mostly ignoring");else if(window.outerWidth===d&&window.outerHeight===b)a&&metaBook.scaleLayout(!0),q.resize&&v("Resize to norm, ignoring");
else{h();d=window.outerWidth;b=window.outerHeight;var f=c(k("CODEXPAGE"),!1,!0).width,p=c(k("CODEXPAGE"),!1,!0).inner_height;a&&a.width===f&&a.height===p?q.resize&&v("Layout size unchanged, ignoring"):a&&a.onresize&&!metaBook.freezelayout&&(metaBook.long_layout_thresh&&a.started&&a.done-a.started<=metaBook.long_layout_thresh?y=setTimeout(n,50):F||(metaBook.layoutCached()?y=setTimeout(n,50):(a=e("div.title","Update layout?"),metaBook.scaleLayout(!0),F=!0,F=u.choose({choices:[{label:"Yes",handler:function(){F=
!1;A=!0;metaBook.layout_choice_timeout=10;y=setTimeout(n,50)},isdefault:A},{label:"No",handler:function(){A=F=!1;metaBook.layout_choice_timeout=10},isdefault:!A}],timeout:metaBook.layout_choice_timeout||metaBook.choice_timeout||20,spec:"div.fdjtdialog.fdjtconfirm.updatelayout"},a))))}}function n(a){y&&clearTimeout(y);y=!1;metaBook.layout.onresize(a)}function h(){for(var a=e.$(".fdjtpage"),b=0,c=a.length;b<c;){var d=a[b++];d.offsetHeight?p.update(d):x(d,"needsresize")}}function m(){var a=e.addClass,
b=document.body,c=e.viewWidth(),d=e.viewHeight();e.dropClass(b,G);700>c?a(b,"_NARROW"):1200<c&&a(b,"_WIDE");350>d?a(document.body,"_REALLYSHORT"):600>d?a(document.body,"_SHORT"):1200<d&&a(document.body,"_TALL")}var e=fdjt.DOM,v=fdjt.Log,k=fdjt.ID,x=e.addClass,p=fdjt.showPage,u=fdjt.UI,q=metaBook.Trace,g=metaBook,c=e.getGeometry,b=window.outerHeight,d=window.outerWidth,A=!1,w=!1,f=[],D=!1,J=!1;metaBook.resizeUI=function(a){"number"!==typeof a&&(a=100);return new Promise(function(b){w&&clearTimeout(w);
w=setTimeout(function(){var a=e.viewHeight(),b=e.viewWidth();if(b!==D||a!==J){var c=fdjt.Time(),d=k("METABOOKHUD"),h=k("METABOOKCOVER");J=a;D=b;h&&g.resizeCover(h);d&&g.resizeHUD(d);(d||h)&&v("Resized UI in %fsecs, running %d callbacks",(fdjt.Time()-c)/1E3,f.length)}a=f;w=!1;f=[];b=0;for(c=a.length;b<c;)a[b++]()},a);f.push(b)})};metaBook.resize=a;var G=/\b_(NARROW|WIDE|REALLYSHORT|SHORT|TALL)\b/g;metaBook.updateSizeClasses=m;var y=!1,E=!1,F=!1;metaBook.resizeHandler=function(b){b=b||window.event;
q.resize&&v("Resize event %o, waiting=%o",b,E);E&&clearTimeout(E);F&&(q.resize&&v("Close resize dialog %o",b),fdjt.Dialog.close(F),F=!1);E=setTimeout(a,metaBook.resize_wait)}})();(function(){function a(a,b){"string"===typeof a&&(a=p.resolve(a));var c=a.humid;if(a.name){if(b){var d=u("SBOOKSOURCEICON"+c);if(!d){var d=a._pic||a.pic||a.fbid&&"https://graph.facebook.com/"+a.fbid+"/picture?type=square",e=a.kind;d||(d=":CIRCLE"===e||a.iscircle?A("readingcircle",64,64):A("sideguide",64,64));d=d?k.Image(d,".button.source",a.name|a.kind,"click to show/hide glosses from "+a.name):k("div.button.source",q(a.name));d.title=(":CIRCLE"===e?"the reading circle ":":OVERLAY"===e?"the reading guide ":
"the layer ")+(a.name?"\u201c"+a.name+"\u201d":"")+(a.about?": ":"")+(a.about?a.about:"");d.oid=a._id;a.name&&(d.alt=q(a.name));d.id="SBOOKSOURCEICON"+c;k(u("METABOOKSOURCES")," ",d)}}return a}}function n(a){a=a||window.event||null;var b=k.T(a),e=u("METABOOKSOURCES"),f=u("METABOOKALLGLOSSES"),h=[];if(e&&f&&b&&b.oid){f=k.$(".selected",e);d(b,"selected");a.shiftKey||c(f,"selected");for(var f=k.$(".selected",e),b=0,m=f.length;b<m;)h.push(f[b++].oid);e=k.$(".everyone",e)[0];h.length?(e&&c(e,"selected"),
metaBook.UI.selectSources(metaBook.slices.allglosses,h)):(e&&g(e,"selected"),metaBook.UI.selectSources(metaBook.slices.allglosses,!1));k.cancel(a)}}function h(a){a=a||window.event||null;var b=k.T(a),e=u("METABOOKSOURCES"),f=u("METABOOKALLGLOSSES"),h=[];if(e&&f&&b&&b.oid){f=k.$(".selected",e);d(b,"selected");for(var f=k.$(".selected",e),b=0,m=f.length;b<m;)h.push(f[b++].oid);e=k.$(".everyone",e)[0];h.length?(e&&c(e,"selected"),metaBook.UI.selectSources(metaBook.slices.allglosses,h)):(e&&g(e,"selected"),
metaBook.UI.selectSources(metaBook.slices.allglosses,!1));k.cancel(a)}}function m(a){return a._pic||a.pic||a.fb_pic||a.twitter_pic||a.gplus_pic||a.fbid&&"https://graph.facebook.com/"+a.fbid+"/picture?type=square"}function e(a,b,c){var d=metaBook.sourcedb,e=metaBook.glossdb;c||(c=k.getChild(a,".wedge"));var f=c.getAttribute("data-images").split("|");1===f.length&&""===f[0]&&(f=[]);for(var g=0,h=b.length;g<h;){var t=b[g++];"string"!==typeof t&&(t=t._id);if(t){var n=e.ref(t),p=a.glosses,q=n.maker&&d.ref(n.maker);
(q=q&&m(q))&&f.push(q);p?0>p.indexOf(t)&&p.push(t):a.glosses=[t];t=n.sources||[];"string"===typeof t&&(t=[t]);n=0;for(p=t.length;n<p;)q=d.ref(t[n++]),(q=m(q))&&f.push(q)}}c.setAttribute("data-images",f.join("|"));return a}function v(a,b){return a.location&&b.location?a.location>b.location?-1:a.location<b.location?1:0:a.exoff&&b.exoff?a.exoff>b.exoff?-1:a.exoff<b.exoff?1:0:a.created>b.created?-1:a.created<b.created?1:0}var k=fdjt.DOM,x=fdjt.UI,p=fdjt.RefDB,u=fdjt.ID,q=fdjt.String.getInitials,g=k.addClass,
c=k.dropClass,b=k.hasClass,d=k.toggleClass,A=metaBook.icon,w=metaBook;metaBook.UI.addSource=a;metaBook.UI.addGlossSource=function(b){a(b,!0)};metaBook.UI.handlers.everyone_ontap=function(a){a=a||window.event||null;var b=k.T(a),c=u("METABOOKSOURCES"),e=u("METABOOKALLGLOSSES");c&&e&&(k.hasClass(b,"selected")?metaBook.setMode(!1):(c=k.$(".selected",c),d(c,"selected"),g(b,"selected"),metaBook.UI.selectSources(metaBook.slices.allglosses,!1)),k.cancel(a))};metaBook.UI.addGlossmark=function(a,b){var c=metaBook.glossdb,
d=k.getChild(a,".glossmark");if(d&&d.parentNode===a)return b&&e(d,[b]),d;var d=A("sbwedge",64,64),f=k.Image(d,"wedge","glosses"),h=k("a.glossmark.fdjtskiptext",f),m=a.getAttribute("data-baseid")||a.id,c=c.find("frag",m);h.title=1<c.length?"See "+c.length+" glosses on this passage":"See the gloss on this passage";f.defaultsrc=d;f.setAttribute("data-images","");e(h,c,f);metaBook.UI.addHandlers(h,"glossmark");g(a,"glossed");k.prepend(a,h);h.name="METABOOK_GLOSSMARK_"+m;return h};var f=metaBook.Slice;
metaBook.showGlossmark=function(a,c){var d=a.codexbaseid||a.id;if(d){var e=metaBook.getDups(d),h=metaBook.glossdb.find("frag",d),m=[],d=k("div.metabookglosses.metabookslice");h&&h.length||g(d,"noglosses");metaBook.target&&metaBook.clearHighlights(metaBook.target);for(var n=0,p=h.length;n<p;){var t=metaBook.glossdb.ref(h[n++]);m.push(t)}for(n=0;n<p;)h=m[n++],h.excerpt&&(h=metaBook.findExcerpt(e,h.excerpt,h.exoff))&&(b(h.startContainer,"mbhighlightexcerpt")||x.Highlight(h,"mbhighlightexcerpt"));e=new f(d,
m,v);m=k("div.hudpanel#METABOOKPOINTGLOSSES",d);metaBook.openglossmark=e;if(c){w.setMode(!1);m.style.display="block";m.style.opacity=0;u("METABOOKPOINTGLOSSES")?k.replace("METABOOKPOINTGLOSSES",m):w.body.appendChild(m);n=k.getGeometry(d);k.getGeometry(m);var p=k.getGeometry(c),h=k.getGeometry(a),t=k.viewWidth(),q=k.viewHeight();if(metaBook.fullwidth)m.style.left="10px",m.style.width=m.style.maxWidth=m.style.minWidth=t-30+"px";else if(n.width>t)m.style.maxWidth=t-20+"px",m.style.minWidth=Math.floor(t/
2)+"px",m.style.left="10px";else if(n.height>q/2||500>t)500>t?(m.style.maxWidth=t-20+"px",m.style.minWidth=Math.floor(t/2)+"px",m.style.left="10px"):m.style.maxWidth=t-100+"px";n=k.getGeometry(d);k.getGeometry(m);!metaBook.fullwidth&&n.width>t-50&&(m.style.left="10px");var A=!1,A=n.height+15>q/2?q/2:n.height+10;!metaBook.fullwidth&&50<A&&(m.style.minHeight=A+"px");d.style.overflowX="hidden";d.style.overflowY="auto";var d=p.top-60,D=q-60-p.bottom,C=q-60-h.bottom;h.bottom<p.bottom&&(h.bottom=p.bottom+
10);A<d?m.style.top=p.top-(A+15)+"px":n.height<C?m.style.top=h.bottom+5+"px":n.height<D?m.style.top=p.bottom+15+"px":(metaBook.fullwidth||(m.style.right=t-p.left+10+"px",m.style.left="50px"),m.style.top=50>p.top-q/4?"50px":p.top-q/4+"px",m.style.bottom="auto",m.style.height=q/2+"px");!metaBook.fullwidth&&300>k.viewWidth()&&(m.style.minWidth=k.viewWidth()-10+"px");m.style.display="";m.style.opacity=""}else k.replace("METABOOKPOINTGLOSSES",m);if(c){if(d=u("METABOOKOPENGLOSSMARK"))metaBook.target&&metaBook.clearHighlights(metaBook.target),
d.id="";c.id="METABOOKOPENGLOSSMARK"}metaBook.setTarget(a);e.update();metaBook.setMode("openglossmark")}};metaBook.clearGlossmark=function(){"openglossmark"===metaBook.mode&&metaBook.setMode(!1,!0);var a=k("div.metabookglosses.metabookslice"),a=k("div.hudpanel#METABOOKPOINTGLOSSES",a);k.replace("METABOOKPOINTGLOSSES",a)};var D=x.cancel;fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{"#METABOOKSOURCES":{tap:n,taptap:h},"#METABOOKSOURCES .button.everyone":{tap:function(a){a=a||window.event;metaBook.UI.handlers.everyone_ontap(a);
fdjt.UI.cancel(event)}}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{"#METABOOKSOURCES":{tap:n,taptap:h},"#METABOOKSOURCES .button.everyone":{touchstart:D,touchend:function(a){a=a||window.event;metaBook.UI.handlers.everyone_ontap(a);fdjt.UI.cancel(event)}}})})();(function(){function a(a){a instanceof A||(a=new metaBook.Query(a));if(a===metaBook.query)return a;p.search&&J("Setting working query to %o",a);if(0===a.tags.length)w(metaBook.HUD,"emptysearch"),metaBook.empty_cloud.dom.style.fontSize="",metaBook.search_cloud=metaBook.empty_cloud,g.replace("METABOOKSEARCHCLOUD",g("div#METABOOKSEARCHCLOUD")),n(a,b("METABOOKSEARCH")),metaBook.empty_cloud.complete(""),w(metaBook.HUD,"emptysearch"),metaBook.query=x.empty_query,metaBook.qstring="";else{f(metaBook.HUD,
"emptysearch");x.empty_cloud.complete("");var c=a.getString();c!==metaBook.qstring&&(n(a,b("METABOOKSEARCH")),metaBook.query=a,metaBook.qstring=c);y.exec(metaBook.mode)&&0!==a.results.length&&(7>a.results.length?m():metaBook.touch||b("METABOOKSEARCHINPUT").focus());return a}}function n(a,c){c&&"string"===typeof c&&(c=document.getElementById(c));var d=c||a._box||b("METABOOKSEARCH"),e=a.getString();a.dom&&d&&d!==a.dom&&g.replace(c,a.dom);d.setAttribute("qstring",e);a.execute();var f=a.getCoTags(),h=
a.getRefiners(),k=D(d,".searchinput"),m=k.getAttribute("completions"),n=k.getAttribute("info"),q=D(d,".qtags")||b("METABOOKSEARCHTAGS"),r=n&&b(n),u=D(r,".resultcount"),n=D(r,".refinecount");k.value="";var k=a.tags,v=0,y=k.length;k.length?g.dropClass(metaBook.HUD,"emptysearch"):w(metaBook.HUD,"emptysearch");g.dropClass("METABOOKSEARCHINFO","notags");for(var A=g("div.qtags");v<y;){var E=k[v];"string"===typeof E&&(E=G(E)||E);E=metaBook.cloudEntry(E,!1,!1,"span.qelt");E.appendChild(g("span.redx","x"));
g(A,0<v&&"\u00a0\u00b7 ",E);v++}q.id&&(A.id=q.id);g.replace(q,A);0!==a.tags.length&&(a.results.length?(q=1!==a.results.length,u.innerHTML=a.results.length+" <br/>"+(2<k.length?q?"results":"result":q?"matches":"match"),g.dropClass([d,r],"noresults")):(u.innerHTML="no results",w([d,r],"noresults")));A.setAttribute("data-maxfont","120%");A.setAttribute("data-min","60%");fdjt.DOM.adjustFontSize(A);var f=h?h.length:f?f.length:0,F=metaBook.queryCloud(a);n.innerHTML=f+" <br/>"+(1===f?"co-tag":"co-tags");
g.dropClass(d,"norefiners");F!==x.empty_cloud?(g.replace(m,F.dom),m&&(F.dom.id=m),w(F.dom,"hudpanel")):m="METABOOKALLTAGS";metaBook.search_cloud=F;1<p.search&&J("Setting search cloud for %o to %o",d,F.dom);F.complete("",function(){F.dom.style.fontSize="";b(m)?g.replace(m,F.dom):g.append(b("METABOOKHEARTBODY"),F.dom);metaBook.adjustCloudFont(F)});0===f&&(w(d,"norefiners"),n.innerHTML="no refiners");a._box=d;d.setAttribute("qstring",e);return a}function h(a,b){var c=[].concat(a.tags);"string"===typeof b?
0<=b.indexOf("@")?c.push(G(b)||b):c.push(b):c.push(b);return new metaBook.Query(c)}function m(){var a=metaBook.query.showResults(),c=a.container;w(c,"hudpanel");c.id="METABOOKSEARCHRESULTS";g.replace("METABOOKSEARCHRESULTS",c);x.slices.searchresults=a;metaBook.setMode("searchresults");a.update();b("METABOOKSEARCHINPUT").blur();b("METABOOKSEARCHRESULTS").focus()}function e(a,c){a||(a=b("METABOOKSEARCHINPUT"));c||(c=metaBook.queryCloud(metaBook.query));0===a.value.length&&c.clearSelection();c.complete(a.value,
function(b){0<a.value.length&&(!b||0===b.length||4<a.value.length)&&(v(c,a.value),setTimeout(function(){c.complete(a.value)},50))})}function v(a,b,c,d){c||(c=metaBook.textindex.prefixTree());d||(d=42);b=u.prefixFind(c,b);if(0!==b.length&&!(b.length>d))for(d=0,c=b.length;d<c;)metaBook.cloudEntry(b[d++],a)}function k(a){if(!(this instanceof k))return new k(a);this.query=a;this.results=a.results;this.scores=a.scores;return M.call(this,g("div.metabookslice.mbsyncslice.searchslice"),this.results)}var x=
metaBook,p=x.Trace,u=fdjt.String,q=fdjt.Log,g=fdjt.DOM,c=fdjt.UI,b=fdjt.ID,d=fdjt.RefDB,A=d.Query;metaBook.search_cloud=!1;metaBook.empty_cloud||(metaBook.empty_cloud=!1);metaBook.show_refiners||(metaBook.show_refiners=25);metaBook.search_gotlucky||(metaBook.search_gotlucky=7);var w=g.addClass,f=g.dropClass,D=g.getChild,J=q,G=d.resolve,y=/(search|refinesearch|searchresults|expandsearch)/;metaBook.getQuery=function(){return metaBook.query};metaBook.setQuery=a;var E=g.hasParent,F=g.hasParent;metaBook.searchTags_onclick=
function(b){var d=c.T(b),e=E(d,".redx");if(d=F(d,".qelt")){c.cancel(b);var d=d.getAttribute("data-value"),f;0<=d.indexOf("@")&&(f=G(d)||d);p.gestures&&q("searchTags_ontap %o: %s%o",b,e?"(onx) ":"",f);e=[].concat(metaBook.query.tags);f=f?e.indexOf(f):e.indexOf(d);0>f&&(f=e.indexOf(d));0>f||(e.splice(f,1),0===e.length?(metaBook.empty_cloud.dom.style.fontSize="",a(metaBook.empty_query)):a(new metaBook.Query(e)),c.cancel(b))}};metaBook.extendQuery=h;metaBook.updateQuery=function(a){a=Knodule.Query.string2query(a.value);
a!==metaBook.query.tags&&metaBook.setQuery(a,!1)};metaBook.showSearchResults=m;metaBook.startSearch=function(b){a([b]);metaBook.setMode("refinesearch")};var O=g.Selector;metaBook.UI.handlers.search_keydown=function(b){b=b||window.event||null;var d=b.charCode||b.keyCode,e=g.T(b),f=!1,k=!1;if(13===d||13===d||59===d||93===d){e=e.value;if(u.isEmpty(e))m();else{f=metaBook.queryCloud(metaBook.query);f.timer&&(clearTimeout(f.timer),f.timer=!1);f.complete(e);k=f.selection||f.select(new O(".cue"))||f.select();
if(!k){(b=metaBook.textindex.termindex[e])&&b.length&&a(h(metaBook.query,e));return}f=f.getValue(k);a(h(metaBook.query,f))}g.cancel(b);metaBook.search_gotlucky&&0<metaBook.query.results.length&&metaBook.query.results.length<=metaBook.search_gotlucky?m():(f=metaBook.queryCloud(metaBook.query),f.complete(""));return!1}9===d&&(d=e.value,f=metaBook.queryCloud(metaBook.query),k=f.complete(d),c.cancel(b),k.prefix&&k.prefix!==d?(e.value=k.prefix,g.cancel(b),f.selectNext()):b.shiftKey?f.selectPrevious():
f.selectNext())};metaBook.UI.handlers.search_keyup=function(a){a=a||window.event||null;var b=a.charCode||a.keyCode,c=g.T(a);13!==b&&13!==b&&59!==b&&93!==b&&9!==b&&(8===b?setTimeout(function(){e(c)},100):e(c))};metaBook.UI.handlers.search_keypress=function(a){a=a||window.event||null;var b=a.charCode||a.keyCode;a=g.T(a);13!==b&&13!==b&&59!==b&&93!==b&&9!==b&&8!==b&&e(a)};metaBook.searchUpdate=e;metaBook.UI.handlers.search_focus=function(a){a=a||window.event||null;a=g.T(a);metaBook.setFocus(a);metaBook.mode&&
"searchresults"===metaBook.mode&&metaBook.setMode("refinesearch");e(a)};metaBook.UI.handlers.search_blur=function(a){a=a||window.event||null;a=g.T(a);metaBook.clearFocus(a)};metaBook.UI.handlers.clearSearch=function(b){var d=c.T(b||window.event),d=g.getParent(d,".searchbox"),d=D(d,".searchinput");c.cancel(b);0===metaBook.query.tags.length&&0===d.value.length?metaBook.setMode(!1):(metaBook.empty_cloud.dom.style.fontSize="",a(metaBook.empty_query),d.value="",metaBook.empty_cloud.clearSelection(),metaBook.empty_cloud.complete(""),
metaBook.setMode("refinesearch"))};var M=metaBook.Slice;metaBook.SearchResults=k;k.prototype=new M;k.prototype.renderCard=function(a){return metaBook.renderCard(a,this.query)};k.prototype.sortfn=function(a,b){if("number"===typeof a.score&&"number"===typeof b.score){if(a.score!==b.score)return b.score-a.score}else{if("number"===typeof a.score)return-1;if("number"===typeof b.score)return 1}if("number"===typeof a.location&&"number"===typeof b.location){if(a.location!==b.location)return a.location-b.location}else{if("number"===
typeof a.location)return-1;if("number"===typeof b.location)return 1}if("number"===typeof a.timestamp&&"number"===typeof b.timestamp){if(a.timestamp!==b.timestamp)return a.timestamp-b.timestamp}else{if("number"===typeof a.timestamp)return-1;if("number"===typeof b.timestamp)return 1}return 0};d.Query.prototype.showResults=function(){var a;this.listing||(this.listing=new k(this));a=this.listing;return a}})();(function(){function a(a,b,c){function d(b){var e=ba(f,".metabookglossform"),g=!1,g=Q.getInput(f,"FRAG"),h=Q.getInput(f,"UUID");(pa.mode||pa.glossing)&&ka("setGlossMode %o%s: #%s #U%s",a,c?" (toggle)":"",g&&g.value,h&&h.value);c&&a===f.className&&(a=!1);a&&ta(e,"focused");if(a){if("addtag"===a)g=ma("METABOOKADDTAGINPUT");else if("attach"===a)ma("METABOOKUPLOADGLOSSID").value=h.value,ma("METABOOKUPLOADITEMID").value=ha.getUUID(),g=ma("METABOOKATTACHURL");else if("addoutlet"===a)g=ma("METABOOKADDSHAREINPUT");
else return ia(f,la),ia("METABOOKHUD",/\bgloss\w+\b/),b(f);(pa.mode||pa.glossing)&&ka("setGlossMode gm=%s input=%o",a,g);f.className=a;Sa("METABOOKHUD",/\bgloss\w+\b/,"gloss"+a);metaBook.setHUD(!0);a&&/(addtag|addoutlet)/.exec(a)&&ta("METABOOKHUD","openheart");g&&metaBook.setFocus(g);return b(f)}ia(f,la);ia("METABOOKHUD",/\bgloss\w+\b/);ia("METABOOKHUD","openheart");metaBook.touch||((b=Aa(f,"NOTE"))&&metaBook.setFocus(b),ta(e,"focused"))}var e,f;a&&b&&a.nodeType&&"string"===typeof b?(e=a,a=b):e=b?
"string"===typeof b?ma(b):b:ma("METABOOKLIVEGLOSS");if(e&&e.nodeType){if(f="FORM"===e.tagName?e:Q.getParent(e,"form")||Q.getChild(e,"form"))return new Promise(d);ka.warn("Missing FORM for setGlossMode")}else return ka.warn("Missing DOM arg for setGlossMode"),!1}function n(a,b){"string"===typeof a&&(a=Ba(a)||metaBook.glossdb.ref(a)||!1);if(!a)return!1;var c=!a.nodeType&&(a.maker||a.gloss)&&a,e=c&&c.maker,h=e&&e._id;b=e?e===metaBook.user||h===metaBook.user._id||0<=metaBook.outlets.indexOf(a.maker)||
0<=metaBook.outlets.indexOf(a.maker._id)?!1:!0:!1;var l=c?Ba(c.frag):a,e=l.codexbaseid||l.id,h=c?b?"METABOOKRESPONDGLOSS_"+c._id:"METABOOKEDITGLOSS_"+c._id:"METABOOKADDGLOSS_"+e,k=ma(h),e=k&&k.parentNode,k=ma("METABOOKADDGLOSSPROTOTYPE");if(e)k=eb(e,"form")[0];else{e=k.cloneNode(!0);e.id="";Q(ma("METABOOKADDGLOSS"),e);k=eb(e,"form")[0];k.id=h;var h=k,k=b||!1,m=l.codexbaseid||l.id,n=metaBook.docinfo[m];if(h.getAttribute("sbooksetup"))k=!1;else if(n){h.onsubmit=M;Aa(h,"REFURI").value=metaBook.refuri;
Aa(h,"DOCTITLE").value=document.title;Aa(h,"DOCURI").value=document.location.href;Aa(h,"FRAG").value=m;n.wsnid&&(Aa(h,"WSNID").value=n.wsnid);metaBook.user&&(Aa(h,"MAKER").value=c&&c.maker&&c.maker._id||metaBook.user._id);metaBook.mycopyid&&(Aa(h,"MYCOPYID").value=metaBook.mycopyid);metaBook.mycopyid&&(Aa(h,"MYCOPYID").value=metaBook.mycopyid);c&&(m=xa(h,".glossdate"),Q(m,Ha.shortString(c.created)),m.title=Ha.timeString(c.created));var m=Aa(h,"NOTE"),p=xa(h,".notespan");m&&(m.onkeypress=f,m.onkeydown=
D,m.onfocus=w,c&&!k?(m.value=c.note||"",p&&(p.innerHTML=m.value)):m.value="");metaBook.syncstamp&&(Aa(h,"SYNC").value=metaBook.syncstamp+1);m=xa(h,".addglossmenu");fdjt.UI.TapHold(m,{override:!0});var t=Aa(h,"LOCATION"),r=Aa(h,"LOCLEN"),v=Aa(h,"TAGLINE"),Ua=Aa(h,"RE"),z=Aa(h,"THREAD"),m=Aa(h,"UUID"),p=Aa(h,"DETAIL"),y=xa(h,"div.response");if(y&&k&&c){var x=xa(y,".respmaker"),C=xa(y,".respdate"),y=xa(y,".respnote"),A=metaBook.sourcedb.ref(c.maker);Q(x,A.name);Q(C,Ha.shortString(c.created));c.note?
(42<c.note.length?Q(y,c.note.slice(0,42)+"\u2026"):Q(y,c.note),y.title=c.note):Q.remove(y)}else Q.remove(y);t&&(t.value=n.starts_at);r&&(r.value=n.ends_at-n.starts_at);k&&c?(z.disabled=!1,Ua.disabled=!1,z.value=c.thread||c._id,Ua.value=c._id):(Ua.disabled=!0,z.disabled=!0);(n=l.getAttributeNS("tagline","https://beingmeta.com/METABOOK/")||l.getAttributeNS("tagline","https://metabooks.net/")||l.getAttributeNS("tagline","https://sbooks.net/")||l.getAttribute("data-tagline")||l.getAttribute("tagline"))?
l=n:(l=Q.textify(l))?(l=W.stdspace(l),l=40<l.length?l.slice(0,40)+"...":l):l=!1;l&&(v.value=l);if(c&&(l=sa(c),l.length))for(n=0,v=l.length;n<v;)d(h,l[n++],!1);if(c&&!k&&c.posted){if(l=xa(h,".wasposted"))l.disabled=!1;l=xa(h,".postgloss");L.setCheckspan(l,!0)}if(c&&!k&&c.links){var l=c.links,B;for(B in l)"_"!==B[0]&&(n=l[B],g(h,B,"string"===typeof n?n:n.title))}c&&(p.value=c.detail||"");if(c&&c.share)for(B=c.share,"string"===typeof B&&(B=[B]),l=0,p=B.length;l<p;)d(h,B[l++],"SHARE");m.value=!k&&c&&
c._id?c._id:ha.getUUID(metaBook.nodeid);if(c){B=xa(h,".outlets");B=eb(B,".checkspan");k=0;for(m=B.length;k<m;)l=B[k++],Pa(l,!1);B=c&&c.shared||[];"string"===typeof B&&(B=[B]);k=0;for(m=B.length;k<m;)q(h,B[k++],"SHARE",!0);B=xa(h,".private");Pa(B,c.private)}c&&c.excerpt&&metaBook.setExcerpt(h,c.excerpt,c.exoff);(B=Q.getChild(h,".cancelbutton"))&&Q.addListener(B,"click",I);h.setAttribute("sbooksetup","yes");u(h);(B=ba(h,".metabookglossform"))&&ia(B,"modified");k=h}else k=!1;metaBook.setupGestures(e)}c?
b?ta(e,"glossreply"):(ta(e,"glossedit"),ta(metaBook.HUD,"editgloss")):ta(e,"glossadd");return k?e:!1}function h(a,c,d){pa.glossing&&ka("setGlossTarget %o form=%o selecting=%o",a,c,d);metaBook.glosstarget&&ia(metaBook.glosstarget,"mbglosstarget");ia("METABOOKHUD",/\bgloss\w+\b/);ia("METABOOKHUD","editgloss");if(a){var f=!1;"string"===typeof a&&Ba(a)?a=Ba(a):"string"===typeof a&&metaBook.glossdb.probe(a)?(f=metaBook.glossdb.ref(a),a=Ba(f.frag)):a._db===metaBook.glossdb&&(f=a,a=Ba(f.frag));f&&c&&!c.nodeType&&
(c=n(f,!0));if(c){var g=Q.getInput(c,"FRAG");g.value!==a.id&&(b(c,!1),Q.addClass(ba(c,".metabookglossform"),"modified"),g.value=a.id)}else if(c=f?n(f):n(a),!c)return L.alert("There was a problem adding a gloss"),!1;metaBook.glosstarget=a;metaBook.select_target=!1;ta(a,"mbglosstarget");f.exoff?metaBook.GoTo({target:a,offset:f.exoff},"addgloss",!0):metaBook.GoTo(a,"addgloss",!0);metaBook.setCloudCuesFromTarget(metaBook.gloss_cloud,a);p(c);e(!1);metaBook.clearHighlights(a);d?e(d):e(k(a));f&&f.excerpt&&
f.excerpt.length?metaBook.selecting.setString(f.excerpt):d&&v(c,d);metaBook.selecting.onchange=function(){v(c,this)};return c}if(a=ma("METABOOKLIVEGLOSS"))a.id="";metaBook.glosstarget=!1;metaBook.glossform=!1;e(!1)}function m(a){a=a.nodeType?a:L.T(a);a=ba(a,"FORM");(a=ba(a,".metabookglossform"))&&ta(a,"modified")}function e(a){metaBook.selecting!==a&&(metaBook.selecting&&((pa.selection||pa.glossing)&&ka("setSelecting, replacing %o with %o",metaBook.selecting,a),metaBook.selecting.clear()),metaBook.selecting=
a)}function v(a,b){var c=b.getInfo();(pa.glossing||pa.selection)&&ka("Updating excerpt for %o from %o: %s",a,b,b.getString());if(c){metaBook.setExcerpt(a,c.string,c.off);var d=va(c.start,!0);if(d=d&&!Oa(metaBook.glosstarget,d)&&d)Q.getInput(a,"FRAG").value=d.id,b&&"number"===typeof c.off&&(c=Q.getInput(a,"EXOFF"),d=b.getOffset(d),c.value=d)}else metaBook.setExcerpt(a,!1)}function k(a,b){a.nodeType&&(a=[a]);for(var c=[],d=0,e=a.length;d<e;)c=c.concat(metaBook.getDups(a[d++]));(pa.selection||pa.glossing)&&
ka("selectText %o, dups=%o",a,c);return new fdjt.UI.TextSelect(c,{ontap:x,onrelease:b&&b.onrelease,onslip:b&&b.onslip,loupe:metaBook.touch||metaBook.useloupe,fortouch:metaBook.touch,holdmsecs:150,movethresh:250})}function x(a){a=a||window.event;(pa.selection||pa.glossing||pa.gestures)&&ka("gloss_selecting_ontap %o, mode=%o, livegloss=%o",a,metaBook.mode,ma("METABOOKLIVEGLOSS"));"addgloss"!==metaBook.mode?metaBook.setMode("addgloss",!1):metaBook.modechange&&1500>Ha()-metaBook.modechange||metaBook.setHUD(!1);
L.cancel(a)}function p(a){var b=ma("METABOOKLIVEGLOSS");b&&(b.id="");pa.glossing&&ka("setGlossForm %o <== %o",a,metaBook.glossform);a?(a.id="METABOOKLIVEGLOSS",metaBook.glossform=a,ma("METABOOKGLOSSBODYTEXT").value=Q.getInputValue(a,"DETAIL")||"",Aa(a,"SYNC").value=metaBook.syncstamp+1,metaBook.share_cloud.complete(),metaBook.gloss_cloud.complete()):metaBook.glossform=!1}function u(a){a=xa(a,".glossetc");L.Overflow(a)}function q(a,b,c,d){"undefined"===typeof d&&(d=!0);var e=ba(a,".metabookglossform");
ta(e,"modified");pa.glossing&&ka("addOutlet wrapper=%o form=%o outlet=%o formvar=%o checked=%o",e,a,b,c,d);var e=xa(a,".outlets"),f="string"===typeof b?b:b._id;"string"===typeof b?"@"===b[0]||":"===b[0]&&"@"===b[0]?b=metaBook.sourcedb.ref(b):(b={name:b},c||(c="EMAIL")):b.nodeType&&(c||(c="NETWORK"),f=b.getAttribute("data-value"),b={name:b.getAttribute("data-key")||f});c||(c="SHARE");a=fb(a,c);for(var g=0,h=a.length;g<h;){if(a[g].value===f)return b=ba(a[g],".checkspan"),Pa(b,d),b;g++}a="span.checkspan.waschecked.ischecked.outlet."+
c.toLowerCase();d=L.CheckSpan(a,c||"SHARE",f,d,Q.Image(wa("share",32,32),"img.share","\u21a3"),b.nick||b.name,Q.Image(wa("redx",32,32),"img.redx","x"));d.title=b.nick&&b.description?b.name+": "+b.description:b.description?b.description:b.name;Q(e,d," ");ia(e,"empty");return d}function g(a,b,c,d){var e=xa(a,".links"),f=c?b+" "+c:b,g=metaBook.urlType(b),h=metaBook.typeIcon(g),h=Q.Image(h,"img"),l=Q("span.linktext",c||b),f=Q.Checkbox("LINKS",f,!0),f=Q("span.checkspan.ischecked.waschecked.glosslink",
h,f,l);f.title=c||b;f.setAttribute("data-href",b);0===b.search(/https:\/\/glossdata./)&&ta(f,"glossdata");g&&ta(f,metaBook.mediaTypeClass(g));g=ba(a,".metabookglossform");pa.glossing&&ka("addOutlet wrapper=%o form=%o url=%o title=%o",g,a,b,c);ta(g,"modified");d?Q.replace(d,f):Q(e,f," ");ia(e,"empty");u(a);return f}function c(a,b,c,d){b=Q.getChild(a,"[data-href='"+b+"']");g(a,c,d,b)}function b(a,b,c){var d=ba(a,".metabookglossform"),e=xa(a,".excerpt"),f=!1,g=Aa(a,"EXCERPT"),h=Aa(a,"EXOFF");if(!b||
W.isEmpty(b))g.value&&(f=!0),g.value="",h.value="",g.disabled=h.disabled=!0,e&&(e.innerHTML="");else if(g.disabled=h.disabled=!1,g.value=b,f=!0,"number"===typeof c?h.value=c:(h.value="",h.disabled=!0),e){var g=void 0,l=b.length;g||(g=20);if(l<g)g=b;else{var h=b.split(/\s+/),k=h.length;if(3>h.length)g=b.slice(0,Math.floor(g/2))+"..."+b.slice(Math.floor(l-g/2));else{for(var l=1,m=h[0].length+1,n=k-2,k=h[k-1].length+1;l<n&&m+k<g;)m+=h[l++].length,k+=h[n--].length;g=h.slice(0,l).join(" ")+"..."+h.slice(n).join(" ")}}e.innerHTML=
g;e.title=b}(pa.glossing||pa.selecting)&&ka("setExcerpt %o form=%o excerpt=%o off=%o",d,a,b,c);u(a);f&&ta(d,"modified")}function d(a,b,c,d,e){var f=!1;b||(b=a);b.prefix&&(f=b.prefix,b=b.tag);"FORM"!==a.tagName&&(a=ba(a,"form")||a);e||(e=metaBook.getMakerKnodule(metaBook.user));"undefined"===typeof d&&(d=!0);var g=ba(a,".metabookglossform");pa.glossing&&ka("AddTag %o form=%o tag=%o var=%o checked=%o kno=%o",g,a,b,c,d,e);ta(g,"modified");var g=xa(a,".tags"),h=!1,l="span.term";c||(c="TAGS");b.nodeType&&
za(b,"completion")&&(za(b,"outlet")?(c="SHARED",l="span.outlet"):za(b,"source")&&(c="SHARE",l="span.source"),b.title&&(h=b.title),b=metaBook.gloss_cloud.getValue(b));var k=b instanceof na?b:"string"===typeof b&&e.handleSubjectEntry(b),m=k?k.toHTML&&k.toHTML()||k.name||k.dterm||k.title||k.norm||"string"===typeof k.EN||k.EN||k.EN instanceof Array||k.EN[0]||k._qid||k._id:"string"===typeof b?b:b.toString(),n=b;k&&(n=k.knodule===e?k.dterm:k._qid||k.getQID());f&&(n=f+n);k&&k._db===metaBook.sourcedb&&(c=
"SHARED");e=eb(g,".checkspan");f=0;for(k=e.length;f<k;){var p=e[f++];if(p.getAttribute("data-varname")===c&&p.getAttribute("data-tagval")===n)return d&&ta(p,"waschecked"),p}n=L.CheckSpan("span.checkspan",c,n,d);d&&ta(n,"waschecked");h&&(n.title=h);n.setAttribute("data-varname",c);n.setAttribute("data-tagval",b);ta(n,"glosstag");ta(n,c.toLowerCase()+"var");"string"===typeof m?Q.append(n,Q(l,m)):Q.append(n,m);Q.append(n,Q.Image(wa("redx",32,32),"img.redx","x"));Q.append(g,n," ");ia(g,"empty");u(a);
return n}function A(a,b,c,d){if(a&&a.length&&0<b){for(var e=!1,f=b-1,g=!1,h=!1,l=a[f],k=a[f-1];0<=f;){if("\\"!==k)if(/\s/.test(l))e=f;else if("@"===l||"#"===l)break;else if(0===f)return!1;f--;l=k;k=a[f-1]}var l=a[f],m=a[f+1],k=a.length;if(ja[m]){d=ja[m];g=m;e=a.slice(f+2).indexOf(d);if(0>e)if(c)k=b,h=d;else return!1;else k=f+2+e;if(k<b)return!1}else{if(d&&e)return!1;d=a.slice(f).search(Fa);0<d&&(k=f+d)}a={text:a.slice(f,k),start:f,end:k,pos:b,prefix:l,content:g&&h?a.slice(f+2,k):g?a.slice(f+2,k-1):
a.slice(f+1,k)};g&&(a.delim=g);g&&c&&(a.needs=ja[g]);return a}return!1}function w(a){var b=L.T(a),c=b.value,d=b.selectionStart,e=A(c,d);(pa.glossing||pa.gestures)&&ka("glossinput_onfocus %o text=%o pos=%o taginfo=%o",a,c,d,e);oa(a);e&&(Wa&&clearTimeout(Wa),Wa=setTimeout(function(){J(b)},150))}function f(a){var b=L.T(a),c=ba(b,"FORM"),d=b.value,e=b.selectionStart||0,f=a.charCode,g=String.fromCharCode(f),h=A(d,e,!0);(pa.glossing||2<pa.gestures)&&ka("glossinput_onkeypress '%o' %o text=%o pos=%o taginfo=%o",
f,a,d,e,h);13!==f&&(ta(ba(c,".metabookglossform"),"focused"),ta(ba(c,".metabookglossform"),"modified"));if(13===f)if(h)b.value=d.slice(0,h.start)+d.slice(h.end),G(b,h.content,a.ctrlKey,"@"===h.prefix),fdjt.UI.cancel(a);else{if(a.shiftKey)return b.value=d.slice(0,e)+"\n"+d.slice(e),b.selectionStart++,L.cancel(a);L.cancel(a);M(c)}else h&&(Fa.test(g)?(h=A(d,e,!0))&&h.needs===g&&(b.value=d.slice(0,h.start)+d.slice(h.end),G(b,h.content,a.ctrlKey,"@"===h.prefix),L.cancel(a)):(Wa&&clearTimeout(Wa),Wa=setTimeout(function(){J(b)},
150)))}function D(a){var b=a.keyCode,c=L.T(a);if(27===b)metaBook.cancelGloss(),L.cancel(a);else if(9===b||13===b){var d=ba(c,"FORM"),e=c.value,f=A(e,c.selectionStart||0,!0),g="@"===f.prefix?metaBook.share_cloud:metaBook.gloss_cloud;(pa.glossing||2<pa.gestures)&&ka("glossinput_onkeydown '%o' %o taginfo=%o cloud=%o",b,a,f,g);f&&(9===b?(d=f.content,g.complete(d),g.prefix&&g.prefix!==d?(a=f.start+(f.delim?2:1),d=f.end-(f.needs?0:1),0<=g.prefix.search(/\s/)?c.value=e.slice(0,a)+(f.delim?"":'"')+g.prefix+
(f.needs?f.needs:"")+e.slice(d):c.value=e.slice(0,a)+g.prefix+e.slice(d)):(a.shiftKey?g.selectPrevious():g.selectNext(),L.cancel(a))):g.selection&&("@"===f.prefix?(b=g.selection.getAttribute("data-value"),metaBook.addOutlet2Form(d,b,"SHARE")):metaBook.addTag2Form(d,g.selection),c.value=e.slice(0,f.start)+e.slice(f.end),ia("METABOOKHUD",/gloss(tagging|tagoutlet)/g),setTimeout(function(){g.complete("")},10),g.clearSelection(),L.cancel(a)))}else if(8===b||46===b||35<=b&&40>=b)m(a),Wa&&clearTimeout(Wa),
Wa=setTimeout(function(){J(c)},150)}function J(a){if(a=A(a.value,a.selectionStart||0,!0)){var b;(b="@"===a.prefix)?Sa("METABOOKHUD",/gloss(tagging|tagoutlet)/g,"glosstagoutlet"):Sa("METABOOKHUD",/gloss(tagging|tagoutlet)/g,"glosstagging");b=b?metaBook.share_cloud.complete(a.content):metaBook.gloss_cloud.complete(a.content);pa.glossing&&ka("Got %d completions for %s",b.length,a.content)}else ia("METABOOKHUD",/gloss(tagging|addoutlet)/g)}function G(a,b,c,e){a=ba(a,"FORM");var f=!1;!e&&c?metaBook.knodule.def(b):
0<b.indexOf("|")?e?ka.warn("Can't define outlets (sources) from %s",b):metaBook.knodule.def(b):(c=(e?metaBook.share_cloud:metaBook.gloss_cloud).complete(b),0!==c.length&&1===c.length&&(f=c[0]),e&&!f?ka.warn("Unknown outlet %s",b):e?q(a,f):f?d(a,f):(f=metaBook.knodule.ref(b))?d(a,f):d(a,b));ia("METABOOKHUD",/gloss(tagging|addoutlet)/)}function y(a,b){var c=a.getAttribute("data-tagval");if(c){var d=c.indexOf("@");return metaBook.knodule&&0<d&&c.slice(d+1)===metaBook.knodule.name?c.slice(0,d):c}c=b.indexOf("|");
return 0<c?b.slice(0,c):b}function E(a,b,c){return function(d){return F(d,a,b,c)}}function F(a,b,c){(pa.network||pa.glossing)&&ka("Got AJAX gloss response %o from %o",a,a.responseURL);pa.savegloss&&ka("Gloss %o successfully added (status %d) to %o",Aa(b,"UUID").value,a.status,Aa(b,"FRAG").value);ia(b.parentNode,"submitting");if(200>a.status||300<=a.status)ta(b.parentNode,"submitfailed"),403===a.status?fdjt.Dialog.alert("Sorry, you're not allowed to save this gloss"):fdjt.Dialog.alert("There was a problem saving your gloss"),
b.parentNode&&b.parentNode&&Q.remove(b.parentNode),h(!1),metaBook.setTarget(!1),metaBook.setMode(!1);else{c?ta(b.parentNode,"submitdone"):(ta(b.parentNode,"submitclose"),metaBook.setHUD(!1,!1));a=JSON.parse(a.responseText);var d=metaBook.glossdb.Import(a,!1,Z.REFINDEX|Z.REFSTRINGS|Z.REFLOAD);a=document.getElementsByName(d._id);for(var e=0,f=a.length;e<f;){var g=a[e++];if(za(g,"mbcard")){var l=metaBook.renderCard(d);l&&Q.replace(g,l)}}d.save();metaBook.selecting&&(metaBook.selecting.onclear?metaBook.selecting.onclear.push(function(){metaBook.addGloss2UI(d)}):
metaBook.selecting.onclear=[function(){metaBook.addGloss2UI(d)}]);b&&!c?setTimeout(function(){za(b.parentNode,"submitclose")&&(b.parentNode&&b.parentNode&&Q.remove(b.parentNode),h(!1),metaBook.setTarget(!1),metaBook.setMode(!1))},1500):b&&setTimeout(function(){ia(b.parentNode,"submitdone")},1500)}}function O(a){var b=Aa(a,"UUID");b&&(b.value="");if(b=Aa(a,"NOTE"))b.value="";if(b=Aa(a,"HREF"))b.value="";(a=eb(a,".tags"))&&a.length&&(a=eb(a[0],".checkspan"),Q.remove(Q.Array(a)))}function M(a,b){var c=
!1,d=!1;if("undefined"===typeof a){c=ma("METABOOKLIVEGLOSS");if(!c)return;d=xa(c,"FORM")}else a.nodeType||(a=L.T(a)),a.nodeType&&1===a.nodeType&&"FORM"===a.tagName?(d=a,c=ba(d,".metabookglossform")):a.nodeType&&1===a.nodeType&&"DIV"===a.tagName&&za(a,"metabookglossform")&&(c=a,d=xa(c,"FORM"));if(d){var e=Aa(d,"DETAIL"),f=ma("METABOOKGLOSSBODYTEXT");e.value=f.value||"";ta(c,"submitting");Oa(d,".glossedit")||Oa(d,".glossreply")||T(d,xa("METABOOKADDGLOSSPROTOTYPE","FORM"));e=Aa(d,"UUID");e&&e.value&&
5<e.value.length||(ka.warn("missing UUID"),e&&(e.value=ha.getUUID(metaBook.nodeid)));e=fb(d,"NOTE")[0];if(0===e.value.search(R)){var f=e.value,l=f.search(/\s/);0>l?g(d,f):g(d,f.slice(0,l),f.slice(l+1));e.value=""}cb||navigator.onLine&&metaBook.connected?navigator.onLine&&metaBook.connected&&metaBook.user&&fdjt.Ajax.onsubmit(d,E(d,b))?ia(c,"modified"):K(d,a&&a.type&&a,b):(c=[],navigator.onLine&&c.push({label:"Login",isdefault:!0,handler:function(){setTimeout(function(){metaBook.setMode("login")},0);
var a=function(){M(d,b)};metaBook._onconnect?metaBook._onconnect.push(a):metaBook._onconnect=[a];cb=!0}}),metaBook.user&&metaBook.persist?c.push({label:"Queue",isdefault:!navigator.onLine&&metaBook.cacheglosses,handler:function(){metaBook.nocache&&metaBook.setConfig("cacheglosses",!0);cb=!0;navigator.onLine&&metaBook.connected?M(d,b):K(d,!1,b)}}):(c.push({label:"Cache",isdefault:!navigator.onLine&&metaBook.cacheglosses,handler:function(){metaBook.nocache&&metaBook.setConfig("cacheglosses",!0,!0);
cb=!0;K(d,!1,b)}}),metaBook.nocache&&c.push({label:"Lose",isdefault:!navigator.onLine&&metaBook.nocache,handler:function(){var a=d,b=fdjt.Ajax.formJSON(a,!0),c={refuri:b.refuri,frag:b.frag,maker:b.user,_id:b.uuid,uuid:b.uuid,qid:b.uuid,gloss:b.uuid,created:Ha()};c.tstamp=Ha.tick();b.note&&!W.isEmpty(b.note)&&(c.note=b.note);b.excerpt&&!W.isEmpty(b.excerpt)&&(c.excerpt=b.excerpt,c.exoff=b.exoff);b.detail&&!W.isEmpty(b.detail)&&(c.detail=b.detail);b.tags&&0<b.tags.length&&(c.tags=b.tags);b.xrefs&&0<
b.xrefs.length&&(c.xrefs=b.xrefs);metaBook.glossdb.Import(c,!1,!1,!0);O(a);ia(a.parentNode,"submitting");h(!1);metaBook.setTarget(!1);metaBook.setMode(!1);cb=!0}})),c.push({label:"Cancel",handler:function(){Q.remove(d.parentNode);h(!1);metaBook.setTarget(!1);metaBook.setMode(!1)}}),L.choose(c,navigator.onLine&&!metaBook.user&&[Q("p.smaller","This book isn't currently associated with an sBooks account, ","so any highlights or glosses you add will not be permanently saved ","until you login."),Q("p.smaller",
"You may either login now, cache your changes ","on this machine until you do login, ","lose your changes when this page closes, ","or cancel the change you're about to make.")],navigator.onLine&&metaBook.user&&[Q("p.smaller","You aren't currently logged into your sBooks account from ","this machine, so any highlights or glosses you add won't ","be saved until you do."),Q("p.smaller","In addition, you won't get updated glosses from ","your networks or layers."),Q("p.smaller","You may either login now, queue any changes you make until ",
"you do login, or cancel the change you were trying to make.")],!navigator.onLine&&metaBook.nocache&&[Q("p.smaller","You are currently offline and have elected to not save ","highlights or glosses locally on this computer."),Q("p.smaller","You can either queue your changes by storing information locally, ","lose your changes when this page closes,","or cancel the change you were about to make.")]))}}function I(a){a=a||window.event;var b=L.T(a);t(b);L.cancel(a)}function t(a){var b=a||window.event||
null,c=a?a.nodeType?a:L.T(a):ma("METABOOKLIVEGLOSS"),c=c&&Q.getParent(c,".metabookglossform");h(!1);metaBook.setMode(!1);a&&(a.cancelable||a.bubbles)&&L.cancel(b);c&&Q.remove(c)}function T(a,b){var c,d;Sa(b,la,a.className);c=Aa(a,"POSTGLOSS");d=Aa(a,"POSTGLOSS");Pa(d,c.checked);var e=fb(a,"NETWORKS");c=0;for(d=e.length;c<d;){var f=e[c++],g=kb(a,"NETWORKS",f.value);Pa(g,f.checked)}c=xa(b,".outlets");Q.replace(c,Q("span.outlets"));c=xa(a,".outlets");e=eb(c,"INPUT");c=0;d=e.length;for(f=0;c<d;)if(g=
e[c++],g.checked||5>=f){var h=q(b,g.value,g.name,g.checked);g.checked?ta(h,"waschecked"):f++}}function K(a,b,c){var d=fdjt.Ajax.formJSON(a,!0),e=fdjt.Ajax.formParams(a),f=metaBook.queued;f.push(d.uuid);metaBook.cacheglosses?(ha.setLocal("mB("+d.uuid+").params",e),ha.setLocal("mB("+ib.docid+").queued",f,!0)):qa[d.uuid]=e;e={refuri:d.refuri,frag:d.frag,_id:d.uuid,uuid:d.uuid,maker:d.user||metaBook.user,qid:d.uuid,gloss:d.uuid,created:d.created||Ha()};e.tstamp=Ha.tick();d.note&&!W.isEmpty(d.note)&&(e.note=
d.note);d.excerpt&&!W.isEmpty(d.excerpt)&&(e.excerpt=d.excerpt,e.exoff=d.exoff);d.detail&&!W.isEmpty(d.detail)&&(e.detail=d.detail);d.tags&&0<d.tags.length&&(e.tags=d.tags);d.xrefs&&0<d.xrefs.length&&(e.xrefs=d.xrefs);metaBook.glossdb.Import(e,!1,Z.REFLOAD|Z.REFSTRINGS|Z.REFINDEX,!0);b&&L.cancel(b);ia(a.parentNode,"submitting");c||(O(a),h(!1),metaBook.setTarget(!1),metaBook.setMode(!1))}function P(){if(metaBook.queued.length){var a=xa(ma("METABOOKADDGLOSSPROTOTYPE"),"form").getAttribute("ajaxaction"),
b=metaBook.queued[0],c=metaBook.nocache?qa[b]:ha.getLocal("mB("+b+").params");if(c){var d=new XMLHttpRequest;d.open("POST",a);d.withCredentials="yes";d.onreadystatechange=function(){if(4===d.readyState&&200<=d.status&&300>d.status){ha.dropLocal("mB("+b+").params");var a=metaBook.queued;if(a&&a.length){var c=a.indexOf(b);0<=c&&(a.splice(c,1),metaBook.cacheglosses&&ha.setLocal("mB("+ib.docid+").queued",a,!0),metaBook.queued=a)}F(d,!1,!1);a.length&&setTimeout(P,200);ha.dropLocal("mB("+ib.docid+").queued")}else 4===
d.readyState&&metaBook.setConnected(!1)};try{d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(c)}catch(e){metaBook.setConnected(!1)}}}}function C(a){a=a||window.event;var b=L.T(a);if(ba(b,".checkspan"))return fdjt.UI.CheckSpan.onclick(a);ba(b,".sharing")&&Ja(ba(b,".sharing"),"expanded")}function U(a){var b=L.T(a);if(b=ba(b,".outlet")||ba(b,".source")){var c=ma("METABOOKLIVEGLOSS"),c=c&&xa(c,"form"),b=metaBook.share_cloud.getValue(b);metaBook.addOutlet2Form(c,b);L.cancel(a)}}
function V(a){a=a||window.event;var b=L.T(a),c=b.alt;if(c){var d=ba(b,".addglossmenu"),b=ba(b,"form"),e=ba(b,"div.metabookglossform");"downmenu"===c?(ta(d,"expanded"),ia(d,"held")):"upmenu"===c?(ia(d,"expanded"),ia(d,"held")):"glossdelete"===c?da(d,b,!1,!0):"glosscancel"===c?X(d,b,e):"glosspush"===c?(metaBook.submitGloss(b,!1),ia(d,"expanded")):"glossupdate"===c?(metaBook.submitGloss(b,!1),ia(d,"expanded")):"glossrespond"===c?S(d,b):"glosscancel"===c?X(d,b,e):c===b.className?(metaBook.setGlossMode(!1,
b),ia(d,"expanded")):metaBook.glossmodes.exec(c)?(metaBook.setGlossMode(c,b),ia(d,"expanded")):ka.warn("Bad alt=%s in glossmode_tap",c);L.cancel(a)}}function B(a){a=a||window.event;a=L.T(a);var b=a.alt;Xa&&(clearTimeout(Xa),Xa=!1);b&&(Xa&&(clearTimeout(Xa),Xa=!1),b=ba(a,".addglossmenu"),za(b,"expanded")?(ta(b,"held"),ta(a,"held")):(ta(b,"expanded"),ta(b,"held")))}function N(a){a=a||window.event;a=L.T(a);var b=ba(a,".addglossmenu"),c=ba(a,"form"),d=ba(c,"div.metabookglossform"),e=a.alt;ia(a,"held");
za(a,"menutop")?metaBook.setGlossMode(!1,c):"glossdelete"===e?da(b,c):"glosscancel"===e?X(b,c,d):"glosspush"===e?metaBook.submitGloss(c,!1):"glossupdate"===e?metaBook.submitGloss(c,!1):"glossrespond"===e?S(b,c):metaBook.glossmodes.exec(e)?metaBook.setGlossMode(e,c):ka.warn("Bad alt=%s in glossmode_release",e);ia(b,"expanded");ia(b,"held")}function r(a){a=a||window.event;a=L.T(a);var b=ba(a,".addglossmenu");ia(a,"held");Xa||(Xa=setTimeout(function(){Xa=!1;ia(b,"held");ia(b,"expanded")},500))}function da(a,
b,c,d){b||(b=ba(a,"FORM"));c||(c=ba(b,".metabookglossform"));var e=Q.hasClass(c,"modified");ia(c,"modified");ia(a,"expanded");var f=Ga(b,"UUID")[0];(a=metaBook.glossdb.probe(f))&&a.created?d?(Ma(f),metaBook.setMode(!1),Q.remove(c),h(!1),metaBook.setTarget(!1)):fdjt.UI.choose([{label:"Delete",handler:function(){Ma(f);metaBook.setMode(!1);Q.remove(c);h(!1);metaBook.setTarget(!1)},isdefault:!0},{label:"Cancel"}],e?"Delete this gloss?  Discard your changes?":"Delete this gloss?",Q("div.smaller","(Created ",
Ha.shortString(a.created),")")):(Ma(f),metaBook.setMode(!1),Q.remove(c),h(!1),metaBook.setTarget(!1))}function X(a,b,c){b||(b=ba(a,"FORM"));c||(c=ba(b,".metabookglossform"));metaBook.cancelGloss();metaBook.setMode(!1);Q.remove(c);h(!1);metaBook.setTarget(!1)}function S(a){(a=ba(a,".metabookglossform"))&&(a=Aa(a,"UUID"))&&(a=metaBook.glossdb.probe(a.value))&&h(a,metaBook.getGlossForm(a,!0))&&metaBook.setMode("addgloss")}function oa(a){a=a||window.event;a=L.T(a);var b=(a=(a=ba(a,"FORM"))&&ba(a,".metabookglossform"))&&
xa(a,"TEXTAREA");a&&metaBook.setGlossMode(!1);b&&metaBook.setFocus(b);metaBook.setHUD(!0);metaBook.freezelayout=!0}function ga(a){a=a||window.event;var b=L.T(a),c=ba(b,".submitclose");c&&ia(c,"submitclose");var d=(c=(c=ba(b,"FORM"))&&ba(c,".metabookglossform"))&&xa(c,"TEXTAREA");za(c,"focused")?setTimeout(function(){d&&(metaBook.setFocus(d),d.focus())},150):Oa(b,".addglossmenu")||Oa(b,".glossexposure")||(Oa(b,".textbox")||L.cancel(a),ta(c,"focused"),metaBook.setHUD(!0),oa(a))}function ca(a,b,c){if(a===
b){metaBook.glossdb.drop(b);if(a=ma("METABOOKEDITGLOSS_"+b))a=a.parentNode,a===ma("METABOOKLIVEGLOSS")&&(metaBook.glosstarget=!1,metaBook.setMode(!1)),Q.remove(a);var d=Q.Array(document.getElementsByName(b));a=0;var e=d.length;if(d)for(;a<e;){var f=d[a++];"METABOOKSKIM"===f.id?Q.replace(f,Q("div.mbcard.deletedgloss")):Q.remove(f)}c=document.getElementsByName("METABOOK_GLOSSMARK_"+c);c=Q.Array(c);a=0;for(e=c.length;a<e;)d=c[a++],f=Z.remove(d.glosses,b),0===f.length?Q.remove(d):d.glosses=f;b=Q.$(".mbexcerpt[data-glossid='"+
b+"']");b=Q.Array(b);a=0;for(e=b.length;a<e;)L.Highlight.remove(b[a++])}else L.alert(a)}function Ma(a){var b=metaBook.glossdb.probe(a);if(b&&b.created&&b.maker){var c=b.get("frag");fdjt.Ajax.jsonCall(function(b){ca(b,a,c)},"https://"+metaBook.server+"/1/delete","gloss",a)}else b&&b.frag&&ca(a,a,b.frag)}function l(a){a=a||window.event;var b=L.T(a),c=b.value,d=ma("METABOOKLIVEGLOSS");if(d){var d=xa(d,"FORM"),e=metaBook.share_cloud,f=a.keyCode||a.charCode;W.isEmpty(c)&&13===f?e.selection?metaBook.addOutlet2Form(d,
e.selection.getAttribute("data-value")):metaBook.setGlossMode("editnote"):13===f&&e.selection?(metaBook.addOutlet2Form(d,e.selection),e.complete(""),b.value=""):13===f?(f=e.complete(c),f.length?metaBook.addOutlet2Form(d,f[0].getAttribute("data-value")):metaBook.addOutlet2Form(d,c),L.cancel(a),b.value="",e.complete("")):9===f?(e.complete(c),L.cancel(a),e.prefix&&e.prefix!==c?(b.value=e.prefix,Q.cancel(a)):a.shiftKey?e.selectPrevious():e.selectNext()):setTimeout(function(){e.complete(b.value)},100)}}
function aa(a){a=a||window.event;var b=L.T(a),c=b.value,d=ma("METABOOKLIVEGLOSS");if(d){var d=xa(d,"FORM"),e=metaBook.gloss_cloud,f=a.keyCode||a.charCode;W.isEmpty(c)&&13===f?(e.selection?metaBook.addTag2Form(d,e.selection):metaBook.setGlossMode(!1),e.clearSelection()):13===f&&e.selection?(metaBook.addTag2Form(d,e.selection),e.complete(""),e.clearSelection(),b.value=""):13===f?(e.complete(c),0<=c.indexOf("|")||0<=c.indexOf("@")?metaBook.addTag2Form(d,c):metaBook.handleTagInput(c,d,!0),L.cancel(a),
b.value="",e.complete("")):9===f?(e.complete(c),L.cancel(a),e.prefix&&e.prefix!==c?(b.value=e.prefix,Q.cancel(a)):a.shiftKey?e.selectPrevious():e.selectNext()):setTimeout(function(){e.complete(b.value)},100)}}function z(a){var b=ma("METABOOKLIVEGLOSS"),b=Q.getChild(b,"FORM");Q.swapClass(b,ob,a);b=ma("METABOOKATTACHFORM");a=Q.getInputFor(b,"ATTACHTYPE",a);fdjt.UI.CheckSpan.set(a,!0)}function Ca(a){a=a||window.event;var b=L.T(a);"FORM"!==b.tagName&&(b=ba(b,"form"));var d=ma("METABOOKLIVEGLOSS"),e=Q.getInput(b,
"URL"),f=Q.getInput(b,"TITLE"),h=f.value&&W.stdspace(f.value),l=Q.getInput(b,"FILEOKAY"),f=e.value;L.cancel(a);if(d)if(!h&&f&&(a=0<=f.indexOf("/")?f.search(/\/[^\/]+$/):0,h=0>a?f:f.slice(a)),za(b,"link"))/https?:[\/][\/](\w+[.])+\w+[\/]/.exec(e.value)?(metaBook.editlink?(c(b,metaBook.editlink,e.value,h),metaBook.editlink=!1):g(b,e.value,h),Q.addClass(d,"modified"),metaBook.setGlossMode("editnote"),ua()):L.alert("This URL doesn't look right");else if(za(b,"upload"))if(metaBook.glossattach||metaBook.editlink)if(metaBook.glossattach&&
!l.checked)fdjt.UI.choose([{label:"Yes",handler:function(){L.CheckSpan.set(l,!0);Ra(h,d)}},{label:"Cancel"}],Q("P","By choosing 'Yes,' I affirm that ","I have the right to use and share this ","file according to the sBooks ",Q.Anchor("https://www.bookhub.io/legalia/TOS/","A[target='_blank']","Terms of Service"),"."));else if(metaBook.glossattach){var k=metaBook.glossattach.name;Ia(metaBook.glossattach,h||metaBook.glossattach.name,d).then(function(a){metaBook.editlink?(c(d,metaBook.editlink,a.responseURL,
h),metaBook.editlink=!1):g(d,a.responseURL,h||k||"attachment");Q.addClass("METABOOKLIVEGLOSS","modified");metaBook.setGlossMode("editnote");ua()}).catch(function(a){ka("Trouble attaching file %o (%o)",metaBook.glossattach,a)})}else metaBook.editlink?(Q.addClass("METABOOKLIVEGLOSS","modified"),c(d,metaBook.editlink,metaBook.editlink,h),ua(),metaBook.editlink=!1):ka.warn("Fall through in attach_submit");else L.alert("You need to specify a file!");else ka.warn("Fall through in attach_submit")}function Ka(a){var b=
ma("METABOOKLIVEGLOSS");ua();L.cancel(a);b&&metaBook.setGlossMode("editnote")}function Va(a){a=a||window.event;13===(a.keyCode||a.charCode)&&(L.cancel(a),ma("METABOOKLIVEGLOSS")&&(Ca(a),metaBook.setGlossMode("editnote")))}function Ra(a,b){var d=metaBook.glossattach.name;Ia(metaBook.glossattach,a||metaBook.glossattach.name,b).then(function(e){metaBook.editlink?(c(b,metaBook.editlink,e.responseURL,a),metaBook.editlink=!1):g(b,e.responseURL,a||d||"attachment");metaBook.setGlossMode("editnote");ta(b,
"modified");ua()}).catch(function(a){ka("Trouble attaching file %o (%o)",metaBook.glossattach,a)})}function fa(a){var b=ma("METABOOKFILEINPUT"),c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,a.view);b.dispatchEvent(c);L.cancel(a)}function ua(){var a=ma("METABOOKATTACHURL"),b=ma("METABOOKATTACHTITLE"),c=ma("METABOOKUPLOADRIGHTS"),d=ma("METABOOKFILEINPUT");a.value="";b.value="";Q.dropClass("METABOOKGLOSSATTACH","haveupload");ma("METABOOKATTACHFILE").className="nofile";ma("METABOOKATTACHFILENAME").innerHTML=
"";fdjt.UI.CheckSpan.set(c,!1);metaBook.glossattach=!1;metaBook.editlink=!1;d.value=""}function bb(b){var c=metaBook.editlink,d=ma("METABOOKLIVEGLOSS"),c=Q.getChild(d,"[data-href='"+c+"']");L.cancel(b);c&&(ta(d,"modified"),L.CheckSpan.set(c,!1));ua();a("editnote")}function Ia(a,b,c){b=Q.getInputValue(c,"UUID");c=ha.getUUID();var d=a.type,e=new XMLHttpRequest,f="https://glossdata.bookhub.io/"+b+"/"+c+"/"+a.name,g=!1,h=!1;return new Promise(function(b,c){e.onreadystatechange=function(){g||h||4!==e.readyState||
(200===e.status?(metaBook.glossattach=!1,h=!0,b(e)):(h=g=!0,c(e)))};e.ontimeout=function(a){c(a)};e.open("POST",f);e.setRequestHeader("content-type",d);e.withCredentials=!0;e.send(a)})}function hb(b){var c=L.T(b),d=ba(c,".glosslink");if(d){c=d.getAttribute("data-href");d=d.title;metaBook.editlink=c;a("attach");if(0===c.search(/https:\/\/glossdata\./)){var e=/\/([^\/]+)$/.exec(c);z("upload");ta("METABOOKGLOSSATTACH","haveupload");ma("METABOOKATTACHFILENAME").innerHTML=e[1]}else 0<=c.search(/\/capture\.[A-Za-z0-9]+$/)?
z("capture"):(z("link"),ma("METABOOKATTACHURL").value=c);fdjt.UI.CheckSpan.set(ma("METABOOKUPLOADRIGHTS"),!0);ma("METABOOKATTACHTITLE").value=d||c;ta(ma("METABOOKATTACHFORM"),"editlink");ma("METABOOKATTACHTITLE").focus();L.cancel(b)}else L.CheckSpan.onclick(b),b=ba(c,"form"),Aa(b,"NOTE").focus()}function Za(a){a=a||window.event;var b=a.dataTransfer.types;b&&(0<=b.indexOf("Files")?fdjt.UI.cancel(a):0<=b.indexOf("text/uri-list")?fdjt.UI.cancel(a):0<=b.indexOf("text/plain")&&0===a.dataTransfer.getData("text/plain").search(/^\s*https?:\/\//)&&
fdjt.UI.cancel(a))}function ab(a){a=a||window.event;var b=ma("METABOOKATTACHFORM"),c=a.dataTransfer.types;if(c)if(0<=c.indexOf("Files"))c=a.dataTransfer.files[0],L.cancel(a),metaBook.glossattach=c,z("uploadfile"),ma("METABOOKATTACHFILENAME").innerHTML=c.name,Q.addClass("METABOOKGLOSSATTACH","haveupload"),za(b,"editlink")&&fdjt.UI.CheckSpan.set(ma("METABOOKUPLOADRIGHTS"),!1);else if(0<=c.indexOf("text/uri-list")){if(b=a.dataTransfer.getData("URL")||a.dataTransfer.getData("text/uri-list"))fdjt.UI.cancel(a),
metaBook.setGlossMode("attach"),z("linkurl"),ma("METABOOKATTACHURL").value=b,ma("METABOOKATTACHTITLE").focus()}else 0<=c.indexOf("text/plain")&&(c=a.dataTransfer.getData("text/plain"),fdjt.UI.cancel(a),0===c.search(/^\s*https?:\/\//)?(metaBook.setGlossMode("attach"),za(b,"linkurl")||za(b,"copyurl")||z("linkurl"),ma("METABOOKATTACHURL").value=c,ma("METABOOKATTACHTITLE").focus()):(a=ma("METABOOKLIVEGLOSS"),a=Q.getInput(a,"NOTE"),metaBook.setGlossMode(!1),a.value=c,a.focus()))}function $a(a){if(a=L.T(a).files[0])metaBook.glossattach=
a,ma("METABOOKATTACHFILENAME").innerHTML=a.name,Q.addClass("METABOOKGLOSSATTACH","haveupload"),za("METABOOKATTACHFORM","editlink")&&fdjt.UI.CheckSpan.set(ma("METABOOKUPLOADRIGHTS"),!1)}function nb(a){a=a||window.event;metaBook.setGlossMode("editnote");L.cancel(a)}function La(a,b,c){if(metaBook.glosstarget===a)(pa.gestures||pa.glossing)&&ka("startAddGloss/resume %o %o form=%o",c,a,metaBook.glossform),b&&metaBook.setGlossMode(b,metaBook.glossform),metaBook.setMode("addgloss",!0),c&&L.cancel(c);else{var d=
Qa[a.id];H(d);var d=h(a,"addgloss"===metaBook.mode&&metaBook.glossform,d),e=xa(d,"form");e&&(c&&L.cancel(c),(pa.gestures||pa.glossing)&&ka("startAddGloss (%o) %o f=%o/%o",c,a,d,e),p(d),b&&(e.className=b),metaBook.setMode("addgloss",!1))}}function Na(){var a=Q("div.message","Saving gloss");Ya=!0;return Ya=L.choose({choices:[{label:"Save",handler:function(){metaBook.submitGloss();Ya=!1},value:"SAVE",isdefault:!0},{label:"Discard",value:"DISCARD",handler:function(){metaBook.cancelGloss();Ya=!1}}],timeout:metaBook.save_gloss_timeout||
metaBook.choice_timeout||7,spec:"div.fdjtdialog.fdjtconfirm.savegloss"},a)}function H(a){for(var b=0,c=Qa.length;b<c;){var d=Qa[b++];d!==a&&d.clear()}Qa=[];metaBook.select_target=!1}var W=fdjt.String,ha=fdjt.State,Ha=fdjt.Time,ka=fdjt.Log,Q=fdjt.DOM,L=fdjt.UI,Z=fdjt.RefDB,na=fdjt.Ref,ma=fdjt.ID,ib=metaBook,Ba=ib.ID,pa=metaBook.Trace,ta=Q.addClass,za=Q.hasClass,ia=Q.dropClass,Ja=Q.toggleClass,Sa=Q.swapClass,ba=Q.getParent,Oa=Q.hasParent,eb=Q.getChildren,xa=Q.getChild,Aa=Q.getInput,fb=Q.getInputs,kb=
Q.getInputFor,Y=Q.getInputsFor,Ga=Q.getInputValues,Ea=L.cancel,Pa=L.CheckSpan.set,la=metaBook.glossmodes,wa=metaBook.icon,va=metaBook.getTarget,sa=metaBook.getGlossTags,R=/(http:)|(https:)|(ftp:)|(urn:)/,Ya=!1,Qa=[];metaBook.getGlossMode=function(a){a||(a=ma("METABOOKLIVEGLOSS"));"string"===typeof a&&(a=ma(a));if(!a||!a.nodeType)return!1;"FORM"!==a.tagName&&(a=xa(a,"FORM"));return(a=la.exec(a.className))&&0!==a.length&&a[0]?a[0]:!1};metaBook.setGlossMode=a;metaBook.getGlossForm=n;metaBook.setGlossTarget=
h;metaBook.setSelecting=e;metaBook.UI.selectText=k;metaBook.setGlossForm=p;metaBook.addOutlet2Form=q;metaBook.setExcerpt=b;metaBook.addTag2Form=d;metaBook.setGlossNetwork=function(a,b,c){"string"===typeof a&&(a=ma(a));a&&(a=Aa(a,"NETWORKS",b))&&(a=ba(a,".checkspan"))&&Pa(a,c)};var ja={'"':'"',"'":"'","/":"/","<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"},Fa=/["'\/\[(<{}>)\]\u00ab\u00bb]/g,Wa=!1;metaBook.findTag=A;var ra=W.stdspace;metaBook.handleTagInput=function(a,b,c){var e="@"===a[0],f=e?metaBook.share_cloud:
metaBook.gloss_cloud,g="@"===a[0]||"#"===a[0]?a.slice(1):a;a=f.complete(g);g=ra(g);if(e){for(var h=[],l=0,k=a.length;l<k;){var m=a[l++];za(m,"outlet")&&h.push(m)}a=h}if(a&&0!==a.length){e=!1;if(1===a.length)e=a[0];else if(a.exact&&1===a.exact.length)e=a.exact[0];else for(e=a[0],f=0,h=a.length;f<h;)if(a[f++]!==e){e=!1;break}if(e&&e===a[0]&&(a=metaBook.gloss_cloud.getKey(a.matches[0]),c?a.toLowerCase()!==g.toLowerCase():0!==a.toLowerCase().search()))return d(b,g),metaBook.gloss_cloud.complete(""),g;
if(e)return b=d(b,e),metaBook.gloss_cloud.complete(""),y(b,metaBook.gloss_cloud.getKey(e));d(b,g);metaBook.gloss_cloud.complete("");return g}e?q(b,g):d(b,g);f.complete("");return g};metaBook.UI.handlers.glosscloud_select=function(a){var b=L.T(a);if(b=ba(b,".completion")){var c=ma("METABOOKLIVEGLOSS"),c=c&&xa(c,"form"),e=d(c,b);!za("METABOOKHUD","glossaddtag")&&(e=y(e,metaBook.gloss_cloud.getKey(b)),(b=Aa(c,"NOTE"))&&e&&(e=void 0,c=b.value,e||(e=b.selectionStart),e=A(c,e)))&&(b.value=c.slice(0,e.start)+
c.slice(e.end))}L.cancel(a)};metaBook.UI.sharecloud_ontap=function(a){var b=L.T(a);if(b=ba(b,".completion")){var c=ma("METABOOKLIVEGLOSS"),c=c&&xa(c,"form"),d=b.getAttribute("data-value");za(b,"source")?d&&q(c,metaBook.sourcedb.ref(d),"SHARE"):za(b,"network")?q(c,b,"NETWORK"):za(b,"email")&&(d?q(c,b,"EMAIL"):q(c,b))}L.cancel(a)};var cb=!1;metaBook.submitGloss=M;metaBook.cancelGloss=t;var qa={};metaBook.writeQueuedGlosses=P;metaBook.UI.glossform_outlets_tapped=C;var Xa=!1;metaBook.UI.changeGlossNetwork=
function(a){a=a||window.event;a=L.T(a);var b=ma(Q.hasParent(a,".metabookglossform")?"METABOOKNETWORKBUTTONS":"METABOOKLIVEGLOSS"),b=Y(b,"NETWORK",a.value);L.CheckSpan.set(b,a.checked)};metaBook.UI.changeGlossPosting=function(a){a=L.T(a||window.event);var b=ba(a,".metabookglossform");a.checked?Q.addClass(b,"posted"):Q.dropClass(b,"posted")};metaBook.UI.changeGlossPrivacy=function(a){a=a||window.event;a=L.T(a||window.event);var b=ba(a,".metabookglossform"),c=xa(b,".postgloss"),d=c&&Aa(c,"POSTGLOSS");
c&&(a.checked?d&&(d.disabled=!0):d&&(d.disabled=!1));a.checked?Q.addClass(b,"private"):Q.dropClass(b,"private")};metaBook.UI.glossFormFocus=oa;metaBook.UI.glossform_touch=ga;metaBook.UI.glossform_focus=oa;metaBook.UI.glossform_blur=function(a){a=a||window.event;a=L.T(a);var b=(a=(a=ba(a,"FORM"))&&ba(a,".metabookglossform"))&&xa(a,"TEXTAREA");a&&ia(a,"focused");b&&metaBook.clearFocus(b);metaBook.setHUD(!1,!1);Ha();metaBook.freezelayout=!1};var ob=/\b(link|upload|body|capture)\b/g;metaBook.UI.changeAttachment=
function(a){a=a||window.event;a=L.T(a);var b=ba(a,"form"),c=a.value;a.checked?Q.swapClass(b,ob,c):ia(b,a.value)};metaBook.setAttachType=z;metaBook.startGloss=function(a){var b=metaBook.UI.selectText(a);metaBook.TapHold.body&&metaBook.TapHold.body.abort&&metaBook.TapHold.body.abort();metaBook.select_target=a;Qa.push(b);Qa[a.id]=b;L.TapHold.clear();La(a,!1,!1)};metaBook.startAddGloss=La;metaBook.saveGlossDialog=Na;metaBook.startSelect=function(a,b){var c=metaBook.UI.selectText(a);metaBook.TapHold.body&&
metaBook.TapHold.body.abort&&metaBook.TapHold.body.abort();metaBook.select_target=a;Qa.push(c);Qa[a.id]=c;L.TapHold.clear();(pa.gestures||pa.selecting)&&ka("body_held/select_wait %o %o %o",c,a,b);setTimeout(function(){(pa.gestures||pa.selecting)&&ka("body_held/select_start %o %o %o",c,a,b);c.startEvent(b,250)},0)};metaBook.abortSelect=H;metaBook.getTextSelectors=function(){return Qa};metaBook.closeGlossForm=function(a,b){a||(a=metaBook.glossform);a&&!Ya&&(za(a,"modified")?za(a,"glossadd")?Na():metaBook.submitGloss(a):
metaBook.cancelGloss(),b&&L.cancel(b))};fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{".metabookglossform":{click:ga,touchstart:ga},glossbutton:{mouseup:function(a){a=a||window.event;var b=L.T(a),b=va(b);"addgloss"===metaBook.mode&&metaBook.glosstarget===b?(L.cancel(a),metaBook.setMode(!0)):b&&(L.cancel(a),a=h(b))&&(metaBook.setMode("addgloss"),p(a))},mousedown:Ea},"span.metabooksharegloss":{tap:fdjt.UI.CheckSpan.onclick},".metabookglossform .response":{click:metaBook.toggleHUD},".addglossmenu":{tap:V,
hold:B,slip:r,release:N,click:Ea},"div.glossetc":{click:hb},"div.glossetc div.sharing":{click:C},"div.glossetc div.notetext":{click:nb},"#METABOOKADDGLOSS":{dragenter:Za,dragover:Za,drop:ab},"#METABOOKATTACHFILE":{click:fa},"#METABOOKGLOSSATTACH":{dragenter:Za,dragover:Za,drop:ab},"#METABOOKADDTAGINPUT":{keydown:aa},"#METABOOKADDSHAREINPUT":{keydown:l},"#METABOOKATTACHFORM":{submit:Ca},"#METABOOKATTACHURL":{keydown:Va},"#METABOOKATTACHTITLE":{keydown:Va},"#METABOOKATTACHCANCEL":{click:Ka},"#METABOOKATTACHDELETE":{click:bb},
"#METABOOKFILEINPUT":{change:$a},"#METABOOKGLOSSCLOUD":{tap:metaBook.UI.handlers.glosscloud_select,release:metaBook.UI.handlers.glosscloud_select},"#METABOOKSHARECLOUD":{tap:U,release:U}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{".metabookglossform .response":{click:metaBook.toggleHUD},".addglossmenu":{tap:V,hold:B,slip:r,release:N,click:Ea},"div.glossetc":{touchstart:hb,touchend:Ea},"div.glossetc div.sharing":{touchend:C,click:Ea},"div.glossetc div.notetext":{touchend:nb,click:Ea},"#METABOOKADDTAGINPUT":{keydown:aa},
"#METABOOKADDSHAREINPUT":{keydown:l},"#METABOOKATTACHFORM":{submit:Ca},"#METABOOKATTACHURL":{keydown:Va},"#METABOOKATTACHTITLE":{keydown:Va},"#METABOOKATTACHFILE":{click:fa},"#METABOOKATTACHCANCEL":{click:Ka},"#METABOOKATTACHDELETE":{click:bb},"#METABOOKADDGLOSS":{dragenter:Za,dragover:Za,drop:ab},"#METABOOKFILEINPUT":{change:$a},"#METABOOKGLOSSCLOUD":{tap:metaBook.UI.handlers.glosscloud_select,release:metaBook.UI.handlers.glosscloud_select},"#METABOOKSHARECLOUD":{tap:U,release:U}})})();(function(){function a(a,b){if(!0===a)return Wa;a?Wa||setTimeout(function(){Wa=!1;a()},b||400):Wa&&(clearTimeout(Wa),Wa=!1)}function n(a,b){if(!0===a)return ra;a?ra||setTimeout(function(){ra=!1;a()},b||500):ra&&(clearTimeout(ra),ra=!1)}function h(a,b){Z.addListeners(a,H.UI.handlers[metaBook.ui][b])}function m(a){a=a||window.event;var b=na.T(a),c=a.clientX,d=a.clientY,e=Q(),f=!1,g=Z.viewWidth();a.changedTouches&&a.changedTouches.length&&(f=a.changedTouches[0],c=f.clientX,d=f.clientY);W.gestures&&L("body_tapped %o c=%d,%d now=%o p=%o %s",
a,c,d,e,H.previewing,f?"(touch)":"");if(H.previewing)return b=Sa(b),H.stopPreview("body_tapped/stop_preview",b||!0),na.TapHold.clear(),R(a),!1;if(za(document.body,"mbSHOWHELP"))ia(document.body,"mbSHOWHELP");else if(H.touch&&H.textinput)H.clearFocus(H.textinput);else{if(H.passage_menu)return W.gestures&&L("body_tapped %o closing menu %o",a,H.passage_menu),H.TapHold.body&&metaBook.TapHold.body.abort(),R(a),q(a);if(H.skimming)H.hudup?Fa(!1,!1):f&&c<g/4?P(a,!0):f&&c<g/4?K(a,!0):Fa(!1);else{if(H.glosstarget){c=
metaBook.glossform;Oa(b,H.glosstarget)?ja("addgloss",!1):metaBook.closeGlossForm(c);R(a);return}if(H.hudup||H.mode)return ja(!1),Fa(!1),Ba("METABOOKOPENGLOSSMARK")&&(H.target&&metaBook.clearHighlights(H.target),Ba("METABOOKOPENGLOSSMARK").id=""),R(a),qa=Q(),!1;if(Ba("METABOOKOPENGLOSSMARK"))Ba("METABOOKOPENGLOSSMARK").id="",H.target&&metaBook.clearHighlights(H.target);else{if(Oa(b,".glossmark")||v(b))return R(a),!1;W.gestures&&L("body_tapped/fallthrough (%o) %o, m=%o, @%o,%o, vw=%o",a,b,H.mode,c,
d,Z.viewWidth());H.fullheight&&!H.hudup&&(50>d||d>Z.viewHeight()-50)?Fa(!0):c<.4*Z.viewWidth()?P(a,!0):K(a,!0)}}}R(a)}function e(a){var b=pa(a);if(b)return b;a=document.getElementsByName(a);if(0===a.length)return!1;if(1===a.length)return a[0];for(var c=b=0,d=a.length,e=metaBook.page;c<d;){var f=a[c++];if(za(f,"metabookdupstart"))return f;b||Oa(f,e)&&(b=4)}return b?b:a[0]}function v(a){if(qa&&1E3>Q()-qa)return!0;var b=ba(a,"A"),c,d=!1,d=b.rel,f=b.className;"string"!==typeof f&&(f="");"string"!==typeof d&&
(d="");if(b&&b.href&&(c=b.getAttribute("href"))){W.gestures&&L("ctouch: follow link %s",c);if("#"===c[0])if(a=c.slice(1),"string"!==typeof f&&(f=""),"string"!==typeof d&&(d=""),0<=d.search(ob)||0<=f.search(Da)||H.noterefspecs&&H.noterefspecs.match(b)){a:{b=pa(a);c=Ba("METABOOKBODY");d=document.body;if(!b){var g=document.getElementsByName(a);if(!c){c=!1;break a}if(g.length)for(f=0,g=g.length;f<g;)if(Oa(b[f],c)){b=b[f];break}else f++}if(b){for(var f=b,g=Z.getStyle(b),h=!1,l=metaBook.notespecs;f&&f!==
c&&f!==d;){if(l&&l.match(f)){c=f;break a}h||"block"===g.display&&(h=f);f=f.parentNode;g=Z.getStyle(f)}c=h?h:b}else c=void 0}b=c.id;metaBook.DOM.noteshud.innerHTML="";c=c.cloneNode(!0);Z.stripIDs(c);ia(c,/\bmetabook\S+/g);ta(c,"metabooknotebody");metaBook.DOM.noteshud.setAttribute("data-note",b||a);Z.append(wa.noteshud,c);ja("shownote");qa=Q()}else 0<=d.search(qb)?(a=Ba(a),Z.removeChildren(wa.asidehud),Z.append(wa.asidehud,a.cloneNode(!0)),ja("showaside"),qa=Q()):metaBook.xtargets[a]?(a=metaBook.xtargets[a],
qa=Q(),a()):(d=e(a))?(metaBook.JumpTo(d),qa=Q()):L.warn("Couldn't resolve %s",a);else 0<=d.search(jb)||0<=f.search(rb)||b.target||(b.target="_blank"),Z.triggerClick(b);return!0}if(b=ba(a,"details,.html5details,.sbookdetails"))return Z.removeChildren(wa.notehud),metaBook.DOM.notehud.innerHTML=b.innerHTML,ja("showdetails"),qa=Q(),!0;if(b=ba(a,"aside,.html5aside,.sbookaside"))return Z.removeChildren(wa.asidehud),metaBook.DOM.asidehud.innerHTML=b.innerHTML,ja("showaside"),qa=Q(),!0;if(b=ba(a,"[data-glossid]")){b=
b.getAttribute("data-glossid");c=metaBook.glossdb.ref(b);if(!c)return!1;b=Z("div.metabookglosses.metabookslice");c=new Xa(b,[c],!1);b=Z("div.hudpanel#METABOOKPOINTGLOSSES",b);Z.replace("METABOOKPOINTGLOSSES",b);metaBook.setTarget(a);c.update();ja("openglossmark");return!0}return!1}function k(a){a=a||window.event;var b=fdjt.UI.T(a);ba(b,"A[href]")||(R(a),a=H.DOM.noteshud,(b=a.getAttribute("data-note"))?(a.removeAttribute("data-note"),a.innerHTML="",H.setMode(!1),H.GoTo(b,"jumpToNote",!0,!0)):H.setMode(!1))}
function x(a){a=a||window.event;var b=na.T(a),c=Sa(b);W.gestures&&L("body_held %o p=%o p.p=%o bc=%s hc=%s",a,c,c&&c.parentNode,document.body.className,metaBook.HUD.className);if(!H.previewing){if(Oa(b,"A")){var d=(b=ba(b,"A"))&&b.getAttribute("href");R(a);if(d&&"#"===d[0]&&pa(d.slice(1))){W.gestures&&L("anchor_preview/body_held %o %o %o",a,b,d);H.startPreview(d.slice(1),"content/anchor_held");return}}c&&(H.glosstarget===c?"addgloss"!==H.mode&&ja("addgloss",!1):H.skimming?(R(a),H.stopSkimming(),Fa(!1),
H.TapHold.body.abort()):(H.startSelect(c,a),H.startAddGloss(c,!1,a)))}}function p(a){var b=na.T(a),c=Sa(b);W.gestures&&L("body_taptap %o p=%o p.p=%o bc=%s hc=%s t=%o gt=%o",a,c,c&&c.parentNode,document.body.className,H.HUD.className,b,H.glosstarget);Oa(b,"IMG,AUDIO,VIDEO,OBJECT")?(H.startZoom(ba(b,"IMG,AUDIO,VIDEO,OBJECT")),R(a)):(H.glosstarget&&(Oa(b,H.glosstarget)?ja("addgloss",!1):metaBook.closeGlossForm()),c&&(H.glosstarget===c?"addgloss"!==H.mode&&ja("addgloss",!1):(b=[{label:"Add Gloss",classname:"addgloss",
handler:function(){H.startGloss(c)},isdefault:!0}],b.push({label:"Zoom content",classname:"zoomcontent",handler:function(){H.startZoom(c);R(a)}}),u(c,b),1===b.length?(R(a),H.startGloss(c)):(R(a),b.push({label:"Cancel",classname:"cancel",handler:function(){metaBook.cancelGloss()}}),metaBook.passage_menu=na.choose({choices:b,spec:"div.fdjtdialog.metabooktaptap"})))))}function u(a,b){for(var d=a;d;){var e=a.getAttribute("data-xref");if(e){var f=e.indexOf(" "),h=0<f?e.slice(0,f):e,e=0<f?e.slice(f+1):
e,f={id:a.id,docid:H.docref,refuri:H.refuri,docuri:H.docuri};H.user&&H.user._id&&(f.user=H.user._id);h={label:e,handler:c(Ea(h,f))};b.push(h)}d=d.parentNode}d=Aa(a,"a[href]");h=0;for(e=d.length;h<e;){var f=d[h++],l=Ga(f.getAttribute("href")),l=0===l.search("#")?g(l):c(f.href),k=Z("span.anchortext");k.innerHTML=f.title||f.innerHTML;b.push({handler:l,label:k,classname:"anchor"})}}function q(a){a=a||window.event;if(!H.passage_menu)return!1;if(a){var b=na.T(a);if(H.passage_menu&&Oa(b,H.passage_menu))return!1}b=
H.passage_menu;H.passage_menu=!1;fdjt.Dialog.close(b);a&&R(a);return!0}function g(a){return function(){metaBook.GoTo(a)}}function c(a){return function(){window.open(a)}}function b(a){a=a||window.event;ea=!1;H.zoomed||"METABOOKBODY"===na.T(a).id&&(ea=Q())}function d(a){a=a||window.event;if(!H.zoomed&&"METABOOKBODY"===na.T(a).id&&ea&&1E3>Q()-ea){H.TapHold.body&&metaBook.TapHold.body.abort();R(a);var b=a.clientX||a.changedTouches&&a.changedTouches.length&&a.changedTouches[0].clientX,c=Z.viewWidth();
b>c/2?K(a):P(a)}}function A(a){a=a||window.event;if(!H.zoomed){var b=na.T(a),c=!1;W.gestures&&L("body_released %o",a);if(H.previewing)H.stopPreview("body_released"),R(a);else if(Oa(b,"A"))R(a);else{c=Oa(b,".fdjtselecting")&&Sa(b);if(!c){c=Aa(b,".fdjtselected");if(0===c.length){metaBook.abortSelect();return}b=c[0];c=Sa(b)}W.gestures&&L("body_released %o p=%o gt=%o gf=%o",a,c,H.glosstarget,H.glossform);H.glosstarget===c?(H.glossform&&(metaBook.glossform.id="METABOOKLIVEGLOSS"),"addgloss"!==H.mode&&
ja("addgloss")):H.startAddGloss(c,a.shiftKey&&"addtag",a)}}}function w(a){for(var b=document.body;a&&a!==b&&1===a.nodeType;){if(a.name&&0===a.name.search("SBR")||a.getAttribute("name")&&0===a.getAttribute("name").search("SBR"))return a;a=a.parentNode}return!1}function f(a,b){for(var c=Aa(a,".metabooktitle"),d=0,e=c.length;d<e;){var f=c[d++];if(f.name===b)return f}return!1}function D(a){a=a||window.event;var b=na.T(a);if(H.previewing)H.stopPreview("toc_tapped"),R(a);else if(b=w(b)){var c=(b.name||
b.getAttribute("name")).slice(3),d=metaBook.docinfo[c].elt||pa(c);d.id!==c&&(d=pa(c));W.gestures&&L("toc_tapped %o about=%o ref=%s target=%o",a,b,c,d);metaBook.JumpTo(d);R(a)}else W.gestures&&L("toc_tapped %o noabout",a)}function J(b){b=b||window.event;var c=na.T(b),d=w(c);a(!1);n(!1);if(d){var e=d.name||d.getAttribute("name"),c=e.slice(3),g=ba(d,".metabooktoc"),e=f(g,e);W.gestures&&L("toc_held %o about=%o ref=%s toc=%o title=%s",b,d,c,g,e);ta(e,"metabookpreviewtitle");ta(d.parentNode,"metabookheld");
d=ba(d,".spanbar")||xa(g,".spanbar");ta(d,"metabookvisible");ta(g,"metabookheld");H.startPreview(pa(c),"toc_held");return R(b)}W.gestures&&L("toc_held %o noabout",b)}function G(b){b=b||window.event;var c=w(na.T(b));a(!1);if(c){var d=c.name||c.getAttribute("name"),e=d.slice(3),g=ba(c,".metabooktoc"),d=f(g,d);W.gestures&&L("toc_released %o ref=%o about=%o toc=%o title=%s",b,e,c,g,d);ia(d,"metabookpreviewtitle");ia(c.parentNode,"metabookheld");c=ba(c,".spanbar")||xa(g,".spanbar");ia(c,"metabookvisible");
ia(g,"metabookheld");H.previewing&&H.stopPreview("toc_released")}else W.gestures&&L("toc_released %o noabout",b),H.stopPreview("toc_released");R(b)}function y(a){a=a||window.event;ra||n(function(){ra=!1;W.gestures&&L("toc_slipped/timeout %o",a);H.stopPreview("toc_slipped")})}function E(a){a=a||window.event||null;var b=a.keyCode,c=na.T(a);if(27===a.keyCode)H.previewing&&(H.stopPreview("escape_key"),na.TapHold.clear()),ia(document.body,"mbZOOM"),ia(document.body,"mbMEDIA"),H.zoomed=!1,"addgloss"===
H.mode&&metaBook.cancelGloss(),H.mode&&(metaBook.last_mode=metaBook.mode,ja(!1),metaBook.setTarget(!1),Ba("METABOOKSEARCHINPUT").blur());else if("TEXTAREA"!==c.tagName&&"INPUT"!==c.tagName&&"BUTTON"!==c.tagName&&!c.isContentEditable){W.gestures&&L("metabook_keydown %o: %o on %o",a,b,c);if(H.controlc&&a.ctrlKey&&(99===b||67===b))H.previewing&&H.stopPreview("mb_onkeydown",!0),na.TapHold.clear(),ja("console"),R(a);else{if(a.altKey||a.ctrlKey||a.metaKey)return!0;if(H.previewing)return H.stopPreview("mb_onkeydown",
!0),na.TapHold.clear(),Fa(!1),R(a),!1;if(za(document.body,"mbCOVER"))return metaBook.clearStateDialog(),metaBook.hideCover(),R(a),!1;if(za(document.body,"mbZOOM"))return 34===b?Z.pageScroll(Ba("METABOOKZOOM"),1):33===b&&Z.pageScroll(Ba("METABOOKZOOM"),-1),!1;if(H.glossform){c=fdjt.DOM.getInput(H.glossform,"NOTE");metaBook.UI.glossFormFocus(H.glossform);metaBook.setFocus(c);c.focus();var d=document.createEvent("UIEvent");d.initUIEvent("keydown",!0,!0,window);d.keyCode=b;c.dispatchEvent(d);R(a);return}if(34===
b)K(a);else if(33===b)P(a);else if(40===b)Fa(!1),K(a);else if(38===b)Fa(!1),metaBook.pageBackward(a);else if(37===b)H.mode&&!H.skimming&&la[metaBook.mode]?Ha.fastBackward(la[metaBook.mode]):metaBook.skimBackward(a);else if(39===b)H.mode&&!H.skimming&&la[metaBook.mode]?Ha.fastForward(la[metaBook.mode]):metaBook.skimForward(a);else{if(Z.isTextInput(Z.T(a)))return!0;if(32===b)H.mode&&!H.skimming&&la[metaBook.mode]?a.shiftKey?Ha.fastForward(la[metaBook.mode]):Ha.forward(la[metaBook.mode]):K(a,!0);else if(8===
b||45===b)H.mode&&!H.skimming&&la[metaBook.mode]?a.shiftKey?Ha.fastBackward(la[metaBook.mode]):Ha.backward(la[metaBook.mode]):P(a,!0);else if(36===b)metaBook.JumpTo(H.head);else if("addgloss"===H.mode){if(metaBook.getGlossMode())return;c=(c=Ba("METABOOKLIVEGLOSS"))&&xa(c,"FORM");if(!c)return;13===b?va(c):35===b||91===b?metaBook.setGlossMode("addtag",c):32===b?metaBook.setGlossMode("editnote",c):47===b||58===b?metaBook.setGlossMode("attach",c):64===b&&metaBook.setGlossMode("addoutlet",c)}else return}}R(a)}}
function F(a){a=a||window.event||null;if(Z.isTextInput(Z.T(a))||a.ctrlKey||a.altKey||a.metaKey)return!0}function O(a){var b=!1;a=a||window.event||null;var b=a.charCode||a.keyCode,c=Z.T(a);if(Z.isTextInput(c)||a.altKey||a.ctrlKey||a.metaKey)return!0;W.gestures&&L("metabook_onkeypress %o: %o on %o",a,b,c);if(72===b||104===b)return metaBook.clearStateDialog(),metaBook.hideCover(),Z.toggleClass(document.body,"metabookhelp"),!1;if(67===b||99===b)return metaBook.clearStateDialog(),metaBook.toggleCover(),
!1;if(za(document.body,"mbZOOM")){if(43===b)return H.zoom(1.1);if(45===b)return H.zoom(.9)}b=pb[b];"openheart"===b&&(b=metaBook.last_heartmode||"about");c=ja();b&&(c===b?(ja(!1),c=!1):(ja(b),c=b));"searching"===c?metaBook.setFocus(Ba("METABOOKSEARCHINPUT")):metaBook.clearFocus(Ba("METABOOKSEARCHINPUT"));Z.cancel(a)}function M(a){a=a||window.event;var b=na.T(a),c=b.getAttribute("hudmode");W.gestures&&L("hudmodebutton() %o mode=%o cl=%o skim=%o sbh=%o mode=%o",a,c,eb(b),metaBook.skimpoint,H.hudup,H.setMode());
metaBook.clearStateDialog();Qa.live&&Qa.flash();R(a);if(c)if(b=za(H.HUD,c)||"search"===c&&za(H.HUD,H.searchModes),"click"===a.type||"tap"===a.type||"release"===a.type){ia(document.body,"_HOLDING");if(H.skimpoint&&!H.hudup){if("refinesearch"===c||"searchresults"===c){ja("searchresults");return}if("allglosses"===c){ja("allglosses");return}if("statictoc"===c){ja("statictoc");return}}b?za(document.body,"mbSKIMMING")?H.stopSkimming():ja(!1,!0):(za(document.body,"mbSKIMMING")&&H.stopSkimming(),ja(c))}else"hold"===
a.type?ta(document.body,"_HOLDING"):ia(document.body,"_HOLDING")}function I(a){a=a||window.event||null;cb&&cb&&(clearTimeout(cb),cb=!1,W.gestures&&L("clear_hold from %s","glossmark_tapped"));if(!(a.ctrlKey||a.altKey||a.metaKey||a.shiftKey)){var b=na.T(a),c=ba(b,".glossmark"),d=c.name&&0===c.name.search("GLOSSMARK_NAME_")&&Ba(c.name.slice(15))||Sa(c.parentNode,!0);d&&d.getAttribute("data-baseid")&&(d=pa(d.getAttribute("data-baseid")));W.gestures&&L("glossmark_tapped (%o) on %o gmark=%o passage=%o mode=%o target=%o",
a,b,c,d,H.mode,H.target);if(!c)return!1;R(a);"openglossmark"===H.mode&&H.target===d?(ja(!1),metaBook.clearGlossmark()):H.select_target||metaBook.showGlossmark(d,c)}}function t(a,b){if(a&&b){var c=za(a,"glossmark")?a:ba(a,".glossmark");if(c&&lb!==c){ya&&(clearInterval(ya),ya=lb=!1,mb&&na.ImageSwap.reset(mb));var d=xa(c,"img.wedge");d&&(lb=c,mb=d,ya=na.ImageSwap(d,750))}}else ya&&(clearInterval(ya),ya=lb=!1,mb&&na.ImageSwap.reset(mb),mb=!1)}function T(a){H.previewing&&na.noDefault(a)}function K(a,b){a=
a||window.event;ia(document.body,/\bmb(PAGE)?PREVIEW/g);var c=Q();Ta&&100>c-Ta||(Ta=c,ia(document.body,/\bmb(PAGE)?PREVIEW/g),b&&(H.hudup||H.mode)&&fdjt.Async(function(){H.setHUD(!1)}),H.readsound&&Z.playAudio("METABOOKPAGEORWARDAUDIO"),(W.gestures||W.flips)&&L("pageForward (on %o) c=%o n=%o",a,H.curpage,H.pagecount),H.bypage&&"number"===typeof metaBook.curpage?H.curpage>=(H.bypage&&(H.pagecount||H.layout.pagenum-1))||metaBook.GoToPage(metaBook.curpage+1,"pageForward",!0,!0):(c=Z.viewHeight()-50,
0>c&&(c=Z.viewHeight()),c=Z.viewTop()+c,window.scrollTo(Z.viewLeft(),c)))}function P(a,b){var c=Q();ia(document.body,/\bmb(PAGE)?PREVIEW/g);Ta&&100>c-Ta||(Ta=c,a=a||window.event,b&&fdjt.Async(function(){H.setHUD(!1)}),H.readsound&&Z.playAudio("METABOOKPAGEBACKWARDAUDIO"),(W.gestures||W.flips)&&L("pageBackward (on %o) c=%o n=%o",a,H.curpage,H.pagecount),H.bypage&&"number"===typeof metaBook.curpage?(c=!1,0!==H.curpage&&(c=metaBook.curpage-1,metaBook.GoToPage(c,"pageBackward",!0,!0))):(c=Z.viewHeight()-
50,0>c&&(c=Z.viewHeight()),c=Z.viewTop()-c,window.scrollTo(Z.viewLeft(),c)))}function C(a){var b=Q(),c=metaBook.slices[metaBook.mode];(W.gestures||W.nav)&&L("skimForward %o: mode=%s",a,H.mode);ia(document.body,/\bmb(PAGE)?PREVIEW/g);if(!(Ta&&100>b-Ta)&&(Ta=b,H.uisound&&Z.playAudio("METABOOKSKIMFORWARDAUDIO"),c))return H.uisound&&Z.playAudio("METABOOKSKIMFORWARDAUDIO"),ta("METABOOKSKIMMER","flash"),ta("METABOOKNEXTSKIM","flash"),setTimeout(function(){ia("METABOOKSKIMMER","flash");ia("METABOOKNEXTSKIM",
"flash")},200),(a=c.forward())&&metaBook.SkimTo(a,1),a}function U(a){var b=Q(),c=metaBook.slices[metaBook.mode];(W.gestures||W.nav)&&L("skimBackward %o: mode=%s",a,H.mode);ia(document.body,/\bmb(PAGE)?PREVIEW/g);if(!(Ta&&100>b-Ta)&&(Ta=b,H.uisound&&Z.playAudio("METABOOKSKIMBACKWARDAUDIO"),c))return ta("METABOOKPREVSKIM","flash"),ta("METABOOKSKIMMER","flash"),setTimeout(function(){ia("METABOOKSKIMMER","flash");ia("METABOOKPREVSKIM","flash")},200),(a=c.backward())&&metaBook.SkimTo(a,-1),a}function V(a){a=
a||window.event;var b=na.T(a);if(!eb(b))if(ba(b,".tool"))(a=Pa(b))&&(a.name||a.getAttribute("name"))&&(a=a.name||a.getAttribute("name"),(a=ib.resolve(a,H.glossdb))&&metaBook.setGlossTarget(a)&&(H.stopSkimming(),ja("addgloss")));else{if(ba(b,".mbmedia")){var c=ba(b,".mbmedia"),d=c.getAttribute("data-src"),e=!1,f=c.getAttribute("data-type");if(za(c,"imagelink"))metaBook.showMedia(d,f),e=!0;else if(za(c,"audiolink")||za(c,"musiclink"))metaBook.showMedia(d,f),e=!0;if(e){R(a);return}}ba(b,"mbcard_tochead")?
(a=(a=ba(b,".tocref"))&&a.getAttribute("data-tocref"))?metaBook.GoTOC(a):Ja("METABOOKSKIMMER","expanded"):(H.hudup?H.stopSkimming():Fa(!0,!1),R(a))}}function B(a){var b=a.deltaX,c=a.deltaY,d=Z.viewWidth(),e=0>b?-b:b,f=0>c?-c:c;W.gestures&&L("skimmer_swiped d=%o,%o, ad=%o,%o, s=%o,%o vw=%o, n=%o",b,c,e,f,a.startX,a.startY,d,a.ntouches);if(e>2*f)b<-(H.minswipe||10)?metaBook.skimForward(a):b>(H.minswipe||10)&&metaBook.skimBackward(a);else if(f>2*e){if(f<=(H.minswipe||10))return;0>c?H.setHUD(!1):H.stopSkimming()}R(a)}
function N(a){a=a||window.event;H.hudup||H.mode||H.cxthelp?(R(a),ja(!1)):(R(a),H.hudup?ja(!1):ja("gotopage",!0))}function r(a){a=a||window.event;H.hudup||H.mode||H.cxthelp?(R(a),ja(!1)):(R(a),H.hudup?ja(!1):ja("gotoref",!0))}function da(a){a=a||window.event;H.hudup||H.mode||H.cxthelp?(R(a),ja(!1)):(R(a),H.hudup?ja(!1):ja("gotoloc",!0))}function X(a){a=a||window.event;H.hudup||H.mode||H.cxthelp?(R(a),ja(!1)):(R(a),H.hudup?ja(!1):ja("gotoloc",!0))}function S(a){a=a||window.event;var b=na.T(a);W.gestures&&
L("head_tap %o t=%o",a,b);if(H.previewing)H.stopPreview("head_tap"),R(a);else{if(na.isClickable(b))return Va(a);if(b===metaBook.DOM.head||b===metaBook.DOM.tabs)H.mode?(R(a),ja(!1)):Z.hasClass(document.body,"mbSHOWHELP")?(R(a),ia(document.body,"mbSHOWHELP")):H.hudup?(R(a),ja(!1)):(R(a),ja(!0))}}function oa(a){W.gestures&&L("foot_tap %o",a);H.previewing?(H.stopPreview("foot_tap"),R(a)):eb(a)||Oa(na.T(a),"hudbutton")||!(H.hudup||H.mode||H.cxthelp)||(R(a),ja(!1))}function ga(a){a=a||window.event;R(a);
"addgloss"===H.mode&&metaBook.cancelGloss();ja(!1);ia(document.body,"mbSHOWHELP")}function ca(a){ja(!1)}function Ma(a){a?H.textinput!==a&&(metaBook.textinput=a,metaBook.freezelayout=!0,a.focus()):(a=metaBook.textinput,metaBook.textinput=!1,metaBook.freezelayout=!1,a&&a.blur())}function l(a){a||(a=metaBook.textinput);a&&H.textinput===a&&(metaBook.textinput=!1,metaBook.freezelayout=!1,a.blur())}function aa(a){a=a||window.event;a=na.T(a);var b=ba(a,"textarea");b||(b=ba(a,"input"));b&&"string"===typeof b.type&&
0===b.type.search(Z.text_types)&&Ma(b)}function z(a){a=a||window.event;a=a.nodeType?a:na.T(a);var b=ba(a,"textarea");metaBook.previewing&&a===window&&H.stopPreview();b||(b=ba(a,"input"));b&&"string"===typeof b.type&&0===b.type.search(Z.text_types)&&l(b)}function Ca(a){a?(ta(document.body,"mbSHOWHELP"),metaBook.cxthelp=!0):(ia(document.body,"mbSHOWHELP"),metaBook.cxthelp=!1);return!1}function Ka(a){a=a||window.event;W.gestures&&L("toggleHelp %o",a);R(a);H.cxthelp?(ia(document.body,"mbSHOWHELP"),metaBook.cxthelp=
!1):(ta(document.body,"mbSHOWHELP"),metaBook.cxthelp=!0);return!1}function Va(a){a=a||window.event;var b=na.T(a);if("TEXTAREA"===b.tagName||"INPUT"===b.tagName&&0<=b.type.search(Z.text_input_types))b.focus(),Ya(a);else if("A"===b.tagName&&b.href){var c=b.href;if("#"===c[0]){var b=c.slice(1),c=H.xtargets[b],d;if(c)R(a),c();else if(d=H.ID(b))R(a),ma(function(){H.GoTo(d)})}else if(H.xrules&&0<H.xrules.length){a=H.xrules;for(var e=0,f=a.length;e<f;){var g=a[e++];if(0<=c.search(g.pattern)&&g.handler(c,
b))break}}}}function Ra(a){if(!H.hudup&&!H.closed){var b=a.touches&&a.touches.length&&a.touches||a.changedTouches&&a.changedTouches.length&&a.changedTouches,c=a.clientX||b&&b[0].clientX,b=a.clientY||b&&b[0].clientY,d=(c||b)&&document.elementFromPoint(c,b);1<H.Trace.gestures&&L("dombody_touched %o: %o @ <%o,%o>",a,d,c,b);if(d===document.body&&!(50>b||50>d.offsetHeight-b)){H.Trace.gestures&&L("dombody_touched(atedge) %o: %o @ <%o,%o>",a,d,c,b);if(10>c)return H.pageBackward();if(10>d.offsetWidth-c)return H.pageForward()}}}
function fa(a){a=a||window.event;if(!H.touch||H.hudup){if(!(a.shiftKey||a.touches&&2<=a.touches.length)){var b=metaBook.readLocal("mB("+H.docid+").opened",!0);b&&6E5<b-Q()&&(Ba("METABOOKCOVERHOLDER")?Ba("METABOOKCOVER").className="bookcover":Ba("METABOOKCOVER").className="titlepage")}metaBook.clearStateDialog();metaBook.showCover();R(a)}}function ua(a){a=a||window.event;a.shiftKey||a.touches&&2<=a.touches.length||(Ba("METABOOKCOVER").className="bookcover");metaBook.clearStateDialog();metaBook.showCover();
R(a)}function bb(a){a=a||window.event;W.gestures&&L("raiseHUD %o",a);Fa(!0);R(a);return!1}function Ia(a){a=a||window.event;W.gestures&&L("saveGloss %o",a);metaBook.submitGloss()}function hb(a){a=a||window.event;R(a);W.gestures&&L("refreshLayout %o",a);metaBook.refreshLayout()}function Za(a){a=a||window.event;R(a);na.choose({choices:[{label:"OK",isdefault:!0,handler:function(){metaBook.resetState()}},{label:"Cancel"}],spec:"div.fdjtdialog.mbsettings"},"Mark current location as ",Z("em","latest")," and ",
Z("em","farthest"),"?",H.locsync&&"for all syncing devices")}function ab(a){a=a||window.event;R(a);na.choose({choices:[{label:"OK",isdefault:!0,handler:function(){metaBook.refreshOffline()}},{label:"Cancel"}],spec:"div.fdjtdialog.mbsettings"},"Reload all glosses and layers?")}function $a(a){a=a||window.event;R(a);W.gestures&&L("clearOffline %o",a);metaBook.clearOffline()}function nb(a){a=a||window.event;metaBook.consolefn(a)}function La(a){L("toggleDevMode %o",a);if(gb){var b=document.documentElement||
document.body,c=Q();1E3>c-gb?(H.devmode?(metaBook.devmode=!1,ka.dropLocal("mB.devmode"),ia(b,"_DEVMODE")):(metaBook.devmode=!0,ka.setLocal("mB.devmode",!0),ta(b,"_DEVMODE")),gb=!1):gb=c}else gb=Q();R(a)}function Na(a){var b=fdjt.UI.T(a);Oa(b,"A[href]")?qa&&2E3>Q()-qa&&R(a):R(a)}var H=metaBook,W=H.Trace,ha=fdjt.String,Ha=fdjt.showPage,ka=fdjt.State,Q=fdjt.Time,L=fdjt.Log,Z=fdjt.DOM,na=fdjt.UI,ma=fdjt.Async,ib=fdjt.RefDB,Ba=fdjt.ID,pa=metaBook.ID,ta=Z.addClass,za=Z.hasClass,ia=Z.dropClass,Ja=Z.toggleClass,
Sa=metaBook.getTarget,ba=Z.getParent,Oa=Z.hasParent,eb=na.isClickable,xa=Z.getChild,Aa=Z.getChildren,fb=Z.getInput,kb=Z.Selector,Y=ha.isEmpty,Ga=ha.decodeEntities,Ea=ha.fillIn,Pa=metaBook.UI.getCard,la=metaBook.pagers,wa=metaBook.DOM,va=na.submitEvent,sa=fdjt.UI.noDefault,R=fdjt.UI.cancel,Ya=fdjt.UI.noBubble,Qa=na.Reticle,ja=metaBook.setMode,Fa=metaBook.setHUD,Wa=!1;metaBook.previewTimeout=a;var ra=!1;metaBook.slipTimeout=n;metaBook.uiclasses=/\b(metabookui|glossmark)\b/gi;metaBook.addConfig("controlc",
function(a,b){metaBook.controlc=b});metaBook.UI.addHandlers=h;metaBook.setupGestures=function(a){var b=metaBook.ui;b||(metaBook.ui=b="mouse");!a&&(1<W.startup||W.gestures)&&L("Setting up basic handlers for %s UI",b);a&&W.gestures&&L("Setting up %s UI handlers for %o",b,a);a||(h(!1,"window"),h(document,"document"),h(document.body,"body"),h(Ba("METABOOKBODY"),"content"),metaBook.TapHold.body=na.TapHold(Ba("METABOOKBODY"),{override:!0,noslip:!0,id:"METABOOKBODY",maxtouches:3,taptapmsecs:!0,movethresh:10,
untouchable:!1}),metaBook.TapHold.menu=na.TapHold(Ba("METABOOKMENU"),{override:!0,noslip:!1,id:"METABOOKMENU",maxtouches:3,taptapmsecs:!1,movethresh:10,untouchable:!1}),h(metaBook.HUD,"hud"));if(b){var b=metaBook.UI.handlers[b],c=[],d=[],e;for(e in b)b.hasOwnProperty(e)&&(0<=e.indexOf(".")||0<=e.indexOf("#"))&&c.push(e);for(var c=c.sort(function(a,b){return b.length-a.length}),f=0,g=c.length;f<g;){e=c[f++];var l=Z.$(e,a),k=b[e];e=new kb(e);a&&e.match(a)&&Z.addListeners(a,k);e=0;for(var m=l.length;e<
m;){var n=l[e++];0>d.indexOf(n)&&(d.push(n),Z.addListeners(n,k))}}}2<W.startup&&L("Done with handler setup")};var cb=!1,qa=!1,Xa=metaBook.Slice,ob=/\b(((sbook)|(book)|(mbook)|(metabook)|(foot)|(end)|())note)\b/,Da=/\b((((sbook)|(book)|(meta))book)|(foot)|(end)|())(note|noteref)\b/,qb=/\b((sidebar)|(breakout)|(tangent))\b/,jb=/\b((iframe)|(popin))\b/,rb=/\b(()|(s)|(m)|(meta))book((iframe)|(popin))\b/;metaBook.closePassageMenu=q;var ea=!1;metaBook.initGlossMode=function(){var a=xa("METABOOKLIVEGLOSS",
"form");if(a){var b=fb(a,"NOTE");b&&metaBook.setFocus(b);metaBook.setGlossMode(a.className)}};var db=Z.wordRegExp;metaBook.highlightTerm=function(a,b,c,d){var e=[],f=[];if("string"===typeof a)e=d&&d[a]||[a];else{(c=c.knodes)?c instanceof Array||(c=[c]):c=[];for(var g=0,h=c.length;g<h;){var l=c[g++];if(l===a||ib.contains(l.allways,a)){var k=l._qid,m=l.dterm;(k=d&&(d[k]||d[m]))?"string"===typeof k?e.push(k):e=e.concat(k):((k=l.EN)&&("string"===typeof k?e.push(k):e=e.concat(k)),(l=l.hooks)&&("string"===
typeof l?e.push(l):e=e.concat(l)))}}0===e.length&&(e=!1)}if(!e)return[];"string"===typeof e&&(e=[e]);a=0;for(d=e.length;a<d;)if(g=e[a++],h=db(g),l=metaBook.getDups(b),c=Z.findMatches(l,h),c&&c.length||(h=db(g,!0),c=Z.findMatches(l,h)),W.highlight&&L("Trying to highlight %s (using %o) in %o, ranges=%o",g,h,b,c),c&&c.length)for(g=0;g<c.length;)h=na.Highlight(c[g++],"mbhighlightsearch"),f=f.concat(h);return f};metaBook.UI.handlers.onkeyup=F;var pb={63:"searching",102:"searching",65:"openheart",97:"openheart",
83:"searching",115:"searching",80:"gotopage",112:"gotopage",76:"gotoloc",108:"gotoloc",70:"searching",100:"device",68:"device",116:"statictoc",84:"statictoc",72:"help",103:"allglosses",71:"allglosses",67:"console",99:"console"};metaBook.UI.handlers.onkeypress=O;metaBook.UI.goto_keypress=function(a){a=a||window.event||null;var b=na.T(a),c=a.charCode||a.keyCode,d=!1;"GOTOLOC"!==b.name&&"GOTOPAGE"!==b.name&&13===c&&R(a);13===c&&("GOTOPAGE"===b.name?(a=parseInt(b.value,10),"number"===typeof a?(d=!0,metaBook.GoToPage(a)):
Y(b.value)&&(d=!0)):"GOTOREF"===b.name?(a=metaBook.layout.pagemap[b.value])?(metaBook.GoToPage(a),d=!0):Y(b.value)&&(d=!0):"GOTOLOC"===b.name&&(a=parseFloat(b.value),"number"===typeof a&&0<=a&&100>=a?(a=Math.floor(a/100*metaBook.ends_at)+1,metaBook.JumpTo(a),d=!0):Y(b.value)&&(d=!0)),d&&(b.value="",ja(!1)))};metaBook.UI.hudmodebutton=M;metaBook.UI.dropHUD=function(a){var b=na.T(a);eb(b)?W.gestures&&L("Clickable: don't dropHUD %o",a):(W.gestures&&L("dropHUD %o",a),R(a),ja(!1))};var lb=!1,ya=!1,mb=
!1;metaBook.UI.setTarget=function(a){a?(a=xa(a,".glossmark"))?t(a,!0):t(!1,!1):t(!1,!1)};metaBook.UI.forceSyncAction=function(a){a=a||window.event;R(a);metaBook.forceSync();navigator.onLine?H.connected?na.alertFor(7,"Sychronizing glosses, etc with the remote server"):na.alertFor(15,"You're not currently logged into sBooks.  Information will be synchronized when you've logged in."):na.alertFor(15,"You're currently offline; information will be synchronized when you're back online");return!1};var Ta=
!1;metaBook.Forward=function(a){a||(a=window.event||!1);a&&R(a);W.nav&&L("Forward e=%o h=%o t=%o",a,metaBook.head,H.target);H.skimming?C(a):H.mode&&la[metaBook.mode]?Ha.forward(la[metaBook.mode]):a&&a.shiftKey?C(a):K(a)};metaBook.Backward=function(a){a||(a=window.event||!1);a&&R(a);W.nav&&L("Backward e=%o h=%o t=%o",a,metaBook.head,H.target);H.skimming?U(a):H.mode&&la[metaBook.mode]?Ha.backward(la[metaBook.mode]):a&&a.shiftKey?U():P()};metaBook.pageForward=K;metaBook.pageBackward=P;metaBook.skimForward=
C;metaBook.skimBackward=U;metaBook.setFocus=Ma;metaBook.clearFocus=l;metaBook.UI.focus=aa;metaBook.UI.blur=z;metaBook.setHelp=Ca;metaBook.toggleHelp=Ka;metaBook.dombody_touched=Ra;metaBook.raiseHUD=bb;metaBook.lowerHUD=function(a){a=a||window.event;W.gestures&&L("lowerHUD %o",a);Fa(!1);R(a);return!1};var gb=!1;fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{window:{keyup:F,keydown:E,keypress:O,focus:aa,mouseout:function(a){a=na.T(a);(a===window||a===document.documentElement)&&metaBook.previewing&&
H.stopPreview()},blur:z},"#METABOOKBODY":{mouseup:function(a){a=a||window.event;H.zoomed||(H.page_turner?(clearInterval(H.page_turner),metaBook.page_turner=!1):H.select_target&&(H.startAddGloss(metaBook.select_target,a.shiftKey&&"addtag",a),metaBook.select_target=!1))}},content:{tap:m,taptap:p,hold:x,release:A,mousedown:b,mouseup:d,click:Na},toc:{tap:D,hold:J,release:G,slip:y,mouseover:na.CoHi.onmouseover,mouseout:na.CoHi.onmouseout,click:R},".mbtocslice":{mouseover:na.CoHi.onmouseover,mouseout:na.CoHi.onmouseout},
glossmark:{mouseup:I,click:R,mousedown:R,mouseover:function(a){a=a||window.event;a=na.T(a);var b=Sa(a);Z.hasClass(b,"mbtarget")||t(a,!0)},mouseout:function(a){a=a||window.event;a=na.T(a);var b=Sa(a);Z.hasClass(b,"mbtarget")||t(a,!1)}},hud:{click:Va,tap:Va},"#METABOOKSTARTPAGE":{click:metaBook.UI.dropHUD},"#METABOOKMENU":{tap:bb},"#METABOOKSHOWCOVER":{tap:fa,release:ua},"#METABOOKHUDHELP":{click:metaBook.UI.dropHUD},".hudtip":{click:metaBook.UI.dropHUD},".metabookheart":{tap:function(a){eb(a)||ja(!1)}},
"#METABOOKPAGEREFTEXT":{tap:r},"#METABOOKPAGENOTEXT":{tap:N},"#METABOOKLOCPCT":{tap:X},"#METABOOKLOCOFF":{tap:da},"#METABOOKSKIMMER":{tap:V,swipe:B},"#METABOOKPAGEHEAD":{click:S},"#METABOOKTABS":{click:S},"#METABOOKHEAD":{click:S},"#METABOOKFOOT":{tap:oa},".searchcloud":{tap:metaBook.UI.handlers.searchcloud_select,release:metaBook.UI.handlers.searchcloud_select},"#METABOOKHELPBUTTON":{tap:Ka,hold:function(a){Ca(!0);R(a)},release:function(a){Ca(!1);R(a)},slip:function(a){Ca(!1);R(a)}},"#METABOOKHELP":{click:Ka,
mousedown:R,mouseup:R},"#MBPAGERIGHT":{click:function(a){za(document.body,"mbSKIMMING")?C(a):K(a);R(a)}},"#MBPAGELEFT":{click:function(a){za(document.body,"mbSKIMMING")?U(a):P(a);R(a)}},"#METABOOKSHOWTEXT":{click:ga},"#METABOOKGLOSSDETAIL":{click:metaBook.UI.dropHUD},"#METABOOKNOTETEXT":{click:k},".hudmodebutton":{tap:M,hold:M,slip:M,release:M},".hudbutton[alt='save gloss']":{tap:Ia,hold:Ia},".metabookclosehud":{click:ga},"#METABOOKSETTINGS":{click:fdjt.UI.CheckSpan.onclick},".metabooktogglehelp":{click:Ka},
"#METABOOKCONSOLETEXTINPUT":{focus:function(){fdjt.DOM.addClass("METABOOKCONSOLEINPUT","uptop")},blur:function(){fdjt.DOM.dropClass("METABOOKCONSOLEINPUT","uptop")}},"#METABOOKCONSOLEBUTTON":{click:nb},"#METABOOKREFRESHOFFLINE":{click:ab},"#METABOOKREFRESHLAYOUT":{click:hb},"#METABOOKRESETSYNC":{click:Za},".clearoffline":{click:$a},".metabookclearmode":{click:ca},"#METABOOKGOTOREFHELP":{click:ca},"#METABOOKGOTOPAGEHELP":{click:ca},"#METABOOKGOTOLOCHELP":{click:ca},".metabookshowsearch":{click:function(a){metaBook.showSearchResults();
R(a)}},".metabookrefinesearch":{click:function(a){ja("refinesearch");R(a)}},".metabookexpandsearch":{click:function(a){ja("expandsearch");R(a)}},".metabookclearsearch":{click:function(a){a=a||window.event;metaBook.UI.handlers.clearSearch(a);R(a);return!1}},"#METABOOKSEARCHINFO":{click:metaBook.searchTags_onclick},"#METABOOKINFOPANEL":{click:La},".metabooksettings input[type='RADIO']":{change:H.configChange},".metabooksettings input[type='CHECKBOX']":{change:H.configChange}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,
{window:{keyup:F,keydown:E,keypress:O,touchmove:T,focus:aa,blur:z},content:{tap:m,hold:x,taptap:p,release:A,swipe:function(a){if(!H.zoomed){var b=a.deltaX,c=a.deltaY,d=Z.viewWidth(),e=0>b?-b:b,f=0>c?-c:c;W.gestures&&L("swiped d=%o,%o, ad=%o,%o, s=%o,%o vw=%o, n=%o",b,c,e,f,a.startX,a.startY,d,a.ntouches);e>2*f?b<-(H.minswipe||10)?2<a.ntouches?window.history.forward():1<a.ntouches?H.skimming?metaBook.skimForward(a):window.history.forward():H.mode&&!H.skimming&&la[metaBook.mode]?2===a.touches?Ha.fastForward(la[metaBook.mode]):
Ha.forward(la[metaBook.mode]):K(a,!0):b>(H.minswipe||10)&&(2<a.ntouches?window.history.back():1<a.ntouches?H.skimming?metaBook.skimBackward(a):window.history.back():H.mode&&!H.skimming&&la[metaBook.mode]?2===a.touches?Ha.fastBckward(la[metaBook.mode]):Ha.backward(la[metaBook.mode]):metaBook.pageBackward(a,!0)):f>2*e&&(H.hudup?c<-(H.minswipe||10)?ja("allglosses"):c>(H.minswipe||10)&&ja("search"):f<=(H.minswipe||10)||(a.startX<d/5&&0>c?ja("help"):a.startX<d/5&&0<c?ja("statictoc"):a.startX>.8*d&&0<c?
ja("search"):a.startX>.8*d&&0>c?ja("allglosses"):0<c&&metaBook.skimming?H.stopSkimming():0<c?(metaBook.clearStateDialog(),metaBook.showCover()):Fa(!0)))}},touchstart:b,touchend:d,touchmove:sa,click:Na},hud:{tap:Va},toc:{tap:D,hold:J,slip:y,release:G,touchtoo:function(b){b=b||window.event;a(!1);H.previewing&&(W.gestures&&L("toc_touchtoo %o noabout",b),H.stopPreview("toc_touchtoo",!0),R(b))},touchmove:T},body:{touchstart:Ra},glossmark:{touchstart:I,touchend:R},"#METABOOKSTARTPAGE":{touchend:metaBook.UI.dropHUD},
"#METABOOKMENU":{tap:bb},"#METABOOKSHOWCOVER":{tap:fa,release:ua},"#METABOOKSEARCHINFO":{click:metaBook.searchTags_onclick},"#METABOOKPAGEREFTEXT":{tap:r},"#METABOOKPAGENOTEXT":{tap:N},"#METABOOKLOCPCT":{tap:X},"#METABOOKLOCOFF":{tap:da},"#METABOOKSKIMMER":{tap:V,swipe:B},"#METABOOKPAGEHEAD":{touchstart:S},"#METABOOKTABS":{touchstart:S},"#METABOOKHEAD":{touchend:S},"#METABOOKFOOT":{tap:oa,touchstart:sa,touchmove:sa},"#METABOOKGLOSSDETAIL":{touchend:metaBook.UI.dropHUD,click:R},".searchcloud":{tap:metaBook.UI.handlers.searchcloud_select,
release:metaBook.UI.handlers.searchcloud_select},"#MBPAGERIGHT":{touchstart:function(a){za(document.body,"mbSKIMMING")?C(a):K(a);R(a)}},"#MBPAGELEFT":{touchstart:function(a){za(document.body,"mbSKIMMING")?U(a):P(a);R(a)}},"#METABOOKHELP":{tap:Ka,swipe:R},"#METABOOKHELPBUTTON":{tap:Ka,hold:function(a){Ca(!0);R(a)},release:function(a){Ca(!1);R(a)},slip:function(a){Ca(!1);R(a)}},"#METABOOKNOTETEXT":{touchend:k,click:R},"#METABOOKSHOWTEXT":{touchstart:ga,touchmove:R,touchend:R},".hudmodebutton":{tap:M,
hold:M,release:M,slip:M},".hudbutton[alt='save gloss']":{tap:Ia,hold:Ia},".metabookclosehud":{click:ga,touchmove:R,touchend:R},"#METABOOKSETTINGS":{touchend:fdjt.UI.CheckSpan.onclick},".metabooktogglehelp":{touchstart:R,touchend:Ka},"#METABOOKCONSOLETEXTINPUT":{touchstart:function(){Ba("METABOOKCONSOLETEXTINPUT").focus()},focus:function(){fdjt.DOM.addClass("METABOOKCONSOLEINPUT","ontop")},blur:function(){fdjt.DOM.dropClass("METABOOKCONSOLEINPUT","ontop")}},"#METABOOKCONSOLEBUTTON":{touchstart:R,touchend:nb},
"#METABOOKREFRESHOFFLINE":{touchstart:ab,touchend:R},"#METABOOKREFRESHLAYOUT":{touchstart:hb,touchend:R},"#METABOOKRESETSYNC":{touchend:R,touchstart:Za},".clearoffline":{touchstart:R,touchend:$a},".metabookclearmode":{touchstart:R,touchend:ca},"#METABOOKGOTOREFHELP":{touchstart:R,touchend:ca},"#METABOOKGOTOPAGEHELP":{touchstart:R,touchend:ca},"#METABOOKGOTOLOCHELP":{touchstart:R,touchend:ca},".metabookshowsearch":{touchstart:R,touchend:function(a){metaBook.showSearchResults();R(a)}},".metabookrefinesearch":{touchstart:R,
touchend:function(a){ja("refinesearch");R(a)}},".metabookexpandsearch":{touchstart:R,touchend:function(a){ja("expandsearch");R(a)}},".metabookclearsearch":{touchstart:R,touchend:function(a){a=a||window.event;metaBook.UI.handlers.clearSearch(a);R(a);return!1}},summary:{touchmove:T},"#METABOOKINFOPANEL":{touchstart:La},".metabooksettings input[type='RADIO']":{change:H.configChange},".metabooksettings input[type='CHECKBOX']":{change:H.configChange}});var sb={window:{}};sb.window[Z.vischange]=function(a){document[Z.isHidden]&&
metaBook.previewing&&H.stopPreview()};fdjt.DOM.defListeners(metaBook.UI.handlers.touch,sb);fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,sb)})();(function(){function a(a,b){var c=p("METABOOKPAGEBAR"),e=c.offsetWidth,h=d.pagecount,m=b.clientX||b.touches&&b.touches.length&&b.touches[0].clientX,n=c.offsetLeft,t=m-n,q=t/e*h;(1<f.gestures||g(c,"metabooktrace"))&&k("pagebar_GoPage %o: %o-%o=%o/%o=%o => %o/%o",b,m,n,t,e,t/e,q,h);return Math.round(q+1)}function n(b,c){b=b||window.event;c||(c=x.T(b));if("mousemove"!==b.type||b.buttons){var e=p("METABOOKPAGEBAR");w(!1);if(!d.hudup&&!d.mode||d.fullheight){3===c.nodeType&&(c=c.parentNode);var h=a(c,b);
(f.gestures||g(e,"metabooktrace"))&&k("pagebar_hold %o t=%o gopage: %o=>%o/%o, start=%o",b,c,D,h,d.pagecount,J);J||(J=h);D!==h&&h&&(e.title=D?u("Release to go to this page (%d), move away to return to page %d",h,d.curpage):u(d.touch?"Release to return to page %d, tap the content or margin to settle here (page %d)":"Release to return to page %d, tap a key to settle here (page %d)",metaBook.curpage,h),D=h,metaBook.startPreview("CODEXPAGE"+D,"pagebar_hold/timeout"))}else x.cancel(b),metaBook.setMode(!1)}}
function h(b,c){b=b||window.event;c||(c=x.T(b));var e=p("METABOOKPAGEBAR");(f.gestures||g(e,"metabooktrace"))&&k("pagebar_tap %o",b);w(!1);d.previewing&&!D?metaBook.stopPreview("pagebar_tap",!0):d.hudup||d.mode||d.cxthelp?(f.gestures&&k("clearHUD %s %s %s",d.mode,d.hudup?"hudup":"",d.cxthelp?"hudup":""),x.cancel(b),metaBook.setMode(!1)):(3===c.nodeType&&(c=c.parentNode),e=a(c,b),D!==e&&(metaBook.GoToPage(e,"pagebar_tap",!0),metaBook.setMode(!1)))}function m(a,b){a=a||window.event;b||(b=x.T(a));var e=
p("METABOOKPAGEBAR");(f.gestures||g(e,"metabooktrace"))&&k("pagebar_release %o, previewing=%o, ptarget=%o start=%o",a,d.previewing,d.previewTarget,J);w(!1);3===b.nodeType&&(b=b.parentNode);d.previewing?(q(b,"preview"),metaBook.stopPreview("pagebar_release",!0),D=J=!1,x.cancel(a),c(b,e)):J=!1}function e(a,e){a=a||window.event;e||(e=x.T(a));var h=a.relatedTarget,m=p("METABOOKPAGEBAR");w(!1);(f.gestures||g(m,"metabooktrace"))&&k("pagebar_slip %o, pre=%o, target=%o start=%o, rel=%o",a,d.previewing,d.previewTarget,
J,h);d.previewing&&!b(h,A.pagebar)&&(h&&c(h,d.body)?w(function(){p("METABOOKPAGEBAR").title="";metaBook.GoTo(h,a)}):w(function(){p("METABOOKPAGEBAR").title="";q(e,"preview");metaBook.stopPagePreview("pagebar_slip/timeout")}),D=!1)}var v=fdjt.DOM,k=fdjt.Log,x=fdjt.UI,p=fdjt.ID,u=fdjt.String,q=v.dropClass,g=v.hasClass,c=v.hasParent,b=v.getParent,d=metaBook,A=metaBook.DOM,w=d.previewTimeout,v=x.cancel,f=metaBook.Trace,D=!1,J=!1;fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{"#METABOOKPAGEBAR":{tap:h,
hold:n,mousemove:n,release:m,slip:e,click:v}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{"#METABOOKPAGEBAR":{tap:h,hold:n,touchmove:n,release:m,slip:e,touchtoo:function(a,b){a=a||window.event;b||x.T(a);if(d.previewing)return metaBook.stopPreview("touchtoo"),x.TapHold.clear(),metaBook.setHUD(!1),fdjt.UI.cancel(a),!1},click:v}})})();(function(){function a(a){d(document.body,"mbZOOM");metaBook.zoomed=!1;a&&fdjt.UI.cancel(a)}function n(a,b,c){var d=w("METABOOKZOOM"),e=w("METABOOKZOOMBOX"),g=d.scrollLeft/d.scrollWidth,h=d.scrollTop/d.scrollHeight;"number"===typeof b?(A.zoomX=b||0,A.zoomY=c||0):"number"===typeof A.zoomX&&(b=A.zoomX,c=A.zoomY);if(f.zoom||f.gestures)"number"===typeof b?u("setZoom(%o) @%o,%o %o",a,b,c,e):u("setZoom(%o) @%o,%o %o",a,g,h,e);a?(metaBook.zoomscale=a,e.style[fdjt.DOM.transform]="number"===typeof b?"transform("+
b+"px,"+c+"px) scale("+a+")":"scale("+a+")",f.zoom&&u("%s=%s %o",fdjt.DOM.transform,e.style[fdjt.DOM.transform],e)):(A.zoomX=A.zoomY=!1,A.zoomscale=1,e.style[fdjt.DOM.transform]="",a=.9*d.clientWidth/d.scrollWidth,c=.9*d.clientHeight/d.scrollHeight,a<c?n(a):n(c));"number"!==typeof b&&(A.zoomX=A.zoomY=!1,d.scrollLeft=g*d.scrollWidth,d.scrollTop=h*d.scrollHeight)}function h(a){a?n((metaBook.zoomscale||1)*a):n(!1)}function m(a){a=a||window.event;h(1.1);fdjt.UI.cancel(a)}function e(a){a=a||window.event;
h(1/1.1);fdjt.UI.cancel(a)}function v(a){a=a||window.event;h(!1);fdjt.UI.cancel(a)}function k(a){a=a||window.event;var b=w("METABOOKMEDIATARGET");I?(clearTimeout(I),I=!1,d(document.body,"mbMEDIA")):a.shiftKey?(clearTimeout(I),I=!1,d(document.body,"mbMEDIA")):b&&b.pause&&!b.paused?I=setTimeout(function(){b.pause();I=!1;d(document.body,"mbMEDIA")},1500):d(document.body,"mbMEDIA");fdjt.UI.cancel(a)}function x(a){a=a||window.event;a=g(a);var b=w("METABOOKMEDIATARGET");a===b&&p.isImage(a)&&(d(document.body,
"mbMEDIA"),A.startZoom(b))}var p=fdjt.DOM,u=fdjt.Log,q=p.cancel,g=p.T,c=p.hasParent,b=p.addClass,d=p.dropClass,A=metaBook,w=fdjt.ID,f=A.Trace;metaBook.startZoom=function(c){var d=w("METABOOKZOOMTARGET"),e;(f.zoom||f.mode)&&u("startZoom %o",c);if(!c)return a();metaBook.zoomtarget===c&&(metaBook.zoomed=c,b(document.body,"mbZOOM"));metaBook.zoomtarget=c;if(metaBook.layout){var g=metaBook.layout,h=c.getAttribute("data-baseid")||c.id;g.lostids&&g.lostids[h]?e=g.lostids[h].cloneNode(!0):g.splits[h]&&(e=
g.splits[h].cloneNode(!0))}e||(e=c.cloneNode(!0));p.stripIDs(e,!1,"data-baseid");e.setAttribute("style","");e.id="METABOOKZOOMTARGET";fdjt.DOM.replace(d,e);b(document.body,"mbZOOM");e=w("METABOOKZOOM");c=w("METABOOKZOOM");d=.9*e.clientWidth/e.scrollWidth;e=.9*e.clientHeight/e.scrollHeight;A.zoomscale=1;c.style[fdjt.DOM.transform]="";d<e?n(d):n(e)};metaBook.stopZoom=a;metaBook.zoom=h;var D,J,G,y,E,F,O,M;fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{"#METABOOKZOOMCLOSE":{click:a},"#METABOOKZOOMHELP":{click:metaBook.toggleHelp},
"#METABOOKZOOMIN":{click:m},"#METABOOKZOOMOUT":{click:e},"#METABOOKUNZOOM":{click:v}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{"#METABOOKZOOM":{touchstart:function(a){if(a&&a.touches&&1<=a.touches.length){var b=w("METABOOKZOOMCONTROLS"),d=g(a);if(!c(d,b)){var e=a.touches,d=e[0],b=d.clientX,d=d.clientY;if(2===a.touches.length){var h=e[1],e=h.clientX,h=h.clientY,k=e-b,m=h-d,k=Math.sqrt(k*k+m*m);G=(b+e)/2;y=(d+h)/2;(f.zoom||f.gestures)&&u("zoom_touchstart(2) %o: d=%o@[%o,%o] [%o,%o]-[%o,%o]",
a,k,G,y,b,d,e,h);J=D=k;E=F=O=M=!1;q(a)}else 1===a.touches.length&&(E=b,F=d,(f.zoom||f.gestures)&&u("zoom_touchstart(1) %o: [%o,%o]",a,b,d),q(a))}}},touchmove:function(a){if(a&&a.touches&&1<=a.touches.length){var b=w("METABOOKZOOMBOX"),c=b.style,d=A.zoomscale||1,e=p.transform,g=a.touches,h=g[0],k=h.clientX,h=h.clientY,m=A.zoomX||0,n=A.zoomY||0;if(2===a.touches.length&&"number"===typeof J){var v=g[1],g=v.clientX,v=v.clientY,x=(k+g)/2,I=(h+v)/2,oa=g-k,ga=v-h,oa=Math.sqrt(oa*oa+ga*ga),ga=oa/D*d,m=m+(x*
d-x*ga),n=n+(I*d-I*ga);(f.zoom||1<f.gestures)&&u("zoom_touchmove(2) %o: d=%o->%o@[%o,%o] [%o,%o] [%o,%o]",a,J,oa,x,I,k,h,g,v);c[e]="translate3d("+m+"px,"+n+"px) scale("+ga+",0)";f.zoom&&u("%s %o: %s",e,b,c[e]);G=x;y=I;J=oa;q(a)}else 1===a.touches.length&&"number"===typeof E&&(O=k-E,M=h-F,m+=O,n+=M,(f.zoom||1<f.gestures)&&u("zoom_touchmove(1) %o: [%o,%o]=[%o,%o]+([%o,%o]=[%o,%o]-[%o,%o])",a,m,n,A.zoomX,A.zoomY,O,M,k,h,E,F),c[e]="translate3d("+m+"px,"+n+"px) scale("+d+",0)",f.zoom&&u("%s %o: %s",e,
b,c[e]),q(a))}},touchend:function(a){var b=A.zoomscale||1,c=A.zoomX||0,d=A.zoomY||0;if(J&&D){var e=J/D,c=c+(G*b-G*e*b),d=d+(y*b-y*e*b);(f.zoom||f.gestures)&&u("zoom_touchend(2) %o: %o=%o/%o@[%o,%o] zx=%o zy=%o",a,e,J,D,G,y,c,d);n(e*b,c,d);J=D=!1}else"number"===typeof E&&(b=A.zoomX||0,c=A.zoomY||0,(f.zoom||f.gestures)&&u("zoom_touchend(2) %o: [%o,%o]=[%o,%o] start [%o,%o]",a,b+O,c+M,O,M,E,F),A.zoomX=b+O,A.zoomY=c+M,O=M=E=F=!1)}},"#METABOOKZOOMCLOSE":{click:metaBook.stopZoom},"#METABOOKZOOMHELP":{click:metaBook.toggleHelp},
"#METABOOKZOOMIN":{touchend:m},"#METABOOKZOOMOUT":{touchend:e},"#METABOOKUNZOOM":{touchend:v}});metaBook.showMedia=function(a,c){function e(){g?f.parentNode&&fdjt.DOM.replace(f,g):w("METABOOKMEDIA").appendChild(f);b(document.body,"mbMEDIA")}var f=w("METABOOKMEDIATARGET"),g=!1,h=!1;metaBook.showing===a?b(document.body,"mbMEDIA"):(0===c.search("image")?h=g=p("IMG"):0===c.search("audio")?(h=p("SOURCE"),g=p("AUDIO",h),g.setAttribute("CONTROLS","CONTROLS"),g.setAttribute("AUTOPLAY","AUTOPLAY"),h.type=
c):0===c.search("video")?(h=p("SOURCE"),h.type=c,g=p("VIDEO",h),g.setAttribute("CONTROLS","CONTROLS"),g.setAttribute("AUTOPLAY","AUTOPLAY")):0===a.search("https://www.youtube.com/embed/")?(a="https://www.youtube-nocookie.com/"+a.slice(24),a=0<a.indexOf("?")?a+"&rel=0":a+"?rel=0"):h=g=p("IFRAME"),g.id="METABOOKMEDIATARGET",metaBook.showing=a,h&&A.glossdata[a]?(h.src=A.glossdata[a],e()):h?(b(w("METABOOKMEDIA"),"loadingcontent"),b(h,"loadingcontent"),metaBook.getGlossData(a).then(function(a){d(w("METABOOKMEDIA"),
"loadingcontent");d(h,"loadingcontent");h.src=a;e()}).catch(function(b){fdjt.Log("Couldn't fetch glossdata from %s: %o",a,b);metaBook.showing=a;d(w("METABOOKMEDIA"),"loadingcontent");d(h,"loadingcontent")})):e())};metaBook.hideMedia=function(){d(document.body,"mbMEDIA")};var I=!1;fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{"#METABOOKCLOSEMEDIA":{mousedown:k},"#METABOOKMEDIA":{click:x}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{"#METABOOKCLOSEMEDIA":{touchend:k},"#METABOOKMEDIA":{touchend:x}})})();metaBook.Paginate=function(){function a(a,b){var c=F("METABOOKLAYOUTMESSAGE");fdjt.UI.ProgressBar.setMessage(c,a);"number"===typeof b&&fdjt.UI.ProgressBar.setProgress(c,b)}function n(b){var c=b.tracelevel,d=b.started,e=b.pagenum;if(e){var g=G(),d=r((g-d)/1E3),g=F("METABOOKLAYOUTINDICATOR");if(b.done)g&&(g.style.width="100%"),E.replace("METABOOKPAGENOTEXT",E("div.metabookpageno#METABOOKPAGENOTEXT",metaBook.curpage||"?","/",e)),a(f("Finished laying out %d %dx%d pages in %s",e,b.width,b.height,r((b.done-
b.started)/1E3)),100),y("Finished laying out %d %dx%d pages in %s",e,b.width,b.height,r((b.done-b.started)/1E3));else if(b.lastid&&metaBook.docinfo&&metaBook.docinfo[b.lastid]){var h=metaBook.docinfo,h=100*h[b.lastid].starts_at/h._maxloc,k=Math.floor(h);g&&(g.style.width=k+"%");E.replace("METABOOKPAGENOTEXT",E("div.metabookpageno#METABOOKPAGENOTEXT",metaBook.curpage||"?","/",e," (",k,"%)"));metaBook.devmode?a(f("Formatted %d %dx%d pages (%d%%)",e,b.width,b.height,k),h):a(f("Formatting for your device (%d%%)",
k),h);c&&y("Formatted %d %dx%d pages (%d%%) in %s",e,b.width,b.height,k,d)}else a(f("Formatted %d %dx%d pages in %s",b.pagenum,b.width,b.height,d)),c&&y("Formatted %d pages in %s",b.pagenum,d)}}function h(b,c){function e(a){var b=a.started;F("CODEXPAGE").style.visibility="";F("CODEXCONTENT").style.visibility="";C(document.body,"mbLAYOUT");metaBook.layout=a;metaBook.pagecount=a.pages.length;y("Restored %d-page layout %s in %ds, adding glosses",a.pages.length,H,(G()-b)/1E3);a=a.lostids._all_ids;for(var b=
0,c=a.length;b<c;){var d=metaBook.UI.addGlossmark,f=a[b++];if((f=metaBook.glossdb.find("frag",f))&&f.length)for(var g=0,h=f.length;g<h;){var l=metaBook.glossdb.probe(f[g++]);if(l){var k=metaBook.getDups(l.frag);P(k,"glossed");for(var m=0,n=k.length;m<n;)d(k[m++],l)}}}w.startup&&y("Finished adding glossmarks to saved layout");q();metaBook.layoutdone&&(a=metaBook.layoutdone,metaBook.layoutdone=!1,a());metaBook.state&&metaBook.restoreState(metaBook.state,"layoutRestored");return metaBook.layout.running=
!1}function g(a,b){var c="mB("+b+").layouts",d=da(c,!0);if(d){var e=d.indexOf(a);0<=e&&d.splice(e,1);d.push(a);if(3<d.length){for(e=d.length-3-1;0<=e;)y("Dropping layout #%d %s",e,d[e]),M.dropLayout(d[e--]);d=d.slice(d.length-3)}X(c,d,!0)}else X(c,[a],!0)}function h(a,b){var c=b.pages,d=oa(a.getAttribute("data-pagenum"),10),e=A.docinfo,f=k(a),c=d&&1<d&&c[d-2];f&&a.setAttribute("data-lastid",f);!a.getAttribute("data-sbookloc")&&c&&((e=(f=c.getAttribute("data-lastid"))&&e[f])?a.setAttribute("data-sbookloc",
e.ends_at):(e=c.getAttribute("data-sbookloc"))?a.setAttribute("data-sbookloc",e):a.setAttribute("data-sbookloc","0"))}function k(a,b){!K(a,"codexpage")&&a.id&&!a.codexbaseid&&metaBook.docinfo[a.id]&&(b=a.id);if(1!==a.nodeType)return b;var c=a.childNodes;if(c)for(var d=0,e=c.length;d<e;){var f=c[d++];1===f.nodeType&&(b=k(f,b))}return b}function m(){function c(){if(p>=r){O.Finish();n(O);for(var a=O.pages,b=0,e=a.length;b<e;)h(a[b++],O);if(a=metaBook.cache_layout_thresh)b=O.done-O.started,("number"===
typeof a?b>a:5E3<b)&&O.saveLayout(function(a){g(a.layout_id,metaBook.sourceid)});F("CODEXPAGE").style.visibility="";F("CODEXCONTENT").style.visibility="";C(document.body,"mbLAYOUT");metaBook.layout=O;metaBook.pagecount=O.pages.length;q();metaBook.layoutdone&&(a=metaBook.layoutdone,metaBook.layoutdone=!1,a());metaBook.state&&metaBook.restoreState(metaBook.state,"layoutDone");metaBook.layout.running=!1;T&&setTimeout(d,100);return!1}a=k[p++];return 3===a.nodeType&&!N(a.nodeValue)||1===a.nodeType&&"LINK"!==
a.tagName&&"META"!==a.tagName&&"SCRIPT"!==a.tagName&&"BASE"!==a.tagName?(O.addContent(a,S,V,O.tracelevel,n,T&&c),T?c:!0):T?c():!0}C(document.body,"_SCROLL");P(document.body,"_BYPAGE");var e=metaBook.content.style.width;metaBook.content.style.width=I(metaBook.page).width+"px";var l=metaBook.content,k=U(l.childNodes);y("Laying out %d root nodes into %dx%d pages (%s), id=%s, async=%s",k.length,O.width,O.height,b||"",H,S?f("%d(%d)",S,V):"no");a("Starting new layout",0);fdjt.DOM.adjustFonts(l);metaBook.content.style.width=
e;var p=0,r=k.length;if(T)c();else for(e=!0;e;)e=c()}if(!metaBook.layout||metaBook.layout.done){b||(b="because");w.layout&&y("Starting pagination (%s) with %j",b,c);a("Preparing your book",0);C(document.body,"_SCROLL");P(document.body,"mbLAYOUT");x(!1);w.layout&&y("Unscaled layout");var p=c&&c.forced,r=I(F("CODEXPAGE"),!1,!0),t=r.inner_height,u=r.width,B=metaBook.textjustify,D=metaBook.bodyspacing,r=metaBook.bodysize||"normal",E=metaBook.dyslexical?"opendyslexic":metaBook.bodyfamily||"default";!metaBook.layout&&
w.startup&&y("Page layout requires %dx%d %s pages",u,t,r);if(metaBook.layout){var J=metaBook.layout;if(!(p||u!==J.width||t!==J.height||r!==J.bodysize||E!==J.bodyfamily||D&&D!==J.bodyspacing)&&(B&&J.justify||!B&&!J.justify)){C(document.body,"mbLAYOUT");y("Skipping redundant pagination for %s",J.layout_id);return}w.layout&&y("Reverting current layout");metaBook.layout.Revert();metaBook.layout=!1}w.layout&&y("Sizing the content");metaBook.sizeContent();t=v();c&&c.hasOwnProperty("timeslice")&&(t.timeslice=
c.timeslice);w.layout&&y("Starting content layout");var O=new M(t);O.bodysize=r;O.bodyfamily=E;metaBook.layout=O;var S=O.hasOwnProperty("timeslice")?O.timeslice:M.timeslice,V="number"===typeof S&&(O.hasOwnProperty("timeskip")?O.timeskip:M.timeskip),T="number"===typeof S,H=O.layout_id;if(!metaBook.cache_layout_thresh||metaBook.forcelayout||p)if(T)setTimeout(m,10);else return m();else w.layout&&y("Fetching layout %s",H),M.fetchLayout(H).then(function(b){if(!b)return m();w.layout&&y("Got layout %s",
H);g(H,metaBook.sourceid);try{y("Using saved layout %s",H),F("CODEXCONTENT").style.display="none",a("Using cached layout",0),C(document.body,"_SCROLL"),P(document.body,"_BYPAGE"),O.started=G(),O.restoreLayout(b).then(e)}catch(c){return y("Layout restore error: %o",c),m()}}).catch(function(){return m()})}}function m(a,b){!0===b?E.addClass(metaBook.body,"metabook"+a):b?E.swapClass(metaBook.body,new RegExp("metabook"+a+"\\w*"),"metabook"+a+b):E.dropClass(metaBook.body,new RegExp("metabook"+a+"\\w*"));
metaBook[a]=b;metaBook.postconfig&&metaBook.content?(0>metaBook.postconfig.indexOf(metaBook.sizeContent)&&(metaBook.sized=!1),metaBook.postconfig.push(metaBook.sizeContent)):metaBook.content&&metaBook.sizeContent();metaBook.layout&&(metaBook.postconfig?metaBook.postconfig.push(function(){metaBook.Paginate(a)}):metaBook.Paginate(a));fdjt.Async(function(){metaBook.updateSettings(a,b)})}function e(a,b,c,d,e,g,h){var k=F("CODEXPAGE"),m=k.style.left,n=k.style.right,p=metaBook.docref,q=metaBook.sourceid,
r=fdjt.CodexLayout.sourcehash;k.style.left="";k.style.right="";a||(a=I(k,!1,!0).width);b||(b=I(F("CODEXPAGE"),!1,!0).inner_height);d||(d=metaBook.bodysize||"normal");h||metaBook.sourceid||J.hex_md5(metaBook.docuri);g||(g=metaBook.textjustify);e||(e=metaBook.linespacing);k.style.left=m;k.style.right=n;return f("%s%dx%d-%s-%s%s%s%s%s",p?p+":":"",a,b,c,d,g?"-j":"",e?"-l"+e:"",q?"#"+q:"",r?"/"+r:"")}function v(){function a(b){var c=!1;K(b,"codexpage")||(b.id&&q[b.id]||b.codexbaseid&&q[b.codexbaseid])&&
B(b,!0)&&(c=b);if(b=b.childNodes)for(var d=0,e=b.length;d<e;){var f=b[d++];if(1===f.nodeType&&(f=a(f)))return f}return c}function b(a,c){var d;if(1!==a.nodeType)return!1;if(a.codexbaseid===c)return a;if(d=a.childNodes)if(d.length)for(var e=0,f=d.length;e<f;){var g=b(d[e++],c);if(g)return g}else return!1;else return!1}function c(a,d,e){for(var f=d.id,g=0,h=d,k=d;h&&!K(h,"codexpage");)h=h.parentNode;if(h)d=parseInt(h.getAttribute("data-pagenum"),10);else return g;for(;k&&k!==e;)if((h=V(k))&&(g+=h),
h=a[d++])k=b(h,f);else break;return g}var d=I(F("CODEXPAGE"),!1,!0).width,e=I(F("CODEXPAGE"),!1,!0).inner_height,g=E("div#CODEXCONTENT"),h=E("div.metabookpages#METABOOKPAGES"),k=metaBook.docref,m=metaBook.sourceid,n=metaBook.linespacing,p=fdjt.CodexLayout.sourcehash,k=f("%s%dx%d-%s-%s%s%s%s%s",k?k+":":"",d,e,metaBook.dyslexical?"opendyslexic":metaBook.bodyfamily||"default",metaBook.bodysize||"normal",metaBook.textjustify?"-j":"",n?"-l"+n:"",m?"#"+m:"",p?"/"+p:""),q=metaBook.docinfo,r=!1,t=E.getChild,
u=f.stripMarkup,v=D.getLocal("mB("+A.docid+").sourceid");if(v&&m&&m!==m){n=D.getLocal("fdjtmetaBook.layouts",!0);p=[];if(n)for(var v=new RegExp("\\("+v+"\\)$"),x=0,C=n.length;x<C;){var G=n[x++];0<G.search(v)?M.dropLayout(G):p.push(G)}p.length?D.setLocal("fdjtmetaBook.layouts",p):D.dropLocal("fdjtmetaBook.layouts",p)}m&&D.setLocal("mB("+A.docid+").sourceid",m);d={page_height:e,page_width:d,orientation:E.getOrientation(window),container:h,origin:g,pagerule:metaBook.CSS.pagerule,tracelevel:w.layout,
layout_id:k,pagefn:function(b,d){var e=d.pages,f=d.pagenum,g=a(b),h=g.codexbaseid||g.id,l=f&&1<f&&e[f-2],k=t(b,".staticpageref"),m=!1;k?((l=k.getAttribute("data-pageref"))||(l=u(k.innerHTML)),l&&(d.pagemap||(d.pagemap={}),b.setAttribute("data-staticpageref",l),d.pagemap[l]||(d.laststaticref=l),d.pagemap[l]=b)):l&&(k=l.getAttribute("data-staticpageref"))&&b.setAttribute("data-staticpageref",k);g&&(m=O(h),e=m===g?0:c(e,m,g),m=q[h].starts_at+e,h&&b.setAttribute("data-topid",h),b.setAttribute("data-sbookloc",
m));"number"===typeof m&&f&&!metaBook.curpage&&metaBook.state&&r!==metaBook.state&&metaBook.state.hasOwnProperty("location")&&m>=metaBook.state.location&&(r=metaBook.state,setTimeout(function(){metaBook.GoToPage(f,"layout",!1)},10))},logfn:y};E.replace("METABOOKPAGES",h);metaBook.pages=h;(h=S("alwaysbreakbefore",!0,!0).concat(S("forcebreakbefore",!0,!0)))&&h.length&&(d.forcebreakbefore=E.sel(h));(h=S("alwaysbreakafter",!0,!0).concat(S("forcebreakafter",!0,!0)))&&h.length&&(d.forcebreakafter=E.sel(h));
(h=S("avoidbreakbefore",!0,!0).concat(S("dontbreakbefore",!0,!0)))&&h.length&&(d.avoidbreakbefore=E.sel(h));(h=S("avoidbreakafter",!0,!0).concat(S("dontbreakafter",!0,!0)))&&h.length&&(d.avoidbreakafter=E.sel(h));(h=S("avoidbreakinside",!0,!0).concat(S("dontbreakinside",!0,!0)))&&h.length&&(d.avoidbreakinside=h);h=[".sbookfullpage",".sbooktitlepage",".sbookpage"].concat(S("codexfullpage",!0));d.fullpages=E.sel(h);(h=[".codexfloatpage"].concat(S("codexfloatpage",!0)))&&h.length&&(d.floatpages=E.sel(h));
(h=[".codexfloating",".codexfloat"].concat(S("codexfloat",!0)).concat(S("codexfloating",!0)))&&h.length&&(d.floating=E.sel(h));S("metaBook.dontbreakblocks")||S("metaBook.keepblocks")||S("~=metaBook.dontbreakblocks")||S("~=metaBook.keepblocks")||S("~dontbreakblocks")||S("~keepblocks")?d.break_blocks=!1:d.break_blocks=!0;S("metaBook.dontscalepages")||S("~=metaBook.dontscalepages")||S("dontscalepages")?d.scale_pages=!1:d.scale_pages=!0;d.dontsave=fdjt.DOM.Selector(".glossmark");return d}function k(){var a=
metaBook.page,b=I(a),c=b.height,d=E.viewHeight(),b=b.width,b=E.viewWidth()-b;50!==b?(a.style.left=b/2+"px",a.style.right=b/2+"px"):a.style.left=a.style.right="";metaBook.fullheight=80>d-c?!0:!1;metaBook.fullwidth=80>b?!0:!1;metaBook.fullwidth?P(document.body,"_FULLWIDTH"):C(document.body,"_FULLWIDTH");metaBook.fullheight?P(document.body,"_FULLHEIGHT"):C(document.body,"_FULLHEIGHT")}function x(a){var b=metaBook.CSS.resizerule;"undefined"===typeof a&&(a=!0);if(!a||!K(document.body,"_SCALEDLAYOUT"))if(a||
K(document.body,"_SCALEDLAYOUT"))if(b&&(b.style[E.transform]="",b.style[E.transformOrigin]="",b.style.left="",b.style.top=""),a){k();var c=metaBook.layout,d=I(F("CODEXPAGE"),!1,!0);a=d.width;var d=d.inner_height,e=c.width,c=c.height,f=d/c,g=a/e,f=f<g?f:g;b||(metaBook.CSS.resizerule=b=E.addCSSRule("#CODEXPAGE div.codexpage, body._ANIMATE.mbPREVIEW #CODEXPAGE div.codexpage",""));b.style[E.transformOrigin]="left top";b.style[E.transform]="scale("+f+","+f+") translateZ(0)";e*=f;e<a&&(b.style.left=(a-
e)/2+"px");c*f<d&&(b.style.top="0px");b=metaBook.pagecount;b=F("METABOOKPAGEBAR").offsetWidth/b;1>b&&(b=1);metaBook.CSS.pagespanrule?metaBook.CSS.pagespanrule.style.width=b+"px":metaBook.CSS.pagespanrule=E.addCSSRule("div.metabookpagespans > span","width: "+b+"px;");P(document.body,"_SCALEDLAYOUT")}else C(document.body,"_SCALEDLAYOUT"),k()}function p(a,b,c,d){var e=!d;d||(d="METABOOKCURPAGESPAN");var g=metaBook.pagecount,h=metaBook.layout.laststaticref,k=F(d);if("number"===typeof c){var m=metaBook.ends_at;
d=100*c/m;var n=Math.round(Math.log(m/40)/Math.log(10))-2;0>n&&(n=0);d=E("span.metabookloc#METABOOKLOCPCT",(0===n?Math.floor(d):f.precString(d,n))+"%");d.title=c+"/"+m}else d=E("span.metabookloc#METABOOKLOCPCT");k&&(k.innerHTML=a,k.style.left=100*(a-1)/g+"%");c=E("span#METABOOKPAGENOTEXT.metabookpageno",a,"/",g);c.title="select to change page number";E.replace("METABOOKPAGENOTEXT",c);if(b=b&&h&&E("span#METABOOKPAGEREFTEXT.metabookpageno",b+"("+h+")"))b.title="Reference page number (from some print version)",
E.replace("METABOOKPAGEREFTEXT",b);E.replace("METABOOKLOCPCT",d);d.title=(d.title||"")+(d.title?"; ":"")+" select to change %";e&&(h=F("METABOOKPAGEPROGRESS"))&&(h.style.width=100*(a-1)/g+"%");if(e&&(a=(a=(a=F("CODEXPAGE"+a))&&a.getAttribute("data-topid"))&&metaBook.docinfo[a])){k=(e=(a=a.level?a:a.head)&&a.head)&&e.head;a=u(a);e=u(e);for(h=u(k);h&&e&&1>=a.width;){m=k.head&&u(k.head);if(!m)break;k=k.head;a=e;e=h;h=m}k=F("METABOOKSECTMARKER1");m=F("METABOOKSECTMARKER2");n=F("METABOOKSECTMARKER3");
a&&a.width?(k.style.left=(a.start-1)/g*100+"%",k.style.width=a.width/g*100+"%",k.style.display="block"):k.style.display="none";e&&e.width?(m.style.left=(e.start-1)/g*100+"%",m.style.width=e.width/g*100+"%",m.style.display="block"):m.style.display="none";h&&h.width?(n.style.left=(h.start-1)/g*100+"%",n.style.width=h.width/g*100+"%",n.style.display="block"):n.style.display="none"}g=metaBook.UI.handlers[metaBook.ui];E.addListeners(d,g["#METABOOKLOCPCT"]);E.addListeners(c,g["#METABOOKPAGENOTEXT"]);b&&
E.addListeners(b,g["#METABOOKPAGEREFTEXT"])}function u(a){for(var b=a,d,e={};b;)if(b.next){d=b.next;break}else b=b.head;if(a=c(a.frag,a.starts_at))e.start=parseInt(a.getAttribute("data-pagenum"),10);else return!1;d&&(d=c(d.frag,d.starts_at))&&(e.end=parseInt(d.getAttribute("data-pagenum"),10));e.end||(e.end=metaBook.layout.pages.length+1);e.width=e.end-e.start;return e}function q(){var a=metaBook.layout,b=a.pages,c=0,d=b.length,e=F("METABOOKGOTOPAGEMAX");e&&(e.innerHTML=""+d);e=F("METABOOKPAGEBAR").offsetWidth/
d;1>e&&(e=1);for(metaBook.CSS.pagespanrule?metaBook.CSS.pagespanrule.style.width=e+"px":metaBook.CSS.pagespanrule=E.addCSSRule("div.metabookpagespan","width: "+e+"px;");c<d;){var e=b[c],f=e.getAttribute("data-staticpageref");if(f){var g=a.pagemap,h=F("METABOOKGOTOPAGEREFMAX");h&&(h.innerHTML=""+f);g||(a.pagemap=g={});a.laststaticref=f;g[f]=e}c++}a.laststaticref?P(document.body,"mbPAGEREFS"):C(document.body,"mbPAGEREFS")}function g(a){if(a){if("string"===typeof a){if(metaBook.layout&&metaBook.layout.dups){var b=
metaBook.layout.dups[a];return b?[O(a)].concat(b):[O(a)]}return[O(a)]}return g(a.codexbaseid||a.id)}return!1}function c(a,b){var c=a&&(a.nodeType?a:"string"===typeof a?O(a):!1),c=c&&t(c,".codexpage");if(!b||!c)return c;var d=parseInt(c.getAttribute("data-sbookloc"),10);if(d===b)return c;var e=metaBook.layout.pages,f=e.length,g=c?parseInt(c.getAttribute("data-pagenum"),10):1;g--;for(var h=c;g<f;){var k=e[g++],d=parseInt(k.getAttribute("data-sbookloc"),10);if("number"!==typeof d)return h;if(d===b)return k;
if(d>b)return h;h=k}return c}function b(a,b,c){var d={forced:!0};b&&(d.timeslice=b);c&&(d.timeskip=c);metaBook.Paginate(a||"refreshLayout",d)}function d(){if(!metaBook.layout.running){var a=I(F("CODEXPAGE"),!1,!0),c=a.width;metaBook.layout.height===a.inner_height&&metaBook.layout.width===c||b("checkLayout")}}var A=metaBook,w=A.Trace,f=fdjt.String,D=fdjt.State,J=fdjt.Hash,G=fdjt.Time,y=fdjt.Log,E=fdjt.DOM,F=fdjt.ID,O=metaBook.ID,M=fdjt.CodexLayout,I=E.getGeometry,t=E.getParent,T=E.getChildren,K=E.hasClass,
P=E.addClass,C=E.dropClass,U=E.toArray,V=E.textWidth,B=E.hasContent,N=f.isEmpty,r=G.secs2short,da=D.getLocal,X=D.setLocal,S=E.getMeta,oa=parseInt;metaBook.Paginate=h;M.prototype.onresize=function(){metaBook.bypage?metaBook.Paginate("resize"):fdjt.DOM.adjustFonts(metaBook.content)};metaBook.addConfig("layout",function(a,b){metaBook.page_style=b;"bypage"===b?metaBook.docinfo?metaBook.bypage||(metaBook.bypage=!0,metaBook.postconfig?metaBook.postconfig.push(h):metaBook.Paginate("config")):metaBook.bypage=
!0:(metaBook.layout?(metaBook.layout.Revert(),metaBook.layout=!1):metaBook.layout&&!metaBook.layout.done&&(metaBook.layout.timer&&(clearTimeout(metaBook.layout.timer),metaBook.layout.timer=!1),metaBook.layout.Revert(),metaBook.layout=!1),metaBook.bypage=!1,metaBook.layout&&(metaBook.layout.Revert(),metaBook.layout=!1),C(document.body,"_BYPAGE"),P(document.body,"_SCROLL"),fdjt.DOM.adjustFonts(metaBook.content))});metaBook.addConfig("bodysize",m);metaBook.addConfig("bodyfamily",m);metaBook.addConfig("bodyspacing",
m);metaBook.addConfig("textjustify",m);metaBook.getLayoutID=e;metaBook.layoutCached=function(a){a?"number"===typeof a&&(a=e.apply(null,arguments)):a=e();var b=da("mB("+metaBook.sourceid+").layouts",!0);return b&&0<=b.indexOf(a)};metaBook.clearLayouts=function(a){"undefined"===typeof a&&(a=metaBook.sourceid);if(a){for(var b=da("mB("+a+").layouts",!0),c=0,d=b.length;c<d;){var e=b[c++];y("Dropping layout %s",e);M.dropLayout(e)}D.dropLocal("mB("+a+").layouts")}else M.clearLayouts(),M.clearAll(),D.dropLocal(/^mB.layouts\(/g)};
M.getLayoutArgs=v;metaBook.sizeCodexPage=k;metaBook.scaleLayout=x;metaBook.updatePageDisplay=p;metaBook.setupPagebar=q;metaBook.getDups=g;var ga=!1;metaBook.GoToPage=function(a,b,c,d){"undefined"===typeof c&&(c=!0);metaBook.previewing&&metaBook.stopPreview("GoToPage",!1);C(document.body,"mbSHOWHELP");metaBook.clearGlossmark();var e=metaBook.layout&&(metaBook.layout.getPage(a)||metaBook.layout.getPage(1));if(e&&e!==ga){var f=parseInt(e.getAttribute("data-pagenum"),10);"addgloss"===metaBook.mode&&metaBook.setMode(!1,
!1);c&&metaBook.clearStateDialog();w.flips&&y("GoToPage/%s Flipping to %o (%d) for %o",b,e,f,a);if(ga)if(A.dontanimate||!K(document.body,"_ANIMATE"))C(ga,"curpage"),P(e,"curpage");else{b=ga.getAttribute("data-pagenum");b=parseInt(b,10);C(ga,/\b(oldpage|newpage|onleft|onright)\b/g);C(e,/\b(oldpage|newpage|onleft|onright)\b/g);P(e,f<b?"onleft":"onright");P(ga,"oldpage");P(e,"newpage");var g=ga;setTimeout(function(){var a=metaBook.pages.getElementsByClassName("curpage");a.length&&C(U(a),"curpage");C(g,
"curpage");P(e,"curpage");C(e,"newpage");C(e,/\bon(right|left)\b/)},50);setTimeout(function(){C(g,"oldpage")},500)}else b=metaBook.pages.getElementsByClassName("curpage"),b.length&&C(U(b),"curpage"),P(e,"curpage");"number"===typeof a&&(a=(a=e.getAttribute("data-sbookloc"))&&parseInt(a,10))&&metaBook.setLocation(a);a=e.getAttribute("data-staticpageref");p(f,a,metaBook.location);ga=e;metaBook.curpage=f;(f=O(e.getAttribute("data-lastid"))||O(e.getAttribute("data-topid")))&&metaBook.setHead(f);c&&(metaBook.point=
f,metaBook.hudup||metaBook.mode||(metaBook.skimpoint=!1));c&&e&&(c=e.getAttribute("data-sbookloc"),a=e.getAttribute("data-pagenum"),metaBook.saveState({location:oa(c,10),page:oa(a,10),target:f&&(f.getAttribute("data-baseid")||f.id)},d));if(d=E.$(".glossed",e))for(c=metaBook.UI.addGlossmark,f=0,a=d.length;f<a;)c(d[f++])}};var ca=!1;metaBook.startPagePreview=function(a,b){var c=a.nodeType&&t(a,".codexpage")||metaBook.layout.getPage(a)||metaBook.layout.getPage(1);(w.preview||w.flips)&&y("startPagePreview for %o from %s",
c,a);if(c){var d=parseInt(c.getAttribute("data-pagenum"),10),e=parseInt(c.getAttribute("data-sbookloc"),10);ca!==c&&(ca&&C(ca,"previewpage"),C(T(metaBook.pages,".previewpage"),"previewpage"),(w.flips||w.gestures)&&y("startPagePreview/%s to %o (%d) for %o",b||"nocaller",c,d,a),ga&&P(ga,"hidepage"),P(c,"previewpage"),metaBook.previewing=ca=c,P(document.body,"mbPREVIEW"),c=c.getAttribute("data-staticpageref"),p(d,c,e,"METABOOKPRVPAGESPAN"))}};metaBook.stopPagePreview=function(a,b){var c=parseInt(ga.getAttribute("data-pagenum"),
10);(w.flips||w.gestures)&&y("stopPagePreview/%s from %o to %o (%d)",a||"nocaller",ca,ga,c);var d=!1;if(ca){b&&b.nodeType?(C(ga,"curpage"),C(ga,"hidepage"),P(ca,"curpage"),d=K(b,"codexpage")?b:t(b,".codexpage")):b?(C(ga,"curpage"),C(ga,"hidepage"),P(ca,"curpage"),d=ga):(C(ca,"preview"),C(ga,"hidepage"));C(ca,"previewpage");C(T(metaBook.pages,".previewpage"),"previewpage");metaBook.previewing=ca=!1;C(document.body,"mbPREVIEW");C(document.body,"mbPAGEPREVIEW");if(d){var c=parseInt(d.getAttribute("data-pagenum"),
10),e=metaBook.getLocInfo(b);p(c,d.getAttribute("data-staticpageref"),e&&e.starts_at)}else p(c,ga.getAttribute("data-staticpageref"),metaBook.location);"number"===typeof d&&metaBook.GoToPage(d)}};metaBook.getPage=c;metaBook.refreshLayout=b;metaBook.syncLayout=function(a){metaBook.Paginate(a,{forced:!0,timeslice:!1})};metaBook.displaySync=function(){metaBook.pagecount&&metaBook.curpage&&metaBook.GoToPage(metaBook.curpage,"displaySync",!1)};return h}();metaBook.HTML.searchbox='<div class=\'query\'>\n  <input id="METABOOKSEARCHINPUT"\n         type="TEXT" class="autoprompt searchinput"\n         name="QTEXT" value="" isempty="yes" autocomplete="off"\n         onfocus="metaBook.UI.handlers.search_focus(event);"\n         onblur="metaBook.UI.handlers.search_blur(event);"\n         onkeydown="metaBook.UI.handlers.search_keydown(event);"\n         onkeyup="metaBook.UI.handlers.search_keyup(event);"\n         onkeypress="metaBook.UI.handlers.search_keypress(event);"\n         completeopts="anywhere cloud" enterchars=";" maxcomplete="45"\n         placeholder="type or tap tags or terms"\n         completions="METABOOKSEARCHCLOUD"\n         results="METABOOKSEARCHRESULTS"\n         info="METABOOKSEARCHINFO"/>\n  <img class="metabookclearsearch" alt="X" title="clear search"\n       src="{{bmg}}metabook/redx.svgz"\n       onerror="this.src=\'{{bmg}}metabook/redx64x64.png"/\'>\n</div>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n\n';metaBook.HTML.addgloss='<form action="https://glosses.bookhub.io/glosses"\n      ajaxaction="https://glosses.bookhub.io/glosses"\n      method="POST" target="addgloss"\n      accept-charset="utf-8">\n  <div class="messageoverlay">\n    <div class="saving">Saving...</div>\n    <div class="saved">Saved</div>\n  </div>\n  <div class="hidden">\n    <input type="HIDDEN" name="FRAG"/>\n    <input type="HIDDEN" name="WSNID"/>\n    <input type="HIDDEN" name="REFURI"/>\n    <input type="HIDDEN" name="DOCURI"/>\n    <input type="HIDDEN" name="SYNC"/>\n    <input type="HIDDEN" name="UUID"/>\n    <input type="HIDDEN" name="TAGLINE"/>\n    <input type="HIDDEN" name="LOCATION"/>\n    <input type="HIDDEN" name="LOCLEN"/>\n    <input type="HIDDEN" name="DOCTITLE"/>\n    <input type="HIDDEN" name="MYCOPYID"/>\n    <input type="HIDDEN" name="MAKER"/>\n    <input type="HIDDEN" name="RE"/>\n    <input type="HIDDEN" name="THREAD"/>\n    <input TYPE="HIDDEN" NAME="DETAIL" VALUE=""/>\n    <input TYPE="HIDDEN" NAME="EXCERPT" VALUE=""/>\n    <input TYPE="HIDDEN" NAME="EXOFF" VALUE=""/>\n    \x3c!-- Force IE to send the form in UTF-8 --\x3e\n    <input type="HIDDEN" name="IEHACK" VALUE="&#9760;"/>\n  </div>\n  <div class="response">\n    Responding to <span class="respmaker"></span>\n    <span class="respdate"></span> <span class="respnote"></span> \n    <span class="resptags"></span> <span class="resplinks"></span>\n  </div>\n  <div class="metabookglossformbody">\n    <div class="addglossmenu" data-touchable="img">\n      <img src="{{bmg}}metabook/upmenu.svgz"\n           onerror="this.src=\'{{bmg}}metabook/upmenu64x64.png\'"\n           class="button menutop" alt="upmenu"/>\n      <img src="{{bmg}}metabook/downmenu.svgz"\n           onerror="this.src=\'{{bmg}}metabook/downmenu64x64.png\'"\n           class="button menutop" alt="downmenu"/>\n      <img src="{{bmg}}metabook/holdmenu.svgz"\n           onerror="this.src=\'{{bmg}}metabook/holdmenu64x64.png\'"\n           class="button menutop" alt="holdmenu"/>\n      <img src="{{bmg}}metabook/gloss_save_titled.svgz"\n           onerror="this.src=\'{{bmg}}metabook/gloss_save_titled64x64.png\'"\n           title="save this gloss" class="button" alt="glosspush"\n           tabindex="2"/>\n      <img src="{{bmg}}metabook/gloss_save_titled.svgz"\n           onerror="this.src=\'{{bmg}}metabook/gloss_save_titled64x64.png\'"\n           title="update this gloss" class="button" alt="glossupdate"\n           tabindex="2"/>\n      <img src="{{bmg}}metabook/gloss_tag_titled.svgz"\n           onerror="this.src=\'{{bmg}}metabook/gloss_tag_titled64x64.png\'"\n           title="add tags" class="button" alt="addtag"\n           tabindex="3"/>\n      <img src="{{bmg}}metabook/gloss_attach_titled.svgz"\n           onerror="this.src=\'{{bmg}}metabook/gloss_attach_titled64x64.png\'"\n           title="attach files" class="button" alt="attach"\n           tabindex="4"/>\n      <img src="{{bmg}}metabook/gloss_share_titled.svgz"\n           onerror="this.src=\'{{bmg}}metabook/gloss_share_titled64x64.png\'"\n           title="add outlets/share this gloss" class="button" alt="addoutlet"\n           tabindex="6"/>\n      <img src="{{bmg}}metabook/gloss_respond_toptitle.svgz"\n           onerror="this.src=\'{{bmg}}metabook/gloss_respond_toptitle64x64.png\'"\n           title="respond to this gloss" class="button" alt="glossrespond"\n           tabindex="7"/>\n      <img src="{{bmg}}metabook/gloss_delete_titled.svgz"\n           onerror="this.src=\'{{bmg}}metabook/gloss_delete_titled64x64.png\'"\n           title="delete gloss" class="button" alt="glossdelete"\n           tabindex="9"/>\n      <img src="{{bmg}}metabook/gloss_cancel_titled.svgz"\n           onerror="this.src=\'{{bmg}}metabook/gloss_cancel_titled64x64.png\'"\n           title=" cancel gloss" class="button" alt="glosscancel"\n           tabindex="8"/>\n    </div>\n    <div class="textbox">\n      <textarea\n         name="NOTE"\n         placeholder="Use #tag or @share or to add tags or shares.  Markdown to format, Enter to save, Escape to cancel."\n         title="Add text (using markdown), using @share and #tag to add outlets and tags."\n         class="markdowninput"\n         wrap="virtual"\n         tabindex="0"></textarea>\n    </div>\n    <div class="glossetc">\n      <span class="glossexposure">\n        <span class="checkspan private" tabindex="5">\n          <input type="CHECKBOX" name="PRIVATE" value="yes"\n                 onchange="metaBook.UI.changeGlossPrivacy(event);"/>\n          <span class="checked"\n                title="this gloss won\'t be shared with my associated networks">\n            Private</span>\n          <span class="unchecked"\n                title="this gloss will be shared with my associated networks">\n            Shared</span>\n        </span>\n      </span>\n      <span class="glossdate"></span>\n      <span class="tags empty"></span>    \n      <span class="links empty"></span>\n      <span class="outlets empty"></span>\n      <span class="excerpt"></span>\n    </div>\n  </div>\n</form>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.hud='<div id="METABOOKHEAD">\n  <div id="METABOOKTOC" class="hudpanel"></div>\n  <div id="METABOOKSEARCH" class="searchbox hudpanel notags">\n    \x3c!-- This content comes from searchbox.html --\x3e\n  </div>\n  <div id="METABOOKNOTETEXT" class="hudpanel"\n       title="tap/click to jump to the note">\n    \x3c!-- This displays the text for a "note" --\x3e\n  </div>\n  <div id="METABOOKGLOSS" class="hudpanel">\n    <div class="editbar">\n      <span class="deletebutton">Delete</span>\n      <span class="deletebutton">Edit</span>\n      <span class="deletebutton">Reply</span>\n    </div>\n    <div id="METABOOKTARGETGLOSS">\n      \x3c!-- This is generated on demand --\x3e\n    </div>\n  </div>\n  <div id="METABOOKSOURCES" class="hudpanel metabooksources">\n    <img src="{{bmg}}metabook/sbookspeople.svgz"\n         onerror="this.src=\'{{bmg}}metabook/sbookspeople50x50.png\'"\n         class="button everyone selected"\n         alt="show all" title="show all glosses"/>\n  </div>\n  <div id="METABOOKADDGLOSS" class="metabookaddgloss hudpanel">\n  </div>\n  <div class="metabookglossform" id="METABOOKADDGLOSSPROTOTYPE">\n    \x3c!-- This content comes from addgloss.html --\x3e\n  </div>\n</div>\n<div id="METABOOKSKIMMER">\n  <div id="METABOOKSKIM"></div>\n</div>\n<div id="METABOOKTOPHELPCONTENT">\n  <div id="METABOOKSLICEHELP" class="hudpanel">\n    Press to see the context, tap to start skimming\n  </div>\n  <div id="METABOOKSEETHRUHELP" class="metabookhelp helpbox">\n    <p><span class="action">Release</span> to\n      <span class="result">return</span>.\n      <span class="notouch action">Press any key</span>\n      <span class="fortouch action">Tap anywhere else</span>\n      to <span class="result">settle</span> here.</p>\n  </div>\n  <div id="METABOOKPAGEBARHELP" class="metabookhelp helpbox">\n    <p><span class="action">Release</span>\n      <span class="fortouch action">or tap the text</span>\n      to <span class="result">settle</span> here.\n      <span class="action notouch">Press any key</span>\n      <span class="notouch">or</span>\n      <span class="notouch action">move the pointer away</span>\n      <span class="action fortouch">Move your finger away</span>\n      to <span class="result">return</span> to where you were.</p>\n  </div>\n  <div id="METABOOKPREVIEWHELP" class="helpbox">\n    <p>You\'re <em>previewing</em> a reference. <strong>Let go</strong>\n      to <em>go back</em> to the\n      reference, <strong class="fortouch">tap anywhere\n        else</strong> <strong class="notouch">tap any key</strong>\n      to <em>settle here</em>.</p>\n  </div>\n</div>\n</div>\n<div id="METABOOKHEART">\n  <div id="METABOOKRIBBON">\n    <div class="inputbox" ID="METABOOKADDTAGHOLDER">\n      <input TYPE="TEXT" NAME="TAG" VALUE=""\n             placeholder="Type or define a tag, with completion"\n             autocomplete="off"\n             ID="METABOOKADDTAGINPUT"/>\n    </div>\n    <div class="inputbox" ID="METABOOKADDSHAREHOLDER">\n      <input TYPE="TEXT" NAME="OUTLET" VALUE=""\n             placeholder="Type a group or individual name"\n             autocomplete="off"\n             ID="METABOOKADDSHAREINPUT"/>\n    </div>\n    <div class="resultinfo notags noresults" id="METABOOKSEARCHINFO">\n      <span class="noresults">No results</span>\n      <span class="noquery">\n        <span class="fortouch">Tap</span> <span class="notouch">Click</span>\n        tags or start typing to begin a search</span>\n      <span class="stats">\n        <span class="resultcount metabookshowsearch"></span>\n        <span class="refinecount metabookrefinesearch"></span>\n        <span class="showalltags metabookexpandsearch">all<br/>tags</span>\n      </span>\n      <span id="METABOOKSEARCHTAGS" class="qtags"></span>\n    </div>\n  </div>\n  <div id="METABOOKHEARTBODY"></div>\n</div>\n<div id="METABOOKHELPCONTENT">\n  <div id="METABOOKHELP" class="metabookhelp">\n    \x3c!-- This is the help text for reading the book as a whole (it get\'s\n         displayed for help when there isn\'t an active reader mode) --\x3e\n    <div id="METABOOKAPPHELP"></div>\n  </div>\n  <div id="METABOOKHUDHELP" class="helpbox"></div>\n  <div id="METABOOKKEYBOARDHELPBOX" class="closed">\n    <span class="keep" onclick="metaBook.keyboardHelp(true);">keep</span>\n    <span class="close" onclick="metaBook.keyboardHelp(false);">close</span>\n    <div id="METABOOKKEYBOARDHELP"></div>\n    <div class="checkspan">\n      <input TYPE="CHECKBOX" NAME="METABOOKKEYBOARDHELP" VALUE="yes"\n             CHECKED>\n      Show keyboard help\n    </div>\n  </div>\n  <div class="hudtip topcenter">\n    <span class="fortouch">Tap</span><span class="notouch">Click</span>\n    at the top of the page to see the &metaBook; <em>tools</em>\n  </div>\n  <div class="hudtip topleft" data-hudmode="toc">\n    <span class="nobreak"><span class="arrow">&#x2190;</span>navigate</span><br/>\n    <span class="nobreak">outline</span></div>\n  <div class="hudtip topright" data-hudmode="search">\n    <span class="nobreak"><span class="arrow">&#x2192;</span>search</span><br/>\n    for&nbsp;tags\n  </div>\n  <div class="hudtip leftmiddle">\n    back page\n  </div>\n  <div class="hudtip rightmiddle">\n    next page\n  </div>\n</div>\n<div id="METABOOKFOOT" data-xtouchable="span.metabookpagespan,span.metabookpageno,span.metabookloc,img.hudbutton">\n  <div id="METABOOKSHOWTEXT">\n    <span>\n      <span class="justreading">close tools</span>\n      <span class="stopskimming">stop skimming</span>\n      <span class="cancelgloss">cancel gloss</span>\n      <span class="cancelchanges">discard changes</span>\n    </span>\n  </div>\n  <div class="hudtip botcenter">\n    <span style="font-size: 200%; font-weight: bold; position: absolute; left: 2px; bottom: 2px;" class="arrow">\n      &#x2193;</span>\n    this bar shows where you are in the book;\n    <span class="fortouch">tap</span><span class="notouch">click</span>\n    to jump, press to skim, and <span class="fortouch">tap</span>\n      <span class="notouch">click</span> numeric indicators to change\n      them.\n  </div>\n  <div id="METABOOKPAGEBAR">\n    <div class="textfoot">\n      <div id="METABOOKLAYOUTADJUST">Updating layout</div>\n      <span id="METABOOKPAGEREFTEXT" class="metabookpageno"></span>\n      <span id="METABOOKPAGENOTEXT" class="metabookpageno">p/n</span>\n      <span class="metabookloc" id="METABOOKLOCPCT">??.??%</span>\n      <div id="METABOOKGOTOLOC" class="metabookgoto">\n        <span class="gototext">\n          <input type="text" name="GOTOLOC" value="" placeholder="loc"\n                 title="Enter a percent (<= 100) or an immediate location (> 100)"\n                 id="METABOOKLOCINPUT"\n                 onkeypress="metaBook.UI.goto_keypress(event);"/>%</span>\n      </div>\n      <div id="METABOOKGOTOPAGE" class="metabookgoto">\n        <span class="gototext">\n          <input type="text" name="GOTOPAGE" value=""\n                 id="METABOOKPAGEINPUT" placeholder="page#"\n                 onkeypress="metaBook.UI.goto_keypress(event);"/>/\n          <span id="METABOOKGOTOPAGEMAX"></span></span>\n      </div>\n      <div id="METABOOKGOTOREF" class="metabookgoto">\n        <span class="gototext">\n          <input type="text" name="GOTOREF" value=""\n                 id="METABOOKREFINPUT" placeholder="pg ref#"\n                 onkeypress="metaBook.UI.goto_keypress(event);"/>/\n          <span id="METABOOKGOTOPAGEREFMAX"></span></span>\n      </div>\n    </div>\n    <hr class="metabooklayoutindicator" id="METABOOKLAYOUTINDICATOR"/>\n    <div class="metabookpageprogress" id="METABOOKPAGEPROGRESS"></div>\n    <div class="metabooksectmarker" id="METABOOKSECTMARKER1"></div>\n    <div class="metabooksectmarker" id="METABOOKSECTMARKER2"></div>\n    <div class="metabooksectmarker" id="METABOOKSECTMARKER3"></div>\n    <div class="metabookpagespan" id="METABOOKCURPAGESPAN"></div>\n    <div class="metabookpagespan" id="METABOOKPRVPAGESPAN"></div>\n  </div>\n  <img src="{{bmg}}metabook/allglosses.svgz"\n       onerror="this.src=\'{{bmg}}metabook/allglosses50x50.png\'"\n       alt="allglosses" title="show all glosses"\n       class="hudbutton hudmodebutton botright"\n       id="METABOOKALLGLOSSESBUTTON"\n       hudmode="allglosses"/>\n  <img src="{{bmg}}metabook/tagsearch.svgz"\n       onerror="this.src=\'{{bmg}}metabook/tagsearch50x50.png\'"\n       alt="searchresults" title="show searchresults"\n       class="hudbutton hudmodebutton botright"\n       hudmode="searchresults"/>\n  <img src="{{bmg}}metabook/tocicon.svgz"\n       onerror="this.src=\'{{bmg}}metabook/tocicon50x50.png\'"\n       alt="statictoc" title="show TOC"\n       class="hudbutton hudmodebutton botright"\n       hudmode="statictoc"/>\n  <img src="{{bmg}}metabook/gloss_save_titled.svgz"\n       onerror="this.src=\'{{bmg}}metabook/gloss_save_titled50x50.png\'"\n       alt="save gloss" title="save gloss"\n       class="hudbutton botright"/>\n  <img src="{{bmg}}metabook/help.svgz"\n       onerror="this.src=\'{{bmg}}metabook/help50x50.png\'"\n       alt="help" title="show contextual help"\n       class="hudbutton hudmodebutton botleft"\n       id="METABOOKHELPBUTTON"\n       hudmode="help"/>\n  <div class="hudtip botright" data-hudmode="toc">\n    <span class="nobreak">browse</span><br/>\n    <span class="nobreak">glosses<span class="arrow">&#x2192;</span></span></div>\n  <div class="hudtip botleft">\n    <span class="nobreak">toggle</span><br/>\n    <span class="nobreak"><span class="arrow">&#x2190;</span>help</span></div>\n</div>\n<div id="METABOOKAUDIO">\n  <audio id="METABOOKPAGEFORWARDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/pageforward.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/pageforward.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKPAGEBACKWARDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/pagebackward.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/pagebackward.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKSKIMFORWARDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/skimforward.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/skimforward.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKSKIMBACKWARDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/skimbackward.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/skimbackward.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKSKIMSTOPAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/skimstop.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/skimstop.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKTEXTSELECTAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/selecting.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/selecting.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKRAISEHUDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/raisehud.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/raisehud.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKDROPHUDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/drophud.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/drophud.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKGLOSSEDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/glossed.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/glossed.ogg" type="audio/ogg"/>\n  </audio>\n</div>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n --\x3e\n';metaBook.HTML.heart='<div id="METABOOKALLGLOSSES" class="metabookslice mbsyncslice hudpanel">\n  \x3c!-- This is filled in on startup --\x3e\n</div>\n<div id="METABOOKGLOSSDETAIL" class="hudpanel">\n  \x3c!-- This displays detail text for a gloss --\x3e\n</div>\n<div id="METABOOKASIDE" class="hudpanel">\n  \x3c!-- This displays the text for an aside --\x3e\n</div>\n<div id="METABOOKGLOSSEDITDETAIL" class="hudpanel">\n  \x3c!-- This is for editing the detail text for a gloss --\x3e\n  <textarea NAME="METABOOKDETAILTEXT" class="markdowninput"\n            ID="METABOOKDETAILTEXT">\n  </textarea>\n</div>\n<div id="METABOOKGLOSSATTACH" class="hudpanel"></div>\n<div id="METABOOKSEARCHCLOUD" class="completions cloud searchcloud"></div>\n<div id="METABOOKALLTAGS" class="completions searchcloud cloud noinput">\n</div>\n<div id="METABOOKSEARCHRESULTS" class="metabookslice mbsyncslice hudpanel"></div>\n<div id="METABOOKSHARECLOUD" class="hudpanel completions cloud showall"></div>\n<div id="METABOOKGLOSSCLOUD" class="hudpanel completions cloud showall">\n  <div class="nomatchmsg">(no matches)</div>\n</div>\n<div class="tabcontent flyleaftab hudpanel" id="METABOOKSTATICTOC"\n     data-touchable=".mbtoc"></div>\n<iframe name="METABOOKGLOSSCOMM" id="METABOOKGLOSSCOMM"\n        frameborder="0" scrolling="auto"\n        class="hudpanel tabcontent"></iframe>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.attach='<form id="METABOOKATTACHFORM" target="METABOOKGLOSSCOMM"\n      method="POST" enctype="multipart/form-data" accept-charset="utf-8"\n      action="https://glossdata.bookhub.io/1/attach"\n      class="link">\n  <table class="fdjtform"\n         onclick="fdjt.UI.CheckSpan.onclick(event);">\n    <input TYPE="HIDDEN" NAME="GLOSSID" VALUE="" id="METABOOKUPLOADGLOSSID"/>\n    <input TYPE="HIDDEN" NAME="ITEMID" VALUE="" id="METABOOKUPLOADITEMID"/>\n    <tr class="attachtype">\n      <th class="headcell">\n        Attach<img src="{{bmg}}metabook/gloss_attach.svgz"/></th>\n      <td>\n        <button id="METABOOKATTACHDELETE" NAME="ATTACH" VALUE="DELETE">\n          Delete</button>\n        <span class="checkspan ischecked mbaddlink"\n              title="Attach a link to this gloss">\n          <input type="RADIO" NAME="ATTACHTYPE" VALUE="link"\n                 onchange="metaBook.UI.changeAttachment(event);"\n                 CHECKED/>\n          Link</span>\n        <span class="checkspan mbupload"\n              title="Upload a file and attach it to this gloss">\n          <input type="RADIO" NAME="ATTACHTYPE" VALUE="upload"\n                 onchange="metaBook.UI.changeAttachment(event);"/>\n          File</span>\n        <span class="checkspan mbeditbody"\n              title="Create or edit a \'body\' for this gloss">\n          <input type="RADIO" NAME="ATTACHTYPE" VALUE="body"\n                 onchange="metaBook.UI.changeAttachment(event);"/>\n          Body</span>\n        <span class="checkspan mbcapture"\n              title="Attach audio or video recorded on this device">\n          <input type="RADIO" NAME="ATTACHTYPE" VALUE="capture"\n                 onchange="metaBook.UI.changeAttachment(event);"/>\n          Capture</span>\n      </td>\n      <th class="button">\n        <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="LINK">\n          Link</button>\n        <button id="METABOOKUPLOADOK" NAME="ATTACH" VALUE="UPLOAD">\n          Save</button>\n        <button id="METABOOKUPLOADOK" NAME="ATTACH" VALUE="SAVE">\n          Save</button>\n        <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="BODY">\n          Save</button>\n        <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="DONE">\n          Done</button>\n        <button id="METABOOKATTACHCANCEL" VALUE="CANCEL">\n          Cancel</button></th>\n    </tr>\n    <tr class="title">\n      <th>Label</th>\n      <td colspan="2">\n        <INPUT TYPE="TEXT" NAME="TITLE" VALUE="" ID="METABOOKATTACHTITLE"\n               placeholder="a descriptive label"/></tr>\n    <tr class="checkspan uploadrights"\n        id="METABOOKUPLOADRIGHTS">\n      <th><input TYPE="CHECKBOX" NAME="FILEOKAY" VALUE="yes"/></th>\n      <td colspan="2">\n        I affirm that I have the right to use and share this\n        content according to the bookhub.io\n        <a href="https://www.bookhub.io/legalia/TOS/" target="_blank">\n          Terms of Service</a>.</td>\n    </tr>\n    <tr class="url">\n      <th>URL</th>\n      <td colspan="2">\n        <input TYPE="TEXT" NAME="URL" VALUE=""\n               ID="METABOOKATTACHURL" class="fdjturlinput"\n               placeholder="a URL to attach"/>\n      </td>\n    </tr>\n    <tr class="capturefile">\n      <th>Capture</th>\n      <td id="METABOOKCAPTUREFILE" class="nofile" colspan="2">\n\t<button NAME="CAPTURE" VALUE="AUDIO">Audio</button>\n\t<button NAME="CAPTURE" VALUE="VIDEO">Video</button>\n\t<button NAME="CAPTURE" VALUE="IMAGE">Photo</button>\n    </td></tr>\n    <tr class="uploadfile">\n      <th>Upload<input TYPE="FILE" NAME="UPLOAD" ID="METABOOKFILEINPUT"/></th>\n      <td id="METABOOKATTACHFILE" class="nofile" colspan="2">\n        <span class="mbdragmessage">Drag a file here or click to browse</span>\n        <span class="mbmessage">Tap to find files or media</span>\n        <span class="mbfilename" id="METABOOKATTACHFILENAME"></span>\n    </td></tr>\n    <tbody class="glossbody" id="METABOOKGLOSSBODY">\n      <tr>\n        <td colspan="3"><textarea NAME="BODYTEXT" ID="METABOOKGLOSSBODYTEXT"></textarea></td>\n      </tr>\n    </tbody>\n  </table>\n</form>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.help='<h1><span class="metabooktogglehelp">Ok</span>Using &metaBook;</h1>\n\n<p><img src="{{bmg}}metabook/browser_edges.svgz"\n        onerror="this.src=\'{{bmg}}metabook/browser_edges32x32.png\'"\n        alt="top of browser" class="floatright"/>\n  <strong>Move by pages</strong>\n  <span class="fortouch">by swiping left or right</span>\n  <span class="notouch">using the Space or Backspace keys</span> or\n  <span class="fortouch">tapping</span> <span class="notouch">clicking</span>\n  on the left or right regions of the page.</p>\n\x3c!--\n<p><img src="{{bmg}}metabook/browser_corners.svgz" \n        onerror="this.src=\'{{bmg}}metabook/browser_corners32x32.png\'"\n        alt="top of browser" class="floatright"/>\n  <strong>Open the <dfn>book tools</dfn></strong> by\n  <span class="fortouch">tapping</span>\n  <span class="notouch">clicking</span> at the top of the\n  page.  <strong>Navigate, search, or skim</strong> using the icons\n  in the corners of the page.</p>\n<p><strong>Show this and other help</strong> by\n  <span class="fortouch">tapping</span><span class="notouch">clicking</span>\n  the <img src="{{bmg}}metabook/help.svgz" alt="top of browser"\n  onerror="this.src=\'{{bmg}}metabook/help50x50.png\'" class="inline"/>\n  icon in the lower left corner of the page.</p>\n--\x3e\n<p class="glossexample">\n  <strong style="color: blue;">Blue <dfn>gloss bars</dfn></strong> in\n  the right margin indicate glosses already overlaid on your\n  book.  <strong><span class="fortouch">Tap or drag\n  left</span> <span class="notouch">Click to the left</span></strong>\n  of the blue bar to see associated notes, tags, links, etc.</p>\n\n<p><strong>Add your own glosses</strong> by\ndouble <span class="fortouch">tapping</span>\n  <span class="notouch">clicking</span> on the content or pressing and\n  holding to select text.  <strong>Enter notes, tags, links,\n  etc</strong> in the <dfn>gloss box</dfn> appearing at the top of the\n  page. <strong>Drag <span class="fortouch">your finger</span>\n  <span class="notouch">the pointer</span></strong> to select adjust\n  the <span class="fdjtselected"><span class="fdjtselectstart">beginning</span>\n  and <span class="fdjtselectend">end</span></span> of highlighted\n  text.</p>\n\n<p class="helphelp">\n  <strong>Show this and other help</strong> by\n  <span class="fortouch">tapping</span><span class="notouch">clicking</span>\n  the <img src="{{bmg}}metabook/help.svgz" alt="top of browser"\n           onerror="this.src=\'{{bmg}}metabook/help50x50.png\'" class="inline"/>\n  icon in the lower left of the page.</p>\n\n\x3c!--\n<p class="tightbottom">\n  <img src="{{bmg}}metabook/docs/pagebar_zoom.png" class="floatright"/>\n  <strong>Browse the book</strong> using the <dfn>pagebar</dfn> along\n  the bottom.  The dark blue line show the current location with\n  lighter regions around for the current section and its parent.\n  <img src="{{bmg}}metabook/docs/pagebar_wide.png" class="wideimage"/>\n  <img src="{{bmg}}metabook/docs/pagebar_wide.png"\n  class="narrowimage"/><br/>\n  <span class="subpara">\n    <span class="fortouch">Tap</span><span class="notouch">Click</span>\n    the page number (in the middle) or percentage (on the right) to move\n    precisely.  Press and hold the pagebar to see a particular page,\n    moving <span class="fortouch">your\n      finger</span> <span class="notouch">the pointer</span> to skim\n    through pages.  <span class="notouch">Release</span>\n    <span class="fortouch">Lift your finger</span> to settle where you\n    are or <span class="fortouch">move\n      it</span> <span class="notouch">drag the mouse</span> out of the\n    pagebar to return to where you were.</span></p>\n--\x3e\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.hudhelp='<div id="METABOOKADDGLOSSHELP" class="helpbox">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Add your own gloss to a passage</h2>\n  <p><strong class="fortouch">Tap</strong>\n    <strong class="notouch">Click</strong>\n    or <strong><span class="fortouch">touch</span> \n      <span class="notouch">press</span> and drag</strong> the menu\n    button <img src="{{bmg}}metabook/downmenu.svgz"\n    onerror="this.src=\'{{bmg}}metabook/downmenu64x64.png"\n    class="inline" style="border: solid black 1px; padding: 0px;"/>\n    for more options (<strong>release</strong> to select).</p>\n  <p><img src="{{bmg}}metabook/remark.svgz"\n          onerror="this.src=\'{{bmg}}metabook/remark64x64.png" class="screengrab"\n          alt="the balloon icon"/> Type your comments in the input\n          box, ending with <kbd>Enter</kbd> and using\n    <kbd>Shift-Enter</kbd> to insert a newline.  Specify **bold** or\n    *italics* and other formatting using\n    <a href="http://daringfireball.net/projects/markdown/syntax"\n       target="_blank">\n      Markdown syntax</a>.</p>\n  <p><img src="{{bmg}}metabook/tagicon.svgz"\n          onerror="this.src=\'{{bmg}}metabook/tagicon64x64.png\'"\n          class="screengrab" alt="the tag icon"/>\n    <strong>Add simple tags</strong> as <tt>#tag</tt> or even\n    &ldquo;<tt>#compound tag</tt>,&rdquo; pressing <kbd>Enter</kbd>\n    when done.</p>\n  <p><strong><span class="fortouch">Tap</span> \n      <span class="notouch">Click</span> the passage</strong> to\n    show or hide the gloss form; press and drag the \n    <span class="fdjtselected"><span class="fdjtselectstart">ends</span>\n      of the <span class="fdjtselectend">highlight</span></span> to change\n    it.  <strong><span class="fortouch">Tap</span>\n      <span class="notouch">Click</span> anywhere else</strong> to close\n    the gloss (and save or discard your changes).</p>\n</div>\n<div id="METABOOKGLOSSATTACHHELP" class="helpbox">\n  <p><img src="{{bmg}}metabook/diaglink.svgz"\n          onerror="this.src=\'{{bmg}}metabook/diaglink64x64.png\'"\n          class="inline" alt="the link icon"/>\n    <strong>Add links</strong>\n    as <strong>[@</strong><em><tt>uri</tt></em>\n    <em>title</em><strong>]</strong>,\n    e.g. <strong>[@</strong><tt>http://www.whitehouse.gov/</tt>\n    The White House<strong>]</strong>.</p>\n</div>\n<div id="METABOOKGLOSSTAGHELP" class="helpbox">\n  <p><img src="{{bmg}}metabook/tagicon.svgz"\n          onerror="this.src=\'{{bmg}}metabook/tagicon64x64.png\'"\n          class="inline" alt="the tag icon"/>\n    Specify <strong>synonyms</strong> for your tags (e.g.\n    <span class="tagsample"><strong>[</strong>airplane|plane|aircraft<strong>]</strong></span>)\n    or describe <strong>relations</strong>\n    (e.g. <span class="tagsample">\n      <strong>[</strong>sloop|^sailboat|^boat<strong>]</strong></span>)\n    to make your tags <strong>more useful</strong> for browsing\n    and search by yourself or others.</p>\n</div>\n<div id="METABOOKSKIMTOCHELP" class="helpbox fdjtadjustfont">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Skimming by sections</h2>\n  <p>You\'re <span>skimming</span> through your book based on the\n    chapters, sections, and subsections in the table of contents.</p>\n  <p class="fortouch">\n    <span>Swipe left or right with two fingers</span> to move forward\n    and backward by sections or use the\n    <img src="{{bmg}}metabook/skim_left.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_left100x100.png"\n    class="inline"/\'> and <img src="{{bmg}}metabook/skim_right.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_right100x100.png"\n    class="inline"/\'> arrows on the sides of the page. These also\n    indicate the number of sections in each direction.</p>\n  <p class="notouch">\n    Use the <span>arrow keys</span> to move forward and backward by\n    sections or use the <img src="{{bmg}}metabook/skim_left.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_left100x100.png"\n    class="inline"/> and <img src="{{bmg}}metabook/skim_right.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_right100x100.png"\n    class="inline"/> arrows on the sides of the page.  These also\n    indicate the number of sections in each direction.</p>\n  <p><span class="fortouch">Tap</span><span class="notouch">Click</span>\n    the book text to minimize the interface;\n    <span class="fortouch">tap</span><span class="notouch">click</span>\n    again to stop skimming altogether.</p>\n  <p>The <img src="{{bmg}}metabook/tocicon.svgz"\n              onerror="this.src=\'{{bmg}}metabook/tocicon50x50.png"\n              class="inline"> in\n              the lower right corner returns to the table of contents.\n              The <strong>overleaf</strong> at the top of the page\n              shows the current point in the table of\n              contents; <span class="fortouch">tap</span>\n    <span class="notouch">click</span> once to expand it and again to\n    return to the TOC.</p>\n</div>\n<div id="METABOOKSKIMSEARCHHELP" class="helpbox fdjtadjustfont">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Skimming your search</h2>\n  <p>You\'re currently <span>skimming</span> through the results of\n    your search.  The current search result is shown in\n    the <strong>overleaf</strong> at the top of the page and the\n    matching text is highlighted in the body.</p>\n  <p class="fortouch">\n    <span>Swipe left or right with two fingers</span> to move to the\n    next (or previous) result or use the\n    <img src="{{bmg}}metabook/skim_left.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_left100x100.png"\n    class="inline"/\'> and <img src="{{bmg}}metabook/skim_right.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_right100x100.png"\n    class="inline"/\'> arrows on the sides of the page.  These also\n    indicate the number of search results in each direction.</p>\n  <p class="notouch">\n    Use the <span>arrow keys</span> to to the next or previous search\n    result or use the <img src="{{bmg}}metabook/skim_left.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_left100x100.png"\n    class="inline"/> and <img src="{{bmg}}metabook/skim_right.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_right100x100.png"\n    class="inline"/> arrows on the sides of the page.  These also\n    indicate the number of search results in each direction.</p>\n  <p><span class="fortouch">Tap</span><span class="notouch">Click</span>\n    the book text to minimize the interface;\n    <span class="fortouch">tap</span><span class="notouch">click</span>\n    again to stop skimming altogether.</p>\n  <p>The <img src="{{bmg}}metabook/tagsearch.svgz"\n              onerror="this.src=\'{{bmg}}metabook/tagsearch50x50.png"\n              class="inline">\n    icon in the lower right corner returns to the search results.\n    The <strong>overleaf</strong> at the top of the page\n    shows the result being\n    displayed; <span class="fortouch">tap</span>\n    <span class="notouch">click</span> it once to expand it and again\n    to return to the list of results.</p>\n</div>\n<div id="METABOOKSKIMGLOSSESHELP" class="helpbox fdjtadjustfont">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Skimming Glosses</h2>\n  <p>You\'re <span>skimming</span> through your book based on the\n    glosses (highlights, notes, etc) which you or others have added.\n    The <strong>overleaf</strong> at the top of the page shows the\n    current gloss and the text itself shows any highlights.</p>\n  <p class="fortouch">\n    <span>Swipe left or right with two fingers</span> to move to the\n    next (or previous) gloss or use the\n    <img src="{{bmg}}metabook/skim_left.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_left100x100.png"\n    class="inline"/\'> and <img src="{{bmg}}metabook/skim_right.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_right100x100.png"\n    class="inline"/\'> arrows on the sides of the page.  These also\n    indicate the number of glosses in each direction.</p>\n  <p class="notouch">\n    Use the <span>arrow keys</span> to to the next or previous gloss\n    or use the <img src="{{bmg}}metabook/skim_left.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_left100x100.png"\n    class="inline"/> and <img src="{{bmg}}metabook/skim_right.svgz"\n    onerror="this.src=\'{{bmg}}metabook/skim_right100x100.png"\n    class="inline"/> arrows on the sides of the page.  These also\n    indicate the number of glosses in each direction.\n  </p>\n  <p><span class="fortouch">Tap</span><span class="notouch">Click</span>\n    the book text to minimize the interface;\n    <span class="fortouch">tap</span><span class="notouch">click</span>\n    again to stop skimming\n    altogether.</p>\n  <p>The <img src="{{bmg}}metabook/allglosses.svgz"\n              onerror="this.src=\'{{bmg}}metabook/allglosses50x50.png"\n              class="inline">\n              button in the lower right corner returns to the list of\n              glosses.  The <strong>overleaf</strong> at the top of\n              the page shows the gloss you\'re\n              seeing; <span class="fortouch">tap</span>\n    <span class="notouch">click</span> it once to expand it and again\n    to return to the list of results.</p>\n</div>\n<div id="METABOOKGOTOPAGEHELP" class="helpbox">\n  <p>Enter a page number at the top of the page to jump directly to that\n    page.<br/> Use the escape key or <span class="fortouch">tap</span>\n    <span class="notouch">click</span> at the bottom of the page to\n    cancel.</p>\n</div>\n<div id="METABOOKGOTOREFHELP" class="helpbox">\n  <p>Enter a reference page number (from the reference version of the\n    book) at the top of the page to jump to that part of the book.<br/>\n    Use the escape key or <span class="fortouch">tap</span>\n    <span class="notouch">click</span> at the bottom of the page to\n    cancel.</p>\n</div>\n<div id="METABOOKGOTOLOCHELP" class="helpbox">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Got to a specific location</h2>\n  <p>Enter a numeric percentage (in the field at the top of the page)\n    to jump directly to that point within the book.<br/>  These\n    percentages will remain stable even as page layout or font size\n    changes.  Use the escape key or <span class="fortouch">tap</span>\n    <span class="notouch">click</span> at the bottom of the page to\n    cancel and return to the text.</p>\n</div>\n<div id="METABOOKSEARCHINPUTHELP" class="helpbox">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Searching tags and text</h2>\n  <p>You are searching for passages or glosses within your book, using\n    either semantic <span class="dterm">tags</span> or\n    literal <span class="rawterm">terms</span>.  As you type or edit\n    the text in the search box, the cloud of tags and phrases will\n    grow or shrink to display matching phrases, tags, or tag\n    synonyms.</p>\n  <p><span class="fortouch">Tapping</span>\n    <span class="notouch">Clicking</span>\n    <span>a term or tag</span> adds it to the current search,\n    generating both new results and an updated cloud of associated\n    terms and tags.  Tags may be related to other tags (for\n    example, <span class="dterm">dachshund</span>\n    to <span class="dterm">dog</span>) and those relationships are\n    used in your search.</p>\n</div>\n<div id="METABOOKSEARCHRESULTSHELP" class="helpbox">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Browsing search results</h2>\n  <p>The results of your search are ordered by relevance and position\n    within the book.  Refine or change your search by selecting one of\n    the tabs (\'co-tags\' or \'all tags\') above the\n    results<img src="/static/g/metabook/searchtabs.png"\n    class="screengrab"/> or by simply entering more text.  Co-tags are\n    tags which occur among the current search results; all tags are\n    all tags used throughout the book.</p>\n  <p class="notouch">Use <strong>the space and backspace keys</strong>\n    to move through the list of results page-by-page; <strong>combine\n    with the shift key</strong> or use the <strong>arrow keys</strong>\n    to move in larger increments. Use the <strong>percentage\n    indicator</strong> <img src="{{bmg}}/metabook/pagecontrol.png"\n    class="inlineright"/> to move page-by-page or to enter a specific\n    percentage (just click on the number).</p>\n  <p class="fortouch"><strong>Swipe left or right</strong> to move\n    page-by-page through the search results; <strong>swipe with two\n    fingers</strong> to move in larger increments.  Use\n    the <strong>percentage indicator</strong>\n    <img src="{{bmg}}/metabook/pagecontrol.png" class="inlineright"/>\n    to move page-by-page or to enter a specific percentage (just tap\n    on the number).</p>\n  <p><strong><span class="fortouch">Tap</span>\n    <span class="notouch">Click</span> a search result</strong> to\n    jump to that part of the book and begin <span>skimming</span>\n    through the search results starting at that point.</p>\n  <p><strong><span class="notouch">Hold the mouse button down\n      on</span><span class="fortouch">Press and hold</span> a\n      result</strong> to preview the result in in its context;\n      <strong>release</strong> to return to the list of results.</p>\n</div>\n<div id="METABOOKALLGLOSSESHELP" class="helpbox">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    All glosses</h2>\n  <p>These are <span>all of the glosses</span> applied to your\n    copy of this book.</p>\n  <p>The <strong>row of icons</strong> at the top of the screen show\n    the <span>creators or layers</span> where different glosses\n    originate. <span class="fortouch">Tap</span>\n    <span class="notouch">Click</span> the icons to just see glosses\n    from a single source or double <span class="fortouch">tap</span>\n    <span class="notouch">click</span> to add glosses from other\n    sources.</p>\n  <p class="notouch">The <strong>space and backspace keys</strong>\n    move through the list of glosses page-by-page; combine them with\n    the shift key or use the <strong>arrow keys</strong> to move in\n    larger increments. Use the <strong>percentage indicator</strong>\n    <img src="{{bmg}}/metabook/pagecontrol.png" class="inlineright"/>\n    to move page-by-page or to enter a specific percentage (just click\n    on the number).</p>\n  <p class="fortouch"><strong>Swipe left or right</strong> to move\n    page-by-page through the glosses; <strong>swipe with two\n    fingers</strong> to move in larger increments.  Use\n    the <strong>percentage indicator</strong>\n    <img src="{{bmg}}/metabook/pagecontrol.png" class="inlineright"/>\n    to move page-by-page or to enter a specific percentage (just tap\n    on the number).</p>\n  <p><span class="fortouch">Tap</span>\n    <span class="notouch">Click</span> a particular gloss to jump to\n    that part of the book and begin <span>skimming</span> through the\n    displayed glosses starting at that point.</p>\n  <p><span class="notouch">Hold the mouse button down\n      on</span><span class="fortouch">Press and hold</span> a a gloss\n      to see it in in context; <strong>release</strong> to return to the list of\n      glosses.</p>\n</div>\n<div id="METABOOKSTATICTOCHELP" class="helpbox">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    The Table of Contents</h2>\n  <p>The <strong>table of contents</strong> (TOC) displays a\n    hierarchical map of your book created by the author or publisher.\n    Red lines indicate your current reading location; the\n    light-colored bars indicate the subsection\'s size and position\n    within its parent.</p>\n  <p class="notouch">Use <strong>the space and backspace keys</strong>\n    to move through the TOC page-by-page; <strong>combine with the\n    shift key</strong> or use the <strong>arrow keys</strong> to move\n    in larger increments. You can also use the <strong>percentage\n    indicator</strong> <img src="{{bmg}}/metabook/pagecontrol.png"\n    class="inlineright"/> to move page-by-page or enter a specific\n    percentage (just click on the number).</p>\n  <p class="fortouch"><strong>Swipe left or right</strong> to move\n    page-by-page through the TOC; <strong>swipe with two\n    fingers</strong> to move in larger increments.  You can also use\n    the <strong>percentage indicator</strong>\n    <img src="{{bmg}}/metabook/pagecontrol.png" class="inlineright"/>\n    to move forward or backward or to enter a specific percentage\n    (just tap on the number).</p>\n  <p><strong><span class="fortouch">Tap</span>\n    <span class="notouch">Click</span> a line</strong> in the TOC to\n    jump to that section.  You\'ll start <em>skimming</em> through the\n    table of contents while seeing the content of the book.</p>\n  <p><strong>\n      <span class="notouch">Hold the mouse button down\n        on</span><span class="fortouch">Press and hold</span> a TOC\n        line</strong> to preview the section without leaving the table\n        of contents.  <strong>Release</strong> to return to the TOC\n        listing.</p>\n</div>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.menu='<img src="{{bmg}}metabook/tocicon.svgz"\n     onerror="this.src=\'{{bmg}}metabook/tocicon50x50.png\'"\n     alt="toc" title="navigate sections"\n     class="hudbutton hudmodebutton topleft"\n     id="METABOOKTOCBUTTON"\n     hudmode="statictoc"/>\n<div id="METABOOKBREVET"\n     title="Open the meta layer for navigation, search, etc.">\n  &nbsp;</div>\n<div id="METABOOKCOVERTAB">\n  <img src="{{bmg}}metabook/mbsettings.svgz"\n       onerror="this.src=\'{{bmg}}metabook/mbsettings50x50.png\'"\n       alt="toc" title="book settings"\n       class="hudbutton hudmodebutton left"\n       id="METABOOKSETTINGSBUTTON"\n       hudmode="settings"/>\n  <div class="hudbutton" id="METABOOKSHOWCOVER">Cover</div>\n  <img src="{{bmg}}metabook/overlay.svgz"\n       onerror="this.src=\'{{bmg}}metabook/overlay50x50.png\'"\n       alt="toc" title="see book layers"\n       class="hudbutton hudmodebutton right"\n       id="METABOOKLAYERSBUTTON"\n       hudmode="layers"/>\n</div>\n<img src="{{bmg}}metabook/tagsearch.svgz"\n     onerror="this.src=\'{{bmg}}metabook/tagsearch50x50.png\'"\n     alt="search" title="search tags"\n     class="hudbutton hudmodebutton topright"\n     hudmode="search"/>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n --\x3e\n';metaBook.HTML.console='<h1>metaBook Console</h1>\n<div class=\'message\' id=\'METABOOKCONSOLEMESSAGE\'></div>\n<div id="METABOOKCONSOLELOG" class=\'sbookmessagelog\'></div>\n<div id="METABOOKCONSOLEINPUT">\n  <span class="button" id="METABOOKCONSOLEBUTTON">run</span>\n  <textarea id="METABOOKCONSOLETEXTINPUT">\n  </textarea>\n</div>\n\n\x3c!--\n/* Emacs local variables\n;;;  Local variables: ***\n;;;  compile-command: "cd ../..; make" ***\n;;;  indent-tabs-mode: nil ***\n;;;  End: ***\n*/\n--\x3e\n\n';metaBook.HTML.messages='<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPSCAN">\n  <div class="indicator"></div>\n  <div class="message">\n    Scanning the book content for structure and metadata.</div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPTOC">\n  <div class="indicator"></div>\n  <div class="message">\n    Setting up tables of content for book navigation.</div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPKNO">\n  <div class="indicator"></div>\n  <div class="message">\n    Processing embedded or referenced knowledge bases.\n    <div id="METABOOKSTARTUPKNODETAILS"></div>\n  </div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPTAGGING">\n  <div class="indicator"></div>\n  <div class="message">Indexing with published tags.</div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPCLOUDS">\n  <div class="indicator"></div>\n  <div class="message">Setting up tag clouds for search and glossing.</div>\n</div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKNEWGLOSSES">\n  <div class="indicator"></div>\n  <div class="message">Applying your glosses to your book.</div>\n</div>\n\x3c!--\n     /* Emacs local variables\n     ;;;  Local variables: ***\n     ;;;  compile-command: "cd ../..; make" ***\n     ;;;  End: ***\n     */\n  --\x3e\n\n';metaBook.HTML.cover='<div id="METABOOKCOVERMESSAGE" class="controls">\n  <div id="METABOOKOPENTAB"\n       style="width: 7em; margin-left: auto; margin-right: auto; color: white; background-color: gray; margin-top: 0.2ex; padding:  0px 1em 0px 1em; border: solid transparent 2px; font-variant: small-caps; border-radius: 1ex; box-sizing: border-box;">\n    Open\n  </div>\n  <div id="METABOOKREADYMESSAGE" class="message"\n       style="width: 7em; margin-left: auto; margin-right: auto; color: white; background-color: gray; margin-top: 0.2ex; padding:  0px 1em 0px 1em; border: solid transparent 2px; font-variant: small-caps; border-radius: 1ex; box-sizing: border-box;">\n    Loading\n  </div>\n  <div id="METABOOKBUSYMESSAGE" class="message"\n       style="width: 7em; margin-left: auto; margin-right: auto; color: white; background-color: gray; margin-top: 0.7ex; padding:  0px 1em 0px 1em; border: solid transparent 2px; font-variant: small-caps; border-radius: 1ex; box-sizing: border-box;">\n    Busy\n  </div>\n  <div class="metabookstatus" id="METABOOKLAYOUTMESSAGE" class="message">\n    <div class="metabookprogressbox"><div class="indicator"></div></div>\n    <div class="message" style="font-size: 24px; font-size: 5vmin;"></div>\n  </div>\n  <div class="metabookstatus" id="METABOOKINDEXMESSAGE" class="message">\n    <div class="metabookprogressbox"><div class="indicator"></div></div>\n    <div class="message" style="font-size: 24px; font-size: 5vmin;"></div>\n  </div>\n  <div class="metabookstatus" id="METABOOKGLOSSMESSAGE" class="message">\n    <div class="metabookprogressbox"><div class="indicator"></div></div>\n    <div class="message" style="font-size: 24px; font-size: 5vmin;"></div>\n  </div>\n</div>\n<div id="METABOOKCOVERPAGE" class="flap"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto; overflow: hidden;">\n  <img src="{{coverimage|}}" alt="{{covertext|}}"\n       style="max-width: 95%; width: auto; height: 90%;"\n       id="METABOOKCOVERIMAGE"/>\n</div>\n<div id="METABOOKTITLE" class="flap"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto; overflow: hidden;">\n</div>\n<div id="METABOOKCREDITS" class="flap metabookcredits"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto; overflow: hidden;">\n</div>\n<div id="METABOOKBLURB" class="scrolling flap"\n     style="position: absolute; top: 50px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n</div>\n<div id="METABOOKAPPHELP" class="metabookhelp scrolling flap"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n  <h1><span class="adjustfont">Welcome to the &metaBook; web-based\n      e-reader</span></h1>\n  \n  <p>You\'re using &metaBook;, a web-based e-reader created to deepen\n    reading and engagement while connecting to networks of knowledge,\n    conversation, and commmunity.  &metaBook; aims to reclaim the\n    virtues of physical books for electronic books, making them\n    natural to navigate, annotate, search, and personalize.</p>\n  <div id="METABOOKCOVERHELP"></div>\n</div>\n<div id="METABOOKSETTINGS" class="scrolling flap"\n     style="position: absolute; top: 50px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n</div>\n<div id="METABOOKCONSOLE" class="scrolling flap"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n</div>\n<div id="METABOOKLAYERS" class="scrolling flap"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n  <iframe name="BOOKHUBAPP" id="BOOKHUBAPP" frameborder="0" scrolling="auto"></iframe>\n</div>\n<div id="METABOOKCOVERCONTROLS" class="adjustfonts" \n     style="position: absolute; bottom: 40px; left: 50px; right: 50px; width: auto; height: 60px; top: auto; font-size: 0.8em; font-size: 1.5rem; font-size: 3vw;">\n  <span class="control" data-mode="coverpage" title="see the cover"\n        tabindex="1">\n    Cover</span>\n  <span class="control" data-mode="titlepage"\n        title="this book\'s title page and other information"\n        tabindex="2">\n    Title</span>\n  <span class="control" data-mode="creditspage"\n        title="Credits to people and organizations contributing to this book, including bibliographic information"\n        tabindex="3">\n    Credits</span>\n  <span class="control" data-mode="blurb"\n        title="learn more about this book and its background"\n        tabindex="4">\n    About</span>\n  <span class="control" data-mode="layers"\n        title="manage added layers of glosses for your sBook"\n        tabindex="5">\n    Layers</span>\n  <span class="control" data-mode="console"\n        title="the debugging console (advanced)"\n        tabindex="6">\n    Console</span>\n  <span class="control" data-mode="settings"\n        title="alter this e-reader\'s appearance and interactions"\n        tabindex="7">\n    Settings</span>\n  <span class="control" data-mode="help"\n        title="simple help for using metaBook"\n        tabindex="8">\n    Help</span>\n</div>\n<div class="userbox controls"\n     data-maxfont="120%" id="METABOOKUSERBOX">\n  <span class="bookplate">\n    <a href="https://www.bookhub.io/" target="_blank"\n       class="bookplate__bookref metabookref"\n       title="Learn more about the metaBook reader and bookhub.io" tabindex="9">\n      This book</a>\n    <span class="bookplate__text">is personalized for</span>\n    <a href="https://my.bookhub.io/profile/"\n       class="bookplate__username metabookusername"\n       title="Edit your profile, add social networks, etc"\n       target="_blank" tabindex="10">\n      you</a></span>\n</div>\n<div class="loginbox controls" data-maxfont="120%" id="METABOOKLOGINBOX">\n  <div class="loginmessage">\n    Login to bookhub.io to read smarter</div>\n  <form action="https://auth.bookhub.io/" method="POST">\n    <input TYPE="HIDDEN" NAME="FRESHLOGIN" VALUE="yes"/>\n    <input TYPE="HIDDEN" NAME="LOGINFORM" VALUE="yes"/>\n    <input TYPE="TEXT" NAME="LOGIN" VALUE=""\n           PLACEHOLDER="email/cell login"\n           ONKEYPRESS="fdjt.UI.submitOnEnter(event);"\n           AUTOCOMPLETE="off"\n           tabindex="9"/>\n    <span>or use</span>\n    <select NAME="AUTHORITY">\n      <option value="" selected="SELECTED">Using account</option>\n      <option value=":FACEBOOK">Facebook</option>\n      <option value=":TWITTER">Twitter</option>\n      <option value=":YAHOO">Yahoo!</option>\n      <option value=":GOOGLE">Google</option>\n      <option value=":GPLUS">Google+</option>\n      <option value=":LINKEDIN">Linked In</option>\n      <option value=":AMAZON">Amazon</option>\n      <option value=":PAYPAL">PayPal</option>\n    </select>\n    <button name="AUTHORITY" TABINDEX="11"\n            value=":FACEBOOK">\n      <img src="{{bmg}}metabook/facebook64x64.png" class="nosvg"\n           alt="Facebook" class="noautoscale"/>\n      <img src="{{bmg}}metabook/facebook.svgz" class="svg"\n           alt="Facebook" class="noautoscale"/>\n    </button>\n    <button NAME="AUTHORITY" TABINDEX="12"\n            VALUE=":TWITTER">\n      <img src="{{bmg}}metabook/twitter64x64.png"\n           alt="Twitter" title="login with Twitter"\n           class="nosvg"/>\n      <img src="{{bmg}}metabook/twitter.svgz"\n           alt="Twitter" title="login with Twitter"\n           class="svg"/>\n    </button>\n    <button NAME="AUTHORITY" TABINDEX="13"\n            VALUE="https://open.login.yahooapis.com/openid/op/auth">\n      <img src="{{bmg}}metabook/yahoo64x64.png" class="nosvg"\n           alt="Yahoo!" title="login using Yahoo!"/>\n      <img src="{{bmg}}metabook/yahoo.svgz" class="svg"\n           alt="Yahoo!" title="login using Yahoo!"/>\n    </button>\n    <button NAME="AUTHORITY" TABINDEX="14"\n            VALUE=":GOOGLE">\n      <img src="{{bmg}}metabook/google64x64.png"\n           alt="Google" title="login using your Google account"\n           class="nosvg"/>\n      <img src="{{bmg}}metabook/google.svgz"\n           alt="Google" title="login using your Google account"\n           class="svg"/>\n    </button>\n    <button NAME="AUTHORITY" TABINDEX="15"\n            VALUE=":GPLUS">\n      <img src="{{bmg}}metabook/googleplus64x64.png"\n           alt="Google" title="login using Google+"\n           class="nosvg"/>\n      <img src="{{bmg}}metabook/googleplus.svgz"\n           alt="Google" title="login using Google+"\n           class="svg"/>\n    </button>\n    <button NAME="AUTHORITY" VALUE=":LINKEDIN" TABINDEX="16">\n      <img src="{{bmg}}metabook/linkedin64x64.png"\n           alt="Linked In" title="login with Linked In"\n           class="nosvg"/>\n      <img src="{{bmg}}metabook/linkedin.svgz"\n           alt="Linked In" title="login with Linked In"\n           class="svg"/>\n    </button>\n    <button name="AUTHORITY" TABINDEX="17"\n            value=":AMAZON">\n      <img src="{{bmg}}metabook/amazon64x64.png"\n           alt="Amazon" title="login with your Amazon account"/>\n    </button>\n    <button name="AUTHORITY" TABINDEX="18"\n            value=":PAYPAL">\n      <img src="{{bmg}}metabook/paypalsquare64x64.png" class="nosvg"\n           alt="PayPal" title="login with PayPal"/>\n      <img src="{{bmg}}metabook/paypalsquare.svgz" class="svg"\n           alt="PayPal" title="login with PayPal"/>\n    </button>\n  </form>\n</div>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.settings='<form onsubmit="fdjt.UI.cancel(event); return false;" class="metabooksettings">\n  <h1 class="cf">\n    Settings\n    <span class="message" ID="METABOOKSETTINGSMESSAGE"></span></h1>\n  <div class="fontsizes body"\n       title="Set the font sizes used for the body text.">\n    <span class="label" id="METABOOKBODYSIZELABEL">\n      Body text<br/>\n      <button name="REFRESH" value="Layout"\n              id="METABOOKREFRESHLAYOUT">\n        <img src="{{bmg}}metabook/refresh.svgz" \n             onerror="this.src=\'{{bmg}}metabook/refresh50x50.png\'"\n             alt="Update">\n        Layout</button></span>\n    <span class="samples">\n      <span class="checkspan">\n        <input TYPE="RADIO" NAME="bodysize"\n               VALUE="xlarge"/>\n        <span class="sample xlarge">Aa</span></span>\n      <span class="checkspan">\n        <input TYPE="RADIO" NAME="bodysize" \n               VALUE="large"/>\n        <span class="sample large">Aa</span></span>\n      <span class="checkspan">\n        <input TYPE="RADIO" NAME="bodysize" \n               VALUE="normal"/>\n        <span class="sample normal">Aa</span></span>\n      <span class="checkspan">\n        <input TYPE="RADIO" NAME="bodysize" \n               VALUE="small"/>\n        <span class="sample small">Aa</span></span>\n      <span class="checkspan">\n        <input TYPE="RADIO" NAME="bodysize"\n               VALUE="tiny"/>\n        <span class="sample tiny">Aa</span></span>\n    </span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="contrast checkspans"\n       title="Select the contrast level for body text">\n    <span class="label smaller">Text Contrast</span>\n    <span class="checkspan highcontrast">\n      <input TYPE="RADIO" NAME="bodycontrast"\n             VALUE="high"/>\n      <span class="sample">High</span></span>\n    <span class="checkspan normalcontrast">\n      <input TYPE="RADIO" NAME="bodycontrast" \n             VALUE="medium"/>\n      <span class="sample">Normal</span></span>\n    <span class="checkspan lowcontrast">\n      <input TYPE="RADIO" NAME="bodycontrast"\n             VALUE="low"/>\n      <span class="sample">Low</span></span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="textlayout checkspans">\n    <span class="label smaller">Layout</span>\n    <span class="checkspans">\n      <span class="checkspan codex">\n        <input TYPE="RADIO" NAME="METABOOKLAYOUT"\n               VALUE="bypage"/>\n        by pages</span>\n      <span class="checkspan scrolling">\n        <input TYPE="RADIO" NAME="METABOOKLAYOUT" \n               VALUE="scrolling"/>\n        just scroll</span>\n      <span class="checkspan scrollio">\n        <input TYPE="RADIO" NAME="METABOOKLAYOUT"\n               VALUE="scrollio"/>\n        hybrid (<em>scrollio</em>)</span>\n    </span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="also checkspans">\n    <span class="label smaller">Other Options</span>\n    <span class="checkspan opendyslexical"\n          title="OpenDyslexic is a font designed to increase readability for readers with dyslexia">\n      <input TYPE="CHECKBOX" NAME="dyslexical" VALUE="yes"/>\n      <span class="checktext">Use OpenDyslexic font</span>\n      <a href="http://opendyslexic.org/"\n         title="The Open Dyslexic font site">(about)</a>\n    </span>\n    <span class="sep">//</span>\n    <span class="checkspan justify"\n          title="left/right justify paragraphs of body text">\n      <input TYPE="CHECKBOX" NAME="textjustify" VALUE="yes"/>\n      Justify paragraphs</span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="fontsizes device"\n       title="Set the font sizes used by the interface components of metaBook">\n    <span class="label">Application</span>\n    <span class="samples">\n      <span class="checkspan">\n        <input TYPE="RADIO" NAME="uisize" VALUE="large"/>\n        <span class="sample xlarge">Aa</span></span>\n      <span class="checkspan">\n        <input TYPE="RADIO" NAME="uisize" VALUE="normal"/>\n        <span class="sample normal">Aa</span></span>\n      <span class="checkspan">\n        <input TYPE="RADIO" NAME="uisize" VALUE="small"/>\n        <span class="sample small">Aa</span></span>\n    </span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="animation">\n    <span class="label smaller">Animate</span>\n    <span class="checkspan">\n      <input TYPE="CHECKBOX" NAME="animatecontent" VALUE="yes"/>\n      <span class="checktext">content (page flips, etc)</span></span>\n    <span class="checkspan">\n      <input TYPE="CHECKBOX" NAME="animatehud" VALUE="yes"/>\n      <span class="checktext">interface (overlays, controls, etc)</span></span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="header dataheader cf">\n    <button NAME="CLEARDATA" VALUE="ALL">Erase all</button>\n    <span class="label">Storage</span>\n  </div>\n  <div class="checkspan syncloc cf">\n    <button id="METABOOKRESETSYNC" name="SYNC" VALUE="RESET"\n            class="reset floatright"\n            title="Reset synchronized location information.">\n      <img src="{{bmg}}metabook/reset.svgz" \n           onerror="this.src=\'{{bmg}}metabook/reset50x50.png" alt=""/>\n      Reset</button>\n    <input TYPE="CHECKBOX" NAME="locsync" VALUE="yes"/>\n    <span class="checktext">\n      Sync your <strong>reading location</strong> with other devices</span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="checkspan saveglosses cf">\n    <button id="METABOOKREFRESHOFFLINE" class="refresh floatright"\n            title="Reload glosses and layers for this book from the cloud.">\n      <img src="{{bmg}}metabook/refresh.svgz" \n           onerror="this.error=\'{{bmg}}metabook/refresh50x50.png" alt=""/>\n      Reload</button>\n    <input TYPE="CHECKBOX" NAME="cacheglosses" VALUE="yes" CHECKED/>\n    <span class="checktext">\n      Save copies of <strong>glosses</strong>\n      and <strong>layers</strong> on this device</span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="checkspan showconsole cf">\n    <span class="label">Developer</span>\n    <input TYPE="CHECKBOX" NAME="showconsole" VALUE="yes"/>\n    <span class="checktext">Show the application console</span>\n  </div>\n  <div class="clearfloats"></div>\n  <div class="info" id="METABOOKINFOPANEL">\n    <span class="label">Info</span>\n    <p class="metabookrefinfo"></p>\n    <p class="metabooksourceinfo"></p>\n    <p class="metabookbuildinfo"></p>\n    <p class="metabookappinfo"></p>\n    <p class="metabookserverinfo"></p>\n  </div>\n  <div class="metabookcopyright">\n    <p class="metabookcopyrightinfo"></p>\n  </div>\n\n</form>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';fdjt.revision="1.5-1562-geb59d45";fdjt.buildhost="moby.dc.beingmeta.com";fdjt.buildtime="Sat Mar 5 14:31:20 EST 2016";fdjt.builduuid="fcba98bb-5c19-476c-9270-ff9fe921cf0c";Knodule.version="v0.8-156-ga7eef6e";metaBook.version="v0.8-260-gc023e3f";metaBook.buildid="37d2b2bf-ca21-484e-abf3-bdc2570f5cb3";metaBook.buildtime="Sat Mar  5 15:04:18 EST 2016";metaBook.buildhost="moby.dc.beingmeta.com";
