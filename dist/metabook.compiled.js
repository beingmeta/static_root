var fdjt_revision="1.5-1296-g5043d74",fdjt_buildhost="moby.dot.beingmeta.com",fdjt_buildtime="Mon Feb 23 09:24:22 EST 2015",fdjt_builduuid="b1823e5c-6d88-459a-9ac7-b443b6eef009";var fdjt_versions=fdjt_versions||[];fdjt_versions.decl=function(a,r){if(!fdjt_versions[a]||fdjt_versions[a]<r)fdjt_versions[a]=r};Array.prototype.indexOf||(Array.prototype.indexOf=function(a,r){r||(r=0);for(var g=this.length;r<g;){if(this[r]===a)return r;r++}return-1});Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var r=[],g;for(g in a)Object.prototype.hasOwnProperty.call(a,g)&&r.push(g);return r});
String.prototype.trim||(String.prototype.trim=function(){var a=/^\s+/,r=/\s+$/;return function(){return this.replace(a,"").replace(r,"")}}());var fdjt="undefined"===typeof fdjt?{}:fdjt;fdjt.revision=fdjt_revision;fdjt.buildhost=fdjt_buildhost;fdjt.buildtime=fdjt_buildtime;fdjt.builduuid=fdjt_builduuid;(function(){function a(a,b){return function(){a.apply(b,arguments)}}function r(b){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");if("function"!==typeof b)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];p(b,a(m,this),a(k,this))}function g(a){var d=this;null===this._state?this._deferreds.push(a):b(function(){var c=d._state?a.onFulfilled:a.onRejected;if(null===c)(d._state?a.resolve:a.reject)(d._value);else{var b;try{b=c(d._value)}catch(f){a.reject(f);
return}a.resolve(b)}})}function m(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"===typeof b||"function"===typeof b)){var d=b.then;if("function"===typeof d){p(a(d,b),a(m,this),a(k,this));return}}this._state=!0;this._value=b;q.call(this)}catch(c){k.call(this,c)}}function k(a){this._state=!1;this._value=a;q.call(this)}function q(){for(var a=0,b=this._deferreds.length;a<b;a++)g.call(this,this._deferreds[a]);this._deferreds=null}function u(a,b,c,f){this.onFulfilled=
"function"===typeof a?a:null;this.onRejected="function"===typeof b?b:null;this.resolve=c;this.reject=f}function p(a,b,c){var f=!1;try{a(function(a){f||(f=!0,b(a))},function(a){f||(f=!0,c(a))})}catch(e){f||(f=!0,c(e))}}var f;f="object"===typeof window&&window?window:global;var b=r.immediateFn||f.setImmediate||function(a){setTimeout(a,1)},e=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};r.prototype["catch"]=function(a){return this.then(null,a)};r.prototype.then=
function(a,b){var c=this;return new r(function(f,e){g.call(c,new u(a,b,f,e))})};r.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&e(arguments[0])?arguments[0]:arguments);return new r(function(b,c){function f(k,H){try{if(H&&("object"===typeof H||"function"===typeof H)){var g=H.then;if("function"===typeof g){g.call(H,function(a){f(k,a)},c);return}}a[k]=H;0===--e&&b(a)}catch(x){c(x)}}if(0===a.length)return b([]);for(var e=a.length,k=0;k<a.length;k++)f(k,a[k])})};r.resolve=function(a){return a&&
"object"===typeof a&&a.constructor===r?a:new r(function(b){b(a)})};r.reject=function(a){return new r(function(b,c){c(a)})};r.race=function(a){return new r(function(b,c){for(var f=0,e=a.length;f<e;f++)a[f].then(b,c)})};"undefined"!==typeof module&&module.exports?module.exports=r:f.Promise||(f.Promise=r)})();fdjt.Async=fdjt.ASync=fdjt.async=function(){function a(a,g){return new Promise(function(m,p){setTimeout(function(){var f;try{f=g?a.call(null,g):a(),m(f)}catch(b){p(b)}},1)})}function r(){return(new Date).getTime()}function g(a,g,m,p,f,b){var e=!1;"number"!==typeof g&&(g=100);"number"!==typeof m&&(m=100);var l=0,d=a.length,c=function(){for(var z=r()+g,h=!1;l<d;){var B=a[l++];if(B){if("number"===typeof B){h=B;break}else try{B()}catch(v){b(v)}if(r()>z)break}}!(l<d)||f&&f()?(clearTimeout(e),e=!1,f(!1)):
e=setTimeout(c,h||m)};return c()}function m(a,g,m,p,f,b,e,l){var d=0,c=g.length,z=0,h=0,B=r(),v=!1;b||(b=100);e||(e=b);l||(l=0);var H=function(){try{var G=r(),x=G,y=G+b;for(m&&m(0===d?"start":"resume",d,c,z,h,B);d<c&&(x=r())<y;){var D=g[d];m&&(l&&0===d%l||d+1===c)&&m("element",d,c,D,h,x-B);a(D);m&&(l&&0===d%l||d+1===c)&&m("after",d,c,D,h+(r()-G),B,r()-x);d++}z+=1;if(d<c)h+=x-G,m&&m("suspend",d,c,z,h,B),v=setTimeout(H,e);else{x=r();h+=x-G;clearTimeout(v);v=!1;m&&m("finishing",d,c,z,h,B);var N=p&&r()-
x,x=r();h+=x-G;m&&m("done",d,c,z,h,B,N);p&&p.call&&p(g,x-B,h)}}catch(E){f&&f(E)}},v=setTimeout(H,e)}a.timeslice=function(a,q){q||(q={});var m=q.slice||100,p=q.space||100,f=q.stop||!1;return new Promise(function(b,e){g(a,m,p,f,b,e)})};a.slowmap=function(a,g,r){r||(r={});var p=r.slice,f=r.space,b=r.watchfn,e=r.watch,l=r.done;1>e&&(e*=g.length);return new Promise(function(d,c){m(a,g,b,l?function(){l();d&&d(g)}:d,c,p,f,e)})};return a}();fdjt.charnames={AElig:"\u00c6",Aacgr:"\u0386",Aacute:"\u00c1",Abreve:"\u0102",Acirc:"\u00c2",Acy:"\u0410",Agr:"\u0391",Agrave:"\u00c0",Alpha:"\u0391",Amacr:"\u0100",Aogon:"\u0104",Aring:"\u00c5",Atilde:"\u00c3",Auml:"\u00c4",Barwed:"\u2306",Bcy:"\u0411",Beta:"\u0392",Bgr:"\u0392",CHcy:"\u0427",Cacute:"\u0106",Cap:"\u22d2",Ccaron:"\u010c",Ccedil:"\u00c7",Ccirc:"\u0108",Cdot:"\u010a",Chi:"\u03a7",Cup:"\u22d3",DJcy:"\u0402",DScy:"\u0405",DZcy:"\u040f",Dagger:"\u2021",Dcaron:"\u010e",Dcy:"\u0414",Delta:"\u0394",
Dgr:"\u0394",Dot:"\u00a8",DotDot:"\u20dc",Dstrok:"\u0110",EEacgr:"\u0389",EEgr:"\u0397",ENG:"\u014a",ETH:"\u00d0",Eacgr:"\u0388",Eacute:"\u00c9",Ecaron:"\u011a",Ecirc:"\u00ca",Ecy:"\u042d",Edot:"\u0116",Egr:"\u0395",Egrave:"\u00c8",Emacr:"\u0112",Eogon:"\u0118",Epsilon:"\u0395",Eta:"\u0397",Euml:"\u00cb",Fcy:"\u0424",GJcy:"\u0403",Gamma:"\u0393",Gbreve:"\u011e",Gcedil:"\u0122",Gcirc:"\u011c",Gcy:"\u0413",Gdot:"\u0120",Gg:"\u22d9",Ggr:"\u0393",Gt:"\u226b",HARDcy:"\u042a",Hcirc:"\u0124",Hstrok:"\u0126",
IEcy:"\u0415",IJlig:"\u0132",IOcy:"\u0401",Iacgr:"\u038a",Iacute:"\u00cd",Icirc:"\u00ce",Icy:"\u0418",Idigr:"\u03aa",Idot:"\u0130",Igr:"\u0399",Igrave:"\u00cc",Imacr:"\u012a",Iogon:"\u012e",Iota:"\u0399",Itilde:"\u0128",Iukcy:"\u0406",Iuml:"\u00cf",Jcirc:"\u0134",Jcy:"\u0419",Jsercy:"\u0408",Jukcy:"\u0404",KHcy:"\u0425",KHgr:"\u03a7",KJcy:"\u040c",Kappa:"\u039a",Kcedil:"\u0136",Kcy:"\u041a",Kgr:"\u039a",LJcy:"\u0409",Lacute:"\u0139",Lambda:"\u039b",Larr:"\u219e",Lcaron:"\u013d",Lcedil:"\u013b",Lcy:"\u041b",
Lgr:"\u039b",Ll:"\u22d8",Lmidot:"\u013f",Lstrok:"\u0141",Lt:"\u226a",Mcy:"\u041c",Mgr:"\u039c",Mu:"\u039c",NJcy:"\u040a",Nacute:"\u0143",Ncaron:"\u0147",Ncedil:"\u0145",Ncy:"\u041d",Ngr:"\u039d",Ntilde:"\u00d1",Nu:"\u039d",OElig:"\u0152",OHacgr:"\u038f",OHgr:"\u03a9",Oacgr:"\u038c",Oacute:"\u00d3",Ocirc:"\u00d4",Ocy:"\u041e",Odblac:"\u0150",Ogr:"\u039f",Ograve:"\u00d2",Omacr:"\u014c",Omega:"\u03a9",Omicron:"\u039f",Oslash:"\u00d8",Otilde:"\u00d5",Ouml:"\u00d6",PHgr:"\u03a6",PSgr:"\u03a8",Pcy:"\u041f",
Pgr:"\u03a0",Phi:"\u03a6",Pi:"\u03a0",Prime:"\u2033",Psi:"\u03a8",Racute:"\u0154",Rarr:"\u21a0",Rcaron:"\u0158",Rcedil:"\u0156",Rcy:"\u0420",Rgr:"\u03a1",Rho:"\u03a1",SHCHcy:"\u0429",SHcy:"\u0428",SOFTcy:"\u042c",Sacute:"\u015a",Scaron:"\u0160",Scedil:"\u015e",Scirc:"\u015c",Scy:"\u0421",Sgr:"\u03a3",Sigma:"\u03a3",Sub:"\u22d0",Sup:"\u22d1",THORN:"\u00de",THgr:"\u0398",TSHcy:"\u040b",TScy:"\u0426",Tau:"\u03a4",Tcaron:"\u0164",Tcedil:"\u0162",Tcy:"\u0422",Tgr:"\u03a4",Theta:"\u0398",Tstrok:"\u0166",
Uacgr:"\u038e",Uacute:"\u00da",Ubrcy:"\u040e",Ubreve:"\u016c",Ucirc:"\u00db",Ucy:"\u0423",Udblac:"\u0170",Ugr:"\u03a5",Ugrave:"\u00d9",Umacr:"\u016a",Uogon:"\u0172",Upsi:"\u03a5",Upsilon:"\u03a5",Uring:"\u016e",Utilde:"\u0168",Uuml:"\u00dc",Vcy:"\u0412",Vdash:"\u22a9",Verbar:"\u2016",Vvdash:"\u22aa",Wcirc:"\u0174",Xgr:"\u039e",Xi:"\u039e",YAcy:"\u042f",YIcy:"\u0407",YUcy:"\u042e",Yacute:"\u00dd",Ycirc:"\u0176",Ycy:"\u042b",Yuml:"\u0178",ZHcy:"\u0416",Zacute:"\u0179",Zcaron:"\u017d",Zcy:"\u0417",Zdot:"\u017b",
Zeta:"\u0396",Zgr:"\u0396",aacgr:"\u03ac",aacute:"\u00e1",abreve:"\u0103",acirc:"\u00e2",acute:"\u00b4",acy:"\u0430",aelig:"\u00e6",agr:"\u03b1",agrave:"\u00e0",alefsym:"\u2135",aleph:"\u2135",alpha:"\u03b1",amacr:"\u0101",amalg:"\u2210",amp:"&",and:"\u2227",ang:"\u2220",ang90:"\u221f",angmsd:"\u2221",angsph:"\u2222",angst:"\u212b",aogon:"\u0105",ap:"\u2248",ape:"\u224a",apos:"'",aposmod:"\u02bc",aring:"\u00e5",ast:"*",asymp:"\u2248",atilde:"\u00e3",auml:"\u00e4","b.Delta":"\u0394","b.Gamma":"\u0393",
"b.Lambda":"\u039b","b.Omega":"\u03a9","b.Phi":"\u03a6","b.Pi":"\u03a0","b.Psi":"\u03a8","b.Sigma":"\u03a3","b.Theta":"\u0398","b.Upsi":"\u03a5","b.Xi":"\u039e","b.alpha":"\u03b1","b.beta":"\u03b2","b.chi":"\u03c7","b.delta":"\u03b4","b.epsi":"\u03b5","b.epsis":"\u03b5","b.epsiv":"\u03b5","b.eta":"\u03b7","b.gamma":"\u03b3","b.gammad":"\u03dc","b.iota":"\u03b9","b.kappa":"\u03ba","b.kappav":"\u03f0","b.lambda":"\u03bb","b.mu":"\u03bc","b.nu":"\u03bd","b.omega":"\u03ce","b.phis":"\u03c6","b.phiv":"\u03d5",
"b.pi":"\u03c0","b.piv":"\u03d6","b.psi":"\u03c8","b.rho":"\u03c1","b.rhov":"\u03f1","b.sigma":"\u03c3","b.sigmav":"\u03c2","b.tau":"\u03c4","b.thetas":"\u03b8","b.thetav":"\u03d1","b.upsi":"\u03c5","b.xi":"\u03be","b.zeta":"\u03b6",barwed:"\u22bc",bcong:"\u224c",bcy:"\u0431",bdquo:"\u201e",becaus:"\u2235",bepsi:"\u220d",bernou:"\u212c",beta:"\u03b2",beth:"\u2136",bgr:"\u03b2",blackstar:"\u2726",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bottom:"\u22a5",bowtie:"\u22c8",
boxDL:"\u2557",boxDR:"\u2554",boxDl:"\u2556",boxDr:"\u2553",boxH:"\u2550",boxHD:"\u2566",boxHU:"\u2569",boxHd:"\u2564",boxHu:"\u2567",boxUL:"\u255d",boxUR:"\u255a",boxUl:"\u255c",boxUr:"\u2559",boxV:"\u2551",boxVH:"\u256c",boxVL:"\u2563",boxVR:"\u2560",boxVh:"\u256b",boxVl:"\u2562",boxVr:"\u255f",boxdL:"\u2555",boxdR:"\u2552",boxdl:"\u2510",boxdr:"\u250c",boxh:"\u2500",boxhD:"\u2565",boxhU:"\u2568",boxhd:"\u252c",boxhu:"\u2534",boxuL:"\u255b",boxuR:"\u2558",boxul:"\u2518",boxur:"\u2514",boxv:"\u2502",
boxvH:"\u256a",boxvL:"\u2561",boxvR:"\u255e",boxvh:"\u253c",boxvl:"\u2524",boxvr:"\u251c",bprime:"\u2035",breve:"\u02d8",brvbar:"\u00a6",bsim:"\u223d",bsime:"\u22cd",bsol:"\\",bull:"\u2022",bump:"\u224e",bumpe:"\u224f",cacute:"\u0107",cap:"\u2229",caret:"\u2041",caron:"\u02c7",ccaron:"\u010d",ccedil:"\u00e7",ccirc:"\u0109",cdot:"\u010b",cedil:"\u00b8",cent:"\u00a2",chcy:"\u0447",check:"\u2713",chi:"\u03c7",cir:"\u25cb",circ:"\u02c6",cire:"\u2257",clubs:"\u2663",colon:":",colone:"\u2254",comma:",",
commat:"@",comp:"\u2201",compfn:"\u2218",cong:"\u2245",conint:"\u222e",coprod:"\u2210",copy:"\u00a9",copysr:"\u2117",crarr:"\u21b5",cross:"\u2717",cuepr:"\u22de",cuesc:"\u22df",cularr:"\u21b6",cup:"\u222a",cupre:"\u227c",curarr:"\u21b7",curren:"\u00a4",cuvee:"\u22ce",cuwed:"\u22cf",dArr:"\u21d3",dagger:"\u2020",daleth:"\u2138",darr:"\u2193",darr2:"\u21ca",dash:"\u2010",dashv:"\u22a3",dblac:"\u02dd",dcaron:"\u010f",dcy:"\u0434",deg:"\u00b0",delta:"\u03b4",dgr:"\u03b4",dharl:"\u21c3",dharr:"\u21c2",
diam:"\u22c4",diams:"\u2666",die:"\u00a8",divide:"\u00f7",divonx:"\u22c7",djcy:"\u0452",dlarr:"\u2199",dlcorn:"\u231e",dlcrop:"\u230d",dollar:"$",dot:"\u02d9",drarr:"\u2198",drcorn:"\u231f",drcrop:"\u230c",dscy:"\u0455",dstrok:"\u0111",dtri:"\u25bf",dtrif:"\u25be",dzcy:"\u045f",eDot:"\u2251",eacgr:"\u03ad",eacute:"\u00e9",ecaron:"\u011b",ecir:"\u2256",ecirc:"\u00ea",ecolon:"\u2255",ecy:"\u044d",edot:"\u0117",eeacgr:"\u03ae",eegr:"\u03b7",efDot:"\u2252",egr:"\u03b5",egrave:"\u00e8",egs:"\u22dd",ell:"\u2113",
els:"\u22dc",emacr:"\u0113",empty:"\u2205",emsp:"\u2003",emsp13:"\u2004",emsp14:"\u2005",eng:"\u014b",ensp:"\u2002",eogon:"\u0119",epsi:"\u03b5",epsilon:"\u03b5",epsis:"\u220a",epsiv:"\u03bf",equals:"=",equiv:"\u2261",erDot:"\u2253",esdot:"\u2250",eta:"\u03b7",eth:"\u00f0",euml:"\u00eb",euro:"\u20ac",excl:"!",exist:"\u2203",fcy:"\u0444",female:"\u2640",ffilig:"\ufb03",fflig:"\ufb00",ffllig:"\ufb04",filig:"\ufb01",flat:"\u266d",fllig:"\ufb02",fnof:"\u0192",forall:"\u2200",fork:"\u22d4",frac12:"\u00bd",
frac13:"\u2153",frac14:"\u00bc",frac15:"\u2155",frac16:"\u2159",frac18:"\u215b",frac23:"\u2154",frac25:"\u2156",frac34:"\u00be",frac35:"\u2157",frac38:"\u215c",frac45:"\u2158",frac56:"\u215a",frac58:"\u215d",frac78:"\u215e",frasl:"\u2044",frown:"\u2322",gE:"\u2267",gEl:"\u2a8c",gacute:"\u01f5",gamma:"\u03b3",gammad:"\u03dc",gap:"\u2a86",gbreve:"\u011f",gcedil:"\u0123",gcirc:"\u011d",gcy:"\u0433",gdot:"\u0121",ge:"\u2265",gel:"\u22db",ges:"\u2265",ggr:"\u03b3",gimel:"\u2137",gjcy:"\u0453",gl:"\u2277",
gnE:"\u2269",gnap:"\u2a8a",gne:"\u2269",gnsim:"\u22e7",grave:"`",gsdot:"\u22d7",gsim:"\u2273",gt:">",gvnE:"\u2269",hArr:"\u21d4",hairsp:"\u200a",half:"\u00bd",hamilt:"\u210b",hardcy:"\u044a",harr:"\u2194",harrw:"\u21ad",hcirc:"\u0125",hearts:"\u2665",hellip:"\u2026",horbar:"\u2015",hstrok:"\u0127",hybull:"\u2043",hyphen:"-",iacgr:"\u03af",iacute:"\u00ed",icirc:"\u00ee",icy:"\u0438",idiagr:"\u0390",idigr:"\u03ca",iecy:"\u0435",iexcl:"\u00a1",iff:"\u21d4",igr:"\u03b9",igrave:"\u00ec",ijlig:"\u0133",
imacr:"\u012b",image:"\u2111",incare:"\u2105",infin:"\u221e",inodot:"\u0131","int":"\u222b",intcal:"\u22ba",iocy:"\u0451",iogon:"\u012f",iota:"\u03b9",iquest:"\u00bf",isin:"\u2208",itilde:"\u0129",iukcy:"\u0456",iuml:"\u00ef",jcirc:"\u0135",jcy:"\u0439",jsercy:"\u0458",jukcy:"\u0454",kappa:"\u03ba",kappav:"\u03f0",kcedil:"\u0137",kcy:"\u043a",kgr:"\u03ba",kgreen:"\u0138",khcy:"\u0445",khgr:"\u03c7",kjcy:"\u045c",lAarr:"\u21da",lArr:"\u21d0",lE:"\u2266",lEg:"\u2a8b",lacute:"\u013a",lagran:"\u2112",
lambda:"\u03bb",lang:"\u2329",lap:"\u2a85",laquo:"\u00ab",larr:"\u2190",larr2:"\u21c7",larrhk:"\u21a9",larrlp:"\u21ab",larrtl:"\u21a2",lcaron:"\u013e",lcedil:"\u013c",lceil:"\u2308",lcub:"{",lcy:"\u043b",ldot:"\u22d6",ldquo:"\u201c",ldquor:"\u201e",le:"\u2264",leg:"\u22da",les:"\u2264",lfloor:"\u230a",lg:"\u2276",lgr:"\u03bb",lhard:"\u21bd",lharu:"\u21bc",lhblk:"\u2584",ljcy:"\u0459",lmidot:"\u0140",lnE:"\u2268",lnap:"\u2a89",lne:"\u2268",lnsim:"\u22e6",lowast:"\u2217",lowbar:"_",loz:"\u25ca",lozf:"\u2726",
lpar:"(",lrarr2:"\u21c6",lrhar2:"\u21cb",lrm:"\u200e",lsaquo:"\u2039",lsh:"\u21b0",lsim:"\u2272",lsqb:"[",lsquo:"\u2018",lsquor:"\u201a",lstrok:"\u0142",lt:"<",lthree:"\u22cb",ltimes:"\u22c9",ltri:"\u25c3",ltrie:"\u22b4",ltrif:"\u25c2",lvnE:"\u2268",macr:"\u00af",male:"\u2642",malt:"\u2720",map:"\u21a6",marker:"\u25ae",mcy:"\u043c",mdash:"\u2014",mgr:"\u03bc",micro:"\u00b5",mid:"\u2223",middot:"\u00b7",minus:"\u2212",minusb:"\u229f",mldr:"\u2026",mnplus:"\u2213",models:"\u22a7",mu:"\u03bc",mumap:"\u22b8",
nVDash:"\u22af",nVdash:"\u22ae",nabla:"\u2207",nacute:"\u0144",nap:"\u2249",napos:"\u0149",natur:"\u266e",nbsp:"\u00a0",ncaron:"\u0148",ncedil:"\u0146",ncong:"\u2247",ncy:"\u043d",ndash:"\u2013",ne:"\u2260",nearr:"\u2197",nequiv:"\u2262",nexist:"\u2204",nge:"\u2271",nges:"\u2271",ngr:"\u03bd",ngt:"\u226f",nhArr:"\u21ce",nharr:"\u21ae",ni:"\u220b",njcy:"\u045a",nlArr:"\u21cd",nlarr:"\u219a",nldr:"\u2025",nle:"\u2270",nles:"\u2270",nlt:"\u226e",nltri:"\u22ea",nltrie:"\u22ec",nmid:"\u2224",not:"\u00ac",
notin:"\u2209",npar:"\u2226",npr:"\u2280",npre:"\u22e0",nrArr:"\u21cf",nrarr:"\u219b",nrtri:"\u22eb",nrtrie:"\u22ed",nsc:"\u2281",nsce:"\u22e1",nsim:"\u2241",nsime:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsub:"\u2284",nsubE:"\u2288",nsube:"\u2288",nsup:"\u2285",nsupE:"\u2289",nsupe:"\u2289",ntilde:"\u00f1",nu:"\u03bd",num:"#",numero:"\u2116",numsp:"\u2007",nvDash:"\u22ad",nvdash:"\u22ac",oS:"\u24c8",oacgr:"\u03cc",oacute:"\u00f3",oast:"\u229b",ocir:"\u229a",ocirc:"\u00f4",ocy:"\u043e",odash:"\u229d",
odblac:"\u0151",odot:"\u2299",oelig:"\u0153",ogon:"\u02db",ogr:"\u03bf",ograve:"\u00f2",ohacgr:"\u03ce",ohgr:"\u03c9",ohm:"\u2126",olarr:"\u21ba",oline:"\u203e",omacr:"\u014d",omega:"\u03c9",omicron:"\u03bf",ominus:"\u2296",oplus:"\u2295",or:"\u2228",orarr:"\u21bb",order:"\u2134",ordf:"\u00aa",ordm:"\u00ba",oslash:"\u00f8",osol:"\u2298",otilde:"\u00f5",otimes:"\u2297",ouml:"\u00f6",par:"\u2225",para:"\u00b6",part:"\u2202",pcy:"\u043f",percnt:"%",period:".",permil:"\u2030",perp:"\u22a5",pgr:"\u03c0",
phgr:"\u03c6",phi:"\u03c6",phis:"\u03c6",phiv:"\u03d5",phmmat:"\u2133",phone:"\u260e",pi:"\u03c0",piv:"\u03d6",planck:"\u210f",plus:"+",plusb:"\u229e",plusdo:"\u2214",plusmn:"\u00b1",pound:"\u00a3",pr:"\u227a",prap:"\u2ab7",pre:"\u227c",prime:"\u2032",prnE:"\u2ab5",prnap:"\u2ab9",prnsim:"\u22e8",prod:"\u220f",prop:"\u221d",prsim:"\u227e",psgr:"\u03c8",psi:"\u03c8",puncsp:"\u2008",quest:"?",quot:'"',rAarr:"\u21db",rArr:"\u21d2",racute:"\u0155",radic:"\u221a",rang:"\u232a",raquo:"\u00bb",rarr:"\u2192",
rarr2:"\u21c9",rarrhk:"\u21aa",rarrlp:"\u21ac",rarrtl:"\u21a3",rarrw:"\u219d",rcaron:"\u0159",rcedil:"\u0157",rceil:"\u2309",rcub:"}",rcy:"\u0440",rdquo:"\u201d",rdquor:"\u201c",real:"\u211c",rect:"\u25ad",reg:"\u00ae",rfloor:"\u230b",rgr:"\u03c1",rhard:"\u21c1",rharu:"\u21c0",rho:"\u03c1",rhov:"\u03f1",ring:"\u02da",rlarr2:"\u21c4",rlhar2:"\u21cc",rlm:"\u200f",rpar:")",rpargt:"\u2994",rsaquo:"\u203a",rsh:"\u21b1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2018",rthree:"\u22cc",rtimes:"\u22ca",rtri:"\u25b9",
rtrie:"\u22b5",rtrif:"\u25b8",rx:"\u211e",sacute:"\u015b",samalg:"\u2210",sbquo:"\u201a",sbsol:"\\",sc:"\u227b",scap:"\u2ab8",scaron:"\u0161",sccue:"\u227d",sce:"\u227d",scedil:"\u015f",scirc:"\u015d",scnE:"\u2ab6",scnap:"\u2aba",scnsim:"\u22e9",scsim:"\u227f",scy:"\u0441",sdot:"\u22c5",sdotb:"\u22a1",sect:"\u00a7",semi:";",setmn:"\u2216",sext:"\u2736",sfgr:"\u03c2",sfrown:"\u2322",sgr:"\u03c3",sharp:"\u266f",shchcy:"\u0449",shcy:"\u0448",shy:"\u00ad",sigma:"\u03c3",sigmaf:"\u03c2",sigmav:"\u03c2",
sim:"\u223c",sime:"\u2243",smid:"\u2223",smile:"\u2323",softcy:"\u044c",sol:"/",spades:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcup:"\u2294",sqsub:"\u228f",sqsube:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",squ:"\u25a1",square:"\u25a1",squf:"\u25aa",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22c6",star:"\u2606",starf:"\u2605",sub:"\u2282",subE:"\u2286",sube:"\u2286",subnE:"\u228a",subne:"\u228a",sum:"\u2211",sung:"\u266a",sup:"\u2283",sup1:"\u00b9",sup2:"\u00b2",sup3:"\u00b3",supE:"\u2287",supe:"\u2287",
supnE:"\u228b",supne:"\u228b",szlig:"\u00df",target:"\u2316",tau:"\u03c4",tcaron:"\u0165",tcedil:"\u0163",tcy:"\u0442",tdot:"\u20db",telrec:"\u2315",tgr:"\u03c4",there4:"\u2234",theta:"\u03b8",thetas:"\u03b8",thetasym:"\u03d1",thetav:"\u03d1",thgr:"\u03b8",thinsp:"\u2009",thkap:"\u2248",thksim:"\u223c",thorn:"\u00fe",tilde:"\u02dc",times:"\u00d7",timesb:"\u22a0",top:"\u22a4",tprime:"\u2034",trade:"\u2122",trie:"\u225c",tscy:"\u0446",tshcy:"\u045b",tstrok:"\u0167",twixt:"\u226c",uArr:"\u21d1",uacgr:"\u03cd",
uacute:"\u00fa",uarr:"\u2191",uarr2:"\u21c8",ubrcy:"\u045e",ubreve:"\u016d",ucirc:"\u00fb",ucy:"\u0443",udblac:"\u0171",udiagr:"\u03b0",udigr:"\u03cb",ugr:"\u03c5",ugrave:"\u00f9",uharl:"\u21bf",uharr:"\u21be",uhblk:"\u2580",ulcorn:"\u231c",ulcrop:"\u230f",umacr:"\u016b",uml:"\u00a8",uogon:"\u0173",uplus:"\u228e",upsi:"\u03c5",upsih:"\u03d2",upsilon:"\u03c5",urcorn:"\u231d",urcrop:"\u230e",uring:"\u016f",utilde:"\u0169",utri:"\u25b5",utrif:"\u25b4",uuml:"\u00fc",vArr:"\u21d5",vDash:"\u22a8",varr:"\u2195",
vcy:"\u0432",vdash:"\u22a2",veebar:"\u22bb",vellip:"\u22ee",verbar:"|",vltri:"\u22b2",vprime:"\u2032",vprop:"\u221d",vrtri:"\u22b3",vsubnE:"\u228a",vsubne:"\u228a",vsupnE:"\u228b",vsupne:"\u228b",wcirc:"\u0175",wedgeq:"\u2259",weierp:"\u2118",whitestar:"\u2727",wreath:"\u2240",xcirc:"\u25cb",xdtri:"\u25bd",xgr:"\u03be",xhArr:"\u2194",xharr:"\u2194",xi:"\u03be",xlArr:"\u21d0",xrArr:"\u21d2",xutri:"\u25b3",yacute:"\u00fd",yacy:"\u044f",ycirc:"\u0177",ycy:"\u044b",yen:"\u00a5",yicy:"\u0457",yucy:"\u044e",
yuml:"\u00ff",zacute:"\u017a",zcaron:"\u017e",zcy:"\u0437",zdot:"\u017c",zeta:"\u03b6",zgr:"\u03b6",zhcy:"\u0436",zwj:"\u200d",zwnj:"\u200c"};fdjt.String=function(){function a(c){if("string"!==typeof c&&!(c instanceof String))return r(c);for(var b="",d,f=c.indexOf("%"),e=1;0<=f;){0<f&&(b+=c.slice(0,f));if("%"===c[f+1])b+="%";else if("o"===c[f+1])if(d=arguments[e++],"string"===typeof d)b=b+"'"+d+"'";else if("number"===typeof d)b+=d;else if(Array.isArray(d)){for(var h=0,l=d.length,b=b+"[";h<l;)b=b+(0<h?",":"")+r(d[h++]);b+="]"}else b+=r(d);else if("j"===c[f+1])if(d=arguments[e++],Array.isArray(d))for(h=0,l=d.length,b+="[";h<l;)b=b+(0<h?",":
"")+JSON.stringify(d[h++]);else if("object"===typeof d){h=!1;try{h=JSON.stringify(d)}catch(k){var h={},z;for(z in d)if(d.hasOwnProperty(z)){var l=d[z],L;if(Array.isArray(l)){L=[];for(var g=0,v=l.length;g<v;){var B=l[g++],t;try{t=a(B)}catch(Q){t=B.toString()}L.push(t)}}else try{L=a(l)}catch(q){L=l.toString()}h[z]=L}h=JSON.stringify(h)}b+=h}else b+=JSON.stringify(d);else"x"===c[f+1]&&"number"===typeof arguments[e]&&0<=arguments[e]&&0<=arguments[e]%1?(d=arguments[e++],b+=d.toString(16)):arguments[e]?
b+=arguments[e++]:"undefined"===typeof arguments[e]?(b+="?undef?",e++):b+=arguments[e++];c=c.slice(f+2);f=c.indexOf("%")}return b+c}function r(a){if("undefined"===typeof a)return"?undef?";if(a){if("number"===typeof a)return""+a;if(a.tagName){var c="["+a.tagName;a.className&&(c=c+"."+a.className.replace(/\s+/g,"."));a.id&&(c=c+"#"+a.id);a.name&&(c=c+"[name="+a.name+"]");(a=a.innerText?a.innerText.trim():k(a.innerHTML).trim())&&0!==a.length&&(c=32>a.length?c+"'"+a.replace(/\n/g,"\\n")+"'":c+"'"+a.slice(0,
16).replace(/\n/g,"\\n")+"'...");return c+"]"}if(a.nodeType)return 3===a.nodeType?'["'+a.nodeValue+'"]':"<"+a.nodeType+">";if(a.oid)return a.oid;if(a._fdjtid)return"#@"+a._fdjtid;if(a.type&&(a.target||a.srcElement)){var c=a.clientX,b=a.clientY,d="["+a.type+"@"+r(a.target||a.srcElement)+"(m="+((!0===a.shiftKey?"s":"")+(!0===a.ctrlKey?"c":"")+(!0===a.metaKey?"m":"")+(!0===a.altKey?"a":"")+("undefined"!==typeof a.button?",b="+a.button:"")+("undefined"!==typeof a.which?",w="+a.which:""));if("number"===
typeof c||"number"===typeof b)d=d+",cx="+c+",cy="+b;a.touches&&(d=d+",touches="+a.touches.length);a.keyCode&&(d=d+",kc="+a.keyCode);a.charCode&&(d=d+",cc="+a.charCode);return d+")]"}return""+a}return a}function g(a){var c=0,b=a.length;if(0>=b)return a;for(;c<b&&-1<" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(c));)c++;if(c===b)return"";for(var d=b-1;d>c&&-1<" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(d));)d--;
return 0<c||d<b?a.slice(c,d+1):a}function m(a){a=a.replace(/\s+/g," ");var c=0,b=a.length;if(0>=b)return a;for(;c<b&&-1<" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(c));)c++;if(c===b)return"";for(var d=b-1;d>c&&-1<" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(d));)d--;return 0<
c||d<b?a.slice(c,d+1):a}function k(a){return a.replace(/<[^>]*>/g,"")}function q(a,c){return String.fromCharCode(parseInt(c,10))}function u(a,c){return String.fromCharCode(parseInt(c,16))}function p(a,c){return fdjt.charnames[c]||"&"+c+";"}function f(a,c){return B.hasOwnProperty(c)?B[c]:"&"+c+";"}function b(a,c){return 0===a.indexOf(c)}function e(a,c){if(a.indexOf)return 0<=a.indexOf(c);for(var b=0,d=a.length;b<d;){if(a[b]===c)return!0;b++}return!1}function l(a,c,b){var d=a.strings;if(b===c.length){if(d.indexOf?
0<=d.indexOf(c):e(d,c))return!1;d.push(c);return!0}if(a.splits){var f=c[b],h=a[f];h||(h={strings:[]},h.splitchar=f,a[f]=h,a.splits.push(h));return l(h,c,b+1)?(d.push(c),!0):!1}if(5>a.strings.length){if(d.indexOf?0<=d.indexOf(c):e(d,c))return!1;d.push(c);return!0}a.splits=[];d=a.strings;for(f=0;f<d.length;)l(a,d[f++],b);return l(a,c,b)}function d(a,c,f,e){e||(e=c.length);if(f===e)return a.strings;if(5>=a.strings.length){f=a.strings;e=[];for(a=0;a<f.length;){var h=f[a++];b(h,c)&&e.push(h)}return e.length?
e:!1}return(a=a[c[f]])?d(a,c,f+1,e):!1}function c(a){return(a+"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var z=/[^ \n\r\t\f\x0b\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff]/g;a.nbsp="\u00a0";a.middot="\u00b7";a.emdash="\u2013";a.endash="\u2014";a.lsq="\u2018";a.rsq="\u2019";a.ldq="\u201c";a.rdq="\u201d";a.truncate=function(a,c){c||(c=42);return a.length<c?a:a.slice(0,c)};var h=Math.floor;a.ellipsize=function(a,
c,b){var d,f;"number"!==typeof b&&(b=.1);if(!c)return a;if("number"!==typeof c)if(c.constructor===Array)d=c[0]||0,f=c[1]||0,c=f+d;else return a;if(c){if(a.length<c+h(b*c))return a;if(d&&f){var e=a.length;0!==/\s/.test(a[d])&&(c=a.slice(0,d),b=c.search(/\s+\w+$/),d=0<b?b:d);0===/\s/.test(a[e-f])?f=e-f:(c=a.slice(e-f),b=c.search(/\s+/),f=0<b?e-f+b:f);return[a.slice(0,d),a.slice(f)]}if(0===/\s/.test(a[c]))return a.slice(0,c);c=a.slice(0,c);b=c.search(/\s+\w+$/);return 0<b?c.slice(0,b):c}return a};a.isEmpty=
function(a){if("string"===typeof a){var c;if(0===a.length)return!0;c=a.search(z);if(0>c)return!0;if("&"!==a[c])return!1;a=a.replace(/&nbsp;/g,"\u00a0");c=a.search(z);return 0>c}return!1};a.findSplit=function(a,c,b){for(var d=0;0<=(d=a.indexOf(c,d));)if(b&&0<d&&a[d-1]===b)d+=1;else return d;return-1};a.split=function(a,c,b,d){if(d||b){for(var f=[],e=0,h;0<=(h=a.indexOf(c,e));)b&&0<h&&a[h-1]===b||(d&&h>e?f.push(d(a.slice(e,h))):h>e&&f.push(a.slice(e,h))),e=h+1;a.length>e&&(d?f.push(d(a.slice(e))):f.push(a.slice(e)));
return f}return a.split(c)};a.semiSplit=function(a,c,b){if(b||c){for(var d=[],f=0,e;0<=(e=a.indexOf(";",f));)c&&0<e&&a[e-1]===c||(b&&e>f?d.push(b(a.slice(f,e))):e>f&&d.push(a.slice(f,e))),f=e+1;a.length>f&&(b?d.push(b(a.slice(f))):d.push(a.slice(f)));return d}return a.split(";")};a.lineSplit=function(a,c,b){if(b||c){for(var d=[],f=0,e;0<=(e=a.indexOf("\n",f));)c&&0<e&&a[e-1]===c||(b&&e>f?d.push(b(a.slice(f,e))):e>f&&d.push(a.slice(f,e))),f=e+1;a.length>f&&(b?d.push(b(a.slice(f))):d.push(a.slice(f)));
return d}return a.split("\n")};a.trim=g;a.stdspace=m;a.stdcap=function(a){if(!(0<=a.search(/(^|\s)[ABCDEFGHIJKLMNOPQRSTUVWXYZ]/g)))return a.replace(/\s+/g," ").replace(/(^ | $)/g,"");a=a.split(/\s+/g);for(var c=0,b=a.length;c<b;){var d=a[c];0<=d.slice(1).search(/[ABCDEFGHIJKLMNOPQRSTUVWXYZ]/)||(a[c]=d[0].toUpperCase()+d.slice(1));c++}return a.join(" ")};a.flatten=function(a){return a.replace(/\s+/g," ")};a.oneline=function(a){a=g(a);return a.replace(/\s*[\f\n\r]+\s+/gm," //\u00b7 ").replace(/\s*[\f\n\r]+\s*/gm,
" // ").replace(/\s\s+/g,"")};a.stripMarkup=k;a.unEscape=function(a){return 0<=a.indexOf("\\")?a.replace(/\\(.)/g,"$1"):a};a.normString=function(a){return a.replace(/\W*\s\W*/g," ").toLowerCase()};var B={};a.entities=B;a.decodeEntities=function(a){return a.replace(/&#(\d+);/g,q).replace(/&#x([0123456789ABCDEFabcdef]+);/g,u).replace(/&([abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.]+)/g,p).replace(/&([A-Za-z][A-Za-z0-9-_.]+;)/g,f)};a.expandEntities=function(a){return a.replace(/&([A-Za-z][A-Za-z0-9-_.]+);/g,
f)};var v=/^\d+(\.\d+)$/;a.getMatch=function(a,c,b,d){a=c.exec(a);"undefined"===typeof b&&(b=0);return a&&a.length>b?d?a[b]:v.test(a[b])?parseFloat(a[b]):a[b]:!1};a.segment=function(a,c,b,d){b&&(a=a.slice(b));b=[];a=a.split(new RegExp("("+("string"===typeof c?c:c.source)+")","string"===typeof c?"":c.ignoreCase?"i":""));c=0;for(var f=a.length,e=!1;c<f;){var h=a[c++],l=a[c++];!h||0>h.search(/\S/)||(h.length&&"\\"===h.slice(-1)&&(2>h.length||"\\"!==h.slice(-2,-1))?(h=h.slice(0,-1)+l,e=e?e+h:h):e?(d?
b.push(e+h):b.push(m(e+h)),e=!1):d?b.push(h):b.push(m(h)))}return b};a.padNum=function(a,c,b){!b&&0>c&&(b=-c,c=0);c-=10>a?1:100>a?2:1E3>a?3:1E4>a?4:1E5>a?5:1E6>a?6:1E6>a?7:1E8>a?8:1E9>a?9:1E10>a?10:11;a=a.toString();var d=a.indexOf("."),f="",e="",h;if(b)if(0<=d&&d+b<a.length)a=a.slice(0,d+b+1);else if(0>d||a.length<d+b+1)for(h=0,b=d+b+1-a.length,0>d&&(e+=".");h<b;)e+="0",h++;switch(c){case 0:f="";break;case 1:f="0";break;case 2:f="00";break;case 3:f="000";break;case 4:f="0000";break;case 5:f="00000";
break;case 6:f="000000";break;case 7:f="0000000";break;case 8:f="00000000";break;case 9:f="000000000";break;case 10:f="0000000000";break;default:for(h=0;h<c;)f+="0",h++}return f+a+e};a.precString=function(a,c){var b=a.toString(),d="";if("number"===typeof c&&0<=c&&100>c){var f=b.indexOf(".");if(0<=f&&f+c<b.length)b=b.slice(0,f+c+1);else if(0>f||b.length<f+c+1){var e=0,h=f+c+1-b.length;for(0>f&&(d=".");e<=h;)d+="0",e++}}return b+d};a.getInitials=function(a){a=a.split(/\W/);for(var c="",b=0,d=a.length;b<
d;){var f=a[b++];f.length&&(c+=f.slice(0,1))}return c};a.hasPrefix=b;a.hasSuffix=function(a,c){return a.lastIndexOf(c)===a.length-c.length};a.commonPrefix=function(a,c,b,d){for(var f=0,e=-1;f<a.length&&f<c.length;)if(a[f]===c[f]||d&&a[f].toLowerCase()===c[f].toLowerCase())b?(b===a[f]&&(e=f-1),f++):e=f++;else break;return 0<=e?a.slice(0,e+1):!1};a.commonSuffix=function(a,c,b,d){for(var f=a.length,e=c.length,h=0;0<=f&&0<=e;)if(a[f]===c[e]||d&&a[f].toLowerCase()===c[f].toLowerCase())b?b===a[f]&&(h=f+
1):h=f,f--,e--;else break;return 0<h?a.slice(h):!1};a.stripSuffix=function(a){var c=a.search(/\.\w+$/);return 0<c?a.slice(0,c):a};a.prefixAdd=function(a,c,b){if("number"!==typeof b||0>b)b=0;return l(a,c,b)};a.prefixFind=function(a,c,b,f){if("number"!==typeof b||0>b)b=0;f||(f=c.length);return d(a,c,b,f)};a.paraHash=function(a){a=("string"===typeof a.innerText?a.innerText:k(a.innerHTML)).split(/\W*\S+\W*/g);var c=a.length;return"_H"+(0<c?a[0][0]:".")+(1<c?a[1][0]:".")+(2<c?a[2][0]:".")+(3<c?a[3][0]:
".")+(0<c?a[c-1][0]:".")+(1<c?a[c-2][0]:".")+(2<c?a[c-3][0]:".")+(3<c?a[c-4][0]:".")};a.escapeRegExp=c;a.escapeRX=c;a.templates={};a.fillIn=function(a,c){var b=!1;if("string"===typeof c){var d=c;c=a;a=d}!a&&c&&c.template?a=c.template:!c&&a.template&&(c=a,a=c.template);if("string"!==typeof a)if(3===a.nodeType)b=a,a=b.nodeValue;else if(1===a.nodeType)b=a,a=b.innerHTML;else{fdjt.Log.warn("Bad argument %o to Template",a);return}var d=a.match(/\{\{\w+(\|([^\}])*)?\}\}/gm),f={};if(d&&d.length)for(var e=
0,h=d.length;e<h;){var l=d[e++].slice(2,-2),k=l.search(/\|/),z=0<=k?l.slice(0,k):l;f[l]||f[z]||(c.hasOwnProperty(z)?(k=c[z],f[z]=l,k&&(a=a.replace(new RegExp("\\{\\{"+z+"(\\|[^\\}]*)?\\}\\}","gm"),k.toString()))):0<k?(z=l.slice(k+1),a=a.replace("{{"+l+"}}",z),f[l]=l):fdjt.Log.warn("No data for %s in %j to substitute for %s",z,c,"{{"+l+"}}"))}return b?(3===b.nodeType?b.nodeValue=a:b.innerHTML=a,b):a};return a}();fdjt.Time=function(){function a(){return(new Date).getTime()}function r(a){var g=new Date;"number"===typeof a&&(a=131592918600>a?new Date(1E3*a):new Date(a));if(43200<(g.getTime()-a.getTime())/1E3)return a.toDateString();var g=a.getHours(),m=a.getMinutes();return a.toDateString()+" ("+(10>g?"0":"")+g+":"+(0===m?"00":(10>m?"0":"")+m)+")"}var g=a.loaded=(new Date).getTime();a.tick=function(){return Math.floor((new Date).getTime()/1E3)};a.dateString=function(a){"number"===typeof a&&(a=131592918600>a?
new Date(1E3*a):new Date(a));return a.toDateString()};a.timeString=function(a){"number"===typeof a&&(a=131592918600>a?new Date(1E3*a):new Date(a));return a.toString()};a.shortString=r;a.tick2shortstring=function(a){return r(new Date(1E3*a))};a.tick2string=function(a){return(new Date(1E3*a)).toString()};a.tick2date=function(a){return(new Date(1E3*a)).toDateString()};a.tick2locale=function(a){return(new Date(1E3*a)).toLocaleString()};a.tick2time=function(a){return(new Date(1E3*a)).toTimeString()};var m=
fdjt.String;a.secs2string=function(a){var g,r;if(1>a)return m("%f seconds",a);if(1===a)return m("%f second",a);if(10>a)return m("%f seconds",a);if(60>a)return m("~%d seconds",Math.round(a/60));if(120>a)return g=Math.floor(a/60),a=Math.round(a-60*g),1===a?"one minute, one second":m("one minute, %d seconds",a);if(3600>a)return g=Math.floor(a/60),m("~%d minutes",g);if(7200>a)return g=Math.floor(a/3600),g=Math.round((a-3600*g)/60),1===g?"one hour and one minutes":m("one hour, %d minutes",g);if(86400>
a)return g=Math.floor(a/3600),m("~%d hours",g);if(172800>a)return g=Math.floor((a-86400)/3600),1===g?"one day and one hour":m("one day, %d hours",g);if(604800>a)return r=Math.floor(a/86400),m("%d days",r);if(1209600>a)return r=Math.floor((a-604800)/86400),1===r?"one week and one day":m("one week and %d days",r);g=Math.floor(a/604800);r=Math.round((a-604800*r)/604800);return m("%d weeks, %d days",g,r)};a.secs2short=function(a){if(.001>a)return Math.round(1E6*a)+"us";if(.1>a)return Math.round(1E3*a)+
"ms";if(120>a)return Math.round(100*a)/100+"s";var g=Math.floor(a/60);return g+"m, "+Math.round(100*(a-60*g))/100+"s"};a.runTimes=function(a,g){for(var m=g,p="",f=2;f<arguments.length;)var b=arguments[f++],e=arguments[f++],p=p+"; "+b+": "+(e.getTime()-m.getTime())/1E3+"s",m=e;return a+" "+(m.getTime()-g.getTime())/1E3+"s"+p};a.diffTime=function(a,g){g||(g=new Date);var m=a.getTime()-g.getTime();return 0<m?m/1E3:-(m/1E3)};a.ET=function(a){a||(a=new Date);return(a.getTime()-g)/1E3};a.timeslice=fdjt.Async.timeslice;
a.slowmap=fdjt.Async.slowmap;return a}();fdjt.ET=fdjt.Time.ET;fdjt.Template=function(){function a(g,m,k){var q=!1;if("string"===typeof m){var u=m;m=g;g=u}!g&&m&&m.template&&(g=m.template);if("string"!==typeof g)if(3===g.nodeType)q=g,g=q.nodeValue;else if(1===g.nodeType)q=g,g=q.innerHTML;else{fdjt.Log.warn("Bad argument %o to Template",g);return}a.localTemplates.hasOwnProperty(g)?g=a.localTemplates[g]:r.hasOwnProperty(g)&&(g=r[g]);var u=g.match(/\{\{\w+\}\}/gm),p={};if(u)for(var f=0,b=u.length;f<b;){var e=u[f++].slice(2,-2),l=new RegExp("\\{\\{"+e+"\\}\\}","gm");
if(!p[e])if(m.hasOwnProperty(e)||k&&k.hasOwnProperty(e)){var d=m[e]||k&&k[e]||"";p[e]=e;g=g.replace(l,d.toString())}else fdjt.Log.warn("No data for %s in %s to use in %s",e,m,g),p[e]=e}return q?(3===q.nodeType?q.nodeValue=g:q.innerHTML=g,q):g}var r={};fdjt.Templates=r;a.localTemplates={};a.toDOM=function(g,m,k){g=a(g,m);m=k?k.nodeType?k:"string"===typeof k?document.createElement(k):document.createElement("div"):document.createElement("div");m.innerHTML=g;if(k&&k.nodeType)return m;if(m.childNodes){if(1===
m.childNodes.length)return m.childNodes[0];k=document.createDocumentFragment;g=[];m=m.childNodes;for(var q=0,r=m.length;q<r;)g.push(m[q++]);for(q=0;q<r;)k.appendChild(g[q++]);return k}return!1};return a}();fdjt.Hash||(fdjt.Hash=function(){function a(a){var c=Array(a.length>>2),b;for(b=0;b<c.length;b++)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(a.charCodeAt(b/8)&255)<<24-b%32;return c}function r(a){for(var c="",b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>24-b%32&255);return c}function g(a,c){"undefined"===typeof c&&(c=Z);for(var b=c?"0123456789ABCDEF":"0123456789abcdef",d="",n,f=0;f<a.length;f++)n=a.charCodeAt(f),d+=b.charAt(n>>>4&15)+b.charAt(n&15);return d}function m(a,c){c||(c=ja);for(var b=
"",d=a.length,n=0;n<d;n+=3)for(var f=a.charCodeAt(n)<<16|(n+1<d?a.charCodeAt(n+1)<<8:0)|(n+2<d?a.charCodeAt(n+2):0),e=0;4>e;e++)b=8*n+6*e>8*a.length?b+c:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>6*(3-e)&63);return b}function k(a,c){if(!c)return U?U(a):g(a);var b=c.length,n,d,f,e,h,w=Array(Math.ceil(a.length/2));for(n=0;n<w.length;n++)w[n]=a.charCodeAt(2*n)<<8|a.charCodeAt(2*n+1);var t=Math.ceil(8*a.length/(Math.log(c.length)/Math.log(2))),l=Array(t);for(d=0;d<
t;d++){h=[];for(n=e=0;n<w.length;n++)if(e=(e<<16)+w[n],f=Math.floor(e/b),e-=f*b,0<h.length||0<f)h[h.length]=f;l[d]=e;w=h}b="";for(n=l.length-1;0<=n;n--)b+=c.charAt(l[n]);return b}function q(a){for(var c="",b=-1,n,d;++b<a.length;)n=a.charCodeAt(b),d=b+1<a.length?a.charCodeAt(b+1):0,55296<=n&&56319>=n&&56320<=d&&57343>=d&&(n=65536+((n&1023)<<10)+(d&1023),b++),127>=n?c+=String.fromCharCode(n):2047>=n?c+=String.fromCharCode(192|n>>>6&31,128|n&63):65535>=n?c+=String.fromCharCode(224|n>>>12&15,128|n>>>
6&63,128|n&63):2097151>=n&&(c+=String.fromCharCode(240|n>>>18&7,128|n>>>12&63,128|n>>>6&63,128|n&63));return c}function u(a){var c=Array(a.length>>2),b;for(b=0;b<c.length;b++)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(a.charCodeAt(b/8)&255)<<b%32;return c}function p(a){for(var c="",b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function f(a,c){var b=(a&65535)+(c&65535);return(a>>16)+(c>>16)+(b>>16)<<16|b&65535}function b(a,c){return a<<c|a>>>32-c}function e(a){return p(d(u(a),
8*a.length))}function l(a,c){var b=u(a);16<b.length&&(b=d(b,8*a.length));for(var n=Array(16),f=Array(16),e=0;16>e;e++)n[e]=b[e]^909522486,f[e]=b[e]^1549556828;b=d(n.concat(u(c)),512+8*c.length);return p(d(f.concat(b),640))}function d(a,b){a[b>>5]|=128<<b%32;a[(b+64>>>9<<4)+14]=b;for(var n=1732584193,d=-271733879,e=-1732584194,w=271733878,t=0;t<a.length;t+=16)var l=n,sa=d,J=e,g=w,n=z(n,d,e,w,a[t+0],7,-680876936),w=z(w,n,d,e,a[t+1],12,-389564586),e=z(e,w,n,d,a[t+2],17,606105819),d=z(d,e,w,n,a[t+3],
22,-1044525330),n=z(n,d,e,w,a[t+4],7,-176418897),w=z(w,n,d,e,a[t+5],12,1200080426),e=z(e,w,n,d,a[t+6],17,-1473231341),d=z(d,e,w,n,a[t+7],22,-45705983),n=z(n,d,e,w,a[t+8],7,1770035416),w=z(w,n,d,e,a[t+9],12,-1958414417),e=z(e,w,n,d,a[t+10],17,-42063),d=z(d,e,w,n,a[t+11],22,-1990404162),n=z(n,d,e,w,a[t+12],7,1804603682),w=z(w,n,d,e,a[t+13],12,-40341101),e=z(e,w,n,d,a[t+14],17,-1502002290),d=z(d,e,w,n,a[t+15],22,1236535329),n=h(n,d,e,w,a[t+1],5,-165796510),w=h(w,n,d,e,a[t+6],9,-1069501632),e=h(e,w,n,
d,a[t+11],14,643717713),d=h(d,e,w,n,a[t+0],20,-373897302),n=h(n,d,e,w,a[t+5],5,-701558691),w=h(w,n,d,e,a[t+10],9,38016083),e=h(e,w,n,d,a[t+15],14,-660478335),d=h(d,e,w,n,a[t+4],20,-405537848),n=h(n,d,e,w,a[t+9],5,568446438),w=h(w,n,d,e,a[t+14],9,-1019803690),e=h(e,w,n,d,a[t+3],14,-187363961),d=h(d,e,w,n,a[t+8],20,1163531501),n=h(n,d,e,w,a[t+13],5,-1444681467),w=h(w,n,d,e,a[t+2],9,-51403784),e=h(e,w,n,d,a[t+7],14,1735328473),d=h(d,e,w,n,a[t+12],20,-1926607734),n=c(d^e^w,n,d,a[t+5],4,-378558),w=c(n^
d^e,w,n,a[t+8],11,-2022574463),e=c(w^n^d,e,w,a[t+11],16,1839030562),d=c(e^w^n,d,e,a[t+14],23,-35309556),n=c(d^e^w,n,d,a[t+1],4,-1530992060),w=c(n^d^e,w,n,a[t+4],11,1272893353),e=c(w^n^d,e,w,a[t+7],16,-155497632),d=c(e^w^n,d,e,a[t+10],23,-1094730640),n=c(d^e^w,n,d,a[t+13],4,681279174),w=c(n^d^e,w,n,a[t+0],11,-358537222),e=c(w^n^d,e,w,a[t+3],16,-722521979),d=c(e^w^n,d,e,a[t+6],23,76029189),n=c(d^e^w,n,d,a[t+9],4,-640364487),w=c(n^d^e,w,n,a[t+12],11,-421815835),e=c(w^n^d,e,w,a[t+15],16,530742520),d=
c(e^w^n,d,e,a[t+2],23,-995338651),n=B(n,d,e,w,a[t+0],6,-198630844),w=B(w,n,d,e,a[t+7],10,1126891415),e=B(e,w,n,d,a[t+14],15,-1416354905),d=B(d,e,w,n,a[t+5],21,-57434055),n=B(n,d,e,w,a[t+12],6,1700485571),w=B(w,n,d,e,a[t+3],10,-1894986606),e=B(e,w,n,d,a[t+10],15,-1051523),d=B(d,e,w,n,a[t+1],21,-2054922799),n=B(n,d,e,w,a[t+8],6,1873313359),w=B(w,n,d,e,a[t+15],10,-30611744),e=B(e,w,n,d,a[t+6],15,-1560198380),d=B(d,e,w,n,a[t+13],21,1309151649),n=B(n,d,e,w,a[t+4],6,-145523070),w=B(w,n,d,e,a[t+11],10,-1120210379),
e=B(e,w,n,d,a[t+2],15,718787259),d=B(d,e,w,n,a[t+9],21,-343485551),n=f(n,l),d=f(d,sa),e=f(e,J),w=f(w,g);return[n,d,e,w]}function c(a,c,n,d,e,w){return f(b(f(f(c,a),f(d,w)),e),n)}function z(a,b,n,d,e,f,w){return c(b&n|~b&d,a,b,e,f,w)}function h(a,b,n,d,e,f,w){return c(b&d|n&~d,a,b,e,f,w)}function B(a,b,n,d,e,f,w){return c(n^(b|~d),a,b,e,f,w)}function v(a){return p(G(u(a),8*a.length))}function H(a,c){var b=u(a);16<b.length&&(b=G(b,8*a.length));for(var n=Array(16),d=Array(16),e=0;16>e;e++)n[e]=b[e]^
909522486,d[e]=b[e]^1549556828;b=G(n.concat(u(c)),512+8*c.length);return p(G(d.concat(b),672))}function G(a,c){a[c>>5]|=128<<c%32;a[(c+64>>>9<<4)+14]=c;for(var d=1732584193,e=4023233417,w=2562383102,h=271733878,t=3285377520,l=0;l<a.length;l+=16){for(var z,sa=d,g=e,L=w,k=h,A=t,v=d,O=e,B=w,Q=h,X=t,m=0;79>=m;++m)z=f(sa,x(m,g,L,k)),z=f(z,a[l+ka[m]]),z=f(z,0<=m&&15>=m?0:16<=m&&31>=m?1518500249:32<=m&&47>=m?1859775393:48<=m&&63>=m?2400959708:64<=m&&79>=m?2840853838:"rmd160_K1: j out of range"),z=f(b(z,
J[m]),A),sa=A,A=k,k=b(L,10),L=g,g=z,z=f(v,x(79-m,O,B,Q)),z=f(z,a[l+T[m]]),z=f(z,0<=m&&15>=m?1352829926:16<=m&&31>=m?1548603684:32<=m&&47>=m?1836072691:48<=m&&63>=m?2053994217:64<=m&&79>=m?0:"rmd160_K2: j out of range"),z=f(b(z,n[m]),X),v=X,X=Q,Q=b(B,10),B=O,O=z;z=f(e,f(L,Q));e=f(w,f(k,X));w=f(h,f(A,v));h=f(t,f(sa,O));t=f(d,f(g,B));d=z}return[d,e,w,h,t]}function x(a,c,b,n){return 0<=a&&15>=a?c^b^n:16<=a&&31>=a?c&b|~c&n:32<=a&&47>=a?(c|~b)^n:48<=a&&63>=a?c&n|b&~n:64<=a&&79>=a?c^(b|~n):"rmd160_f: j out of range"}
function y(c){return r(N(a(c),8*c.length))}function D(c,b){var n=a(c);16<n.length&&(n=N(n,8*c.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=n[f]^909522486,e[f]=n[f]^1549556828;n=N(d.concat(a(b)),512+8*b.length);return r(N(e.concat(n),672))}function N(a,c){a[c>>5]|=128<<24-c%32;a[(c+64>>9<<4)+15]=c;for(var n=Array(80),d=1732584193,e=-271733879,w=-1732584194,h=271733878,t=-1009589776,l=0;l<a.length;l+=16){for(var z=d,sa=e,J=w,g=h,L=t,k=0;80>k;k++){n[k]=16>k?a[l+k]:b(n[k-3]^n[k-8]^n[k-14]^
n[k-16],1);var A=b(d,5),x;x=20>k?e&w|~e&h:40>k?e^w^h:60>k?e&w|e&h|w&h:e^w^h;A=f(f(A,x),f(f(t,n[k]),20>k?1518500249:40>k?1859775393:60>k?-1894007588:-899497514));t=h;h=w;w=b(e,30);e=d;d=A}d=f(d,z);e=f(e,sa);w=f(w,J);h=f(h,g);t=f(t,L)}return[d,e,w,h,t]}function E(c){return r(L(a(c),8*c.length))}function F(c,b){var n=a(c);16<n.length&&(n=L(n,8*c.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=n[f]^909522486,e[f]=n[f]^1549556828;n=L(d.concat(a(b)),512+8*b.length);return r(L(e.concat(n),768))}
function A(a,c){return a>>>c|a<<32-c}function L(a,c){var b=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],n=Array(64),d,e,h,t,l,z,sa,J,g,k,L,x;a[c>>5]|=128<<24-c%32;a[(c+64>>9<<4)+15]=c;for(g=0;g<a.length;g+=16){d=b[0];e=b[1];h=b[2];t=b[3];l=b[4];z=b[5];sa=b[6];J=b[7];for(k=0;64>k;k++){if(16>k)n[k]=a[k+g];else{L=k;x=n[k-2];x=A(x,17)^A(x,19)^x>>>10;x=f(x,n[k-7]);var v;v=n[k-15];v=A(v,7)^A(v,18)^v>>>3;n[L]=f(f(x,v),n[k-16])}L=l;L=A(L,6)^A(L,11)^A(L,25);L=
f(f(f(f(J,L),l&z^~l&sa),w[k]),n[k]);J=d;J=A(J,2)^A(J,13)^A(J,22);x=f(J,d&e^d&h^e&h);J=sa;sa=z;z=l;l=f(t,L);t=h;h=e;e=d;d=f(L,x)}b[0]=f(d,b[0]);b[1]=f(e,b[1]);b[2]=f(h,b[2]);b[3]=f(t,b[3]);b[4]=f(l,b[4]);b[5]=f(z,b[5]);b[6]=f(sa,b[6]);b[7]=f(J,b[7])}return b}function O(c){return r(S(a(c),8*c.length))}function P(c,b){var n=a(c);32<n.length&&(n=S(n,8*c.length));for(var d=Array(32),e=Array(32),f=0;32>f;f++)d[f]=n[f]^909522486,e[f]=n[f]^1549556828;n=S(d.concat(a(b)),1024+8*b.length);return r(S(e.concat(n),
1536))}function S(a,c){void 0===sa&&(sa=[new t(1116352408,-685199838),new t(1899447441,602891725),new t(-1245643825,-330482897),new t(-373957723,-2121671748),new t(961987163,-213338824),new t(1508970993,-1241133031),new t(-1841331548,-1357295717),new t(-1424204075,-630357736),new t(-670586216,-1560083902),new t(310598401,1164996542),new t(607225278,1323610764),new t(1426881987,-704662302),new t(1925078388,-226784913),new t(-2132889090,991336113),new t(-1680079193,633803317),new t(-1046744716,-815192428),
new t(-459576895,-1628353838),new t(-272742522,944711139),new t(264347078,-1953704523),new t(604807628,2007800933),new t(770255983,1495990901),new t(1249150122,1856431235),new t(1555081692,-1119749164),new t(1996064986,-2096016459),new t(-1740746414,-295247957),new t(-1473132947,766784016),new t(-1341970488,-1728372417),new t(-1084653625,-1091629340),new t(-958395405,1034457026),new t(-710438585,-1828018395),new t(113926993,-536640913),new t(338241895,168717936),new t(666307205,1188179964),new t(773529912,
1546045734),new t(1294757372,1522805485),new t(1396182291,-1651133473),new t(1695183700,-1951439906),new t(1986661051,1014477480),new t(-2117940946,1206759142),new t(-1838011259,344077627),new t(-1564481375,1290863460),new t(-1474664885,-1136513023),new t(-1035236496,-789014639),new t(-949202525,106217008),new t(-778901479,-688958952),new t(-694614492,1432725776),new t(-200395387,1467031594),new t(275423344,851169720),new t(430227734,-1194143544),new t(506948616,1363258195),new t(659060556,-544281703),
new t(883997877,-509917016),new t(958139571,-976659869),new t(1322822218,-482243893),new t(1537002063,2003034995),new t(1747873779,-692930397),new t(1955562222,1575990012),new t(2024104815,1125592928),new t(-2067236844,-1578062990),new t(-1933114872,442776044),new t(-1866530822,593698344),new t(-1538233109,-561857047),new t(-1090935817,-1295615723),new t(-965641998,-479046869),new t(-903397682,-366583396),new t(-779700025,566280711),new t(-354779690,-840897762),new t(-176337025,-294727304),new t(116418474,
1914138554),new t(174292421,-1563912026),new t(289380356,-1090974290),new t(460393269,320620315),new t(685471733,587496836),new t(852142971,1086792851),new t(1017036298,365543100),new t(1126000580,-1676669620),new t(1288033470,-885112138),new t(1501505948,-60457430),new t(1607167915,987167468),new t(1816402316,1246189591)]);var b=[new t(1779033703,-205731576),new t(-1150833019,-2067093701),new t(1013904242,-23791573),new t(-1521486534,1595750129),new t(1359893119,-1377402159),new t(-1694144372,725511199),
new t(528734635,-79577749),new t(1541459225,327033209)],n=new t(0,0),d=new t(0,0),e=new t(0,0),f=new t(0,0),w=new t(0,0),h=new t(0,0),l=new t(0,0),z=new t(0,0),J=new t(0,0),g=new t(0,0),k=new t(0,0),L=new t(0,0),x=new t(0,0),A=new t(0,0),v=new t(0,0),O=new t(0,0),B=new t(0,0),m,T,q=Array(80);for(T=0;80>T;T++)q[T]=new t(0,0);a[c>>5]|=128<<24-(c&31);a[(c+128>>10<<5)+31]=c;for(T=0;T<a.length;T+=32){Q(e,b[0]);Q(f,b[1]);Q(w,b[2]);Q(h,b[3]);Q(l,b[4]);Q(z,b[5]);Q(J,b[6]);Q(g,b[7]);for(m=0;16>m;m++)q[m].h=
a[T+2*m],q[m].l=a[T+2*m+1];for(m=16;80>m;m++){aa(v,q[m-2],19);X(O,q[m-2],29);var S=B,y=q[m-2];S.l=y.l>>>6|y.h<<26;S.h=y.h>>>6;L.l=v.l^O.l^B.l;L.h=v.h^O.h^B.h;aa(v,q[m-15],1);aa(O,q[m-15],8);S=B;y=q[m-15];S.l=y.l>>>7|y.h<<25;S.h=y.h>>>7;k.l=v.l^O.l^B.l;k.h=v.h^O.h^B.h;var S=q[m],p=q[m-7],r=q[m-16],y=(L.l&65535)+(p.l&65535)+(k.l&65535)+(r.l&65535),U=(L.l>>>16)+(p.l>>>16)+(k.l>>>16)+(r.l>>>16)+(y>>>16),D=(L.h&65535)+(p.h&65535)+(k.h&65535)+(r.h&65535)+(U>>>16),p=(L.h>>>16)+(p.h>>>16)+(k.h>>>16)+(r.h>>>
16)+(D>>>16);S.l=y&65535|U<<16;S.h=D&65535|p<<16}for(m=0;80>m;m++)x.l=l.l&z.l^~l.l&J.l,x.h=l.h&z.h^~l.h&J.h,aa(v,l,14),aa(O,l,18),X(B,l,9),L.l=v.l^O.l^B.l,L.h=v.h^O.h^B.h,aa(v,e,28),X(O,e,2),X(B,e,7),k.l=v.l^O.l^B.l,k.h=v.h^O.h^B.h,A.l=e.l&f.l^e.l&w.l^f.l&w.l,A.h=e.h&f.h^e.h&w.h^f.h&w.h,S=n,p=sa[m],r=q[m],y=(g.l&65535)+(L.l&65535)+(x.l&65535)+(p.l&65535)+(r.l&65535),U=(g.l>>>16)+(L.l>>>16)+(x.l>>>16)+(p.l>>>16)+(r.l>>>16)+(y>>>16),D=(g.h&65535)+(L.h&65535)+(x.h&65535)+(p.h&65535)+(r.h&65535)+(U>>>
16),p=(g.h>>>16)+(L.h>>>16)+(x.h>>>16)+(p.h>>>16)+(r.h>>>16)+(D>>>16),S.l=y&65535|U<<16,S.h=D&65535|p<<16,C(d,k,A),Q(g,J),Q(J,z),Q(z,l),C(l,h,n),Q(h,w),Q(w,f),Q(f,e),C(e,n,d);C(b[0],b[0],e);C(b[1],b[1],f);C(b[2],b[2],w);C(b[3],b[3],h);C(b[4],b[4],l);C(b[5],b[5],z);C(b[6],b[6],J);C(b[7],b[7],g)}n=Array(16);for(T=0;8>T;T++)n[2*T]=b[T].h,n[2*T+1]=b[T].l;return n}function t(a,c){this.h=a;this.l=c}function Q(a,c){a.h=c.h;a.l=c.l}function aa(a,c,b){a.l=c.l>>>b|c.h<<32-b;a.h=c.h>>>b|c.l<<32-b}function X(a,
c,b){a.l=c.h>>>b|c.l<<32-b;a.h=c.l>>>b|c.h<<32-b}function C(a,c,b){var n=(c.l&65535)+(b.l&65535),d=(c.l>>>16)+(b.l>>>16)+(n>>>16),e=(c.h&65535)+(b.h&65535)+(d>>>16);c=(c.h>>>16)+(b.h>>>16)+(e>>>16);a.l=n&65535|d<<16;a.h=e&65535|c<<16}var Z=0,ja="",U=!1,ka=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],T=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,
5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],J=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],n=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,
15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],w=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,
-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],sa;return{_get_hexcase_:function(){return Z},_set_hexcase_:function(a){Z=a},_get_padchar_:function(){return ja},_set_padchar_:function(a){ja=a},_get_outenc_:function(){},_set_outenc_:function(a){U="string"===typeof a?fdjt.Hash[a]||!1:a},hex:g,b64:"rst2b64",
base64:"rst2b64",array:u,binl:u,hex_md5:function(a){return g(e(q(a)))},b64_md5:function(a){return m(e(q(a)))},md5:function(a,c){return k(e(q(a)),c)},hex_hmac_md5:function(a,c){return g(l(q(a),q(c)))},b64_hmac_md5:function(a,c){return m(l(q(a),q(c)))},hmac_md5:function(a,c,b){return k(l(q(a),q(c)),b)},hex_rmd160:function(a){return g(v(q(a)))},b64_rmd160:function(a){return m(v(q(a)))},rmd160:function(a,c){return k(v(q(a)),c)},hex_hmac_rmd160:function(a,c){return g(H(q(a),q(c)))},b64_hmac_rmd160:function(a,
c){return m(H(q(a),q(c)))},hmac_rmd160:function(a,c,b){return k(H(q(a),q(c)),b)},hex_sha1:function(a){return g(y(q(a)))},b64_sha1:function(a){return m(y(q(a)))},sha1:function(a,c){return k(y(q(a)),c)},hex_hmac_sha1:function(a,c){return g(D(q(a),q(c)))},b64_hmac_sha1:function(a,c){return m(D(q(a),q(c)))},hmac_sha1:function(a,c,b){return k(D(q(a),q(c)),b)},hex_sha256:function(a){return g(E(q(a)))},b64_sha256:function(a){return m(E(q(a)))},sha256:function(a,c){return k(E(q(a)),c)},hex_hmac_sha256:function(a,
c){return g(F(q(a),q(c)))},b64_hmac_sha256:function(a,c){return m(F(q(a),q(c)))},hmac_sha256:function(a,c,b){return k(F(q(a),q(c)),b)},hex_sha512:function(a){return g(O(q(a)))},b64_sha512:function(a){return m(O(q(a)))},sha512:function(a,c){return k(O(q(a)),c)},hex_hmac_sha512:function(a,c){return g(P(q(a),q(c)))},b64_hmac_sha512:function(a,c){return m(P(q(a),q(c)))},hmac_sha512:function(a,c,b){return k(P(q(a),q(c)),b)}}}());(function(a,r){function g(b,e){a.addEventListener?addEventListener(b,e,!1):a.attachEvent("on"+b,e)}function m(){var b=/^device$/i.test(String(u))?a.orientation&&180!==a.orientation?screen.height:screen.width:/^browser$/i.test(String(u))?r.clientWidth:u instanceof String?(new Function("return "+u))():parseInt(u,10)||0,e=r.className.replace(/^\s+|(^|\s)(gt|is|lt)[^\s]+|\s+$/g,"").split(/\s+/),l=[],d=-1,c=k,z=c.length;for(c.sort(function(a,c){return a-c});++d<z&&!(b<c[d]););b=c[Math.max(Math.min(--d,
z-1),0)];for(d=-1;++d<z;)l.push((b>c[d]?"gt":b<c[d]?"lt":"is")+(q[c[d]]||c[d]));r.className=(e[0]?e:[]).concat(l).join(" ");f&&f(b)}var k=[],q={},u="browser",p=50,f;a.syze={sizes:function(){k=[].concat.apply([],arguments);m();return this},names:function(a){a instanceof Object&&(q=a,m());return this},from:function(a){u=a;m();return this},debounceRate:function(a){p=parseInt(a,10)||0;m();return this},callback:function(a){a instanceof Function&&(f=a,m());return this}};g("resize",function(a){var e;return function(){var f=
this,d=arguments;e&&clearTimeout(e);e=setTimeout(function(){a.apply(f,d);e=null},p)}}(m));g("orientationchange",m);m()})(this,document.documentElement);(function(a,r,g){function m(a,b){this.wrapper="string"===typeof a?r.querySelector(a):a;this.scroller=this.wrapper.children[0];this.scrollerStyle=this.scroller.style;this.options={zoomMin:1,zoomMax:4,startZoom:1,resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};
for(var e in b)this.options[e]=b[e];this.translateZ=this.options.HWCompositing&&p.hasPerspective?" translateZ(0)":"";this.options.useTransition=p.hasTransition&&this.options.useTransition;this.options.useTransform=p.hasTransform&&this.options.useTransform;this.options.eventPassthrough=!0===this.options.eventPassthrough?"vertical":this.options.eventPassthrough;this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault;this.options.scrollY="vertical"===this.options.eventPassthrough?
!1:this.options.scrollY;this.options.scrollX="horizontal"===this.options.eventPassthrough?!1:this.options.scrollX;this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough;this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold;this.options.bounceEasing="string"===typeof this.options.bounceEasing?p.ease[this.options.bounceEasing]||p.ease.circular:this.options.bounceEasing;this.options.resizePolling=void 0===this.options.resizePolling?
60:this.options.resizePolling;!0===this.options.tap&&(this.options.tap="tap");"scale"===this.options.shrinkScrollbars&&(this.options.useTransition=!1);this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1;this.directionY=this.directionX=this.y=this.x=0;this._events={};this.scale=g.min(g.max(this.options.startZoom,this.options.zoomMin),this.options.zoomMax);this._init();this.refresh();this.scrollTo(this.options.startX,this.options.startY);this.enable()}function k(a,b,e){var l=r.createElement("div"),
d=r.createElement("div");!0===e&&(l.style.cssText="position:absolute;z-index:9999",d.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px");d.className="iScrollIndicator";"h"===a?(!0===e&&(l.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",d.style.height="100%"),l.className="iScrollHorizontalScrollbar"):(!0===e&&(l.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",
d.style.width="100%"),l.className="iScrollVerticalScrollbar");l.style.cssText+=";overflow:hidden";b||(l.style.pointerEvents="none");l.appendChild(d);return l}function q(f,b){this.wrapper="string"===typeof b.el?r.querySelector(b.el):b.el;this.wrapperStyle=this.wrapper.style;this.indicator=this.wrapper.children[0];this.indicatorStyle=this.indicator.style;this.scroller=f;this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var e in b)this.options[e]=
b[e];this.sizeRatioY=this.sizeRatioX=1;this.maxPosY=this.maxPosX=0;this.options.interactive&&(this.options.disableTouch||(p.addEvent(this.indicator,"touchstart",this),p.addEvent(a,"touchend",this)),this.options.disablePointer||(p.addEvent(this.indicator,p.prefixPointerEvent("pointerdown"),this),p.addEvent(a,p.prefixPointerEvent("pointerup"),this)),this.options.disableMouse||(p.addEvent(this.indicator,"mousedown",this),p.addEvent(a,"mouseup",this)));this.options.fade&&(this.wrapperStyle[p.style.transform]=
this.scroller.translateZ,this.wrapperStyle[p.style.transitionDuration]=p.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var u=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(f){a.setTimeout(f,1E3/60)},p=function(){function f(a){return!1===l?!1:""===l?a:l+a.charAt(0).toUpperCase()+a.substr(1)}var b={},e=r.createElement("div").style,l=function(){for(var a=["t","webkitT","MozT","msT","OT"],b,
d=0,f=a.length;d<f;d++)if(b=a[d]+"ransform",b in e)return a[d].substr(0,a[d].length-1);return!1}();b.getTime=Date.now||function(){return(new Date).getTime()};b.extend=function(a,b){for(var d in b)a[d]=b[d]};b.addEvent=function(a,b,d,e){a.addEventListener(b,d,!!e)};b.removeEvent=function(a,b,d,e){a.removeEventListener(b,d,!!e)};b.prefixPointerEvent=function(c){return a.MSPointerEvent?"MSPointer"+c.charAt(9).toUpperCase()+c.substr(10):c};b.momentum=function(a,b,d,e,f,l){b=a-b;d=g.abs(b)/d;var k;l=void 0===
l?6E-4:l;k=a+d*d/(2*l)*(0>b?-1:1);l=d/l;k<e?(k=f?e-f/2.5*(d/8):e,b=g.abs(k-a),l=b/d):0<k&&(k=f?f/2.5*(d/8):0,b=g.abs(a)+k,l=b/d);return{destination:g.round(k),duration:l}};var d=f("transform");b.extend(b,{hasTransform:!1!==d,hasPerspective:f("perspective")in e,hasTouch:"ontouchstart"in a,hasPointer:a.PointerEvent||a.MSPointerEvent,hasTransition:f("transition")in e});b.isBadAndroid=/Android /.test(a.navigator.appVersion)&&!/Chrome\/\d/.test(a.navigator.appVersion);b.extend(b.style={},{transform:d,
transitionTimingFunction:f("transitionTimingFunction"),transitionDuration:f("transitionDuration"),transitionDelay:f("transitionDelay"),transformOrigin:f("transformOrigin")});b.hasClass=function(a,b){return(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(a.className)};b.addClass=function(a,d){if(!b.hasClass(a,d)){var e=a.className.split(" ");e.push(d);a.className=e.join(" ")}};b.removeClass=function(a,d){b.hasClass(a,d)&&(a.className=a.className.replace(new RegExp("(^|\\s)"+d+"(\\s|$)","g")," "))};b.offset=
function(a){for(var b=-a.offsetLeft,d=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,d-=a.offsetTop;return{left:b,top:d}};b.preventDefaultException=function(a,b){for(var d in b)if(b[d].test(a[d]))return!0;return!1};b.extend(b.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3});b.extend(b.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(a){return a*(2-
a)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(a){return g.sqrt(1- --a*a)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(a){return--a*a*(5*a+4)+1}},bounce:{style:"",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}},elastic:{style:"",fn:function(a){return 0===a?0:1===a?1:.4*g.pow(2,-10*a)*g.sin(2*(a-.055)*g.PI/.22)+1}}});b.tap=function(a,b){var d=r.createEvent("Event");
d.initEvent(b,!0,!0);d.pageX=a.pageX;d.pageY=a.pageY;a.target.dispatchEvent(d)};b.click=function(a){var b=a.target,d;/(SELECT|INPUT|TEXTAREA)/i.test(b.tagName)||(d=r.createEvent("MouseEvents"),d.initMouseEvent("click",!0,!0,a.view,1,b.screenX,b.screenY,b.clientX,b.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),d._constructed=!0,b.dispatchEvent(d))};return b}();m.prototype={version:"5.1.3",_init:function(){this._initEvents();this.options.zoom&&this._initZoom();(this.options.scrollbars||this.options.indicators)&&
this._initIndicators();this.options.mouseWheel&&this._initWheel();this.options.snap&&this._initSnap();this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0);this._execEvent("destroy")},_transitionEnd:function(a){a.target===this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(a){if(!(1!==p.eventType[a.type]&&0!==a.button||!this.enabled||this.initiated&&
p.eventType[a.type]!==this.initiated)){!this.options.preventDefault||p.isBadAndroid||p.preventDefaultException(a.target,this.options.preventDefaultException)||a.preventDefault();var b=a.touches?a.touches[0]:a;this.initiated=p.eventType[a.type];this.moved=!1;this.directionLocked=this.directionY=this.directionX=this.distY=this.distX=0;this._transitionTime();this.startTime=p.getTime();this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,a=this.getComputedPosition(),this._translate(g.round(a.x),
g.round(a.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd"));this.startX=this.x;this.startY=this.y;this.absStartX=this.x;this.absStartY=this.y;this.pointX=b.pageX;this.pointY=b.pageY;this._execEvent("beforeScrollStart")}},_move:function(a){if(this.enabled&&p.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b=a.touches?a.touches[0]:a,e=b.pageX-this.pointX,l=b.pageY-this.pointY,d=
p.getTime(),c;this.pointX=b.pageX;this.pointY=b.pageY;this.distX+=e;this.distY+=l;b=g.abs(this.distX);c=g.abs(this.distY);if(!(300<d-this.endTime&&10>b&&10>c)){this.directionLocked||this.options.freeScroll||(this.directionLocked=b>c+this.options.directionLockThreshold?"h":c>=b+this.options.directionLockThreshold?"v":"n");if("h"===this.directionLocked){if("vertical"===this.options.eventPassthrough)a.preventDefault();else if("horizontal"===this.options.eventPassthrough){this.initiated=!1;return}l=0}else if("v"===
this.directionLocked){if("horizontal"===this.options.eventPassthrough)a.preventDefault();else if("vertical"===this.options.eventPassthrough){this.initiated=!1;return}e=0}e=this.hasHorizontalScroll?e:0;l=this.hasVerticalScroll?l:0;a=this.x+e;b=this.y+l;if(0<a||a<this.maxScrollX)a=this.options.bounce?this.x+e/3:0<a?0:this.maxScrollX;if(0<b||b<this.maxScrollY)b=this.options.bounce?this.y+l/3:0<b?0:this.maxScrollY;this.directionX=0<e?-1:0>e?1:0;this.directionY=0<l?-1:0>l?1:0;this.moved||this._execEvent("scrollStart");
this.moved=!0;this._translate(a,b);300<d-this.startTime&&(this.startTime=d,this.startX=this.x,this.startY=this.y)}}},_end:function(a){if(this.enabled&&p.eventType[a.type]===this.initiated){this.options.preventDefault&&!p.preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();var b,e;e=p.getTime()-this.startTime;var l=g.round(this.x),d=g.round(this.y),c=g.abs(l-this.startX),z=g.abs(d-this.startY);b=0;var h="";this.initiated=this.isInTransition=0;this.endTime=p.getTime();
if(!this.resetPosition(this.options.bounceTime))if(this.scrollTo(l,d),this.moved)if(this._events.flick&&200>e&&100>c&&100>z)this._execEvent("flick");else if(this.options.momentum&&300>e&&(b=this.hasHorizontalScroll?p.momentum(this.x,this.startX,e,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:l,duration:0},e=this.hasVerticalScroll?p.momentum(this.y,this.startY,e,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:d,
duration:0},l=b.destination,d=e.destination,b=g.max(b.duration,e.duration),this.isInTransition=1),this.options.snap&&(this.currentPage=h=this._nearestSnap(l,d),b=this.options.snapSpeed||g.max(g.max(g.min(g.abs(l-h.x),1E3),g.min(g.abs(d-h.y),1E3)),300),l=h.x,d=h.y,this.directionY=this.directionX=0,h=this.options.bounceEasing),l!==this.x||d!==this.y){if(0<l||l<this.maxScrollX||0<d||d<this.maxScrollY)h=p.ease.quadratic;this.scrollTo(l,d,b,h)}else this._execEvent("scrollEnd");else this.options.tap&&p.tap(a,
this.options.tap),this.options.click&&p.click(a),this._execEvent("scrollCancel")}},_resize:function(){var a=this;clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},resetPosition:function(a){var b=this.x,e=this.y;!this.hasHorizontalScroll||0<this.x?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX);!this.hasVerticalScroll||0<this.y?e=0:this.y<this.maxScrollY&&(e=this.maxScrollY);if(b===this.x&&e===this.y)return!1;this.scrollTo(b,e,a||0,
this.options.bounceEasing);return!0},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=this.wrapper.clientHeight;this.scrollerWidth=g.round(this.scroller.offsetWidth*this.scale);this.scrollerHeight=g.round(this.scroller.offsetHeight*this.scale);this.maxScrollX=this.wrapperWidth-this.scrollerWidth;this.maxScrollY=this.wrapperHeight-this.scrollerHeight;this.hasHorizontalScroll=this.options.scrollX&&
0>this.maxScrollX;this.hasVerticalScroll=this.options.scrollY&&0>this.maxScrollY;this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth);this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight);this.directionY=this.directionX=this.endTime=0;this.wrapperOffset=p.offset(this.wrapper);this._execEvent("refresh");this.resetPosition()},on:function(a,b){this._events[a]||(this._events[a]=[]);this._events[a].push(b)},off:function(a,b){if(this._events[a]){var e=
this._events[a].indexOf(b);-1<e&&this._events[a].splice(e,1)}},_execEvent:function(a){if(this._events[a]){var b=0,e=this._events[a].length;if(e)for(;b<e;b++)this._events[a][b].apply(this,[].slice.call(arguments,1))}},scrollBy:function(a,b,e,l){a=this.x+a;b=this.y+b;this.scrollTo(a,b,e||0,l)},scrollTo:function(a,b,e,l){l=l||p.ease.circular;this.isInTransition=this.options.useTransition&&0<e;!e||this.options.useTransition&&l.style?(this._transitionTimingFunction(l.style),this._transitionTime(e),this._translate(a,
b)):this._animate(a,b,e,l.fn)},scrollToElement:function(a,b,e,l,d){if(a=a.nodeType?a:this.scroller.querySelector(a)){var c=p.offset(a);c.left-=this.wrapperOffset.left;c.top-=this.wrapperOffset.top;!0===e&&(e=g.round(a.offsetWidth/2-this.wrapper.offsetWidth/2));!0===l&&(l=g.round(a.offsetHeight/2-this.wrapper.offsetHeight/2));c.left-=e||0;c.top-=l||0;c.left=0<c.left?0:c.left<this.maxScrollX?this.maxScrollX:c.left;c.top=0<c.top?0:c.top<this.maxScrollY?this.maxScrollY:c.top;b=void 0===b||null===b||"auto"===
b?g.max(g.abs(this.x-c.left),g.abs(this.y-c.top)):b;this.scrollTo(c.left,c.top,b,d)}},_transitionTime:function(a){a=a||0;this.scrollerStyle[p.style.transitionDuration]=a+"ms";!a&&p.isBadAndroid&&(this.scrollerStyle[p.style.transitionDuration]="0.001s");if(this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTime(a)},_transitionTimingFunction:function(a){this.scrollerStyle[p.style.transitionTimingFunction]=a;if(this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTimingFunction(a)},
_translate:function(a,b){this.options.useTransform?this.scrollerStyle[p.style.transform]="translate("+a+"px,"+b+"px) scale("+this.scale+") "+this.translateZ:(a=g.round(a),b=g.round(b),this.scrollerStyle.left=a+"px",this.scrollerStyle.top=b+"px");this.x=a;this.y=b;if(this.indicators)for(var e=this.indicators.length;e--;)this.indicators[e].updatePosition()},_initEvents:function(f){f=f?p.removeEvent:p.addEvent;var b=this.options.bindToWrapper?this.wrapper:a;f(a,"orientationchange",this);f(a,"resize",
this);this.options.click&&f(this.wrapper,"click",this,!0);this.options.disableMouse||(f(this.wrapper,"mousedown",this),f(b,"mousemove",this),f(b,"mousecancel",this),f(b,"mouseup",this));p.hasPointer&&!this.options.disablePointer&&(f(this.wrapper,p.prefixPointerEvent("pointerdown"),this),f(b,p.prefixPointerEvent("pointermove"),this),f(b,p.prefixPointerEvent("pointercancel"),this),f(b,p.prefixPointerEvent("pointerup"),this));p.hasTouch&&!this.options.disableTouch&&(f(this.wrapper,"touchstart",this),
f(b,"touchmove",this),f(b,"touchcancel",this),f(b,"touchend",this));f(this.scroller,"transitionend",this);f(this.scroller,"webkitTransitionEnd",this);f(this.scroller,"oTransitionEnd",this);f(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var f=a.getComputedStyle(this.scroller,null),b;this.options.useTransform?(f=f[p.style.transform].split(")")[0].split(", "),b=+(f[12]||f[4]),f=+(f[13]||f[5])):(b=+f.left.replace(/[^-\d.]/g,""),f=+f.top.replace(/[^-\d.]/g,""));return{x:b,y:f}},
_initIndicators:function(){function a(b){for(var d=c.indicators.length;d--;)b.call(c.indicators[d])}var b=this.options.interactiveScrollbars,e="string"!==typeof this.options.scrollbars,l=[],d,c=this;this.indicators=[];this.options.scrollbars&&(this.options.scrollY&&(d={el:k("v",b,this.options.scrollbars),interactive:b,defaultScrollbars:!0,customStyle:e,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(d.el),
l.push(d)),this.options.scrollX&&(d={el:k("h",b,this.options.scrollbars),interactive:b,defaultScrollbars:!0,customStyle:e,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(d.el),l.push(d)));this.options.indicators&&(l=l.concat(this.options.indicators));for(b=l.length;b--;)this.indicators.push(new q(this,l[b]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){a(function(){this.fade()})}),this.on("scrollCancel",
function(){a(function(){this.fade()})}),this.on("scrollStart",function(){a(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){a(function(){this.fade(1,!0)})}));this.on("refresh",function(){a(function(){this.refresh()})});this.on("destroy",function(){a(function(){this.destroy()});delete this.indicators})},_initZoom:function(){this.scrollerStyle[p.style.transformOrigin]="0 0"},_zoomStart:function(a){var b=g.abs(a.touches[0].pageX-a.touches[1].pageX),e=g.abs(a.touches[0].pageY-a.touches[1].pageY);
this.touchesDistanceStart=g.sqrt(b*b+e*e);this.startScale=this.scale;this.originX=g.abs(a.touches[0].pageX+a.touches[1].pageX)/2+this.wrapperOffset.left-this.x;this.originY=g.abs(a.touches[0].pageY+a.touches[1].pageY)/2+this.wrapperOffset.top-this.y;this._execEvent("zoomStart")},_zoom:function(a){if(this.enabled&&p.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b=g.abs(a.touches[0].pageX-a.touches[1].pageX);a=g.abs(a.touches[0].pageY-a.touches[1].pageY);var b=
g.sqrt(b*b+a*a),b=1/this.touchesDistanceStart*b*this.startScale,e;this.scaled=!0;b<this.options.zoomMin?b=.5*this.options.zoomMin*g.pow(2,b/this.options.zoomMin):b>this.options.zoomMax&&(b=2*this.options.zoomMax*g.pow(.5,this.options.zoomMax/b));e=b/this.startScale;a=this.originX-this.originX*e+this.startX;e=this.originY-this.originY*e+this.startY;this.scale=b;this.scrollTo(a,e,0)}},_zoomEnd:function(a){if(this.enabled&&p.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();
var b;this.initiated=this.isInTransition=0;this.scale>this.options.zoomMax?this.scale=this.options.zoomMax:this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin);this.refresh();b=this.scale/this.startScale;a=this.originX-this.originX*b+this.startX;b=this.originY-this.originY*b+this.startY;0<a?a=0:a<this.maxScrollX&&(a=this.maxScrollX);0<b?b=0:b<this.maxScrollY&&(b=this.maxScrollY);this.x===a&&this.y===b||this.scrollTo(a,b,this.options.bounceTime);this.scaled=!1;this._execEvent("zoomEnd")}},
zoom:function(a,b,e,l){a<this.options.zoomMin?a=this.options.zoomMin:a>this.options.zoomMax&&(a=this.options.zoomMax);if(a!==this.scale){var d=a/this.scale;b=void 0===b?this.wrapperWidth/2:b;e=void 0===e?this.wrapperHeight/2:e;l=void 0===l?300:l;b=b+this.wrapperOffset.left-this.x;e=e+this.wrapperOffset.top-this.y;b=b-b*d+this.x;e=e-e*d+this.y;this.scale=a;this.refresh();0<b?b=0:b<this.maxScrollX&&(b=this.maxScrollX);0<e?e=0:e<this.maxScrollY&&(e=this.maxScrollY);this.scrollTo(b,e,l)}},_wheelZoom:function(a){var b,
e=this;clearTimeout(this.wheelTimeout);this.wheelTimeout=setTimeout(function(){e._execEvent("zoomEnd")},400);if("deltaX"in a)b=-a.deltaY/g.abs(a.deltaY);else if("wheelDeltaX"in a)b=a.wheelDeltaY/g.abs(a.wheelDeltaY);else if("wheelDelta"in a)b=a.wheelDelta/g.abs(a.wheelDelta);else if("detail"in a)b=-a.detail/g.abs(a.wheelDelta);else return;this.zoom(this.scale+b/5,a.pageX,a.pageY,0)},_initWheel:function(){p.addEvent(this.wrapper,"wheel",this);p.addEvent(this.wrapper,"mousewheel",this);p.addEvent(this.wrapper,
"DOMMouseScroll",this);this.on("destroy",function(){p.removeEvent(this.wrapper,"wheel",this);p.removeEvent(this.wrapper,"mousewheel",this);p.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(a){if(this.enabled){a.preventDefault();a.stopPropagation();var b,e,l,d=this;void 0===this.wheelTimeout&&d._execEvent("scrollStart");clearTimeout(this.wheelTimeout);this.wheelTimeout=setTimeout(function(){d._execEvent("scrollEnd");d.wheelTimeout=void 0},400);if("deltaX"in a)1===a.deltaMode?(b=
-a.deltaX*this.options.mouseWheelSpeed,a=-a.deltaY*this.options.mouseWheelSpeed):(b=-a.deltaX,a=-a.deltaY);else if("wheelDeltaX"in a)b=a.wheelDeltaX/120*this.options.mouseWheelSpeed,a=a.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in a)b=a=a.wheelDelta/120*this.options.mouseWheelSpeed;else if("detail"in a)b=a=-a.detail/3*this.options.mouseWheelSpeed;else return;b*=this.options.invertWheelDirection;a*=this.options.invertWheelDirection;this.hasVerticalScroll||(b=a,a=0);this.options.snap?
(e=this.currentPage.pageX,l=this.currentPage.pageY,0<b?e--:0>b&&e++,0<a?l--:0>a&&l++,this.goToPage(e,l)):(e=this.x+g.round(this.hasHorizontalScroll?b:0),l=this.y+g.round(this.hasVerticalScroll?a:0),0<e?e=0:e<this.maxScrollX&&(e=this.maxScrollX),0<l?l=0:l<this.maxScrollY&&(l=this.maxScrollY),this.scrollTo(e,l,0))}},_initSnap:function(){this.currentPage={};"string"===typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap));this.on("refresh",function(){var a=0,
b,e=0,l,d,c,z=0,h;l=this.options.snapStepX||this.wrapperWidth;var k=this.options.snapStepY||this.wrapperHeight;this.pages=[];if(this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(!0===this.options.snap)for(d=g.round(l/2),c=g.round(k/2);z>-this.scrollerWidth;){this.pages[a]=[];for(h=b=0;h>-this.scrollerHeight;)this.pages[a][b]={x:g.max(z,this.maxScrollX),y:g.max(h,this.maxScrollY),width:l,height:k,cx:z-d,cy:h-c},h-=k,b++;z-=l;a++}else for(k=this.options.snap,b=k.length,
l=-1;a<b;a++){if(0===a||k[a].offsetLeft<=k[a-1].offsetLeft)e=0,l++;this.pages[e]||(this.pages[e]=[]);z=g.max(-k[a].offsetLeft,this.maxScrollX);h=g.max(-k[a].offsetTop,this.maxScrollY);d=z-g.round(k[a].offsetWidth/2);c=h-g.round(k[a].offsetHeight/2);this.pages[e][l]={x:z,y:h,width:k[a].offsetWidth,height:k[a].offsetHeight,cx:d,cy:c};z>this.maxScrollX&&e++}this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0);0===this.options.snapThreshold%1?this.snapThresholdY=this.snapThresholdX=this.options.snapThreshold:
(this.snapThresholdX=g.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=g.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}});this.on("flick",function(){var a=this.options.snapSpeed||g.max(g.max(g.min(g.abs(this.x-this.startX),1E3),g.min(g.abs(this.y-this.startY),1E3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,a)})},_nearestSnap:function(a,
b){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var e=0,l=this.pages.length,d=0;if(g.abs(a-this.absStartX)<this.snapThresholdX&&g.abs(b-this.absStartY)<this.snapThresholdY)return this.currentPage;0<a?a=0:a<this.maxScrollX&&(a=this.maxScrollX);0<b?b=0:b<this.maxScrollY&&(b=this.maxScrollY);for(;e<l;e++)if(a>=this.pages[e][0].cx){a=this.pages[e][0].x;break}for(l=this.pages[e].length;d<l;d++)if(b>=this.pages[0][d].cy){b=this.pages[0][d].y;break}e===this.currentPage.pageX&&(e+=this.directionX,
0>e?e=0:e>=this.pages.length&&(e=this.pages.length-1),a=this.pages[e][0].x);d===this.currentPage.pageY&&(d+=this.directionY,0>d?d=0:d>=this.pages[0].length&&(d=this.pages[0].length-1),b=this.pages[0][d].y);return{x:a,y:b,pageX:e,pageY:d}},goToPage:function(a,b,e,l){l=l||this.options.bounceEasing;a>=this.pages.length?a=this.pages.length-1:0>a&&(a=0);b>=this.pages[a].length?b=this.pages[a].length-1:0>b&&(b=0);var d=this.pages[a][b].x,c=this.pages[a][b].y;e=void 0===e?this.options.snapSpeed||g.max(g.max(g.min(g.abs(d-
this.x),1E3),g.min(g.abs(c-this.y),1E3)),300):e;this.currentPage={x:d,y:c,pageX:a,pageY:b};this.scrollTo(d,c,e,l)},next:function(a,b){var e=this.currentPage.pageX,l=this.currentPage.pageY;e++;e>=this.pages.length&&this.hasVerticalScroll&&(e=0,l++);this.goToPage(e,l,a,b)},prev:function(a,b){var e=this.currentPage.pageX,l=this.currentPage.pageY;e--;0>e&&this.hasVerticalScroll&&(e=0,l--);this.goToPage(e,l,a,b)},_initKeys:function(f){f={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};
var b;if("object"===typeof this.options.keyBindings)for(b in this.options.keyBindings)"string"===typeof this.options.keyBindings[b]&&(this.options.keyBindings[b]=this.options.keyBindings[b].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(b in f)this.options.keyBindings[b]=this.options.keyBindings[b]||f[b];p.addEvent(a,"keydown",this);this.on("destroy",function(){p.removeEvent(a,"keydown",this)})},_key:function(a){if(this.enabled){var b=this.options.snap,e=b?this.currentPage.pageX:
this.x,l=b?this.currentPage.pageY:this.y,d=p.getTime(),c=this.keyTime||0,k;this.options.useTransition&&this.isInTransition&&(k=this.getComputedPosition(),this._translate(g.round(k.x),g.round(k.y)),this.isInTransition=!1);this.keyAcceleration=200>d-c?g.min(this.keyAcceleration+.25,50):0;switch(a.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?e+=b?1:this.wrapperWidth:l+=b?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&
!this.hasVerticalScroll?e-=b?1:this.wrapperWidth:l-=b?1:this.wrapperHeight;break;case this.options.keyBindings.end:e=b?this.pages.length-1:this.maxScrollX;l=b?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:l=e=0;break;case this.options.keyBindings.left:e+=b?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:l+=b?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:e-=b?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:l-=
b?1:5+this.keyAcceleration>>0;break;default:return}b?this.goToPage(e,l):(0<e?this.keyAcceleration=e=0:e<this.maxScrollX&&(e=this.maxScrollX,this.keyAcceleration=0),0<l?this.keyAcceleration=l=0:l<this.maxScrollY&&(l=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(e,l,0),this.keyTime=d)}},_animate:function(a,b,e,l){function d(){var m=p.getTime(),q;m>=v?(c.isAnimating=!1,c._translate(a,b),c.resetPosition(c.options.bounceTime)||c._execEvent("scrollEnd")):(m=(m-g)/e,q=l(m),m=(a-k)*q+k,q=(b-h)*q+
h,c._translate(m,q),c.isAnimating&&u(d))}var c=this,k=this.x,h=this.y,g=p.getTime(),v=g+e;this.isAnimating=!0;d()},handleEvent:function(a){switch(a.type){case "touchstart":case "pointerdown":case "MSPointerDown":case "mousedown":this._start(a);this.options.zoom&&a.touches&&1<a.touches.length&&this._zoomStart(a);break;case "touchmove":case "pointermove":case "MSPointerMove":case "mousemove":if(this.options.zoom&&a.touches&&a.touches[1]){this._zoom(a);break}this._move(a);break;case "touchend":case "pointerup":case "MSPointerUp":case "mouseup":case "touchcancel":case "pointercancel":case "MSPointerCancel":case "mousecancel":if(this.scaled){this._zoomEnd(a);
break}this._end(a);break;case "orientationchange":case "resize":this._resize();break;case "transitionend":case "webkitTransitionEnd":case "oTransitionEnd":case "MSTransitionEnd":this._transitionEnd(a);break;case "wheel":case "DOMMouseScroll":case "mousewheel":if("zoom"===this.options.wheelAction){this._wheelZoom(a);break}this._wheel(a);break;case "keydown":this._key(a)}}};q.prototype={handleEvent:function(a){switch(a.type){case "touchstart":case "pointerdown":case "MSPointerDown":case "mousedown":this._start(a);
break;case "touchmove":case "pointermove":case "MSPointerMove":case "mousemove":this._move(a);break;case "touchend":case "pointerup":case "MSPointerUp":case "mouseup":case "touchcancel":case "pointercancel":case "MSPointerCancel":case "mousecancel":this._end(a)}},destroy:function(){this.options.interactive&&(p.removeEvent(this.indicator,"touchstart",this),p.removeEvent(this.indicator,p.prefixPointerEvent("pointerdown"),this),p.removeEvent(this.indicator,"mousedown",this),p.removeEvent(a,"touchmove",
this),p.removeEvent(a,p.prefixPointerEvent("pointermove"),this),p.removeEvent(a,"mousemove",this),p.removeEvent(a,"touchend",this),p.removeEvent(a,p.prefixPointerEvent("pointerup"),this),p.removeEvent(a,"mouseup",this));this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(f){var b=f.touches?f.touches[0]:f;f.preventDefault();f.stopPropagation();this.transitionTime();this.initiated=!0;this.moved=!1;this.lastPointX=b.pageX;this.lastPointY=b.pageY;this.startTime=
p.getTime();this.options.disableTouch||p.addEvent(a,"touchmove",this);this.options.disablePointer||p.addEvent(a,p.prefixPointerEvent("pointermove"),this);this.options.disableMouse||p.addEvent(a,"mousemove",this);this.scroller._execEvent("beforeScrollStart")},_move:function(a){var b=a.touches?a.touches[0]:a,e,l;p.getTime();this.moved||this.scroller._execEvent("scrollStart");this.moved=!0;e=b.pageX-this.lastPointX;this.lastPointX=b.pageX;l=b.pageY-this.lastPointY;this.lastPointY=b.pageY;this._pos(this.x+
e,this.y+l);a.preventDefault();a.stopPropagation()},_end:function(f){if(this.initiated){this.initiated=!1;f.preventDefault();f.stopPropagation();p.removeEvent(a,"touchmove",this);p.removeEvent(a,p.prefixPointerEvent("pointermove"),this);p.removeEvent(a,"mousemove",this);if(this.scroller.options.snap){f=this.scroller._nearestSnap(this.scroller.x,this.scroller.y);var b=this.options.snapSpeed||g.max(g.max(g.min(g.abs(this.scroller.x-f.x),1E3),g.min(g.abs(this.scroller.y-f.y),1E3)),300);if(this.scroller.x!==
f.x||this.scroller.y!==f.y)this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=f,this.scroller.scrollTo(f.x,f.y,b,this.scroller.options.bounceEasing)}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(a){a=a||0;this.indicatorStyle[p.style.transitionDuration]=a+"ms";!a&&p.isBadAndroid&&(this.indicatorStyle[p.style.transitionDuration]="0.001s")},transitionTimingFunction:function(a){this.indicatorStyle[p.style.transitionTimingFunction]=a},refresh:function(){this.transitionTime();
this.indicatorStyle.display=this.options.listenX&&!this.options.listenY?this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.scroller.hasVerticalScroll?"block":"none":this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none";this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(p.addClass(this.wrapper,"iScrollBothScrollbars"),p.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&
(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(p.removeClass(this.wrapper,"iScrollBothScrollbars"),p.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=g.max(g.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||
this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"===this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX);this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,
this.options.resize?(this.indicatorHeight=g.max(g.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"===this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-
this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY);this.updatePosition()},updatePosition:function(){var a=this.options.listenX&&g.round(this.sizeRatioX*this.scroller.x)||0,b=this.options.listenY&&g.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(a<this.minBoundaryX?("scale"===this.options.shrink&&(this.width=g.max(this.indicatorWidth+a,8),this.indicatorStyle.width=this.width+"px"),a=this.minBoundaryX):
a>this.maxBoundaryX?"scale"===this.options.shrink?(this.width=g.max(this.indicatorWidth-(a-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",a=this.maxPosX+this.indicatorWidth-this.width):a=this.maxBoundaryX:"scale"===this.options.shrink&&this.width!==this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),b<this.minBoundaryY?("scale"===this.options.shrink&&(this.height=g.max(this.indicatorHeight+3*b,8),this.indicatorStyle.height=this.height+"px"),
b=this.minBoundaryY):b>this.maxBoundaryY?"scale"===this.options.shrink?(this.height=g.max(this.indicatorHeight-3*(b-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",b=this.maxPosY+this.indicatorHeight-this.height):b=this.maxBoundaryY:"scale"===this.options.shrink&&this.height!==this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px"));this.x=a;this.y=b;this.scroller.options.useTransform?this.indicatorStyle[p.style.transform]="translate("+a+"px,"+
b+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=a+"px",this.indicatorStyle.top=b+"px")},_pos:function(a,b){0>a?a=0:a>this.maxPosX&&(a=this.maxPosX);0>b?b=0:b>this.maxPosY&&(b=this.maxPosY);a=this.options.listenX?g.round(a/this.sizeRatioX):this.scroller.x;b=this.options.listenY?g.round(b/this.sizeRatioY):this.scroller.y;this.scroller.scrollTo(a,b)},fade:function(a,b){if(!b||this.visible){clearTimeout(this.fadeTimeout);this.fadeTimeout=null;var e=a?250:500,l=a?0:300;this.wrapperStyle[p.style.transitionDuration]=
e+"ms";this.fadeTimeout=setTimeout(function(a){this.wrapperStyle.opacity=a;this.visible=+a}.bind(this,a?"1":"0"),l)}}};m.utils=p;a.IScroll=m})(window,document,Math);fdjt.Log=function(){function a(q){var u=!1,p=fdjt.ET(),f;(a.doformat||q.search("%j"))&&"undefined"!==typeof g&&(u=g.apply(null,arguments));a.console_fn&&(u?a.console_fn.call(a.console,u):a.console_fn.apply(a.console,arguments));if(a.logurl){f="["+p+"s] "+g.apply(null,arguments);window.console&&window.console.log("remote logging %s",f);var b=new XMLHttpRequest;b.open("POST",a.logurl,!a.logsync);b.setRequestHeader("Content-type","text; charset=utf-8");b.send(f)}if(a.console){var b=a.console,e=fdjt.DOM("span.time",
p);f=fdjt.DOM("div.fdjtlog");f.innerHTML=u?u:g.apply(null,arguments);fdjt.DOM.prepend(f,e);"string"===typeof b&&(b=(b=document.getElementById(b))?a.console=b:!1);b&&!b.nodeType&&(b=!1);b&&a.livelog?(r(b),b.appendChild(f),b.appendChild(document.createTextNode("\n"))):b&&0!==b.offsetHeight?(r(b),b.appendChild(f),b.appendChild(document.createTextNode("\n"))):m.push(f)}if(a.useconsole||!a.console&&!a.console_fn){if("undefined"===typeof k)if(window.console&&window.console.log)if(window.console.count)k=
!0;else{k=!0;try{window.console.log("Testing console")}catch(l){k=!1}}else k=!1;if(k)if(window.console.log.call)if(u)window.console.log.call(window.console,"["+p+"s] "+u);else{u=Array(arguments.length+1);u[0]="[%fs] "+q;u[1]=p;p=1;for(f=arguments.length;p<f;)u[p+1]=arguments[p],p++;window.console.log.apply(window.console,u)}else window.console.log("["+p+"s] "+g.apply(null,arguments))}}function r(a){if(m&&m.length){var k=document.createDocumentFragment(),g=m;m=!1;for(var f=0,b=g.length;f<b;)k.appendChild(g[f++]),
k.appendChild(document.createTextNode("\n"));a.appendChild(k);m=[]}}var g=fdjt.String,m=[],k;a.console=null;a.update=function(){a.console&&r(a.console)};a.warn=function(){if(!a.console_fn&&!window.console&&window.console.log&&window.console.log.count){var k=g.apply(null,arguments);window.alert(k)}else a.apply(null,arguments)};a.uhoh=function(){a.debugging&&a.warn.call(this,arguments)};a.bkpt=function(){var k=!1;a.doformat&&"undefined"!==typeof g&&(k=g.apply(null,arguments));a.console_fn?k?a.console_fn(a.console,
k):a.console_fn.apply(a.console,arguments):window.console&&window.console.log&&window.console.count&&(k?window.console.log.call(window.console,k):window.console.log.apply(window.console,arguments))};a.useconsole=!0;fdjt.Trace=fdjt.Log;return a}(window,document);(function(){function a(a,b,d,c){a=b.exec(a);"undefined"===typeof d&&(d=0);return a&&a.length>d?c?a[d]:f.test(a[d])?parseFloat(a[d]):a[d]:!1}function r(a){a=a.replace(/\s+/g," ");var b=0,d=a.length;if(0>=d)return a;for(;b<d&&-1<"\n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(b));)b++;if(b===d)return"";for(var c=d-1;c>b&&-1<"\n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff".indexOf(a.charAt(c));)c--;
return 0<b||c<d?a.slice(b,c+1):a}function g(){if(!fdjt.device||!fdjt.device.started){var e=window.navigator,f=e.userAgent,d=a(f,/\bAndroid +(\d+\.\d+)\b/g,1),c=a(f,/\bAppleWebKit\/(\d+\.\d+)\b/g,1),k=a(f,/\bGecko\/(\d+)\b/gi,1,!0),h=a(f,/\bChrome\/(\d+\.\d+)\b/g,1),g=a(f,/\bFirefox\/(\d+\.\d+)\b/gi,1),v=a(f,/\bSafari\/(\d+\.\d+)\b/gi,1),q=a(f,/\bMac OS X \/(\d+\_\d+)\b/gi,1,!0),p=v&&a(f,/\bMobile\/(\w+)\b/gi,1,!0),x=c&&a(f,/\bMobile\/(\w+)\b/gi,1,!0),y=a(f,/\bMobile\/(\w+)\b/gi,1,!0),D=a(f,/\bVersion\/(\d+\.\d+)\b/gi,
1),u=/ubuntu/gi.test(f),E=/redhat/gi.test(f),F=/linux/gi.test(f),A=/Macintosh/gi.test(f),L=/Touchpad/gi.test(f),O=/iphone/gi.test(f),P=/ipad/gi.test(f),S=O||P||d||L,f=(O||P)&&(a(f,/\bVersion\/(\d+\.\d+)\b/gi,1)||!0),k=r((d?" Android/"+d:"")+(c?" WebKit/"+c:"")+(k?" Gecko/"+k:"")+(h?" Chrome/"+h:"")+(g?" Firefox/"+g:"")+(v?" Safari/"+v:"")+(p?" MobileSafari/"+p:"")+(x?" MobileWebKit/"+x:"")+(f?" IOS/"+f:"")+(q?" OSX/"+q:"")+(e.platform?" "+e.platform:"")+(O?" iPhone":"")+(P?" iPad":"")+(L?" TouchPad":
"")+(S?" touch":" mouse"));e.vendor&&(b.vendor=e.vendor);e.platform&&(b.platform=e.platform);e.oscpu&&(b.oscpu=e.oscpu);e.cookieEnabled&&(b.cookies=e.cookies);e.doNotTrack&&(b.notrack=e.doNotTrack);e.standalone&&(b.standalone=e.standalone);b.string=k;d&&(b.android=d);f&&(b.ios=f,O&&(b.iphone=f),P&&(b.ipad=f));h&&(b.chrome=h);P&&(b.iPad=!0);O&&(b.iPhone=!0);f&&(b.ios=!0);q&&(b.osx=!0);c&&(b.webkit=c);v&&(b.safari=v);p&&(b.mobilesafari=p);x&&(b.mobilewebkit=x);y&&(b.mobile=y);D&&(b.version=D);A&&(b.isMacintosh=
!0);u&&(b.ubuntu=!0);E&&(b.redhat=!0);F&&(b.linux=!0);S&&(b.touch=!0);m("Device: %j",b)}}var m=fdjt.Log,k=!1,q=[],u=[],p={};fdjt.addInit=function(a,b,d){var c;a&&a.call?c=!0:(m.warn("Bad argument to addInit(): %s",b||"anonymous",a),c=!1);if(c){c=b&&p[b];for(var f=0,h=q.length;f<h;)if(c&&q[f]===c)if(k){if(m.warn("Replacing init %s which has already run",b),d){m.warn("Running the new version");q[f]=a;p[b]=a;a();return}}else{q[f]=a;p[b]=a;return}else{if(q[f]===a)return;f++}b&&(p[b]=a);q.push(a);k?(a(),
u.push(!0)):u.push(!1)}};fdjt.Init=function(){var a=[];if(k)return!1;for(var b in p)p.hasOwnProperty(b)&&a.push(b);0===a.length?m("Running %d DOM inits",q.length):a.length===q.length?m("Running %d DOM inits (%s)",q.length,a.join()):m("Running %d DOM inits (including %s)",q.length,a.join());a=0;for(b=q.length;a<b;)u[a]?a++:(u[a]=!0,q[a++]());k=!0};var f=/^\d+(\.\d+)$/,b=fdjt.device||(fdjt.device={});"undefined"!==typeof window&&window.navigator&&window.navigator.appVersion&&g()})();fdjt.State=function(){function a(c,d,e){if(1===arguments.length)return window.sessionStorage&&q(c)||window.sessionStorage&&f(c)||r(c);if(e)if(window.localStorage)d?p(c,d):b(c);else{var h=a.domain||location.hostname,l=a.path||"/",z=a.duration||220752E3;d?g(c,d,z,l,h):m(c,l,h)}else d?window.sessionStorage?k(c,d):g(c,d):window.sessionStorage?u(c):m(c)}function r(a,b){try{var c=document.cookie,d=c.search(new RegExp("(^|(; ))"+a+"=","g")),e;if(0<=d){var h=c.indexOf("=",d)+1,f=c.indexOf(";",h);e=0<f?c.slice(h,
f):c.slice(h)}else return!1;return b?JSON.parse(decodeURIComponent(e)):decodeURIComponent(e)}catch(l){return!1}}function g(a,b,c,d,e){try{if(b){var h="string"===typeof b?b:b.toJSON?b.toJSON():b.toString?b.toString():b,f=a+"="+encodeURIComponent(h);if(c)if("string"===typeof c)f=f+"; "+c;else if(c.toGMTString)f=f+"; expires="+c.toGMTString();else if("number"===typeof c)if(0<c){var l=new Date;l.setTime(l.getTime()+c);f=f+"; expires="+l.toGMTString}else f+="; expires=Sun 1 Jan 2000 00:00:00 UTC";d&&(f=
f+"; path="+d);e&&(f=f+"; domain="+e);document.cookie=f}else m(a,d,e)}catch(k){z.warn("Error setting cookie %s",a)}}function m(a,b,c){try{var d=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT";b&&(d=d=d+"; path="+b);c&&(d=d=d+"; domain="+c);document.cookie=d}catch(e){z.warn("Error clearing cookie %s: %s",a,e)}r(a)&&(a=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie=a)}function k(a,b,c){c&&(b=JSON.stringify(b));window.sessionStorage?window.sessionStorage[a]=
b:g(a,b)}function q(a,b){var c=window.sessionStorage?window.sessionStorage[a]:r(a);return c?b?JSON.parse(c):c:!1}function u(a){if(window.sessionStorage)return window.sessionStorage.removeItem(a);m(a)}function p(a,c,d){if(!a)throw{error:"bad name",name:a};if("undefined"===typeof c)throw{error:"undefined value",name:a};if(c){if(d&&(c=JSON.stringify(c)),window.localStorage)if(a instanceof RegExp){d=[];for(var e=window.localStorage,h=0,f=e.length;h<f;){var l=e.key(h++);0<=l.search(a)&&d.push(l)}h=0;for(f=
d.length;h<f;)e[d[h++]]=c}else window.localStorage[a]=c}else b(a)}function f(a,b){if(a){if(window.localStorage){if(a instanceof RegExp){for(var c=window.localStorage,d=0,e=c.length;d<e;){var h=c.key(d++);if(0<=h.search(a))return b?JSON.parse(c[h]):c[h]}return!1}return(c=window.localStorage[a])?b?JSON.parse(c):c:!1}return!1}throw{error:"bad name",name:a};}function b(a){if(window.localStorage)if(a instanceof RegExp){for(var b=[],c=window.localStorage,d=0,e=c.length;d<e;){var h=c.key(d++);0<=h.search(a)&&
b.push(h)}d=0;for(e=b.length;d<e;)c.removeItem(b[d++])}else return window.localStorage.removeItem(a);else return!1}function e(a,b,c,d,e,h){var f=[];b=encodeURIComponent(b);d=new RegExp("(&|^)"+b+"(=|&|$)",d?"g":"gi");for(h=a.search(d);0<=h;){var k=h+b.length,g=a.slice(k+1),z=g.search(/(&|$)/g);if("="===a[k]){if(0>=z?f.push(""):(f.push(g.slice(0,z)),z=z+k+1),!c)break}else if(c)f.push(a.slice(h,z));else return e?a.slice(h,z):l(a.slice(h,z));0<z&&(a=a.slice(z),h=a.search(d))}if(!e)for(a=0,e=f.length;a<
e;)f[a]=l(f[a]),a++;return c?f:f.length?f[0]:!1}function l(a){return decodeURIComponent?decodeURIComponent(a):a.replace(/%3A/gi,":").replace(/%2F/gi,"/").replace(/%3F/gi,"?").replace(/%3D/gi,"=").replace(/%20/gi," ").replace(/%40/gi,"@").replace(/%23/gi,"#")}function d(a){if(a){if("string"===typeof a)return new RegExp("\\b"+a+"\\b","gi");if(a.length){for(var b="\\b(",c=0;c<a.length;){var d=a[c];0<c&&(b+="|");b=b+"("+d+")";c++}return new RegExp(b+")\\b","gi")}return!1}return a}function c(a,b){return a.length===
b?a:a.length>b?a.slice(0,b):"000000000000000000000000000000000000000000000000000000000000000".slice(0,b-a.length)+a}var z=fdjt.Log,h=fdjt.String;a.domain=!1;a.path=!1;a.duration=!1;a.getCookie=r;a.setCookie=g;a.clearCookie=m;a.setSession=k;a.getSession=q;a.existsSession=function(a){if(a){if(window.sessionStorage){if(a instanceof RegExp){for(var b=window.sessionStorage,c=0,d=b.length;c<d;)if(0<=b.key(c++).search(a))return!0;return!1}return window.sessionStorage[a]?!0:!1}return!1}throw{error:"bad name",
name:a};};a.dropSession=u;a.clearSession=function(){if(window.sessionStorage){for(var a=window.localStorage,b=0,c=a.length,d=[];b<c;)d.push(a.key(b++));for(b=0;b<c;)a.removeItem(d[b++])}};a.listSession=function(a){var b=[];"string"===typeof a&&(a=new RegExp("^"+h.escapeRX(a),"g"));if(window.sessionStorage){var c=window.sessionStorage,d=0,e=c.length,f=!1;if(!a)for(;d<e;)b.push(c.key(d++));else if(a instanceof RegExp)for(;d<e;)f=c.key(d++),0<=f.search(a)&&b.push(f)}return b};a.setLocal=p;a.getLocal=
f;a.pushLocal=function(a,b){if(!a)throw{error:"bad name",name:a};var c=window.localStorage[a],d=!1;if(c)if(d=JSON.parse(c),Array.isArray(d)||(d=[d]),0>d.indexOf(b))d.push(b);else return!1;else d=[b];window.localStorage[a]=JSON.stringify(d);return!0};a.removeLocal=function(a,c){if(!a)throw{error:"bad name",name:a};var d=window.localStorage[a];if(d){var d=JSON.parse(d),e;if(d===c){b(a);return}if(Array.isArray(d))e=d.indexOf(c);else return;if(0>e)return;d.splice(e,1);window.localStorage[a]=JSON.stringify(d)}return!0};
a.existsLocal=function(a){if(a){if(window.localStorage&&a instanceof RegExp)for(var b=window.localStorage,c=0,d=b.length;c<d;)if(0<=b.key(c++).search(a))return!0;return!1}throw{error:"bad name",name:a};};a.findLocal=function(a,b,c){if(window.localStorage){for(var d={},e=window.localStorage,h=0,f=e.length;h<f;){var l=e.key(h++);if(!a||0<=l.search(a)){var k=e[l];if(!b||0<=k.search(b)){if(c)try{k=JSON.parse(k)}catch(g){}d[l]=k}}}return d}return!1};a.dropLocal=b;a.listLocal=function(a){var b=[];"string"===
typeof a&&(a=new RegExp("^"+h.escapeRX(a),"g"));if(window.localStorage){var c=window.localStorage,d=0,e=c.length,f=!1;if(!a)for(;d<e;)b.push(c.key(d++));else if(a instanceof RegExp)for(;d<e;)f=c.key(d++),0<=f.search(a)&&b.push(f)}return b};a.clearLocal=function(){if(window.localStorage){for(var a=window.localStorage,b=0,c=a.length,d=[];b<c;)d.push(a.key(b++));for(b=0;b<c;)a.removeItem(d[b++])}};a.getParam=e;a.getQuery=function(a,b,c,d){if(!location.search)return b?[]:!1;var h=location.search;"?"===
h[0]&&(h=h.slice(1));return e(h,a,b,c,d)};a.getHash=function(a,b,c,d){if(!location.hash)return b?[]:!1;var h=location.hash;"#"===h[0]&&h.slice(1);return e(location.hash,a,b,c,d)};a.testOption=function(a,b){for(var c=a&&new RegExp("\\b"+a+"\\b"),e=b&&d(b),h=2;h<arguments.length;){var f=arguments[h++];if(f)if("string"===typeof f){if(c&&0<=f.search(c))return!0;if(e&&0<=f.search(e))break}else if(f.length){c=0;for(e=f.length;c<e;){if(a&&f[c]===a)return!0;if(b&&f[c]===b)break;else c++}break}}return!1};
a.argVec=function(a,b){for(var c=b||0,d=Array(a.length-c);c<a.length;)d[c-b]=a[c],c++;return d};var B=c((Math.floor(65536*Math.random()).toString(16)+Math.floor(65536*Math.random()).toString(16)+Math.floor(65536*Math.random()).toString(16)+(Math.floor(65536*Math.random())|1)).toString(16),12),v=Math.floor(16384*Math.random()),H=1,G=(new Date).getTime();a.getNodeID=function(){return B};a.setNodeID=function(a){if("number"===typeof a)B=c(a.toString(16),12);else if("string"===typeof a)if(0>a.search(/[^0123456789abcdefABCDEF]/))B=
c(a,12);else throw{error:"invalid node id",value:a};else throw{error:"invalid node id",value:a};};a.getUUID=function(a){var b=(new Date).getTime();b<G?(b*=1E4,v++):b===G?b=1E4*b+H++:(b*=1E4,H=1);a||(a=B);var b=(b+122192928E9).toString(16),d=b.length;15>d&&(b="000000000000000000000000000000000000000000000000000000000000000".slice(0,15-d)+b);return b.slice(7)+"-"+b.slice(3,7)+"-1"+b.slice(0,3)+"-"+(32768+v%16384).toString(16)+"-"+(a?"number"===typeof a?c(a.toString(16),12):c(a,12):B)};a.versionInfo=
function(){for(var a=navigator.userAgent,b={},c;0<=(c=a.search(/\w+\/\d/g));){var d=a.indexOf("/",c),e=a.slice(d+1),h=e.search(/\W/),f=e.slice(0,h);try{b[a.slice(c,d)]=parseInt(f,10)}catch(l){b[a.slice(c,d)]=f}a=e.slice(h)}b.browser=b.Chrome?"Chrome":b.Opera?"Opera":b.Safari?"Safari":b.Safari&&b.Mobile?"MobileSafari":b.Firefox?"Firefox":b.Explorer||b.IE||b.InternetExplorer||b.MSIE?"IE":b.Mozilla?"Mozilla":"Browser";b.platform=navigator.platform||"Turing";return b};a.getStyleTag=function(){var a=window.getComputedStyle(document.body,
":after").getPropertyValue("content");return a=a.replace(/"/g,"")};a.getURL=function(a,b){var c=window.location.href,d=c.indexOf("#"),e=c.indexOf("?"),h=b&&0<=d&&c.slice(d+1),f=a&&0<=e&&(0<=d?c.slice(e+1,d):c.slice(e+1)),c=0<=e?c.slice(0,e):0<=d?c.slice(0,d):c;return c+(f?"?"+f:"")+(h?"#"+h:"")};return a}();var _fdjt_init;
fdjt.DOM=function(){function a(a){var b;if(a.nodeType)b=a;else{if("string"===typeof a&&"<"===a[0]){b=document.createDocumentFragment();b.innerHTML=a;var c=b.childNodes;return 1===c.length?c[0]:b}if("string"!==typeof a||"#"!==a[0]||!(b=document.getElementById(a.slice(1))))if("string"===typeof a){c=a.match(Y);if(!c)return M.warn("bad CSS spec"),!1;var d=!1;b=document.createElement(c[0]);for(var n=1,e=c.length;n<e;){var w=c[n++];if("#"===w[0])b.id=w.slice(1);else if("."===w[0])d=d?d+" "+w.slice(1):w.slice(1);
else if("["===w[0]){var h=w.indexOf("=");if(0>h)b.setAttribute(w.slice(1,w.length-1),w.slice(1,w.length-1));else{var f=w.slice(h+1,w.length-1);if("'"===f[0]&&"'"===f[f.length-1]||'"'===f[0]&&'"'===f[f.length-1])f=f.slice(1,f.length-1);b.setAttribute(w.slice(1,h),f)}}}d&&(b.className=d)}else for(c in b=document.createElement(a.tagName||"span"),a)"tagName"!==c&&b.setAttribute(c,a[c])}g(b,arguments,1);return b}function r(a){return a&&(document.getElementById(a)||"#"===a[0]&&document.getElementById(a.slice(1)))}
function g(a,b,c){if(b.nodeType)a.appendChild(b);else if("string"===typeof b)a.appendChild(document.createTextNode(b));else{if(b.toDOM)return g(a,b.toDOM());if(b.toHTML)return g(a,b.toHTML());if(b.length&&(!c||c<b.length)){var d=window.DocumentFragment&&a instanceof window.DocumentFragment?a:document.createDocumentFragment();b=window.NodeList&&b instanceof window.NodeList?q(b):b;var n=b.length;for("undefined"===typeof c&&(c=0);c<n;){var e=b[c++];e&&("string"===typeof e?d.appendChild(document.createTextNode(e)):
e.nodeType?d.appendChild(e):e.length?g(d,e,0):e.toDOM?g(d,e.toDOM()):e.toHTML?g(d,e.toHTML()):e.toString?d.appendChild(document.createTextNode(e.toString())):d.appendChild(document.createTextNode(""+e)))}a!==d&&a.appendChild(d)}else b.length||a.appendChild(document.createTextNode(""+b))}return a}function m(a,b,c){var d=a.parentNode;if(b.nodeType)d.insertBefore(b,d);else if("string"===typeof b)d.insertBefore(document.createTextNode(b),a);else{if(b.toDOM)return m(a,b.toDOM());if(b.toHTML)return m(a,
d,b.toHTML());if(b.length){var n=window.documentFragment&&d instanceof window.DocumentFragment?d:document.createDocumentFragment();g(n,b,c);d.insertBefore(n,a);return a}d.insertBefore(document.createTextNode(""+b),a)}return d}function k(a){return Array.prototype.slice.call(a)}function q(a,b){return a.constructor===Array||a instanceof Array?b?a.slice(b):a:Array.prototype.slice.call(a,b||0)}function u(b,c){c||(c="div.fdjtwrapper");var d=y(b,c);if(d&&d.nodeType&&d.parentNode===b)return d;d=a(c,k(b.childNodes));
b.appendChild(d);return d}function p(a,b){"undefined"===typeof b&&(b=0);if(0===a)return 0;if(a){if("none"===a||"auto"===a)return b;if("number"===typeof a)return a;if("string"===typeof a){var c=a.length,d=!1,d=2<c&&"x"===a[c-1]&&"p"===a[c-2]?parseInt(a.slice(0,-2),10):parseInt(a,10);return 0===d?0:isNaN(d)?b:"number"===typeof d?d:b}return!1}return b}function f(a){var b=new RegExp("\\b"+a+"\\b","g");return Ta[a]=b}function b(a,b,c,d){var n=[],n=0<=b.search(/(\.|#|\[|,)/g)?x(a,b):a.getElementsByClassName?
a.getElementsByClassName(b):x();if(0===n.length)return d?[]:!1;if(d){a=[];b=0;for(d=d.length;b<d;){var e=n[b++].innerText;c?a.push(JSON.parse(e)):a.push(e)}return a}return c?JSON.parse(n[0].innerText):n[0].innerText}function e(a,b,c){if(a&&("string"!==typeof a||(a=document.getElementById(a)))){a=c?a.getAttribute(c)||"":a.className;if("string"!==typeof a||""===a)return!1;if(!0===b||a===b)return!0;if("string"===typeof b){if(0>a.indexOf(" "))return!1;b=Ta[b]||f(b)}return 0<=a.search(b)?!0:!1}}function l(a,
b,c){if(a&&b){if("string"===typeof a){if(!(a=document.getElementById(a)))return}else{if(window.NodeList&&a instanceof window.NodeList)return l(q(a),b,c);if(a.length&&!a.nodeType){a=q(a);for(var d=0,n=a.length;d<n;)l(a[d++],b,c||!1);return}if(!c&&a.classList&&"string"===typeof b){a.classList.add(b);return}}if((d=(c?a.getAttribute(c)||"":a.className)||null)&&"string"!==typeof d)return M.warn("Non string classname for %o",a),!1;if(!d)return a.className=b,!0;var n=Ta[b]||f(b),e=d;if(d===b||0<=d.search(n))return!1;
e=b+" "+d;c?(a.setAttribute(c,e),a.className=a.className):a.className=e;return!0}}function d(a,b,c,n){if(a){if("string"===typeof a){if(!(a=document.getElementById(a)))return}else{if(window.NodeList&&a instanceof window.NodeList)return d(q(a),b,c);if(a.length&&!a.nodeType){a=q(a);n=0;for(var e=a.length;n<e;)d(a[n++],b,c||!1);return}if(!c&&a.classList&&"string"===typeof b){a.classList.remove(b);return}}e=(c?a.getAttribute(c)||"":a.className)||null;if("string"!==typeof e||""===e)return!1;var w="string"===
typeof b?Ta[b]||f(b):b,h=e;if(e===b)h="";else if(0<=e.search(w))h=e.replace(w,"");else return!1;h&&(h=h.replace(ma," ").replace(Ba,""));c?h?(a.setAttribute(c,h),a.className=a.className):n||(a.removeAttribute(c),a.className=a.className):a.className=h?h:"";return!0}}function c(a,b,d,n){if("string"===typeof a)a=document.getElementById(a);else{if(window.NodeList&&a instanceof window.NodeList)return c(q(a),b,d);if(a.length&&!a.nodeType){a=q(a);n=0;for(var e=a.length;n<e;)c(a[n++],b,d||!1);return}if(!d&&
a.classList&&"string"===typeof b){a.classList.toggle(b);return}}e=(d?a.getAttribute(d)||"":a.className)||null;if("string"!==typeof e||""===e)return d?a.setAttribute(d,b):a.className=b,!0;var w="string"===typeof b?Ta[b]||f(b):b,h=e;if(e===b)h="";else if(0<=e.search(w))h=e.replace(w,"");else return d?a.setAttribute(d,e+" "+b):a.className=e+" "+b,!0;h&&(h=h.replace(ma," ").replace(Ba,""));d?h?(a.setAttribute(d,h),a.className=a.className):n||(a.removeAttribute(d),a.className=a.className):a.className=
h;return!1}function z(a,b,d,n,e){(a=G(a,b))&&c(a,d,n,e)}function h(a,b){var c,d;if(a){if(Ya[a])return Ya[a];if(!(this instanceof h))return h.call(new h,a)}else return this;if(Array.isArray(a)||"string"===typeof a&&0<a.indexOf(",")){var n=[],e=[];if("string"===typeof a)e=a.split(",");else for(c=0,d=a.length;c<d;)"string"!==typeof a[c]?c++:0<=a[c].indexOf(",")?e=e.concat(a[c++].split(",")):e.push(a[c++]);c=0;for(d=e.length;c<d;){var w;w=e[c++];var R=w.search(/\S/),t=w.search(/\s+$/g);w=0===R&&0>t?w:
w.slice(R,t);(w=new h(w))&&n.push(w)}this.compound=n;Ya[a]=this;return this}n=a.match(Y);e=[];w=[];R=!1;n||M.warn("Couldn't parse spec %s",a);if(n)for(c=0,d=n.length,"."!==n[0][0]&&"#"!==n[0][0]&&"["!==n[0][0]&&(this.tag=b?n[0]:n[0].toUpperCase(),c=1);c<d;)if("#"===n[c][0])this.id=n[c++].slice(1);else if("."===n[c][0])w.push(n[c].slice(1)),e.push(f(n[c++].slice(1)));else if("["===n[c][0]){var t=n[c++],l=t.length-1;R||(R={});var k=t.indexOf("=");0>k?R[t.slice(1,l)]=!0:"~"===t[k+1]?R[t.slice(1,k)]=
f(t.slice(k+2,l)):R[t.slice(1,k)]=t.slice(k+1,l)}else M.uhoh("weird elts %o",n[c++]);e.length&&(this.classes=e,this.classnames=w);R&&(this.attribs=R);this.rank=[0,this.id?1:0,w.length+R.length,1];Ya[a]=this;return this}function B(a,b,c){if(1===a.nodeType){var d=a.className;"string"===typeof d&&0<=d.search(b)&&c.push(a);if(a=a.childNodes)for(var d=0,n=a.length;d<n;)B(a[d++],b,c)}}function v(a,b,c){if(1===a.nodeType&&(("string"===typeof b?a.tagName.toLowerString()===b:b instanceof RegExp&&b.match(a.tagName))&&
c.push(a),a=a.childNodes))for(var d=0,n=a.length;d<n;)v(a[d++],b,c)}function H(a,b,c,d){if(1===a.nodeType&&(a.getAttribute(b)&&("string"===typeof c?a.getAttribute(b)===c:0<=a.getAttribute(b).search(c))&&d.push(a),a=a.childNodes))for(var n=0,e=a.length;n<e;)H(a[n++],b,c,d)}function G(a,b){"string"===typeof a&&(a="#"===a[0]?document.getElementById(a.slice(1)):document.getElementById(a));if(a&&b){if(b.nodeType){for(;a;){if(a===b)return b;a=a.parentNode}return!1}if("function"===typeof b){for(;a;){if(b(a))return a;
a=a.parentNode}return!1}if(b instanceof h){for(;a;){if(1===a.nodeType&&b.match(a))return a;a=a.parentNode}return!1}if(b instanceof RegExp){for(;a;){if(1===a.nodeType&&a.className&&b.test(a.className))return a;a=a.parentNode}return!1}if("string"===typeof b)return G(a,new h(b));throw{error:"invalid parent spec"};}return!1}function x(a,b,c,d){"string"===typeof a&&(a=r(a));if(!a)return[];d||(d=[]);if(c){if("string"!==typeof c)throw{error:"bad selector arg",selector:b};c=c||!1;var n=d;c?"class"===c?B(a,
b,n):"tagName"===c?v(a,b,n):H(a,c,b,n):B(a,b,n)}else if("function"===typeof b)D(a,b,d);else if(b instanceof RegExp)N(a,b,d);else{if(b instanceof h)return b.find(a,d);if("string"===typeof b)return W&&a.querySelectorAll?a.querySelectorAll(b):x(a,new h(b),!1,d);if(b.length)for(var n=0,e=b.length;n<e;)x(a,b[n++],c,d)}return d}function y(a,b){var c=x(a,b);return c.length?c[0]:!1}function D(a,b,c){if(1===a.nodeType&&(b(a)&&c.push(a),a=a.childNodes))for(var d=0,n=a.length;d<n;)D(a[d++],b,c)}function N(a,
b,c){if(1===a.nodeType){var d=a.className;"string"===typeof d&&0<=d.search(b)&&c.push(a);if(a=a.childNodes)for(var d=0,n=a.length;d<n;)N(a[d++],b,c)}}function E(a){if(a instanceof Array)for(var b=0,c=a.length;b<c;)E(a[b++]);else b=a,"string"===typeof a&&(b="#"===a[0]?document.getElementById(a.slice(1)):document.getElementById(a)),b&&b.parentNode?b.parentNode.removeChild(b):b?M.uhoh("Looks like %o has already been removed (no parent)",b):M.uhoh("Can't find %o to remove it",a)}function F(a,b){if(a){if("string"===
typeof a){var c=a.search(/\w/g);if(0>a.search(/\W/g))return b+"."+a;if(0!==c)return b+a}else a.tagName||(a.tagName=b);return a}return b}function A(a,b,c){var d=[];if("string"===typeof a){var n=document.getElementById(a);n||M.warn("Couldn't resolve %s to an object",a);a=n}if(!a)return d;for(var n=a.getElementsByTagName("input"),e=0,w=n.length;e<w;)b&&n[e].name!==b||c&&n[e].type!==c?e++:d.push(n[e++]);if(!c||"textarea"===c||"text"===c)for(n=a.getElementsByTagName("textarea"),e=0,w=n.length;e<w;)b&&
n[e].name!==b||c&&n[e].type!==c?e++:d.push(n[e++]);if(!c||"button"===c||"submit"===c)for(n=a.getElementsByTagName("button"),e=0,w=n.length;e<w;)b&&n[e].name!==b||c&&n[e].type!==c?e++:d.push(n[e++]);if(!c||"select"===c)for(n=a.getElementsByTagName("select"),e=0,w=n.length;e<w;)b&&n[e].name!==b?e++:d.push(n[e++]);return d}function L(a,b,c){"string"===typeof a&&(a=document.getElementById(a));if(!a)return[];var d=[];a=a.getElementsByTagName("input");for(var n=0,e=a.length;n<e;){var w=a[n++];w.name===
b&&w.value===c&&d.push(w)}return d}function O(a,b){"string"===typeof a&&(a=document.getElementById(a));if(!a)return a;if(1!==a.nodeType)throw"Not an element";try{var c=window.getComputedStyle&&window.getComputedStyle(a,null)||a.currentStyle;return c?b?c[b]:c:!1}catch(d){return M("Unexpected style error %o",d),!1}}function P(a){a=a.style;var b;if(!a)return!1;var c=0,d=a.length;if(0===d)return!1;for(;c<d;){var n=a[c],e=a[n];b=0===c?n+": "+e:b+"; "+n+": "+e;c++}return b}function S(a,b,c,d){if(a.nodeType){if(3===
a.nodeType)return b?a.nodeValue.replace(/\s+/," "):a.nodeValue;if(1===a.nodeType){c=a.childNodes;var n=O(a),e=n.display,w=n.position,h=a.className,f="",R="";"normal"!==n.whiteSpace&&(b=!1);if("none"===e||"static"!==w&&""!==w||"string"===typeof h&&("fdjtskiptext"===h||0<=h.search(/\bfdjtskiptext\b/)))return"";if(!c||0===c.length)return d?a.alt?"["+a.alt+"]":"[?]":"";e&&"inline"!==e&&(b?R=" ":"block"===e||"table"===e||"preformatted"===e?R=f="\n":"table-row"===e?R="\n":"table-cell"===e&&(f="\t"));for(a=
0;a<c.length;)n=c[a++],n.nodeType&&(3===n.nodeType?f=b?f+n.nodeValue.replace(/\s+/," "):f+n.nodeValue:1===n.nodeType&&(n=S(n,b,!0,d))&&(f+=n));return f+R}}else return a.toString()}function t(a,b,c,d){d||(d=!1);"string"===typeof a&&(a=document.getElementById(a));var n=a.offsetTop,e=a.offsetLeft,w=a.offsetWidth,h=a.offsetHeight,f=b&&b.offsetParent;c=c&&O(a);d=d?[]:!1;if(a===b)return{left:0,top:0,width:w,height:h,bottom:h,right:w};for(a=a.offsetParent;a&&(!b||a!==b&&a!==f);)d&&d.push(a),n+=a.offsetTop,
e+=a.offsetLeft,a=a.offsetParent;if(c){a=p(c.marginTop);b=p(c.marginRight);var f=p(c.marginBottom),R=p(c.marginLeft),t=p(c.paddingTop),l=p(c.paddingRight),k=p(c.paddingBottom),g=p(c.paddingLeft),J=p(c.borderTopWidth),sa=p(c.borderRightWidth),z=p(c.borderBottomWidth),L=p(c.borderLeftWidth),v=w+R+b,m=h+a+f,A=w-(L+g+sa+l),Q=h-(J+t+z+k),B=c.lineHeight;c=c.fontSize;var T=!1,T="normal"===B?p(c):0<B.search(/px$/)?p(B):0<B.search(/%$/)?parseFloat(B.slice(0,-1))/100*p(c):p(c);return{left:e,top:n,width:w,height:h,
right:e+w,bottom:n+h,top_margin:a,bottom_margin:f,left_margin:R,right_margin:b,top_border:J,bottom_border:z,left_border:L,right_border:sa,top_padding:t,bottom_padding:k,left_padding:g,right_padding:l,outer_height:m,outer_width:v,inner_height:Q,inner_width:A,line_height:T,stack:d}}return{left:e,top:n,width:w,height:h,right:e+w,bottom:n+h,stack:d}}function Q(a){if(3===a.nodeType)return a.nodeValue.length;if(1!==a.nodeType)return 0;var b=O(a),c=b.position;if("none"===b.display||""!==c&&"static"!==c||
"string"!==typeof a.className||"fdjtskiptext"===a.className||0<=a.className.search(/\bfdjtskiptext/))return 0;if(a.childNodes){a=a.childNodes;for(var b=0,c=a.length,d=0;b<c;){var n=a[b++];3===n.nodeType?d+=n.nodeValue.length:1===n.nodeType&&(d+=Q(n))}return d}return a.alt?a.alt.length+2:3}function aa(a,b,c,d){if(a===d)return!1;if(3===a.nodeType)return 0<=e.nodeValue.search(/\w/g);if(1!==a.nodeType)return!1;if(c&&c.match&&c.match(a)||0===a.tagName.search(Ja))return!0;if(!("string"===typeof a.className&&
0<=a.className.search(/\bfdjtskiptext\b/g))&&a.childNodes&&a.childNodes.length){a=a.childNodes;for(var n=0;n<a.length;){var e=a[n++];if(e===d)break;else if(3===e.nodeType){if(0<=e.nodeValue.search(/\w/g))return!0}else if(1===e.nodeType&&b&&aa(e,b,c,d))return!0}}return!1}function X(a){var b=!1,c=!1,d=!1,n=!1;a=a.childNodes;for(var e=0,w=a.length;e<w;){var h=a[e++];if("number"===typeof h.offsetLeft){var f=O(h);if("static"===f.position){var R=h.offsetLeft-p(f.marginLeft),t=h.offsetTop-p(f.marginTop),
l=h.offsetLeft+h.offsetWidth+p(f.marginRight),h=h.offsetTop+h.offsetHeight+p(f.marginBottom);!1===b?(b=R,d=l,c=t,n=h):(R<b&&(b=R),t<c&&(c=t),l>d&&(d=l),h>n&&(n=h))}}}return{left:b,right:d,top:c,bottom:n,width:d-b,height:n-c}}function C(b,c){var d=a.getChildren(b,"IMG"),n=d.length;if(c){b.scale=c;b.style.fontSize=c+"%";var e=10*Math.round(c/10);a.addClass(b,"fdjtscaled");a.swapClass(b,/\bfdjtscale\d+\b/,"fdjtscale"+e)}else if(b.scale)delete b.scale,b.style.fontSize="",a.dropClass(b,"fdjtscaled"),a.dropClass(b,
/\bfdjtscale\d+\b/);else return;for(e=0;e<n;){var w=d[e++];if(!a.hasClass(w,"nofdjtscale")&&!a.hasClass(w,"noautoscale")&&(w.style.maxWidth=w.style.width=w.style.maxHeight=w.style.height="",c)){var h=w.offsetHeight;w.style.maxWidth=w.style.width=Math.round(c/100*w.offsetWidth)+"px";w.style.maxHeight=w.style.height=Math.round(c/100*h)+"px"}}}function Z(a,b){var c,d;c=[];"string"===typeof a&&"undefined"===typeof b&&("^"===a[0]?(b=!1,a=a.slice(1)):"~"===a[0]&&(b=!0,a=a.slice(1)));"undefined"===typeof b&&
(b=!0);if("string"!==typeof a)return a;if("{"===a[0]){d=!1;var n=a.indexOf("}");2<n&&(d=a.slice(1,n));c=d&&La[d]||[];return new RegExp("\\b("+$a(d)+"|"+c.join("|")+")[.]"+a.slice(n+1)+"\\b",b?"i":"")}if("="===a[0])return new RegExp("\\b"+$a(a.slice(1))+"\\b",b?"i":"");if("*"===a[0]&&"."===a[1])return new RegExp("\\b([^.]\\.)?"+a.slice(2)+"\\b",b?"i":"");if(0<a.indexOf(".")){n=a.indexOf(".");c=a.slice(0,n);if(d=wa[c])c=d&&La[d]?La[d]:[c];else return new RegExp("\\b"+$a(a)+"\\b",b?"i":"");return new RegExp("\\b("+
$a(d)+"|"+c.join("|")+")\\."+a.slice(n+1)+"\\b",b?"i":"")}return new RegExp("\\b"+a+"\\b",b?"i":"")}function ja(a,b,c,d){var n=[],e=document.getElementsByTagName?document.getElementsByTagName("META"):x(document,"META");a=Z(a,c);for(c=0;c<e.length;){var w=e[c++];if(w&&w.name&&0<=w.name.search(a))if(b)d?n.push(w):n.push(w.content);else return d?w:w.content}return b?n:!1}function U(a,b,c,d){var n=[],e=document.getElementsByTagName?document.getElementsByTagName("LINK"):document.body&&document.body.getElementsByTagName?
document.body.getElementsByTagName("LINK"):x(document,"LINK");a=Z(a,c);for(c=0;c<e.length;){var w=e[c++];if(w&&w.rel&&0<=w.rel.search(a))if(b)d?n.push(w):n.push(w.href);else return d?w:w.href}return b?n:!1}function ka(a){for(;a;){if(a.nextSibling)return a.nextSibling;a=a.parentNode}return!1}function T(a){if(a.nextElementSibling)return a.nextElementSibling;for(;a=a.nextSibling;){if(!a)return null;if(1===a.nodeType)break}return a}function J(a){if(a.childNodes&&0<a.childNodes.length)return a.childNodes[0];
for(;a;){if(a.nextSibling)return a.nextSibling;a=a.parentNode}return!1}function n(a,b){var c,d,e;if(b){d=0;for(c=a;d<b;)c=n(c),d++;return c}if(ia){if(a.children&&0<a.children.length)return a.children[0];if(c=a.nextElementSibling)return c;for(;a=a.parentNode;)if(c=a.nextElementSibling)return c}else{if(a.childNodes){var w=a.childNodes;d=0;for(e=w.length;d<e;)if((c=w[d++])&&1===c.nodeType)return c}for(;c=a.nextSibling;)if(1===c.nodeType)return c;for(;a=a.parentNode;)if(c=T(a))return c}return!1}function w(a){for(;a;){if(a.previousSibling)return a.previousSibling;
a=a.parentNode}return!1}function sa(a){if(ia)return a.previousElementSibling;for(;a=a.previousSibling;){if(!a)return null;if(1===a.nodeType)break}return a?a:a.parentNode}function R(a){if(a.previousSibling){a=a.previousSibling;if(1!==a.nodeType)return a;for(;a;){var b=a.childNodes;if(b)if(0===b.length)break;else a=b[b.length-1];else break}return a}return a.parentNode}function ua(a){return ia?a.previousElementSibling?ab(a.previousElementSibling):a.parentNode:a.previousElementSibling||a.previousSibling?
(a=a.previousElementSibling||a.previousSibling,1===a.nodeType?ab(a):a):a.parentNode}function ab(a){if(1===a.nodeType){if(a.childNodes){var b=a.childNodes;if(!b.length)return a;for(var c=b.length-1;0<=c;){var d=ab(b[c--]);if(d)return d}}return a}return!1}function Pa(a){if("string"!==typeof a||(a=document.getElementById(a)))return a||(a=window),a.hasOwnProperty("innerHeight")?a.innerHeight:a.document&&window.document.documentElement&&window.document.documentElement.clientHeight?window.document.documentElement.clientHeight:
a.offsetHeight}function Na(a){if("string"!==typeof a||(a=document.getElementById(a)))return a||(a=window),a.hasOwnProperty("innerWidth")?a.innerWidth:a.document&&window.document.documentElement&&window.document.documentElement.clientWidth?window.document.documentElement.clientWidth:a.offsetWidth}function bb(a,b,c){b||(b=!1);c||(c=!1);a.id&&(c&&a.setAttribute(c,a.id),a.id="",a.removeAttribute("id"));b&&a.name&&(a.name=null);if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var d=0,n=a.length;d<
n;){var e=a[d++];1===e.nodeType&&bb(e,b,c)}}}function Oa(a,b){a=a.toLowerCase();if(document.styleSheets)for(var c=0;c<document.styleSheets.length;c++)for(var d=document.styleSheets[c],n=d.cssRules||d.rules,e=n&&n.length,w=0;w<e;){if(n[w]){var h=n[w];if(h.selectorText.toLowerCase()===a)return"delete"===b?(d.cssRules&&d.deleteRule(w),!0):h}w++}return!1}function eb(a,b,c){a||(a=document);if("string"===typeof a){var d=r(a);if(!a){M.warn("Can't find #%s",a);return}a=d}else{if(Array.isArray&&Array.isArray(a)||
window.NodeList&&a instanceof window.NodeList){for(var d=0,n=a.length;d<n;)eb(a[d++],b,c);return}if(a!==window&&!a.nodeType){M.warn("Bad target(s) arg to addListener(%s) %o",b,a);return}}if("title"===b)"string"===typeof c&&(a.title=a.title?"("+c+") "+a.title:c);else if("="===b[0])a[b.slice(1)]=c;else{if(a.addEventListener)return a.addEventListener(b,c,!1);if(a.attachEvent)return a.attachEvent("on"+b,c);M.warn("This node never listens: %o",a)}}function Wa(a,b){if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=
!1;if(b[c].call)if(Ha.exec(c))eb(a,c,b[c]);else if(d=Ca.exec(c)){var n=d[2],e=b[c],d=a.querySelectorAll(d[1]);eb(d,n,e)}}}function xa(a,b,c){a||(a=document);if("string"===typeof a){var d=r(a);if(!a){M("Can't find #%s",a);return}a=d}else{if(Array.isArray&&Array.isArray(a)||window.NodeList&&a instanceof window.NodeList){for(var d=0,n=a.length;d<n;)xa(a[d++],b,c);return}if(a!==window&&!a.nodeType){M.warn("Bad target(s) arg to removeListener(%s) %o",b,a);return}}if(a.removeEventListener)return a.removeEventListener(b,
c,!1);if(a.detachEvent)return a.detachEvent("on"+b,c);M.warn("This node never listens: %o",a)}function Ra(b,c,d,n){d||(d=b.getAttribute("data-origin"));n||(n=b.getAttribute("data-shrink"));c||(c=b.getAttribute("data-fudge"));var e=b.firstChild;(e="fdjtadjusted"===e.className?e:y(b,"fdjtadjusted"))&&e.setAttribute("style","");var w=t(b,!1,!0),h=X(b),f=c?c*w.inner_width:w.inner_width;c=c?c*w.inner_height:w.inner_height;if(!(h.height<=c&&h.width<=f&&(!n||h.height<c&&h.height>=.9*c||h.width<w.inner_width&&
h.width>=.9*c))){if(!e){n=[];for(var e=b.childNodes,w=0,R=e.length;w<R;)n.push(e[w++]);e=a("div.fdjtadjusted");w=0;for(R=n.length;w<R;)e.appendChild(n[w++]);b.appendChild(e)}b=f/h.width;h=c/h.height;b=b<h?b:h;e.style[a.transform]="scale("+b+","+b+")";e.style[a.transformOrigin]=d||"50% 0%"}}function na(){for(var b=a.$(".fdjtadjustfit"),c=0,d=b.length;c<d;)Ra(b[c++])}function ha(b,c,d){a.addClass(b,"fdjtadjustfit");c&&"number"!==typeof c&&(c=.9);c&&b.setAttribute("data-fudge",c);d&&b.setAttribute("data-origin",
d);Ra(b,c,d);return b}function cb(a,b){b||(e(a,"fdjtadjusted")?(b=a,a=b.parentNode):b="fdjtadjusted"===a.firstChild.className?a.firstChild:y(a,"fdjtadjusted"));if(a&&b){for(var c=[],d=b.childNodes,n=0,w=d.length;n<w;)c.push(d[n++]);d=document.createDocumentFragment();n=0;for(w=c.length;n<w;)d.appendChild(c[n++]);a.replaceChild(d,b);return a}return!1}function za(){"undefined"===typeof Da&&(Da=document.implementation&&document.implementation.hasFeature?!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image",
"1.1"):"Microsoft Internet Explorer"===navigator.appName?!0:navigator.mimeTypes["image/svg+xml"]?!1:!0);Da?(l(document.body,"_NOSVG"),d(document.body,"_USESVG")):(d(document.body,"_NOSVG"),l(document.body,"_USESVG"));return!Da}function oa(){for(var a=Fa.hasSuffix,b=fdjt.$("IMG"),c=0,d=b.length;c<d;){var n=b[c++],e=n.src;e&&!a(e,".svg")&&!a(e,".svgz")&&n.getAttribute("svg")&&(e=n.getAttribute("svg"),n.setAttribute("bmp",n.src),n.src=e)}}function Va(a,b){var c,d;b||(b="");if(!a.nodeType&&a.length)for(c=
0,d=a.length;c<d;)b=Va(a[c++],b);else if(3===a.nodeType){var n=a.nodeValue;n&&(b+=n)}else if(1===a.nodeType){c=O(a);n=a.childNodes;if(a.className&&0<=a.className.search(/\bfdjtskiptext\b/)||"none"===c.display||"hidden"===c.visibility||"static"!==c.position&&""!==c.position)return b;c=0;for(d=n.length;c<d;){var e=n[c++];3===e.nodeType?(e=e.nodeValue)&&(b+=e):b=Va(e,b)}}return b}function Qa(a,b,c,d){var n,e;if(c>b)return!1;if(!a.nodeType&&a.length){n=0;for(e=a.length;n<e&&(c=Qa(a[n++],b,c,d),"number"===
typeof c););return c}if(3===a.nodeType)return d=a.nodeValue,b<c+d.length?{node:a,off:b-c}:b===c+d.length?{node:a,off:b-c,atend:!0}:c+d.length;if(1===a.nodeType){n=O(a);var w=a.childNodes;if(a.className&&0<=a.className.search(/\bfdjtskiptext\b/)||"none"===n.display||"hidden"===n.visibility||"static"!==n.position&&""!==n.position)return c;n=0;for(e=w.length;n<e;)if(c=Qa(w[n++],b,c,d),"number"!==typeof c){if(d&&c.atend)for(c=b;n<e;)if((a=Qa(w[n++],c,b,d))&&"number"!==typeof a)return a;break}}return c}
function da(a,b,c){c=Qa(a,b,c||0);return"number"!==typeof c?c:{node:a,off:b}}function Xa(a,b,c){c||(c=0);if(a===b)return[c];if(3===a.nodeType)return c+a.nodeValue.length;if(1===a.nodeType){a=a.childNodes;for(var d=0,n=a.length;d<n;){var e=a[d++];c=Xa(e,b,c);if("number"!==typeof c)break}}return c}function va(a,b){var c=Xa(a,b,0);return c?c[0]:!1}function V(a){for(;a&&!a.id;)a=a.parentNode;return a}function K(a,b,c,d){return b?(a=a.replace("\u00ad",""),(c||"")+a.replace(/[()\[\]\.\?\+\*]/gm,"[$&]").replace(/\S/g,
"$&\u00ad?").replace("\u00ad? "," ").replace(/\s+/g,"(\\s+)")+(d||"")):(c||"")+a.replace(/[()\[\]\.\?\+\*]/gm,"[$&]").replace(/\s+/g,"(\\s+)")+(d||"")}function I(a,b,c){return new RegExp(K(a,!0,b,c),"gm")}function Ua(a){return a?3===a.nodeType?a:1===a.nodeType?Ua(a.firstChild):!1:!1}function Ka(a){a=document.createElement("input");for(var b=0,c=fb.length;b<c;){var d=fb[b++];try{a.type=d}catch(n){}if(a.type===d)for(var e=x(document.body,".fdjt"+d+"input"),w=0,h=e.length;w<h;){var f=e[w++];"INPUT"===
f.tagName&&(f.type=d)}}}function ga(a,b){if("string"===typeof a&&0===a.search("data:")){if(!b){var c=/data:([^;]+);/.exec(a);c&&(b=c[1])}for(var d=a.split(","),c=atob(d[1]),c=0<=d[0].indexOf("base64")?atob(d[1]):window.unescape(d[1]),d=new ArrayBuffer(c.length),n=new Uint8Array(d),e=0;e<c.length;e++)n[e]=c.charCodeAt(e);return new Blob([d],{type:b||"application"})}return!1}function Ga(a,b,c,d,n,e,w,h,f){var R=a.scrollWidth,t=a.scrollHeight;c=a.style;"number"!==typeof f&&(f=1);if(R<=w&&t<=h&&t>=h-
f)return d;if(R>w||t>h)b=-b;0<b&&(c.maxWidth=Math.floor(w)+"px");d||(d=100,c.fontSize=d+"%");n||(n=20);e||(e=150);f=d+b;c.fontSize=f+"%";R=a.scrollWidth;for(t=a.scrollHeight;d>=n&&d<=e&&(0<b?R<=w&&t<=h:R>w||t>h);)d=f,f+=b,c.fontSize=f+"%",R=a.scrollWidth,t=a.scrollHeight;c.maxWidth="";return 0<b?(c.fontSize=d+"%",d):f}function ea(b,c,d,n,w){var h=b.offsetHeight,f=b.offsetWidth,R="";"undefined"===typeof w&&(w=e(b,"fdjtlog"));if(0===h||0===f)if(R=b.style.display,b.style.display="initial",h=b.offsetHeight,
f=b.offsetWidth,0===h||0===f){b.style.display=R;return}if(0===h||0===f)b.style.display=R;else{var t=u(b,"div.fdjtfontwrapper"),l=t.style,g=100;l.boxSizing="border-box";l.padding=l.margin="0px";l.fontSize=g+"%";l.transitionProperty="none";l.transitionDuration="0s";l[a.transitionProperty]="none";l[a.transitionDuration]="0s";l.visibility="visible";l.overflow="auto";if(0===h||0===f)b.removeChild(t),a.append(b,k(t.childNodes)),b.style.display=R;else return c=c||b.getAttribute("data-minfont")||20,d=d||
b.getAttribute("data-maxfont")||200,"number"!==typeof n&&(n=b.getAttribute("data-fudge")),"string"===typeof c&&(c=parseFloat(c,10)),"string"===typeof d&&(d=parseFloat(d,10)),"string"===typeof n&&(n=parseInt(n,10)),"number"!==typeof n&&(n=2),l.width=l.height="100%",f=t.offsetWidth,h=t.offsetHeight,l.width=l.height="",g=Ga(t,10,!1,g,c,d,f,h,n),g=Ga(t,5,!1,g,c,d,f,h,n),g=Ga(t,1,!1,g,c,d,f,h,n),b.style.display=R,100===g?(w&&M("No need to resize %o towards %dx%d",b,f,h),b.removeChild(t),a.append(b,k(t.childNodes))):
(l.overflow="",l.width="",l.height="",w&&M("Adjusted (%s) %o towards %dx%d, wrapper @ %d,%d",l.fontSize,b,f,h,t.scrollWidth,t.scrollHeight),l.transitionProperty="",l.transitionDuration="",l[a.transitionProperty]="",l[a.transitionDuration]="",O(t)[a.transitionProperty]?(l.fontSize="",l.visibility="",l.fontSize=g+"%"):l.visibility=""),g}}function fa(b,c){var d=[];b?"string"===typeof b?document.getElementByID(b)?d=[document.getElementByID(b)]:(a.autofont=a.autofont+","+b,d=a.$(b)):d=1===b.nodeType?(new h(a.autofont)).match(b)?
[b]:a.getChildren(b,a.autofont):a.$(a.autofont):d=a.$(a.autofont);var n=0,e=d.length;if(e)for(;n<e;)ea(d[n++]);else c&&ea(c)}function Aa(a){if(a&&1===a.nodeType){var b=O(a);if(a.childNodes&&a.childNodes.length)for(var c=a.childNodes,d=0,n=c.length;d<n;){var e=c[d++];1===e.nodeType&&Aa(e)}"block"!==b.display&&"inline-block"!==b.display||"absolute"!==b.position&&"fixed"!==b.position||ea(a)}}function ra(){var a=fdjt.device,b=fdjt.cxprefix||"_";a.ios&&l(document.body,b+"IOS");a.touch&&l(document.body,
b+"TOUCH");a.mouse&&l(document.body,b+"MOUSE");a.android&&l(document.body,b+"Android")}function ya(a){l(document.body,"_FOCUS")}function pa(a){d(document.body,"_FOCUS")}var W=!0,Fa=fdjt.String,M=fdjt.Log,Y=/((^|[.#])[^.#\[\s]+)|(\[[^ \]=]+=[^\]]+\])|(\[[^ \]=]+\])/ig;a.useNative=function(a){if("undefined"===typeof a)return W;W=a};a.clone=function(a){return a.cloneNode(!0)};a.ie=function(){if("Microsoft Internet Explorer"===navigator.appName){var a;a=null!==/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(navigator.userAgent)?
parseFloat(RegExp.$1):1;0>=a&&(a=1);return a}return 0}();a.iem=Math.floor(a.ie);fdjt.ID=r;a.appendArray=g;a.toArray=k;a.Array=q;a.slice=q;a.wrapChildren=u;a.unwrapChildren=function(a,b){"string"===typeof a?a=b?fdjt.DOM.getChildren(b,a):fdjt.DOM.$(a):a.nodeType&&(a=[a]);for(var c=0,d=a.length;c<d;){var n=a[c++],e=document.createDocumentFragment();g(e,k(n.childNodes));n.parentNode.replaceChild(e,n)}};a.parsePX=p;a.getLineHeight=function(a){var b=O(a);a=b.lineHeight;b=b.fontSize;return"normal"===a?p(b):
0<a.search(/px$/)?p(a):0<a.search(/%$/)?parseFloat(a.slice(0,-1))/100*p(b):p(b)};var ma=/(\s)+/,Ba=/^(\s)+|(\s)+$/,Ta={};a.nodeString=function(a){if(3===a.nodeType)return"<'"+a.value+"'>";if(1===a.nodeType){var b="<"+a.tagName;a.id&&(b=b+"#"+a.id);"input"===a.tagName?(b=b+"[type="+a.type+"]",b=b+"[name="+a.name+"]"):"textarea"===a.tagName?b=b+"[name="+a.name+"]":"img"===a.tagName&&(a.alt?b=b+"[alt="+a.alt+"]":a.src&&(b=b+"[src="+a.src+"]"));"string"===typeof a.className&&(b=b+"."+a.className.replace(/\s+/g,
"."));return b+">"}return a.toString()};a.make=function(b,c,d,n){b=a(b);n||(n=d);d&&fdjt.Template(c,d);n.id&&!b.id&&(b.id=n.id);n.title&&!b.title&&(b.title=n.title);n.name&&!b.name&&(b.name=n.name);n.href&&!b.href&&(b.href=n.href);n.value&&!b.value&&(b.value=n.value);n.src&&!b.src&&(b.src=n.src);n.alt&&!b.alt&&(b.alt=n.alt);Wa(b,n);return b};a.getElementValues=b;a.getElementValue=function(a,c,d){return b(a,c,d,!1)};a.hasClass=e;a.addClass=l;a.aC=l;a.classAdder=function(a,b){return function(){a&&l(a,
b)}};a.dropClass=d;a.dC=d;a.classDropper=function(a,b){return function(){a&&d(a,b)}};a.swapClass=function(a,b,c,n){d(a,b,n);l(a,c,n)};a.setClass=function(a,b,c){"string"===typeof a&&(a=document.getElementById(a));c?l(a,b):d(a,b)};a.toggleClass=c;a.tC=c;a.toggleParent=z;a.tP=z;a.isTextInput=function(a){return"INPUT"===a.tagName&&0===a.type.search(/text|url|email|search|password/i)||"TEXTAREA"===a.tagName};var Ya={};h.prototype.match=function(a){var b,c;if(this.compound){var d=this.compound;b=0;for(c=
d.length;b<c;)if(d[b++].match(a))return!0;return!1}if(this.tag&&this.tag!==a.tagName||this.id&&this.id!==a.id)return!1;if(this.classes)if("string"===typeof a.className){var n=a.className,e=this.classes;b=0;for(c=e.length;b<c;)if(0>n.search(e[b++]))return!1}else return!1;if(this.attribs)for(d in b=this.attribs,b)if(b.hasOwnProperty(d)){c=a.getAttribute(d);if(!c)return!1;n=this[d];if(!0!==n)if("string"===typeof n){if(n!==c)return!1}else if(0>c.search(n))return!1}return!0};h.prototype.find=function(a,
b){var c,d,n;b||(b=[]);if(this.compound){c=this.compound;d=0;for(n=c.length;d<n;)c[d++].find(a,b);return b}if(this.id)return(c=document.getElementById(this.id))&&this.match(c)&&b.push(c),b;c=[];d=this.classnames;n=this.attribs;if(this.classes)a.getElementsByClassName?c=a.getElementsByClassName(d[0]):B(a,this.classes[0],c);else if(this.tag&&a.getElementsByTagName)c=a.getElementsByTagName(this.tag);else if(this.attribs){n=this.attribs;for(var e in n)if(n.hasOwnProperty(e)){H(a,e,n[e],c);break}}else this.tag&&
v(a,this.tag,c);if(0===c.length)return c;if(this.tag&&!this.classes&&!this.attribs||!this.tag&&this.classes&&1===this.classes.length&&!this.attribs){if(b.length){d=b;n=0;for(e=c.length;n<e;)d.push(c[n]),n++;return d}return c instanceof Array?c:k(c)}d=0;for(n=c.length;d<n;)e=c[d++],this.match(e)&&b.push(e);return b};a.Selector=h;a.sel=function(a){if(a){if(a instanceof h)return a;if(a instanceof Array)return a.length?new h(a.join(",")):!1;if("string"===typeof a)return new h(a);M.warn("Non selector spec: %o",
a)}return!1};a.getParent=G;a.hasParent=G;a.$P=G;a.inherits=function(a,b){var c=new h(b);return c.match(a)?a:G(a,c)};a.getChildNodes=function(a){return 1!==a.nodeType?[]:a.childNodes?k(a.childNodes):[]};a.getChildren=x;fdjt.$=a.$=function(a,b){return k(x(b||document,a))};fdjt.$1=a.$1=a.getChild=a.getFirstChild=y;a.getAttrib=function(a,b,c){var d;c&&a.getAttributeByNS&&(d=a.getAttributeNS(b,c));return d?d:a.getAttribute(b)||a.getAttribute("data-"+b)};a.findAttrib=function(a,b,c){for(var d="data-"+b;a;){if(c&&
a.getAttributeNS&&a.getAttributeNS(b,c))return a.getAttributeNS(b,c);if(a.getAttribute){if(a.getAttribute(b))return a.getAttribute(b);if(a.getAttribute(d))return a.getAttribute(d)}a=a.parentNode}return!1};a.getFirstElement=function(a){return a.firstElementChild?a.firstElementChild:a.children&&a.children.length?a.children[0]:!1};a.getLastElement=function(a){return a.lastElementChild?a.lastElementChild:a.children&&a.children.length?a.children[a.children.length-1]:!1};a.replace=function(a,b,c){var d=
a;"string"===typeof a&&(d="#"===a[0]?document.getElementById(a.slice(1)):document.getElementById(a));d?(d.parentNode.replaceChild(b,d),c||!d.id||b.id||(b.id=d.id)):M.uhoh("Can't find %o to replace it with %o",a,b)};a.remove=E;a.removeChildren=function(a){for(var b=a.childNodes,c=b.length-1;0<=c;)a.removeChild(b[c--])};a.append=function(a){"string"===typeof a&&(a=document.getElementById(a));g(a,arguments,1)};a.prepend=function(a){"string"===typeof a&&(a=document.getElementById(a));a.firstChild?m(a.firstChild,
arguments,1):g(a,arguments,1)};a.insertBefore=function(a){"string"===typeof a&&(a=document.getElementById(a));m(a,arguments,1)};a.insertAfter=function(a){"string"===typeof a&&(a=document.getElementById(a));a.nextSibling?m(a.nextSibling,arguments,1):g(a.parentNode,arguments,1)};a.Input=function(b,c,d,n){0!==b.search(/\w/)&&(b="INPUT"+b);b=a(b);b.name=c;d&&(b.value=d);n&&(b.title=n);return b};a.Checkbox=function(b,c,d){var n=a("INPUT");n.type="checkbox";n.name=b;c&&(n.value=c);n.checked=d?!0:!1;return n};
a.Anchor=function(b,c){c=F(c,"A");var d=a(c);d.href=b;g(d,arguments,2);return d};a.Image=function(b,c,d,n){c=F(c,"IMG");var e=a(c);e.src=b;d&&(e.alt=d);n&&(e.title=n);g(e,arguments,4);return e};a.getInputs=A;a.getInput=function(a,b,c){var d=A(a,b||!1,c||!1);return d&&1===d.length?d[0]:d&&d.length?(M.warn("Ambiguous input reference name=%o type=%o under %o",b,c,a),d[0]):!1};a.getInputValues=function(a,b){for(var c=[],d=a.getElementsByTagName("input"),n=0,e=d.length;n<e;){var w=d[n++];w.name===b&&("checkbox"!==
w.type&&"radio"!==w.type||w.checked)&&c.push(w.value)}return c};a.getInputValue=function(a,b,c){var d=0;a=a.getElementsByTagName("input");for(var n=0,e=a.length;n<e;){var w=a[n++];if(!w.disabled&&w.name===b&&("checkbox"!==w.type&&"radio"!==w.type||w.checked))if(c){if(d===c)return w.value;d++}else return w.value}return!1};a.getInputsFor=L;a.getInputFor=function(a,b,c){return(c=L(a,b||!1,c||!1))&&1===c.length?c[0]:c&&c.length?(M.warn("Ambiguous input reference name=%o name=%o under %o",b,b,a),c[0]):
!1};a.setInputs=function(b,c){if(c)for(var d=a.$(b),n=0,e=d.length;n<e;)d[n++].value=c};a.getStyle=O;a.styleString=P;var qa={DIV:"block",P:"block",BLOCKQUOTE:"block",H1:"block",H2:"block",H3:"block",H4:"block",H5:"block",H6:"block",H7:"block",H8:"block",UL:"block",LI:"list-item",DL:"block",DT:"list-item",DD:"list-item",SPAN:"inline",EM:"inline",STRONG:"inline",TT:"inline",DEFN:"inline",A:"inline",TD:"table-cell",TR:"table-row",TABLE:"table",PRE:"preformatted"};a.getDisplay=function(a){return a&&a.nodeType&&
1===a.nodeType?window.getComputedStyle&&window.getComputedStyle(a,null)&&window.getComputedStyle(a,null).display||qa[a.tagName]||"inline":!1};a.textify=S;a.getGeometry=t;a.geomString=function(a){return+("number"===typeof a.width?a.width:NaN)+"x"+("number"===typeof a.height?a.height:"?")+"@l:"+("number"===typeof a.left?a.left:"?")+",t:"+("number"===typeof a.top?a.top:"?")+"/r:"+("number"===typeof a.right?a.right:"?")+",b:"+("number"===typeof a.bottom?a.bottom:"?")};a.isVisible=function(a,b){b||(b=
!1);if(a.offsetParent&&a.offsetParent!==document.body){var c=a.offsetParent,d=a.offsetTop,n=d+a.offsetHeight,e=a.offsetLeft,w=e+a.offsetWidth,h=c.scrollLeft,f=h+c.clientWidth,R=c.scrollTop,c=R+c.clientHeight;return b?(e>=h&&e<=f||w>=h&&w<=f||e<h&&w>f)&&(d>=R&&d<=c||n>=R&&n<=c||d<=R&&n>=c):e>=h&&e<=f&&w>=h&&w<=f&&d>=R&&d<=c&&n>=R&&n<=c}d=a.offsetTop;n=a.offsetLeft;e=a.offsetWidth;w=a.offsetHeight;h=window.pageXOffset||document.documentElement.scrollLeft||0;f=window.pageYOffset||document.documentElement.scrollTop||
0;R=h+document.documentElement.clientWidth;for(c=f+document.documentElement.clientHeight;a.offsetParent&&a!==window;)a=a.offsetParent,d+=a.offsetTop,n+=a.offsetLeft;a&&a!==window&&a!==document.body&&(a.scrollTop||a.scrollLeft)&&(M("Adjusting for inner DIV"),h=a.scrollLeft,f=a.scrollTop,R=h+a.scrollWidth,c=f+a.scrollHeight);return b?d>f&&d<c&&n>h&&n<R||d+w>f&&d+w<c&&n+e>h&&n+e<R||(d<f||n<h)&&d+w>c&&n+e>R:d>f&&n>h&&d+w<=c&&n+e<=R};a.isAtTop=function(a,b){b||(b=50);for(var c=a.offsetTop,d=window.pageYOffset||
document.documentElement.scrollTop||0,n=d+document.documentElement.clientHeight;a.offsetParent;)a=a.offsetParent,c+=a.offsetTop;return c>d&&c<n&&c<d+b};a.textWidth=Q;a.countBreaks=function(a){if("string"===typeof a)return a.match(/\W*\s+\W*/g).length;if(!a.nodeType)return 0;if(1!==a.nodeType)return 3===a.nodeType?a.nodeValue.match(/\W*\s+\W*/g).length:0};var Ja=/(img|object|svg|hr)/i;a.hasContent=aa;a.hasText=function(a){if(a.childNodes){a=a.childNodes;for(var b=0;b<a.length;){var c=a[b++];if(3===
c.nodeType&&0<=c.nodeValue.search(/\w/g))return!0}}return!1};a.refresh=function(a){a.className=a.className};a.setAttrib=function(a,b,c){"string"===typeof a&&r(a)&&(a=r(a));a.setAttribute(b,c);a.className=a.className};a.dropAttrib=function(a,b){"string"===typeof a&&r(a)&&(a=r(a));a.removeAttribute(b);a.className=a.className};a.overflowing=function(a){return a.scrollHeight>a.clientHeight};a.voverflow=function(a){return a.scrollHeight/a.clientHeight};a.hoverflow=function(a){return a.scrollWidth/a.clientWidth};
a.getInsideBounds=X;a.applyScale=C;a.adjustToFit=function(b,c,d){var n=b.traceadjust||a.trace_adjust||"string"===typeof b.className&&0<=b.className.search(/\btraceadjust\b/)||!1,e=O(b),w=t(b),h=e.maxHeight&&p(e.maxHeight)||w.height,w=e.maxWidth&&p(e.maxWidth)||w.width,f=c||.1;c=b.scale||100;var R=X(b),l=(a.parsePX(e.paddingLeft)||0)+(a.parsePX(e.paddingRight)||0)+(a.parsePX(e.borderLeftWidth)||0)+(a.parsePX(e.borderRightWidth)||0)+d;d=(a.parsePX(e.paddingTop)||0)+(a.parsePX(e.paddingBottom)||0)+(a.parsePX(e.borderTopWidth)||
0)+(a.parsePX(e.borderBottomWidth)||0)+d;w-=l;h-=d;d=1>=R.height/h&&1>=R.width/w;n&&M("Adjust (%o) %s cur=%o%s, best=%o~%o, limit=%ox%o=%o, box=%ox%o=%o, style=%s",f,a.nodeString(b),c,d?" (fits)":"",b.bestscale||-1,b.bestfit||-1,w,h,w*h,R.width,R.height,R.width*R.height,P(b));if(d&&(e=Math.max(1-R.width/w,1-R.height/h),l=b.bestfit||1.5,n&&(b.bestscale?M("%s %o~%o vs. %o~%o",e<f?"Good enough!":e<l?"Better!":"Worse!",c,e,b.bestscale,b.bestfit):M("First fit %o~%o",c,e)),e<l&&(b.bestscale=c,b.bestfit=
e),e<f)){b.goodscale=c;return}f=h/R.height;e=w/R.width;h=d?c*Math.sqrt(w*h/(R.width*R.height)):f<e?c*f:c*e;n&&M("[%fs] Trying newscale=%o, rw=%o rh=%o",fdjt.ET(),h,e,f);C(b,h,n)};a.adjustInside=function(b,c,d,n,e){function w(){var a=t(c),R=t(b,c),l=O(c),k=a.width-(p(l.paddingLeft,0)+p(l.borderLeft,0)+p(l.paddingRight,0)+p(l.borderRight,0)),a=a.height-(p(l.paddingTop,0)+p(l.borderTop,0)+p(l.paddingBottom,0)+p(l.borderBottom,0));h&&M("adjustInside scale=%o step=%o min=%o pad=%o [l%o,t%o,r%o,b%o] << %ox%o < %ox%o",
f,d,n,e,R.left,R.top,R.right,R.bottom,k*e,a*e,k,a);0<=R.top&&R.bottom<=e*a&&0<=R.left&&R.right<=e*k||f<=n||(f-=d,C(b,f,h),setTimeout(w,10))}var h=b.traceadjust||c.traceadjust||a.trace_adjust||"string"===typeof b.className&&0<=b.className.search(/\btraceadjust\b/)||"string"===typeof c.className&&0<=c.className.search(/\btraceadjust\b/)||!1;d||(d=5);n||(n=50);e||(e=1);var f=100;setTimeout(w,10)};a.insideBounds=X;a.finishScale=function(b){var c=b.traceadjust||a.trace_adjust||!1;b.bestscale?(b.scale!==
b.bestscale&&C(b,b.bestscale,c),c&&M("Final scale %o~%o for %o style=%s",b.bestscale,b.bestfit,a.nodeString(b),a.styleString(b)),delete b.bestscale,delete b.bestfit,delete b.goodscale):(C(b,!1,c),M("No good scaling for %o style=%s",a.nodeString(b),a.styleString(b)))};a.getHTML=function(){for(var a=document.childNodes,b=0,c=a.length;b<c;){if("HTML"===a[b].tagName)return a[b];b++}return!1};a.getHEAD=function(){for(var a=document.childNodes,b=0,c=a.length;b<c;)if("HTML"===a[b].tagName){a=a[b].childNodes;
b=0;for(c=a.length;b<c;){if("HEAD"===a[b].tagName)return a[b];b++}break}else b++;return!1};var La={},Ma={},wa={};a.addAppSchema=function(a,b){wa[a]=b};var $a=Fa.escapeRX;a.getMeta=ja;a.getMetaElts=function(a){return ja(a,!0,void 0,!0)};a.getLink=U;a.getLinks=function(a){return U(a,!0)};a.getLinkElts=function(a){return U(a,!0,void 0,!0)};var ia=document&&document.body&&document.body.childNodes&&document.body.children;a.nextElt=T;a.forwardElt=n;a.forward=function(a,b,c){if(!b)return c?n(a):J(a);for(a=
c?n(a):J(a);a;){if(b(a))return a;a=c?T(a):ka(a)}return!1};a.next=function(a,b,c){if(!b)return c?ia?a.nextElementSibling:T(a):ka(a);for(a=c?ia?a.nextElementSibling:T(a):a.nextSibling||ka(a);a;){if(b(a))return a;a=c?a.nextElementSibling||T(a):a.nextSibling||ka(a)}return!1};a.prevElt=sa;a.backwardElt=ua;a.backward=function(a,b,c){if(!b)return c?ua(a):R(a);for(a=c?ua(a):R(a);a;){if(b(a))return a;a=c?T(a):ka(a)}return!1};a.prev=function(a,b,c){if(!b)return c?ia?a.previousElementSibling:sa(a):w(a);for(a=
c?ia?a.previousElementSibling:sa(a):w(a);a;){if(b(a))return a;a=c?ia?a.previousElementSibling:sa(a):w(a)}return!1};a.viewTop=function(a){if("string"!==typeof a||(a=document.getElementById(a)))return!a||a===window||window.Window&&a instanceof window.Window?(a=a||window,a.pageYOffset||a.scrollY||a.document.documentElement.scrollTop||0):a.scrollTop};a.viewLeft=function(a){if("string"!==typeof a||(a=document.getElementById(a)))return!a||a===window||window.Window&&a instanceof window.Window?(a=a||window,
a.pageXOffset||a.scrollX||a.document.documentElement.scrollLeft||0):a.scrollLeft};a.viewHeight=Pa;a.viewWidth=Na;a.getOrientation=function(a){if("string"!==typeof a||(a=document.getElementById(a))){a||(a=window);if(a.hasOwnProperty("orientation"))return 90===a.orientation||-90===a.orientation?"landscape":"portrait";var b=Na(a);a=Pa(a);return b>a?"landscape":"portrait"}};var Za=0,Ia=Math.floor(1E5*Math.random());a.getNodeID=function(a){var b=a.id,c;if(!b){for(b="TMPID_"+Ia+"_"+Za++;!(c=document.getElementById(b))||
c===a;)b="TMPID_"+Ia+"_"+Za++,(c=document.getElementById(b))&&c!==a||(Ia=Math.floor(1E5*Math.random())),b="TMPID_"+Ia+"_"+Za++;a.id=b}return b};a.stripIDs=bb;a.getCSSRule=Oa;a.dropCSSRule=function(a){return Oa(a,"delete")};a.addCSSRule=function(b,c,d){if(!d){d=r("FDJTSTYLES");if(!d){var n=document.getElementsByTagName("HEAD");if(0===n.length)return;n=n[0];d=a("style#FDJTSTYLES");n.appendChild(d)}d=d.sheet}if(d&&(d.insertRule||d.addRule)){var n=d.cssRules||d.rules,e=n.length;d.insertRule?d.insertRule(b+
" {"+c+"}",e):d.addRule(b,c,e);return n[e]}return!1};a.addListener=eb;a.defListeners=function(a,b){if(a&&b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],n=a[c];n&&a.hasOwnProperty(c)||(a[c]=n={});for(var e in d)d.hasOwnProperty(e)&&(n[e]=d[e])}};var Ha=/^([^:]+)$/,Ca=/^([^: ]+):([^: ]+)$/;a.addListeners=Wa;a.removeListener=xa;a.T=function(a){a=a||window.event;return a.target||a.srcElement};a.cancel=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1;a.cancelBubble=
!0};ha.scaleNode=ha.adjust=Ra;a.scaleToFit=ha;ha.revert=cb;ha.revertAll=function(){for(var b=a.$(".fdjtadjusted"),c=0,d=b.length;c<d;){var n=b[c++];cb(n.parentNode,n)}};fdjt.addInit(na);a.addListener(window,"resize",na);var Da;a.useSVG=oa;a.useBMP=function(){for(var a=Fa.hasSuffix,b=fdjt.$("IMG"),c=0,d=b.length;c<d;){var n=b[c++],e=n.src;e&&(a(e,".svg")||a(e,".svgz"))&&(e=n.getAttribute("bmp"))&&(n.setAttribute("svg",n.src),n.src=e)}};a.prefSVG=function(){Da||oa()};a.checkSVG=za;a.init=fdjt.Init;
a.addInit=fdjt.addInit;fdjt.addInit(function(){ia=document&&document.body&&document.body.childNodes&&document.body.children},"checkChildren");fdjt.addInit(za,"checkSVG");0<=navigator.userAgent.search("WebKit")?(a.transition||(a.transition="-webkit-transition"),a.transitionProperty||(a.transitionProperty="-webkit-transition-property"),a.transitionDuration||(a.transitionDuration="-webkit-transition-duration"),a.transitionDelay||(a.transitionDelay="-webkit-transition-delay"),a.transitionTiming||(a.transitionTiming=
"-webkit-transition-timing-function"),a.transform||(a.transform="-webkit-transform"),a.transformOrigin||(a.transformOrigin="-webkit-transform-origin"),a.columnWidth||(a.columnWidth="-webkit-column-width"),a.columnGap||(a.columnGap="-webkit-column-gap")):0<=navigator.userAgent.search("Mozilla")?(a.transition||(a.transition="-moz-transition"),a.transitionProperty||(a.transitionProperty="-moz-transition-property"),a.transitionDuration||(a.transitionDuration="-moz-transition-duration"),a.transitionDelay||
(a.transitionDelay="-moz-transition-delay"),a.transitionTiming||(a.transitionTiming="-moz-transition-timing-function"),a.transform||(a.transform="-moz-transform"),a.transformOrigin||(a.transformOrigin="-moz-transform-origin"),a.columnWidth||(a.columnWidth="MozColumnWidth"),a.columnGap||(a.columnGap="MozColumnGap")):(a.transition||(a.transition="transition"),a.transitionProperty||(a.transitionProperty="transition-property"),a.transitionDuration||(a.transitionDuration="transition-duration"),a.transitionDelay||
(a.transitionDelay="transition-delay"),a.transitionTiming||(a.transitionTiming="transition-timing-function"),a.transform||(a.transform="transform"),a.transformOrigin||(a.transformOrigin="-moz-transform-origin"));"undefined"!==typeof document.hidden?(a.isHidden="hidden",a.vischange="visibilitychange"):"undefined"!==typeof document.webkitHidden?(a.isHidden="webkitHidden",a.vischange="webkitvisibilitychange"):"undefined"!==typeof document.mozHidden?(a.isHidden="mozHidden",a.vischange="mozvisibilitychange"):
"undefined"!==typeof document.msHidden?(a.isHidden="msHidden",a.vischange="msvisibilitychange"):(a.isHidden=!1,a.vischange=!1);a.getSelectedRange=function(a){if(!a)if(window.getSelection)a=window.getSelection();else if(document.selection)a=document.selection.createRange();else return!1;if(!a)return!1;if(a.getRangeAt)return a.rangeCount?a.getRangeAt(0):!1;if(document.createRange){var b=document.createRange();b.setStart(a.anchorNode,a.anchorOffset);b.setEnd(a.focusNode,a.focusOffset);return b}return!1};
a.rangeIsEmpty=function(a){return a?a.startContainer===a.endContainer&&a.startOffset===a.endOffset?!0:!1:!0};a.clearSelection=function(a){a||(a=document.selection||window.getSelection());a.removeAllRanges?a.removeAllRanges():a.empty&&a.empty()};a.node2text=Va;a.textPos=da;a.refineRange=function(a){if(3===a.startContainer.nodeType&&3===a.endContainer.nodeType)return a;var b=da(a.startContainer,a.startOffset);a=da(a.endContainer,a.endOffset);var c=document.createRange();c.setStart(b.node,b.off);c.setEnd(a.node,
a.off);return c};a.textOff=va;a.getRangeInfo=function(a,b){var c=a.startContainer;b||(b=V(c));var d=va(b,c,0),n=a.endContainer,e=c===n?b:G(n,b)?b:V(n),c=c===n?d:va(e,n,0);return{start:d+a.startOffset,starts_in:b.id,ends_in:e.id,end:c+a.endOffset}};a.getRegexString=K;a.textRegExp=I;a.findString=function(a,b,c,d){"undefined"===typeof c&&(c=0);"undefined"===typeof d&&(d=1);var n=!1,n=Va(a),e=0===c?n:n.slice(c),w=e.replace(/\u00ad/mg,"");for(b="string"===typeof b?I(b):b;n=b.exec(w);){if(1===d){d=n.index;
if(w!==e)for(w=0;w<d;)"\u00ad"===e[w]&&d++,w++;e=d+c;c=Qa(a,e,0,!0);a=Qa(a,e+n[0].length,0);if(!c||!a)break;n=document.createRange();c.atend?(e=Ua(c.node.nextSibling))?n.setStart(e,0):n.setStart(c.node,c.off):n.setStart(c.node,c.off);n.setEnd(a.node,a.off);return n}d--;c=n.index+n[0].length;w=w.slice(c)}return!1};a.findMatches=function(a,b,c,d){"undefined"===typeof c&&(c=0);"undefined"===typeof d&&(d=-1);var n=!1,e=[],w=Va(a),w=0===c?w:w.slice(c);for(b="string"===typeof b?I(b):b;0!==d&&(n=b.exec(w));){var h=
n.index+c,f=Qa(a,h,0),h=Qa(a,h+n[0].length,0);if(!f||!h)return!1;var R=document.createRange();if("number"===typeof f)R.setStart(a,f);else if(f.atend){var t=Ua(f.node.nextSibling);t?R.setStart(t,0):R.setStart(f.node,f.off)}else R.setStart(f.node,f.off);"number"===typeof h?R.setEnd(a,h):R.setEnd(h.node,h.off);e.push(R);d--}return e};var Sa=["transitionend","webkitTransitionEnd","mozTransitionEnd","oTransitionEnd","msTransitionEnd"];fdjt.addInit(function(){var b=document.createElement("div");if(b.removeEventListener){var c=
function(d){a.transitionEnd=d.type;d=0;for(var n=Sa.length;d<n;)b&&b.removeEventListener?b.removeEventListener(Sa[d++],c):d++};b.setAttribute("style","position:absolute;top:0px;transition:top 1ms ease;-webkit-transition:top 1ms ease;-moz-transition:top 1ms ease;-o-transition:top 1ms ease;-ms-transition:top 1ms ease;");for(var d=0,n=Sa.length;d<n;)b.addEventListener(Sa[d++],c,!1);document.documentElement.appendChild(b);setTimeout(function(){b.style.top="100px";setTimeout(function(){b.parentNode.removeChild(b);
b=c=null},2E3)},0)}},"checkTransitionEvents");var fb="email number range tel url datetime datetime-local date time week month".split(" ");a.setupCustomInputs=Ka;fdjt.addInit(Ka,"CustomInputs");a.text_types=/\b(text|email|number|range|tel|url|datetime|datetime-local|date|time|week|month)\b/i;fdjt.addInit(function(){var a="media";if(window.matchMedia){var b=window.matchMedia("handheld");b.match&&(a+=" handheld");b=window.matchMedia("(max-width:500px)");b.match&&(a+=" narrow");b=window.matchMedia("(min-width:1000px)");
b.match&&(a+=" wide");b=window.matchMedia("(-webkit-min-device-pixel-ratio:1.5),(-min-resolution:15dp)");b.match&&(a+=" hires")}fdjt.media=a},"matchMedia");fdjt.getMediaState=function(){return window.getComputedStyle(document.body,":before").content};a.insertText=function(a,b,c){var d=a.selectionStart,n=a.value;a.value=n&&"number"===typeof d&&0<=d?n.slice(0,d)+b+n.slice(d):b;"number"===typeof c&&(a.selectionEnd=a.selectionStart=d+c)};fdjt.addInit(function(){for(var a=document.getElementsByTagName&&
document.getElementsByTagName("link")||document.head.getElementsByTagName&&document.head.getElementsByTagName("link")||x(document,"link"),b=0,c=a.length;b<c;){var d=a[b++];if(d.rel&&d.href&&0===d.rel.search("schema.")){var n=d.rel.slice(7),d=d.href;Ma[n]?M.warn("Conflicting schemas for %s",n):(La[d]?La[d].push(n):La[d]=[n],Ma[n]=d)}}},"MetaSchemas");fdjt.noinit&&"undefined"!==typeof _fdjt_init&&_fdjt_init||a.addListener(window,"load",a.init);a.playAudio=function(a){(a=document.getElementById(a))&&
a.play&&(a.paused||(a.pause(),a.currentTime=0),a.play())};a.tweakImage=function(a,b,c){var d=a.style;d.maxHeight=d.minHeight="inherit";d.maxWidth=d.minWidth="inherit";var n=a.offsetWidth;a=a.offsetHeight;b/=n;c/=a;b<c?(d.width=Math.round(n*b)+"px",d.height="auto"):(d.height=Math.round(a*c)+"px",d.width="auto")};Fa.makeBlob=ga;a.data2URL=function(a){return URL&&URL.createObjectURL?URL.createObjectURL(ga(a)):a};a.adjustFontSize=a.tweakFontSize=ea;a.resetFontSize=function(a){if(a=y(a,".fdjtfontwrapper"))a.style.fontSize=
"100%"};a.autofont=".fdjtadjustfont,.adjustfont";a.tweakFont=a.tweakFonts=a.adjustFont=a.adjustFonts=fa;a.adjustLayoutFonts=function(b){var c=a.getChildren(b,a.autofont),d=0,n=c.length;if(0===n)Aa(b);else for(;d<n;)ea(c[d++])};fdjt.addInit(function(){a.noautofontadjust||(fa(),a.addListener(window,"resize",fa))});a.addUSClasses=ra;a.addCXClasses=ra;fdjt.addInit(function(){ya();eb(window,"focus",ya);eb(window,"blur",pa)});return a}();"undefined"===typeof window||window.JSON||(window.JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function r(a){k.lastIndex=0;return k.test(a)?'"'+a.replace(k,function(a){var b=p[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function g(a,e){var l,d,c,k,h=q,m,v=e[a];v&&"object"===typeof v&&"function"===typeof v.toJSON&&(v=v.toJSON(a));"function"===typeof f&&(v=f.call(e,a,v));switch(typeof v){case "string":return r(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";q+=u;m=[];if("[object Array]"===Object.prototype.toString.apply(v)){k=v.length;for(l=0;l<k;l+=1)m[l]=g(l,v)||"null";c=0===m.length?"[]":q?"[\n"+q+m.join(",\n"+q)+"\n"+h+"]":"["+m.join(",")+"]";q=h;return c}if(f&&"object"===typeof f)for(k=f.length,l=0;l<k;l+=1)d=f[l],"string"===typeof d&&(c=g(d,v))&&m.push(r(d)+(q?": ":":")+c);else for(d in v)Object.hasOwnProperty.call(v,d)&&(c=g(d,v))&&m.push(r(d)+(q?": ":":")+c);c=0===m.length?"{}":q?"{\n"+q+m.join(",\n"+q)+"\n"+
h+"}":"{"+m.join(",")+"}";q=h;return c}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(b){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var m=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
k=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,q,u,p={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},f;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,e,l){var d;u=q="";if("number"===typeof l)for(d=0;d<l;d+=1)u+=" ";else"string"===typeof l&&(u=l);if((f=e)&&"function"!==typeof e&&("object"!==typeof e||"number"!==typeof e.length))throw Error("JSON.stringify");return g("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,e){function f(a,b){var d,k,g=a[b];if(g&&"object"===typeof g)for(d in g)Object.hasOwnProperty.call(g,d)&&(k=f(g,d),void 0!==k?g[d]=k:delete g[d]);return e.call(a,b,g)}var d;m.lastIndex=0;m.test(a)&&(a=a.replace(m,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return d=eval("("+a+")"),"function"===typeof e?f({"":d},""):d;throw new SyntaxError("JSON.parse");})})();fdjt.JSON||(fdjt.JSON=JSON);fdjt.RefDB||(fdjt.RefDB=function(){function a(a,b){var c=this;t[a]?(c=t[a],b&&c.init?c.xinits?c.xinits.push(b):c.xinits=[b]:b?c.init=b:b={}):b&&b.aliases&&r(b.aliases)?(c=r(b.aliases),0<=c.aliases.indexOf(c.name)&&(c.name=a),b&&c.init?c.xinits?c.xinits.push(b):c.xinits=[b]:b?c.init=b:b={}):(b||(b={}),c.name=a,t[a]=c,Q.push(c),c.aliases=[],c.complete=!1,c.refs={},c.altrefs={},c.allrefs=[],c.loaded=[],c.changes=[],c.changed=!1,c.storage=b.storage||!1,c.absrefs=b.absrefs||!1,c.oidrefs=b.oidrefs||!1,
c.onload=[],c.onloadnames={},c.onadd={},c.ondrop={},c.indices={});b.hasOwnProperty("absrefs")&&(c.absrefs=b.absrefs);if(b.aliases)for(var d=b.aliases,e=0,h=d.length;e<h;){var f=d[e++];d[f]?d[f]!==c&&S("Alias %s for %o already associated with %o",f,c,d[f]):(d[f]=c,c.aliases.push(f))}if(b.onload){var d=b.onload,l;for(l in d)if(d.hasOwnProperty(l))c.onLoad(d[l],l)}if(b.indices)for(l=b.indices,d=0,e=l.length;d<e;)h=l[d++],"string"!==typeof h?S("Complex indices not yet handled!"):(this.indices[h]=new x).fordb=
c;return c}function r(a){for(var b=0,c=a.length;b<c;){var d=a[b++];if(d=t[d])return d}return!1}function g(a){return t.hasOwnProperty(a)&&t[a]||X.hasOwnProperty(a)&&X[a]||!1}function m(b,c,d,e){"function"!==typeof d&&(d=a);if(b instanceof k)return b;if("object"===typeof b&&b.id)return q(b,c);if(c&&c.refs.hasOwnProperty(b))return c.refs[b];if(c&&c.probe(b))return c.probe(b);if("string"===typeof b&&ka.exec(b)){var h=b.indexOf("@");1===h&&":"===b[0]&&(b=b.slice(1),h=0);if(0<h){var f=!1,l=b.slice(h+1),
J;g(l)||(ka.exec(l)?(J=m(l))?e=!0:l=b.slice(h+1):l=b.slice(h+1));f=c&&c.name===l?c:g(l);b=b.slice(0,h);f?c=f:e?(S("Creating forced RefDB domain %s for reference %s",l,b),c=a.open(l,d)):c=g(l);c&&J&&(c.origin=J,J.name&&(c.fullname=J.name));b=b.slice(0,h)}else 0>h?(f=0===b.search(":#U")?b.slice(3):0===b.search("#U")?b.slice(2):0===b.search("U")?b.slice(1):b,h=f.indexOf("t"),l=b.length-2,h=0<h?"UUID"+f.slice(h):!1,l=0<l?"-UUIDTYPE="+f.slice(l):!1,(f=h&&(t[h]||X[h])||l&&(t[l]||X[l]))?c=f:e&&h&&d&&(S("Creating forced RefDB domain %s for reference %s",
h,b),c=new d(h),h&&c.addAlias(h))):"@"===b[1]?(c=b.indexOf("/"),d=b.slice(0,c),(h=X[d])?c=h:(c=T(b.slice(0,c),!0))?c=new a(c,{aliases:[d]}):(S("Can't find domain for atid %s when resolving %s",d,b),c=!1)):("/"===b[1]?(c=b.slice(2).indexOf("/"),0<c&&(c+=2)):c=b.indexOf("/"),c=b.slice(h,c+1),c=t[c]||X[c]||d&&new d(c))}return c?c.refs.hasOwnProperty(b)?c.refs[b]:e?c.ref(b):!1:!1}function k(a,b,c){if(0===arguments.length)return this;var d=a.indexOf("@");if(1<d&&"\\"!==a[d-1]){var e=a.slice(d+1);e!==b.name&&
0>b.aliases.indexOf(e)&&S("Reference to %s being handled by %s",a,b);a=a.slice(0,d)}return b.refs.hasOwnProperty(a)?b.refs[a]:c?(c._id=a,c._db=b,b.absrefs||(c._domain=b.name),b.refs[a]=c,b.allrefs.push(c),c):!b.refclass||this instanceof b.refclass?(this._id=a,this._db=b,b.absrefs||(this._domain=b.name),b.refs[a]=this,b.allrefs.push(this),this):new b.refclass(a,b)}function q(b,c,d){var e=!1;b._domain&&(e=a.probe(b._domain)||new a(b._domain));return e?e.ref(b._id):a.resolve(b._id,c,d||a,!0)}function u(a,
b,c){if("undefined"===typeof a||"number"===typeof a||null===a||a instanceof k)return a;if(a instanceof Array){for(var d=0,e=a.length,h=!1;d<e;){var f=a[d++],t=f;if(null===f)t=void 0;else if(f instanceof k)t=f;else if("object"===typeof f&&f._id){var l=q(f,b);if(l){for(var g in f)f.hasOwnProperty(g)&&"_id"!==g&&"_db"!==g&&(l[g]=u(f[g],b,c));t=l}}else c&&"string"===typeof f&&ka.exec(f)&&(t=m(f,b)||f);"undefined"===typeof t?h||(h=a.slice(0,d-1)):h?h.push(t):t!==f&&(h=a.slice(0,d-1),h.push(t))}return h?
h:a}if("object"===typeof a&&a._id){g=q(a,b);for(d in a)a.hasOwnProperty(d)&&"_id"!==d&&"_db"!==d&&(g[d]=u(a[d],b,c));return g}return c&&"string"===typeof a&&ka.exec(a)?m(a,b)||a:a}function p(a,b,c,d,e){(c=m(a._id,a._domain||c,c.constructor,!0))?(b.push(c),c.Import(a,d||!1,e)):S("Couldn't resolve database for %o",a._id)}function f(a,b){if(a instanceof k)return a._db===b?{_id:a._id}:a._db.absrefs?{_id:a._id}:{_id:a._id,_domain:a._domain||a._db.name};if(a instanceof Array){for(var c=0,d=a.length,e=!1;c<
d;){var h=a[c++],t=f(h,b);h!==t?(e||(e=a.slice(0,c-1)),e.push(t)):e&&e.push(h)}return e||a}if("object"===typeof a){c=!1;d=[];for(e in a)if(a.hasOwnProperty(e))if(t=a[e],h=f(t,b),t!==h){if(!c&&(c={},d.length))for(var t=0,l=d.length;t<l;){var g=d[t++];c[g]=a[g]}c[e]=h}else c?c[e]=t:d.push(e);return c||a}return a}function b(a,b){if(b.atid)return b.atid;var c=a["atid("+b.name+")"];if(c)b.atid=c;else{var d=a["atid.count"];d?(d=parseInt(d,10),c=b.atid="@@"+d,a["atid("+b.name+")"]=c,a["atid.count"]=d+1):
(c=1,a["atid.count"]="2")}return c}function e(a,b){return a instanceof k?a._db===b?"@"+a._id:a._domain?"@"+a._id+"@"+a._domain:"@"+a._id:"number"===typeof a?"#"+a:"string"===typeof a?'"'+a:a.toJSON?"{"+a.toJSON():"&"+a.toString()}function l(a,b,c){return 0<=a.indexOf(b,c||0)}function d(a,b,c){return a.indexOf(b,c||0)}function c(a,b){return a===b?0:typeof a===typeof b?"number"===typeof a?a-b:"string"===typeof a?a<b?-1:1:a._qid?b._qid?a._qid<b._qid?-1:1:-1:b._qid?1:a._fdjtid&&b._fdjtid?a._fdjtid<b._fdjtid?
-1:1:0:typeof a<typeof b?-1:1}function z(a,b){"string"===typeof a&&(a=[a]);"string"===typeof b&&(b=[b]);if(!a||0===a.length)return[];if(!b||0===b.length)return a;a._sortlen!==a.length&&(a=B(a));b._sortlen!==b.length&&(b=B(b));for(var d=[],e=0,h=0,f=a.length,t=b.length,l=a._allstrings&&b._allstrings,k=!0;e<f&&h<t;)a[e]===b[h]?(e++,h++):(l?a[e]<b[h]:0>c(a[e],b[h]))?(k&&"string"!==typeof a[e]&&(k=!1),d.push(a[e]),e++):h++;d._allstrings=k;d._sortlen=d.length;return d}function h(a,b){var d=[];d._sortlen=
0;a instanceof Array||(a=[a]);b instanceof Array||(b=[b]);if(!a||0===a.length){if(!b||0===b.length)return d;d=d.concat(b);return b._sortlen?(d._sortlen=b._sortlen,d._allstrings=b._allstrings,d):v(d)}if(!b||0===b.length)return h(b,a);a._sortlen!==a.length&&(a=v(a));b._sortlen!==b.length&&(b=v(b));for(var e=0,f=0,t=a.length,l=b.length,k=a._allstrings&&b._allstrings;e<t&&f<l;)a[e]===b[f]?(d.push(a[e]),e++,f++):(k?a[e]<b[f]:0>c(a[e],b[f]))?d.push(a[e++]):d.push(b[f++]);for(;e<t;)d.push(a[e++]);for(;f<
l;)d.push(b[f++]);d._allstrings=k;d._sortlen=d.length;return d}function B(a){var b=[];b._sortlen=0;if(0===arguments.length)return b;if(1===arguments.length){if(a){if(a instanceof Array)return a.length&&a._sortlen!==a.length?"number"===typeof a._sortlen?v(a):v([].concat(a)):a;b=[a];"string"===typeof a&&(b._allstrings=!0);b._sortlen=1}return b}b=[];for(a in arguments)a&&(a instanceof Array?b=b.concat(a):b.push(a));return v(b)}function v(a){var b;if(a._sortlen!==(b=a.length))if(0===b)a._sortlen=0;else if(1===
b)b=a[0],a._sortlen=1,a._allstrings="string"===typeof b,"object"!==typeof h||b._qid||b._fdjtid||(b.getQID?b._qid=b.getQID():b._fdjtid=++J);else{b=!0;for(var d=0,e=a.length;d<e;){var h=a[d++];b&&"string"!==typeof h&&(b=!1,"object"!==typeof h||h._qid||h._fdjtid||(h.getQID?h._qid=h.getQID():h._fdjtid=++J))}a._allstrings=b;if(1===e)return a;b?a.sort():a.sort(c);b=h=1;d=a.length;for(e=a[0];h<d;)a[h]!==e?a[b++]=e=a[h++]:h++;a._sortlen=a.length=b}return a}function H(a,b){if(b instanceof Array){var c=!1,
d;for(d in b)H(a,d)&&(c=!0);return c}if(a.indexOf){if(0<=a.indexOf(b))return!1}else{c=0;for(d=a.length;c<d;){if(a[c]===b)return!1;c++}"string"!==typeof b&&(a._allstrings=!1)}a.push(b);return!0}function G(a,b){if(b instanceof Array){var c=!1,d;for(d in b)G(a,d)&&(c=!0);return c}if(a.indexOf){c=a.indexOf(b);if(0>c)return!1;a.splice(c,1);return!0}c=0;for(d=a.length;c<d;){if(a[c]===b)return a.splice(c,1),!0;c++}return!1}function x(){return this}function y(){return this}function D(a){this._db=a;return this}
function N(a,b,c){if(0===arguments.length)return this;a&&(this.dbs=a);b&&(this.clauses=b instanceof Array?b:[b]);c&&(this.weights=c);var d=0,e=a.length;if(1<e)for(;d<e;)if(a[d].absrefs)d++;else return this;this.uniqueids=!0;return this}function E(a,b){return b.weight-a.weight}var F=fdjt.State,A=fdjt.Time,L=fdjt.Async,O=fdjt.DOM,P=fdjt.JSON,S=fdjt.Log.warn,t={},Q=[],aa=[],X={},C=a.REFINDEX=2,Z=a.REFLOAD=4,ja=a.REFSTRINGS=8,U=C|ja;a.open=function(b,c){c||(c=a);return t.hasOwnProperty(b)&&t[b]||X.hasOwnProperty(b)&&
X[b]||new c(b)};a.probe=g;a.prototype.addAlias=function(a){X[a]?X[a]!==this&&S("Alias %s for %o already associated with %o",a,this,X[a]):(X[a]=this,this.aliases.push(a))};a.prototype.toString=function(){return"RefDB("+this.name+")"};a.prototype.ref=function(a){if("string"!==typeof a){if(a instanceof k)return a;throw Error("Not a reference");}":"===a[0]&&"@"===a[1]&&(a=a.slice(1));var b=this.refs;return b.hasOwnProperty(a)&&b[a]||this.refclass&&new this.refclass(a,this)||new k(a,this)};a.prototype.probe=
function(a){if("string"!==typeof a)return a instanceof k?a:!1;":"===a[0]&&"@"===a[1]&&(a=a.slice(1));var b=this.refs;return b.hasOwnProperty(a)&&b[a]};a.prototype.drop=function(a){var b=0,c=this.refs,d=this.altrefs;t instanceof Array||(a=[a]);for(var e=0,h=a.length;e<h;){var f=a[e++],t;f instanceof k?t=f._id:(t=f,f=this.probe(t));if(f){b++;var l=f.aliases,g=this.allrefs.indexOf(f);0<=g&&this.allrefs.splice(g,1);g=this.changes.indexOf(f);0<=g&&this.changes.splice(g,1);g=this.loaded.indexOf(f);0<=g&&
this.loaded.splice(g,1);delete c[t];if(this.storage instanceof Storage){var f=this.storage,g="allids("+this.name+")",J=f[g],J=J&&P.parse(J),z=J.indexOf(t);0<=z&&(J.splice(z,1),f.setItem(g,P.stringify(J)),f.removeItem(t))}if(l)for(t=0,f=l.length;t<f;)delete d[l[t++]]}}return b};a.prototype.clearOffline=function(a){if(!this.storage)return!1;if(Storage&&this.storage instanceof Storage){var b=this.storage,c="allids("+this.name+")",d=this.storage[c];d&&(d=P.parse(d));if(d)for(var e=0,h=d.length;e<h;)delete b[d[e++]];
delete b[c];a&&setTimeout(a,5)}else if(!(this.storage instanceof indexedDB))return!1};a.prototype.onLoad=function(a,b,c){if(b&&this.onloadnames[b]){var d=this.onloadnames[b];if(d===a)return;var e=this.onload.indexOf(d);if(0>d){S("Couldn't replace named onload method %s for <RefDB %s>",b,this.name);return}this.onload[e]=a}else this.onload.push(a);b&&(this.onloadnames[b]=a);c||(b=[].concat(this.loaded),L.slowmap(a,b))};a.prototype.onAdd=function(a,b){this.onadd[a]=b};a.prototype.onDrop=function(a,b){this.ondrop[a]=
b};var ka=/^(((:|)@(([0-9a-fA-F]+\/[0-9a-fA-F]+)|(\/\w+\/.*)|(@\d+\/.*)))|((U|#U|:#U|)[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12})|((U|#U|:#U|)[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}t[0-9a-zA-Z]+)|([^@]+@.+))$/,T=F.getLocal;a.resolve=m;a.ref=m;fdjt.Ref=a.Ref=k;k.prototype.toString=function(){return this._qid?this._qid:this._domain?this._id+"@"+this._domain:this._db.absrefs?this._id:this._id+"@"+this._db.name};k.prototype.getQID=function(){return this._qid?
this._qid:this._domain?this._qid=this._id+"@"+this._domain:this._db.absrefs?this._qid=this._id:this._qid=this._id+"@"+this._db.name};k.prototype.addAlias=function(a){var b=this._db.refs;if(b.hasOwnProperty(a)){if(b[a]===this)return!1;throw{error:"Ref alias conflict"};}if(this._db.altrefs.hasOwnProperty(a)){if(this._db.altrefs[a]===this)return!1;throw{error:"Ref alias conflict"};}this._db.altrefs[a]=this;return!0};k.prototype.Import=function(a,b,c){var d=this._db,e=this._live,h=d.indices,f=d.onload,
t=e&&d.onadd,l=e&&d.ondrop,k=a.aliases;"undefined"===typeof c&&(c=U);"undefined"===typeof b&&(b=this.import_rules||d.import_rules);var g=0!==(c&C),J=0!==(c&Z);c=0!==(c&ja);if(k)for(var L=0,m=k.length;L<m;){var v=k[L++],O=d.refs.hasOwnProperty(v)&&d.refs[v]||d.altrefs.hasOwnProperty(v)&&d.altrefs[v];O&&O!==this?S("Ambiguous ref %s in %s refers to both %o and %o",v,d,O.name,this.name):k[v]=this}if(k=J&&!this._live)this._live=A();for(var Q in a)if("aliases"!==Q&&"_id"!==Q&&a.hasOwnProperty(Q))if(m=a[Q],
L=b&&b[Q],"undefined"!==typeof m&&(L&&(m=L(this,Q,m,a,g)),m=u(m,d,c)),v=e&&this[Q],this[Q]=m,v){L=z(v,m||[]);m=m?z(m,v):[];g&&h[Q]&&(m.length&&this.indexRef(Q,m,h[Q],d),L.length&&this.dropIndexRef(Q,L,h[Q],d));if(m.length&&t[Q])for(var v=t[Q],O=0,T=m.length;O<T;)v(m[O++]);if(L.length&&l[Q])for(m=l[Q],v=0,O=L.length;v<O;)m(L[v++])}else m&&g&&h[Q]&&this.indexRef(Q,m,h[Q],d);if(k){if(f)for(a=0,b=f.length;a<b;)(0,f[a++])(this);if(this._onload){f=this._onload.fns;a=0;for(b=f.length;a<b;)f[a++](this);delete this._onload}}J||
this._changed||(this._changed=J=A(),d.changes.push(this),d.changed||(d.changed=J,d.changes.push(d)))};k.prototype.importValue=function(a,b){return u(this._db,a,b)};a.prototype.importValue=function(a,b){return u(a,this,b)};a.prototype.Import=function(a,b,c,d){var e=[],h=this;if(!(a instanceof Array))return p(a,e,h,b,c),d&&d.call&&setTimeout(function(){d(e[0])}),e[0];if(!d||7>=a.length){for(var f=0,t=a.length;f<t;)p(a[f++],e,h,b,c);d&&d.call&&setTimeout(function(){d(e)},10);return e}d.call?L.slowmap(function(a){p(a,
e,h,b,c)},a,{done:function(){d(e)}}):L.slowmap(function(a){p(a,e,h,b,c)},a)};k.prototype.onLoad=function(a,b){this._live?a(this):this._onload?this._onload[b]||(b&&(this._onload[b]=a),this._onload.fns.push(a)):(this._onload={fns:[a]},b&&(this._onload[b]=a))};k.Export=k.prototype.Export=function(a){var b=this._id,c={_id:this._id};a||(a=this.export_rules||b.export_rules);b.absrefs||(this._domain=b.name);for(var d in this)if("_"!==d[0]&&this.hasOwnProperty(d)){var b=this[d],e=a&&a[d];e&&(b=e(b,d,c));
"undefined"!==typeof b&&(c[d]="number"===typeof b||"string"===typeof b?b:b instanceof k?b._db.absrefs?{_id:b._id}:{_id:b._id,_domain:b._domain||b._db.name}:f(b,this._db))}return c};k.exportValue=f;a.prototype.exportValue=function(a){return f(a,this)};a.prototype.load=function(a,c,d){function e(){c&&(d?c.apply(null,d):c())}if(this.storage&&this.storage instanceof Storage){if(a)if(!0===a){var h=this.storage["allids("+this.name+")"];a=h?P.parse(h).concat(this.allrefs):[].concat(this.allrefs)}else a instanceof
k?a=[a]:"string"===typeof a?a=[a]:"undefined"===typeof a.length&&(a=[a]);else a=[].concat(this.allrefs);for(var f=this.storage,t=this.loaded,l=this,g=this.absrefs,h=this.refs,J=!1,z=[],m=0,v=a.length;m<v;){var O=a[m++],Q=O;"string"===typeof O&&(Q=h[O]);Q instanceof k&&Q._live||z.push(O)}if(z.length)return L.slowmap(function(a){var c=a;"string"===typeof c&&(c=l.ref(c,!1,!0));c?c._live||(t.push(c),g?a=f[c._id]:(J||(J=l.atid?l.atid:l.atid=b(f,l)),a=f[J+"("+c._id+")"]),a?c.Import(P.parse(a),!1,Z|C):S("No item stored for %s",
c._id)):S("Couldn't resolve ref to %s",a)},z,c?d?{done:e}:{done:c}:!1);e();return new Promise(function(b){b(a)})}};a.prototype.loadref=function(a,b,c){"string"===typeof a&&(a=this.ref(a));a._live?b&&(c?b.call(null,c):b()):this.load(a,b,c);return a};k.prototype.load=function(a,b){this._live||this._db.load(this,a,b);return this};a.load=function(b,c,d,e){if("string"===typeof b){if(c=a.resolve(b,!1,c||a,!0))return c.load(d,e);throw{error:"Couldn't resolve "+b};}if(b instanceof k)return b.load(d,e);if(b instanceof
Array){d={};for(var h=[],f=0,t=b.length;f<t;){var l=b[f++],g=!1;"string"===typeof l?g=a.resolve(l,!1,c||a,!0):l instanceof k&&(g=l);if(g&&!g._live){var l=g._db,J=l.name;d[J]?d[J].push(g):(d[J]=[g],h.push(l))}}f=0;for(t=h.length;f<t;)b=h[f++],b.load(d[b.name],e);return d}return!1};a.prototype.save=function(a,c,d){var e=this;if(this.storage){if(!0===a)return this.save(this.allrefs,function(){e.changed=!1;e.changes=[];var a=aa.indexOf(e);0<=a&&aa.splice(a,1);c&&c()});if(!a)return this.save(this.changes,
function(){e.changed=!1;e.changes=[];var a=aa.indexOf(e);0<=a&&aa.splice(a,1);c&&c()});if(this.storage instanceof Storage){for(var f=this.storage,t=this.atid,l=[],k=0,g=a.length;k<g;){var J=a[k++];"string"===typeof J&&(J=this.ref(J));if(J._live&&(!J._saved||J._changed)){var z=J.Export();z._saved=A.tick();if(this.absrefs)l.push(J._id),f.setItem(J._id,P.stringify(z));else{t||(t=J.atid?J.atid:J.atid=b(f,J));var L=t+"("+J._id+")";l.push(L);f.setItem(L,P.stringify(z))}J._changed=!1}}if(d){a=this.changes;
d=[];t=0;for(k=a.length;t<k;)g=a[t++],g._changed&&d.push(g);this.changes=d;0===d.length&&(this.changed=!1,a=aa.indexOf(e),0<=a&&aa.splice(a,1))}a=(a=f["allids("+this.name+")"])?P.parse(a):[];d=a.length;a=h(a,l);a.length!==d&&f.setItem("allids("+this.name+")",P.stringify(a));c&&setTimeout(c,5)}}};k.prototype.save=function(a){if(this._changed)this._db.save([this],a);else return this};a.getKeyString=e;k.prototype.indexRef=function(a,b,c,d){var e=[],h=this._db,f=!d||h===d||h.absrefs?this._id:this._qid||
this.getQID&&this.getQID();d||(d=h);var t=d.indices;c||(c=t.hasOwnProperty(a)&&t[a]);if(!c)return S("No index on %s for %o in %o",a,this,d),!1;if(b instanceof k)e=h===b._db?["@"+b._id]:["@"+(b._qid||b.getQID())];else if(b instanceof Array)for(a=0,d=b.length;a<d;)h=b[a++],h instanceof k?e.push("@"+(h._qid||h.getQID())):"number"===typeof h?e=["#"+h]:"string"===typeof h?e=['"'+h]:h._qid?e.push("@"+(h._qid||h.getQID())):h.getQID&&e.push("@"+h.getQID());else e="number"===typeof b?["#"+b]:"string"===typeof b?
['"'+b]:["?"+b.toString()];if(e.length){b=0;for(a=e.length;b<a;)d=e[b++],(h=c[d])?h.push(f):c[d]=[f];return e.length}return!1};k.prototype.dropIndexRef=function(a,b,c,d){d||(d=this._db);c||(c=d.indices[a]);if(!c)return!1;a=[];if(b instanceof k)a=this._db===b._db?["@"+b._id]:["@"+(b._qid||b.getQID())];else if(b instanceof Array){d=0;for(var e=b.length;d<e;){var h=b[d++];h instanceof k?a.push("@"+(h._qid||h.getQID())):"number"===typeof h?a=["#"+b]:"string"===typeof h?a=['"'+b]:h._qid?a.push("@"+(h._qid||
h.getQID())):h.getQID&&a.push("@"+h.getQID())}}else"number"===typeof b?a=["#"+b]:"string"===typeof b&&(a=['"'+b]);if(a.length){d=b=0;for(e=a.length;d<e;){var h=a[d++],f=c[h];if(f){var t=f.indexOf(this._id);0>t||(f.splice(t,1),0===f.length&&delete c[h],b++)}}return b}return!1};a.prototype.find=function(a,b){var c=this.indices[a];return c?(c=c.getItem(b,this))?v(c):[]:[]};a.prototype.findRefs=function(a,b){var c=this.indices[a];if(c){var c=c.getItem(b,this),d=[];if(c)for(var e=0,h=c.length;e<h;){var f=
c[e++];f&&("string"===typeof f?(f=this.probe(f))&&d.push(f):d.push(f))}return B(d)}return[]};a.prototype.count=function(a,b){var c=this.indices[a];return c?(c=c.getItem(b,this))?c.length||0:0:0};a.prototype.addIndex=function(a,b){b||(b=x);if(this.indices.hasOwnProperty(a))return this.indices[a];var c=this.indices[a]=new b;c.fordb=this;return c};var J=1;a.compare=c;a.intersection=function(a,b){"string"===typeof a&&(a=[a]);"string"===typeof b&&(b=[b]);if(!a||0===a.length||!b||0===b.length)return[];
a._sortlen!==a.length&&(a=B(a));b._sortlen!==b.length&&(b=B(b));for(var d=[],e=0,h=0,f=a.length,t=b.length,l=a._allstrings&&b._allstrings,k=!0;e<f&&h<t;)a[e]===b[h]?(k&&"string"!==typeof a[e]&&(k=!1),d.push(a[e]),e++,h++):(l?a[e]<b[h]:0>c(a[e],b[h]))?e++:h++;d._allstrings=k;d._sortlen=d.length;return d};a.difference=z;a.union=function(a,b){"string"===typeof a&&(a=[a]);"string"===typeof b&&(b=[b]);if(!a||0===a.length)return b;if(!b||0===b.length)return a;a._sortlen!==a.length&&(a=B(a));b._sortlen!==
b.length&&(b=B(b));for(var d=[],e=0,h=0,f=a.length,t=b.length,l=a._allstrings&&b._allstrings;e<f&&h<t;)a[e]===b[h]?(d.push(a[e]),e++,h++):(l?a[e]<b[h]:0>c(a[e],b[h]))?d.push(a[e++]):d.push(b[h++]);for(;e<f;)d.push(a[e++]);for(;h<t;)d.push(b[h++]);d._allstrings=l;d._sortlen=d.length;return d};a.merge=h;a.overlaps=function(a,b){"string"===typeof a&&(a=[a]);"string"===typeof b&&(b=[b]);if(!a||0===a.length||!b||0===b.length)return!1;a._sortlen!==a.length&&(a=B(a));b._sortlen!==b.length&&(b=B(b));for(var d=
0,e=0,h=a.length,f=b.length,t=a._allstrings&&b._allstrings;d<h&&e<f;){if(a[d]===b[e])return!0;(t?a[d]<b[e]:0>c(a[d],b[e]))?d++:e++}return!1};a.Set=B;fdjt.Set=B;a.toSet=B;k.prototype.get=function(a){if(this.hasOwnProperty(a))return this[a];if(this._live)return!1};k.prototype.getSet=function(a){if(this.hasOwnProperty(a))return a=this[a],a instanceof Array?a._sortlen===a.length?a:v(a):v([a]);if(this._live)return[]};k.prototype.getArray=function(a){if(this.hasOwnProperty(a))return a=this[a],a instanceof
Array?a:[a];if(this._live)return[]};k.prototype.add=function(a,b,c){var d=this._db;"undefined"===typeof c?c=d.indices.hasOwnProperty(a)?!0:!1:c&&!d.indices.hasOwnProperty(a)&&d.addIndex(a);if(!(b instanceof Array&&0===b._sortlen)){if(!this._live&&this._db.storage){var e=this;this._onload?this._onload.push(function(){e.add(a,b)}):this._onload=[function(){e.add(a,b)}];return this}if(b instanceof Array&&"number"===typeof b._sortlen)for(var d=0,h=b.length;d<h;)this.add(a,b[d++],c);else{if("aliases"===
a){if(d.refs[b]===this||d.altrefs[b]===this)return!1;d.altrefs[b]=this;this.aliases?this.aliases.push(b):this.aliases=[b]}else if(this.hasOwnProperty(a)){h=this[a];if(h===b)return!1;if(h instanceof Array){if(!H(h,b))return!1}else this[a]=B([h,b])}else this[a]=b instanceof Array&&"number"!==typeof b._sortlen?B([b]):b;this._changed||(h=A(),d.changed&&(d.changed=h,aa.push(d)),this._changed=h,d.changes.push(this));if(d.onadd.hasOwnProperty(a))d.onadd[a](this,a,b);c&&d.indices[a]&&this.indexRef(a,this[a],
d.indices[a]);return!0}}};k.prototype.drop=function(a,b,c){var d=this._db;"undefined"===typeof c&&(c=!0);if("_id"===a)return!1;if(!this._live&&this._db.storage)d.storage instanceof Storage&&this.load().then(function(){return this.drop(a,b)});else{if(this.hasOwnProperty(a)){var e=this[a];if(e===b)delete this[a];else if(e instanceof Array){if(!G(e,b))return!1;0===e.length&&delete this[a]}else return!1;if(d.ondrop.hasOwnProperty(a))d.ondrop[a](this,a,b);this._changed||(e=A(),d.changed&&(d.changed=e,
aa.push(d)),this._changed=e,d.changes.push(this));c&&d.indices[a]&&this.indexRefDrop(a,d.indices[a]);return!0}return!1}};k.prototype.test=function(a,b){if(this.hasOwnProperty(a)){if("undefined"===typeof b)return!0;var c=this[a];if(c===b||c instanceof Array&&l(c,b))return!0}if(this._live)return!1};k.prototype.store=function(a,b){var c=[],d=[];if(this.hasOwnProperty(a)){d=this[a];if(d===b)return!1;c=z(b,d);d=z(d,b)}else c=b instanceof Array?b:[b];for(var e=0,h=d.length;e<h;)this.drop(a,d[e++]);e=0;
for(h=c.length;e<h;)this.add(a,c[e++]);return!0};k.prototype.toHTML=function(){var a=!1;return this._db.forHTML&&this._db.forHTML(this)||this._db.forDOM&&(a=this._db.forDOM(this))&&a.outerHTML||this._id||this.oid||this.uuid};k.prototype.toDOM=function(){return this._db.forDOM&&this._db.forDOM(this)||this._db.forHTML&&O(this._db.forHTML(this))||O("span.fdjtref",this._id||this.oid||this.uuid)};x.prototype.get=function(a){var b=e(a,this.fordb);if(this.hasOwnProperty(b))return this[b];if("string"===typeof a)return this[a]||
this["@"+a]};x.prototype.getItem=x.prototype.get;x.prototype.set=function(a,b){this[e(a,this.fordb)]=b instanceof Array?[b]:b};x.prototype.setItem=x.prototype.set;x.prototype.increment=function(a,b){var c=e(a,this.fordb),d=this[c],h;this[c]=d?h=d+b:h=b;return h};x.prototype.add=function(a,b){var c=e(a,this.fordb);if(this.hasOwnProperty(c)){var d=this[c];if(d===b)return!1;if(d instanceof Array){if(l(d,b))return!1;d.push(b);return!0}this[c]=v([d,b]);return!0}this[c]=b instanceof Array?v([b]):b};x.prototype.drop=
function(a,b){var c=e(a,this.fordb);if(this.hasOwnProperty(c)){var d=this[c];if(d===b)return delete this[c],!0;if(d instanceof Array){var h=d.indexOf(b);if(0>h)return!1;d.splice(h,1);d._sortlen&&d._sortlen--;1===d.length&&(d[0]instanceof Array||(this[c]=d[0]));return!0}}return!1};fdjt.Map=x;a.ObjectMap=x;a.fdjtMap=x;y.prototype.get=function(a){if("string"===typeof a&&this.hasOwnProperty(a))return this[a]};y.prototype.getItem=y.prototype.get;y.prototype.set=function(a,b){"string"===typeof a&&(this[a]=
b instanceof Array?[b]:b)};y.prototype.setItem=y.prototype.set;y.prototype.increment=function(a,b){if("string"===typeof a){var c=this[a],d;this[a]=c?d=c+b:d=b;return d}};y.prototype.add=function(a,b){if("string"===typeof a){if(this.hasOwnProperty(a)){var c=this[a];if(c===b)return!1;if(c instanceof Array){if(l(c,b))return!1;c.push(b);return!0}this[a]=v([c,b]);return!0}this[a]=b instanceof Array?v([b]):b}};y.prototype.drop=function(a,b){if("string"===typeof a){if(this.hasOwnProperty(a)){var c=this[a];
if(c===b)return delete this[a],!0;if(c instanceof Array){var d=c.indexOf(b);if(0>d)return!1;c.splice(d,1);c._sortlen&&c._sortlen--;1===c.length&&(c[0]instanceof Array||(this[a]=c[0]));return!0}}return!1}};fdjt.StringMap=y;a.StringMap=y;D.prototype.get=function(a){if("string"===typeof a){if(this.hasOwnProperty(a))return this[a]}else if(a instanceof k)return this[this.uniqueids&&a._id||a._qid||a.getQID()]};D.prototype.set=function(a,b){if("string"===typeof a)this[a]=b;else if(a instanceof k)this[a._qid||
this.uniqueid&&a._id||a.getQID()]=b;else return!1};D.prototype.increment=function(a,b){if("string"===typeof a)this.hasOwnProperty(a)?this[a]+=b:this[a]=b;else if(a instanceof k){var c=a._qid||this.uniqueids&&a._id||a.getQID();this[c]=(this[c]||0)+b}else return!1};fdjt.RefMap=a.RefMap=D;a.add=function(a,b,c,d){if(2===arguments.length)return H(a,b);if(a instanceof k)return a.add.apply(a,arguments);d?a.hasOwnProperty(b)?l(a[b],c)||a[b].push(c):a[b]=Array(c):a.hasOwnProperty(b)?a[b].push(c):a[b]=Array(c);
a._all&&!l(a._all,b)&&a._all.push(b)};a.drop=function(a,b,c){if(2===arguments.length)return G(a,b);if(a instanceof k)return a.drop.apply(a,arguments);if(!c)a[b]=[];else if(a.hasOwnProperty(b)){var e=a[b],h=d(e,c);0>h||e.splice(h,1)}};a.test=function(a,b,c){return 2===arguments.length?l(a,b):a instanceof k?a.test.apply(a,arguments):"undefined"===typeof c?(a.hasOwnProperty?a.hasOwnProperty(b):a[b])&&0<a[b].length:a.hasOwnProperty(b)?0>d(a[b],c)?!1:!0:!1};a.insert=function(a,b){0>d(a,b)&&a.push(b)};
a.remove=function(a,b,c){var e=d(a,b);if(0>e)return a;a.splice(e,1);if(c)for(c--;0<c&&0<=(e=d(a,b,e));)a.splice(e,1),c--;return a};a.indexOf=function(a,b,c){return c?a.indexOf(b,c):a.indexOf(b)};a.contains=l;a.position=d;a.Query=N;N.prototype.uniqueids=!1;N.prototype.execute=function(){if(this.scores)return this;var a=this.dbs,b=this.clauses;if(!a||!a.length){var c=this.results=B();S("No dbs for query %o!",this);return c}if(!b||!b.length){for(var c=B(),d=0,e=a.length;d<e;)c=h(c,v(a[d++].allrefs));
return this.results=c}var f=this._weights||this.weights,t=1===a.length||this.uniqueids,c=new D,d=new D,e=B(),l={};d.uniqueids=c.uniqueids=t;for(var k=0,g=b.length;k<g;){var J=b[k++],z=J.fields,L=J.values,m=J.weights,J=[];z instanceof Array||(z=[z]);L instanceof Array||(L=[L]);for(var O=0,Q=z.length;O<Q;)for(var A=z[O++],T=m&&m[A]||f&&f[A]||this.default_weight||1,X=0,q=L.length;X<q;)for(var p=L[X++],aa=0,r=a.length;aa<r;){var U=a[aa++],C=U.find(A,p);C&&C.length&&J.push({field:A,hits:v(C),weight:T,
value:p,db:U})}J.sort(E);z=0;L=J.length;for(m={};z<L;)if(O=J[z++],A=O.hits,T=O.db,Q=T.absrefs,X=0,q=A.length,t||Q)for(;X<q;)p=A[X++],m[p]||(m[p]=p,l[p]||(e.push(T.ref(p)),l[p]=p),d[p]=(d[p]||0)+1,c[p]=(c[p]||0)+O.weight);else p=A[X++],A=T.ref(p),Q=A._qid||Q&&A._id||A.getQID(),m[Q]||(m[Q]=Q,l[Q]||(e.push(A),l[Q]=Q),d[Q]=(d[Q]||0)+1,c[Q]=(c[Q]||0)+O.weight)}if(1<g){a=this.results=[];b=new D;f=new D;t=0;for(l=e.length;t<l;)k=e[t++],g=d.get(k),2<=g&&(J=c.get(k),b.set(k,J),f.set(k,g),a.push(k));a._allstrings=
!1;a._sortlen=a.length;this.results=a;this.scores=b;this.counts=f}else this.results=v(e),this.scores=c,this.counts=d;return this};return a}());fdjt.Ajax=function(){function a(a,b){var d=a,e=!1;"&"===a[-1]?e=!1:0<=a.indexOf("?")?e=!0:d=a+"?";if("string"===typeof b)d=d+(e?"&":"")+b;else if(b.length)for(var f=0;f<b.length;)b[f]&&(d=d+(e?"&":"")+encodeURIComponent(b[f])+"="+encodeURIComponent(b[f+1]),e=!0),f+=2;else for(f in b)b.hasOwnProperty(f)&&(d=d+(e?"&":"")+encodeURIComponent(f)+"="+encodeURIComponent(b[f]),e=!0);return d}function r(b,d,e,f,l,k){var g=new XMLHttpRequest;d=e?a(d,e):d;g.onreadystatechange=function(){4===g.readyState&&200===
g.status?b(g):f&&f(g)};k&&(g.timeout=k,f&&(g.ontimeout=function(a){f(g)}));g.open("GET",d);g.withCredentials=!0;if(l)for(var m in l)l.hasOwnProperty(m)&&g.setRequestHeader(m,l[m]);g.send(null);return g}function g(a,b,e){if(b&&d(b))return!1;var f=fdjt.DOM("SCRIPT");b&&(f.id=b);e&&(f.oncleanup=e);f.language="javascript";f.src=a;document.body.appendChild(f)}function m(a){if(a=d(a)){if(a.oncleanup)a.oncleanup();e.remove(a)}}function k(a){fdjt.UI.AutoPrompt.cleanup(a);for(var b=!1,d=e.getChildren(a,"INPUT"),
f=0;f<d.length;){var l=d[f++];!l.disabled&&(/(radio)|(checkbox)/i.exec(l.type)?l.checked:1)&&(b=(b?b+"&":"")+l.name+"="+encodeURIComponent(l.value))}d=e.getChildren(a,"TEXTAREA");for(f=0;f<d.length;)l=d[f++],l.disabled||(b=(b?b+"&":"")+l.name+"="+encodeURIComponent(l.value));a=e.getChildren(a,"SELECT");for(f=0;f<a.length;)for(var l=a[f++],d=l.name,l=e.getChildren(l,"OPTION"),k=0;k<l.length;){var g=l[k++];g.selected&&(b=(b?b+"&":"")+d+"="+encodeURIComponent(g.value))}return b}function q(a,b,d,e){e&&
(b=b.toLowerCase());a.hasOwnProperty(b)?(e=a[b],e.push?e.push(d):a[b]=[e,d]):a[b]=d}function u(a,b,d){var f=a.getAttribute("ajaxaction")||a.action;if(!f)return!1;var l=a.getAttribute("synchronous");b||(a.oncallback?b=a.oncallback:a.getAttribute("ONCALLBACK")&&(b=new Function("req","form",a.getAttribute("ONCALLBACK")),a.oncallback=b));var g=!1,m=!1,q=new XMLHttpRequest,p=k(a);e.addClass(a,"submitting");l?"GET"===a.method?q.open("GET",f+"?"+p,!1):"PUT"===a.method?q.open("PUT",f,!1):q.open("POST",f,
!1):"GET"===a.method?q.open("GET",f+"?"+p):"PUT"===a.method?q.open("PUT",f):q.open("POST",f);q.onreadystatechange=function(){4===q.readyState&&200<=q.status&&300>q.status?(e.dropClass(a,"submitting"),g=!0,b&&b(q,a),m=!0):m=!1};d&&q.setRequestHeader("Accept",d);q.withCredentials=!0;try{"GET"===a.method?q.send():(q.setRequestHeader("Content-type","application/x-www-form-urlencoded"),q.send(p)),g=!0}catch(r){}l&&!m&&4===q.readyState&&200<=q.status&&300>q.status&&(e.dropClass(a,"submitting"),g=!0,b&&
b(q,a));return g}function p(a){var b=a.getAttribute("jsonpuri");if(!b)return!1;var d=a.id?"JSONP"+a.id:"FORMJSONP",f=k(a);e.addClass(a,"submitting");try{g(b+"?"+f,d,function(){fdjt.DOM.dropClass(a,"submitting")})}catch(v){return m(d),l.warn("Attempted JSONP call signalled %o",v),!1}return!0}function f(a,b){var d=a.length;b||(b=0);for(var e=Array(d-b);b<d;)e[b]=a[b],b++;return e}function b(b,d,e){var f=new XMLHttpRequest;d=a(d,e);f.open("GET",d,!1);f.send(null);return b?b(f):f}var e=fdjt.DOM,l=fdjt.Log,
d=fdjt.ID;r.textCall=function(a,b){return r(function(b){a(b.responseText)},b,e.Array(arguments,2))};r.jsonCall=function(a,b){return r(function(b){a(JSON.parse(b.responseText))},b,e.Array(arguments,2))};r.xmlCall=function(a,b){return r(function(b){a(b.responseXML)},b,e.Array(arguments,2))};r.jsonpCall=g;r.jsonpFinish=m;r.formParams=k;r.formJSON=function(a,b){fdjt.UI.AutoPrompt.cleanup(a);for(var d={},f=e.getChildren(a,"INPUT"),l=0;l<f.length;){var k=f[l++];!k.disabled&&("radio"===k.type||"checkbox"===
k.type?k.checked:1)&&q(d,k.name,k.value,b||!1)}f=e.getChildren(a,"TEXTAREA");for(l=0;l<f.length;)k=f[l++],k.disabled||q(d,k.name,k.value,b||!1);f=e.getChildren(a,"SELECT");for(l=0;l<f.length;)for(var g=f[l++],k=g.name,g=e.getChildren(g,"OPTION"),m=0;m<g.length;){var p=g[m++];p.selected&&q(d,k,p.value,b||!1)}return d};r.formSubmit=u;r.get=function(a){return b(!1,a,f(arguments,1))};r.getText=function(a){return b(function(a){return a.responseText},a,f(arguments,1))};r.getJSON=function(a){return b(function(a){return JSON.parse(a.responseText)},
a,e.Array(arguments,1))};r.getXML=function(a){return b(function(a){return a.responseXML},a,e.Array(arguments,1))};r.onsubmit=function(a,b){a=a||window.event||null;var d=a.nodeType?a:fdjt.UI.T(a);fdjt.UI.AutoPrompt.cleanup(d);if(e.hasClass(d,"submitting"))return e.dropClass(d,"submitting"),d.fdjtsubmit=!1;d.fdjtsubmit=!0;e.addClass(d,"submitting");return u(d,b)||p(d)?(fdjt.UI.cancel(a),!0):!1};return r}();var WSN=function(){function a(b,e,l,d){if(""===b)return b;if(!b&&this instanceof a)return e&&(this.sortfn=e),l&&(this.wordfn=l),d&&(this.keepdup=d),this;if(!b)return b;"undefined"===typeof e&&(e=a.sortfn||!1);"undefined"===typeof l&&(l=a.wordfn||!1);"undefined"===typeof d&&(d=a.keepdup||!1);if("string"===typeof b){b=f(b).toLowerCase().replace(p,"");b.trim?b=b.trim():(0<b.search(/\S/)&&(b=b.slice(b.search(/\S/))),0<b.search(/\s+$/)&&(b=b.slice(0,b.search(/\s+$/))));if(""===b)return"";b=b.split(/\W*\s+\W*/g);
var c,k=[],h;h=b.length;var q,v;if(0===h)return"";b[0]=b[0].replace(/^\W+/,"");1<h&&(b[h-1]=b[h-1].replace(/\W+$/,""));if(l){if("number"===typeof l)for(q=0,v=b.length;q<v;)h=b[q++],c.length>l&&k.push(h);else if(l.call)for(q=0,v=b.length;q<v;)(h=l(b[q++]))&&k.push(h),q++;else for(q=0,v=b.length;q<v;)c=b[q++],h=l[c],""!==h&&(h&&"string"===typeof h?k.push(h):k.push(c));k.length&&(b=k)}l=e;!0===e?l=r:e===g&&(l=!1);if(e&&d)return b.sort(l).join(" ");if(e){a:if(e=b.sort(l),d=0,l=e.length,c=!1,!(2>l))for(;d<
l;)if(c&&e[d]===c){d=e[0];l=[d];c=1;for(b=e.length;c<b;)e[c]===d?c++:l.push(d=e[c++]);e=l;break a}else c=e[d++];return e.join(" ")}return b.join(" ")}if(b.nodeType){if(3===b.nodeType)return a(b.nodeValue);if(1===b.nodeType)return a(m(b))}throw Error("bad arg to WSN");}function r(a,e){var f=a.length,d=e.length;return f===d?a>e?-1:a<e?1:0:f>d?-1:1}function g(a,e){return a>e?-1:a<e?1:0}function m(a,e){if(a.nodeType){if(3===a.nodeType)return e?e+a.nodeValue:a.nodeValue;if(1===a.nodeType){var f=a.childNodes,
d=window.getComputedStyle?window.getComputedStyle(a):{position:"static",display:"block"};if("static"!==d.position)return e||"";"inline"!==d.display?e="\n"+(e||""):e||(e="");for(var d=0,c=f.length;d<c;){var k=f[d++];3===k.nodeType?e+=k.nodeValue:1===k.nodeType&&(e=m(k,e))}return e}return e?e:""}return e||""}function k(b,e,f,d,c){"undefined"===typeof e&&(e=a.hashfn||!1);"undefined"===typeof f&&(f=a.sortfn||!1);"undefined"===typeof d&&(d=a.wordfn||!1);"undefined"===typeof c&&(c=a.keepdup||!1);return(b=
a(b,f,d,c))?e?e(b):b:b}function q(b,e,f,d,c){"undefined"===typeof e&&(e=a.hashfn||!1);"undefined"===typeof f&&(f=a.sortfn||!1);"undefined"===typeof d&&(d=a.wordfn||!1);"undefined"===typeof c&&(c=a.keepdup||!1);for(var k={},h=0,g=b.length;h<g;){var m=b[h++],q=a(m,f,d,c),q=e?e(q):q;k[q]=m}return k}var u=fdjt.Hash,p=/(\pM)/g,f=fdjt.String.decodeEntities;a.lensort=r;a.nativesort=g;a.prototype.textify=a.textify=m;a.fuddle=function(b,e){return a(b,e||r)};a.md5ID=function(){var b=a.apply(null,arguments);
if(b){if(a.md5)return a.md5(b);if(u&&u.hex_md5)return u.hex_md5(b);throw Error("No MD5 implementation");}return b};a.sha1ID=function(){var b=a.apply(null,arguments);if(b){if(a.sha1)return a.md5(b);if(u&&u.hex_sha1)return u.hex_sha1(b);throw Error("No SHA1 implementation");}return b};a.hash=k;a.prototype.Hash=function(b){return k(b,this.hashfn||a.hashfn||!1,this.sortfn||a.sortfn||!1,this.wordfn||a.wordfn||!1,this.keepdup||a.keepdup||!1)};a.maphash=q;a.prototype.maphash=function(b){return q(b,this.hashfn||
a.hashfn||!1,this.sortfn||a.sortfn||!1,this.wordfn||a.wordfn||!1,this.keepdup||a.keepdup||!1)};a.mapMD5=function(b,e,f,d){return q(b,a.md5||u&&u.hex_md5,e,f,d)};a.mapSHA1=function(b,e,f,d){return q(b,a.sha1||u&&u.hex_sha1,e,f,d)};a.md5=u&&u.hex_md5;a.sha1=u&&u.hex_sha1;return a}();fdjt.WSN=WSN;fdjt.TextIndex=function(){function a(b){function e(a,b){for(var c=g(a).replace(/\u00ad/g,"").split(/\b/g),d=[],e=0,f=c.length;e<f;){var l=c[e++];if(!(2>l.length||0>l.search(/\w/)||h.hasOwnProperty(l)))if(m)for(var k=0,X=m.length;k<X;)m[k++](l);else if(d.push(l),v.hasOwnProperty(l)&&(k=v[l],"string"===typeof k?d.push(k):d=d.concat(k)),q)for(k=0,X=q.length;k<X;){var C=q[k++](l);"string"===typeof C?d.push(C):d=d.concat(C)}}c=0;e=d.length;r.hasOwnProperty(b)?r[b]=r[b].concat(d):(r[b]=d,y.push(b));for(;c<
e;)f=d[c++],p.hasOwnProperty(f)?p[f].push(b):(u.push(f),p[f]=[b])}function f(a){if(h.hasOwnProperty(a))return!0;if(m)for(var b=0,c=m.length;b<c;)if(m[b++](a))return!0;return!1}function d(a){for(var b=v[a]||[],c=0,d=q.length;c<d;){var e=q[c++](a);e&&("string"===typeof e?b.push(e):b=b.concat(e))}return b}function c(){for(var a=0,b=u.length;a<b;){var c=u[a++];if(0===c.search(/[A-Z][a-z]/)){var d=c.toLowerCase();p.hasOwnProperty(d)&&(p[d]=p[d].concat(p[c]))}}}b||(b={});var m=b.stopfns||!1,h={},q=b.rootfns||
!1,v={},p={},r={},u=[],y=[],D,N;if(this instanceof a){this._indexer=e;if(b.stopwords){var E=b.stopwords;D=0;for(N=E.length;D<N;){var F=E[D++];h[F]=F}}if(b.stdstops)for(D=0,N=k.length;D<N;)E=k[D++],h[E]=E;this.capwords=b.capwords||{};this.termindex=p;this.idterms=r;this.allterms=u;this.allids=y;this.opts=b;this.stopWord=f;this.getRoots=d;this.mergeTerms=c;this.finishIndex=function(){for(var a=[],b={},c=0,d=u.length,e=[],f=this.capwords;c<d;){var h=u[c++];if(0===h.search(/[A-Z][a-z]/)){var l=h.toLowerCase();
p.hasOwnProperty(l)?f.hasOwnProperty(h)?(b[h]=p[h],a.push(h)):e.push(h):(b[h]=p[h],a.push(h))}else b[h]=p[h],a.push(h)}c=0;for(d=e.length;c<d;)f=e[c++],h=f.toLowerCase(),b[h]=b[h].concat(p[f]);this.termindex=p=b;this.allterms=u=a};return this}return new a(b)}for(var r=fdjt.String,g=r.stdspace,m=fdjt.DOM.textify,k="a i -- am an as at be by d' de di do ex he if in is it me my no o' of on or so t' to up us we ya ye any are but can cum des did ere fer few for had has her him his hoo how i'd i'm its lot may nor not off our qua s/p she ten the via was who why yet you 'tis amid atop been both does doth down d\u2019 each even from haec hast hath have he'd he's here hers i'll i're i've into it'd it's last less like many mine miss more most must near nigh none o'er once only onto ours over o\u2019 past port reg. sans says some such thae than that thee them then they thir this thou thro thru thus till unto upon upto we'd were what when whom will wilt with your yous zero abaft aboon about above adown afore after ain't along among anear anent aught baith being below can't circa could didst doest doeth don't every fewer fifty forty gonna he'll he're he've her'n his'n isn't it'll maybe might neath never noone one's other our'n round shall shalt she'd she's since their there these those thro' today under until we'll we're we've where which while who'd who's whose whoso won't would you'd yours youse aboard across allyou amidst anyone aren't around before behind beside beyond cannot contra couple didn't during either eleven except google hadn't hasn't having inside itself myriad myself no-one nobody o\u2019er quibus she'll she're she've should sundry that'd that's theirs they'd thirty this'd thwart tother toward twelve twenty unless unlike versus wasn't what's whence whilst withal within you'll you're you've your'n against ain\u2019t amongst another anybody astride athwart because beneath besides between betwixt can\u2019t despite doesn't don\u2019t haven't herself himself hisself however hundred isn\u2019t neither nothing oneself ourself outside outwith pending perhaps several someone that'll there's they'll they're they've this'll through thro\u2019 thyself towards weren't whereby wherein whereof whereon whereto whether whoever without won\u2019t you-all aren\u2019t didn\u2019t hadn\u2019t hasn\u2019t wasn\u2019t doesn\u2019t haven\u2019t weren\u2019t".split(" "),
q={},u=0,p=k.length;u<p;){var f=k[u++];q[f]=f}a.default_stops=q;a.prototype.indexText=function(a,e){var f=this._indexer;if("string"===typeof a)e&&f(a,e);else if(a.nodeType)e||(e=a.id),e&&f(m(a),e);else if(a.length)for(var d=0,c=a.length;d<c;){var k=a[d++];1===k.nodeType&&k.id&&f(m(k),k.id)}};a.prototype.prefixTree=function(){if(this.prefixtree)return this.prefixtree;for(var a=this.prefixtree={strings:[]},e=r.prefixAdd,f=this.allterms,d=0,c=f.length;d<c;){var k=f[d++];e(a,k,0)}return a};return a}();fdjt.UI||(fdjt.UI={});fdjt.UI.CoHi||(fdjt.UI.CoHi={classname:"cohi"});fdjt.UI.AutoPrompt||(fdjt.UI.AutoPrompt={});fdjt.UI.InputHelp||(fdjt.UI.InputHelp={});fdjt.UI.Ellipsis||(fdjt.UI.Ellipsis={});fdjt.UI.Expansion||(fdjt.UI.Expansion={});fdjt.UI.Collapsible||(fdjt.UI.Collapsible={});fdjt.UI.Tabs||(fdjt.UI.Tabs={});fdjt.UI.MultiText||(fdjt.UI.MultiText={});fdjt.UI.Reticle||(fdjt.UI.Reticle={});fdjt.UI.FocusBox||(fdjt.UI.FocusBox={});
(function(){function a(a,q){var u=q||g.CoHi.classname,p=a.name||a,f=m[u],b;if(f!==p){if(f){var e=document.getElementsByName(f),f=0;for(b=e.length;f<b;)r.dropClass(e[f++],u)}m[u]=p||!1;if(p)for(p=document.getElementsByName(p),b=p.length,f=0;f<b;)r.addClass(p[f++],u)}}var r=fdjt.DOM,g=fdjt.UI,m={};g.CoHi.highlight=a;g.CoHi.onmouseover=function(k,g){for(var m=r.T(k);m;){if(3===m.nodeType)m=m.parentNode;else if(1!==m.nodeType){m=!1;break}if("INPUT"===m.tagName||"TEXTAREA"===m.tagName||"A"===m.tagName&&
m.href)return;if(m.name||m.getAttribute("name"))break;else m=m.parentNode}m&&a(m.name||m.getAttribute("name"),g)};g.CoHi.onmouseout=function(k,m){a(!1,m||g.CoHi.classname)}})();
fdjt.UI.Highlight=function(){function a(b,e,f){if(1===b.nodeType){if(b.childNodes)for(var d=b.childNodes,c=0,k=d.length;c<k;)a(d[c++],e,f);b.className&&0<=b.className.search(e)&&f.push(b)}}function r(a){var e=a.childNodes;if(e){for(var f=document.createDocumentFragment(),d=[],c=0,k=e&&e.length;c<k;)d.push(e[c++]);c=0;for(k=d.length;c<k;)f.appendChild(d[c++]);q.replace(a,f)}else q.remove(a)}function g(a,e,l,d){e||(e="fdjthighlight");var c=!1;if(3===a.nodeType)if(0<=a.nodeValue.search(/\S/g))c=q("span."+
e);else var c=f(a.parentNode),k=a.nextSibling,h=a.prevSibling,g=k&&1===k.nodeType&&f(k),m=h&&1===h.nodeType&&f(h),g=g&&g.display,m=m&&m.display,c="normal"!==c.whiteSpace?q("span."+e):k||h?"inline"!==g&&"table-cell"!==g&&"inline"!==m&&"table-cell"!==m?!1:q("span."+e):q("span."+e);else{if(1!==a.nodeType||u(a,e))return a;u(a,"fdjtskiptext")||(h=f(a),k=h.display,h=h.position,"static"!==h&&""!==h)||("block"===k?c=q("div."+e):"inline"===k&&(c=q("span."+e)))}if(!c)return a;l&&(c.title=l);if(d)for(var p in d)d.hasOwnProperty(p)&&
c.setAttribute(p,d[p]);q.replace(a,c);c.appendChild(a);return c}function m(a,e,f,d,c,k){var h=a.nodeValue,g=a.parentNode;if(!1===f||"undefined"===typeof f)f=h.length;if(e!==f){var m;if(m=0<e)m=h.slice(0,e),m=document.createTextNode(m);e=h.slice(e,f);d=q("span."+(d||"fdjthighlight"),e);c&&(d.title=c);if(k)for(var p in k)k.hasOwnProperty(p)&&d.setAttribute(p,k[p]);if(c=f<h.length)f=h.slice(f),c=document.createTextNode(f);f=c;m&&f?(g.replaceChild(f,a),g.insertBefore(d,f),g.insertBefore(m,d)):m?(g.replaceChild(d,
a),g.insertBefore(m,d)):f?(g.replaceChild(f,a),g.insertBefore(d,f)):g.replaceChild(d,a);return d}}function k(a,e,f,d){a=q.refineRange(a);var c=a.startContainer,k=a.endContainer;if(c===k)return[m(c,a.startOffset,a.endOffset,e,f,d)];for(var h=[],r=c;r&&!r.nextSibling;)r=r.parentNode;for(r=r.nextSibling;r&&r!==k;)if(p(k,r))r=r.firstChild;else{for(var v=r;v&&!v.nextSibling;)v=v.parentNode;v=v.nextSibling;h.push(g(r,e,f,d));r=v}h.push(m(c,a.startOffset,!1,e,f,d));h.push(m(k,0,a.endOffset,e,f,d));return h}
var q=fdjt.DOM,u=q.hasClass,p=q.getParent,f=q.getStyle;k.clear=function(b,e){var f=[];b===e||u(b,e)?f=[b]:a(b,new RegExp("\\b"+e+"\\b","g"),f);for(var d=0,c=f.length;d<c;)r(f[d++])};k.remove=r;return k.highlight=k}();
(function(){function a(a){return 1===a.nodeType&&"INPUT"===a.tagName&&("checkbox"===a.type||"radio"===a.type)}function r(b){if(a(b))return b;var c=e(b,a);if(c)return c;c=l(b,"input");if(c.length){b=0;for(var f=c.length;b<f;){if(a(c[b]))return c[b];b++}}return!1}function g(d,c){var k,h;if("string"===typeof d)d=u(d);else if(d.length){k=0;for(h=d.length;k<h;)g(d[k++],c);return}if(d&&d.nodeType){var m=p(d,"checkspan")?d:e(d,".checkspan");if(!m)return!1;var q=a(d)&&d||r(d)||r(m);if(!q)return!1;if(p(m,
"isdisabled")){if(q.disabled)return!1;b(m,"isdisabled")}else if(q.disabled)return f(m,"isdisabled"),!1;k=p(m,"ischecked");var H=!1,G=[];"undefined"===typeof c&&(c=k);q.checked!==c?(q.checked=c,H=!0):k!==q.checked&&(H=!0);c?f(m,"ischecked"):b(m,"ischecked");if(H&&"radio"===q.type){(k=q.form)||(k=e(q,".fdjtinputs"));k||(k=m.parentNode);var x=q.name,y=l(k,"input");k=0;for(h=y.length;k<h;){var D=y[k++];if(D!==q&&"radio"===D.type&&D.name===x){var N=e(D,".checkspan");N!==m&&p(N,"ischecked")&&(D.checked||
G.push(D))}}}H&&(m=document.createEvent("HTMLEvents"),m.initEvent("change",!1,!0),q.dispatchEvent(m));if(G.length)for(k=0,h=G.length;k<h;)q=G[k++],m=e(q,".checkspan"),b(m,"ischecked"),m=document.createEvent("HTMLEvents"),m.initEvent("change",!1,!0),q.dispatchEvent(m)}}function m(){for(var a=fdjt.$(".checkspan"),b=0,e=a.length;b<e;)for(var h=a[b++],l=k.getInputs(h),g=0,m=l.length;g<m;){var q=l[g++];if("radio"===q.type||"checkspan"===q.type){q.checked&&f(h,"ischecked");q.disabled&&f(h,"isdisabled");
break}}}var k=fdjt.DOM,q=fdjt.UI,u=fdjt.ID,p=k.hasClass,f=k.addClass,b=k.dropClass,e=k.getParent,l=k.getChildren;q.CheckSpan=function(a,b,e,f){var l=k.Input("input[type=checkbox]",b,e),g=k(a||"span.checkspan",l);f?(l.checked=!0,k.addClass(g,"ischecked")):l.checked=!1;4<arguments.length&&k.appendArray(g,arguments,4);return g};q.CheckSpan.set=g;q.CheckSpan.onclick=function(a){a=a||window.event;a=a.target||a.srcTarget;if("TEXTAREA"!==a.tagName&&"SELECT"!==a.tagName&&"OPTION"!==a.tagName&&("INPUT"!==
a.tagName||"checkbox"===a.type||"radio"===a.type)){var b="A"===a.tagName?a:e(a,"A");if(!b||!b.href)if(b=e(a,".checkspan"))return b=p(b,"ischecked"),g(a,!b),!1}};q.CheckSpan.changed=function(a){a=a||window.event;a=q.T(a);if("radio"===a.type||"checkbox"===a.type){var c=e(a,".checkspan");c&&(a.checked?f:b)(c,"ischecked")}if("radio"===a.type)for(var c=a.form,l=document.getElementsByName(a.name),h=0,g=l.length;h<g;){var m=l[h++];m!==a&&m.form===c&&"radio"===m.type&&(m=k.getParent(m,".checkspan"),b(m,"ischecked"))}};
q.CheckSpan.initCheckspans=m;fdjt.addInit(m,"CheckSpans",!1)})();
fdjt.UI.ProgressBar=function(){function a(a){"undefined"===typeof a?a=g("div.fdjtprogress",g("div.indicator"),g("div.message")):"string"===typeof a&&(a=g("div.fdjtprogress",g("HR"),g("div.message",a)));this.dom=a;return this}function r(a,k,q){"string"===typeof a&&(a=document.getElementById(a));"number"===typeof q&&(k=k/q*100);a&&(a=a.dom||a,a.nodeType&&(g.getChildren(a,"div.indicator")[0].style.width=k+"%"))}var g=fdjt.DOM;a.setProgress=r;a.setMessage=function(a){"string"===typeof a&&(a=document.getElementById(a));
if(a){var k=a.dom||a;if(k.nodeType){var q=g.getChildren(k,".message")[0],r=g("div.message");g.appendArray(r,g.Array(arguments,1));k.replaceChild(r,q)}}};a.prototype.setProgress=function(a,k){r(this.dom,a,k)};a.prototype.setMessage=function(){var a=this.dom,k=g.getChildren(a,".message")[0],q=g("div.message");g.appendArray(q,g.Array(arguments));a.replaceChild(q,k)};return a}();
(function(){function a(a){for(a=u.T(a);a;)if(1!==a.nodeType||"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||!a.getAttribute("helptext"))a=a.parentNode;else{(a=p(a.getAttribute("helptext")))&&u.addClass(a,"showhelp");break}}function r(b){b=b||window.event||null;var c=u.T(b);c&&f(c,"isempty")&&(c.value="",e(c,"isempty"));a(b)}function g(a){for(a=u.T(a);a;)if(1!==a.nodeType||"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||!a.getAttribute("HELPTEXT"))a=a.parentNode;else{(a=p(a.getAttribute("HELPTEXT")))&&
e(a,"showhelp");break}}function m(a){var c=u.T(a);if(""===c.value){b(c,"isempty");var f=c.prompt||c.getAttribute("prompt")||c.title;f&&(c.value=f)}else e(c,"isempty");g(a)}function k(a){if(a=u.getChildren(a,".isempty"))for(var b=0,e=a.length;b<e;)a[b++].value=""}function q(a){a=u.T(a);k(a)}var u=fdjt.DOM,p=fdjt.ID,f=u.hasClass,b=u.addClass,e=u.dropClass,l=fdjt.String.isEmpty;fdjt.UI.AutoPrompt.setup=function(a,c){for(var e="FORM"===a.tagName?[a]:u.getChildren(a||document.body,"FORM"),f=0,k=e.length;f<
k;){var g=e[f++],p=u.getChildren(g,"INPUT.autoprompt,TEXTAREA.autoprompt");if(p.length){for(var G=0,x=p.length;G<x;){var y=p[G++];y.blur();if(l(y.value)){b(y,"isempty");var D=y.prompt||y.getAttribute("prompt")||y.title;D&&(y.value=D)}c||(u.addListener(y,"focus",r),u.addListener(y,"blur",m))}c||u.addListener(g,"submit",q)}}};fdjt.UI.AutoPrompt.onfocus=r;fdjt.UI.AutoPrompt.onblur=m;fdjt.UI.AutoPrompt.onsubmit=q;fdjt.UI.AutoPrompt.cleanup=k;fdjt.UI.InputHelp.onfocus=a;fdjt.UI.InputHelp.onblur=g})();
(function(){var a=fdjt.DOM,r=fdjt.UI,g=fdjt.String.isEmpty,m=a.hasClass;r.MultiText.keypress=function(k,q,u,p){k=k||event;var f=k.charCode,b=String.fromCharCode(f),e=r.T(k);q instanceof RegExp?(u=q,q=!1):q&&q.call&&(p=q,q=!1);!q&&e.getAttribute("data-sepchars")&&(q=e.getAttribute("data-sepchars"));if(13===f&&g(e.value)&&m(e,"fdjtentersubmit"))fdjt.UI.cancel(k),e.form.submit();else if(13===f||q&&0<=q.indexOf(b)){!u&&e.getAttribute("data-separator")&&(u=new RegExp(e.getAttribute("data-separator"),"g"));
q=e.getAttribute("data-checkspec")||"div.checkspan";u=u?e.value.split(u):[e.value];f=0;for(b=u.length;f<b;){var l=u[f++];if(p)a(e.parentNode,"\n",p(e.name,l));else{var d=a.Input("[type='checkbox']",e.name,l),l=a(q,d,l);d.checked=!0;a.addClass(l,"ischecked");a(e.parentNode,"\n",l)}}r.cancel(k);e.value=""}}})();
(function(){function a(a,e,k){k||(k=r.findAttrib(a,"shownclass","http://fdjt.org/")||"fdjtshown");for(var d=!1,c=r.getChildren(a,".tab"),m=0;m<c.length;){var h=c[m++];if(h.getAttribute("contentid")===e)p(h,k),d=!0;else if(u(h,k)){f(h,k);var B=(h=r.getAttrib(h,"contentid"))&&q(h);B?f(B,k):g.warn("No reference for tab content %o",h)}else f(h,k)}q(e)?d?p(e,k):g.warn("a tab for %s was not found in %o",e,a):g.warn("No reference for tab content %o",e)}var r=fdjt.DOM,g=fdjt.Log,m=fdjt.State,k=fdjt.UI,q=
fdjt.ID,u=r.hasClass,p=r.addClass,f=r.dropClass;k.Tabs.click=function(a,e){var l=k.T(a);e||(e=r.findAttrib(l,"shownclass","http://fdjt.org/")||"fdjtshown");if(l){for(var d=!1;l.parentNode&&!(d=r.getAttrib(l,"contentid"));)l=l.parentNode;if(d){var c=document.getElementById(d),q=r.getParent(l,".tabs")||l.parentNode,q=r.getChildren(q,".tab")||q.childNodes;if(null===c)g("No content for "+d);else{for(var h=0;h<q.length;){var B=q[h++],v;if(1===B.nodeType&&(v=r.getAttrib(B,"contentid"))&&v){var H=document.getElementById(v);
B!==l&&u(B,e)&&(f(B,e),H&&f(H,e))}}u(l,e)?(f(l,e),f(c,e)):(p(l,e),p(c,e));if(l=r.findAttrib(l,"tabstate"))"#"===l?(c={},k.scrollSave(c),document.location.hash=l+d,k.scrollRestore(c)):m.setCookie(l,d);return!1}}}};k.Tabs.selectTab=a;k.Tabs.setup=function(b){b?"string"===typeof b&&(b=q(b)):b=r.$(".tabs[tabstate]");if(b&&b.getAttribute("tabstate")){var e=b.getAttribute("tabstate"),f=!1;if("#"===e){f=document.location.hash;"#"===f[0]&&(f=f.slice(1));e=f&&q(f);if(!e)return;var d={};k.scrollSave(d);window.scrollTo(0,
0);r.isVisible(e)||k.scrollRestore(d)}else f=m.getQuery(e)||m.getCookie(e);f&&("#"===f[0]&&(f=f.slice(1)),f&&a(b,f))}};k.Tabs.getSelected=function(a){a=r.getChildren(a,".tab");for(var e=0;e<a.length;){var f=a[e++];if(u(f,"shown"))return f.getAttribute("contentid")}return!1}})();
(function(){var a=fdjt.DOM,r=fdjt.UI;r.Expansion.toggle=function(g,m,k){g=g||window.event;g=r.T(g);(m=a.getParent(g,m||".fdjtexpands"))&&a.toggleClass(m,k||"fdjtexpanded")};r.Expansion.onclick=r.Expansion.toggle;r.Collapsible.click=function(g){g=g||window.event;var m=r.T(g);!r.isDefaultClickable(m)&&(m=a.getParent(m,".collapsible"))&&(r.cancel(g),a.toggleClass(m,"expanded"))};r.Collapsible.focus=function(g){g=g||window.event;g=r.T(g);(g=a.getParent(g,".collapsible"))&&a.toggleClass(g,"expanded")};
r.toggleParent=function(g,m,k){g=r.T(g);(m=a.getParent(g,m))&&a.toggleClass(m,k)}})();
(function(){function a(a){a?(a.scrollX=!1,a.scrollY=!1):u=!1}function r(a){a?(a.scrollX=window.scrollX,a.scrollY=window.scrollY):(u||(u={}),u.scrollX=window.scrollX,u.scrollY=window.scrollY)}function g(a,b){if(0===b||b||!k.isVisible(a)){for(var e=a.offsetTop,l=a.offsetHeight;a.offsetParent;)a=a.offsetParent,e+=a.offsetTop;var d=k.viewHeight();window.scrollTo(0,l/3*2<d/2-50?e+l/3-d/2:l<d-100?e-(50+l/2):e-50)}}function m(a){p&&(p=!1);if(a&&"number"===typeof a.scrollX)return window.scrollTo(a.scrollX,
a.scrollY),!0;if(!u||"number"!==typeof u.scrollY&&"number"!==typeof u.scrollX)return!1;window.scrollTo(u.scrollX,u.scrollY);u=!1;return!0}var k=fdjt.DOM,q=fdjt.UI,u=!1,p=!1;q.scrollTo=function(f,b,e,l,d){a(l);b&&(document.location.hash=b);e?setTimeout(function(){g(e,d);k.isVisible(f)||g(f,d)},100):setTimeout(function(){g(f,d)},100)};q.scrollSave=r;q.scrollRestore=m;q.scrollIntoView=g;q.scrollPreview=function(a,b,e){a?a!==p&&(u||r(),"number"===typeof a?window.scrollTo("number"===typeof b&&b||0,a):
g(a,e),p=a):(k.dropClass(document.body,"preview"),p&&p.className&&k.dropClass(p,"previewing"),p=!1)};q.scrollRestore=m})();
(function(){function a(k,q,r){var p=m(k),f=p.display;if("block"===f||"table-row"===f||"list-item"===f||"preformatted"===f){f=g(k,r);if(f.top>q)return k;if(f.bottom>q){if("avoid"===p.pageBreakInside)return k;for(var p=k.childNodes,f=0,b=p.length;f<b;){var e=p[f++];if(e=1===e.nodeType&&a(e,q,r))return e}return k}}return!1}var r=fdjt.DOM,g=r.getGeometry,m=r.getStyle;fdjt.UI.smartScroll=function(k,m,r){"undefined"===typeof r&&(r=k);if(0>=m)k.scrollTop=0;else{var p=a(r,m,r);p?(r=g(p,r||k),k.scrollTop=
r-top-m<k.offsetTop/4?r.top:m):k.scrollTop=m}}})();(function(){fdjt.UI.Delay=function(a,r,g){setTimeout(g,a)};fdjt.UI.Delayed=function(a,r){r||(r=25);setTimeout(a,r)}})();
(function(){var a=fdjt.DOM,r=fdjt.UI;r.dosubmit=function(g){g=g||window.event;g=r.T(g);g=a.getParent(g,"FORM");var m=document.createEvent("HTMLEvents");m.initEvent("submit",!1,!0);g.dispatchEvent(m);g.submit()};r.forceSubmit=function(a){var m=document.createEvent("HTMLEvents");m.initEvent("submit",!1,!0);a.dispatchEvent(m)};r.submitOnEnter=function(g){g=g||window.event;if(13===(g.keyCode||g.charCode)){var m=r.T(g),m=a.getParent(m,"FORM");r.cancel(g);m.submit()}};r.checkFileInputs=function(g){g=g||
window.event;for(var m=r.T(g),m=a.getInputs(m,!1,"file"),k=0,q=m.length;k<q;){var u=m[k++];u.value&&""!==u.value||(r.cancel(g),(fdjt.UI.alert||window.alert)("You need to specify a file!"))}}})();(function(){var a=fdjt.DOM,r=a.addClass,g=a.dropClass,m=a.getGeometry,k=a.getInsideBounds;fdjt.UI.Overflow=function(a){var u=m(a);k(a).bottom>u.bottom?r(a,"overflow"):g(a,"overflow")}})();
(function(){function a(a,b){p&&(p.style.left=a+"px");f&&(f.style.top=b+"px")}function r(){k()}function g(b,f,d){a(f||b.clientX,d||b.clientY)}function m(a){"undefined"===typeof a&&(a=!b);a?(p&&q.addClass(p,"highlight"),f&&q.addClass(f,"highlight"),b=!0):(p&&q.dropClass(p,"highlight"),f&&q.dropClass(f,"highlight"),b=!1)}function k(a){"undefined"===typeof a&&(a=1500);b||(m(!0),setTimeout(function(){m(!1)},a))}var q=fdjt.DOM,u=fdjt.UI,p=!1,f=!1,b=!1;u.Reticle.setup=function(){p||(p=q("div.reticle.vertical#VRETICLE",
" "),q.prepend(document.body,p));f||(f=q("div.reticle.horizontal#HRETICLE"," "),q.prepend(document.body,f));q.addListener(document,"mousemove",g);q.addListener(document,"click",r);u.Reticle.live=!0};u.Reticle.highlight=m;u.Reticle.flash=k;u.Reticle.onmousemove=g;u.Reticle.setXY=a;u.Reticle.live=!1})();(function(){var a=fdjt.DOM,r=fdjt.UI;r.uploadSpecified=function(g){g=g||window.event;(g=a.getParent(r.T(g),".fileuploader"))&&a.addClass(g,"inuse")}})();
(function(){function a(m,k){"string"===typeof m&&(m=g(m));if(!m)return!1;k||(k=m.getAttribute("data-interval")?parseInt(m.getAttribute("data-interval"),10):a.interval);m.getAttribute("data-images")||m.setAttribute("data-images",m.src);m.defaultsrc||(m.defaultsrc=m.src);var q=m.getAttribute("data-images").split("|");if(0===q.length)return!1;var r=0;return setInterval(function(){m.src===q[r]?r++:m.src=q[r++];r>=q.length&&(r=0)},k)}var r=fdjt.UI,g=fdjt.ID;a.reset=function(a){a.defaultsrc&&(a.src=a.defaultsrc)};
a.interval=1E3;r.ImageSwap=a})();
(function(){var a=fdjt.DOM,r=fdjt.UI,g=fdjt.ID,m=a.hasClass;r.T=function(a){a=a||window.event;return a.target||a.srcElement};r.noDefault=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1;return!1};r.noBubble=function(a){a=a||window.event;a.cancelBubble=!0};r.cancel=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1;a.cancelBubble=!0;return!1};r.isClickable=function(a){for(window.Event&&a instanceof window.Event&&(a=r.T(a));a;){if("A"===
a.tagName&&a.href||"INPUT"===a.tagName||"BUTTON"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"OPTION"===a.tagName||m(a,"checkspan")||m(a,"clickable")||m(a,"isclickable")||a.onclick)return!0;a=a.parentNode}return!1};r.isDefaultClickable=function(a){for(window.Event&&a instanceof window.Event&&(a=r.T(a));a;){if("A"===a.tagName&&a.href||"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"OPTION"===a.tagName||m(a,"isclickable"))return!0;a=a.parentNode}return!1};r.submitEvent=
function(a){for(a=a.nodeType?a:r.T(a);a&&"FORM"!==a.tagName;)a=a.parentNode;if(a){var g=document.createEvent("HTMLEvents");g.initEvent("submit",!0,!0);a.dispatchEvent(g)}};r.focusEvent=function(a){a=a.nodeType?a:r.T(a);var g=document.createEvent("HTMLEvents");g.initEvent("focus",!0,!0);a.dispatchEvent(g)};r.disableForm=function(k){"string"===typeof k&&(k=g(k));if(k){k=a.getChildren(k,"button,input,optgroup,option,select,textarea");for(var m=0,r=k.length;m<r;)k[m++].disabled=!0}}})();
(function(){function a(a,d,c,e,f){e=u(d,c,e||.2);var k="string"!==typeof e,q=d.length;f||(f=r);if("string"===typeof e&&e.length===q)return a?m(a,d):document.createTextNode(d);c=k?e[0]:e;e=k?e[1]:"";var p=Math.round(100*(c.length+e.length)/q);a&&b(G,"ellipsis");G=k?d.slice(c.length,q-e.length):d.slice(c.length);G=m("span.elided",G);k=m("span.elision",g("\u00a0\u2026\u2190%d%% more\u2192\u2026",100-p));p=m("span.delision",g("\u00a0\u2192\u2026hide %d%%\u2026\u2190\u00a0",100-p));k.title="show elided text";
p.title="hide elided text";k.onclick=f;p.onclick=f;var G=m(a||"span.ellipsis",c," ",k,p,G," ",e);a&&b(G,"ellipsis");G.title=g.stdspace(d);return G}function r(a){var d=!1;if(a)"string"===typeof a?a=q(a):a.nodeType||(d=a,a=k.T(a));else if(d=window.event||!1)a=k.T(d);else return;if(a=p(a,".ellipsis"))d&&k.cancel(d),f(a,"expanded")?(b(a,"compact"),e(a,"expanded")):(b(a,"expanded"),e(a,"compact"))}var g=fdjt.String,m=fdjt.DOM,k=fdjt.UI,q=fdjt.ID,u=g.ellipsize,p=m.getParent,f=m.hasClass,b=m.addClass,e=
m.dropClass;k.Ellipsis=a;a.expand=function(a){"string"===typeof a&&(a=q(a));a=p(a,".ellipsis");b(a,"expanded");e(a,"compact")};a.contract=function(a){"string"===typeof a&&(a=q(a));a=p(a,".ellipsis");b(a,"compact");e(a,"expanded")};a.toggle=r})();(function(){function a(a){a=a||window.event;a=g.T(a);""!==a.value&&(a=r.getParent(a,"FORM"))&&a.submit()}var r=fdjt.DOM,g=fdjt.UI;fdjt.addInit(function(){for(var g=r.$(".fdjtselectsubmit"),k=0,q=g.length;k<q;)r.addListener(g[k++],"change",a)},"selectsubmit")})();
(function(){var a=fdjt.DOM,r=fdjt.UI,g=a.getParent,m=a.addClass,k=a.dropClass;r.updatePasswordVisibility=function(a,g,k){a=a||window.event;"string"===typeof g&&(g=document.getElementById(g));g&&(a=r.T(a),g.type=k?a.checked?"PASSWORD":"TEXT":a.checked?"TEXT":"PASSWORD")};r.uploadSelected=function(g){g=g||window.event;g=r.T(g);(g=a.getParent(g,".upload"))&&a.addClass(g,"uploading")};r.FocusBox.focus=function(a){a=a||window.event;a=r.T(a);(a=g(a,".focusbox"))&&m(a,"focused")};r.FocusBox.blur=function(a){a=
a||window.event;a=r.T(a);var m=g(a,".focusbox");m&&setTimeout(function(){k(m,"focused")},200)}})();
(function(){function a(a){a=a?fdjt.keeptime?r.getChildren(a,".fdjtime"):r.getChildren(a,"time,.fdjtime"):fdjt.keeptime?r.$(".fdjtime"):r.$("time,.fdjtime");for(var g=0,u=a.length;g<u;){var p=a[g++],f=p.getAttribute("datetime")||p.getAttribute("data-datetime")||p.getAttribute("data-time"),b=f&&new Date(f),e=b&&"nogood"!==(b.getYear()||"nogood");f||(f=p.innerText,(e=(b=new Date(f))&&"nogood"!==(b.getYear()||"nogood"))&&("TIME"===p.tagName?p.setAttribute("datetime",f):p.setAttribute("data-datetime",
f)));e&&(p.title||(p.title=b.toGMTString()),m(p,"fdjtkeeptext")||(m(p,"fdjtisotime")?b.toISOString&&(p.innerHTML=b.toISOString()):m(p,"fdjtutctime")?b.toUTCString&&(p.innerHTML=b.toUTCString()):m(p,"fdjtdate")?b.toDateString&&(p.innerHTML=b.toDateString()):m(p,"fdjtdateortime")?b.toDateString&&b.toTimeString&&(b.toDateString()===(new Date).toDateString?p.innerHTML=b.toTimeString():p.innerHTML=b.toDateString()):m(p,"fdjtlocaletime")?b.toLocaleString&&(p.innerHTML=b.toLocaleString()):m(p,"fdjtlocaledate")?
b.toLocaleDate&&(p.innerHTML=b.toLocaleDate()):m(p,"fdjtlocaledateortime")?(b.toLocaleDateString&&b.toTimeString&&(b.toDateString()===(new Date).toDateString?p.innerHTML=b.toLocaleTimeString():p.innerHTML=b.toLocaleDateString()),b.toLocaleDate&&(p.innerHTML=b.toLocaleDate())):(m(p,"fdjthumantime"),p.innerHTML=b.toDateString&&b.toLocaleTimeString?b.toDateString()+" ("+b.toLocaleTimeString()+")":b.toLocaleString?b.toLocaleString():b.toString())))}}var r=fdjt.DOM,g=fdjt.UI,m=r.hasClass;fdjt.initTimeElements=
a;fdjt.autoInitTimeElements=function(){r.addListener(document.body,"DOMNodeInserted",function(k){k=k||window.event;a(g.T(k))})};fdjt.addInit(a,"TimeElements",!1)})();(function(){var a=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;fdjt.UI.vibrate=function(r){if(!a)return!1;a(r);return!0}})();
fdjt.disenableInputs=fdjt.UI.disenableInputs=function(){var a=fdjt.DOM,r=a.getStyle,g=a.hasClass,m=a.$;return function(a){for(var q=m("input,select,button,textarea",a),u=0,p=q.length;u<p;){var f=q[u++];if(!g(f,"fdjtignore")){for(var b=f,e=!1;b&&b!==a;){if("none"===r(b).display){e=!0;break}b=b.parentNode}f.disabled=e}}}}();fdjt.Dialog=function(){function a(a){a?"string"===typeof a&&(a={spec:a}):a={};var b=c(a.spec||"div.fdjtdialog");a.classes&&(b.className=(b.className||"")+(b.className?" ":"")+a.classes);a.style&&b.setAttribute("style",a.style);if(!(a.modal||a.keep||x(b,"fdjtmodal")||x(b,"fdjtkeep"))){var d=c("div.countdown","Closing\u2026");d.id="FDJTCOUNTDOWN"+E++;b.appendChild(d)}a.modal||a.noclose||x(b,"fdjtmodal")||(d=c.Image("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyEAYAAAE5qGRkAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAASAAAAEgARslrPgAAEXpJREFUeNrdXGl4VEW6fqv3bCT0SQjhVADpCggMuywiUTbZAoRNFlkER8SZwUdnrtuMy+idcUZFwHEYERdAkR1kcxRkXwVBWYSw5DSE5DQQyOmsnd677o9Ah5vcvt2ns3Cf+/7Jw6n63u99vzpL1anTALeh5NH2rNPGKQgBe6f0NhmW+D8HDygLxRKmG3JQUShljHPlEjWzjmszgwGt6Xi2Mfb5YLuTprM2xU2rGS20NWudNSPYIV+0sfYrtwX/XUgtLK304VCKoNhpf7ZoohIMUGgy6+QvqdlPEwy4JE5kIwwzwCHhg7VmuOCHt3IjABOcmkQlIJayQZ+uqc7wmliZodO/FMxQSpuyLg570EJb0cnaTj4bbK+k/ZjlozHVBCW0NUt33heyqhm0M5s1fR2iBbmT+s4BQZBlSSIkqKBGe8iGmqhJhJqBoQhUZ1DtIXrU1K6coxms5dq+Ecd/Tw+xdxNoqBoETzXSE4/xE1m7gpHN4YRh4uFgYDEdwB5buS9IvE7cw9bGvRwk7IHJ+LSsIBgfByCmeGmtItdSuI9qWVr2RHRCGuI2rw1ryQ0/tKUJQgv5unQxqaJmsyZUHPk1/4ov3fFJxLUvBkX++t2hmquv0s30T2ypccGdUvAfyYvkWWdisKcfgLdiU/D0aY9byJi88K5SX4f4VK+7Lspx7LGP+9QqXa3TygsvnI7rQnO5ULLFtwhnyN6eWlj6tKf5IbhhXLHkzvFaV47SXcxkC0yeiEsVAsp+ms7EL14JOrE/Rxey38VM4m9gPnZUBm9cIa/dUMQ1K2FCIZKWyiTqm0Qo4hqI+m4U8b1FraJwqCkkauuRljLsINZ1jBrfQYONQYOdRQ19HWjg5meQMC5JLXHYfn744Sv1Visppc0YHWeLtvZBnmtUYOnloYUpbUW3ZWPMu7UeuaU0kbH14R9M9QTlFn2Z2ROSaumwiXb2q+WtavYnxUnp/dhU4/aAlefhmGtopIlIKlqhybonzT75sPTzpGV1FW5/QpTZo3F/5gtIH1ypeDPiQC8CSF72QHBo7DqabKkcfoQXwkQ6f/ugaiU6JCF9tSwkymelvY+nhxX+Cn3QsjbuU/4iCsirFU+pzueFBw57QGgu35SuC9qQ55id0Cw2O+sEL8Jp7P2mh+pEJ1CB/JVDhKFyieSZtlOZKPZik2Pfw2JyDSccL6rm8yMOvOSk0Ey+KFmbdq/ZHPnz+JxYxjQj3WhOOqDNNoNqIWqhgw6a0m5CopwnXUo6Fa57xEZqGZMos+RnT0JTuMjAzWui5QlCCx08ZR8ISXKelJ/4e7XhGrUBwQr8k8fh4R11ntIFkQc3+Mb2UeuJtKN9NBUsM01JfBliyCFncRS53Lf/GiMSxtAB2s+mmIvl76WLs8OOeOhH6As03rLKmIY/Iom84bqmWrYHDjgrDglpcrFkS8hUXDSWJTxWCQfMSF0Xo5aOiEhD/CfHzC75uHRqTp9a7UHhs8T5ll+M/fE+WUjGuvaqFk7ghc+RKZjlQikv/lC47koubcs0kz+DGZVos/rXqtM1hxEtF6ebvbJV2vNbmSgBmsj0oy6iGAlotbVtxEw+EAQqVwupcoF0Oe5x1cZrGjsmVlicU4aDkftJp1XfRhzohgvashu1Ti27nvZjxrFX+Q3kIf3rlnc1VYBXrhcEuUSyxk2sq/Cwxs6JlZaC6WY0J23JgC+VYIMWfpCyDUKSfF3KTXwsPNFZamDp32YrT9IKy1/19Xd3UmuomGayfvu2FS1JT2Vm7dnIA/OpkTXZtq/mZM3+gVjIsoz3N5oBP23DHtxTPWksoiJjvMw+TJzHSnQna/avfnlxlqaz9ltLEIcUNBv5SM2OfDrpgYuuc8okOs1y1nClwQyU0p5M3J2KEnhwa0D1bZ6AAEjgq8g/0NPbXHlafN+yQHfXKwU97cS6bJ3Fb6AYjlFLI8wXINuQiymGs+aZcoz0F2+XOhsopqlswC6GAPQoGJQbNoAAILjFd6EQTt1TGp6HEngHd1aZV8NHIQOrPZ2VvmI3yzDd36I2cI22Yxm7ScQG7oAD4EjRrATh53vs1AiiXCDlxP4eWujgrjyjWsk2cotYvS/a19KW7Gl9XqRh9kTagXXe2QxGOMAHBlTnLebf8w/7fG7eInusCT86g9eIkCTnSQVxXWBADAKVR1WRcuj4YHDs9TS3d6GnLJ8b0kKOgI1msAe2/5tfRhkqBxeq1U/m4iHM6btMYLYO1hHHguuY0FOUCtqSdXBmwY0APKZvVJji4KjkbszjX+r1yaL8uPUhn0G5KLrZwO1bkUwsyB86SrWBf0CD9L7Pmv9Tzpf2/rCoVns4AqWStmAZrmw4oQE3blaZ3wcXbuLajn/BhGZoMfQ51QY6Ygw/+WCh+Ya8yJpwtHnIfpESKvk0hbV0jkccjDCYNqgVpBpOCLje7zWByqclx+G3wxpWy69cpxaW7uwEA9wwmtTfHMIJSuX56Jc53+yzaaTlh16IOC7ahEohbc/SXDHQoRxxxso6O4jDRBQ+vEowyQuk8oNTVRegrvmVIprOMnglCDg41K8z2oFC0/8Jc5F8VLq0/8todUS91FUCopdptr4RrYE74BchI7DvoyIvPWiZpmJSWLMgqg2U0kQmbvbBhwTEZGujTVzbEQiAHNIaE3gr/QxzhbzQutv3U70bURTahrHNBIAHyFb/JI5cEQFwiozFy6jQlZv3y3OlG/6Hw4eFM1BERZaxSQYBAR8jqhamBaD1OuEH4NerOQU5gIKAggS+Vdsvpa18wdohkB+qc8hrRLlCzUzY9ETUBq7xDXzXoHZCkixLFw2x0MAPv6dIBQMBkK4RUEFG+88Xj0nvn0E0IU+1WkaUG5SxzhtGogli0XTMctUGfuGn+f5HM4VOtj7W1nsu3TksNJWvS1eMKVVvED3DVLLGBj7nVm7xe+zvpP+c8bP2vf/JdZWBC5Qx8/plSIEL5gkzVRvI5+f5yiGPCt1sCdbeO3eF664U03TW2pOKADh0+hsR56lSvAk+tMcx3fNCM3mnJPjzieKnqazH+hMogR6lE9S/rNbwFWj56LtCU9sAac+uVyINu73ppLGX0RYsw7sVPmjAdVmqchP8wPPJ25q+GosGpdDBNWqPagMBaKAb2k2tgaCGqsoGzE3ka1KufhT80MHvtasi4XhQ0y3QM3DroV537wKKjDlzARDAxEIKuI8fR96wcnOZLU3y7WiiugChNFWNkN5eRluyDM9M+BAA14f+suIAjDznkSbCWNlqNRwor15YCbJNkmIyoIUGenft23I+v4KYEdn1bSBYoKqMXnMTOV/KNayAHxx+b611ELkfduj6f3fHQFhixU5bsDbuJfZYGmspHN67voWHw+0RMiiltAVr55ulHBZzLe5H/qPOxEqWuM2SHdNDuUqTWNI3e2ttUp6nSSxlw0dKX3ED0xm2Nrbxxoa9Ge3FlsavV/xUZJ32dr/r/RtljDsVq1jKWi3Pt38tGtjjulcj5Q05Qyly0YEsNmYRuYpfkLJuPpJhhH7k5YgVO8DRct1xbIAdy6b3FP4gO6VWnjqvGu4VFCudxwYmDEQLfIHA5g6oRAnkgf8MG8jBAdih5QVgy+JwCB3Jiae/EUbZzucW+SbU7F69OX2A7mErTJd5L8zF4nUmOFCGm6PSwiaMDAFcRTKwrgOZgz8iZvp483F5kvSLJ+rXeg0NZR59yzIufi1mYjfZu2UWNLgMYaCjzsRV70evIwAnYpaW4gG+ma+Y01nIs2Vau/i8RHHRrsy8djUcKIJ54uRG8svRBCa0WjeevM1nkwtT3zC/aXs51+br1kj5a0Fx089Yq9jRcOFN+Lbq4AMQM2hjoyQnKEM5NCj/sEv19KRYPMpaDfsRnIyA9utnwBELTUzEy8w6guMS9Ehccw2P8I04M+M5wWPrLnm9DVYQew79OEMb14vH4RPedcsVxOMmSgfdbCS/VV/Eeoqfwg3+C982bLbQ3ZZs7fJjn9CfoTShyZb8EWO4DIH0WT8NXjgQGzu+EaQSEHgQgzS0X92bvISH8NbMMvMieaHUzRP5M6wGlNz0zmxI3HtoyhOR9/UKEFxBYEi9v1sMCSMI4ounws838/dGXBUSbT2sQ44erm0+Qtg70ydY5xG7+CHshmPDFngBkJgPG8EKAYEbF3CTn1k5E1MwDG/N6irky1us73hDroCUt0UTK49ri6kkBVkbX0ACOK4Nnd0IequQAB90JSnkBbREnxHLzB/KP0rLfwi7/xD1rMeeQnuzzKyZ/CpsKNx4DU4AAeOOBjdaNWtx4iA0KF+5lN8ibnhn/otYeQ9+Td8V07GdtNv8M9IgQj/kQoPruQM/YuErPUpa4LfQDEs1++TnpctH26ilqbdpqFJITYxkWeFDIlpt2AAT9NCZXmq0gjQ2tDBAX/odLuBB/smIdUIfeaU188jyutI22LpA+VosYv1GX0Rv0ha2tYNgQiy0poK6M98jGEDAS0rhB/ipUR2EJLnAmnBI/VdfYdBoCzXlNBUtzux3kAo9saypgB4+xJr+0lj5VYPDiECpFev5OXQceVX4jc0kbTs0qKHT3rOVs3KFTrV4sx9BDI6R7uuSoIcLTsPme6UHOmjgLH+eNMdD/HTWEbNTXm1NPni8sWVEvW9YV5Cdgfn85PZxiIcV5p2NN/sJBRuKkbJxBucYzHceabz1SM26NFYi+0DxRcsrpoP8W/IBWbw2Bw6kImX00/fKeBjcwAU0hWbpFvIGfIHtc54z75bPX27jc9ed+n9Hwz3UC2gM6206BAMEONachA6AK3tuQxuqd1RtlJ+GCW1Q+tkm8lfM40t+87n5HbmXdZxPru909Tft9dBVLMY4Gm78DYlrUuFBCeLHRP6b1/rDndtNswZhJ+AAzpEWcCD1s0Vwk3gMfuaAmRfI0lv+nLrTRwllmbiJ7TMMxxAyBS+sc8OEZJRk746WTzXccMHjeB05PAf2UT+RoaQb7hd685sAilcxAAREr/qroihRiTIkwPvpV9oZOI7Jz7yUdFCOl94NlKolivzTkzzahWUas6HHTUirJsAELeLGTWskw4AfZSivmA4X/4pvGLNWaGkbbc3c7Q3V3W4Uyy0lE228kGSQ7isWwA8dNIb3G0ntJSShIyxL3OQK6U6Sf/eqmRX8PXelf1u4wNDflL5H/826GOdhIl5F4leDkYAiXJvQtZEMAQEE4K44jjOo4CfHPS0MksusyTtPRUtnN9OHWedJhTwHeXB8+Tr0CIAYlkTLpwIEBLuQgPvAPj5GWuEosuaeM1+XPdJc/+rane8IXiXmsIcMa3gv0gu2lQKaIgm6CYMbQXAVNHDB6yhGCT+M1mPThfts7aT9O+u+IVQDd74TKU6lTZlhSn9+CXFo88Vr8APw6Qc0uM+qin+LJkhB18Wz8Hd8QqbMfV94Xe6ZOz4wgyiXaDv2q5VzIMAB1+OL/1tYQ8IFDfzOM0jhhxGbPVAw2NKlczuVuhOrw+0BIvYfRCvTTy5DRzIArb/qX/W5iPZEI8mwIYAHoFswuHqDKoca2JgxfdEMAnLWcBBoETAeqbeUfnD4KkXSjBeAjGtnhk0jXdmh/od0DYzgFURodxY/tTkvgR3isoXwwwe/vv5+RuZBJVA2DN/wlfCNrBRm24ZLeQcPhn6GVNLxzDx2KVz4CUmrOoDDB40p8s9onAhA63BgNd/OD0yYLbxo62xN3b464vj/I7g9QCa7m2otFdNdKEUa6fL5M9ABIPrFkRPBDWepA6eQyn8YPV8YLJ+1tjzw55rdIt+gEmhbNmHsJZ4LJ06vvlL1gxDjkGAHLfTwOkcilm/FzfHjBYOtk+T87sl7XdD6xu0BMtpt4hXLkWlOGElfMmXZYGighV5XPe2vhBeB8q44z3NgH7VBGGITpJL9GQ0mTLlFm7DYcX+yC/QPlpzhYf8LhP+v4IEe3Xt0h95uoZls2rRnlSPiQcupR6Iu/H8B7AjpZA9bJIMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTQtMTItMzFUMTI6NDQ6NTYtMDU6MDBEL5TZAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTEyLTMxVDEyOjQ0OjU2LTA1OjAwNXIsZQAAADh0RVh0c3ZnOmJhc2UtdXJpAGZpbGU6Ly8vc3JjL2dyYXBoaWNzL3RhcmdldHMvZmRqdC9yZWR4LnN2Z3qXB16JAAAAAElFTkSuQmCC",
"closebutton","Close"),D(d,"click",k),D(d,"touchend",k),D(d,"touchstart",h.cancel),d.title="click to close",b.appendChild(d));a.title&&(a.title.nodeType?e.push(a.title):(e=H(a.title,a,a.data),b.title=e,b.appendChild(c("div.title",e))));for(var e=[],e=1,d=arguments.length;e<d;){var f=arguments[e++];if(f)if(f.nodeType)b.appendChild(f);else if("string"===typeof f){var f=G[f]||f,g=0<=f.indexOf("<"),l=0<=f.search("{{");g&&l?b.appendChild(v.toDOM(f,a)):g?c.append(b,f):l?b.appendChild(document.createTextNode(H(f,
a))):b.appendChild(document.createTextNode(f))}else b.appendChild(document.createTextNode(f.toString))}a.id&&!b.id&&(b.id=a.id);c.addListeners(b,a);return b}function r(a){a=(a=a||window.event)?a.nodeType?a:h.T(a):B("FDJTALERT")||B("FDJTDIALOG");if(a=c.getParent(a,".fdjtdialog")){var b=c.getChild(a,".countdown");if(b&&b.id){var d=F[b.id];d&&clearInterval(d);delete F[b.id]}m(a);c.remove(a)}}function g(a,b){var d=(a=a||window.event)?a.nodeType?a:h.T(a):B("FDJTALERT")||B("FDJTDIALOG");a&&!a.nodeType&&
h.cancel(a);var e=c.getParent(d,".fdjtdialog");e&&(m(e),b?c.remove(e):c.transitionEnd&&!c.hasClass(e,"closing")?(c.addListener(e,c.transitionEnd,function(){c.remove(e)}),c.addClass(e,"closing")):c.remove(e))}function m(a){if(a=c.getChild(a,".countdown")){var b=F[a.id];delete F[a.id];b&&clearInterval(b);c.remove(a)}}function k(a){a=a||window.event;h.cancel(a);g(a)}function q(a){a=a||window.event;var b=h.T(a),b=c.getParent(b,".fdjtdialog");m(b);b.style[c.transitionDelay]="";b.style[c.transitionDuration]=
"";c.dropClass(b,"countdown");c.dropClass(b,"closing");h.cancel(a)}function u(){var b=c.toArray(arguments),b=a.apply(null,[{}].concat(b));y(b,"fdjtalert")}function p(){var b=B("FDJTALERT");b&&(b.id="",c.dropClass(b,"closing"),r(b));b=c.toArray(arguments);b=a.apply(null,[{}].concat(b));b.id="FDJTALERT";c.prepend(document.body,b);return b}function f(a,b,d){var e=c.getChild(a,".countdown");e.innerHTML="\u2026"+b+"\u2026";var f=b;a.style[c.transitionDelay]=f/2+"s";a.style[c.transitionDuration]=f/2+"s";
var g=setInterval(function(){0>=f?(clearInterval(g),g=!1,delete F[e.id],d&&d(),c.remove(a)):e.innerHTML="\u2026"+f--+"\u2026"},1E3);F[e.id]=g;e.onclick=q;D(e,"touchend",q);D(e,"touchstart",h.cancel);setTimeout(function(){c.addClass(a,"closing")},10);return a}function b(b){var d=B("FDJTALERT");d&&(d.id="",c.dropClass(d,"closing"),r(d));d=[{timeout:b}].concat(c.slice(arguments,1));d=a.apply(null,d);d.id="FDJTALERT";c.prepend(document.body,d);f(d,b);return d}function e(b){var d=B("FDJTMESSAGE");d&&(d.id=
"",c.dropClass(d,"closing"),r(d));d=c.toArray(arguments);d=a.apply(null,d);b.timeout&&f(d,b.timeout);d.id="FDJTMESSAGE";c.prepend(document.body,d);return d}function l(a,b,d){var e=a.dom||a.label&&c("button",a.label)||c("button","Choice "+d);e.onmousedown=h.cancel;e.onmouseup=h.cancel;e.tabIndex=d;a.title&&(e.title=a.title);e.onclick=function(d){d=d||window.event;var f=h.T(d),f=c.getParent(f,".choices"),f=c.getChild(f,".selected");f!==e&&(f&&(c.dropClass(f,"selected"),f.blur()),c.addClass(e,"selected"),
e.focus());a.handler&&a.handler();h.cancel(d);b()};D(e,"touchstart",h.cancel);D(e,"touchend",e.onclick);return e}function d(a){function b(){for(var c=0,e=t.length;c<e;){var f=t[c++];f.onclick&&N(f,"touchend",f.onclick);N(f,"touchstart",h.cancel);f.onclick=null;f.onmousedown=null;f.onmouseup=null}k&&(N(k,"touchend",k.onclick),N(k,"touchstart",h.cancel),k.onclick=null);d&&(d.onclick=null);d&&(d.onkeydown=null);if(d)var g=setTimeout(function(){if(a.onclose)a.onclose(d);r(d);clearTimeout(g);g=!1},500)}
var d=!1,e=-1,t=[],g,k=!1,m=!1;if("function"===typeof a)g=[{label:"Cancel"},{label:"OK",handler:a,isdefault:!0}];else if(a.constructor===Array)g=a;else if(a.choices)g=a.choices;else if(a.label&&a.handler)g=[{label:"Cancel"},a];else if(a.handler)g=[{label:"Cancel"},{label:"OK",handler:a.handler,isdefault:a.isdefault}];else if(g.length)g=a;else{z.warn("Bad spec %o to fdjtUI.choose");return}a.onchoose&&(m=a.onchoose);for(var q=0,p=g.length;q<p;){var v=g[q],U=l(v,b,q);t.push(U);0>e&&v.isdefault&&(U.setAttribute("autofocus",
"autofocus"),c.addClass(U,"selected"),e=q);q++}0>e&&!a.nodefault&&(c.addClass(t[q],"selected"),e=0);d=A(a,c("div.message",c.slice(arguments,1)),c("div.choices",t));k=c.getChild(d,".closebutton");a.cancel?(N(k,"touchend",k.onclick),k.onclick=b,D(k,"touchend",k.onclick)):c.remove(k);var x=a.cancel||!1;d.onkeydown=function(a){a=a||window.event;var c=a.keyCode;9===c?(a.shiftKey?e--:e++,0>e?e=t.length-1:e>=t.length&&(e=0),0<=e&&t[e].focus(),h.cancel(a)):13===c?(0<=e&&g[e]&&g[e].handler&&g[e].handler(),
m&&0<=e&&g[e]&&m(g[e],d),b(),h.cancel(a)):x&&27===c&&(b(),h.cancel(a))};c.addClass(d,"fdjtconfirm");d.id="FDJTDIALOG";c.prepend(document.body,d);a.timeout&&f(d,a.timeout,function(){a.noauto?b():(0<=e&&g[e]&&g[e].handler&&g[e].handler(),m&&0<=e&&g[e]&&m(g[e],d))});0<=e&&t[e].focus();return d}var c=fdjt.DOM,z=fdjt.Log,h=fdjt.UI,B=fdjt.ID,v=fdjt.Template,H=fdjt.Template,G=fdjt.Templates,x=c.hasClass,y=c.addToClass,D=c.addListener,N=c.removeListener,E=1,F={},A=a;a.close=g;a.alertBox=u;h.alertBox=u;a.alert=
p;h.alert=p;fdjt.alert=p;a.setCountdown=f;h.setCountdown=f;a.alertFor=b;h.alertFor=b;a.message=e;fdjt.message=e;a.Choice=d;a.choose=d;h.choose=d;fdjt.Choice=d;return fdjt.UI.Dialog=a}();fdjt.UI||(fdjt.UI={});
(function(){function a(a,b,c){this.dom=a||!1;this.input=b||!1;this.options=c||7;this.nodes=[];this.values=[];this.serial=++z;this.cues=[];this.displayed=[];this.known={};this.prefixtree={strings:[]};this.bykey={};this.byvalue=new L;this.selclass=this.selected=!1;c&8||(this.stringmap={});this.initialized=!1;return this}function r(a){return a.key||a.getAttribute("data-key")||a.getAttribute("key")||h(a,"variation")&&e.textify(a)||h(a,"completion")&&g(a,"")}function g(a,b){if(3===a.nodeType)return b+
a.nodeValue;if(!h(a,"variation")&&!h(a,"fdjtskiptext")&&1===a.nodeType&&a.childNodes)for(var c=a.childNodes,d=0,e=c.length;d<e;){var f=c[d++];3===f.nodeType?b+=f.nodeValue:1===f.nodeType&&(b=g(f,b))}return b}function m(a,b,c,d,e){b=(e?b.split(/\W/g):[]).concat(b);e=0;for(var f=b.length;e<f;){var h=b[e++];E(c,h,0);d[h]&&d.hasOwnProperty(h)?d[h].push(a):d[h]=Array(a);d._count++}}function k(a,b,c,d){"undefined"===typeof c&&(c=b.key||r(b));d||(d=b.value||b.getAttribute("value")||c);b._seen||(a.nodes.push(b),
b._seen=!0,d&&(a.values.push(d),a.byvalue.add(d,b)),a.curstring=a.maxstring=!1,c&&q(a,b,c))}function q(a,b,c){c||(c=b.key||r(b));var d=a.options,g=a.dom,k=a.prefixtree,l=a.bykey,A=a.stringmap,q=f(c);c=d&8;var p=d&4;c||(d=q.toLowerCase(),A[d]=q,q=d);G(b,g)||e.append(g,b," ");m(b,q,k,l,p);h(b,"cue")&&a.cues.push(b);a=H(b,".variation");b=0;for(g=a.length;b<g;){var q=a[b++],T=f(q.key||r(q));c||(d=T.toLowerCase(),A[d]=T,T=d);m(q,T,k,l,p)}}function u(a){for(var b=H(a.dom,".completion"),c=0,d=b.length;c<
d;)k(a,b[c++]);a.initialized=!0}function p(a,b){var c=a.displayed,d,e;if(c)for(d=0,e=c.length;d<e;)v(c[d++],"displayed");a.displayed=c=[];if(b)for(d=0,e=b.length;d<e;){var f=b[d++];if(h(f,"completion"))B(f,"displayed"),c.push(f);else{var g=G(f,".completion");g&&!h(g,"displayed")&&(c.push(f),c.push(g),B(g,"displayed"),B(f,"displayed"))}}a.visible=!1;a.selection&&!h(a.selection,"displayed")&&(a.selectNext()||a.selectPrevious()||a.clearSelection());a.updated&&a.updated.call(a)}function f(a){return a.replace(/\s+/,
" ").replace(/(^\s)|(\s$)/,"")}var b=fdjt.String,e=fdjt.DOM,l=fdjt.UI,d=fdjt.RefDB,c=fdjt.ID,z=0,h=e.hasClass,B=e.addClass,v=e.dropClass,H=e.getChildren,G=e.getParent,x=e.getStyle,y=d.position,D=b.isEmpty,N=b.hasPrefix,E=b.prefixAdd,F=b.prefixFind,A=b.commonPrefix;l.FDJT_COMPLETE_OPTIONS=1;l.FDJT_COMPLETE_CLOUD=2;l.FDJT_COMPLETE_ANYWORD=4;l.FDJT_COMPLETE_MATCHCASE=8;l.FDJT_COMPLETE_EAGER=16;var L=fdjt.Map||d.Map;a.getKey=r;a.prototype.addCompletion=function(a,b,c){this.initialized||u(this);k(this,
a,b,c);this.visible&&(this.visible=!1)};a.prototype.addKeys=function(a,b){this.initialized?q(this,a,b):(u(this),k(this,a,b));this.visible&&(this.visible=!1)};a.prototype.getCompletions=function(a){if(a===this.curstring||a===this.maxstring||this.curstring&&this.maxstring&&N(a,this.curstring)&&N(this.maxstring,a))return this.result;var b;this.initialized||u(this);if(D(a))b=[],b.prefix="",b.matches=[],this.dom&&B(this.dom,"noinput");else{var c=this.prefixtree;b=this.bykey;var d=this.options&8,e=[],g=
[],k=[],l=f(a);if(D(l))b=[];else{d||(l=a.toLowerCase());for(var c=F(c,l,0),m=!1,q=[],T=[],J=[],n=0,w=c.length;n<w;){var r=c[n++],R=r===l,m=m?A(m,r,!1,!d):r,O=b[r];if(O)for(var L=0,z=O.length;L<z;){var x=O[L++];if(!(h(x,"hidden")||0<=e.indexOf(x)))if(h(x,"completion"))R&&(T.push(x),q.push(x)),e.push(x),J.push(r),g.push(x);else{var y=G(x,".completion");y&&h(y,"hidden")||!y||(R&&q.push(y),e.push(y),J.push(r),k.push(x))}}}q.length&&(e.exact=q);T.length&&(e.exactheads=T);e.prefix=m;e.strings=c;e.matches=
g.concat(k);b=e}this.dom&&v(this.dom,"noinput");p(this,b.matches)}if(this.stringmap&&this.strings)for(d=this.stringmap,e=this.strings,g=0,k=e.length;g<k;)(l=d[e[g]])?e[g++]=l:g++;this.curstring=a;this.maxstring=b.prefix||a;return this.result=b};a.prototype.getValue=function(a){if(a.value)return a.value;if(a.getAttribute("data-value"))return a.getAttribute("data-value");if(a.getAttribute("value"))return a.getAttribute("value");a=y(this.nodes,a);return 0>a?!1:this.values[a]};a.prototype.getKey=function(a){return a.key?
a.key:a.getAttribute("data-key")?a.getAttribute("data-key"):a.getAttribute("key")?a.getAttribute("key"):r(a)};a.prototype.complete=function(a,b){this.initialized||u(this);a||""===a||(a=this.getText?this.getText(this.input):h(this.input,"isempty")?"":this.input.value);if(D(a))return this.displayed&&p(this,!1),B(this.dom,"noinput"),v(this.dom,"nomatches"),b&&b([]),[];var c=this.getCompletions(a);if(c&&0!==c.length)p(this,c.matches),v(this.dom,"noinput"),v(this.dom,"nomatches");else return p(this,!1),
v(this.dom,"noinput"),B(this.dom,"nomatches"),b&&b(c),[];b&&b(c);return c};a.prototype.getByValue=function(a,b){this.initialized||u(this);var c=[],d=this.byvalue;b&&(b=new e.Selector(b));a instanceof Array||(a=[a]);for(var f=0,h=a.length;f<h;){var g=a[f++];if(g=d.get(g))if(g instanceof Array||(g=[g]),b)for(var k=0,l=g.length;k<l;)b.match(g[k])?c.push(g[k++]):k++;else c=c.concat(g)}return c};a.prototype.getByKey=function(a,b){this.initialized||u(this);var c=[],d=this.bykey;b&&(b=new e.Selector(b));
a instanceof Array||(a=[a]);for(var f=0,h=a.length;f<h;){var g=a[f++];if(g=d.get(g))if(g instanceof Array||(g=[g]),b)for(var k=0,l=g.length;k<l;)b.match(g[k])?c.push(g[k++]):k++;else c=c.concat(g)}return c};a.prototype.setCues=function(a,b){this.initialized||u(this);b||(b="cue");for(var c=[],d=this.byvalue,e=0,f=a.length;e<f;){var g=a[e++];if(g=d.get(g)){g instanceof Array||(g=[g]);for(var k=0,l=g.length;k<l;){var m=g[k++];h(m,b)||(B(m,b),c.push(m))}}}return c};a.prototype.setClass=function(a,b){this.initialized||
u(this);var c=e.getChildren(this.dom,".completion."+b);c&&c.length&&v(e.Array(c),"hidden");for(var c=[],d=this.byvalue,f=0,g=a.length;f<g;){var k=a[f++];if(k=d.get(k)){k instanceof Array||(k=[k]);for(var l=0,m=k.length;l<m;){var q=k[l++];h(q,b)||(B(q,b),c.push(q))}}}return c};a.prototype.extendClass=function(a,b){this.initialized||u(this);for(var c=[],d=this.byvalue,e=0,f=a.length;e<f;){var g=a[e++];if(g=d.get(g)){g instanceof Array||(g=[g]);for(var k=0,l=g.length;k<l;){var m=g[k++];h(m,b)||(B(m,
b),c.push(m))}}}return c};a.prototype.dropClass=function(a){var b=e.getChildren(this.dom,".completion."+a);b&&b.length&&v(e.Array(b),a)};a.prototype.docomplete=function(a,b){this.initialized||u(this);a||(a=this.input);var c=this.complete_delay||100,d=this;this.timer&&(clearTimeout(d.timer),d.timer=!1);this.timer=setTimeout(function(){a||(a=d.input);var c=d.complete(a.value);b&&b(c)},c)};l.Completions=a;var O=e.Selector;a.prototype.getVisible=function(){if(this.visible)return this.visible;for(var a=
this.dom,b=a.firstChild,c=[];b!==a;){if(1===b.nodeType){var d=h(b,"completion");d&&"none"!==x(b).display&&c.push(b);if(b.firstChild&&!d){b=b.firstChild;continue}}for(;b!==a&&!b.nextSibling;)b=b.parentNode;b!==a&&(b=b.nextSibling)}return this.visible=c};a.prototype.select=function(a){var b=!1,c=this.getVisible();a instanceof O&&(b=a,a=!1);if(!a&&b)for(var d=0,e=c.length;d<e;){var f=c[d++];if(h(f,b)){a=f;break}}!a&&c.length&&(a=c[0]);this.selection&&v(this.selection,"selected");B(a,"selected");return this.selection=
a};a.prototype.selectNext=function(a){a||(a=this.selection?this.selection:!1);for(var b=this.getVisible(),c=!1,d=!1,e=0,f=b.length;e<f;){var h=b[e++];c||(c=h);if(a)h===a&&(a=!1,d=!0);else{a=h;break}}this.selection&&v(this.selection,"selected");d||(a=c);B(a,"selected");return this.selection=a};a.prototype.selectPrevious=function(a){a||(a=this.selection?this.selection:!1);for(var b=this.getVisible(),c=!1,d=!1,e=b.length-1;0<=e;){var f=b[e--];c||(c=f);if(a)f===a&&(a=!1,d=!0);else{a=f;break}}this.selection&&
v(this.selection,"selected");d||(a=c);a&&B(a,"selected");return this.selection=a};a.prototype.clearSelection=function(a){if(a&&this.selection&&a!==this.selection)return!1;if(this.selection)return v(this.selection,"selected"),this.selection=!1,!0};var P={};l.Completions.onkey=function(b){b=b||window.event;b=l.T(b);var d=b.name,f=P[d],h=e.getAttrib(b,"completions");if(h=h&&c(h))f&&f.dom===h||(f=new a(h,b,7),P[d]=f),f&&f.docomplete(b)};l.Completions.update=function(b){b=b||window.event;"string"===typeof b&&
(b=c(b));if(b){b=b.nodeType?b:l.T(b);var d=b.name,f=P[d],h=e.getAttrib(b,"completions");if(h=h&&c(h))f&&f.dom===h||(f=new a(h,b,7),P[d]=f),f&&f.docomplete(b)}}})();fdjt.UI||(fdjt.UI={});
fdjt.TapHold=fdjt.UI.TapHold=function(){function a(a,b,c,d){return"number"===typeof a&&"number"===typeof b&&"number"===typeof c&&"number"===typeof d?t((a-c)*(a-c)+(b-d)*(b-d)):!1}function r(b,c,d){if("number"===typeof b.clientX)return b.clientX;b=b.changedTouches&&b.changedTouches.length&&b.changedTouches||b.touches&&b.touches.length&&b.touches;var e=window.pageXOffset,f=window.pageYOffset;if(b&&b.length){if(1===b.length||"number"!==typeof c||"number"!==typeof d)return b[0].pageX-e;for(var h=1,g=
b.length,k=b[0],l=a(Math.abs(k.pageX-e),Math.abs(k.pageY-f),c,d),n=l,t=k;h<g;)k=b[h++],l=a(Math.abs(k.pageX-e),Math.abs(k.pageY-f),c,d),l<n&&(t=k,n=l);return t.pageX-e}return!1}function g(a,b,c){if("number"===typeof a.clientY)return a.clientY;a=a.changedTouches&&a.changedTouches.length&&a.changedTouches||a.touches&&a.touches.length&&a.touches;var d=window.pageXOffset,e=window.pageYOffset;if(a&&a.length){if(1===a.length||"number"!==typeof b||"number"!==typeof c)return a[0].pageY-e;for(var f=1,h=a.length,
g=a[0],k=Math.abs(Math.abs(g.pageX-d)-b)+Math.abs(Math.abs(g.pageY-e)-c),n=k,l=g;f<h;)g=a[f++],k=Math.abs(Math.abs(g.pageX-d)-b)+Math.abs(Math.abs(g.pageY-e)-c),k<n&&(l=g,n=k);return l.pageY-e}return!1}function m(a,b,c,d){a=v(a,b);b=0;for(var e=a.length;b<e;){var f=a[b++],h=f.offsetLeft,g=f.offsetTop,k=f.offsetRight,n=f.offsetBottom;if("number"===typeof h&&(1>=k-h?c>=h&&d<=k:c>=h&&d<k)&&(1>=n-g?d>=g&&d<=n:c>=g&&d<n))return f}return!1}function k(a){a=a||window.event;z&&b("TapHold/global/mouseup %o",
a);1===a.button&&(Q=!1)}function q(a){a=a||window.event;z&&b("TapHold/global/mousedown %o",a);1===a.button&&(Q=!0)}function u(a){a=a||window.event;var c=A(a),d=a.relatedTarget||a.toElement;z&&b("TapHold/global/mouseout %o %o==>%o",a,c,d);c===document.documentElement&&(Q=!1)}function p(a){return(a=/\bfdjtlog(\d*)/.exec(a))&&a.length?(a="string"===typeof a[1]&&parseInt(a[1],10))&&!isNaN(a)?a:1:0}function f(t,v){function C(){na=ha=cb=qa=pa=W=Fa=M=Y=ma=Ba=Ta=Ya=!1}function Z(a,c,d,e,f,h,n){var g=Ba,k=
d.id||typeof d,l=d.traced;d=d.handlers;var t=e&&A(e);a||(a=t);var m=document.createEvent("UIEvent");m.initUIEvent(c,!0,!0,window,e&&e.touches&&e.touches.length||e&&e.button||0);m.clientX=f;m.clientY=h;m.ntouches=g||1;if(n)for(var J in n)n.hasOwnProperty(J)&&(m[J]=n[J]);if(l||z)n&&"number"===typeof n.startX?b("TapHold/%s(%s) on %o @%d,%d/%d,%d from %o given %j",c,k,a,f,h,n.startX,n.startY,e||"scratch",n):n?b("TapHold/%s(%s) on %o @%d,%d from %o given %j",c,k,a,f,h,e||"scratch",n):b("TapHold/%s(%s) on %o @%d,%d from %j",
c,k,a,f,h,e||"scratch");a&&D(a,document.body)||(a=document.elementFromPoint(f,h));t!==a&&(m.relatedTarget=t);d&&d.hasOwnProperty(c)?(m.target=a,d[c](m,a)):a.dispatchEvent(m)}function P(a){(2<wa||2<z||a!==oa&&(wa||z))&&b("TapHold/setTarget(%s) %o cur=%o",ia,a,oa);oa&&oa!==a&&Ra&&G(oa,"tapholdtarget");a&&Ra&&H(a,"tapholdtarget");a&&oa&&a!==oa&&(Ta=M,Ya=Y);Xa=oa;oa=a;da=l()}function U(a,b,c,d){"undefined"===typeof c&&(c=M);"undefined"===typeof d&&(d=Y);return Z(a,"tap",Wa,b,c,d,!1)}function S(a,b,c,
d){"undefined"===typeof c&&(c=M);"undefined"===typeof d&&(d=Y);xa&&setTimeout(function(){H(t,xa)},20);return Z(a,"hold",Wa,b,c,d,!1)}function T(a,c,d,e){var f=da&&Xa&&l()-da;"undefined"===typeof d&&(d=M);"undefined"===typeof e&&(e=Y);xa&&setTimeout(function(){oa||G(t,xa)},50);f&&200>f&&(wa&&b("TapHold(%s) %d=i<200ms, target=%o not %o",ia,f,Xa,a),a=Xa);return Z(a,"release",Wa,c,d,e,{startX:pa,startY:W})}function J(a,b,c){c?(c.startX=pa,c.startY=W):c={startX:pa,startY:W};if(b){var d=b.relatedTarget||
A(b);d!==a&&(c.relatedTarget=d)}xa&&setTimeout(function(){oa||G(t,xa)},50);return Z(a,"slip",Wa,b,M,Y,c)}function n(a,b,c,d,e,f){var h=e-c,n=f-d;qa=l();return Z(a,"swipe",Wa,b,e,f,{startX:c,startY:d,endX:e,endY:f,deltaX:h,deltaY:n})}function w(a,c){c||(c=ga||f.interval||100);a=a||window.event;(1<wa||1<z)&&b("TapHold/startpress(%s) %o tht=%o timer=%o tt=%o touched=%o pressed=%o@%o timeout=%oms",ia,a,oa,za,Qa,na,ha,cb,c);Qa&&za&&(clearTimeout(za),za=!1);na||ha||za||(oa?(na=oa,qa=ha=!1,N.live&&N.highlight(!0),
cb=l(),za&&clearTimeout(za),za=setTimeout(function(){(1<wa||1<z)&&b("TapHold/startpress/timeout(%s) (%dms) %o",ia,c,a);if(0<Va.length)for(var d=Va,e=0,f=d.length;e<f;){var h=d[e++];if(e===f&&h===oa)break;S(h);V||(e<f?J(h,a,{relatedTarget:d[e]}):J(h,a))}ha=oa;Va=[];cb=oa?l():!1;Qa?(Z(oa,"taphold",Wa,a,M,Y,!1),Qa=!1):S(oa,a);za&&clearTimeout(za);na=za=!1},c)):qa=!1)}function sa(a){(1<wa||1<z)&&b("TapHold/endpress(%s) %o t=%o p=%o tch=%o tm=%o ttt=%o/%o, start=%d,%d,%d/%d",ia,a,oa,ha,na,za,Qa,Ga,pa,
W,Fa,c());if(ha||na||za){var d=M,f=Y;if(za)clearTimeout(za),za=!1,N.live&&setTimeout(function(){N.highlight(!1)},1500),oa===na||.4>c()-Fa?Qa&&Qa===oa?(Qa=!1,Z(oa,"taptap",Wa,a,M,Y,!1,wa)):Ga?(Qa=oa,(1<wa||1<z)&&b("TapHold/taptap(%s) waiting %d on %o",ia,Ga,Qa),za&&clearTimeout(za),za=setTimeout(function(){var c=Qa;za=Qa=!1;(wa||z)&&b("TapHold/singletap(%s) on %o",ia,c);U(c,a,d,f)},Ga)):U(oa,a,d,f):V||J(oa,a);else if(ha){var h=e.getGeometry(t);d>=h.left&&d<=h.right&&f>=h.top&&f<=h.bottom?T(ha,a,d,
f):V?T(ha,a,d,f):J(oa,a,{touch_x:d,touch_y:f})}N.live&&N.highlight(!1);C();cb=ha=na=!1;P(!1);xa&&setTimeout(function(){G(t,xa)},20);Va=[]}else C()}function R(a,c){(wa||z)&&b("TapHold/abort%s(%s) %o: th=%o t=%o p=%o",c?"("+c+")":"",ia,a,oa,na,ha);za?(clearTimeout(za),za=!1):V||ha&&J(ha,a);N.live&&N.highlight(!1);cb=na=ha=Qa=!1;xa&&setTimeout(function(){G(t,xa)},20);Va=[];P(!1)}function ua(a){a=a||window.event;var b=a.toElement||a.relatedTarget;Da||oa&&ha&&!D(b,t)&&(Da=setTimeout(function(){V||J(ha,
a,{relatedTarget:b});R(a,"taphold_mouseout")},fa))}function ab(a){Da&&(clearTimeout(Da),Da=!1)}function Pa(c){c=c||window.event;var d,e=c.touches&&c.touches.length||1;K||E(c);I&&F(c);Aa&&c.touches&&c.touches.length<=Ua&&(0<=ra&&(Aa.scrollLeft=ra-(c.touches[0].pageX-window.pageXOffset)),0<=ya&&(Aa.scrollTop=ya-(c.touches[0].pageY-window.pageYOffset)));if(ha&&L>Fa)R(c,"move/cleared");else if(Q){var f=c.clientX||r(c,M,Y),h=c.clientY||g(c,M,Y),k=ha?a(f,h,Ta,Ya):a(f,h,pa,W);c.touches||La||Ma?(f+=La,h+=
Ma,d=document.elementFromPoint(f,h)):d=A(c);var la=Math.abs(f-M)+Math.abs(h-Y),w=(l()-ma)/1E3;(1<wa||1<z)&&b("TapHold/move(%s) s=%d,%d tt=%d,%d t=%d,%d c=%d,%d d=%d thresh=%o, dt=%o md=%o, pressed=%o, touched=%o, event=%o target=%o",ia,pa,W,Ta,Ya,M,Y,f,h,k,ea,w,Q,ha,na,c,d);if(d){var q=y(d,".tapholder");if(q!==t)(2<wa||2<z)&&Na(c,ia,t,q,oa,d,pa,W,Ta,Ya,M,Y),oa&&((wa||z)&&b("setWanderTimeout(%s): h=%o!=elt=%o",ia,q,t),Da=setTimeout(function(){R(c,"taphold_wander_timeout")},fa),ha&&(V||J(ha,c,{relatedTarget:d}),
P(!1)));else if(Da&&(clearTimeout(Da),Da=!1,(1<wa||1<z)&&b("Wander return(%s) %o pressed=%o, target=%o",ia,c,ha,oa),ha&&!oa&&(P(ha),S(ha,c))),na||ha)if(ea&&za&&k>ea)(1<wa||1<z)&&b("TapHold/move/cancel(%s) s=%d,%d tt=%d,%d t=%d,%d c=%d,%d d=%d thresh=%o, dt=%o md=%o, event=%o",ia,pa,W,Ta,Ya,M,Y,f,h,k,ea,w,Q,c),R(c,"movefar"),za&&clearTimeout(za),cb=na=za=ha=!1,Va=[],!qa&&30<a(pa,W,f,h)&&n(d,c,pa,W,f,h),P(!1),M=f,Y=h,ma=l(),Ba?e>Ba&&(Ba=e):Ba=e;else if(la<10*Ja&&0<w&&la/w<Ja)(2<wa||2<z)&&b("TapHold/move/ignore(%s) s=%d,%d t=%d,%d c=%d,%d dt=%o total=%d/%o, local=%d/%o/%o, thresh=%o md=%o",
ia,pa,W,M,Y,f,h,w,k,ea,la,la/w,Ja,Q),M=f,Y=h,ma=l(),Ba?e>Ba&&(Ba=e):Ba=e;else{if((2<wa||2<z)&&b("TapHold/move(%s) s=%d,%d t=%d,%d c=%d,%d dt=%o total=%d/%o, local=%d/%o/%o, md=%o",ia,pa,W,M,Y,f,h,w,k,ea,la,Ja,la/w,Q),M=f,Y=h,ma=l(),Ba?e>Ba&&(Ba=e):Ba=e,d=y(d,Za),!(c.touches&&c.touches.length&&c.touches.length>Ua)){if(N.live)N.onmousemove(c,M,Y);d||(d=m(t,Za,M,Y));d&&((D(d,".tapholder")&&!V&&P(d),c.touches&&na&&!ha&&Va[Va.length-1]!==oa&&Va.push(oa),Q)?ha&&oa!==ha&&V?sa(c):ha&&oa!==ha&&(V||J(ha,c,
{relatedTarget:d}),cb=(ha=oa)?l():!1,cb=l(),S(ha)):(V||J(ha,c,{relatedTarget:d}),cb=ha=!1))}}else!qa&&30<a(pa,W,f,h)&&n(d,c,pa,W,f,h),M=f,Y=h,ma=l(),Ba?e>Ba&&(Ba=e):Ba=e}else M=f,Y=h,ma=l(),Ba?e>Ba&&(Ba=e):Ba=e}else R(c,"mousemove/up")}function Na(a,c,d,e,f,h,n,g,k,t,l,m){b("TapHold/move%s/farout(%s) %o %o -> %o s=%d,%d tt=%d,%d t=%d,%d",Q?"/md":"",c,a,f,h,n,g,k,t,l,m);b("TapHold/move/farout(%s) target in %o, elt is %o",c,e,d)}function bb(a,d){a=a||window.event;if(!(a.ctrlKey||a.altKey||a.metaKey||
a.button||a.which&&1<a.which)){var e=a.touches&&a.touches.length||1;Q=!0;L=0;M=(a.clientX||r(a)||M)+La;Y=(a.clientY||g(a)||Y)+Ma;pa=Ta=M;W=Ya=Y;ma=l();Ba?e>Ba&&(Ba=e):Ba=e;K||E(a);I&&F(a);var e=!1,f=La||Ma?document.elementFromPoint(M,Y):A(a),h=y(f,".tapholder");(1<wa||1<z)&&b("TapHold/down(%s) %o tht=%o target=%o holder=%o elt=%o",ia,a,oa,f,h,t);if(h!==t)(1<wa||1<z)&&b("TapHold/ignore(%s) %o tht=%o t=%o h=%o elt=%o",ia,a,oa,f,h,t);else{f&&(f=y(f,Za));Aa&&a.touches&&a.touches.length<=Ua&&(0<=ra&&(ra=
Aa.scrollLeft+(a.touches[0].pageX-window.pageXOffset)),0<=ya&&(ya=Aa.scrollLeft+(a.touches[0].pageY-window.pageYOffset)));a.touches&&(f=document.elementFromPoint(M,Y));(1<wa||1<z)&&b("TapHold/down(%s) %o tht=%o trg=%o s=%o,%o,%o t=%o,%o m=%o tch=%o prs=%o ttt=%o",ia,a,oa,f,pa,W,Fa,M,Y,Q,na,ha,Ga||!1);if(a.touches&&oa){var n=y(t,".tapholder"),k=a.changedTouches[0];(1<wa||1<z)&&b("TapHold(%s) second touch on %o (in %o) after %o (in %o)",ia,f,h,oa,n,n===h);if(Ka&&n===h){(1<wa||1<z)&&b("TapHold(%s) touchtoo with touchtoo on %o after %o: %o",
ia,f,oa,a);if(Ka.call){Ka.call(Wa,a);return}e=document.createEvent("UIEvent");e.initUIEvent("touchtoo",!0,!0,window,0);e.screenX=k.screenX;e.screenY=k.screenY;e.clientX=k.clientX;e.clientY=k.clientY;e.ctrlKey=a.ctrlKey;e.altKey=a.altKey;e.shiftKey=a.shiftKey;e.metaKey=a.metaKey;e.touches=document.createTouchList(k);e.targetTouches=document.createTouchList(k);e.changedTouches=document.createTouchList(k);f.dispatchEvent(e);return}n&&h&&((1<wa||1<z)&&b("TapHold(%s) Clearing taphold on %o, redispatching %o to %o",
ia,oa,a,f),e=document.createEvent("TouchEvent"),e.initTouchEvent(a.type,!0,!0,window,0,k.screenX,k.screenY,k.clientX,k.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,document.createTouchList(k),document.createTouchList(k),document.createTouchList(k)))}e?(R(a,"down/touch2"),f.dispatchEvent(e)):(P(f),Va=[],Fa=c(),(1<wa||1<z)&&b("TapHold/down(%s) %o t=%o x=%o y=%o t=%o touched=%o",ia,a,oa,pa,W,Fa,na),Ha&&Ha(a)||na||w(a,d))}}}function Oa(c){c=c||window.event;Q=!1;if(L>Fa)R(c,"up");else{K||E(c);I&&F(c);
var d=A(c),e=y(d,".tapholder");if(e!==t)(1<wa||1<z)&&b("TapHold/up/ignore(%s) %o tht=%o target=%o holder=%o elt=%o",ia,c,oa,d,e,t);else{d&&(d=y(d,Za));M=(c.clientX||r(c)||M)+La;Y=(c.clientY||g(c)||Y)+Ma;ma=l();if(!d||La||Ma)d=m(t,Za,M,Y);(1<wa||1<z)&&b("TapHold/up(%s) %o tht=%o d=%o s=%o,%o,%o t=%o,%o m=%o touched=%o pressed=%o ttt=%o swipe_t=%o",ia,c,oa,a(pa,W,M,Y),pa,W,Fa,M,Y,Q,na,ha,Ga,qa);if(!(c.changedTouches&&c.changedTouches.length&&c.changedTouches.length>Ua)){if(!Q&&(na||ha)){if(Ha&&Ha(c))return;
sa(c)}else if(!qa&&30<a(pa,W,M,Y))n(d,c,pa,W,M,Y);else if(Ha&&Ha(c))return;C()}}}}function eb(a){(wa||z)&&b("TapHold/cancel(%s) %o: th=%o t=%o p=%o",ia,a,oa,na,ha);za?(clearTimeout(za),za=!1):ha&&T(ha,a);N.live&&N.highlight(!1);cb=na=ha=Qa=!1;xa&&setTimeout(function(){G(t,xa)},20);Va=[];P(!1)}if(t){if(!(this instanceof f))return new f(t,v);var Wa=this,xa="tapholding",Ra="tapholdtarget",na=!1,ha=!1,cb=!1,za=!1,oa=!1,Va=[],Qa=!1,da=!1,Xa=!1,va=!1,V=!1,K=!1,I=!1,Ua=1,Ka=!1,ga=!1,Ga=!1,ea=!1,fa=!1,Aa=
!1,ra=0,ya=0,pa=!1,W=!1,Fa=!1,M=!1,Y=!1,ma=0,Ba=!1,Ta=!1,Ya=!1,qa=!1,Ja=2,La=0,Ma=0,wa=0,$a=O++,ia=v&&v.id?v.id+":"+$a:t.id?"#"+t.id+":"+$a:""+$a;Wa.id=ia;var Za=t.getAttribute("data-touchable"),Za=v&&v.hasOwnProperty("touchable")?"string"===typeof v.touchable?e.Selector(v.touchable):v.touchable:Za?e.Selector(Za):function(a){return D(a,t)},Ia=d.isClickable,Ha;if(v&&v.hasOwnProperty("untouchable"))if("string"===typeof v.untouchable){var Ca=e.Selector(v.untouchable);Ha=function(a){return a.nodeType?
Ca.match(a):Ca.match(A(a))}}else Ha=v.untouchable;else Ha=function(a){return Ia(a)};v&&v.noslip&&(V=v.noslip);v&&v.touch_xoff&&(La=v.touch_xoff);v&&v.touch_yoff&&(Ma=v.touch_yoff);v&&v.hasOwnProperty("trace")?(va=v.trace,wa="number"===typeof va?va:va?2:0):wa=x(t,/\bfdjtlog\d*/g)?p(t.className):0;var Da=!1;v?v.hasOwnProperty||(v={touch:!0}):v={};va=v.hasOwnProperty("fortouch")?v.fortouch:B.hasOwnProperty("fortouch")?B.fortouch:!1;ga=v.hasOwnProperty("holdthresh")?v.holdthresh:B.hasOwnProperty("holdthresh")?
B.holdthresh:200;ea=v.hasOwnProperty("movethresh")?v.movethresh:B.hasOwnProperty("movethresh")?B.movethresh:20;Ga=v.hasOwnProperty("taptapthresh")&&v.taptapthresh;fa=v.hasOwnProperty("wanderthresh")?v.wanderthresh:B.hasOwnProperty("wanderthresh")?B.wanderthresh:2E3;I=v.hasOwnProperty("override")?v.override:B.hasOwnProperty("override")?B.override:!1;Ka=v.hasOwnProperty("touchtoo")?v.touchtoo:B.hasOwnProperty("touchtoo")?B.touchtoo:!1;K=v.hasOwnProperty("bubble")?v.bubble:B.hasOwnProperty("bubble")?
B.bubble:!1;Ua=v.hasOwnProperty("maxtouches")?v.maxtouches:B.hasOwnProperty("maxtouches")?B.maxtouches:1;Ga&&"number"!==typeof Ga&&(Ga=B.taptapthresh||200);if(Aa=v.hasOwnProperty("scrolling")?v.touch:!1)Aa.nodeType||(Aa=t),ra=v.hasOwProperty("scrollx")&&v.scrollx?0:-1,ya=(v.hasOwProperty("scrolly")?v.scrolly:1)?0:-1;v.hasOwnProperty("holdclass")?xa=v.holdclass:B.hasOwnProperty("holdclass")&&(xa=B.holdclass);v.hasOwnProperty("touchclass")?Ra=v.touchclass:B.hasOwnProperty("touchclass")&&(Ra=B.touchclass);
Ja=v.hasOwnProperty("minmove")?v.minmove:B.hasOwnProperty("minmove")?B.minmove:va?2:0;v.hasOwnProperty("handlers")&&(this.handlers=v.handlers);H(t,"tapholder");va||e.addListener(t,"mousemove",Pa);e.addListener(t,"touchmove",Pa);va||e.addListener(t,"mousedown",bb);va||e.addListener(t,"mouseout",ua);va||e.addListener(t,"mouseover",ab);e.addListener(t,"touchstart",bb);va||e.addListener(t,"mouseup",Oa);e.addListener(t,"touchend",Oa);e.addListener(t,"touchcancel",eb);h||(B.fortouch||(e.addListener(window,
"mousedown",q),e.addListener(window,"mouseup",k),e.addListener(window,"mouseout",u)),h=window);this.elt=t;this.serial=$a;this.opts={bubble:K,override:I,movethresh:ea,holdthresh:ga,taptapthresh:Ga};this.istouched=function(){return na};this.ispressed=function(){return ha};this.clear=function(){ha&&!V&&J(ha);cb=na=ha=Qa=!1;C();za&&(clearTimeout(za),za=!1);P(!1);Va=[]};this.fakePress=function(a,d){pa=Ta=M=a.clientX||r(a);W=Ya=Y=a.clientY||g(a);ma=Fa=c();var e=document.elementFromPoint(pa,W);e||b("TapHold(%s): No target from %o,%o",
ia,pa,W);P(e);Va=[e];(wa||z)&&b("TapHold/fakePress(%s) t=%o x=%o y=%o t=%o",ia,oa,pa,W,Fa);w(a,d)};this.abort=R;(wa||z)&&b("New TapHold(%s) for %o: %o opts %j, trace=%o/%o",ia,t,Wa,v||!1,wa,z);return this}b.warn("TapHold with no argument!")}var b=fdjt.Log,e=fdjt.DOM,l=fdjt.Time,d=fdjt.UI,c=fdjt.ET,z=0,h=!1,B={},v=e.getChildren,H=e.addClass,G=e.dropClass,x=e.hasClass,y=e.getParent,D=e.hasParent,N=d.Reticle,E=d.noBubble,F=d.noDefault,A=d.T,L=0,O=1,P={shift:16,alt:18,control:17,meta:224,os:91,altgr:225,
fn:-1,numlock:144,capslock:20,scrolllock:145},S;for(S in P)P.hasOwnProperty(S);var t=Math.sqrt,Q=!1;f.clear=function(){z&&b("TapHold.clear()");L=c()};f.trace=function(a){if("undefined"===typeof a)return z;var b=z;"number"===typeof a?z=a:a&&(z=B.traceall||2);return b};f.default_opts=B;return f}();fdjt.UI||(fdjt.UI={});
fdjt.TextSelect=fdjt.UI.Selecting=fdjt.UI.TextSelect=function(){function a(b,c){if(this instanceof a)this.serial=++O;else return new a(b,c);if("string"===typeof b){var d=document.getElementById(b);if(d)this.nodes=b=[d];else return!1}else if(b.nodeType)this.nodes=b=[b];else if(b.length)this.nodes=b;else return!1;var e=0,d=this.orig=[],f=this.wrapped=[],g=this.words=[],k=this.wrappers=[],l=this.tapholds=[];if(c&&c.hasOwnProperty("trace"))var m=c.trace,e="number"===typeof m?m:m?1:0;this.traced=e;var q=
this.prefix="fdjtSel0"+this.serial;this.loupe=B("span.fdjtselectloupe");this.adjust=!1;A[q]=this;for(var J=q.length+1,m=0,n=b.length;m<n;){var w=b[m++],p="inline"===y(w).display?B("span.fdjtselecting"):B("div.fdjtselecting");p.id=q+"w"+m;p.title=c&&c.title||"Tap or hold/drag to move the ends of the text range";A[p.id]=this;k.push(p);var R=h(p,this,c);L[p.id]=R;l.push(R);(e||P)&&v("Created TapHold handler (#%d) for wrapper %s around %o",R.serial,p.id,w);w.parentNode.replaceChild(p,w);d.push(w);f.push(p);
r(w,d,f,g,q);p.appendChild(w)}this.end=this.start=!1;this.max=this.min=-1;this.n_words=0;this.onchange=c&&c.onchange||!1;this.wordnum=function(a){for(var b=!1;a&&1!==a.nodeType;)a=a.parentNode;return a&&(b=a.id)&&"SPAN"===a.tagName&&0===b.search(q)?parseInt(b.slice(J),10):!1};this.startEvent=function(a,b){var c=H.T(a);P&&v("startEvent %o, target=%o, wrappers=%o",a,c,k);for(var d=0,f=k.length;d<f;){var h=k[d++];if(G(h,c)||G(c,h)){c=L[h.id];(e||P)&&v("Using TapHold handler @%d for wrapper %s (#%d)",
d-1,h.id,c.serial);c.fakePress(a,b);break}}};return this}function r(a,b,c,d,e){var f,h;if(3===a.nodeType){var g;f=a.nodeValue.split(/\b/);h=0;b=f.length;a=[];for(c=!1;h<b;){var k=f[h++];"\u00ad"===k?c?(g=f[h])?(c=c+k+g,h++):c+=k:c=k:(c&&a.push(c),c=k)}c&&a.push(c);b=[];f=0;for(h=a.length;f<h;)if(c=a[f++],0!==c.length)if(0<=c.search(/\S/)&&0<=c.search(/\s/))for(;c.length;)k=c.search(/\s/),g=c.search(/\S/),k=0>=k?g:0>=g?k:k<g?k:g,0>=k&&(k=c.length),0<k&&(g=c.slice(0,k),g=B("span.fdjtword",g),g.id=e+
"_"+d.length,d.push(g),b.push(g)),c=c.slice(k);else g=B("span.fdjtword",c),g.id=e+"_"+d.length,d.push(g),b.push(g);return B("span.fdjtselectwrap",b)}if(1===a.nodeType){if((f=a.className)&&("fdjtselectwrap"===f||"fdjtskiptext"===a.className||0<=a.className.search(/\bfdjtskiptext\b/)))return a;f=y(a);if(""!==f.position&&"static"!==f.position)return a;if((k=a.childNodes)&&0!==k.length&&"fdjtselectwrap"!==a.className)for(f=0,h=k.length;f<h;){g=k[f++];var l=r(g,b,c,d,e);g!==l&&(b.push(g),c.push(l),a.replaceChild(l,
g))}}return a}function g(a,b,c){for(;b<=c;)a[b++].className="fdjtselected"}function m(a,b,c){for(;b<=c;)a[b++].className="fdjtword"}function k(a,b,c){for(var d=!1;a&&1!==a.nodeType;)a=a.parentNode;if(!G(a,".fdjtselectloupe")){if(!c&&a&&(d=a.id)&&"SPAN"===a.tagName&&0===d.search("fdjtSel")){var e=d.indexOf("_");e&&(c=A[d.slice(0,e)])}if(!c){for(d=a;d&&!(d.className&&d.id&&0<=d.className.search(/\bfdjtselecting\b/));)d=d.parentNode;if(d)c=A[d.id];else return!1}if(!c)return!1;(P||c.traced)&&v("overWord %o, sel=%o, tapped=%o, adjust=%o, anchor=%o",
a,c,b,c.adjust,c.anchor);if(b)q(a,c,!0);else if(c.word)q(a,c);else if(N(a,"fdjtselectstart")||N(a,"fdjtselectend"))c.timeout&&(clearTimeout(c.timeout),c.timeout=!1),c.pending=!1,c.word=a,q(a,c);else if(c.pending!==a)if(a.offsetParent)c.timeout&&clearTimeout(c.timeout),u(a,c,!1),c.word=!1,c.pending=a,c.timeout=setTimeout(function(){c.pending===a&&(c.timeout&&clearTimeout(c.timeout),c.word=a,c.pending=!1,q(a,c))},100);else return!1;return!0}}function q(a,b,c){if(a.offsetParent){if(b.start)if(b.anchor)b.setRange(b.anchor,
a);else if(b.start===b.end)b.setRange(b.start,a);else{var d=b.wordnum(a),e=b.start,f=b.end;if("start"===b.adjust&&d>b.max||"end"===b.adjust&&d<b.min)return;if("start"===b.adjust)e=a;else if("end"===b.adjust)f=a;else if(e===a)b.setAdjust("start");else if(f===a)b.setAdjust("end");else if(d<=b.min)e=a,b.setAdjust("start");else if(d>=b.max)f=a,b.setAdjust("end");else if(6>d-b.min)e=a,b.setAdjust("start");else if(6>b.max-d)f=a,b.setAdjust("end");else{if(c)return;d-b.min>(b.max-b.min)/2?(f=a,b.setAdjust("end")):
(e=a,b.setAdjust("start"))}b.setRange(e,f)}else b.setRange(a,a);b.loupe&&u(a,b,c)}}function u(a,b,c){var d=a.parentNode,e=b.loupe;b.loupe_timeout&&(clearTimeout(b.loupe_timeout),b.loupe_timeout=!1);if(a.offsetParent){for(var f=a.parentNode;f&&"inline"===y(f).display;)f=f.parentNode;(P||b.traced)&&v("updateLoupe(%d) over %o for %o%s",b.serial,a,b,c?" (tapped)":"");var f=p(a,5,5,f),h=B.getGeometry(a,a.offsetParent),g=a.offsetParent.offsetWidth;e.innerHTML="";e.style.display="none";B.append(e,f.words);
d.insertBefore(e,a);h.left<g/2?(e.style.float="left",e.style.left=h.left-1.5*f.wordstart+"px",e.style.right=""):(e.style.float="right",e.style.right=g-h.right-1.5*(f.width-f.wordend)+"px",e.style.left="");e.style.display="";c&&setTimeout(1E3,function(){b.loupe.display="none"})}}function p(a,b,c,d){var e=a.id,f=e&&/(fdjtSel\d+_)(\d+)/.exec(e);if(f&&3===f.length){var e=f[1],f=parseInt(f[2],10),h=f-b;c=f+c;0>h&&(h=0);b=[];for(var g=0,k,l,m=S(a);h<c;){var n=document.getElementById(e+h);if(n&&(!d||G(n,
d)))if(1===n.nodeType){var w=S(n);if(w.bottom<m.top||w.top>=m.bottom){h++;continue}w=n.cloneNode(!0);x(w);h<f?g+=n.offsetWidth:h===f?(k=g,g=l=g+n.offsetWidth):g+=n.offsetWidth;n===a&&B.addClass(w,"fdjtselected");b.push(w)}else b.push(n.cloneNode(!0));h++}return{words:b,width:g,wordstart:k,wordend:l}}}function f(a){var b=!1;return a&&(b=a.id)&&"SPAN"===a.tagName&&0===b.search("fdjtSel")?(a=b.indexOf("_"))?A[b.slice(0,a)]||!1:!1:!1}function b(a){a=a||window.event;for(var b=H.T(a);b&&1!==b.nodeType;)b=
b.parentNode;for(;b;)if(b&&b.id&&"SPAN"===b.tagName&&0===b.id.search("fdjtSel")){var c=f(b);!c||c.anchor||c.start||(c.anchor=b);(P||c&&c.traced)&&v("TextSelect/hold %o t=%o sel=%o",a,b,c);k(b,!1,c)&&H.cancel(a);break}else if(1===b.nodeType)b=b.parentNode;else break}function e(a){a=a||window.event;for(var b=H.T(a);b&&1!==b.nodeType;)b=b.parentNode;for(;b;)if(b&&b.id&&"SPAN"===b.tagName&&0===b.id.search("fdjtSel")){var c=f(b);(P||c&&c.traced)&&v("TextSelect/tap %o t=%o sel=%o",a,b,c);1===c.n_words?
c.setRange(!1):"fdjtselectstart"===b.className||"fdjtselectend"===b.className?(H.cancel(a),c.setRange(b,b)):k(b,!0,c)?(c.adjust="fdjtselectstart"===b.className?"start":"fdjtselectend"===b.className?"end":!1,H.cancel(a)):c&&(c.adjust=!1);break}else if(1===b.nodeType)b=b.parentNode;else break}function l(a,b){a=a||window.event;var c=H.T(a);(P||b&&b.traced)&&v("TextSelect/release %o t=%o sel=%o",a,c,b);b&&(b.anchor=!1,b.word=!1,b.pending=!1,b.timeout&&(clearTimeout(b.timeout),b.timeout=!1),b.setAdjust(!1),
b.loupe&&(b.loupe.style.display="none"))}function d(a,b){a=a||window.event;var c=H.T(a);(P||b&&b.traced)&&v("TextSelect/slip %o t=%o sel=%o",a,c,b);b&&b.loupe&&(b.loupe_timeout=setTimeout(function(){b.loupe_timeout=!1;b.loupe.style.display="none"},2E3))}function c(a,b){return function(c){l(c,a);b&&b(c,a)}}function z(a,b){return function(c){d(c,a);b&&b(c,a)}}function h(a,d,f){f||(f={});f.override=!0;f.touchable=".fdjtword,.fdjtselected,.fdjtselectstart,.fdjtselectend";var h=new H.TapHold(a,f);B.addListener(a,
"tap",f&&f.ontap||e);B.addListener(a,"hold",f&&f.onhold||b);B.addListener(a,"release",c(d,f.onrelease||!1));B.addListener(a,"slip",z(d,f.onslip||!1));return h}var B=fdjt.DOM,v=fdjt.Log,H=fdjt.UI,G=B.hasParent,x=B.stripIDs,y=B.getStyle,D=B.textify,N=B.hasClass,E=B.swapClass,F=B.dropClass,A={},L={},O=0,P=0;a.prototype.toString=function(){for(var a=this.wrappers,b="TextSelect(["+this.min+("start"===this.adjust?"*":"")+","+this.max+("end"===this.adjust?"*":"")+"],",c=0,d=a.length;c<d;)a[c].id&&(b=b+(0<
c?",":"")+"'"+a[c].id+"'"),c++;return b+")"};a.prototype.setRange=function(a,b){(this.trace||P)&&v("TextSelect.setRange %o %o for %o",a,b,this);if(a){var c=this.words,d=this.wordnum(a),e=this.wordnum(b);if(e<d){var f=a;a=b;b=f;f=d;d=e;e=f}if(this.start){if(this.start===a&&this.end===b)return;var f=this.wordnum(this.start),h=this.wordnum(this.end);d>h||e<f?(m(c,f,h),g(c,d,e)):(d<f?g(c,d,f):d>f&&m(c,f,d),e>h?g(c,h,e):e<h&&m(c,e,h))}else g(c,d,e);c[e].className="fdjtselectend";c[d].className="fdjtselectstart";
this.min=d;this.max=e;this.start=a;this.end=b;this.n_words=e-d+1}else this.start&&this.end&&m(this.words,this.min,this.max),this.start=this.end=!1,this.min=this.max=-1,this.n_words=0;if(this.onchange)this.onchange()};var S=B.getGeometry;a.getSelector=f;a.prototype.setString=function(a){var b=this.wrappers,c=1===b.length&&b[0];if(!c)for(var c=B("div"),d=0,e=b.length;d<e;){var f=b[d++];c.appendChild(f.cloneNode(!0))}if(b=B.findString(c,a)){a=b.startContainer;for(b=b.endContainer;a&&1!==a.nodeType;)a=
a.parentNode;for(;b&&1!==b.nodeType;)b=b.parentNode;a&&b&&a.id&&b.id&&0===a.id.search(this.prefix)&&0===b.id.search(this.prefix)&&(a=document.getElementById(a.id),b=document.getElementById(b.id),a&&b&&this.setRange(a,b))}};a.prototype.getString=function(a,b,c){a||(a=this.start);b||(b=this.end);for(var d=this.wrappers,e=[],f=this.prefix,h=-1;a;){if(!c&&1===a.nodeType){var g=y(a);"static"===g.position&&"inline"!==g.display&&"none"!==g.display&&e.push("\n")}if(1===a.nodeType&&"SPAN"===a.tagName&&a.id&&
0===a.id.search(f)&&(g=a.innerText||D(a),e.push(g.replace("\u00ad","")),a===b))break;if(a.firstChild&&"fdjtselectloupe"!==a.className&&3!==a.firstChild.nodeType)a=a.firstChild;else if(a.nextSibling)a=a.nextSibling;else{for(;a;){a:if(h=a,g=d,g.indexOf)h=g.indexOf(h);else{for(var k=0,l=g.length;k<l;)if(g[k]===h){h=k;break a}else k++;h=-1}if(0<=h)break;else if(a.nextSibling){a=a.nextSibling;break}else a=a.parentNode}0<=h&&h+1<d.length&&(a=d[h+1])}if(!a)break}return e.join("")};a.prototype.getOffset=
function(a){if(!this.start)return!1;var b=this.words[0];if(a){var c=this.words,d=0,e=c.length;if(!G(this.start,a)||!G(this.end,a))return!1;for(;d<e&&!G(b,a);)b=c[d++]}a=this.getString(!1,!1,!0);return this.getString(b,this.end,!0).length-a.length};a.prototype.getInfo=function(a){var b=this.traced;if(!this.start)return!1;var c=this.getString(),d=this.words[0];if(a){var e=this.words,f=0,h=e.length;if(!G(this.start,a)||!G(this.end,a))return!1;for(;f<h&&!G(d,a);)d=e[f++]}a=this.getString(!1,!1,!0);d=
this.getString(d,this.end,!0);(b||P)&&v("GetInfo %o: start=%o, end=%o, off=%o, string=%o",this,this.start,this.end,d.length-a.length,c);return{start:this.start,end:this.end,off:d.length-a.length,string:c}};a.prototype.setAdjust=function(a){var b=this.traced;(P||b)&&v("TextSelect.setAdjust %o for %o",a,this);a?(this.adjust=a,E(this.nodes,/\b(fdjtadjuststart|fdjtadjustend)\b/,"fdjtadjust"+a)):(this.adjust=!1,F(this.nodes,/\b(fdjtadjuststart|fdjtadjustend)\b/))};a.prototype.clear=function(){var a=this.wrappers,
b=this.orig,c=this.wrapped;if(b){for(var d=b.length-1;0<=d;){var e=b[d],f=c[d];d--;f.parentNode.replaceChild(e,f)}d=0;for(b=a.length;d<b;)c=a[d++],delete L[c.id],delete A[c.id];if(this.onclear)for(a=this.onclear,this.onclear=!1,Array.isArray(a)||(a=[a]),d=0,b=a.length;d<b;)a[d++]();delete A[this.prefix];delete this.wrapped;delete this.orig;delete this.wrappers;delete this.nodes;delete this.words;delete this.wrappers;delete this.start;delete this.end}};a.hold_handler=b;a.handler=b;a.tap_handler=e;
a.release_handler=l;a.trace=function(a,b){if("undefined"===typeof a)return P;P="number"===typeof a?a:a?1:0;b&&fdjt.TapHold.trace(b)};return a}();fdjt.UI||(fdjt.UI={});
fdjt.ScrollEver=fdjt.UI.ScrollEver=function(){function a(u){function p(){if(!f)if(!e||!z||l>=c)b&&clearTimeout(b),r.addClass(document.body,"scrolleverdone");else{f=!0;var h=e.replace("-off-",k(l+d)),g=new XMLHttpRequest;g.open("GET",h,!0);g.withCredentials=!0;g.onreadystatechange=function(){if(4===g.readyState&&200===g.status){a.debug&&q("fdjtScrollEver getMoreResults (response)");var b=r(z.tagName),c=g.responseText;try{b.innerHTML=c}catch(e){b=document.createElement("span"),b.style.display="none",
b.innerHTML="<"+z.tagName+">"+c+"</"+z.tagName+">",b=b.childNodes[0]}for(var c=[],b=b.childNodes,h=0,k=b.length,m={};h<k;){var v=b[h++];1===v.nodeType&&v.id?document.getElementById(v.id)||m[v.id]||c.push(v):c.push(v);v.id&&(m[v.id]=v.id)}r(z,c);l+=d;var A=u.iscroll||window.iscroller||!1;A&&setTimeout(function(){A.refresh()},10);f=!1}};a.debug&&q("fdjtScrollEver getMoreResults (call)");g.send(null)}}var f=!1,b=!1;u||(u={});var e=u.url||r.getLink("~{http://fdjt.org/}scrollfetch")||r.getLink("~SCROLLFETCH"),
l=u.off||m.getQuery("OFF")||0,d=u.win||m.getQuery("WINDOW")||r.getMeta("~{http://fdjt.org/}scrollwindow")||r.getMeta("~SCROLLWINDOW")||7,c=u.limit||m.getQuery("LIMIT")||r.getMeta("~{http://fdjt.org/}scrollmax")||r.getMeta("~scrollmax")||7,z=u.container||r.getMeta("~{http://fdjt.org/}scrollelement")||r.getMeta("~scrollelement")||"FDJTSCROLLCONTAINER";if("string"===typeof z)if(g(z))z=g(z);else{q.warn("No container %s",z);return}var h=u.thresh||r.getMeta("~{http://fdjt.org/}scrollthresh")||r.getMeta("~scrollthresh")||
100,B=u.interval||r.getMeta("~{http://fdjt.org/}scrollinterval")||r.getMeta("~scrollinterval")||500;"number"!==typeof l&&(l=parseInt(l,10));"number"!==typeof d&&(d=parseInt(d,10));"number"!==typeof c&&(c=parseInt(c,10));"number"!==typeof h&&(h=parseInt(h,10));"number"!==typeof B&&(B=parseInt(B,10));a.debug&&(q("fdjtScrollEver called: %o/%o+%o, fetch=%s",l,c,d,e),q("fdjtScrollEver scrolling on %opx, checking every %ous on %o",h,B,z));return b=setInterval(function(){if(!f){var a=u.iscroll||window.iscroller||
!1,b=a?a.scrollerH:document.documentElement.scrollHeight,c=a?-a.y:window.pageYOffset;a||"number"===typeof c||(c=document.documentElement.scrollTop);a=a?a.wrapperH:document.documentElement.clientHeight;(b-(c+a)<h||b<a)&&p()}},B)}var r=fdjt.DOM,g=fdjt.ID,m=fdjt.State,k=fdjt.String,q=fdjt.Log;return a}();fdjt.useGlobals=function(){window.fdjtDOM||(window.fdjtDOM=fdjt.DOM);window.fdjtUI||(window.fdjtUI=fdjt.UI);window.fdjtTime&&(window.fdjtTime=fdjt.Time);window.fdjtString||(window.fdjtString=fdjt.String);window.fdjtState||(window.fdjtState=fdjt.State);window.fdjtLog||(window.fdjtLog=fdjt.Log);window.fdjtHash||(window.fdjtHash=fdjt.Hash);window.fdjtAjax||(window.fdjtAjax=fdjt.Ajax);window.CodexLayout||(window.CodexLayout=fdjt.CodexLayout);window.RefDB||(window.RefDB=fdjt.RefDB)};var Knodule=function(){function a(a,b){if(0===arguments.length)return this;b||(b={});b.indices=b.indices?b.indices.concat(["terms","hooks","genls","specls","allgenls"]):["terms","hooks","genls","specls","allgenls"];var e=b.language,f=u.call(this,a,b);if(e&&f.language!==e)throw{error:"language mismatch"};if(b.language&&f.language&&b.language!==f.language)throw{error:"language mismatch"};f.language=b.language?b.language:"EN";f.dterms={};f.alldterms=[];f.prime=[];f.primescores={};f.validate=!0;f.strict=
!1;f.finished=!1;f.assumed_dterms=[];f.xdterms={};f.allxdterms=[];f.genlsIndex={};f.oidmap={};f.drules={};return f}function r(a,c,g){if(0===arguments.length)return this;var h=!1,l="*"===a[0]&&a.search(/[^*]/),m=!1,q=this,q=!1;"~"===a[0]?(h=!0,a=a.slice(1)):l&&(a=a.slice(l),c.primescores[a]||(l>c.primescores[a]&&(c.primescores[a]=l),m=!0));var r=a.indexOf("@");if(0===r||1===r&&":"===a[0])q=!0;else if(2<r&&"\\"!==a[r-1]){var x=a.slice(r+1);x!==c.name&&0>c.aliases.indexOf(x)&&f("Reference %s in %s is being handled by %s",
a,x,c);a=a.slice(0,r)}q||(0===a.search(b)?(q=a.indexOf("$"),g=a.slice(0,q).toUpperCase(),a=a.slice(q+1)):g=g?g.toUpperCase():c.language||"EN");a=e(a);r=g===c.language?a:g+"$"+a;q=p.call(this,r,c);q===this&&(q.dterm||(q.dterm=r),q.add("dterms",r),c.dterms.hasOwnProperty(r)||(c.dterms[r]=q,c.alldterms.push(r)),q.allways=fdjt.Set(),g&&q.add(g,a),q._live=k());h&&(q.weak=!0);l&&(q.prime=l);l&&m&&c.prime.push(q);g&&g!==c.language&&(q.language=g);return q}function g(a,b,e){for(e=a.indexOf(b,e||0);0<e&&"\\"===
a[e-1];)e=a.indexOf(b,e+1);return e}var m=fdjt.String,k=fdjt.Time,q=fdjt.Log,u=fdjt.RefDB,p=fdjt.Ref,f=q.warn,b=/^(([A-Za-z]{2,3}\$)|([A-Za-z]{2,3}_[A-Za-z]{2,3}\$))/;a.prototype=new u;a.prototype.toString=function(){return"Knodule("+this.name+")"};var e=m.stdcap;r.prototype=new u.Ref;a.refclass=a.prototype.refclass=r;a.KNode=r;a.Knode=r;a.prototype.KNode=a.prototype.Knode=function(a,b){return a instanceof r?a:new r(a,this,b)};a.prototype.cons=function(a,b){return new r(a,this,b)};a.prototype.probe=
function(a,b){var f=this.refs,h=this.aliases;a=e(a);if(this.language!==b&&b)a=b.toUpperCase()+"$"+a;else return f.hasOwnProperty(a)&&f[a]||h.hasOwnProperty(a)&&h[a]||!1;return this.dterms[b+"$"+a]||!1};r.prototype.add=function(a,b){return p.prototype.add.call(this,a,b)&&"genls"===a?(this.allways.push(b),this.allways=u.merge(this.allways,b.allways),!0):!1};r.prototype.addTerm=function(a,c,e){if("string"===typeof a&&0===a.search(b)){var f=a.indexOf("$");e=a.slice(0,f).toUpperCase();f=a.slice(f+1);e===
this._db.language?c?this.add(c,f):(this.add(e,f),this.add("terms",f)):c?this.add(c,e+"$"+f):(this.add(e,f),this.add("terms",a))}else e?(e=e.toUpperCase(),e===this._db.language?c?this.add(c,a):this.add("terms",a):c?this.add(c,e+"$"+a):this.add("terms",e+"$"+a)):c?this.add(c,a):(this.add(this._db.language,a),this.add("terms",a))};r.prototype.tagString=function(b){if(this.oid)return this.oid;if(this.uuid)return this.uuid;if(this._qid)return this._qid;b||(b=a.current||!1);return b===this._db?this._id:
this._db.absrefs?this._id:this._domain?this._id+"@"+this._domain:this._id+"@"+this._db.name};r.prototype.toPlaintext=function(){var a="",b=this[this._db.language||"EN"],e=0;"string"===typeof b&&(b=[b]);for(var f=0;f<b.length;)a=a+(0<e?"|":"")+b[f++],e++;b=this.genls;"string"===typeof b&&(b=[b]);if(b&&b.length)for(f=0;f<b.length;)a=a+(0<e?"|^":"^")+b[f++].dterm,e++;b=this.specls;"string"===typeof b&&(b=[b]);if(b&&b.length)for(f=0;f<b.length;)a=a+(0<e?"|_":"_")+b[f++].dterm,e++;return a};var l=m.segment;
a.prototype.handleClause=function(a,b){var e=!1,f=!1,k=!1;0<=a.indexOf("\\")&&(a=m.unEscape(a));if(!(0===a.length||0>a.search(/[^\n\t ]/g))){switch(a[0]){case "^":"~"===a[1]?b.add("sometimes",this.KNode(a.slice(2))):"*"===a[2]?b.add("commonly",this.KNode(a.slice(2))):(e=g(a,"("),0<e?(k=g(a,")",e),0>k?q.warn("Invalid Knodule clause '%s' for %o (%s)",a,b,b.dterm):(f=this.KNode(a.slice(1,e)),e=this.KNode(a.slice(e+1,k)),e.add(f.dterm,b),b.add("genls",f))):b.add("genls",this.KNode(a.slice(1))));break;
case "_":e=this.KNode(a.slice(1));b.add("examples",e);e.add("genls",b);break;case "-":b.add("never",this.KNode(a.slice(1)));break;case "&":k=a.slice("-"===a[1]?2:1);f=this.KNode(k);"-"===a[1]?b.add("antiassocs",f):b.add("assocs",f);break;case "@":"#"===a[1]?b.add("tags",a.slice(2)):b.add("uri",a.slice(1));break;case "=":"@"===a[1]?b.oid=a.slice(1):"*"===a[1]?b.add("equiv",this.KNode(a.slice(2))):"~"===a[1]?b.add("kinda",this.KNode(a.slice(2))):"="===a[1]?b.add("identical",this.KNode(a.slice(1))):
(f=a.slice(1),e=b._db,e.dterms.hasOwnProperty(f)||(b.add("dterms",f),e.alldterms.push(f),e.dterms[f]=b));break;case "+":b.gloss="*"===a[1]?a.slice(2):"~"===a[1]?a.slice(2):a.slice(1);b.addTerm(b.gloss,"glosses");break;case "%":f=this.KNode(a.slice(1));if(b.mirror===f)break;else e=b.mirror,q.warn("Inconsistent mirrors for %s: +%s and -%s",b,f,e),e.mirror=!1;f.mirror&&(q.warn("Inconsistent mirrors for %s: +%s and -%s",f,b,f.mirror),e.mirror=!1);b.mirror=f;f.mirror=b;break;case ".":e=g(a,"=");if(!e)throw{name:"InvalidClause",
irritant:a};f=this.KNode(a.slice(1,e));e=this.KNode(a.slice(e+1));b.add(f.dterm,e);e.add("genls",f);break;case "~":f=a.slice(1);b.addTerm(f,"hooks");break;case ":":k=g(a,"=");if(0<k){f=a.slice(1,k);k=(e="+"===a[k+1])?a.slice(k+2):a.slice(k+1);if("\\"===k[0])k=k.slice(1);else if(/\d/.exec(k[0])){var l=parseFloat(k[0]);"number"!==typeof l||!l&&0!==l||(k=l)}e?b.add(f,k):b.store(f,k)}b.add("flags",a.slice(1));break;default:e=g(a,"="),0<e?(f=this.KNode(a.slice(0,e)),e=this.KNode(a.slice(e+1)),b.add(f.dterm,
e),e.add("genls",f)):b.addTerm(a)}return b}};a.prototype.handleSubjectEntry=function(a){var b=l(a,/[|]/g),f;a:{f=e(b[0]);var h=this.probe(f);if(h)f=h;else{f=1;for(var g=b.length;f<g;)if(h=b[f++],"="===h[0]&&(h=this.probe(e(h.slice(1))))){f=h;break a}f=this.KNode(b[0])}}2<this.trace_parsing&&q("Processing subject entry %s %o %o",a,f,b);for(a=1;a<b.length;)this.handleClause(b[a++],f);2<this.trace_parsing&&q("Processed subject entry %o",f);return f};a.prototype.handleEntry=function(b){b=b.trim();if(0===
b.length)return!1;var c=b.search(/[^*]/);0<c&&(b=b.slice(c));var e=m.findSplit(b,"|"),h=m.findSplit(b,"@");if(0<h&&(0>e||h<e)){var g=b.slice(0,h),h=0>e?b.slice(h+1):b.slice(h+1,e),h=new a(h);h instanceof a?b=0>e?h.KNode(g):h.handleEntry(g+b.slice(e)):(f("Resolved %s to non-knodule %o",b,h),b=h.ref(g))}else b=this.handleSubjectEntry(b);if(c){var e=b._id,g=this.prime,h=this.primescores,k=h[e];k?c>k&&(h[e]=c,b.prime=c):(g.push(e),h[e]=c,b.prime=c)}return b};a.prototype.handleEntries=function(a){if("string"===
typeof a)return a=a.replace(/^\s*#.*$/g,"").replace(/^\s*\/\/.*$/g,""),a=l(a,/(?:\s*[\n;]\s*)+/g),1<this.trace_parsing&&q("Handling %d entries",a.length),this.handleEntries(a);if(a instanceof Array){for(var b=[],e=0;e<a.length;){var f=a[e++],g=f.length;";"===f[g-1]&&(f=f.slice(0,g-1));b[e]=this.handleEntry(f)}return b}throw{name:"TypeError",irritant:a};};a.prototype.def=a.prototype.handleSubjectEntry;a.def=function(b,c){c||(c=a.knodule);return c.def(b)};a.ref=u.ref;a.prototype.trace_parsing=0;return a}(),
KNode=Knodule.KNode,Knode=KNode;KNode!==Knode&&fdjt.Log("Weird stuff");(function(){function a(b,e,f){if(0===arguments.length)return this;var d=[],c=this.slots=[];e||(e=a.default_dbs||!1);f||(f=this.weights||{tags:1});b instanceof Array||(b=[b]);for(var g in f)f.hasOwnProperty(g)&&c.push(g);g=0;for(var h=b.length;g<h;){var k=b[g++];"string"===typeof k?d.push({fields:"strings",values:[k]}):k._db&&k._db.slots?d.push({fields:k._db.slots,values:[k]}):d.push({fields:c,values:[k]})}this.tags=b;return m.call(this,e,d,f)}var r=fdjt.RefDB,g=fdjt.Ref,m=r.Query,k=Knodule.KNode,
q=fdjt.Log.warn,u=fdjt.Set;Knodule.addTags=function(a,e,f,d,c,m){c||(c="tags");"string"===typeof e?e=[e]:e instanceof g?e=[e]:e.length?e instanceof Array||(e=[].concat(e)):e=[e];"string"===typeof a?a=[a]:a instanceof g?a=[a]:a instanceof Array||(a=a.length?[].concat(a):[a]);for(var h=Array(e.length),u=0,v=e.length,H,G,x;u<v;){H=e[u];G=c;x=!1;if("string"===typeof H){if("*"===H[0]){var y=H.search(/[^*]/);G=H.slice(0,y)+c;H=H.slice(y)}else"~"===H[0]&&(G="~"+c,H=H.slice(1),x=!0);0<H.indexOf("|")?d?H=
d.handleEntry(H):Knodule.current&&(H=Knodule.current.handleEntry(H)):x&&d?H=d.probe(H)||H:x||d&&(H=d.ref(H))}h[u]=G;e[u]=H;u++}y=0;for(d=a.length;y<d;)u=a[y],(x=f&&"string"===typeof u?f.ref(u):r.resolve(u,!1,Knodule,!0))?a[y++]=x:(q("Couldn't resolve %s to a reference",u),y++);for(u=0;u<v;){H=e[u];G=h[u];m&&(f=G.replace(c,"%"),(f=p[f])||(f=3),m.increment(H,d*f));for(y=0;y<d;)if(x=a[y++])x.add(G,H,!0),x.alltags?x.alltags.push(H):x.alltags=[H],H instanceof k&&(x.add("knodes",H),x.add(G+"*",H,!0)),H instanceof
k&&H.allways&&x.add(G+"*",H.allways,!0);u++}};Knodule.exportTagSlot=function(a,e,f){a instanceof Array||(a=[a]);f=f.tags||(f.tags=[]);var d=e.search(/[^*~]+/),c=e.search(/[*]*$/),g=d&&e.slice(0,d);c?e.slice(d,c):d&&e.slice(d);e=0;for(c=a.length;e<c;){var h=a[e++];h&&(h="string"===typeof h?h:h._qid||h.getQID(),d?f.push(g+h):f.push(h))}};Knodule.importTagSlot=function(a,e,f,d,c){d=[];var m=[],h,p=a.tag_knodule||a._db.tag_knodule||Knodule.tag_knodule||Knodule.current;f instanceof Array||(f=[f]);for(var v=
0,H=f.length;v<H;){var G=f[v++];if(G)if(G instanceof g)d.push(G);else if("object"===typeof G&&G._id)h=a.resolve(G,p,Knodule,!0)||G._id,d.push(h);else if("string"===typeof G){var x=G.search(/[^*~]/),y=G,D=e;h=G;0<x&&(D=G.slice(0,x)+e,y=G.slice(x));G=y.indexOf("|");h=0<G?y.slice(0,G):y;h=r.resolve(h,p,Knodule,!0)||p&&p.ref(h)||h;0<G&&(h instanceof k?h._db.handleEntry(y):q("No knodule for %s",y));m.push(h);h instanceof k&&a.add("knodes",h,c);D!==e?a.add(D,h,c):d.push(h)}else d.push(G)}a["all"+e]=u(m.concat(d));
if(d.length)return d};var p={"~%":1,"~%*":1,"%":4,"%*":4,"^%":2,"^%*":2,"*%":8,"*%*":6,"**%":12,"**%*":8};a.prototype=new m;var f=fdjt.Map;a.prototype.getCoTags=function(a){if(this.cotags)return this.cotags;if(this.execute()){a||(a=this.results);for(var e=this.scores,g=this.slots,d=g.length,c=this.cotags=[],k=this.tagscores=new f,h=this.tagfreqs=new f,m=this._weights||this.weights,q=0,p=0,r=0,x=a.length;r<x;)for(var u=a[r++],D={},N=e&&e[u._id]||1,E=0;E<d;){var F=g[E];if(u.hasOwnProperty(F)){var A=
u[F],F=m[F]||1;A instanceof Array||(A=[A]);for(var L=0,O=A.length;L<O;){var P=A[L++];k.get(P)||c.push(P);if(!D[P]){var S=h.increment(P,1);S>p&&(p=S);D[P]=!0}P=k.increment(P,F*N);P>q&&(q=P)}}E++}this.max_tagfreq=p;this.max_tagscore=q;return c}return!1};a.prototype.getString=function(){for(var a=fdjt.Set(this.tags),e="",f=0,d=a.length;f<d;)var c=a[f++],e="string"===typeof c?e+";"+c:e+";"+(c._qid||c.getQID());return e};Knodule.TagQuery=a})();(function(){function a(a,b,e,g,d){function c(){if(a instanceof p){var b=a.dterm;m.innerHTML=b;v.setAttribute("data-key",b);v.setAttribute("data-dterm",a);if(d||g){var c=a[d];c&&"string"===typeof c&&(c=[c]);if(c)for(var e=0;e<c.length;){var q=c[e++];if(q!==b){var r=k("span.variation",q,"=");r.setAttribute("data-key",q);h.appendChild(r)}}a.about&&(v.title=a.about)}v.setAttribute("data-key",a.dterm)}else a.name&&(v.setAttribute("data-key",a.name),v.innerHTML=a.name);g&&g.addCompletion(v)}!0===g?("string"!==
typeof d&&(d=Knodule.language||"EN"),g=!1):g&&"string"!==typeof d&&(d=Knodule.language||"EN");b="string"===typeof a&&a||a._qid||a.getQID&&a.getQID()||a.toString();e=e&&k({tagName:"INPUT",type:"CHECKBOX",name:e,value:b});var m="string"===typeof a&&a||k("span.term",b),h=a instanceof p&&k("span.variations"),q="string"===typeof a,v=k(q?"span.rawterm":"span.dterm",e," ",h,q?k("span.text","\u201c"+m+"\u201d"):m);if(d||g)u(v,"completion"),v.setAttribute("data-value",b);if("string"===typeof a)v.setAttribute("data-key",
a),g&&g.addCompletion(v);else if(a._live)c();else a.onLoad(c);return v}function r(a,b){var e=q.getText("string"===typeof a?a:a.src),e=b.handleEntries(e);(b.trace_load||Knodule.trace_load)&&m("Parsed %d entries from %s",e.length,a.src)}var g=fdjt.String,m=fdjt.Log,k=fdjt.DOM,q=fdjt.Ajax,u=k.addClass,p=Knodule.KNode;Knodule.KNode.prototype.toDOM=Knodule.KNode.prototype.toHTML=function(){var a=k(this.prime?"span.dterm.prime":this.weak?"span.dterm.weak":"span.dterm",this.dterm);this.gloss&&(a.title=g.strip_markup(this.gloss));
a.dterm=this.dterm;return a};Knodule.HTML=a;Knodule.KNode2HTML=a;Knodule.Knode2HTML=a;Knodule.knode2HTML=a;Knodule.knodeToOption=function(a){var b;if("string"===typeof a)return b=k("OPTION",a),b.setAttribute("value",a),b;b=a.dterm;a="string"===typeof a&&a||a._qid||a.getQID&&a.getQID()||a.toString();var e=document.createDocumentFragment();b=k("option",b);b.setAttribute("value",a);e.appendChild(b);return e};Knodule.HTML.Setup=function(a){a||(a=new Knodule(document.location.href));var b=new Date,e=k.getLinks("{http://knodules.org/}knodule",
!0,!0),g=0,d,c;e&&e.length||(e=k.getLinks("knodule",!0,!0));e&&e.length||(e=k.getLinks("*.knodule",!0,!0));g=0;for(d=e.length;g<d;)r(e[g++],a);e=k.getMeta("SBOOKS.knodef");for(g=0;g<e.length;)c=e[g++],"KNODEF"===c.name&&a.handleEntry(c.content);e=document.getElementsByTagName("META");g=0;for(d=e.length;g<d;)c=e[g++],"KNODEF"===c.name&&a.handleEntry(c.content);e=document.getElementsByTagName("SCRIPT");g=0;for(d=e.length;g<d;){c=e[g++];var q=c.getAttribute("language"),h=c.type;if("text/knodule"===h||
"application/knodule"===h||q&&("knodule"===q||"KNODULE"===q||"knowlet"===q||"KNOWLET"===q))c.src?r(c,a):c.text&&(c=c.text,q=c.search("<!\\[CDATA\\["),0<=q&&(h=c.search("]]\x3e"),c=c.slice(q+9,h)),c=a.handleEntries(c),(a.trace_load||Knodule.trace_load)&&m("Parsed %d inline knodule entries",c.length))}e=new Date;(a.trace_load||Knodule.trace_load)&&m("Processed knodules in %fs",(e.getTime()-b.getTime())/1E3)}})();var idbModules={};
(function(a){var r=function(){this.length=0;this._items=[]};r.prototype={contains:function(a){return-1!==this._items.indexOf(a)},item:function(a){return this._items[a]},indexOf:function(a){return this._items.indexOf(a)},push:function(a){this._items.push(a);this.length+=1},splice:function(){this._items.splice.apply(this._items,arguments);this.length=this._items.length}};a.util={throwDOMException:function(g,m,k){var q=new DOMException.constructor(0,m);q.name=g;q.message=m;q.stack=arguments.callee.caller;
a.DEBUG&&console.log(g,m,k,q);throw q;},callback:function(a,m,k,q){k.target=m;"function"===typeof m[a]&&m[a].apply(m,[k]);"function"===typeof q&&q()},quote:function(a){return"'"+a+"'"},StringList:r}})(idbModules);(function(a){var r=function(){return{encode:function(a){return JSON.stringify(a)},decode:function(a){return JSON.parse(a)}}}();a.Sca=r})(idbModules);
(function(a){var r=" number string boolean object undefined".split(" "),g=function(){return{encode:function(a){return r.indexOf(typeof a)+"-"+JSON.stringify(a)},decode:function(a){return"undefined"===typeof a?void 0:JSON.parse(a.substring(2))}}},m={number:g("number"),"boolean":g(),object:g(),string:{encode:function(a){return r.indexOf("string")+"-"+a},decode:function(a){return""+a.substring(2)}},undefined:{encode:function(a){return r.indexOf("undefined")+"-undefined"},decode:function(a){}}},g=function(){return{encode:function(a){return m[typeof a].encode(a)},
decode:function(a){return m[r[a.substring(0,1)]].decode(a)}}}();a.Key=g})(idbModules);(function(a,r){a.Event=function(a,m){return{type:a,debug:m,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}}})(idbModules);(function(a){var r=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null;this.readyState="pending"},g=function(){this.onblocked=this.onupgradeneeded=null};g.prototype=r;a.IDBRequest=r;a.IDBOpenRequest=g})(idbModules);
(function(a,r){var g=function(a,g,q,r){this.lower=a;this.upper=g;this.lowerOpen=q;this.upperOpen=r};g.only=function(a){return new g(a,a,!0,!0)};g.lowerBound=function(a,k){return new g(a,r,k,r)};g.upperBound=function(a){return new g(r,a,r,open)};g.bound=function(a,k,q,r){return new g(a,k,q,r)};a.IDBKeyRange=g})(idbModules);
(function(a,r){function g(g,k,q,u,p,f){this.__range=g;this.source=this.__idbObjectStore=q;this.__req=u;this.key=r;this.direction=k;this.__keyColumnName=p;this.__valueColumnName=f;this.source.transaction.__active||a.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active.");this.__offset=-1;this.__lastKeyContinued=r;this["continue"]()}g.prototype.__find=function(g,k,q,u){var p=this,f=["SELECT * FROM ",a.util.quote(p.__idbObjectStore.name)],b=
[];f.push("WHERE ",p.__keyColumnName," NOT NULL");p.__range&&(p.__range.lower||p.__range.upper)&&(f.push("AND"),p.__range.lower&&(f.push(p.__keyColumnName+(p.__range.lowerOpen?" >=":" >")+" ?"),b.push(a.Key.encode(p.__range.lower))),p.__range.lower&&p.__range.upper&&f.push("AND"),p.__range.upper&&(f.push(p.__keyColumnName+(p.__range.upperOpen?" <= ":" < ")+" ?"),b.push(a.Key.encode(p.__range.upper))));"undefined"!==typeof g&&(p.__lastKeyContinued=g,p.__offset=0);p.__lastKeyContinued!==r&&(f.push("AND "+
p.__keyColumnName+" >= ?"),b.push(a.Key.encode(p.__lastKeyContinued)));f.push("ORDER BY ",p.__keyColumnName);f.push("LIMIT 1 OFFSET "+p.__offset);a.DEBUG&&console.log(f.join(" "),b);k.executeSql(f.join(" "),b,function(b,f){if(1===f.rows.length){var d=a.Key.decode(f.rows.item(0)[p.__keyColumnName]),c="value"===p.__valueColumnName?a.Sca.decode(f.rows.item(0)[p.__valueColumnName]):a.Key.decode(f.rows.item(0)[p.__valueColumnName]);q(d,c)}else a.DEBUG&&console.log("Reached end of cursors"),q(r,r)},function(b,
f){a.DEBUG&&console.log("Could not execute Cursor.continue");u(f)})};g.prototype["continue"]=function(a){var g=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(q,u,p,f){g.__offset++;g.__find(a,q,function(a,e){g.key=a;g.value=e;p("undefined"!==typeof g.key?g:r,g.__req)},function(a){f(a)})})};g.prototype.advance=function(g){0>=g&&a.util.throwDOMException("Type Error - Count is invalid - 0 or negative",g);var k=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(a,
u,p,f){k.__offset+=g;k.__find(r,a,function(a,e){k.key=a;k.value=e;p("undefined"!==typeof k.key?k:r,k.__req)},function(a){f(a)})})};g.prototype.update=function(g){var k=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(q,u,p,f){k.__find(r,q,function(b,e){var l="UPDATE "+a.util.quote(k.__idbObjectStore.name)+" SET value = ? WHERE key = ?";a.DEBUG&&console.log(l,g,b);q.executeSql(l,[a.Sca.encode(g),a.Key.encode(b)],function(a,c){1===c.rowsAffected?p(b):f("No rowns with key found"+
b)},function(a,b){f(b)})},function(a){f(a)})})};g.prototype["delete"]=function(){var g=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(k,q,u,p){g.__find(r,k,function(f,b){var e="DELETE FROM  "+a.util.quote(g.__idbObjectStore.name)+" WHERE key = ?";a.DEBUG&&console.log(e,f);k.executeSql(e,[a.Key.encode(f)],function(a,b){1===b.rowsAffected?u(r):p("No rowns with key found"+f)},function(a,b){p(b)})},function(a){p(a)})})};a.IDBCursor=g})(idbModules);
(function(a,r){function g(a,g){this.indexName=a;this.__idbObjectStore=this.source=g}g.prototype.__createIndex=function(g,k,q){var r=this,p=r.__idbObjectStore.transaction;p.__addToTransactionQueue(function(f,b,e,l){r.__idbObjectStore.__getStoreProps(f,function(){function b(){a.util.throwDOMException(0,"Could not create new index",arguments)}2!==p.mode&&a.util.throwDOMException(0,"Invalid State error, not a version transaction",r.transaction);var c=JSON.parse(r.__idbObjectStore.__storeProps.indexList);
"undefined"!==typeof c[g]&&a.util.throwDOMException(0,"Index already exists on store",c);c[g]={columnName:g,keyPath:k,optionalParams:q};r.__idbObjectStore.__storeProps.indexList=JSON.stringify(c);c=["ALTER TABLE",a.util.quote(r.__idbObjectStore.name),"ADD",g,"BLOB"].join(" ");a.DEBUG&&console.log(c);f.executeSql(c,[],function(c,f){c.executeSql("SELECT * FROM "+a.util.quote(r.__idbObjectStore.name),[],function(c,f){(function G(h){if(h<f.rows.length)try{a.Sca.decode(f.rows.item(h).value);var l=eval("value['"+
k+"']");c.executeSql("UPDATE "+a.util.quote(r.__idbObjectStore.name)+" set "+g+" = ? where key = ?",[a.Key.encode(l),f.rows.item(h).key],function(a,b){G(h+1)},b)}catch(q){G(h+1)}else a.DEBUG&&console.log("Updating the indexes in table",r.__idbObjectStore.__storeProps),c.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[r.__idbObjectStore.__storeProps.indexList,r.__idbObjectStore.name],function(){r.__idbObjectStore.__setReadyState("createIndex",!0);e(r)},b)})(0)},b)},b)},"createObjectStore")})};
g.prototype.openCursor=function(g,k){var q=new a.IDBRequest;new a.IDBCursor(g,k,this.source,q,this.indexName,"value");return q};g.prototype.openKeyCursor=function(g,k){var q=new a.IDBRequest;new a.IDBCursor(g,k,this.source,q,this.indexName,"key");return q};g.prototype.__fetchIndexData=function(g,k){var q=this;return q.__idbObjectStore.transaction.__addToTransactionQueue(function(u,p,f,b){p=["SELECT * FROM ",a.util.quote(q.__idbObjectStore.name)," WHERE",q.indexName,"NOT NULL"];var e=[];"undefined"!==
typeof g&&(p.push("AND",q.indexName," = ?"),e.push(a.Key.encode(g)));a.DEBUG&&console.log("Trying to fetch data for Index",p.join(" "),e);u.executeSql(p.join(" "),e,function(b,d){var c;c="count"===typeof k?d.rows.length:0===d.rows.length?r:"key"===k?a.Key.decode(d.rows.item(0).key):a.Sca.decode(d.rows.item(0).value);f(c)},b)})};g.prototype.get=function(a){return this.__fetchIndexData(a,"value")};g.prototype.getKey=function(a){return this.__fetchIndexData(a,"key")};g.prototype.count=function(a){return this.__fetchIndexData(a,
"count")};a.IDBIndex=g})(idbModules);
(function(a){var r=function(g,m,k){this.name=g;this.transaction=m;this.__ready={};this.__setReadyState("createObjectStore","undefined"===typeof k?!0:k);this.indexNames=new a.util.StringList};r.prototype.__setReadyState=function(a,m){this.__ready[a]=m};r.prototype.__waitForReady=function(g,m){var k=!0;if("undefined"!==typeof m)k="undefined"===typeof this.__ready[m]?!0:this.__ready[m];else for(var q in this.__ready)this.__ready[q]||(k=!1);if(k)g();else{a.DEBUG&&console.log("Waiting for to be ready",
m);var r=this;window.setTimeout(function(){r.__waitForReady(g,m)},100)}};r.prototype.__getStoreProps=function(g,m,k){var q=this;this.__waitForReady(function(){q.__storeProps?(a.DEBUG&&console.log("Store properties - cached",q.__storeProps),m(q.__storeProps)):g.executeSql("SELECT * FROM __sys__ where name = ?",[q.name],function(g,k){1!==k.rows.length?m():(q.__storeProps={name:k.rows.item(0).name,indexList:k.rows.item(0).indexList,autoInc:k.rows.item(0).autoInc,keyPath:k.rows.item(0).keyPath},a.DEBUG&&
console.log("Store properties",q.__storeProps),m(q.__storeProps))},function(){m()})},k)};r.prototype.__deriveKey=function(g,m,k,q){function r(){g.executeSql("SELECT * FROM sqlite_sequence where name like ?",[p.name],function(a,b){1!==b.rows.length?q(0):q(b.rows.item(0).seq)},function(f,b){a.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",b)})}var p=this;p.__getStoreProps(g,function(f){f||a.util.throwDOMException(0,"Data Error - Could not locate defination for this table",
f);if(f.keyPath)if("undefined"!==typeof k&&a.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",f),m)try{var b=eval("value['"+f.keyPath+"']");b?q(b):"true"===f.autoInc?r():a.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(e){a.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",e)}else a.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not");else"undefined"!==typeof k?
q(k):"false"===f.autoInc?a.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",f):r()})};r.prototype.__insertData=function(g,m,k,q,r){var p={};"undefined"!==typeof k&&(p.key=a.Key.encode(k));var f=JSON.parse(this.__storeProps.indexList),b;for(b in f)try{p[f[b].columnName]=a.Key.encode(eval("value['"+f[b].keyPath+"']"))}catch(e){r(e)}var l=["INSERT INTO ",a.util.quote(this.name),"("],d=[" VALUES ("],f=[];for(b in p)l.push(b+
","),d.push("?,"),f.push(p[b]);l.push("value )");d.push("?)");f.push(a.Sca.encode(m));m=l.join(" ")+d.join(" ");a.DEBUG&&console.log("SQL for adding",m,f);g.executeSql(m,f,function(a,b){q(k)},function(a,b){r(b)})};r.prototype.add=function(a,m){var k=this;return k.transaction.__addToTransactionQueue(function(q,r,p,f){k.__deriveKey(q,a,m,function(b){k.__insertData(q,a,b,p,f)})})};r.prototype.put=function(g,m){var k=this;return k.transaction.__addToTransactionQueue(function(q,r,p,f){k.__deriveKey(q,
g,m,function(b){var e="DELETE FROM "+a.util.quote(k.name)+" where key = ?";q.executeSql(e,[a.Key.encode(b)],function(e,d){a.DEBUG&&console.log("Did the row with the",b,"exist? ",d.rowsAffected);k.__insertData(e,g,b,p,f)},function(a,b){f(b)})})})};r.prototype.get=function(g){var m=this;return m.transaction.__addToTransactionQueue(function(k,q,r,p){m.__waitForReady(function(){var f=a.Key.encode(g);a.DEBUG&&console.log("Fetching",m.name,f);k.executeSql("SELECT * FROM "+a.util.quote(m.name)+" where key = ?",
[f],function(b,e){a.DEBUG&&console.log("Fetched data",e);try{if(0===e.rows.length)return r();r(a.Sca.decode(e.rows.item(0).value))}catch(f){a.DEBUG&&console.log(f),r(void 0)}},function(a,e){p(e)})})})};r.prototype["delete"]=function(g){var m=this;return m.transaction.__addToTransactionQueue(function(k,q,r,p){m.__waitForReady(function(){var f=a.Key.encode(g);a.DEBUG&&console.log("Fetching",m.name,f);k.executeSql("DELETE FROM "+a.util.quote(m.name)+" where key = ?",[f],function(b,e){a.DEBUG&&console.log("Deleted from database",
e.rowsAffected);r()},function(a,e){p(e)})})})};r.prototype.clear=function(){var g=this;return g.transaction.__addToTransactionQueue(function(m,k,q,r){g.__waitForReady(function(){m.executeSql("DELETE FROM "+a.util.quote(g.name),[],function(g,f){a.DEBUG&&console.log("Cleared all records from database",f.rowsAffected);q()},function(a,f){r(f)})})})};r.prototype.count=function(g){var m=this;return m.transaction.__addToTransactionQueue(function(k,q,r,p){m.__waitForReady(function(){var f="SELECT * FROM "+
a.util.quote(m.name)+("undefined"!==typeof g?" WHERE key = ?":""),b=[];"undefined"!==typeof g&&b.push(a.Key.encode(g));k.executeSql(f,b,function(a,b){r(b.rows.length)},function(a,b){p(b)})})})};r.prototype.openCursor=function(g,m){var k=new a.IDBRequest;new a.IDBCursor(g,m,this,k,"key","value");return k};r.prototype.index=function(g){return new a.IDBIndex(g,this)};r.prototype.createIndex=function(g,m,k){k=k||{};this.__setReadyState("createIndex",!1);var q=new a.IDBIndex(g,this);this.__waitForReady(function(){q.__createIndex(g,
m,k)},"createObjectStore");this.indexNames.push(g);return q};r.prototype.deleteIndex=function(g){var m=new a.IDBIndex(g,this,!1);m.__deleteIndex(g);return m};a.IDBObjectStore=r})(idbModules);
(function(a){var r=function(g,m,k){if("number"===typeof m)this.mode=m,2!==m&&a.DEBUG&&console.log("Mode should be a string, but was specified as ",m);else if("string"===typeof m)switch(m){case "readonly":this.mode=1;break;case "readwrite":this.mode=0;break;default:this.mode=0}this.storeNames="string"===typeof g?[g]:g;for(g=0;g<this.storeNames.length;g++)k.objectStoreNames.contains(this.storeNames[g])||a.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",
this.storeNames[g]);this.__active=!0;this.__running=!1;this.__requests=[];this.__aborted=!1;this.db=k;this.onabort=this.onerror=this.oncomplete=this.error=null};r.prototype.__executeRequests=function(){if(this.__running&&2!==this.mode)a.DEBUG&&console.log("Looks like the request set is already running",this.mode);else{this.__running=!0;var g=this;window.setTimeout(function(){2===g.mode||g.__active||a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",
g.__active);g.db.__db.transaction(function(m){function k(b,g){g&&(r.req=g);r.req.readyState="done";r.req.result=b;delete r.req.error;var d=a.Event("success");a.util.callback("onsuccess",r.req,d);p++;f()}function q(b){r.req.readyState="done";r.req.error="DOMError";var g=a.Event("error",arguments);a.util.callback("onerror",r.req,g);p++;f()}g.__tx=m;var r=null,p=0;try{var f=function(){p>=g.__requests.length?(g.__active=!1,g.__requests=[]):(r=g.__requests[p],r.op(m,r.args,k,q))};f()}catch(b){a.DEBUG&&
console.log("An exception occured in transaction",arguments),"function"===typeof g.onerror&&g.onerror()}},function(){a.DEBUG&&console.log("An error in transaction",arguments);"function"===typeof g.onerror&&g.onerror()},function(){a.DEBUG&&console.log("Transaction completed",arguments);"function"===typeof g.oncomplete&&g.oncomplete()})},1)}};r.prototype.__addToTransactionQueue=function(g,m){this.__active||2===this.mode||a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",
this.__mode);var k=new a.IDBRequest;k.source=this.db;this.__requests.push({op:g,args:m,req:k});this.__executeRequests();return k};r.prototype.objectStore=function(g){return new a.IDBObjectStore(g,this)};r.prototype.abort=function(){!this.__active&&a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)};r.prototype.READ_ONLY=0;r.prototype.READ_WRITE=1;r.prototype.VERSION_CHANGE=2;a.IDBTransaction=r})(idbModules);
(function(a){var r=function(g,m,k,q){this.__db=g;this.version=k;this.__storeProperties=q;this.objectStoreNames=new a.util.StringList;for(g=0;g<q.rows.length;g++)this.objectStoreNames.push(q.rows.item(g).name);this.name=m;this.onabort=this.onerror=this.onversionchange=null};r.prototype.createObjectStore=function(g,m){var k=this;m=m||{};m.keyPath=m.keyPath||null;var q=new a.IDBObjectStore(g,k.__versionTransaction,!1);k.__versionTransaction.__addToTransactionQueue(function(r,p,f,b){function e(){a.util.throwDOMException(0,
"Could not create new object store",arguments)}k.__versionTransaction||a.util.throwDOMException(0,"Invalid State error",k.transaction);p=["CREATE TABLE",a.util.quote(g),"(key BLOB",m.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");a.DEBUG&&console.log(p);r.executeSql(p,[],function(a,b){a.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[g,m.keyPath,m.autoIncrement?!0:!1,"{}"],function(){q.__setReadyState("createObjectStore",!0);f(q)},e)},e)});k.objectStoreNames.push(g);
return q};r.prototype.deleteObjectStore=function(g){var m=function(){a.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},k=this;!k.objectStoreNames.contains(g)&&m("Object Store does not exist");k.objectStoreNames.splice(k.objectStoreNames.indexOf(g),1);k.__versionTransaction.__addToTransactionQueue(function(q,r,p,f){k.__versionTransaction||a.util.throwDOMException(0,"Invalid State error",k.transaction);k.__db.transaction(function(b){b.executeSql("SELECT * FROM __sys__ where name = ?",
[g],function(b,f){0<f.rows.length&&b.executeSql("DROP TABLE "+a.util.quote(g),[],function(){b.executeSql("DELETE FROM __sys__ WHERE name = ?",[g],function(){},m)},m)})})})};r.prototype.close=function(){};r.prototype.transaction=function(g,m){return new a.IDBTransaction(g,m||1,this)};a.IDBDatabase=r})(idbModules);
(function(a){if(window.openDatabase){var r=window.openDatabase("__sysdb__",1,"System Database",4194304);r.transaction(function(g){g.executeSql("SELECT * FROM dbVersions",[],function(a,g){},function(){r.transaction(function(g){g.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){},function(){a.util.throwDOMException("Could not create table __sysdb__ to save DB versions")})})})},function(){a.DEBUG&&console.log("Error in sysdb transaction - when selecting from dbVersions",
arguments)});a.shimIndexedDB={open:function(g,m){function k(){if(!p){var f=a.Event("error",arguments);u.readyState="done";u.error="DOMError";a.util.callback("onerror",u,f);p=!0}}function q(f){var b=window.openDatabase(g,1,g,4194304);u.readyState="done";"undefined"===typeof m&&(m=f||1);(0>=m||f>m)&&a.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",m);b.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",
[],function(){e.executeSql("SELECT * FROM __sys__",[],function(e,d){var c=a.Event("success");u.source=u.result=new a.IDBDatabase(b,g,m,d);f<m?r.transaction(function(b){b.executeSql("UPDATE dbVersions set version = ? where name = ?",[m,g],function(){var b=a.Event("upgradeneeded");b.oldVersion=f;b.newVersion=m;u.transaction=u.result.__versionTransaction=new a.IDBTransaction([],2,u.source);a.util.callback("onupgradeneeded",u,b,function(){var b=a.Event("success");a.util.callback("onsuccess",u,b)})},k)},
k):a.util.callback("onsuccess",u,c)},k)},k)},k)}var u=new a.IDBOpenRequest,p=!1;r.transaction(function(a){a.executeSql("SELECT * FROM dbVersions where name = ?",[g],function(a,e){0===e.rows.length?a.executeSql("INSERT INTO dbVersions VALUES (?,?)",[g,m||1],function(){q(0)},k):q(e.rows.item(0).version)},k)},k);return u},deleteDatabase:function(g){function m(f){if(!u){q.readyState="done";q.error="DOMError";var b=a.Event("error");b.message=f;b.debug=arguments;a.util.callback("onerror",q,b);u=!0}}function k(){r.transaction(function(f){f.executeSql("DELETE FROM dbVersions where name = ? ",
[g],function(){q.result=void 0;var b=a.Event("success");b.newVersion=null;b.oldVersion=p;a.util.callback("onsuccess",q,b)},m)},m)}var q=new a.IDBOpenRequest,u=!1,p=null;r.transaction(function(f){f.executeSql("SELECT * FROM dbVersions where name = ?",[g],function(b,e){if(0===e.rows.length){q.result=void 0;var f=a.Event("success");f.newVersion=null;f.oldVersion=p;a.util.callback("onsuccess",q,f)}else p=e.rows.item(0).version,window.openDatabase(g,1,g,4194304).transaction(function(b){b.executeSql("SELECT * FROM __sys__",
[],function(b,d){var e=d.rows;(function v(d){d>=e.length?b.executeSql("DROP TABLE __sys__",[],function(){k()},m):b.executeSql("DROP TABLE "+a.util.quote(e.item(d).name),[],function(){v(d+1)},function(){v(d+1)})})(0)},function(a){k()})},m)})},m);return q},cmp:function(g,m){return a.Key.encode(g)>a.Key.encode(m)?1:g===m?0:-1}}}})(idbModules);
(function(a,r){"undefined"!==typeof a.openDatabase&&(a.shimIndexedDB=r.shimIndexedDB,a.shimIndexedDB&&(a.shimIndexedDB.__useShim=function(){a.indexedDB=r.shimIndexedDB;a.IDBDatabase=r.IDBDatabase;a.IDBTransaction=r.IDBTransaction;a.IDBCursor=r.IDBCursor;a.IDBKeyRange=r.IDBKeyRange},a.shimIndexedDB.__debug=function(a){r.DEBUG=a}));a.indexedDB=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.oIndexedDB||a.msIndexedDB;"undefined"===typeof a.indexedDB&&"undefined"!==typeof a.openDatabase?a.shimIndexedDB.__useShim():
(a.IDBDatabase=a.IDBDatabase||a.webkitIDBDatabase,a.IDBTransaction=a.IDBTransaction||a.webkitIDBTransaction,a.IDBCursor=a.IDBCursor||a.webkitIDBCursor,a.IDBKeyRange=a.IDBKeyRange||a.webkitIDBKeyRange,a.IDBTransaction.READ_ONLY=a.IDBTransaction.READ_ONLY||"readonly",a.IDBTransaction.READ_WRITE=a.IDBTransaction.READ_WRITE||"readwrite")})(window,idbModules);fdjt.CodexLayout=function(){function a(a,b,c,d){d=d||b.length;c=c||0;for(var e=document.createDocumentFragment();c<d;){var f=b[c++];f?3===f.nodeType&&0===f.nodeValue.length||e.appendChild(f):c++}a.appendChild(e)}function r(a,b,c){var d=a.offsetTop,e=a.offsetLeft,f=a.offsetWidth,h=a.offsetHeight,g=b&&b.offsetParent,n=c&&aa(a);if(a===b)return{left:0,top:0,width:f,height:h};for(a=a.offsetParent;a&&(!b||a!==b&&a!==g);)d+=a.offsetTop,e+=a.offsetLeft,a=a.offsetParent;if(c){a=X(n.marginTop);b=X(n.marginRight);
c=X(n.marginBottom);var g=X(n.marginLeft),k=X(n.paddingTop),l=X(n.paddingRight),J=X(n.paddingBottom),m=X(n.paddingLeft),q=X(n.borderTopWidth),R=X(n.borderRightWidth),r=X(n.borderBottomWidth),w=X(n.borderLeftWidth),t=f+g+b,A=h+a+c,l=f-(w+m+R+l),k=h-(q+k+r+J),J=n.lineHeight,n=n.fontSize,q=!1,q="normal"===J?X(n):0<J.search(/px$/)?X(J):0<J.search(/%$/)?parseFloat(J.slice(0,-1))/100*X(n):X(n);return{left:e,top:d,width:f,height:h,right:e+f,bottom:d+h,top_margin:a,bottom_margin:c,left_margin:g,right_margin:b,
outer_height:A,outer_width:t,inner_height:k,inner_width:l,line_height:q}}return{left:e,top:d,width:f,height:h,right:e+f,bottom:d+h}}function g(a){if("string"===typeof a){var b;if(0===a.length)return!0;b=a.search(Na);if(0>b)return!0;if("&"!==a[b])return!1;a=a.replace(/&nbsp;/g,"\u00a0");b=a.search(Na);return 0>b}return!1}function m(a){var b=aa(a);return"none"===b.display||"static"!==b.position&&""!==b.position?!1:a}function k(a){if(a){if("string"===typeof a)return"."===a[0]&&0>a.slice(1).search(/\.|#|\[/)?
new RegExp("\\b"+a.slice(1)+"\\b"):new E.Selector(a);if(a instanceof RegExp||a.match)return a;if(a.length){for(var b=[],c=[],d=[],e=[],f=0,h=a.length;f<h;){var g=a[f++];"string"!==typeof g?b.push(g):"."===g[0]?0<=g.slice(1).search(/\.|#|\[/)?e.push(g):d.push(g.slice(1)):"#"===g[0]||"["===g[0]?e.push(g):d.push(g)}d.length&&c.push(new RegExp("\\b("+d.join("|")+")\\b"));e.length&&c.push(new E.Selector(e.join(", ")));return c.concat(b)}}return a}function q(a,b){var c;if(!b)return!0;c="string"===typeof b?
[b]:b instanceof Array?b:[b];for(var d=0,e=c.length;d<e;){var f=c[d++];if(a===b)return!0;if(f instanceof RegExp){if(a.className&&a.className.search&&0<=a.className.search(f))return!0}else if("string"===typeof f){if(a.className&&a.className.search&&("."===f[0]&&(f=f.slice(1)),0<=a.className.search(new RegExp("\\b"+f+"\\b"))))return!0}else if(f.match&&f.match(a))return!0}return!1}function u(a,b,c,d){"string"===typeof a&&(a=P(a));if(a&&0!==a.length)if(a.nodeType){if(1===a.nodeType&&!C(a,"_pagescaled")&&
!a.getAttribute("style")){var e=a.getAttribute("data-pagescale")||a.getAttribute("pagescale")||ka(a,"xdatapagescale"),f=1,h=1,g=a.style,n=aa(a);if(!g[E.transform]||"none"===g[E.transform]||""===g[E.transform]){e&&(h=e.split(/ |,|x/g),2===h.length?(f=p(h[0]),h=p(h[1])):h=f=p(h[0]));b*=f;c*=h;var e=a.offsetWidth,k=a.offsetHeight,f=b/e,h=c/k;"IMG"===a.tagName?(g.maxHeight=g.minHeight="inherit",g.maxWidth=g.minWidth="inherit",e=a.offsetWidth,k=a.offsetHeight,f=b/e,h=c/k,f<h?(g.width=Math.round(e*f)+"px",
g.height="auto"):(g.height=Math.round(k*h)+"px",g.width="auto")):d?(d="inline"===n.display?E("span.codexscalewrapper"):E("div.codexscalewrapper"),"inline"===n.display&&(g.display="inline-block",d.display="inline-block"),d.style.width=b+"px",d.style.height=c+"px",a.style[E.transform]="scale("+f+","+h+")",a.style[E.transformOrigin]="left"===n.textAlign?"top left":"right"===n.textAlign?"top right":"top center",a.parentNode.replaceChild(d,a)):(bb(a),"inline"===n.display&&(g.display="inline-block"),g.width=
b+"px",g.height=c+"px");Z(a,"_pagescaled")}}}else if(a.length)for(g=0,n=a.length;g<n;)u(a[g++],b,c,d||!1)}function p(a){return 0<a.search(/%$/g)?parseFloat(a.slice(0,a.length-1))/100:parseFloat(a)}function f(a,b,c){c||(c=document.body);for(;a;){if(a===b)return!0;if(a===c)return!1;if(a.previousSibling)if(3===a.previousSibling.nodeType&&g(a.previousSibling.nodeValue))a=a.previousSibling;else if(1!==a.previousSibling.nodeType||m(a.previousSibling))break;else a=a.previousSibling;else a=a.parentNode}return 1===
a.nodeType&&a.className&&a.className.search&&0<=a.className.search(/\bcodexpage\b/g)}function b(a,c,d,f){if(a===document.body||"CODEXCONTENT"===a.id||C(a,"codexroot")||C(a,"codexpage"))return!1;if(t(a,c))return a;if(a.className&&a.className.search&&0<=a.className.search(/\bcodexwraptext\b/))return b(a.parentNode,c,d,f);var h=a.id,g=a.getAttribute("data-baseid");h||(h=g);var n=d[h],k=n&&n.length&&n[n.length-1];if(!h)h=a.id="CODEXTMPID"+Wa++;else if(n)for(var l=n.length-1;0<=l;){if(t(n[l],c))return n[l];
l--}l=a.cloneNode(!1);f=b(a.parentNode,c,d,f);var J=a.className&&a.className.search&&a.className||"",m=k&&k.className&&k.className.search&&k.className;g&&(l.codexbaseid=g);0<=J.search(/\bcodexdupend\b/g)?(a.className=J.replace(/\bcodexdupend\b/g,"codexdup"),e(a,!0)):0>J.search(/\bcodexdupstart\b/g)&&(a.className=J+" codexdupstart",e(a,!0),a=l.style,l.hasAttribute("data-savedstyle")||l.setAttribute("data-savedstyle",a.cssText),a.textIndent="0px",a.paddingTop="0px",a.borderTopWidth="0px",a.marginTop=
"0px",l.className=J.replace(/\bcodexrelocated\b/g,"")+" codexdupend");m&&0<=m.search(/\bcodexdupend\b/g)&&(k.className=m.replace(/\bcodexdupend\b/g,"codexdup"),e(k,!0));h&&(l.codexbaseid=h,l.setAttribute("data-baseid",h),l.removeAttribute("id"));n?n.push(l):d[h]=[l];f?f.appendChild(l):c.appendChild(l);return l}function e(a,b){var c=a.style;b&&!a.hasAttribute("data-savedstyle")&&a.setAttribute("data-savedstyle",c.cssText);c.paddingBottom="0px";c.borderBottomWidth="0px";c.marginBottom="0px"}function l(a){for(a=
a.firstChild;a;){if(3===a.nodeType&&!g(a.nodeValue)||1===a.nodeType&&m(a))return a;a=a.nextSibling}return!1}function d(a,b,c,d){var e,f=!1;if(t(a,b))return a;1===a.nodeType?(e=a.className)&&"string"!==typeof e&&(f=!0):3===a.nodeType&&(0<=a.nodeValue.search(/\w/g)?(c=E(c?"div.codexwraptext":"span.codexwraptext"),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a),e="codexwraptext",a=c):a=a.cloneNode(!0));f||1===a.nodeType&&C(a,"codextextsplit")||!a.parentNode||a.id&&d[a.id]||(a.id||(a.id=
"CODEXTMPID"+Wa++),c=document.createTextNode(""),d[a.id]=c,a.className=e?e+" codexrelocated":"codexrelocated",a.parentNode.replaceChild(c,a));if(b){d=[];for(e=a.nextSibling;e&&!(1===e.nodeType&&"string"===typeof e.className&&0<=e.className.search(/\bcodexblock\b/g));)d.push(e),e=e.nextSibling;b.appendChild(a);if(d.length)for(e=0,c=d.length;e<c;)b.appendChild(d[e++])}return a}function c(a,b){if(b||!C(a,"codexpagetop"))if(!a.namespaceURI||a.namespaceURI===R){var d=a.getAttribute("style")||"",e=d+(d?
"; ":"")+"margin-top: 0px !important;";a.hasAttribute("data-savedstyle")||a.setAttribute("data-savedstyle",d);a.setAttribute("style",e);Z(a,"codexpagetop");if(a.childNodes)for(var d=a.childNodes,e=0,f=d.length;e<f;){var h=d[e++];if(1===h.nodeType){var n=aa(h);if(!("static"!==n.position&&""!==n.position||h.classname&&0<=h.className.search(/\bfdjtskiptext\b/g)))return c(h)}else if(3===h.nodeType&&!g(h.nodeValue))break}}}function z(a,e,f,h){if(t(a,e))1!==a.nodeType||S(e,!0,!1,a)||c(a);else{for(var g=
a,n=g.parentNode;n&&n!==document.body&&"CODEXCONTENT"!==n.id&&!C(n,"codexroot")&&!C(n,"codexpage")&&g===l(n);)g=n,n=g.parentNode;!n||n===document.body||"CODEXCONTENT"===n.id||C(n,"codexroot")||C(n,"codexpage")?g===a?a=g=d(a,e,!1,h):g=d(g,e,!1,h):(f=b(n,e,f,h),g===a?a=g=d(a,f||e,!1,h):g=d(g,f||e,!1,h));a&&1===a.nodeType&&!S(e,!0,!1,g)&&c(g)}return a}function h(b){function n(){}function l(a){db&&(3<db||gb&&gb.match(a))&&Ca("Moving node %o to page %o",a,ba);return z(a,ba,fb,ca)}function J(a){for(var b=
0,c=a.length;b<c;){var d=a[b++],e=d.style.height;if(!(e&&""!==e&&"inherit"!==e&&"initial"!==e&&"auto"!==e||C(d,"codexoversize"))){d.style.height="auto";d.style.display="block";e=d.scrollHeight;if(!(e<qa)){var f=aa(d),f=qa+X(f.paddingTop)+X(f.paddingBottom);e>f&&Z(d,"codexoversize")}d.style.height="";d.style.display="";(e=Pa(d,".codexraggedsplit"))&&e.appendChild(E("span.codexdupleading.fdjtskiptext","leading"));d=ab(d,".codexblock");e=0;for(f=d.length;e<f;){var h=d[e++];ja(h,"codexblock");ja(h,"codexterminal")}}}}
function R(a,b,c,d,e,f){if(1===a.nodeType){var h=a.className;if("string"===typeof h){if(0<=h.search(/\bcodexdupstart\b/))e[a.id]||(e[a.id]=a,d.push(a.id),b.push(a.id));else if(0<=h.search(/\b(codexdup|codexdupend)\b/)){if(h=a.getAttribute("data-baseid"))a.codexbaseid=h,c[h]?c[h].push(a):c[h]=[a]}else a.id&&0<=h.search(/\bcodexrestore\b/)&&!f[a.id]&&(b.push(a.id),f[a.id]=a);if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var h=0,g=a.length;h<g;){var n=a[h++];1===n.nodeType&&R(n,b,c,d,e,f)}}}}}
function w(a){return new Promise(function(b,d){try{var e=document.createElement("div"),f=[],h={},g=[],n={},k={},l=[],J={},m=[];db&&F("Setting layout to %d characters of HTML",a.length);e.innerHTML=a;var la=e.childNodes,q=[];db&&F("Gathering layout info");for(var e=0,w=la.length;e<w;){var r=la[e++];q.push(r);1===r.nodeType&&(r.className&&r.className.search&&0<=r.className.search(/\bcurpage\b/)&&ja(r,"curpage"),R(r,f,J,g,n,k))}n={};db&&F("Getting originals by ID");e=0;for(w=f.length;e<w;){var t=f[e++];
n[t]=document.getElementById(t)}la=t=!1;db&&F("Moving body and container out of document");Ha&&Ha.parentNode&&(t=document.createTextNode(""),Ha.parentNode.replaceChild(t,Ha));Ia.parentNode&&(la=document.createTextNode(""),Ia.parentNode.replaceChild(la,Ia));db&&F("Moving originals into layout");e=0;for(w=f.length;e<w;){var A=f[e++],p=n[A],v=k[A];if(v&&p){var T=v.className,O=v.getAttribute("style"),L=p.getAttribute("style"),ib=p.className,x=document.createTextNode(""),T=T.replace(/\bcodexrestore\b/,
"");nb(p,x);ca[A]=x;nb(v,p);T&&T!==ib&&(ib&&"string"===typeof ib&&p.setAttribute("data-savedclass",ib),p.className=T);O!==L&&(L&&p.setAttribute("data-savedstyle",L),p.setAttribute("style",O));0<=T.search(/\bcodexpagetop\b/)&&c(p,!0)}else p&&(h[A]=p,p.id&&p.removeAttribute("id"))}db&&F("Gathering lostids");for(var U=M.lostids={},ta=U._all_ids=[],e=0,w=g.length;e<w;){var y=g[e++],C=n[y];C&&(U[y]=C,ta.push(y),C.id&&C.removeAttribute("id"))}db&&F("Moving nodes around");for(var E=Ia.childNodes,e=0,w=E.length;e<
w;)l.push(E[e++]);for(e=0;e<w;)Ia.removeChild(l[e++]);e=0;for(w=q.length;e<w;){var z=q[e++],ua=ab(z,"[pagescale],[data-pagescale]");ua.length&&m.push({page:z,toscale:ua});Ia.appendChild(z)}M.pages=q;fb=M.dups=J;h._all_ids=f;M.saved_ids=h;M.page=q[0];M.pagenum=parseInt(M.page.getAttribute("data-pagenum"),10);db&&F("Moving origin/container back to document");la&&la.parentNode.replaceChild(Ia,la);t&&t.parentNode.replaceChild(Ha,t);for(var B=ab(Ia,".codexsplitstart"),f=0,D=B.length;f<D;){var X=B[f++],
Pa=X.id,sa=X.getAttribute("data-textsplit");Pa&&sa&&(hb[Pa]=document.createTextNode(sa),X.removeAttribute("data-textsplit"))}e=0;for(w=m.length;e<w;){var jb=m[e++],H=jb.page;H.style.opacity=0;H.style.display="block";u(jb.toscale,Ja,qa);H.style.display="";H.style.opacity=""}}catch(P){d&&d(P);return}db&&F("Done restoring layout");return b?b(M):M})}function p(a,b){x(b.layout_id,a.id).then(function(b){a.innerHTML=b.content},a.id)}function v(a,b){if(1===a.nodeType){if(a.id){var c=a.className;if(!(c&&"string"===
typeof c&&0<=c.search(/\bcodexdup/g))&&a.id&&0!==a.id.search("CODEXTMP")){c=document.createElement(a.tagName);a.id&&(c.id=a.id);c.className="string"===typeof a.className?a.className+" codexrestore":"codexrestore";a.getAttribute("style")&&c.setAttribute("style",a.getAttribute("style"));a.parentNode.replaceChild(c,a);if(b&&b&&1===a.nodeType){var c=a.childNodes,d=[];if(c){for(var e=0,f=c.length;e<f;){var h=c[e++];1===h.nodeType&&b.match(h)&&d.push(h)}e=0;for(f=d.length;e<f;)a.removeChild(d[e++])}}return}}c=
a.childNodes;d=[];e=0;for(f=c.length;e<f;)h=c[e++],1===h.nodeType&&(b&&b.match(h)?d.push(h):v(h,b));e=0;for(f=d.length;e<f;)a.removeChild(d[e++])}}function T(a,b,c){function d(){M.done=L();b&&b(M);if(M.thenfns&&M.thenfns.length)for(var a=M.thenfns,c=0,e=a.length;c<e;)a[c++](M);return M}var e=!1;if(a)if(a.hasOwnProperty("npages"))e=M.setLayout(a);else if(a.hasOwnProperty("layout"))e=M.setLayout(a.layout);else if(0<=a.indexOf("<"))e=M.setLayout(a);else return a=O.getLocal(a),M?M.setLayout(a,d):!1;else return F.warn("Falsy arg %s to restoreLayout",
a),c(Error("Falsy arg to restoreLayout")),M;return e.then(d).catch(c)}function y(a){if(!(2>a.length)){for(var b=[],c=0,d=a.length,e=0;c<d;){var f=a[c++],h=Q(f,".codexpage"),h=h&&parseInt(h.getAttribute("data-pagenum"),10);b.push({list:f,pageno:h})}b.sort(function(a,b){return a.pageno>b.pageno?1:a.pageno<b.pageno?-1:0});c=0;for(d=b.length;c<d;)a=b[c++].list,f=B(a),e&&ua(a,e),e+=f}}function ua(a,b){for(var c=document.createDocumentFragment();0<b;){var d=E("LI","empty");d.setAttribute("style","visibility: hidden !important; width: 0px !important; height: 0px !important; pointer-events: none;");
c.appendChild(d);b--}a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}function B(a,b){b||(b=0);for(var c=a.childNodes,d=0,e=c.length;d<e;){var f=c[d++];if(1===f.nodeType)if("OL"===f.tagName||"UL"===f.tagName)break;else"LI"===f.tagName?b++:b=B(f,b)}return b}function G(a,b){if(!a||1!==a.nodeType)return!1;b||(b=aa(a));return"always"===b.pageBreakBefore}function N(a){if(G(a))return!0;if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=0,c=a.length;b<c;){var d=a[b];if(3===d.nodeType)if(g(d.nodeValue))b++;
else break;else{if(1===d.nodeType)return N(d);b++}}return!1}}function ka(a,b){if(!a||1!==a.nodeType)return!1;b||(b=aa(a));return"always"===b.pageBreakAfter}function bb(a){if(ka(a))return!0;if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=a.length-1;0<=b;){var c=a[b];if(3===c.nodeType)if(g(c.nodeValue))b--;else break;else{if(1===c.nodeType)return bb(c);b--}}return!1}}function Na(a,b){var c;if(!a||1!==a.nodeType)return!1;if("IMG"===a.tagName)return!0;b||(b=aa(a));return"avoid"===b.pageBreakInside||
"table-row"===b.display||"block"===b.display&&(c=X(b.lineHeight))&&2.5*c>a.offsetHeight}function xa(a){if(!Na(a)&&a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=0,c=a.length;b<c;){var d=a[b];if(1===d.nodeType&&(G(d)||ka(d)||xa(d)))return!0;b++}}return!1}function na(a,b){if(!a||1!==a.nodeType)return!1;b||(b=aa(a));return"avoid"===b.pageBreakBefore}function Ra(a){if(na(a))return!0;if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=0,c=a.length;b<c;){var d=a[b];if(3===d.nodeType)if(g(d.nodeValue))b++;
else break;else{if(1===d.nodeType)return Ra(d);b++}}return!1}}function ya(a,b){if(!a||1!==a.nodeType)return!1;if(/H\d/.exec(a.tagName))return!0;b||(b=aa(a));return"avoid"===b.pageBreakAfter?!0:!1}function pa(a){if(ya(a))return!0;if(a.childNodes&&a.childNodes.length){a=a.childNodes;for(var b=a.length-1;0<=b;){var c=a[b];if(3===c.nodeType)if(g(c.nodeValue))b--;else break;else{if(1===c.nodeType)return pa(c);b--}}return!1}}function W(a,b){if(!a||1!==a.nodeType)return!1;if(C("codexsinglepage")||C("codexfullpage"))return!0;
b||(b=aa(a));return"always"===b.pageBreakBefore&&"always"===b.pageBreakAfter&&"avoid"===b.pageBreakInside}function Fa(a){if(a){if("number"===typeof a)return P(Ya+a);if(a.nodeType)return C(a,"codexpage")?a:Q(a,".codexpage");if("string"===typeof a)return Fa(P(a));Ca("Can't determine page from %o",a)}return!1}b||(b={});var M=this;this.init=b;this.thenfns=[];var Y=this.fullpages=k(b.fullpages||!1),ma=this.singlepages=k(b.singlepages||!1),Ba=this.floatpages=k(b.floatpages||!1),Ta=this.floatblocks=k(b.floatblocks||
!1),Ya=this.pageprefix=b.pageprefix||"CODEXPAGE",qa=this.height=b.page_height||E.viewHeight(),Ja=this.width=b.page_width||E.viewWidth();this.orientation=b.orientation||(Ja>qa?"landscape":"portrait");var La=b.pagefn||!1,Ma=!1;this.serialize=function(a){Ma="undefined"===typeof a?!0:a};var wa=b.hasOwnProperty("short_page_height")&&b.short_page_height&&(1>=b.short_page_height?qa*b.short_page_height:b.short_page_height),$a=this.break_blocks="undefined"===typeof b.break_blocks?!0:b.break_blocks,ia=b.atomic||
!1;"string"===typeof ia?ia=E.selector(ia):ia.length&&ia.join&&(ia=E.selector(ia.join(",")));this.atomic=ia;this.dontsave=b.dontsave||!1;var Za=this.scale_pages=("undefined"===typeof b.use_scaling?!0:b.use_scaling)&&("undefined"===typeof b.scale_pages?!0:b.scale_pages),Ia=this.container=b.container||E("div.codexpages"),Ha=this.origin=b.origin||!1,Ca=this.logfn=b.logfn||h.logfn||("undefined"!==typeof F?F:n),Da=this.pagenum=0,Sa=this.pages=[],fb=this.dups={},ca=this.crumbs={};this.root=!1;var hb=this.textsplits=
{},Ea=this.splits={},ba=this.page=b.page,la=this.prev=!1,ib=this.prevstyle=!1,ta=this.drag=[],jb=this.floating=[];b.layout_id&&(this.layout_id=b.layout_id);this.started=!1;var db=this.tracelevel=b.tracelevel||h.tracelevel||O.getLocal("codexlayout.trace",!0)||0,gb=b.track||h.track||O.getLocal("codexlayout.track")||!1;gb?(this.track=gb=E.Selector(gb),db||(db=this.tracelevel=1)):this.track=!1;this.roots=b.roots||[];this.block_count=this.root_count=0;this.lastid=!1;this.timeslice=b.hasOwnProperty("timeslice")?
b.timeslice:h.timeslice;this.timeskip=b.hasOwnProperty("timeskip")?b.timeskip:h.timeskip;var qb=this.pagerule=b.pagerule||!1;this.addContent=function(b,c,e,h,n,k){function w(){var a=I[Oa],c=ha[Oa],d=K[Oa]||!1,e=I[Oa+1],g=!1;a.id&&(M.lastid=a.id);h&&a&&(3<h||gb&&gb.match(a))&&(Ca("Considering block %o (#%d from %o); page=%o",a,Oa,b,ba),g=!0);var n=a;!n||la&&0>ta.indexOf(la)||(la&&f(la)?ta.length&&(M.drag=ta=[]):la&&d&&na(n,c)?0>ta.indexOf(la)&&ta.push(la):la&&ya(la,ib)?0>ta.indexOf(la)&&ta.push(la):
ta.length&&(M.drag=ta=[]));a&&(C(a,/\bcodexfloatpage\b/)||Ta&&q(a,Ta)||Ba&&q(a,Ba)?(jb.push(a),a=!1):W(a,c)?(x(a),x(),a=!1):ba.childNodes.length&&(G(a,c)||la&&ka(la,ib)||la&&(C(la,/\b(codexfullpage|codexsinglepage)\b/)||Y&&q(la,Y)||ma&&q(la,ma)))?(M.drag=ta=[],a=x(a)||a):a=l(a));if(a){var n=r(a,ba),k=X(c.lineHeight),J=X(c.paddingBottom);h&&(3<h||gb&&gb.match(a))&&Ca("Layout/geom %o %j",a,n);if(n.bottom-J>qa||e&&n.height>3*k&&.9<(qa-n.bottom)/qa&&n.bottom+r(e).height>qa&&!Na(a,c)&&Na(e)&&na(e))e=qa,
n.bottom-J<=qa&&(e=n.bottom-J-2*k),d?(wa?n.top>wa:n.top>e-1.2*k)&&0===ta.length&&!na(a,c)?a=x(a):C(a,"codexfloat")||Ta&&Ta.match(a)?(jb.push(a),Oa++):!$a||ia&&ia.match(a)||Na(a,c)||C(a,"codexcantsplit")?(g=a,e=n,n=ba,k=!1,ta.length&&f(ta[0],ba)?!ya(g,c)&&1<(e.bottom-qa)/qa&&.2>(e.bottom-qa)/qa?(Z(ba,"codexoversize"),M.drag=ta=[],x(),g=!1):(M.drag=ta=[],k=x(g),g=ba===n?!1:!$a||ia&&ia.match(k)||Na(k)||C(k,"codexcantsplit")?!1:k):(k=x(g),g=ba===n?!1:!$a||ia&&ia.match(k)||Na(k)||C(k,"codexcantsplit")?
!1:k),g?a=g:Oa++):(g&&Ca("Splitting block %o @ %o",a,ba),(g=y(a,c,e))&&g!==a?I[Oa]=g:(n=r(a,ba),n.bottom>qa&&(Z(ba,"codexoversize"),M.drag=ta=[],x()),Oa++),M.drag=ta=[]):(g&&Ca("Oversize non-terminal %o, continuing",a),Oa++);else{if(ya(a,c)&&!f(a,ba)){if(0===ta.length||0>ta.indexOf(a))g&&Ca("Possibly dragging %o",a),ta.push(a)}else M.drag=ta=[];Oa++}d&&(M.prev=la=a,M.prevstyle=ib=c)}else Oa++}function R(a,b,c,d,e,f){if(!(1!==b.nodeType||b.codexui||(f||(f=aa(b)),"static"!==f.position&&""!==f.position||
f.float&&"none"!==f.float))){if(ia&&ia.match(b)||"table-row"===f.display||Na(b,f)){b.offsetWidth>Ja&&u(b,Ja,b.offsetWidth/Ja*b.offsetHeight,!0);if(0===b.offsetHeight||b.offsetHeight&&b.offsetHeight<2*qa){Z(b,"codexblock");c.push(b);e.push(f);d.push(b);l(b);v(b,a);return}b.childNodes&&b.childNodes.length&&(F.warn("Allowing split of huge (%d) block %o",b.offsetHeight,b),b.style.pageBreakInside="auto",f=aa(b))}var h=f.display;if("BR"!==b.tagName&&"inline"!==h&&"table-row"!==h&&"table-cell"!==h){var g=
c.length;Z(b,"codexblock");c.push(b);e.push(f);d.push(!1);if("block"===h||"table"===h||"table-row-group"===h){f=b.childNodes;for(var h=c.length,n=0,k=f.length;n<k;){var J=f[n++];1===J.nodeType&&R(a,J,c,d,e)}c.length===h&&(d[g]=b)}else d[g]=b;d[g]&&v(b,a);l(b)}else if("static"===f.position&&"A"===b.tagName){g=b.childNodes;f=0;for(h=g.length;f<h;)n=g[f++],1===n.nodeType&&(k=aa(n),"inline"!==k.display&&R(a,n,c,d,e,k));l(b)}}}function p(a){for(a=a.nextSibling;a;)if(3!==a.nodeType||g(a.nodeValue)){if(1===
a.nodeType&&m(a))return!1;a=a.nextSibling}else return!1;return!0}function A(a){for(a=a.previousSibling;a;)if(3!==a.nodeType&&g(a.nodeValue)){if(1===a.nodeType&&m(a))return!1;a=a.previousSibling}else return!1;return!0}function v(a,b){if(!C(a,"codexterminal")){for(var c=a,d=document.body,e=[c],f=c.parentNode;f&&f!==d&&c!==b&&p(c);)e.push(f),c=f,f=c.parentNode;for(var d=a,f=document.body,c=[d],h=d.parentNode;h&&h!==f&&d!==b&&A(d);)c.push(h),d=h,h=d.parentNode;var g=h=f=d=!1,n=0,k=e.length;if(1<k)for(;n<
k;)ya(e[n])&&(h=!0),ka(e[n])&&(g=!0),n++;n=0;k=c.length;if(1<k)for(;n<k;)na(c[n])&&(d=!0),G(c[n])&&(f=!0),n++;h&&g||(h?Z(e,"AVOIDBREAKAFTER"):g&&Z(e,"FORCEBREAKAFTER"));d&&f||(d?Z(c,"AVOIDBREAKBEFORE"):f&&Z(c,"FORCEBREAKBEFORE"));Z(a,"codexterminal")}}function T(a){if(3===a.nodeType)return 0>a.nodeValue.search(/\S/);if(1===a.nodeType){if(a.childNodes&&0!==a.childNodes.length){a=a.childNodes;for(var b=0,c=a.length;b<c;)if(!T(a[b++]))return!1;return!0}return a.offsetHeight?!1:!0}return!1}function O(a){if(ba){if(a&&
t(a,ba)){var b;if(!(b=ba.firstChild===a))a:{b=ba;for(var c=a;c;)if(c===b){b=!0;break a}else{if(c.previousSibling)for(var d=c.previousSibling;d;)if(T(d)||1===d.nodeType&&!m(d))c=d,d=c.previousSibling;else{b=!1;break a}c=c.parentNode}b=!1}return b?!1:1===a.nodeType&&0===r(a,ba).top&&"BR"!==a.tagName?!1:!0}return S(ba,!0)}return!0}function x(a,c){var d,e;if(ta&&ta.length&&ta.length&&f(ta[0]))return Ca("Ignored call for new page @%d due to excessive drag",Da),a&&l(a),!1;if(!a&&!c&&ba&&0===ba.childNodes.length)return a?
Ca("Ignored call for new page for %o on empty page %d",a,Da):Ca("Ignored call for new page on empty page %d",a,Da),!1;a&&3===a.nodeType&&(d=a.parentNode)&&1===d.childNodes.length&&d!==document.body&&d!==b&&!C(d,"codexpage")&&(a=d);if(a&&!c&&!O(a))return l(a);if(jb&&jb.length){var g=jb;jb=[];var n=ba;d=0;for(e=g.length;d<e;){var k=g[d++],J=!1;W(k)?(x(k),n=ba,c=!0):n===ba?(x(k),J=r(k,ba),J.bottom>qa&&(Z(ba,"codexoversize"),n=ba)):(z(k,ba),J=r(k,D),J.bottom>=qa&&x(k))}}if(!a||c||O(a))ba&&(La&&La.call(M,
ba,M),ba.style.height="",ja(ba,"codexworkpage")),M.page=ba=E("div.codexpage.codexworkpage"),Pa.push(ba),qb||(ba.style.height=qa+"px",ba.style.width=Ja+"px"),ba.style.height="inherit",Da++,M.pagenum=Da,ba.id=Ya+Da,ba.setAttribute("data-pagenum",Da),E(Ia,ba),M.prev=la=!1,Sa.push(ba);h&&(2<h||gb&&a&&gb.match(a))&&(a?Ca("Layout/%s %o at %o",D,ba,a):Ca("Layout/%s %o",D,ba));if(ta&&ta.length){d=0;for(e=ta.length;d<e;)l(ta[d++]);a?(d=a,e=K&&K[Oa],d&&ta.length&&e&&(1===ta.length||na(d)||ya(ta[ta.length-1])?
0>ta.indexOf(d)&&ta.push(d):M.drag=ta=[])):(M.prev=la=ta[ta.length-1],M.drag=ta=[])}return a?l(a):!1}function y(b,c,e){e||(e=qa);c||(c=aa(b));if(!$a||Na(b,c)||!b.childNodes||0===b.childNodes.length)return Z(b,"codexcantsplit"),x(b),b;b.id&&0!==b.id.search("CODEXTMP")&&(Ea[b.id]||(Ea[b.id]=b.cloneNode(!0)));c=r(b,ba,!0);var f=c.line_height||12;if(e===qa&&c.top+c.top_margin+1.2*f>qa){e=ba;var g=x(b);if(e!==ba)return g;e=qa+sa(1.2*f)}g=U(b.childNodes);b.innerHTML="";if(r(b,ba).bottom>e)return a(b,g),
Z(b,"codexcantsplit"),x(b),b;e===qa&&c.bottom-qa<1.2*f&&c.height>3*f&&(e=qa-sa(1.2*f));if(c=ua(b,g,c,e)){if(c===b)return a(b,g),Z(b,"codexcantsplit"),x(b),b;f=c[0];M.drag=ta=[];f=x(f);e=f.parentNode;if(C(b,"codexdup")||C(b,"codexdupend"))a(e,c,1);else{var g=1,n=void 0,k=[];g||(g=0);n||(n=c.length);for(;g<n;)k.push(c[g++]);g=0;for(n=k.length;g<n;)d(k[g++],e,!1,ca)}1<h&&Ca("Layout/splitBlock %o @ %o into %o on %o",b,f,e,ba);return e}F("Tried to break %o which didn't need breaking",b);a(b,g);return b}
function ua(b,c,d,e){var f=!1,h=!1,g=-1,n=!1,k=!1;e||(e=qa);var l=d||r(b,ba);if(1===c.length)f=c[0],g=0,h=f.nodeType,b.appendChild(f);else for(k=0,d=c.length;k<d;){var J=c[k++];b.innerHTML="";a(b,c,0,k);l=r(b,ba);if(l.bottom>e){f=J;h=J.nodeType;g=k-1;break}}if(f)if(3===h)n=f,k=b;else{if(1!==h)return 0===g?b:c.slice(g);if(1===f.childNodes.length&&3===f.childNodes[0].nodeType)n=f.childNodes[0],k=f;else{if(0!==g&&S(b,!0,!1,f))return c.slice(g);a(b,c,g+1);return b}}else return!1;d=J=n;for(var l=n.nodeValue.split(/(\s+)/mg),
la=[],m=!1,q=0,w=l.length;q<w;){var R=l[q++],t;0<=(t=R.search(/\s/))?0===t?(m&&la.push(m),m=q<w?R+l[q++]:R):(m?la.push(m+R):la.push(R),m=!1):m=m?m+R:R}m&&la.push(m);if(2>la.length)return 0===g?b:c.slice(g);m=document.createTextNode(la[0]);k.replaceChild(m,J);J=m;l=r(b,ba);if(l.bottom>e)return k.replaceChild(d,J),c.slice(g);k.replaceChild(n,m);J=n;l=k;m=J;q=la.length;w=0;R=!1;t=m;for(var p=!1;w<q;){var A=w+sa((q-w)/2),p=document.createTextNode(la.slice(0,A).join(""));l.replaceChild(p,t);t=p;p=r(b,
ba);if(p.bottom>e)q=A-1;else{p=document.createTextNode(la[A]);l.appendChild(p);var v=r(b,ba);l.removeChild(p);if(v.bottom>e){R=A;break}else w=A+1}}!1===R&&(R=w);m!==t&&l.replaceChild(m,t);e=R;if(0===e||e===la.length-1)return k.replaceChild(n,J),0===g?b:c.slice(g);n=la.slice(0,e).join("");e=la.slice(e).join("");la=!1;3===h?(l=E("span.codexsplitstart.codexraggedsplit"),la=l.id="CODEXTMPID"+Wa++,h=E("span.codextextsplit")):C(f,"codextextsplit")?(l=f,l.innerHTML="",k=b,J=l,h=f.cloneNode(!0),Z(f,"codexraggedsplit"),
h.id=""):(l=E("span.codexsplitstart"),h=f.cloneNode(!0),l.id?h.id="":la=l.id="CODEXTMPID"+Wa++);l.appendChild(document.createTextNode(n));h.innerHTML="";h.appendChild(document.createTextNode(e));l!==J&&k.replaceChild(l,J);c=c.slice(g);c[0]=h;a(b,c);la&&(hb[la]=d);return c}function B(){for(var a=L();Oa<V&&(!c||Ma||L()-a<c);)w();n&&n(M);Oa<V?c?M.timer=setTimeout(B,e||c):B():(a=I[V-1],(ka(a)||C(a,/\bcodexfullpage\b/)||Y&&q(a,Y))&&x(),M.timer&&clearTimeout(M.timer),M.timer=!1,M.root=!1,J(Pa),Pa=[],k&&
(c?setTimeout(function(){k(M)},10):k(M)))}var D=!1,Pa=ba?[ba]:[],H=L();ba||(x(),D=!0);c&&"number"!==typeof c&&(c=M.timeslice);e&&"number"!==typeof e&&(e=M.timeskip);"undefined"===typeof h&&(h=M.tracelevel);"undefined"===typeof n&&(n=M.progressfn||!1);M.started||(M.started=H);if(Q(b,".codexpage"))return J(Pa),Pa=[],k&&k(M),!1;M.roots.push(b);M.root_count++;var P=(H=C(b,"codexfullpage")||Y&&q(b,Y))||C(b,"codexsinglepage")||W(b);if(H||P)Na(b)||(H=P=!1);D?b=l(b):P?x(b):b=N(b)||la&&bb(la)?x(b):l(b);var db=
ab(b,"[data-pagescale],[pagescale]");u(db,Ja,qa);"IMG"===b.tagName&&(H||P)&&eb(b,Ja,qa);if(P)P=ba.scrollWidth,db=ba.scrollHeight,P>Ja||db>qa?Z(ba,"codexoversize"):H&&P<.9*Ja&&db<.9*qa&&Z(ba,"codexundersize"),x(),la=M.prev=b,ib=M.prevstyle=aa(b),J(Pa),Pa=[],ta=[],k&&k(M);else{H=r(b,ba);P=!1;if(!xa(b))if(H.bottom<=qa)Ra(b)?ta.push(b):ta=pa(b)?[b]:[],P=!0;else if(ia&&ia.match(b)||Na(b))D||(x(b),H=r(b,ba)),H.bottom<=qa&&(ta=pa(b)?[b]:[],P=!0);if(P)la=M.prev=b,ib=M.prevstyle=aa(b),J(Pa),Pa=[],k&&k(M);
else{var I=[],K=[],ha=[];R(b,b,I,K,ha);M.block_count+=I.length;1<h&&Ca("Laying out %d blocks from %o; page=%o",I.length,b,ba);if(0===I.length)D||x(b),M.root=!1,J(Pa),Pa=[],k&&k(M);else{M.root=b;var Oa=0,V=I.length;if(c)B();else{for(;Oa<V;)w();J(Pa);k&&k(M)}return M}}}};var nb=E.replace;M.setLayout=function(a){return"string"===typeof a?w(a):a.hasOwnProperty("npages")?(Ia.innerHTML=a.layout,A.slowmap(function(b){p(b,a)},Ia.childNodes,{slice:M.timeslice,space:M.timeskip})):w(a.layout)};this.saveLayout=
function(a,b){var c=window.location.href,d=c.indexOf("?"),e=c.indexOf("#"),d=d>=e?d:e;0<d&&(c=c.slice(0,d));b||(b=M.layout_id||(M.layout_id=M.width+"x"+M.height+"("+c+")"));if(h.cache){for(var c=Ia.cloneNode(!0),d=c.childNodes,e=0,f=d.length;e<f;){var g=d[e++];if(1===g.nodeType)for(var g=g.childNodes,n=0,k=g.length;n<k;){var l=g[n++];1===l.nodeType&&v(l,M.dontsave||!1)}}d=ab(c,".codexsplitstart");e=0;for(f=d.length;e<f;)g=d[e++],(n=(n=g.id)&&hb[n])&&g.setAttribute("data-textsplit",n.nodeValue);c=
c.innerHTML;try{H(b,c,!1,!1,function(){D(b)}),a(M)}catch(J){return F.warn("Couldn't save layout %s: %s",b,J),!1}return b}};this.restoreLayout=function(a){return new Promise(function(b,c){T(a,b,c)})};var rb=E.scaleToFit.adjust;this.finishPage=function(a){a.style.display="block";var b=C(a,"codexundersize"),c=C(a,"codexoversize");if(c||b)if(Oa(a),Za){var b=a.scrollWidth,d=a.scrollHeight,e=a.offsetWidth,f=a.offsetHeight;(c?d<=f&&b<=e:f<=d&&e<=b&&f>.9*d||e>.9*b)||(a.style.height="",rb(a))}M.pagedone&&
M.pagedone(a);ja(a,"codexworkpage");a.style.display="";a.style.height=""};this.Finish=function(){for(var a in fb)if(fb.hasOwnProperty(a)){var b=fb[a],c=b[b.length-1],d=document.getElementById(a);"OL"===d.tagName&&y([d].concat(b));if("LI"===d.tagName)for(var d=0,f=b.length;d<f;){var h=b[d++];h.hasAttribute(h,"data-savedstyle")||h.setAttribute("data-savedstyle",h.getAttribute("style")||"");h.style.listStyleType="none"}c.className=c.className.replace(/\bcodexdup\b/,"codexdupend")}if((a=ab(ba,".codexdup"))&&
a.length)for(b=0,c=a.length;b<c;)d=a[b++],e(d);ba&&(La&&La.call(M,ba,M),ba.style.height="",ja(ba,"codexworkpage"));a=0;for(b=Sa.length;a<b;)c=Sa[a++],this.finishPage(c);M.done=L();if(M.thenfns&&M.thenfns.length)for(a=M.thenfns,b=0,c=a.length;b<c;)a[b++](M)};this.forcedBreakBefore=G;this.mustBreakBefore=N;this.forcedBreakAfter=ka;this.mustBreakAfter=bb;this.avoidBreakInside=Na;this.mustBreakInside=xa;this.avoidBreakBefore=na;this.cantBreakBefore=Ra;this.avoidBreakAfter=ya;this.cantBreakAfter=pa;this.checkSinglePage=
W;this.getPage=Fa;this.getDup=function(a,b){"string"===typeof a&&(a=document.getElementById(a));if(!a)return!1;if(t(a,b))return a;for(var c=M.dups[a.id],d=0,e=c.length;d<e;){if(t(c[d],b))return c[d];d++}return!1};this.gotoPage=function(a){var b=!1;if(a)if("number"===typeof a)b=document.getElementById(Ya+a);else if(a.nodeType)b=C(a,"codexpage")?a:Q(a,".codexpage");else if("string"===typeof a)b=Fa(document.getElementById(a));else return Ca("Can't determine page from %o",a),!1;else return!1;b&&(a=Ia.getElementsByClassName("curpage"),
a.length&&ja(U(a),"curpage"),Z(b,"curpage"))};this.Revert=function(){var a,b;if(this.saved_ids){var c=this.saved_ids,d=c._all_ids,e=this.crumbs;a=0;for(b=d.length;a<b;){var f=d[a++],h;if(e[f]){h=document.getElementById(f);var g=h.getAttribute("data-savedclass"),n=h.getAttribute("data-savedstyle"),f=e[f];g&&(h.className=g,h.removeAttribute("data-savedclass"));n&&(h.setAttribute("style",n),h.removeAttribute("data-savedstyle"));f.parentNode.replaceChild(h,f)}else c[f]&&(h=c[f],f&&(h.id=f))}c=this.lostids;
d=c._all_ids;a=0;for(b=d.length;a<b;)if(e=d[a++])c[e].id=e;this.saved_ids={};this.dups={};this.lostids={}}else if(E.scaleToFit.revertAll(),a=this.crumbs,c=L(),b=0,!(this.reverting&&1E4>c-this.reverting)){this.reverting=c;d=this.textsplits;e=U(this.container.getElementsByClassName("_pagescaled"));b=0;for(c=e.length;b<c;)h=e[b++],g=Q(h,".codexscalewrapper"),n=h.getAttribute("data-savedstyle"),ja(h,"_pagescaled"),n?h.setAttribute("style",n):h.setAttribute("style",""),g&&g.parentNode.replaceChild(h,g);
b=U(this.container.getElementsByClassName("codexcantsplit"));ja(b,"codexcantsplit");h=U(this.container.getElementsByClassName("codexsplitstart"));b=0;for(c=h.length;b<c;)e=h[b++],e.parentNode.replaceChild(d[e.id],e);h=U(this.container.getElementsByClassName("codextextsplit"));b=0;for(c=h.length;b<c;)e=h[b++],e.parentNode.removeChild(e);b=U(this.container.getElementsByClassName("codexraggedsplit"));ja(b,"codexraggedsplit");(b=U(this.container.getElementsByClassName("codexdupleading")))&&b.length&&
E.remove(b);e=U(this.container.getElementsByClassName("codexrelocated"));b=U(this.container.getElementsByClassName("codexdupstart"));c=U(this.container.getElementsByClassName("codexdupend"));h=U(this.container.getElementsByClassName("codexdup"));g=U(this.container.getElementsByClassName("codexpagetop"));ja(b,"codexdupstart");ja(c,"codexdupend");ja(h,"codexdup");ja(g,"codexpagetop");if(e&&e.length)for(this.logfn("Reverting layout of %d nodes and %d split texts",e.length,d.length),b=0,c=e.length;b<
c;)if(d=e[b++],h=d.id){if(h=a[h])g=h.parentNode,C(d,/\bcodexwraptext\b/g)?g.replaceChild(d.childNodes[0],h):h.parentNode.replaceChild(d,h);ja(d,"codexrelocated")}a=E.$("[data-savedstyle]");b=0;for(c=a.length;b<c;)d=a[b++],d.hasAttribute("data-savedstyle")&&((e=d.getAttribute("data-savedstyle"))?d.setAttribute("style",e):d.removeAttribute("style"),d.removeAttribute("data-savedstyle"));E.unwrapChildren("div.fdjtfontwrapper",this.container);this.textsplits={};this.crumbs={}}};return this}function B(){F("Error initializing indexedDB");
ua||(h.layoutDB=ua=window.localStorage,Ra=!1,xa&&xa())}function v(a){var b=window.indexedDB.open(a,1);h.dbname=a;Ra=setTimeout(B,15E3);b.onerror=function(a){F("Error initializing indexedDB layout cache: %o",a.errorCode);Ra&&clearTimeout(Ra);h.layoutDB=ua=window.localStorage;na=xa;xa=!1;na&&na()};b.onsuccess=function(a){a=a.target.result;h.trace&&F("Using existing indexedDB layout cache");Ra&&clearTimeout(Ra);h.layoutDB=ua=a;h.cache=7;na=xa;xa=!1;na&&na()};b.onupgradeneeded=function(a){a=a.target.result;
Ra&&clearTimeout(Ra);a.onerror=function(a){F("Unexpected error caching layouts: %d",a.target.errorCode);h.layoutDB=ua=window.localStorage;xa&&xa()};a.onsuccess=function(a){h.trace&&F("Initialized indexedDB layout cache");xa&&xa()};a.createObjectStore("layouts",{keyPath:"layout_id"});h.layoutDB=ua=window.localStorage;na=xa;xa=!1;na&&na()}}function H(a,b,c,d){"undefined"===typeof ua?xa=function(){H(a,b)}:ua&&(window.Storage&&ua instanceof window.Storage?(T(a,b),d&&d()):window.indexedDB?(c=ua.transaction(["layouts"],
"readwrite").objectStore("layouts").put({layout_id:a,layout:b}),c.onerror=function(b){F("Error saving layout %s: %o",a,b.target.errorCode)},c.onsuccess=function(b){d&&d();F("Layout %s cached",a)}):h.layoutDB=ua=window.localStorage||!1)}function G(a){if(ua)if(window.Storage&&ua instanceof window.Storage){var b=O.dropLocal;b(a);N(a)}else{var c=ua.transaction(["layouts"],"readwrite").objectStore("layouts"),d=c.get(a),e=function(b){N(a)},f=function(b){F("Error removing laytout %s",a)};d.onerror=f;d.onsuccess=
function(b){d=c["delete"](a);d.onerror=f;d.onsuccess=e}}}function x(a,b,c){var d=O.getLocal,e=!1;if("undefined"===typeof ua)xa=function(){x(a,b,c)};else if(ua)if(window.Storage&&ua instanceof window.Storage)(e=d(a)||!1)&&D(a),setTimeout(function(){b(e)},1);else if(ua)d=ua.transaction(["layouts"]).objectStore("layouts").get(a),d.onsuccess=function(d){(d=(d=d.target)&&d.result)&&D(a);d?b(d.layout):c(!1)},d.onerror=function(a){c(a)};else if(window.localStorage)(e=O.getLocal(a)||!1)&&D(a),setTimeout(function(){b(e)},
0);else return c?c(!1):b?b(!1):!1;else return c?c(!1):b?b(!1):!1}function y(a){if(ua){var b=[];ua.transaction(["layouts"],"read").objectStore("layouts").openCursor().onsuccess=function(c){(c=c.target.result)?(b.push(c.key),c["continue"]()):a(b)}}else return!1}function D(a){T("fdjtCodex.layout("+a+")",a);J("fdjtCodex.layouts",a)}function N(a){n("fdjtCodex.layout("+a+")",a);w("fdjtCodex.layouts",a);h.trace&&F("Layout %s removed",a)}var E=fdjt.DOM,F=fdjt.Log,A=fdjt.Async,L=fdjt.Time,O=fdjt.State,P=fdjt.ID,
S=E.hasContent,t=E.hasParent,Q=E.getParent,aa=E.getStyle,X=E.parsePX,C=E.hasClass,Z=E.addClass,ja=E.dropClass,U=E.toArray,ka=E.getElementValue,T=O.setLocal,J=O.pushLocal,n=O.dropLocal,w=O.removeLocal,sa=Math.floor,R=document.body.namespaceURI,ua,ab=E.getChildren,Pa=E.getChild,Na=/[^ \n\r\t\f\x0b\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000\uf3ff]/g,bb=fdjt.DOM.adjustFontSize,Oa=fdjt.DOM.adjustFonts,eb=fdjt.DOM.tweakImage,Wa=
1;h.timeslice=50;h.timeskip=10;h.tracelevel=0;h.prototype.getDups=function(a){if(!a)return[];a.nodeType&&(a=a.id);var b=P(a);return(a=this.dups[a])?[b].concat(a):!1};h.prototype.getLayoutInfo=function(){for(var a=this.allmoves,b=this.pages.length,c=Array(b+1),d=0;d<=b;)c[d++]=[];b=0;for(d=a.length;b<d;){var e=a[b++],f=Q(e,".codexpage");if(f)if(f=parseInt(f.getAttribute("data-pagenum"),10),c[f]){var h={block:e};e.id&&(h.id=e.id);e.className&&(h.className=e.className);e.getAttribute("data-baseid")&&
(h.baseid=e.getAttribute("data-baseid"));c[f].push(h)}else F.warn("weird page number: %o",f);else F.warn("Can't find page for %o",e)}return c};h.prototype.getLayoutBlocks=function(){for(var a=this.allblocks,b=[],c=0,d=a.length;c<d;){var e=a[c++],f=Q(e,".codexpage"),f={pagenum:parseInt(f.getAttribute("data-pagenum"),10)},h=e.className;e.id&&(f.id=e.id);h&&0<=h.search(/\bcodexdup/g)?f.html=e.outerHTML:(e.id&&(f.id=e.id),0<=h.search(/\bcodexpagetop\b/)&&(f.pagetop=!0),0<=h.search(/\bcodexcantsplit\b/)&&
(f.cantsplit=!0));b.push(f)}return{blocks:b,npages:this.pages.length,height:this.height,width:this.width,break_blocks:this.break_blocks}};h.cache=2;var xa=!1,Ra=!1,na=!1;h.useIndexedDB=v;window.indexedDB&&fdjt.addInit(function(){h.dbname||(h.dbname="codexlayout",v("codexlayout"))},"CodexLayoutCache");window.localStorage?(na=xa,xa=!1,h.layoutDB=ua=window.localStorage):(h.layoutDB=ua=!1,na=xa,xa=!1);na&&na();h.cacheLayout=H;h.dropLayout=G;h.fetchLayout=function(a){return new Promise(function(b,c){return x(a,
b,c)})};h.clearLayouts=function(){var a=O.getLocal("fdjtCodex.layouts",!0),b=0,c=a&&a.length;if(a){for(;b<c;)G(a[b++]);O.dropLocal("fdjtCodex.layouts")}};h.fetchAll=y;h.clearAll=function(a){y(function(b){var c=[],d=0,e=b.length;if(e){if(a)for(;d<e;){var f=b[d++];0<=f.search(a)&&c.push(f)}else c=b;if(0===c.length)F.warn("No layouts match %s",a);else for(a?F.warn("Dropping %d layouts matching %s",c.length,a):F.warn("Dropping %d layouts",c.length),d=0,e=c.length;d<e;)F.warn("Dropping layout %s",c[d]),
G(c[d++])}else F.warn("No layouts")})};h.dbname="codexlayout";return h}();var Markdown;Markdown="object"===typeof exports&&"function"===typeof require?exports:{};
(function(){function a(a){return a}function r(a){return!1}function g(){}function m(){}g.prototype={chain:function(g,m){var r=this[g];if(!r)throw Error("unknown hook "+g);this[g]=r===a?m:function(a){var f=Array.prototype.slice.call(arguments,0);f[0]=r.apply(null,f);return m.apply(null,f)}},set:function(a,g){if(!this[a])throw Error("unknown hook "+a);this[a]=g},addNoop:function(g){this[g]=a},addFalse:function(a){this[a]=r}};Markdown.HookCollection=g;m.prototype={set:function(a,g){this["s_"+a]=g},get:function(a){return this["s_"+
a]}};Markdown.Converter=function(){function a(b){return b=b.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(a,b,c,d,e,f){b=b.toLowerCase();Q.set(b,D(c));if(e)return d;f&&aa.set(b,f.replace(/"/g,"&quot;"));return""})}function q(a){a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,r);a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,
r);a=a.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,r);a=a.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,r);return a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,r)}function r(a,b){var c;c=b.replace(/^\n+/,"");c=c.replace(/\n+$/g,"");return c="\n\n~K"+(X.push(c)-1)+"K\n\n"}function p(a,b){a=t.preBlockGamut(a,Z);a=c(a);a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,"<hr />\n");a=a.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,
"<hr />\n");a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,"<hr />\n");a=z(a);a=B(a);a=x(a);a=t.postBlockGamut(a,Z);a=q(a);return a=y(a,b)}function f(a){a=t.preSpanGamut(a);a=H(a);a=b(a);a=a.replace(/\\(\\)/g,S);a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,S);a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,d);a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,d);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,e);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,
e);a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,e);a=E(a);a=a.replace(/~P/g,"://");a=D(a);a=a.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4");a=a.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4");a=a.replace(/  +\n/g," <br>\n");return a=t.postSpanGamut(a)}function b(a){return a=a.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=
P(b,"!"==a.charAt(1)?"\\`*_/":"\\`*_")})}function e(a,b,c,d,e,f,h,g){void 0==g&&(g="");a=c.replace(/:\/\//g,"~P");d=d.toLowerCase();if(""==e)if(""==d&&(d=a.toLowerCase().replace(/ ?\n/g," ")),void 0!=Q.get(d))e=Q.get(d),void 0!=aa.get(d)&&(g=aa.get(d));else if(-1<b.search(/\(\s*\)$/m))e="";else return b;e=O(e);e=P(e,"*_");b='<a href="'+e+'"';""!=g&&(g=l(g),g=P(g,"*_"),b+=' title="'+g+'"');return b+(">"+a+"</a>")}function l(a){return a.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}
function d(a,b,c,d,e,f,h,g){a=c;d=d.toLowerCase();g||(g="");if(""==e)if(""==d&&(d=a.toLowerCase().replace(/ ?\n/g," ")),void 0!=Q.get(d))e=Q.get(d),void 0!=aa.get(d)&&(g=aa.get(d));else return b;a=P(l(a),"*_[]()");e=P(e,"*_");b='<img src="'+e+'" alt="'+a+'"';g=l(g);g=P(g,"*_");return b=b+(' title="'+g+'"')+" />"}function c(a){a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return"<h1>"+f(b)+"</h1>\n\n"});a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return"<h2>"+f(b)+"</h2>\n\n"});
return a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){a=b.length;return"<h"+a+">"+f(c)+"</h"+a+">\n\n"})}function z(a,b){a+="~0";var c=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;C?a=a.replace(c,function(a,c,d){a=-1<d.search(/[*+-]/g)?"ul":"ol";c=h(c,a,b);c=c.replace(/\s+$/,"");return"<"+a+">"+c+"</"+a+">\n"}):(c=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(c,
function(a,b,c,d){a=-1<d.search(/[*+-]/g)?"ul":"ol";c=h(c,a);return b+"<"+a+">\n"+c+"</"+a+">\n"}));return a=a.replace(/~0/,"")}function h(a,b,c){C++;a=a.replace(/\n{2,}$/,"\n");b=ja[b];var d=!1;a=(a+"~0").replace(new RegExp("(^[ \\t]*)("+b+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+b+")[ \\t]+))","gm"),function(a,b,e,h){a=h;(b=/\n\n$/.test(a))||-1<a.search(/\n{2,}/)||d?a=p(A(a),!0):(a=z(A(a),!0),a=a.replace(/\n$/,""),c||(a=f(a)));d=b;return"<li>"+a+"</li>\n"});a=a.replace(/~0/g,"");C--;return a}function B(a){a=
(a+"~0").replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){a=G(A(b));a=L(a);a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");a="<pre><code>"+a+"\n</code></pre>";return"\n\n"+a+"\n\n"+c});return a=a.replace(/~0/,"")}function v(a){a=a.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(X.push(a)-1)+"K\n\n"}function H(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d,e){a=d.replace(/^([ \t]*)/g,"");a=a.replace(/[ \t]*$/g,"");a=G(a);a=a.replace(/:\/\//g,
"~P");return b+"<code>"+a+"</code>"})}function G(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");return a=P(a,"*_{}[]\\",!1)}function x(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c;c=b.replace(/^[ \t]*>[ \t]?/gm,"~0");c=c.replace(/~0/g,"");c=c.replace(/^[ \t]+$/gm,"");c=p(c);c=c.replace(/(^|\n)/g,"$1  ");c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c;c=b.replace(/^  /mg,"~0");return c=c.replace(/~0/g,"")});return v("<blockquote>\n"+
c+"\n</blockquote>")})}function y(a,b){a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");for(var c=a.split(/\n{2,}/g),d=[],e=/~K(\d+)K/,h=c.length,g=0;g<h;g++){var k=c[g];e.test(k)?d.push(k):/\S/.test(k)&&(k=f(k),k=k.replace(/^([ \t]*)/g,"<p>"),k+="</p>",d.push(k))}if(!b)for(h=d.length,g=0;g<h;g++)for(var l=!0;l;)l=!1,d[g]=d[g].replace(/~K(\d+)K/g,function(a,b){l=!0;return X[b]});return d.join("\n\n")}function D(a){a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");return a=a.replace(/<(?![a-z\/?!]|~D)/gi,
"&lt;")}function N(a,b,c,d){if(b)return a;if(")"!==d.charAt(d.length-1))return"<"+c+d+">";a=d.match(/[()]/g);for(var e=b=0;e<a.length;e++)"("===a[e]?0>=b?b=1:b++:b--;var f="";0>b&&(d=d.replace(new RegExp("\\){1,"+-b+"}$"),function(a){f=a;return""}));f&&(a=d.charAt(d.length-1),ka.test(a)||(f=a+f,d=d.substr(0,d.length-1)));return"<"+c+d+">"+f}function E(a){a=a.replace(U,N);return a=a.replace(/<((https?|ftp):[^'">\s]+)>/gi,function(a,b){return'<a href="'+b+'">'+t.plainLinkText(b)+"</a>"})}function F(a){return a=
a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})}function A(a){a=a.replace(/^(\t|[ ]{1,4})/gm,"~0");return a=a.replace(/~0/g,"")}function L(a){if(!/\t/.test(a))return a;var b=["    ","   ","  "," "],c=0,d;return a.replace(/[\n\t]/g,function(a,e){if("\n"===a)return c=e+1,a;d=(e-c)%4;c=e+1;return b[d]})}function O(a){if(!a)return"";var b=a.length;return a.replace(T,function(c,d){return"~D"==c?"%24":":"!=c||d!=b-1&&!/[0-9\/]/.test(a.charAt(d+1))?"%"+c.charCodeAt(0).toString(16):
":"})}function P(a,b,c){b="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(b="\\\\"+b);return a=a.replace(new RegExp(b,"g"),S)}function S(a,b){return"~E"+b.charCodeAt(0)+"E"}var t=this.hooks=new g;t.addNoop("plainLinkText");t.addNoop("preConversion");t.addNoop("postNormalization");t.addNoop("preBlockGamut");t.addNoop("postBlockGamut");t.addNoop("preSpanGamut");t.addNoop("postSpanGamut");t.addNoop("postConversion");var Q,aa,X,C;this.makeHtml=function(b){if(Q)throw Error("Recursive call to converter.makeHtml");
Q=new m;aa=new m;X=[];C=0;b=t.preConversion(b);b=b.replace(/~/g,"~T");b=b.replace(/\$/g,"~D");b=b.replace(/\r\n/g,"\n");b=b.replace(/\r/g,"\n");b=L("\n\n"+b+"\n\n");b=b.replace(/^[ \t]+$/mg,"");b=t.postNormalization(b);b=q(b);b=a(b);b=p(b);b=F(b);b=b.replace(/~D/g,"$$");b=b.replace(/~T/g,"~");b=t.postConversion(b);X=aa=Q=null;return b};var Z=function(a){return p(a)},ja={ol:"\\d+[.]",ul:"[*+-]"},U=/(="|<)?\b(https?|ftp)(:\/\/[-A-Z0-9+&@#/%?=~_|[\]()!:,.;]*[-A-Z0-9+&@#/%=~_|[\])])(?=$|\W)/gi,ka=/[-A-Z0-9+&@#/%=~_|[\])]/i,
T=/(?:["'*()[\]:]|~D)/g}})();var metaBook={mode:!1,hudup:!1,scrolling:!1,query:!1,head:!1,target:!1,glosstarget:!1,location:!1,root:!1,start:!1,HUD:!1,locsync:!1,user:!1,loggedin:!1,cxthelp:!1,_setup:!1,_user_setup:!1,_gloss_setup:!1,_social_setup:!1,connected:!1,curpage:!1,curoff:!1,curinfo:!1,curbottom:!1,last_mode:!1,last_heartmode:"about",demo:!1,taptapmsecs:500,holdmsecs:250,edgeclick:50,pagesize:250,dontanimate:!1,nativeselect:!1,minswipe:7,uisound:!1,readsound:!1,glossmodes:/(addtag)|(addoutlet)|(editdetail)|(hamburger)|(attach)/,
fullheight:!1,fullwidth:!1,handheld:!1,updatehash:!0,iscroll:!1,missing_nodes:[],cache_layout_thresh:2500,long_layout_thresh:5E3,forcelayout:!1,freezelayout:!1,persist:!1,cacheglosses:!1,saveprops:"sources outlets layers sync nodeid state".split(" "),keepdata:!1,mouse:!0,touch:!1,kbd:!1,keyboard:!0,scrollers:{},min_excerpt:3,max_excerpt:!1,queued:[],tagweights:!1,tagmaxweight:0,tagminweight:2E8,refuri:!1,refuris:[],docuri:!1,mycopyid:!1,syncstamp:!1,update_interval:3E4,update_timeout:3E4,update_pause:18E5,
sync_interval:6E4,sync_timeout:1E4,sync_pause:9E5,UI:{handlers:{mouse:{},touch:{},kbd:{},ios:{}}},Debug:{},HTML:{},DOM:{},CSS:{},TapHold:{},xtargets:{},Timeline:{},allterms:[],prefixes:{},openinbook:["https://www.youtube.com/"],srcloading:{},glossdata:{},inits:[],default_config:{layout:"bypage",forcelayout:!1,bodysize:"normal",bodyfamily:"serif",bodycontrast:"high",justify:!1,linespacing:"normal",uisize:"normal",dyslexical:!1,animatecontent:!0,animatehud:!0,hidesplash:!1,keyboardhelp:!0,holdmsecs:150,
wandermsecs:1500,syncinterval:60,glossupdate:300,locsync:15,cacheglosses:!0,soundeffects:!1,buzzeffects:!1,showconsole:!1,controlc:!1},Trace:{startup:0,config:0,mode:!1,nav:!1,domscan:0,search:0,clouds:0,target:!1,toc:!1,storage:0,network:0,state:0,savegloss:0,glosses:0,addgloss:0,glossdata:0,layout:0,knodules:0,flips:!1,messages:!1,glossing:!1,selection:!1,iscroll:!1,highlight:0,indexing:0,gestures:0}};"undefined"===typeof mB&&(mB=metaBook);fdjt.DOM.noautofontadjust=!0;(function(){function a(a,b,c){aa.persist?t(a,b,c):H.setSession(a,b,c)}function r(a){H.dropLocal(a);H.dropSession(a)}function g(a){if(0===a.search("https://glossdata.sbooks.net/")){var b="glossdata("+a+")";if(!H.getLocal(b)){H.setLocal(b,"fetching");var c="https://glossdata.sbooks.net/U/"+a.slice(29),d=new XMLHttpRequest;X.glossdata&&x("Fetching glossdata %s to cache locally",a);d.onreadystatechange=function(){if(4===d.readyState){X.glossdata&&x("Glossdata from %s status %d",d.status);var c=200===
d.status?m(a,d.responseText):a,e=aa.srcloading[a];if(e){var f=0,h=e.length;for(X.glossdata&&x("Setting glossdata src for %d element(s)",h);f<h;)e[f++].src=c}200===d.status?k(a,d.responseText):H.dropLocal(b)}};d.open("GET",c);d.withCredentials=!0;d.send(null)}}}function m(a,b){var c=y.data2URL(b);return Z[a]=c}function k(a,b){var c="glossdata("+a+")";if(C){var d=C.transaction(["glossdata"],"readwrite").objectStore("glossdata").put({url:a,datauri:b});d.onerror=function(b){x("Error saving %s in indexedDB: %o",
a,b.target.errorCode)};d.onsuccess=function(b){H.setLocal(c,"cached");X.glossdata&&x("Saved glossdata for %s in IndexedDB",a);q(a)}}else H.setLocal(c,b),q(a)}function q(a){H.pushLocal("glossdata("+aa.docuri+")",a);H.pushLocal("glossdata()",a)}function u(a){if(a=a?S("glossdata("+a+")",!0):S("glossdata()",!0))for(var b=0,c=a.length;b<c;){var d=a[b++];Q("cached("+d+")");C&&p(d)}}function p(a){var b=C.transaction(["glossdata"],"readwrite").objectStore("glossdata")["delete"](a);b.onerror=function(b){x("Error clearing gloss data for %s: %s",
a,b.target.errorCode)};b.onsuccess=function(){1<X.glossdata&&x("Cleared gloss data for %s",a)}}function f(a,b){if(this instanceof f){if(0===arguments.length)return this;var c=Knodule.TagQuery.call(this,a);X.search&&(c.log={});return c}return new f(a,b)}function b(a){var c;a||(a=metaBook.user);if(a){if("string"===typeof a)return b(metaBook.sourcedb.probe(a));if(a.maker&&a.maker instanceof F)c=new Knodule(a.maker.getQID());else{if(a.maker&&"string"===typeof a.maker)return b(metaBook.sourcedb.probe(a.maker));
c=a._qid?new Knodule(a._qid):a._id?new Knodule(a._i):metaBook.knodule}}else return metaBook.knodule;c.description=a.name;return c}function e(){document[y.isHidden]?U&&(clearInterval(U),U=!1):U||(U=setInterval(function(){if(metaBook.user&&!fdjt.device.standalone&&!document[y.isHidden]&&fdjt.device.mobilesafari&&metaBook.user&&!fdjt.device.standalone&&fdjt.device.mobilesafari){var a=H.getCookie("SBOOKS:AUTH-");if(a){var b=encodeURIComponent(a),c=location.href,d=c.indexOf("?"),e=c.indexOf("#"),a=0>d?
0>e?c:c.slice(0,e):c.slice(0,d),d=0>d?"":0>e?c.slice(d):c.slice(d+1,e),c=0>e?"":c.slice(e),f=!1,b="SBOOKS%3aAUTH-="+b;if(2>=d.length)d="?"+b;else if(0<=d.search("SBOOKS%3aAUTH-="))var f=d.search("SBOOKS%3aAUTH-="),e=d.slice(0,f),h=d.slice(f).search("&"),g=0>h?"":d.slice(f+h),f=0>h?d.slice(f):d.slice(f,f+h),d=e+b+g;else d=d+"&"+b;f&&f===b||history.replaceState(history.state,window.title,a+d+c)}}},3E5))}function l(){e();y.isHidden&&y.addListener(document,y.vischange,e);e()}function d(a){return"string"===
typeof a?ka(a)?!1:a:!1}function c(a){var b;a&&"string"===typeof a&&"#"===a[0]&&(a=a.slice(1));T||(T=metaBook.docinfo);var c=T&&(b=T[a])&&b.elt;if(c&&c.id||(c=document.getElementById(a)))return c;b=document.getElementsByName(a);if(1===b.length)return b[0];if(1<b.length)return!1;b=y.$("[data-tocid='"+a+"']");return 1===b.length?b[0]:b.length?(b=y.$(".codexdupstart[data-tocid='"+a+"']"),1===b.length?b[0]:!1):!1}function z(a,b,c,d){c||(c="tags");d||(d=metaBook.knodule);var e=metaBook.docdb;a instanceof
Array||(a=[a]);n(a,b,e,d,c,metaBook.tagscores);for(var f=0,h=a.length;f<h;){var g=a[f++];if(g.toclevel){var k=e.find("head",g);k.length&&(k=[].concat(k));k&&k.length&&n(k,b,e,d,"^"+c,metaBook.tagscores);g=e.find("heads",g);g.length&&(g=[].concat(g));g&&g.length&&z(g,b,"^"+c,d)}}}function h(a,b){if(a.toclevel)return"none"===a.toclevel?a.toclevel=!1:a.toclevel;var c=a.getAttributeNS&&a.getAttributeNS("toclevel","http://sbooks.net")||a.getAttribute("toclevel")||a.getAttribute("data-toclevel");if(c)return"none"===
c?!1:parseInt(c,10);if(a.className){c=a.className;if(0<=c.search(/\bsbooknotoc\b/)||0<=c.search(/\bsbookignore\b/))return 0;var d=c.search(/\bsbook\d+(head|sect)\b/);if(0<=d)return parseInt(c.slice(d+5),10);if("number"===typeof b&&0<=c.search(/\bsbooksubhead\b/))return b+1}return metaBook.notoc&&metaBook.notoc.match(a)||metaBook.ignore&&metaBook.ignore.match(a)?0:"undefined"===typeof metaBook.autotoc||metaBook.autotoc?"HGROUP"===a.tagName||"HEADER"===a.tagName?B(a,!0):0===a.tagName.search(/H\d/)?
parseInt(a.tagName.slice(1,2),10):!1:!1}function B(a,b){if(1!==a.nodeType)return!1;var c=!b&&h(a);if(c)return c;for(var d=a.childNodes,e=0,f=d.length;e<f;)if(c=d[e++],1===c.nodeType&&(c=B(c)))return c;return!1}var v=fdjt.String,H=fdjt.State,G=fdjt.Async,x=fdjt.Log,y=fdjt.DOM,D=fdjt.UI,N=fdjt.ID,E=fdjt.RefDB,F=fdjt.Ref,A=fdjt.Map||E.Map,L=y.hasClass,O=y.addClass,P=y.hasParent,S=H.getLocal,t=H.setLocal,Q=H.dropLocal,aa=metaBook,X=metaBook.Trace;metaBook.tagweights=new A;metaBook.tagscores=new A;metaBook.hasLocal=
function(a){return aa.persist?H.existsLocal(a):H.existsSession(a)};metaBook.saveLocal=a;metaBook.readLocal=function(a,b){return aa.persist?S(a,b)||H.getSession(a,b):H.getSession(a,b)||S(a,b)};metaBook.clearLocal=r;metaBook.focusBody=function(){};var C=!1;window.indexedDB&&(A=window.indexedDB.open("metaBook",1),A.onerror=function(a){x("Error initializing the metaBook IndexedDB: %o",a.errorCode)},A.onsuccess=function(a){a=a.target.result;x("Using existing metaBook IndexedDB");G(function(){fdjt.CodexLayout.useIndexedDB("metaBook")});
metaBook.metaBookDB=C=a},A.onupgradeneeded=function(a){a=a.target.result;a.onerror=function(a){x("Unexpected error setting up glossdata cache: %d",a.target.errorCode)};a.onsuccess=function(a){a=a.target.result;x("Initialized metaBook indexedDB");G(function(){fdjt.CodexLayout.useIndexedDB("metaBook")});metaBook.metaBookDB=C=a};a.createObjectStore("glossdata",{keyPath:"url"});a.createObjectStore("layouts",{keyPath:"layout_id"});a.createObjectStore("sources",{keyPath:"_id"});a.createObjectStore("docs",
{keyPath:"_id"});a.createObjectStore("glosses",{keyPath:"glossid"});G(function(){fdjt.CodexLayout.useIndexedDB("metaBook")})});metaBook.initDB=function(){function b(){return F.apply(this,arguments)}function c(a){var b=H.dropLocal;a?("string"!==typeof a&&(a=metaBook.docuri),metaBook.sync=!1,r("metabook.sources("+a+")"),r("metabook.outlets("+a+")"),r("metabook.layers("+a+")"),r("metabook.etc("+a+")"),metaBook.glossdb.clearOffline(function(){r("metabook.sync("+a+")")}),u(a)):(b("metabook.user"),fdjt.CodexLayout.clearLayouts(),
H.clearLocal(),H.clearSession(),u())}1<X.start&&x("Initializing DB");var d=metaBook.refuri||document.location.href;0<d.indexOf("#")&&(d=d.slice(0,d.indexOf("#")));var e=metaBook.taglist||fdjt.ID("METABOOKTAGLIST");e||(e=metaBook.taglist=fdjt.DOM("datalist#METABOOKTAGLIST"),document.body.appendChild(e));metaBook.docdb=new E(d+"#",{indices:"frag head heads tags tags* *tags **tags ~tags *tags **tags ~tags *tags* **tags* ~tags* ^tags ~^tags *^tags **^tags ^tags* ~^tags* *^tags* **^tags*".split(" ")});
metaBook.docdb.slots=["head","heads"];var h=Knodule.knodeToOption,d=y.getMeta("SBOOKS.knodule")||y.getMeta("~KNODULE")||d;metaBook.knodule=new Knodule(d);Knodule.current=metaBook.knodule;metaBook.BRICO=new Knodule("BRICO");metaBook.BRICO.addAlias(":@1/");metaBook.BRICO.addAlias("@1/");var n=v.stdspace;metaBook.glossdb=new E("glosses@"+metaBook.refuri,{indices:"frag maker outlets tags *tags **tags tags* *tags* **tags*".split(" ")});metaBook.glossdb.absrefs=!0;metaBook.glossdb.addAlias("glossdb");metaBook.glossdb.addAlias("-UUIDTYPE=61");
metaBook.glossdb.addAlias(":@31055/");metaBook.glossdb.addAlias("@31055/");metaBook.glossdb.onLoad(function(a){var b=metaBook.docinfo[a.frag];if(b){b&&b.starts_at&&(a.starts_at=b.starts_at+(a.exoff||0));b&&b.ends_at&&(a.ends_at=a.excerpt?b.ends_at+(a.exoff||0)+n(a.excerpt).length:b.ends_at);!a.maker&&metaBook.user&&(a.maker=metaBook.user);var c=metaBook.addTags,d=metaBook.addTag2Cloud,f=metaBook.empty_cloud,k=a.maker&&metaBook.sourcedb.ref(a.maker);if(a.links){var l=a.links,m;for(m in l)l.hasOwnProperty(m)&&
0===m.search("https://glossdata.sbooks.net/")&&g(m)}k&&(metaBook.addTag2Cloud(k,metaBook.empty_cloud),metaBook.UI.addGlossSource(k,!0));var l=metaBook.getMakerKnodule(a.maker),k=k===metaBook.user,q,r=a.sources;if(r&&("string"===typeof r&&(r=[r]),r&&r.length))for(m=0,q=r.length;m<q;){var t=r[m++],t=metaBook.sourcedb.ref(t);metaBook.UI.addGlossSource(t,!0)}if((r=a.alltags)&&r.length){m=0;for(q=r.length;m<q;){var t=r[m++],p;p=d(t,f);k&&p&&O(p,"cue");p=d(t,metaBook.gloss_cloud);k&&p&&O(p,"cue");e.appendChild(h(t))}d=
["tags","*tags","**tags"];f=0;for(k=d.length;f<k;)q=d[f++],(m=a[q])&&m.length&&(q="+"+q,a.thread&&(c(a.thread,m,q),a.replyto!==a.thread&&c(a.replyto,m,q)),b&&c(b,m,q,l))}}else x("Gloss refers to nonexistent '%s': %o",a.frag,a)},"initgloss");metaBook.user&&aa.persist&&metaBook.cacheglosses&&(metaBook.glossdb.storage=window.localStorage);b.prototype=new F;var d=Knodule.exportTagSlot,k={"*tags":d,"**tags":d,"~tags":d,"~~tags":d,tags:d,"*tags*":d,"**tags*":d,"~tags*":d,"~~tags*":d,"tags*":d,"*tags**":d,
"**tags**":d,"~tags**":d,"~~tags**":d,"tags**":d};metaBook.tag_export_rules=k;metaBook.tag_import_rules=k;b.prototype.ExportExternal=function(){return F.Export.call(this,k)};metaBook.glossdb.refclass=b;metaBook.sourcedb=new E("sources@"+metaBook.refuri);metaBook.sourcedb.absrefs=!0;metaBook.sourcedb.oidrefs=!0;metaBook.sourcedb.addAlias("@1961/");metaBook.sourcedb.addAlias(":@1961/");metaBook.sourcedb.forDOM=function(a){var b="span.source"+(a.kind?".":"")+(a.kind?a.kind.slice(1).toLowerCase():""),
b=y(b,a.name||a.oid||a.uuid||a.uuid);a.about&&(b.title=a.about);return b};metaBook.queued=metaBook.cacheglosses&&S("metabook.queued("+metaBook.refuri+")",!0)||[];metaBook.cacheGlosses=function(b){var d=metaBook.saveprops,e=metaBook.docuri;if(b){if(metaBook.user){b=aa.persist?window.localStorage:window.sessionStorage;metaBook.sourcedb.storage||(metaBook.sourcedb.storage=b);metaBook.glossdb.storage||(metaBook.glossdb.storage=b);b=0;for(var f=metaBook.saveprops.length;b<f;){var h=d[b++];metaBook[h]&&
a("metabook."+h+"("+e+")",metaBook[h],!0)}metaBook.glossdb.save(!0);metaBook.sourcedb.save(!0);metaBook.queued=metaBook.queued&&metaBook.queued.length?metaBook.queued.concat(S("metabook.queued("+e+")",!0)||[]):S("metabook.queued("+e+")",!0)||[]}metaBook.cacheglosses=!0}else c(metaBook.docuri),e&&H.dropLocal("metabook.queued("+e+")"),metaBook.queued=[],metaBook.cacheglosses=!1};metaBook.clearOffline=c;metaBook.refreshOffline=function(){var a=metaBook.docuri;metaBook.sync=!1;r("metabook.sources("+a+
")");r("metabook.outlets("+a+")");r("metabook.layers("+a+")");r("metabook.etc("+a+")");metaBook.glossdb.clearOffline(function(){r("metabook.sync("+a+")");setTimeout(metaBook.updateInfo,25)})};f.prototype.dbs=[metaBook.glossdb,metaBook.docdb];f.prototype.weights={tags:4,"^tags":2,"+tags":8,"^+tags":4,strings:1,head:2,heads:1};f.prototype.uniqueids=!0;metaBook.query=metaBook.empty_query=new f([]);1<X.start&&x("Initialized DB")};var Z=metaBook.glossdata;metaBook.gotGlossData=m;f.prototype=new Knodule.TagQuery;
metaBook.Query=f;metaBook.Query.prototype.getRefiners=function(){if(this._refiners)return this._refiners;for(var a=this.getCoTags(),b=this.tagfreqs,c=this.results.length,d=metaBook.textindex.termindex,e=metaBook.textindex.allids.length,f=0,h=a.length,g=[];f<h;){var k=a[f++];if("string"!==typeof k)g.push(k);else{var n=b.getItem(k);if(!(n>.9*c||3>n||.1>n/c)){var l=d[k],l=l?l.length:0;0===l&&g.push(k);.4<l/e||n/c>l/e*5&&g.push(k)}}}return this._refiners=g};metaBook.getMakerKnodule=b;metaBook.trace=function(a,
b){var c=b.nodeType?b:D.T(b);c?x("%s %o in %o: mode%s=%o, target=%o, head=%o skimming=%o",a,b,c,metaBook.skimming?"(skimming)":"",metaBook.mode,metaBook.target,metaBook.head,metaBook.skimming):x("%s %o: mode%s=%o, target=%o, head=%o skimming=%o",a,b,metaBook.skimming?"(skimming)":"",metaBook.mode,metaBook.target,metaBook.head,metaBook.skimming)};metaBook.server=!1;metaBook.servers=[[/.sbooks.net$/g,"glosses.sbooks.net"]];metaBook.default_server="glosses.sbooks.net";metaBook.root=y.getLink("METABOOK.staticroot")||
"http://static.beingmeta.com/";"/"!==metaBook.root[metaBook.root.length-1]&&(metaBook.root+="/");metaBook.withsvg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||navigator.mimeTypes["image/svg+xml"];metaBook.svg=fdjt.DOM.checkSVG();H.getQuery("nosvg")?metaBook.svg=!1:H.getQuery("withsvg")&&(metaBook.svg=!0);metaBook.icon=function(a,b,c){return metaBook.root+"g/metabook/"+a+(metaBook.svg?".svgz":(b&&c?b+"x"+c:b?b+"w":c?c+"h":"")+".png")};var ja=metaBook.icon;metaBook.getRefURI=
function(a){for(;a&&a!==document;){if(a.getAttribute("data-refuri"))return a.getAttribute("data-refuri");if(a.getAttributeNS&&a.getAttributeNS("refuri","http://sbooks.net/"))return a.getAttributeNS("refuri","http://sbooks.net/");if(a.getAttribute("refuri"))return a.getAttribute("refuri");a=a.parentNode}return metaBook.refuri};metaBook.getDocURI=function(a){for(;a&&a!==document;){if(a.getAttribute("data-docuri"))return a.getAttribute("data-docuri");if(a.getAttributeNS&&a.getAttributeNS("docuri","http://sbooks.net/"))return a.getAttributeNS("docuri",
"http://sbooks.net/");if(a.getAttribute("docuri"))return a.getAttribute("docuri");a=a.parentNode}return metaBook.docuri};metaBook.getRefID=function(a){return a.getAttributeNS?a.getAttributeNS("sbookid","http://sbooks.net/")||a.getAttributeNS("sbookid")||a.getAttributeNS("data-sbookid")||a.codexbaseid||a.id:a.id};metaBook.getTarget=function(a,b){a=a.nodeType?a:a.target||a.srcElement||a;var c=!1,d=!1,e=metaBook.targetids,f=!1;if(P(a,metaBook.HUD)||P(a,".metabookmargin"))return!1;for(;a;){if(a.metabookui)return!1;
if(a===metaBook.docroot||a===document.body)return c;if((d=a.codexbaseid||a.id)&&metaBook.docinfo[d]&&(a.codexbaseid||0!==d.search("METABOOKTMP"))&&(!c||0!==d.search("WSN_")))if(0===d.search("WSN_"))f=a;else if(!(e&&0!==d.search(e)||L(a,"sbooknofocus")||metaBook.nofocus&&metaBook.nofocus.match(a))){if(L(a,"sbookfocus")||metaBook.focus&&metaBook.focus.match(a)||b)return a;if(c&&("SECTION"===a.tagName||a.className&&0<=a.className.search(/\bhtml5section\b/i))||c&&!fdjt.DOM.isVisible(a))return c;c=a}a=
a.parentNode}return c||f};metaBook.getHead=function(a){var b=a.codexbaseid||a.id;if(b&&metaBook.docinfo[b])a=metaBook.docinfo[b];else if(b)for(;a;)if(a.id&&metaBook.docinfo[b]){a=metaBook.docinfo[b];break}else a=a.parentNode;else{for(var d=a.firstChild,e=a.nextNode;d&&d!==e&&!d.id&&!d.codexbaseid&&(3!==d.nodeType||v.isEmpty(d.nodeValue));)d=y.forward(d);if(d&&d.id&&d!==e)a=metaBook.docinfo[!1];else for(;a;)if((b=a.codexbaseid||a.id)&&metaBook.docinfo[b]){a=metaBook.docinfo[b];break}else a=a.parentNode}return a?
a.level?c(a.frag):a.head?c(a.head.frag):!1:!1};metaBook.getRef=function(a){for(;!(!a||a.about||a.getAttribute&&a.getAttribute("about"));)a=a.parentNode;if(a){var b=a.about||a.getAttribute("about");a.about||(a.about=b);return"#"===b[0]?c(b.slice(1)):c(b)}return!1};metaBook.getRefElt=function(a){for(;a&&!(a.about||a.getAttribute&&a.getAttribute("about"));)a=a.parentNode;return a||!1};metaBook.checkTarget=function(){metaBook.target&&"openglossmark"===metaBook.mode&&!y.isVisible(metaBook.target)&&(metaBook.setMode(!1),
metaBook.setMode(!0))};var U=!1;!fdjt.device.standalone&&fdjt.device.mobilesafari&&fdjt.addInit(l,"setupKludgeTimer");var ka=v.isEmpty,T=!1;metaBook.ID=c;metaBook.getTitle=function(a,b){var c;return a.sbooktitle||((c=a.codexbaseid||a.id)&&metaBook.docinfo[c]?d(metaBook.docinfo[c].title):d(a.title))||b&&y.textify(a).replace(/\n(\s*\n)+/g,"\n").replace(/^\n+/,"").replace(/\n+$/,"").replace(/\n+/g," // ").replace(/^\s*\/\//,"")};metaBook.Info=function(a){return a?"string"===typeof a?metaBook.docinfo[a]||
metaBook.glossdb.probe(a)||E.resolve(a):a._id?a:a.codexbaseid?metaBook.docinfo[a.codexbaseid]:a.id?metaBook.docinfo[a.id]:!1:!1};var J=["","*","**","~","~~"];metaBook.getGlossTags=function(a){for(var b=[],c=0,d=J.length;c<d;){var e=J[c++],f=a[e+"tags"];if(f){f instanceof Array||(f=[f]);for(var h=0,g=f.length;h<g;){var k=f[h++];""===e?b.push(k):b.push({prefix:e,tag:k})}}}return b};metaBook.parseTag=function(a,b){var c="tags",d=b||metaBook.knodule;"~"===a[0]?(c="~tags",a=a.slice(1)):"*"===a[0]&&"*"===
a[1]?(c="**tags",a=a.slice(2)):"*"===a[0]&&(c="*tags",a=a.slice(1));d=0<=a.indexOf("|")?d.handleSubjectEntry(a):"~tags"===c?b&&b.probe(a)||a:d.handleSubjectEntry(a);return"tags"!==c?{slot:c,tag:d}:d};var n=Knodule.addTags;metaBook.addTags=z;metaBook.setConnected=function(a){if(a&&!metaBook.connected){var b=metaBook._onconnect;metaBook._onconnect=!1;if(b&&b.length)for(var c=0,d=b.length;c<d;)b[c++]();H.getLocal("metabook.queued("+metaBook.refuri+")")&&metaBook.writeQueuedGlosses()}(a&&!metaBook.connected||
!a&&metaBook.connected)&&y.swapClass(document.body,/\b(_|cx)(CONN|DISCONN)\b/,a?"_CONN":"_DISCONN");metaBook.connected=a};metaBook.getTOCLevel=h;metaBook.getCover=function(){if(metaBook.cover)return metaBook.cover;var a=N("METABOOKCOVERPAGE")||N("SBOOKCOVERPAGE")||N("COVERPAGE");a&&(metaBook.cover=a);return a};var w=v.fillIn,sa=v.expandEntities;metaBook.fixStaticRefs=function(a){return w(sa(a).replace(/http(s)?:\/\/static.beingmeta.com\//g,metaBook.root),{bmg:metaBook.root+"g/",coverimage:metaBook.coverimage})};
v.entities.beingmeta="<span class='beingmeta'>being<span class='bmm'>m<span class='bme'>e<span class='bmt'>t<span class='bma'>a</span></span></span></span></span>";v.entities.sBooks="<span class='sbooks'><em>s</em>Books</span>";v.entities.sBook="<span class='sbooks'><em>s</em>Book</span>";v.entities.metaBook="<span class='metabook'><span class='bmm'>m<span class='bme'>e<span class='bmt'>t<span class='bma'>a</span></span></span></span>Book<sub>\u03b2</sub></span>";v.entities.metaBook="<span class='metabook'><span class='bmm'>m<span class='bme'>e<span class='bmt'>t<span class='bma'>a</span></span></span></span>Book</span>";
metaBook.urlType=function(a){return 0<a.search(/\.(jpg|jpeg)$/g)?"image/jpeg":0<a.search(/\.png$/g)?"image/png":0<a.search(/\.gif$/g)?"image/gif":0<a.search(/\.wav$/g)?"audio/wav":0<a.search(/\.ogg$/g)?"audio/ogg":0<a.search(/\.mp3$/g)?"audio/mpeg":0<a.search(/\.mp4$/g)?"video/mp4":!1};metaBook.typeIcon=function(a,b){b||(b=64);return a?"audio/mpeg"===a?ja("music",b,b):"image/"===a.slice(0,6)?ja("photo",b,b):"audio/"===a.slice(0,6)?ja("sound",b,b):ja("diaglink",b,b):ja("diaglink",b,b)};metaBook.mediaTypeClass=
function(a){return a?"audio/mpeg"===a?"musiclink":"image/"===a.slice(0,6)?"imagelink":"audio/"===a.slice(0,6)?"audiolink":!1:!1}})();fdjt.DOM.noautofontadjust=!0;(function(){function a(b,d,e){if(1===arguments.length){metaBook.postconfig=[];c.config&&k("batch setConfig: %s",b);for(var f in b)b.hasOwnProperty(f)&&a(f,b[f]);f=metaBook.postconfig;metaBook.postconfig=!1;1<c.config&&!f&&0!==f.length&&k("batch setConfig, no post processing",b);for(var g=0,l=f.length;g<l;)1<c.config&&k("batch setConfig, post processing %s",f[g]),f[g++]()}else{c.config&&k("setConfig %o=%o",b,d);f="METABOOK"+b.toUpperCase();f=document.getElementsByName(f);g=0;for(l=f.length;g<l;){var q=
f[g++];"INPUT"===q.tagName&&("checkbox"===q.type?d?G(q,!0):G(q,!1):"radio"===q.type?d===q.value?G(q,!0):G(q,!1):q.value=d)}v.hasOwnProperty(b)&&v[b]===d?c.config&&k("Redundant setConfig %o=%o",b,d):h[b]?(c.config&&k("setConfig (handler=%s) %o=%o",h[b],b,d),h[b](b,d)):c.config&&k("setConfig (no handler) %o=%o",b,d);v[b]!==d&&(v[b]=d,!e&&f.length&&m.addClass("METABOOKSETTINGS","changed"));e&&H[b]!==d&&(H[b]=d,r(H))}}function r(b){c.config&&(k("saveConfig %o",b),k("saved_config=%o",H));b?a(b):b=H;var e=
{},f;for(f in b)B.hasOwnProperty(f)&&b[f]!==B[f]&&!l(f)&&(e[f]=b[f]);c.config&&k("Saving config %o",e);z("metabook.config("+d.docuri+")",JSON.stringify(e));m.dropClass("METABOOKSETTINGS","changed");H=e}function g(a,b){metaBook[a]=b}var m=fdjt.DOM,k=fdjt.Log,q=fdjt.UI,u=fdjt.State,p=fdjt.Time,f=m.getMeta,b=fdjt.String.isEmpty,e=u.getLocal,l=u.getQuery,d=metaBook,c=metaBook.Trace,z=d.saveLocal,h={},B=metaBook.default_config,v={},H={},G=q.CheckSpan.set;metaBook.addConfig=function(a,b){1<c.config&&k("Adding config handler for %s: %s",
a,b);h[a]=b;v.hasOwnProperty(a)&&(1<c.config&&k("Applying config handler to current %s=%s",a,v[a]),b(a,v[a]))};metaBook.getConfig=function(a){return a?v[a]:v};metaBook.setConfig=a;metaBook.resetConfig=function(){a(H)};metaBook.saveConfig=r;metaBook.initConfig=function(){var h,g=p(),m=e("metabook.config("+d.docuri+")",!0)||u.getSession("metabook.config("+d.docuri+")",!0);metaBook.postconfig=[];if(m)for(h in m)m.hasOwnProperty(h)&&!l(h)&&a(h,m[h]);else m={};c.config&&k("initConfig (default) %j",B);
for(h in B)m.hasOwnProperty(h)||B.hasOwnProperty(h)&&(l(h)?a(h,l(h)):f("METABOOK."+h)?a(h,f("METABOOK."+h)):a(h,B[h]));h=metaBook.postconfig;metaBook.postconfig=!1;for(var m=0,q=h.length;m<q;)h[m++]();(h=v.devicename)&&!b(h)&&(metaBook.deviceName=h);1<c.startup&&k("initConfig took %dms",p()-g)};var x=m.getParent,y=m.getChild;metaBook.updateConfig=function(b,d,e){"undefined"===typeof e&&(e=!1);d="string"===typeof d&&document.getElementById(d)||d.nodeType&&x(d,"input")||d.nodeType&&y(d,"input")||d.nodeType&&
y(d,"textarea")||d.nodeType&&y(d,"select")||d;c.config&&k("Update config %s",b);"radio"===d.type||"checkbox"===d.type?a(b,d.checked||!1,e):a(b,d.value,e)};metaBook.propConfig=g;metaBook.addConfig("forcelayout",g);metaBook.addConfig("keyboardhelp",function(a,b){metaBook.keyboardhelp=b;q.CheckSpan.set(document.getElementsByName("METABOOKKEYBOARDHELP"),b)});metaBook.addConfig("devicename",function(a,c){b(c)?metaBook.deviceName=!1:metaBook.deviceName=c});metaBook.addConfig("holdmsecs",function(a,b){metaBook.holdmsecs=
b;q.TapHold.default_opts.holdthresh=b});metaBook.addConfig("wandermsecs",function(a,b){metaBook.wandermsecs=b;q.TapHold.default_opts.wanderthresh=b});metaBook.addConfig("taptapmsecs",function(a,b){metaBook.taptapmsecs=b;q.TapHold.default_opts.taptapthresh=b});metaBook.addConfig("syncinterval",function(a,b){metaBook.sync_interval=b;metaBook.synctock&&(clearInterval(metaBook.synctock),metaBook.synctock=!1);b&&metaBook.locsync&&(metaBook.synctock=setInterval(metaBook.syncState,1E3*b))});metaBook.addConfig("synctimeout",
function(a,b){metaBook.sync_timeout=b});metaBook.addConfig("syncpause",function(a,b){metaBook.sunc_pause=b});metaBook.addConfig("locsync",function(a,b){!b&&metaBook.synctock?(clearInterval(metaBook.synctock),metaBook.synctock=!1):b&&!metaBook.synctock&&metaBook.sync_interval&&(metaBook.synctock=setInterval(metaBook.syncState,1E3*metaBook.sync_interval));metaBook.locsync=b});metaBook.applyMetaClass=function(a,b){b||(b=a);for(var c=f(b,!0),d=0,e=c.length;d<e;)m.addClass(m.$(c[d++]),a)}})();(function(){function a(a){if(a){"string"===typeof a&&(a=G(H(a))||metaBook.content);for(var b=a.codexbaseid||a.id,d=metaBook.docinfo[b];d&&!d.level;)d=d.head,b=d.frag,a=H(b);y.nav&&l("metaBook.setHead #%s",b);a===metaBook.head?y.target&&l("Redundant SetHead"):d?(y.target&&metaBook.trace("metaBook.setHead",a),metaBook.TOC.setHead(d),window.title=d.title+" ("+document.title+")",metaBook.head&&c(metaBook.head,"sbookhead"),z(a,"sbookhead"),metaBook.setLocation(metaBook.location),metaBook.head=H(b),metaBook.TOC.setHead(d)):
(y.target&&metaBook.trace("metaBook.setFalseHead",a),metaBook.TOC.setHead(d),metaBook.head=!1)}}function r(a,b){if(b||metaBook.location!==a){y.toc&&l("Setting location to %o",a);for(var c=metaBook.Info(metaBook.head);c;){var d=document.getElementById("METABOOKTOC4"+c.frag),e=document.getElementById("METABOOKSTATICTOC4"+c.frag),h=c.head,g=c.starts_at,k=c.ends_at,h=100*(a-g)/(h&&h.ends_at-h.starts_at),m=!1,q=!1;d&&(m=f.getFirstChild(d,".progressbar"));e&&(q=f.getFirstChild(e,".progressbar"));y.toc&&
l("For tocbar %o/%o loc=%o start=%o end=%o progress=%o",m,q,a,g,k,h);0<=h&&100>=h&&(m&&(m.style.width=h+"%"),q&&(q.style.width=h+"%"));c=c.head}c=f.$(".spanbar");for(d=0;d<c.length;)g=c[d++],e=(a-g.starts)/(g.ends-g.starts),y.toc&&l("ratio for spanbar %o[%d] is %o [%o,%o,%o]",g,g.childNodes[0].childNodes.length,e,g.starts,a,g.ends),0<=e&&1>=e&&(g=f.$(".progressbox",g),0<g.length&&(g=g[0],g.style.left=Math.round(1E4*e)/100+"%"));metaBook.location=a}}function g(a){y.target&&metaBook.trace("metaBook.setTarget",
a);if(a!==metaBook.target&&(!metaBook.target||metaBook.target.id!==a.codexbaseid)){if(metaBook.target){var b=metaBook.target,d=D(b.id);c(b,"mbtarget");c(b,"mbnewtarget");c(d,"mbtarget");c(d,"mbnewtarget");B(b,a)||m(d);metaBook.target=!1}if(!a)metaBook.UI.setTarget&&metaBook.UI.setTarget(!1);else if(!k(a)&&(a.id||a.codexbaseid)){var d=(b=a.codexbaseid||a.id)&&H(b)||a,f=D(b);z(a,"mbtarget");z(a,"mbnewtarget");z(f,"mbtarget");z(f,"mbnewtarget");setTimeout(function(){c(a,"mbnewtarget");c(f,"mbnewtarget")},
3E3);e.setCookie("mbtarget",b||a.getAttribute("data-sbookid"));metaBook.target=d;metaBook.UI.setTarget&&metaBook.UI.setTarget(d);metaBook.empty_cloud&&metaBook.setCloudCuesFromTarget(metaBook.empty_cloud,d)}}}function m(a){"string"===typeof a&&(a=H(a));if(a)if(a.length){c(a,"mbhighlightpassage");for(var b=0,e=a.length;b<e;){var f=a[b++];d.Highlight.clear(f,"mbhighlightexcerpt");d.Highlight.clear(f,"mbhighlightsearch")}}else c(a,"mbhighlightpassage"),d.Highlight.clear(a,"mbhighlightexcerpt"),d.Highlight.clear(a,
"mbhighlightsearch")}function k(a){if(a.metabookui||B(a,metaBook.HUD))return!0;for(;a;){if(a.metabookui||h(a,F))return!0;a=a.parentNode}return!1}function q(a){for(var b=!1,c=0,d=f.forward;a&&200>c&&(!(b=a.codexbaseid||a.id)||!metaBook.docinfo[b]);)c++,a=d(a);return b&&metaBook.docinfo[b]?(a=metaBook.docinfo[b],{start:a.starts_at,end:a.ends_at,len:a.ends_at-a.starts_at}):!1}function u(a){for(var b=metaBook.docinfo._allinfo,c=0,d=b.length;c<d;)if(b[c].starts_at<a)c++;else break;for(;c<d&&!(b[c].starts_at>
a);)c++;return H(b[c-1].frag)}function p(a){return(a=f.$("#METABOOKSTATICTOC div.head[NAME='SBR"+a+"']"))&&1===a.length&&a[0]}var f=fdjt.DOM,b=fdjt.String,e=fdjt.State,l=fdjt.Log,d=fdjt.UI,c=f.dropClass,z=f.addClass,h=f.hasClass,B=f.hasParent,v=metaBook,H=v.ID,G=v.getHead,x=v.getTarget,y=metaBook.Trace,D,N,E;metaBook.inits.push(function(){D=metaBook.getDups;N=metaBook.saveState;E=metaBook.setHistory});metaBook.setHead=a;metaBook.setLocation=r;metaBook.location2pct=function(a){var c=metaBook.ends_at;
a=100*a/c;100<a&&(a=100);c=Math.round(Math.log(c/40)/Math.log(10))-2;0>c&&(c=0);return Math.floor(a)===a?Math.floor(a)+"%":b.precString(a,c)+"%"};metaBook.setTarget=g;metaBook.clearHighlights=m;metaBook.findExcerpt=function(a,c,d){"string"===typeof a&&(a=H(a));if(!a)return!1;a.nodeType&&(a=D(a));c=b.trim(c);var e=0===c.search(/[.,"']/)?"(^|\\s)":"\\b",h=0<c.search(/[.,"']$/)?"($|\\s)":"\\b";c=f.textRegExp(c,e,h);var g=f.findMatches(a,c,d||0,1);if(g&&g.length)return g[0];e=!1;h=-1;for(g=f.findMatches(a,
c,0,1);0<g.length;){g=g[0];if(g.start_offset>d)return 0>h?e:d-h<e.start_offset-d?e:g;e=g;h=g.start_offset;g=f.findMatches(a,c,g.endOffset+1,1)}return g&&g.length?g[0]:e};var F=/(\bhud\b)|(\bglossmark\b)|(\bleading\b)|(\bmetabookmargin\b)/;metaBook.inUI=k;metaBook.setHashID=function(a){var b=a.codexbaseid||a.id;b&&window.location.hash!==b&&("#"!==window.location.hash[0]||window.location.hash.slice(1)!==b)&&a!==metaBook.body&&a!==document.body&&b&&(window.location.hash=b)};metaBook.getLocInfo=q;metaBook.resolveLocation=
u;metaBook.GoTo=function(b,c,d,e,h){"undefined"===typeof d&&(d=!0);"undefined"===typeof e&&(e=!0);var m,p;e&&metaBook.clearStateDialog();if(b){if("string"===typeof b)m=H(b),p=q(m),p=p.start;else if("number"===typeof b)p=b,m=d&&(d.nodeType&&d.id?d:u(b));else if(b.target&&(b.location||b.offset))m=x(b.target),b.location?p=b.location:(p=q(b.target),p=p.start+b.offset);else if(b.nodeType)m=x(b),p=q(b),p=p.start;else{l.warn("Bad metabookGoTo %o",b);return}d&&d.nodeType?m=d:"string"===typeof d&&H(d)&&(m=
H(d));var v=m&&metaBook.docinfo[m.getAttribute("data-baseid")||m.id];p&&v.ends_at&&v.starts_at&&(p>v.ends_at||p<v.starts_at)&&(p=!1);var z=metaBook.bypage&&metaBook.layout&&metaBook.getPage(m,p),C=z&&parseInt(z.getAttribute("data-pagenum"),10);if(m)b=m.codexbaseid||m.id,y.nav&&l("metaBook.GoTo%s() #%o@P%o/L%o %o",c?"/"+c:"",b,C,v&&v.starts_at,m),v&&(metaBook.point=m,metaBook.hudup||metaBook.mode||(metaBook.skimming=!1)),a(m),r(p),d&&b&&!k(m)&&g(m),e&&d?metaBook.saveState({target:m.getAttribute("data-baseid")||
m.id,location:p,page:C,npages:metaBook.pagecount},h):e?metaBook.saveState({location:p,page:C,npages:metaBook.pagecount},h):h||E({target:m.getAttribute("data-baseid")||m.id,location:p,page:C,npages:metaBook.pagecount}),z?metaBook.GoToPage(z,c||"metabookGoTo",!1,!0):(metaBook.previewing&&metaBook.stopPreview(c?"goto/"+c:"goto",m),c=f.getGeometry(m,metaBook.content).top-(f.viewHeight()-50)/2,0>c&&(c=0),window.scrollTo(0,c)),metaBook.clearGlossmark&&metaBook.clearGlossmark(),"addgloss"===metaBook.mode&&
metaBook.setMode(!1,!1),metaBook.location=p;else{if(metaBook.layout instanceof fdjt.CodexLayout)metaBook.GoToPage(b,c,e);else if(b.nodeType){for(c=b;c&&!c.offsetTop;)c=c.parentNode;c&&(metaBook.content.style.offsetTop=-c.offsetTop)}metaBook.curpage?N({location:metaBook.location,page:metaBook.curpage,npages:metaBook.pagecount},!0):N({location:metaBook.location},!0)}}else l.warn("falsy arg (%s) to metabookGoTo from %s",b,c)};metaBook.anchorFn=function(a){for(var b=d.T(a);b&&!b.href;)b=b.parentNode;
b&&b.href&&"#"===b.href[0]&&(b=H(b.href.slice(1)))&&(metaBook.GoTo(b,"anchorFn"),d.cancel(a))};metaBook.JumpTo=function(a){metaBook.hudup&&metaBook.setMode(!1);metaBook.GoTo(a,"JumpTo")};metaBook.GoTOC=function(a){a&&metaBook.GoTo(a,"GoTOC");metaBook.setMode("statictoc");var b=(a=metaBook.head&&metaBook.head.id)&&metaBook.docinfo[a],b=b&&b.head&&b.head.frag;a=a&&p(a);(b=b&&p(b))&&a?(b.scrollIntoView(),f.isVisible(a)||a.scrollIntoView()):a?a.scrollIntoView():b&&b.scrollIntoView()};metaBook.Skimto=
function(a){if(metaBook.hudup){var b=metaBook.docinfo[a]||metaBook.docinfo[a.id];!b||b.sub&&0!==b.sub.length||(metaBook.setMode("statictoc"),metaBook.setHUD(!1,!1),z(document.body,"mbSKIMMING"))}metaBook.GoTo(a,"metaBookSkimTo")}})();metaBook.DOMScan=function(){function a(b,e,l){function d(a,b){if(l[a])return l[a];p.call(this,a,A);var c=m();this._live=this._changed=c;A.changes.push(this);A.changed=c;this.frag=a;l[a]=this;b.allinfo.push(this);b.locinfo.push(b.location);return this}function c(a,b){var d="undefined"===typeof b;b||(b="");if(3===a.nodeType)return b+a.nodeValue;if(1===a.nodeType){var e=H(a).position;if(d||""===e||"static"===e)for(var d=a.childNodes,e=0,f=d.length;e<f;){var h=d[e++];3===h.nodeType?b+=h.nodeValue:1===
h.nodeType&&(b=c(h,b))}}return b}function z(a){if(3===a.nodeType)return a.nodeValue.length;if(1!==a.nodeType)return 0;if(a.getAttribute("data-loclen"))return parseInt(a.getAttribute("data-loclen"),10);a=a.childNodes;for(var b=0,c=0,d=a.length;c<d;){var e=a[c++];3===e.nodeType?b+=e.nodeValue.length:1===e.nodeType&&(b+=z(e))}return b}function h(a,b,e){var g=b.location,l=b.curhead,m=b.curinfo,p=b.curlevel;b.nodecount++;if(3===a.nodeType)return e=v(a.nodeValue).length,b.location+=e,0;if(1!==a.nodeType)return 0;
var A=a.tagName,C=a.className,u=a.id;u&&(u=a.getAttribute("data-tocid")||u);if(!(metaBook.ignore&&metaBook.ignore.match(a)||G&&a.namespaceURI!==G||C&&("string"!==typeof C||0<=C.search(/\b(sbookignore|metabookignore)\b/))||a.metabookui||u&&0===u.search("METABOOK"))){3<r.domscan&&k("Scanning %o level=%o, loc=%o, head=%o: %j",a,p,g,l,m);if(!u&&!metaBook.baseid){if(g=!1,(0===A.search(/p|h\d|blockquote|li/i)||0===H(a).display.search(/block|list-item|table|table-row/))&&a.childNodes&&a.childNodes.length&&
(g=B(a))){var E="WSN_"+g,g=E,U=1;if("WSN_"!==E){for(;document.getElementById[g]||x[g];)g=E+"_"+U++;E!==g&&(u=q.textify(a),k.warn("Duplicate WSN ID %s: %s",g,u));u=a.id=g;x[g]=a}}}else if(u&&metaBook.baseid&&0!==u.search(metaBook.baseid))u=!1;else if(u)if(x[u])if(x[u]!==a){g=u+"x"+b.location;if(x[u]){E=1;for(U=g+"x"+E;x[U];)E++,U=g+"x"+E;g=U}k.warn("Duplicate ID=%o newid=%o",u,g);u=a.id=g;e[g]||(e[g]=new d(g,b));x[g]=a}else x[u]=a;else x[u]=a;E=0;if((g=a.metabooktocloc||a.getAttribute("data-tocloc"))&&
e[g]){C=e[g];p=b.curlevel;l=b.curhead;m=b.curinfo;g=b.notoc;C=C.head;b.curinfo=C;b.curhead=C.elt||document.getElementById(C.frag);b.curlevel=C.level;b.notoc=!0;a=a.childNodes;E=0;for(C=a.length;E<C;)A=a[E++],1===A.nodeType&&h(A,b,e);b.curlevel=p;b.notoc=g;b.curhead=l;b.curinfo=m}else{g=u&&f(a,p);if(b.notoc||"header"===A)b.notoc=!0,g=0;b.eltcount++;A=u&&e[u];!A&&u&&(N.push(u),A=new d(u,b),e[u]=A,A.elt=a);A&&u&&a.id&&a.id!==u&&(e[a.id]=A);A&&(A.starts_at=b.location,A.sbookhead=l.getAttribute("data-tocid")||
l.id,A.headstart=m.starts_at);u&&A&&!y&&(metaBook.start=y=a);A&&g&&!A.toclevel&&(A.toclevel=g);u&&A&&(E=a.getAttributeNS&&a.getAttributeNS("tags","http://sbooks.net/")||a.getAttribute("tags")||a.getAttribute("data-tags"))&&(A.atags=E.split(","));if(!(C&&0<=C.search(/\bsbookignore\b/)||metaBook.ignore&&metaBook.ignore.match(a))){if(g&&!A.tocdone){U=u;u=g;E=p;p=e[U]||(e[U]=new d(U,b));b.headcount++;D.push(U);1<r.domscan&&k("Scanning head item %o under %o at level %d w/id=#%s ",a,l,u,U);p.starts_at=
b.location;p.level=u;p.elt=a;p.sub=[];p.frag=U;U=a.toctitle||a.getAttributeNS&&a.getAttributeNS("toctitle","http://sbooks.net")||a.getAttribute("toctitle")||a.getAttribute("data-toctitle")||a.title;if(!U){var F=q.getFirstChild(a,"H1,H2,H3,H4,H5,H6");F&&(U=F.toctitle||F.getAttributeNS&&F.getAttributeNS("toctitle","http://sbooks.net")||F.getAttribute("toctitle")||F.getAttribute("data-toctitle")||F.title);U=!U&&F?c(F):c(a)}"string"===typeof U?(U=v(U),U=""===U?!1:U):U=q.textify(U,!0);p.title=U;p.next=
!1;p.prev=!1;p.sectag=p.title?"\u00a7"+v(p.title):"\u00a7Anonymous Section";if(u>E)p.head=m,p.indexRef("head",m),m.intro_ends_at||(m.intro_ends_at=b.location),m.sub.push(p),b.lastlevel===u&&(p.prev=b.lastinfo,b.lastinfo.next=p,delete b.lastlevel,delete b.lasthead,delete b.lastinfo);else{E=m;for(m=m.level;E;){2<r.domscan&&k("Finding head@%d: scan=%o, info=%j, sbook_head=%o, cmp=%o",m,l||!1,E,m<u);if(m<u)break;u===m&&(p.prev=E,E.next=p);E.ends_at=b.location;b.tagstack=b.tagstack.slice(0,-1);E=E.head;
l=E.elt||document.getElementById(E.frag);m=E?E.level:0}2<r.domscan&&k("Found parent: up=%o, upinfo=%o, atlevel=%d, sbook_head=%o",l||!1,E,E.level,E.head);p.head=E;p.indexRef("head",E);E.sub.push(p)}m=p.head;l=[];m.heads&&(l=l.concat(m.heads));m&&l.push(m);p.heads=l;p.indexRef("heads",l);2<r.domscan&&k("@%d: Found head=%o, headinfo=%o, sbook_head=%o",b.location,a,p,p.head);b.curhead=a;b.curinfo=p;b.curlevel=u;p&&(p.ends_at=b.location+z(a));b.location+=z(a)}else A&&(A.head=m,A.indexRef("head",m));if(C&&
0<=C.search(/\bsbookterminal\b/)||C&&metaBook.terminals&&metaBook.terminals.match(a))b.location+=z(a);else for(p=a.childNodes,E=0,C=p.length;E<C;)m=p[E++],3===m.nodeType?(m=v(m.nodeValue),b.location+=m.length):1===m.nodeType&&h(m,b,e);A&&(A.ends_at=b.location);g&&(b.lasthead=a,b.lastinfo=A,b.lastlevel=g)}}}}var B=fdjt.WSN.md5ID,v=g.stdspace,H=q.getStyle,G=b.namespaceURI,x={};if("undefined"===typeof b)return this;l||(l=this instanceof a?this:new a);b||(b=metaBook.docroot||document.body);var y=new Date,
D=[],N=[];l._root=b;l._heads=D;l._ids=N;b.id||(b.id="SBOOKROOT");if(1<r.startup||r.domscan)b.id?k("Scanning %s#%s for structure and metadata",b.tagName,b.id):k("Scanning DOM for structure and metadata: %o",b);var E=b.childNodes,F={curlevel:0,idserial:0,location:0,nodecount:0,eltcount:0,headcount:0,tagstack:[],taggings:[],allinfo:[],locinfo:[],idmap:x,idstate:{prefix:!1,count:0},idstack:[{prefix:!1,count:0}],pool:metaBook.docdb},A=new u(e);d.prototype=new p;A.refclass=d;l._docdb=A;e=l[b.id]||(l[b.id]=
new d(b.id,F));F.curhead=b;F.curinfo=e;e.title=b.title||document.title;e.starts_at=0;e.level=0;e.sub=[];e.head=!1;e.heads=[];e.frag=b.id;e.elt=b;F.allinfo.push(e);F.allinfo.push(0);for(b=0;b<E.length;)e=E[b++],e.sbookskip||e.metabookui||h(e,F,l);l._nodecount=F.nodecount;l._headcount=F.headcount;l._eltcount=F.eltcount;l._maxloc=F.location;l._allinfo=F.allinfo;l._locinfo=F.locinfo;for(E=F.curinfo;E;)E.ends_at=F.location,E=E.head;E=new Date;(r.startup||r.domscan)&&k("Gathered metadata in %f secs over %d heads, %d nodes",
(E.getTime()-y.getTime())/1E3,F.headcount,F.eltcount);l.addContent=function(a){h(a,F,l);l._nodecount=F.nodecount;l._headcount=F.headcount;l._eltcount=F.eltcount;l._maxloc=F.location;l._allinfo=F.allinfo;l._locinfo=F.locinfo;for(a=F.curinfo;a;)a.ends_at=F.location,a=a.head};return l}var r=metaBook.Trace,g=fdjt.String,m=fdjt.Time,k=fdjt.Log,q=fdjt.DOM,u=fdjt.RefDB,p=u.Ref,f=metaBook.getTOCLevel;a.prototype.toJSON=function(){var a={constructor:"metaBook.DOMScan",frag:this.frag,head:this.sbookhead,start:this.starts_at,
end:this.ends_at};this.WSNID&&(a.WSNID=this.WSNID);this.headstart&&(a.headstart=this.headstart);this.toclevel&&(a.toclevel=this.toclevel);this.title&&(a.title=this.title);return JSON.stringify(a)};a.getTOCLevel=f;return a}();(function(){function a(){f("Executing %s",D.value);var a=eval(D.value),a=a.nodeType?b("%o",a):b("%j",a);f("Result is %s",a)}function r(b){1<H.gesture&&f("consolebutton_click %o",b);a()}function g(b){b=b||window.event;13!==b.keyCode||b.ctrlKey||(e.cancel(b),a(),b.shiftKey&&(D.value=""))}function m(a){for(var b=p("div"),c=a.childNodes,d=[],e=0,f=c.length;e<f;)d.push(c[e++]);for(e=0;e<f;)b.appendChild(d[e++]);a.appendChild(b);return new x(a)}function k(a){a.id&&0===a.id.search("METABOOK")&&a.removeAttribute("style");
if(a.childNodes){a=a.childNodes;for(var b=0,c=a.length;b<c;){var d=a[b++];1===d.nodeType&&k(d)}}}function q(a,b){for(var c=E(a.childNodes),d=0,e=c.length;d<e;){var f=c[d++];if(1===f.nodeType&&(f.id===b.id||f.id===b.id+"HOLDER")){a.replaceChild(b,f);return}}a.appendChild(b)}function u(a){var b=e.T(a),c=d("METABOOKCOVER");metaBook.statedialog&&(fdjt.Dialog.close(metaBook.statedialog),metaBook.statedialog=!1);if(!fdjt.UI.isClickable(b))if(B(b,d("METABOOKCOVERCONTROLS"))){for(;b&&b!==document.body&&!b.getAttribute("data-mode");)b=
b.parentNode;var h=b.getAttribute("data-mode");"layers"!==h||d("SBOOKSAPP").src||metaBook.appinit||metaBook.initIFrameApp();var g=c.className,k=g&&F[g]&&d(F[g]),l=h&&F[h]&&d(F[h]);k&&l&&(k.style.display="block",l.style.display="block",setTimeout(function(){k.style.display="";l.style.display=""},3E3));setTimeout(function(){H.mode&&f("On %o, switching cover mode to %s from %s",a,h,g);"console"===h&&f.update();c.className=h;metaBook.mode=h},20);fdjt.UI.cancel(a)}else{if(!B(b,d("METABOOKCOVERMESSAGE"))){for(;b&&
b.parentNode!==c;)b=b.parentNode;if(b&&1===b.nodeType&&b.scrollHeight>b.offsetHeight)return}metaBook.clearStateDialog();metaBook.hideCover();e.cancel(a)}}var p=fdjt.DOM,f=fdjt.Log,b=fdjt.String,e=fdjt.UI,l=fdjt.Time,d=fdjt.ID,c=p.dropClass,z=p.addClass,h=p.hasClass,B=p.hasParent,v=p.getChildren,H=metaBook.Trace,G=metaBook.fixStaticRefs,x=window.IScroll,y=p.hasContent,D=!1,N=!1;metaBook.setupCover=function(){var a=d("METABOOKFRAME"),b=l(),c=p("div#METABOOKCOVER.metabookcover"),e=d("METABOOKCOVER");
2<H.startup&&f("Setting up cover");a||(a=p("div#METABOOKFRAME"),p.prepend(document.body,a));metaBook.Frame=a;c.innerHTML=G(metaBook.HTML.cover);var h=d("METABOOKCOVERPAGE");h?y(h,!0)||(h.removeAttribute("style"),h=!1):(h=d("SBOOKCOVERPAGE"))?(h=h.cloneNode(!0),h.removeAttribute("style"),p.stripIDs(h),h.id="METABOOKCOVERPAGE"):metaBook.coverimage?(h=p.Image(metaBook.covermage),h=p("div#METABOOKCOVERPAGE",h)):h=!1;if(h)c.setAttribute("data-defaultclass","coverpage"),z(c,"coverpage"),q(c,h);else{var t=
fdjt.DOM.getChild(c,"#METABOOKCOVERCONTROLS");c.setAttribute("data-defaultclass","titlepage");z(c,"titlepage");z(t,"nocoverpage")}(t=d("METABOOKTITLEPAGE"))&&y(t,!0)?(t=t.cloneNode(!0),t.removeAttribute("style"),t.id="METABOOKTITLEPAGE"):(t=d("SBOOKSTITLEPAGE")||d("SBOOKTITLEPAGE")||d("TITLEPAGE"))?(t=t.cloneNode(!0),p.dropClass(t,/\b(codex|metabook)[A-Za-z0-9]+\b/),p.addClass(t,"sbooktitlepage"),p.stripIDs(t),t.setAttribute("style",""),t.id="METABOOKTITLEPAGE"):(t=metaBook.getBookInfo(),t=p("div#METABOOKTITLEPAGE.sbooktitlepage",
p("DIV.title",t.title),p("DIV.credits",t.byline?p("DIV.byline",t.byline):t.authors&&t.authors.length?p("DIV.author",t.authors[0]):!1),p("DIV.pubinfo",t.publisher&&p("P",t.publisher))));t&&q(c,t);if(t=d("METABOOKCREDITSPAGE"))t=t.cloneNode(!0);else if(t=d("SBOOKSCREDITSPAGE")||d("CREDITSPAGE"))t=t.cloneNode(!0),p.stripIDs(t),t.removeAttribute("style");if(t&&y(t,!0)){var x=c.getElementById("METABOOKCREDITSPAGE");x?x.parentNode.replaceChild(t,x):c.appendChild(t)}else t=!1;t&&q(c,t);if((x=d("METABOOKBLURB")||
d("METABOOKABOUTPAGE"))&&y(x,!0))x=x.cloneNode(!0),x.id="METABOOKBLURB",x.removeAttribute("style");else var x=d("SBOOKABOUTPAGE")||d("SBOOKABOUTBOOK")||d("SBOOKSABOUTPAGE")||d("SBOOKSABOUTBOOK"),E=d("SBOOKABOUTAUTHOR")||d("SBOOKABOUTORIGIN")||d("SBOOKAUTHORPAGE")||d("SBOOKSAUTHORPAGE")||d("SBOOKABOUTAUTHORS")||d("SBOOKSABOUTAUTHORS")||d("SBOOKSABOUTAUTHOR"),x=x||E?p("div#METABOOKBLURB.metabookblurb.scrolling","\n",x,"\n",E,"\n"):!1;x&&q(c,x);E=p("div#METABOOKSETTINGS.metabooksettings.scrolling");
E.innerHTML=G(metaBook.HTML.settings);if(metaBook.DOM.settings=E){var B=fdjt.DOM.getChildren(E,".metabookinfo");B&&B.length?B=B[0]:(B=p("div#METABOOKINFO.metabookinfo"),p(E,"\n",B));B.innerHTML="<p>Title "+metaBook.docref+"#"+metaBook.sourceid+" "+(metaBook.sourcetime?" ("+metaBook.sourcetime+")":"")+(metaBook.bookbuild?"<br/>Built: "+metaBook.bookbuild:"")+"</p>\n<p>metaBook app version "+metaBook.version+" built on "+metaBook.buildhost+", "+metaBook.buildtime+"</p>\n<p>Program &amp; Interface are <span style='font-size: 120%;'>\u00a9</span> beingmeta, inc 2008-2015</p>\n"}E&&
q(c,E);B=p("div#METABOOKAPPHELP.metabookhelp.scrolling");B.innerHTML=G(metaBook.HTML.help);B&&q(c,B);var C=metaBook.DOM.console=p("div#METABOOKCONSOLE.metabookconsole.scrolling");2<H.startup&&f("Setting up console %o",C);C.innerHTML=G(metaBook.HTML.console);metaBook.DOM.input_console=D=p.getChild(C,"TEXTAREA");metaBook.DOM.input_button=N=p.getChild(C,"span.button");N.onclick=r;D.onkeypress=g;C&&q(c,C);var F=p("div#METABOOKLAYERS"),ja=p("iframe#SBOOKSAPP");ja.setAttribute("frameborder",0);ja.setAttribute("scrolling",
"auto");F.appendChild(ja);metaBook.DOM.sbooksapp=ja;F&&q(c,F);if(F=v(c,"#METABOOKCOVERCONTROLS"))h||z(F,"nobookcover"),t||z(F,"nocredits"),x||z(F,"noblurb");metaBook.touch?p.addListener(c,"touchstart",u):p.addListener(c,"click",u);metaBook.iscroll&&(x&&(metaBook.scrollers.about=m(x)),metaBook.scrollers.help=m(B),metaBook.scrollers.console=m(C),metaBook.scrollers.settings=m(E));k(c);e&&e.parentNode===a?a.replaceChild(c,e):(a.appendChild(c),e&&e.parentNode.removeChild(e));metaBook.showCover();metaBook.CSS.hidecover=
p.addCSSRule("#METABOOKCOVER","opacity: 0.0; z-index: -10; pointer-events: none; height: 0px; width: 0px;");1<H.startup&&f("Cover setup done in %dms",l()-b);return c};var E=p.toArray;metaBook.resizeCover=function(a){a||(a=fdjt.ID("METABOOKCOVER"));if(a){var b=fdjt.ID("METABOOKFRAME"),c=a.style,b=b.style,e=0;a.offsetHeight||(e=1,c.zIndex=-500,c.visibility="hidden",c.opacity=0,c.display="block",c.height="100%",c.width="100%",b.display="block");a=d("METABOOKCOVERCONTROLS");var f=d("METABOOKUSERBOX");
p.adjustFontSize(a);p.adjustFontSize(f);(a=d("METABOOKTITLEPAGE"))&&!h(a,/\b(adjustfont|fdjtadjustfont)\b/)&&p.adjustFontSize(a);e&&(c.zIndex="",c.display="",c.opacity="",c.visibility="",b.display="")}};var F={coverpage:"METABOOKCOVERPAGE",titlepage:"METABOOKTITLEPAGE",creditspage:"METABOOKCREDITSPAGE",blurb:"METABOOKBLURB",help:"METABOOKAPPHELP",settings:"METABOOKSETTINGS",layers:"METABOOKLAYERS"};metaBook.addConfig("showconsole",function(a,b){b?z(document.body,"_SHOWCONSOLE"):c(document.body,"_SHOWCONSOLE")})})();(function(){var a=fdjt.DOM,r=fdjt.Log,g=fdjt.ID,m=fdjt.Time,k=a.dropClass,q=a.addClass,u=a.getGeometry,p=a.getChildren,f=a.getChild,b=a.toArray,e=fdjt.String.isEmpty,l=metaBook,d=metaBook.Trace,c=l.applyMetaClass,z=l.fixStaticRefs,h=1;metaBook.initBody=function(){var l=document.body,v=m(),u=g("CODEXCONTENT"),G=u||a("div#CODEXCONTENT"),x,y;2<d.startup&&r("Starting initBody");q(G,"metabookcontent");q(G,"codexroot");l.setAttribute("tabindex",1);l.style.fontSize="";l.style.width="";metaBook.content=G;
var D=g("SBOOKNOTES")||a("div.sbookbackmatter#SBOOKNOTES");c("sbooknote");c("sbooknote","SBOOKS.note");q(a.$("span[data-type='footnote']"),"sbooknote");var N=p(G,".sbooknote");x=0;for(y=N.length;x<y;){var E=N[x++],F=h++,A="METABOOKNOTE"+F,L="METABOOKNOTE"+F+"_ref",O=E.getAttribute("data-label")||""+F,P=f(E,"label")||f(E,"summary")||f(E,".sbooklabel")||f(E,".sbooksummary"),F=a.Anchor("#"+A,"A.mbnoteref.sbooknoteref",P?P.cloneNode(!0):O),O=a.Anchor("#"+L,"A.mbackref",P?P.cloneNode(!0):O);F.id=L;a.replace(E,
F);k(E,"sbooknote");E="SPAN"===E.tagName?a("div.metabooknotebody",O,b(E.childNodes)):a("div.metabooknotebody",O,E);E.id=A;a.append(D,E,"\n")}if(!u){u=[];N=l.childNodes;x=0;for(y=N.length;x<y;)u.push(N[x++]);for(x=0;x<y;)N=u[x++],1!==N.nodeType?G.appendChild(N):N.id&&0===N.id.search("METABOOK")||/(META|LINK|SCRIPT)/gi.test(N.tagName)||G.appendChild(N)}x=/^http(s)?:\/\/([a-z]+.)?wikipedia.org\//;y=G.getElementsByTagName("A");u=0;for(N=y.length;u<N;)if(A=y[u++],(F=A.getAttribute("href"))&&"#"!==F[0]&&
0===F.search(/^[a-zA-Z][a-zA-Z][a-zA-Z]+:/))E=A.className,L="extref",0!==F.search(x)||(F=fdjt.DOM.textify(A),e(F))||(A.title?0<=A.title.search(/wikipedia/i)||(A.title="Wikipedia: "+A.title):A.title="From Wikipedia",L+=" wikiref"),A.className=E?E+" "+L:L,A.target="_blank";u=p(G,"a[rel='sbooknote'],a[rel='footnote'],a[rel='endnote']");x=0;for(y=u.length;x<y;)N=u[x++].href,a.hasText(N)||(N.innerHTML="Note"),N&&"#"===N[0]&&q(fdjt.ID(N.slice(1)),"sbooknote");D.childNodes.length&&a.append(G,"\n",D,"\n");
metaBook.cover=metaBook.getCover();metaBook.titlepage=g("SBOOKTITLEPAGE");D=metaBook.pages=g("METABOOKPAGES")||a("div#METABOOKPAGES");D=metaBook.page=a("div#CODEXPAGE.metabookcontent",D);metaBook.body=g("METABOOKBODY");metaBook.body?metaBook.body.appendChild(D):(G=metaBook.body=a("div#METABOOKBODY.metabookbody",G,D),metaBook.justify&&q(G,"metabookjustify"),metaBook.bodycontrast&&q(G,"metabookcontrast"+metaBook.bodycontrast),metaBook.bodysize&&q(G,"metabookbodysize"+metaBook.bodysize),metaBook.bodyfamily&&
q(G,"metabookbodyfamily"+metaBook.bodyfamily),metaBook.bodyspacing&&q(G,"metabookbodyspacing"+metaBook.bodyspacing),l.appendChild(G));l=a("div#SBOOKTOPLEADING.leading.top"," ");G=a("div#SBOOKBOTTOMLEADING.leading.bottom"," ");l.metabookui=!0;G.metabookui=!0;l=a("div#METABOOKPAGECONTROLS");G=a("div");G.innerHTML=z(metaBook.HTML.pageleft);D=b(G.childNodes);x=0;for(y=D.length;x<y;)l.appendChild(D[x++]);G.innerHTML=z(metaBook.HTML.pageright);D=b(G.childNodes);x=0;for(y=D.length;x<y;)l.appendChild(D[x++]);
a.prepend(document.body,l);window.scrollTo(0,0);l=((l=a.getStyle(document.body).backgroundColor)?"transparent"===l?!1:0<=l.search(/rgba/)?!1:l:!1)||"white";metaBook.backgroundColor=l;"transparent"===l&&(l=a.getStyle(document.body).backgroundColor);l&&0<=l.search("rgba")&&!(0<l.search(/,\s*0\s*\)/))&&(l=l.replace("rgba","rgb"),l.replace(/,\s*((\d+)|(\d+.\d+))\s*\)/,")"));1<d.startup&&r("initBody took %dms",m()-v);metaBook.Timeline.initBody=m()};metaBook.sizeContent=function(){var b=metaBook.sized=
m(),c=metaBook.content,e=metaBook.page,f=document.body,h=a.viewHeight(),g=a.viewWidth();c.style.left=e.style.left="";c.style.right=e.style.right="";f.style.overflow="hidden";metaBook.sizeCodexPage();c=u(e,e.offsetParent,!0);f=a("DIV.codexpage.curpage");e.appendChild(f);var k=u(f,e,!0),e=c.inner_width,l=c.inner_height,g=Math.floor((g-e)/2)+k.right_border;a.remove(f);metaBook.CSS.pagerule?(metaBook.CSS.pagerule.style.width=e+"px",metaBook.CSS.pagerule.style.height=l+"px"):metaBook.CSS.pagerule=a.addCSSRule("div.codexpage",
"width: "+e+"px; height: "+l+"px;");metaBook.CSS.glossmark_rule?metaBook.CSS.glossmark_rule.style.marginRight=-g+"px":metaBook.CSS.glossmark_rule=a.addCSSRule("#CODEXPAGE .glossmark","margin-right: "+-g+"px;");g=metaBook.CSS.shrinkrule;g||(g=a.addCSSRule("body.mbSHRINK #CODEXPAGE,body.mbPREVIEW #CODEXPAGE, body.mbSKIMMING #CODEXPAGE",""),metaBook.CSS.shrinkrule=g);h=(h-150)/c.height;1<h&&(h=1);g.style[a.transform]="scale("+h+","+h+")";document.body.style.overflow="";1<d.startup&&r("Content sizing took %dms",
m()-b)}})();(function(){function a(a,b){a||(a=metaBook._publisher_index||window._sbook_autoindex);if(a){if(1<D.startup||D.indexing)a._nkeys?d("Processing provided index of %d keys and %d refs",a._nkeys,a._nrefs):d("Processing provided index");metaBook.useIndexData(a,metaBook.knodule,!1,b)}else b&&b()}function r(){(D.indexing||D.startup)&&d("Content indexing is completed");metaBook._setup?g():metaBook.onsetup=g}function g(){var a=Math.max(D.startup,D.clouds),b=metaBook.addTag2Cloud,c=metaBook.empty_cloud,e=metaBook.gloss_cloud,
f=metaBook.taglist||fdjt.ID("METABOOKTAGLIST");f||(f=metaBook.taglist=fdjt.DOM("datalist#METABOOKTAGLIST"),document.body.appendChild(f));var h=metaBook.searchlist||fdjt.ID("METABOOKSEARCHLIST");h||(h=metaBook.searchlist=fdjt.DOM("datalist#METABOOKSEARCHLIST"),document.body.appendChild(h));var g=Knodule.knodeToOption;z();metaBook.empty_query.results=[].concat(metaBook.glossdb.allrefs).concat(metaBook.docdb.allrefs);var q=metaBook.searchtags=metaBook.empty_query.getCoTags(),p=metaBook.empty_query.tagfreqs;
a&&d("Setting up initial tag clouds for %d tags",q.length);G(document.body,"mbINDEXING");l(c.dom,l("div.cloudprogress","Cloud Shaping in Progress"));G(c.dom,"working");l(e.dom,l("div.cloudprogress","Cloud Shaping in Progress"));G(e.dom,"working");v.slowmap(function(a){if(a instanceof KNode){var d=b(a,c,metaBook.knodule,p,p,!1);"\u00a7"!==a._id[0]&&(f.appendChild(g(a)),h.appendChild(g(a)),a.weak||(G(d,"cue"),b(a,e)))}else"string"!==typeof a||y(a)||(d=l("OPTION",a),d.value=a,h.appendChild(d))},q,{watchfn:k,
done:m,slice:200,space:20})}function m(a){var b=metaBook.empty_query,c=metaBook.empty_cloud,e=metaBook.gloss_cloud,f=fdjt.ID("METABOOKSEARCHLIST"),h=Knodule.knodeToOption;1<D.startup&&d("Done populating clouds with %d tags",a.length);H(document.body,"mbINDEXING");b.cloud=c;l.getChild(c.dom,".showall")||l.prepend(c.dom,metaBook.UI.getShowAll(!0,c.values.length));v.slowmap(function(a){f.appendChild(h(a))},metaBook.textindex.allterms,{slice:100,space:20});metaBook.sortCloud(c);metaBook.sortCloud(e);
metaBook.sizeCloud(c,metaBook.tagfreqs,[]);metaBook.sizeCloud(e,metaBook.tagfreqs,[])}function k(a,b,c){var e=Math.max(D.startup,D.clouds),f=100*b/c;"after"===a&&(1<e&&d("Added %d (%d%% of %d tags) to clouds",b,Math.floor(f),c),B.ProgressBar.setProgress("METABOOKINDEXMESSAGE",f),B.ProgressBar.setMessage("METABOOKINDEXMESSAGE",h("Added %d tags (%d%% of %d) to clouds",b,Math.floor(f),c)))}function q(a,b,c){"suspend"===a&&d("Processed %d/%d (%d%%) of provided tags",b,c,Math.floor(100*b/c))}function u(){for(var a=
l.$(".sbooktags"),b=0,c=a.length;b<c;){var d=a[b++],e=metaBook.getTarget(d),e=metaBook.docinfo[e.id],f=l.textify(d),d=d.getAttribute("tagsep")||";",d=f.split(d);if(d.length)for(var f=0,h=d.length;f<h;)N(e,d[f++])}}function p(){for(var a=l.$(".sbooktag"),b=0,c=a.length;b<c;){var d=a[b++],e=metaBook.getTarget(d),e=metaBook.docinfo[e.id],d=l.textify(d);N(e,d)}}function f(){var a=metaBook.docinfo,b=document.getElementsByTagName("A");if(b)for(var c=0,d=b.length;c<d;)if("tag"===b[c].rel){for(var e=b[c++],
f=e;f&&!f.id;)f=f.parentNode;if(!f)break;var h=e.href,g=e.name,k=!1;g?(h=e.getAttribute("data-def")||e.getAttribute("data-def"),e=e.title,k=h?"|"===h[0]?k+h:k+"|"+h:e?"|"===e[0]?g+e:0<e.indexOf("|")?g+"|"+e:g+"|~"+e:g):h&&(g=h.search(/[^\/]+$/),k=0>g?h:h.slice(g));k&&N(a[f.id],k)}else c++}function b(a,b){function c(a,b,e){if("suspend"===a||"finishing"===a)a=100*b/e,1<f&&d("Processed %d/%d (%d%%) inline tags",b,e,Math.floor(a)),B.ProgressBar.setProgress("METABOOKINDEXMESSAGE",a),B.ProgressBar.setMessage("METABOOKINDEXMESSAGE",
h("Assimilated %d (%d%% of %d) inline tags",b,Math.floor(a),e))}var f=Math.max(D.startup,D.clouds),g=[],k=0;(1<D.startup||1<D.indexing)&&d("Applying inline tag attributes from content");for(var l in a){var m=a[l];m.atags&&(k++,g.push(m))}(D.indexing&&g.length||1<D.indexing||1<D.startup)&&d("Indexing tag attributes for %d nodes",g.length);v.slowmap(e,g,{watchfn:100<g.length&&c,done:function(){(1<D.indexing&&g.length||24<g.length)&&d("Finished indexing tag attributes for %d nodes",g.length);b&&b()},
slice:200,space:5})}function e(a){a.atags&&N(a,a.atags);if(a.sectag){N(a,a.sectag,"tags",metaBook.knodule);var b=metaBook.knodule.ref(a.sectag);metaBook.tagweights.set(b,metaBook.docdb.find("head",a).length)}}var l=fdjt.DOM,d=fdjt.Log,c=fdjt.ID,z=fdjt.Time,h=fdjt.String,B=fdjt.UI,v=fdjt.Async,H=l.dropClass,G=l.addClass,x=l.getLink,y=h.isEmpty,D=metaBook.Trace,N=metaBook.addTags;metaBook.useIndexData=function(a,b,c,e){function f(b){var c=a[b];h++;var d=[],e=b.indexOf("|"),n=b.search(/[^*~]/),q=b,v=
b,u=!1,A=!1;0<e?(q=b.slice(0,e),v=b.slice(n,e)):v=q=b.slice(n);(u=k||"~"!==b[0]?metaBook.knodule.handleSubjectEntry(b):metaBook.knodule.probe(q)||metaBook.knodule.probe(v))?(A=u.weight,p.set(u,A)):0<e&&(b=b.slice(e),e=b.search("|:weight="),0<=e&&(A=b.indexOf("|",e+1),A=0<=A?parseFloat(b.slice(e+9,A)):parseFloat(b.slice(e+9)),p.set(v,A)));A>r&&(r=A);A<x&&(x=A);u||(A=3>v.length?v:v.slice(0,3),l.push(v),m.hasOwnProperty(A)?m[A].push(v):m[A]=[v]);A=0;b=c.length;for(g+=b;A<b;){var e=c[A++],y="string"===
typeof e?e:e[0];if(n=metaBook.docinfo[y]){if("string"!==typeof e){var z=n.knodeterms,B=u?u._qid:v;n.knodeterms?(y=z[B])||(z[B]=y=[]):(z=n.knodeterms={},z[B]=y=[]);z=1;for(B=e.length;z<B;)y.push(e[z++])}d.push(n)}else metaBook.missing_nodes.push(y)}N(d,u||q)}var h=0,g=0,k=!1,l=metaBook.allterms,m=metaBook.prefixes,p=metaBook.tagweights,r=metaBook.tagmaxweight,x=metaBook.tagminweight;b=Math.max(D.startup,D.indexing);c=[];if(a){for(var u in a)"_"!==u[0]&&a.hasOwnProperty(u)&&c.push(u);1E3>c.length&&
(k=!0);G(document.body,"mbINDEXING");v.slowmap(f,c,{watchfn:100<c.length&&1<b&&q,done:function(a){d("Book index links %d keys to %d refs",h,g);H(document.body,"mbINDEXING");metaBook.tagmaxweight=r;metaBook.tagminweight=x;return e?e():a},slice:200,space:10})}else e&&e()};metaBook.applyTagAttributes=b;metaBook.setupIndex=function(e){(1<D.startup||1<D.indexing)&&d("Finding and applying Technorati-style tags");f();(1<D.startup||1<D.indexing)&&d("Finding and applying tag elements from body");p();u();b(e);
if(e=metaBook._publisher_index||window._sbook_autoindex)a(e,r),metaBook._publisher_index=!1,window._sbook_autoindex=!1;else if(c("SBOOKAUTOINDEX"))e=c("SBOOKAUTOINDEX"),l.addListener(e,"load",function(b){a(!1,r);metaBook._publisher_index=!1;window._sbook_autoindex=!1});else if(e=x("SBOOKS.bookindex")){var h=document.createElement("SCRIPT");h.setAttribute("src",e);h.setAttribute("language","javascript");h.setAttribute("async","async");l.addListener(h,"load",function(){a(!1,r);metaBook._publisher_index=
!1;window._sbook_autoindex=!1});document.body.appendChild(h)}else r()}})();(function(){function a(a,b,c){if(c||!a||!(metaBook.state===a||metaBook.state&&metaBook.state.target===a.target&&metaBook.state.location===a.location&&metaBook.state.page===a.page)){a||(a=metaBook.state);a.changed||(a.changed=e.tick());a.refuri||(a.refuri=metaBook.refuri);a.docuri||(a.docuri=metaBook.docuri);var d=a.title,h=a.target;!d&&h&&metaBook.docinfo[h]&&(a.title=d=metaBook.docinfo[h].title||metaBook.docinfo[h].head.title);v.state&&f("Setting state to %j",a);a.maxloc&&a.maxloc<a.location?a.maxloc=
a.location:a.maxloc||(a.maxloc=a.location);v.state&&f("saveState skiphist=? force=? state=%j",b,c,a);metaBook.state=a;c=JSON.stringify(a);z("metabook.state("+metaBook.docuri+")",c);!D&&metaBook.locsync&&metaBook.user&&(!metaBook.xstate||a.changed>metaBook.xstate.changed)&&m(!0);!b&&h&&window.history&&window.history.pushState&&r(a,h,d)}}function r(a,b,c){v.state&&(c?f("setHistory %s (%s) state=%j",b,c,a):f("setHistory %s state=%j",b,a));if(window.history&&window.history.pushState){b||(b=a.target);
c||(c=a.title);var d=p.getURL();!c&&b&&metaBook.docinfo[b]&&(a.title=c=metaBook.docinfo[b].title||metaBook.docinfo[b].head.title);!b&&a.location&&"number"===typeof a.location&&(b="SBOOKLOC"+a.location);v.state&&f("Pushing history %j %s (%s) '%s'",a,d,c);window.history.state&&window.history.state.target===a.target&&window.history.state.location===a.location||window.history.pushState(a,c,d+"#"+b)}}function g(b,d,e){v.state&&f("Restoring (%s) state %j",d,b);b.location?metaBook.GoTo(b.location,d||"restoreState",
b.target&&c(b.target),!1,!e):b.page&&metaBook.layout?(metaBook.GoToPage(b.page,d||"restoreState",!1,!e),b.target&&c(b.target)&&G(c(b.target))):b.target&&(metaBook.GoTo(b.target,d||"restoreState",!0,!1,!e),b.target&&c(b.target)&&G(c(b.target)));b.refuri||(b.refuri=metaBook.refuri);b.docuri||(b.docuri=metaBook.docuri);a(b)}function m(a){if(!D&&metaBook.locsync&&metaBook.user)if(!a&&N&&e.tick()-N<metaBook.sync_interval)v.state&&f("Skipping state sync because it's too soon");else if(!a&&metaBook.state&&
N&&(!u.isHidden||document[u.isHidden])&&e.tick()-N<5*metaBook.sync_interval)v.state&&f("Skipping state sync because page is hidden");else if(metaBook.locsync&&navigator.onLine){a=metaBook.docuri;var b=v.state||v.network,c=metaBook.state,d=metaBook.target&&metaBook.getRefURI(metaBook.target)||metaBook.refuri,d="https://sync.sbooks.net/v1/sync?REFURI="+encodeURIComponent(d)+"&DOCURI="+encodeURIComponent(metaBook.docuri)+"&NOW="+e.tick();metaBook.last_sync=N=e.tick();D=c;metaBook.user&&(d=d+"&SYNCUSER="+
encodeURIComponent(metaBook.user._id));metaBook.mycopyid&&(d=d+"&MYCOPYID="+encodeURIComponent(metaBook.mycopyid));metaBook.deviceName&&(d=d+"&DEVICE="+encodeURIComponent(metaBook.deviceName));metaBook.ends_at&&(d=d+"&LOCLEN="+encodeURIComponent(metaBook.ends_at));if(c){c.target&&(d=d+"&TARGET="+encodeURIComponent(c.target));if(c.location||c.hasOwnProperty("location"))d=d+"&LOCATION="+encodeURIComponent(c.location);c.changed&&(d=d+"&CHANGED="+encodeURIComponent(c.changed));c.reset&&(d+="&RESET=true")}var h=
new XMLHttpRequest;D=c;h.onreadystatechange=q;h.ontimeout=k;h.withCredentials=!0;h.timeout=metaBook.sync_timeout;b&&f("syncState(call) %s",d);try{h.open("GET",d,!0),h.send()}catch(g){try{f.warn("Sync request %s returned status %d %j, pausing for %ds",a,h.status,JSON.parse(h.responseText),metaBook.sync_pause/1E3)}catch(l){f.warn("Sync request %s returned status %d, pausing for %ds",a,h.status,metaBook.sync_pause/1E3)}metaBook.locsync=!1;setTimeout(function(){metaBook.locsync=!0},metaBook.sync_pause)}}}
function k(a){f.warn("Sync request timed out, pausing for %ds",metaBook.sync_pause/1E3);metaBook.locsync=!1;setTimeout(function(){metaBook.locsync=!0},metaBook.sync_pause)}function q(a){var c=b.T(a),d=v.state||v.network;if(4===c.readyState){if(200<=c.status&&300>c.status){c=c.responseText;if(!c)return;var c=JSON.parse(c),h=e.tick();c.changed&&((d&&f("freshState %o %j\n\t%j",a,c,metaBook.state),c.changed>h+300)?f.warn("Beware of oracles (future state date): %j ",c):metaBook.state?metaBook.state.changed>
c.changed?metaBook.xstate=c:E&&E>c.changed||(document[u.isHidden]?metaBook.freshstate=c:(metaBook.xstate=c,E=e.tick(),metaBook.resolveXState(c))):(metaBook.xstate=c,g(c)))}else d&&f("syncState(callback/error) %o %d %s",a,c.status,c.responseText);navigator.onLine&&x(!0);D=!1}}var u=fdjt.DOM,p=fdjt.State,f=fdjt.Log,b=fdjt.UI,e=fdjt.Time,l=fdjt.ID,d=metaBook,c=d.ID,z=d.saveLocal,h=d.readLocal,B=d.clearLocal,v=metaBook.Trace,H=metaBook.location2pct,G,x,y;metaBook.inits.push(function(){G=metaBook.setTarget;
x=metaBook.setConnected;y=metaBook.setConfig});var D=!1;metaBook.initState=function(){var a=metaBook.docuri,b=h("metabook.state("+a+")",!0),d=metaBook.inithash;d?"#"===d[0]&&(d=d.slice(1)):d=!1;!d||!c(d)||b&&b.target===d||(b||(b={}),b.refuri=metaBook.refuri,b.docuri=metaBook.docuri,b.target=d,b.location=!1,b.changed=e.tick,z("metabook.state("+a+")",b,!0));b&&(metaBook.state=b)};metaBook.saveState=a;metaBook.setHistory=r;metaBook.restoreState=g;metaBook.clearState=function(){var a=metaBook.docuri;
metaBook.state=!1;B("metabook.state("+a+")");metaBook.xstate=!1};metaBook.resetState=function(){var a=metaBook.docuri,b=metaBook.state;b.location&&(b.maxloc=location);b.reset=!0;b=JSON.stringify(b);z("metabook.state("+a+")",b);m(!0)};var N=!1;metaBook.syncState=m;var E=!1,F=!1;metaBook.visibilityChange=function(){if(document[u.isHidden])F=e.tick();else if(!(F&&300>e.tick()-F))if(navigator.onLine)F=!1,m(!0);else if(metaBook.freshstate){var a=metaBook.freshstate;F=!1;metaBook.freshstate=!1;metaBook.xstate=
a;E=e.tick();metaBook.resolveXState(a)}};metaBook.forceSync=function(){metaBook.connected?metaBook.update():metaBook._onconnect?metaBook._onconnect.push(function(){metaBook.update()}):metaBook._onconnect=[function(){metaBook.update()}];metaBook.syncstart?m():metaBook.syncLocation()};metaBook.initLocation=function(){var a=metaBook.state;a||((a=l("METABOOKSTART")||fdjt.$1(".metabookstart")||l("SBOOKSTART")||fdjt.$1(".sbookstart")||l("SBOOKTITLEPAGE"))?(a=metaBook.getLocInfo(a),a={location:a&&a.start,
changed:978307200}):a={location:1,changed:978307200});metaBook.saveState(a,!0,!0)};metaBook.resolveXState=function(a){var c=metaBook.state;if(metaBook.sync_interval)if(metaBook.statedialog)v.state&&f("resolveXState dialog exists: %o",metaBook.statedialog);else if(v.state&&f("resolveXState state=%j, xstate=%j",c,a),c){if(a.maxloc>c.maxloc){c.maxloc=a.maxloc;var d=JSON.stringify(c);z("metabook.state("+metaBook.docuri+")",d)}if(!(c.changed>=a.changed||30>e.tick()-c.changed)){v.state&&f("Resolving local state %j with remote state %j",
c,a);var d=[],h=a.location,g=a.maxloc;g>c.location&&d.push({label:"farthest @"+H(g),title:"your farthest location on any device/app",isdefault:!1,handler:function(){metaBook.GoTo(a.maxloc,"sync");c=metaBook.state;c.changed=e.tick();metaBook.saveState(c,!0,!0);metaBook.hideCover()}});h!==c.location&&h!==g&&d.push({label:"latest @"+H(h),title:"the most recent location on any device/app",isdefault:!1,handler:function(){metaBook.restoreState(a);c=metaBook.state;c.changed=e.tick();metaBook.saveState(c,
!0,!0);metaBook.hideCover()}});d.length&&0!==c.location&&d.push({label:"current @"+H(c.location),title:"the most recent location on this device",isdefault:!0,handler:function(){c.changed=e.tick();metaBook.saveState(c,!0,!0);metaBook.hideCover()}});d.length&&d.push({label:"stop syncing",title:"stop syncing this book on this device",handler:function(){y("locsync",!1,!0)}});v.state&&f("resolveXState choices=%j",d);d.length&&(metaBook.statedialog=b.choose({choices:d,cancel:!0,timeout:7,nodefault:!0,noauto:!0,
onclose:function(){metaBook.statedialog=!1},spec:"div.fdjtdialog.resolvestate#METABOOKRESOLVESTATE"},u("div","Start at")))}}else metaBook.restoreState(a)};metaBook.clearStateDialog=function(){metaBook.statedialog&&(fdjt.Dialog.close(metaBook.statedialog),metaBook.statedialog=!1)}})();(function(){function a(a,d,e,f){var h=p();u("Setting up user %s (%s)",a._id,a.name||a.email);a&&(q.dropClass(document.body,"_NOUSER"),q.addClass(document.body,"_USER"));if(metaBook.user&&a._id!==metaBook.user._id)throw{error:"Can't change user"};var k=metaBook.sync;k&&k>f&&u.warn("Cached user information is newer (%o) than loaded (%o)",k,f);navigator.onLine&&z("metabook.queued("+metaBook.refuri+")")&&metaBook.writeQueuedGlosses();metaBook.user=metaBook.sourcedb.Import(a,!1,b.REFLOAD|b.REFSTRINGS|
b.REFINDEX);d&&(metaBook.outlets=d);e&&(metaBook.layers=e);metaBook.user.save();B("metabook.user",metaBook.user._id);B(metaBook.user._id,metaBook.user.Export(),!0);metaBook.locsync&&metaBook.setConfig("locsync",!0);c.startup&&(d=p(),u("setUser %s (%s) done in %dms",a._id,a.name||a.email,d-h));metaBook._user_setup=p();metaBook.cacheglosses&&metaBook.cacheGlosses(!0);metaBook._ui_setup&&g();return metaBook.user}function r(a){var b=metaBook.refuri;metaBook.nodeid||(metaBook.nodeid=a)&&metaBook.persist&&
h("metabook.nodeid("+b+")",a,!0)}function g(){var a=0,d;1<c.startup&&u("Starting UI setup for user");var e=p();if(metaBook.user){q.dropClass(document.body,"_NOUSER");var h=metaBook.user.name||metaBook.user.handle||metaBook.user.email;if(h){f("METABOOKUSERNAME")&&(f("METABOOKUSERNAME").innerHTML=h);f("CODEXUSERNAME")&&(f("CODEXUSERNAME").innerHTML=h);var g=document.getElementsByName("METABOOKUSERNAME");if(g&&g.length)for(a=0,d=g.length;a<d;)g[a++].innerHTML=h;if((g=document.getElementsByName("CODEXUSERNAME"))&&
g.length)for(a=0,d=g.length;a<d;)g[a++].innerHTML=h;if((g=q.$(".metabookusername"))&&g.length)for(a=0,d=g.length;a<d;)g[a++].innerHTML=h;if((g=q.$(".codexusername"))&&g.length)for(a=0,d=g.length;a<d;)g[a++].innerHTML=h}f("SBOOKMARKUSER")&&(f("SBOOKMARKUSER").value=metaBook.user._id);a=metaBook.stylesheet;d=f("METABOOKADDGLOSSPROTOTYPE");metaBook.user.fbid&&a.insertRule("#METABOOKHUD span.facebook_share { display: inline;}",a.cssRules.length);metaBook.user.twitterid&&a.insertRule("#METABOOKHUD span.twitter_share { display: inline;}",
a.cssRules.length);metaBook.user.linkedinid&&a.insertRule("#METABOOKHUD span.linkedin_share { display: inline;}",a.cssRules.length);metaBook.user.googleid&&a.insertRule("#METABOOKHUD span.google_share { display: inline;}",a.cssRules.length);if(a=q.getInput(d,"MAKER"))a.value=metaBook.user._id;if(h=metaBook.user.pic||metaBook.user.fbid&&"https://graph.facebook.com/"+metaBook.user.fbid+"/picture?type=square")if(f("SBOOKMARKIMAGE")&&(f("SBOOKMARKIMAGE").src=h),f("METABOOKUSERPIC")&&(f("METABOOKUSERPIC").src=
h),g=document.getElementsByName("METABOOKUSERPIC"))for(a=0,d=g.length;a<d;)g[a++].src=h;if(h=document.getElementsByName("IDLINK"))for(a=0,d=h.length;a<d;)g=h[a++],g.target="_blank",g.title="click to edit your personal information",g.href="https://auth.sbooks.net/my/profile";if(metaBook.user.friends)for(h=metaBook.user.friends,g=metaBook.sourcedb,a=0,d=h.length;a<d;){var k=b.resolve(h[a++],g);metaBook.addTag2Cloud(k,metaBook.gloss_cloud);metaBook.addTag2Cloud(k,metaBook.share_cloud)}metaBook.outlets&&
metaBook.addOutlets2UI(metaBook.outlets);c.startup&&(a=p(),u("setUser %s (%s), UI setup took %dms",metaBook.user._id,metaBook.user.name||metaBook.user.email,a-e));metaBook._user_ui_setup=!0}else q.addClass(document.body,"_NOUSER")}function m(){var b=metaBook.refuri,d=z("metabook.user"),e=metaBook.sync,f=z("metabook.nodeid("+b+")",!0),h=d&&z(d,!0);c.storage&&u("initOffline user=%s sync=%s nodeid=%s info=%j",d,e,f,h);e&&d&&(1<c.startup&&u("initOffline userinfo=%j",h),d=metaBook.outlets=z("metabook.outlets("+
b+")",!0)||[],b=metaBook.layers=z("metabook.layers("+b+")",!0)||[],h&&a(h,d,b,e),f&&r(f))}function k(a){function b(){a._inui=h;h.id="mbOUTLET"+a.humid;h.setAttribute("data-value",a._id);h.setAttribute("data-key",a.name);h.innerHTML=a.name;a.description&&a.nick?h.title=a.name+": "+a.description:a.description?h.title=a.description:a.nick&&(h.title=a.name);q("#METABOOKSHARECLOUD",h," ");metaBook.share_cloud.addCompletion(h)}"string"===typeof a&&(a=metaBook.sourcedb.ref(a));if(a)if(a instanceof Array)for(var c=
a,d=0,f=c.length;d<f;)k(c[d++]);else if(a instanceof e&&!a._inui){var h=q("span.completion.cue.source",a._id);a.onLoad(b,"addoutlet2cloud")}}var q=fdjt.DOM,u=fdjt.Log,p=fdjt.Time,f=fdjt.ID,b=fdjt.RefDB,e=fdjt.Ref,l=fdjt.State,d=metaBook,c=d.Trace,z=l.getLocal,h=l.setLocal,B=d.saveLocal;metaBook.setUser=a;metaBook.setNodeID=r;metaBook.setupUI4User=g;metaBook.loginUser=function(a){metaBook.user=metaBook.sourcedb.Import(a,!1,b.REFLOAD|b.REFSTRINGS|b.REFINDEX);g();metaBook._user_setup=!1};metaBook.userSetup=
function(){var b=metaBook.sync=z("metabook.sync("+metaBook.refuri+")",!0)||0,d=p(),e=!1,f=!1;metaBook.sync&&!metaBook.persist&&metaBook.clearOffline();!metaBook.nologin&&metaBook.persist&&z("metabook.user")&&(m(),c.storage&&u("Local info for %o (%s) from %o",metaBook.user._id,metaBook.user.name,metaBook.sync),metaBook.user&&metaBook.sync&&metaBook.cacheglosses&&window._sbook_loadinfo&&(window._sbook_loadinfo=!1));if(!metaBook.nologin)if(window._sbook_loadinfo&&window._sbook_loadinfo.userinfo)e=window._sbook_loadinfo,
f=e.userinfo,window._sbook_loadinfo=!1,c.storage&&u("Have window._sbook_loadinfo for %o (%s) dated %o: %j",f._id,f.name||f.email,e.sync,f),a(f,e.outlets,e.layers,e.sync),e.nodeid&&r(e.nodeid);else if(metaBook.userinfo||window._userinfo)f=metaBook.userinfo||window._userinfo,(c.storage||c.startup)&&u("Have %s for %o (%s) dated %o: %j",metaBook.userinfo?"metaBook.userinfo":"window._userinfo",f._id,f.name||f.email,f.sync||f.modified,f),a(f,f.outlets,f.layers,f.sync||f.modified);1<c.startup&&u("userSetup done in %dms",
p()-d);!metaBook.nologin&&metaBook.refuri&&window.navigator.onLine&&(metaBook.user&&b?u("Requesting additional glosses (> %s (%d)) on %s from %s for %s",p.timeString(metaBook.sync),metaBook.sync,metaBook.refuri,metaBook.server,metaBook.user._id,metaBook.user.name):metaBook.user?u("Requesting all glosses on %s from %s for %s (%s)",metaBook.refuri,metaBook.server,metaBook.user._id,metaBook.user.name):u("No user, requesting user info and glosses from %s",metaBook.server),metaBook.updateInfo())};metaBook.initUserOffline=
m;metaBook.addOutlets2UI=k})();(function(){function a(b){if(metaBook.nouser)metaBook.setConnected(!1);else{window._sbook_loadinfo!==b&&metaBook.setConnected(!0);b.sticky&&(metaBook.persist=!0);if(metaBook.user){if(b.wronguser){metaBook.clearOffline();window.location=window.location.href;return}b.userinfo&&metaBook.user&&(metaBook.user.importValue(b.userinfo),metaBook.user.save(),metaBook.setupUI4User())}else b.userinfo?metaBook.setUser(b.userinfo,b.outlets,b.layers,b.sync):(N("metabook.queued("+metaBook.refuri+")")&&metaBook.glossdb.load(N("metabook.queued("+
metaBook.refuri+")",!0)),c("METABOOKCOVER").className="bookcover",G(document.body,"_NOUSER")),b.nodeid&&metaBook.setNodeID(b.nodeid);b.mycopyid&&(metaBook.mycopyid&&b.mycopid!==metaBook.mycopyid?e.warn("Mismatched mycopyids"):metaBook.mycopyid=b.mycopyid);if(!metaBook.docinfo)metaBook.scandone=function(){a(b)};else if(!b.loaded)if(window._sbook_loadinfo&&window._sbook_loadinfo!==b)window._sbook_newinfo=b;else{var h=metaBook.refuri;metaBook.persist&&metaBook.cacheglosses&&b&&b.userinfo&&metaBook.user&&
b.userinfo._id!==metaBook.user._id&&metaBook.clearOffline();b.loaded=d();metaBook.localglosses||!N("metabook.sync("+h+")")&&!N("metabook.queued("+h+")")||f();x.glosses&&(e("loadInfo for %d %sglosses and %d refs (sync=%d)",b.glosses?b.glosses.length:0,metaBook.sync?"updated ":"",b.etc?b.etc.length:0,b.sync),e("loadInfo got %d sources, %d outlets, and %d layers",b.sources?b.sources.length:0,b.outlets?b.outlets.length:0,b.layers?b.layers.length:0));(b.glosses||b.etc)&&u(b.glosses||[],b.etc||[],function(){var a=
metaBook.cacheglosses;b.etc&&q("etc",b.etc,a);b.sources&&q("sources",b.sources,a);b.outlets&&q("outlets",b.outlets,a);b.layers&&q("layers",b.layers,a);metaBook.addOutlets2UI(b.outlets);b.sync&&(!metaBook.sync||b.sync>=metaBook.sync)&&metaBook.setSync(b.sync);metaBook.loaded=b.loaded=d();if(metaBook.whenloaded){var c=metaBook.whenloaded;metaBook.whenloaded=!1;setTimeout(c,10)}a&&(metaBook.glossdb.save(!0),metaBook.sourcedb.save(!0));metaBook.glosshash&&metaBook.showGloss(metaBook.glosshash)&&(metaBook.glosshash=
!1)});metaBook.glosses&&metaBook.glosses.update()}}}function r(a,b){function c(a){F=!1;a=JSON.parse(a.responseText);a.glosses&&a.glosses.length&&e("Received %d glosses from the server",a.glosses.length);metaBook.updatedInfo(a,l+(h?"&SYNCUSER="+h._id:"&JUSTUSER=yes"),k);h?!metaBook.ticktock&&metaBook.update_interval&&(metaBook.ticktock=setInterval(r,1E3*metaBook.update_interval)):metaBook.user?setTimeout(r,50):e.warn("Couldn't determine user!")}function f(a){if(4===a.readyState&&500>a.status)e.warn("Ajax to %s callback failed, falling back to JSONP",
l),g(l+(h?"":"&JUSTUSER=yes"),b),A=!0;else if(4===a.readyState){try{e.warn("Ajax to %s returned %d %j, taking a break",l,a.status,JSON.parse(a.responseText))}catch(c){e.warn("Ajax to %s returned %d, taking a break",l,a.status)}metaBook.ticktock&&(clearInterval(metaBook.ticktock),metaBook.ticktock=!1);setTimeout(r,metaBook.update_pause)}}var h=metaBook.user,k=d(),l="https://"+metaBook.server+"/v1/loadinfo.js?REFURI="+encodeURIComponent(metaBook.refuri),m=metaBook.sync?{}:!1;metaBook.sync&&(m["If-Modified-Since"]=
(new Date(1E3*metaBook.sync)).toString());if(!F&&navigator.onLine){F=!0;var q=0,p,u=y("GLOSS",!0),q=0;for(p=u.length;q<p;)l=l+"&GLOSS="+u[q++];u=D("GLOSS");q=0;for(p=u.length;q<p;)l=l+"&GLOSS="+u[q++];metaBook.mycopyid&&(l=l+"&MCOPYID="+encodeURIComponent(metaBook.mycopyid));metaBook.authkey&&(l=l+"&SBOOKS%3aAUTH-="+encodeURIComponent(metaBook.authkey));metaBook.sync&&(l=l+"&SYNC="+(metaBook.sync+1));h&&(l=l+"&SYNCUSER="+h._id);!h&&x.startup&&e("Requesting initial user info with %s using %s",A?"JSONP":
"Ajax",l);if(A)g(l+(h?"":"&JUSTUSER=yes"),b);else try{v(c,l+"&CALLBACK=return"+(h?"":"&JUSTUSER=yes"),[],f,m,metaBook.update_timeout)}catch(z){e.warn("Ajax call to %s failed, falling back to JSONP",l),g(l)}}}function g(a,d){if(navigator.onLine){d||(d="metaBook.updatedInfoJSONP");var e=c("METABOOKUPDATEINFO");0<a.indexOf("?")?"&"!==a[a.length-1]&&(a+="&"):a+="?";a=a+"CALLBACK="+d;var f=b("script#METABOOKUPDATEINFO");f.language="javascript";f.type="text/javascript";f.setAttribute("charset","utf-8");
f.setAttribute("async","async");metaBook.mycopyid?f.setAttribute("crossorigin","anonymous"):f.setAttribute("crossorigin","use-credentials");f.src=a;e?b.replace(e,f):document.body.appendChild(f)}}function m(a,b){if("string"===typeof a){var c=metaBook.sourcedb.ref(a);metaBook.persist&&c.load()}else c=metaBook.sourcedb.Import(a,!1,h.REFLOAD|h.REFSTRINGS|h.REFINDEX),c.save();b.push(c._id)}function k(a,b){var c=metaBook.refuri;metaBook[b]=a;metaBook.cacheglosses&&E("metabook."+b+"("+c+")",a,!0)}function q(a,
b,c){if(b)if(b instanceof Array){var d=[];if(7>b.length){c=0;for(var e=b.length;c<e;)m(b[c++],d);k(d,a)}else z.slowmap(function(a){m(a,d)},b,{done:function(){k(d,a)}})}else b=metaBook.sourcedb.Import(b,!1,h.REFLOAD|h.REFSTRINGS|h.REFINDEX),c&&b.save(),metaBook[a]=b._id,c&&E("metabook."+a+"("+metaBook.refuri+")",b._id,!0)}function u(a,b,f){"undefined"===typeof f&&(f=!0);if(0!==a.length||0!==b.length){var g=c("METABOOKNEWGLOSSES"),k=d();g&&(g.innerHTML=l("Assimilating %d new glosses",a.length),G(g,
"running"));b?a.length&&e("Assimilating %d new glosses/%d sources...",a.length,b.length):a.length&&x.glosses&&e("Assimilating %d new glosses...",a.length);metaBook.sourcedb.Import(b,!1,h.REFLOAD|h.REFSTRINGS|h.REFINDEX,!0);metaBook.glossdb.Import(a,{tags:Knodule.importTagSlot},h.REFLOAD|h.REFSTRINGS|h.REFINDEX,f);b=0;f=a.length;for(var m=metaBook.syncstamp||0;b<f;){var q=a[b++],q=q.syncstamp||q.tstamp;q>m&&(m=q)}metaBook.syncstamp=m;a.length&&e("Assimilated %d new glosses in %dms...",a.length,d()-
k);H(g,"running")}}function p(){metaBook.writeQueuedGlosses();r()}function f(){if(L)return!1;L=!0;metaBook.sync&&((x.glosses||x.startup)&&e("Starting initializing glosses from local storage"),metaBook.glosses.setLive(!1),metaBook.sourcedb.load(!0),metaBook.glossdb.load(!0).then(function(){metaBook.glosses.setLive(!0);metaBook.heartscroller&&metaBook.heartscroller.refresh();(metaBook.glossdb.allrefs.length||metaBook.sourcedb.allrefs.length)&&e("Initialized %d glosses (%d sources) from local storage",
metaBook.glossdb.allrefs.length,metaBook.sourcedb.allrefs.length)}))}var b=fdjt.DOM,e=fdjt.Log,l=fdjt.String,d=fdjt.Time,c=fdjt.ID,z=fdjt.Async,h=fdjt.RefDB,B=fdjt.State,v=fdjt.Ajax,H=b.dropClass,G=b.addClass,x=metaBook.Trace,y=B.getQuery,D=B.getHash,N=B.getLocal,E=metaBook.saveLocal;metaBook.loadInfo=a;var F=!1,A=!1;metaBook.updatedInfo=function(b,c,f){var h=metaBook.user;if(x.network||x.glosses&&b.glosses&&b.glosses.length||x.startup&&(!h||metaBook.update_interval&&!metaBook.ticktock&&x.startup))f?
e("Response (%dms) from %s",d()-f,c||metaBook.server):e("Response from %s",c||metaBook.server);F=!1;a(b);!h&&metaBook.user?metaBook.userSetup():metaBook._ui_setup&&metaBook.setupUI4User()};metaBook.updateInfo=r;metaBook.updatedInfoJSONP=function(a){var b=c("METABOOKUPDATEINFO");metaBook.updatedInfo(a,b&&b.src||"JSON")};metaBook.initGlosses=u;metaBook.update=p;b.addListener(window,"online",function(){return p()});metaBook.addConfig("glossupdate",function(a,b){metaBook.update_interval=b;metaBook.ticktock&&
(clearInterval(metaBook.ticktock),metaBook.ticktock=!1,b&&(metaBook.ticktock=setInterval(r,1E3*b)))});metaBook.addConfig("updatetimeout",function(a,b){metaBook.update_timeout=b});metaBook.addConfig("updatepause",function(a,b){metaBook.update_pause=b});var L=!1;metaBook.initGlossesOffline=f})();metaBook.Startup=function(){function a(){J.startup&&F.apply(null,arguments)}function r(){for(var a=metaBook.inits,b=0,c=a.length;b<c;)a[b++]()}function g(){F.console="METABOOKCONSOLELOG";F.consoletoo=!0;r();metaBook._setup_start||(metaBook._setup_start=new Date);F("This is metaBook v%s, built %s on %s, launched %s, from %s",T.version,T.buildtime,T.buildhost,T._setup_start.toString(),T.root||"somewhere");O("METABOOKBODY")&&(metaBook.body=O("METABOOKBODY"));aa("cxtrace")&&f();d();F("Book %s (%s) %s (%s%s)",
T.docref||"@??",T.bookbuild||"",T.refuri,T.sourceid,T.sourcetime?": "+T.sourcetime:"");metaBook.initDB();metaBook.initConfig();k();Q("metabook.user")&&(metaBook.persist=!0,metaBook.userSetup());metaBook.initState();metaBook.syncState();metaBook.user||window._sbook_loadinfo||metaBook.userinfo||window._userinfo||Q("metabook.user")||(J.startup&&F("No local user info, requesting from sBooks server %s",T.server),metaBook.updateInfo());fdjt.Init();z();c();q();metaBook._ui_setup=E();m();metaBook._user_setup&&
metaBook.setupUI4User();p();metaBook.setupGestures();metaBook.setConfig(metaBook.getConfig());1<J.startup&&F("Initializing markup converter");var a=new Markdown.Converter;metaBook.markdown_converter=a;metaBook.md2HTML=function(b){return a.makeHtml(b)};metaBook.md2DOM=function(b,c){var d=A("div"),e=d,f=document.createDocumentFragment();d.innerHTML=a.makeHtml(b);e=e.childNodes;d=[];c&&1===e.length&&1===e[0].nodeType&&"P"===e[0].tagName&&(e=e[0],e=e.childNodes);for(var h=0,g=e.length;h<g;)d.push(e[h++]);
for(h=0;h<g;)f.appendChild(d[h++]);return f};metaBook.Timeline.sync_startup=new Date;if(metaBook.onsyncstartup){var b=metaBook.onsyncstartup;delete metaBook.onsyncstartup;if(Array.isArray(b))for(var e=0,h=b.length;e<h;)b[e](),e++;else b()}J.startup&&F("Done with sync startup")}function m(){var a=fdjt.State.getCookie("SBOOKSPOPUP");a&&fdjt.UI.alertFor(10,a);fdjt.State.clearCookie("SBOOKSPOPUP","/","sbooks.net");fdjt.State.clearCookie("SBOOKSMESSAGE","/","sbooks.net")}function k(){try{document.domain=
"sbooks.net"}catch(a){F.warn("Error setting document.domain")}try{document.origin="sbooks.net"}catch(b){F.warn("Error setting document.origin")}A.addAppSchema("SBOOK","http://sbooks.net/");A.addAppSchema("SBOOKS","http://sbooks.net/");A.addAppSchema("metaBook","http://metabook.sbooks.net/");A.addAppSchema("DC","http://purl.org/dc/elements/1.1/");A.addAppSchema("DCTERMS","http://purl.org/dc/terms/");A.addAppSchema("OLIB","http://openlibrary.org/");metaBook.devinfo=D.versionInfo();"http://static.beingmeta.com/"===
metaBook.root&&"https:"===window.location.protocol&&(metaBook.root="https://s3.amazonaws.com/beingmeta/static/");if(Q("metabook.nologin")||aa("nologin"))metaBook.nologin=!0;var c=C("SBOOKS.server")||C("SBOOKSERVER");if(c)metaBook.server=c;else if(D.getCookie("SBOOKSERVER"))metaBook.server=D.getCookie("SBOOKSERVER");else{a:{for(var c=document.domain,d=metaBook.servers,e=0;e<d.length;){if(d[e][0]===c||0<=c.search(d[e][0])||d[e][0].call&&d[e][0].call(c)){c=d[e][1];break a}e++}c=!1}metaBook.server=c}metaBook.server||
(metaBook.server=metaBook.default_server);metaBook.docroot||(C("SBOOKS.root")?metaBook.docroot=S(C("SBOOKS.root")):metaBook.docroot=O("SBOOKCONTENT")||document.body);metaBook.start||(C("SBOOKS.start")?metaBook.start=S(C("SBOOKS.start")):O("SBOOKSTART")&&(metaBook.start=O("SBOOKSTART")));for(c=0;9>c;){d=document.body;if((e=C("sbookhead"+c,!0).concat(C("sbook"+c+"head",!0)).concat(C("sbook"+ab[c]+"head",!0)).concat(C("SBOOKS.head"+c,!0)))&&e.length)for(var f=0,h=e.length;f<h;)for(var g=A.getChildren(d,
e[f++]),k=0,n=g.length;k<n;){var l=g[k++];v(l)||(l.toclevel=c)}c++}c=C("sbookignore",!0).concat(C("SBOOKS.ignore",!0));c.length&&(metaBook.ignore=new A.Selector(c));c=C("sbooknotoc",!0).concat(C("SBOOKS.notoc",!0)).concat(C("SBOOKS.nothead",!0)).concat(C("sbooknothead"));c.length&&(metaBook.notoc=new A.Selector(c));c=C("sbookterminal",!0).concat(C("SBOOKS.terminal",!0));c.length&&(metaBook.terminals=new A.Selector(c.length));c=C("sbookfocus",!0).concat(C("SBOOKS.focus",!0)).concat(C("sbooktarget",
!0)).concat(C("SBOOKS.target",!0)).concat(C("SBOOKS.idify",!0));c.length&&(metaBook.focus=new A.Selector(c));c=C("sbooknofocus",!0).concat(C("SBOOKS.nofocus",!0)).concat(C("sbooknotarget",!0)).concat(C("SBOOKS.notarget",!0));c.length&&(metaBook.nofocus=new A.Selector(c))}function q(){var a=document.body,b=E();2<J.startup&&F("Starting app setup");var c=A("STYLE");A(document.head,c);metaBook.stylesheet=c.sheet;metaBook.initHUD();metaBook.setupCover();H();G();if(metaBook.refuri&&(c=document.getElementsByName("REFURI")))for(var d=
0,e=c.length;d<e;)"fillin"===c[d].value?c[d++].value=metaBook.refuri:d++;metaBook.addConfig("cacheglosses",function(a,b){metaBook.cacheGlosses(b)});u();"undefined"!==typeof a.style["pointer-events"]&&(metaBook.demo||D.getLocal("metabook.demo")||D.getCookie("sbooksdemo")||aa("demo"))&&L.Reticle.setup();J.startup&&F("App setup took %dms",E()-b);F("Body: %s",document.body.className)}function u(){var a,b,c=E(),d="string"===typeof metaBook.coverimage&&metaBook.coverimage||"string"===typeof metaBook.bookimage&&
metaBook.bookimage||"string"===typeof metaBook.bookcover&&metaBook.bookcover||"string"===typeof metaBook.coverpage&&metaBook.coverpage;if(d){var e=A.$("img.metabookbookimage");a=0;for(b=e.length;a<b;)e[a].src?a++:e[a++].src=d}if(d="string"===typeof metaBook.thumbnail&&metaBook.thumbnail)for(e=A.$("img.metabookbookthumb"),a=0,b=e.length;a<b;)e[a].src?a++:e[a++].src=d;if(d="string"===typeof metaBook.icon&&metaBook.icon)for(e=A.$("img.metabookbookicon"),a=0,b=e.length;a<b;)e[a].src?a++:e[a++].src=d;
1<J.startup&&F("Image setup took %dms",E()-c)}function p(){var a=E();metaBook.initBody();metaBook.sizeContent();J.gestures&&F("Content setup in %dms",E()-a)}function f(){for(var a=aa("cxtrace",!0),b=0,c=a.length;b<c;){var d=a[b++],e=d.indexOf(":");if(0>e)J[d]="number"===typeof J[d]?1:!0;else{var f=d.substr(0,e),d=d.substr(e+1);J[f]="number"===typeof J[f]?parseInt(d,10):d}}}function b(b){var c=!1;if(!metaBook._setup&&(b||!aa("nometabook"))){if("null"===location.hash||"#null"===location.hash)location.hash=
"";location.hash&&"#"!==location.hash&&(b=location.hash,"#"===b[0]&&(b=b.slice(1)),sa.exec(location.hash)?metaBook.glosshash=b:metaBook.inithash=location.hash);metaBook._starting=E();ja(document.body,"mbSTARTUP");g();metaBook.resizeUI();N.timeslice([function(){var a=C("SBOOKS.h1",!0,!0).concat(C("SBOOKS.head1",!0,!0)).concat(C("sbook1head",!0));a.length&&e(a,"1");a=C("SBOOKS.h2",!0,!0).concat(C("SBOOKS.head2",!0,!0)).concat(C("sbook2head",!0));a.length&&e(a,"2");a=C("SBOOKS.h3",!0,!0).concat(C("SBOOKS.head3",
!0,!0)).concat(C("sbook3head",!0));a.length&&e(a,"3");a=C("SBOOKS.h4",!0,!0).concat(C("SBOOKS.head4",!0,!0)).concat(C("sbook4head",!0));a.length&&e(a,"4");a=C("SBOOKS.h5",!0,!0).concat(C("SBOOKS.head5",!0,!0)).concat(C("sbook5head",!0));a.length&&e(a,"5");a=C("SBOOKS.h6",!0,!0).concat(C("SBOOKS.head6",!0,!0)).concat(C("sbook6head",!0));a.length&&e(a,"6");a=C("SBOOKS.h7",!0,!0).concat(C("SBOOKS.head7",!0,!0)).concat(C("sbook7head",!0));a.length&&e(a,"7");var b=O("METABOOKSTARTUPSCAN");ja(b,"running");
a=new metaBook.DOMScan(metaBook.content,metaBook.refuri+"#");metaBook.docinfo=a;metaBook.ends_at=metaBook.docinfo._maxloc;ka(b,"running");metaBook.state&&metaBook.state.target&&!metaBook.state.location&&(b=metaBook.docinfo[metaBook.state.target])&&b.starts_at&&(metaBook.state.location=b.starts_at,metaBook.saveState(!1,!0,!0));metaBook.scandone&&(b=metaBook.scandone,delete metaBook.scandone,b());c=a},function(){var a=A.hasText,b=A.getMeta("SBOOKS.index",!0),c=fdjt.ID("CODEXCONTENT");b.push("p,li,ul,blockquote,div");
b.push("h1,h2,h3,h4,h5,h6,h7,hgroup,.sbookindex");for(var b=A.getChildren(c,b.join(",")),c=metaBook.textindex=new fdjt.TextIndex,d=0,e=b.length;d<e;){var f=b[d++];a(f)&&c.indexText(f)}c.finishIndex()},function(){for(var a=P.toSet,b=metaBook.textindex,c=metaBook.docinfo,d=b.allids,e=b.idterms,f=b.allterms,b=b.termindex,h=metaBook.docdb.addIndex("strings",P.StringMap),g=0,k=f.length;g<k;){var n=f[g++];h[n]=a(b[n])}f=0;for(b=d.length;f<b;)if(h=d[f++],g=c[h])g.strings=a(e[h])},function(){metaBook.bypage?
metaBook.Paginate("initial"):ja(document.body,"_SCROLL")},function(){var b=O("METABOOKSTARTUPTOC"),d=E();b&&(b.innerHTML=x("Building table of contents based on %d heads",metaBook.docinfo._headcount),ja(b,"running"));metaBook.setupTOC(c[metaBook.content.id]);a("Built tables of contents based on %d heads in %fms",metaBook.docinfo._headcount,E()-d);b&&ka(b,"running")},function(){1<J.startup&&F("Loading sourcedb");metaBook.sourcedb.load(!0)},Knodule&&Knodule.HTML&&Knodule.HTML.Setup&&metaBook.knodule&&
function(){var a=O("METABOOKSTARTUPKNO"),b=O("METABOOKSTARTUPKNODETAILS");b&&(b.innerHTML=x("Processing knodule %s",metaBook.knodule.name));ja(a,"running");(1<J.startup||J.indexing)&&F("Processing knodule %s",metaBook.knodule.name);Knodule.HTML.Setup(metaBook.knodule);ka(a,"running")},function(){if(metaBook.sync){if(metaBook.cacheglosses)return metaBook.initGlossesOffline()}else window._sbook_loadinfo&&(metaBook.loadInfo(window._sbook_loadinfo),window._sbook_loadinfo=!1)},window._sbook_newinfo&&function(){metaBook.loadInfo(window._sbook_newinfo);
window._sbook_newinfo=!1},function(){metaBook.setupIndex(c)},l],{slice:100,space:25})}}function e(a,b){for(var c=0,d=a.length;c<d;)for(var e=A.$(a[c++]),f=0,h=e.length;f<h;)e[f++].setAttribute("data-toclevel",b)}function l(a){metaBook.glosshash&&metaBook.glossdb.ref(metaBook.glosshash)?metaBook.showGloss(metaBook.glosshash)?(metaBook.glosshash=!1,metaBook.Timeline.initLocation=E()):metaBook.initLocation():metaBook.initLocation();window.onpopstate=function(a){a.state&&metaBook.restoreState(a.state,
"popstate")};F("metaBook startup done");metaBook.resizeUI();metaBook.displaySync();A.dropClass(document.body,"mbSTARTUP");A.addClass(document.body,"mbREADY");fdjt.ID("METABOOKSPLASHPAGE")&&setTimeout(function(){ja("METABOOKSPLASHPAGE","startupdone")},3E3);var b=O("METABOOKREADYMESSAGE");O("METABOOKOPENTAB")?b.style.display="none":(b.innerHTML="Open",b.id="METABOOKOPENTAB");a||aa("startmode")&&(a=aa("startmode"));a?metaBook.setMode(a):a=metaBook.mode;metaBook._setup=new Date;metaBook._starting=!1;
metaBook.onsetup&&(b=metaBook.onsetup,metaBook.onsetup=!1,setTimeout(b,10));var c=b=!1,d=!1;if(b=aa("APPMESSAGE"))"#{"===b.slice(0,2)&&0<(c=b.indexOf("}"))?(d="MSG_"+b.slice(2,c),Q(d)||(w(d,"seen"),L.alertFor(10,b.slice(c+1)))):L.alertFor(10,b);if(b=aa("SBOOKSMESSAGE"))"#{"===b.slice(0,2)&&0<(c=b.indexOf("}"))?(d="MSG_"+b.slice(2,c),Q(d)||(w(d,"seen"),L.alertFor(10,b.slice(c+1)))):L.alertFor(10,b);if(b=X("APPMESSAGE"))L.alertFor(10,b),D.clearCookie("APPMESSAGE","sbooks.net","/");if(b=X("SBOOKSMESSAGE"))L.alertFor(10,
b),D.clearCookie("SBOOKSMESSAGE","sbooks.net","/");!a&&location.hash&&metaBook.state&&location.hash.slice(1)!==metaBook.state.target?metaBook.hideCover():!a&&metaBook.user&&(a=n("metabook.opened("+metaBook.docuri+")",!0))&&a+54E5>E()&&metaBook.hideCover();A.vischange&&A.addListener(document,A.vischange,metaBook.visibilityChange);A.addListener(window,"resize",metaBook.resizeHandler)}function d(){var a=B(),b=window.location.href,c=b.indexOf("#");metaBook.locuri=0<c?b.slice(0,c):b;document.body.refuri=
metaBook.refuri=a;metaBook.docuri=Z("SBOOKS.docuri",!1)||Z("docuri",!1)||Z("canonical",!1)||B();metaBook.topuri=document.location.href;b=Q("metabook.refuris",!0)||[];metaBook.sourceid=C("SBOOKS.sourceid")||C("SBOOKS.fileid")||metaBook.docuri;metaBook.sourcetime=C("SBOOKS.sourcetime");if((c=Q("metabook.sourceid("+metaBook.docuri+")"))&&c!==metaBook.sourceid){if((c=Q("metabook.layouts("+c+")"))&&c.length)for(var d=0,e=c.length;d<e;)t.dropLayout(c[d++])}else w("metabook.sourceid("+metaBook.docuri+")",
metaBook.sourceid);metaBook.bookbuild=C("SBOOKS.buildstamp");metaBook.bypage="bypage"===metaBook.page_style;metaBook.max_excerpt=C("SBOOKS.maxexcerpt")||metaBook.max_excerpt;metaBook.min_excerpt=C("SBOOKS.minexcerpt")||metaBook.min_excerpt;c=C("sbooknote",!0).concat(C("SBOOKS.note",!0));d=C("sbooknoteref",!0).concat(C("SBOOKS.noteref",!0));metaBook.sbooknotes=c&&c.length?A.sel(c):!1;metaBook.sbooknoterefs=d&&d.length?A.sel(d):!1;b.push(a);if(c=C("SBOOKS.docref"))metaBook.docref=c;if(c=Z("SBOOKS.coverpage",
!1,!0)||Z("coverpage",!1,!0))metaBook.coverpage=c;if(c=Z("SBOOKS.coverimage",!1,!0)||Z("coverimage",!1,!0))metaBook.coverimage=c;if(c=Z("SBOOKS.thumbnail",!1,!0)||Z("thumbnail",!1,!0))metaBook.thumbnail=c;if(c=Z("SBOOKS.icon",!1,!0)||Z("icon",!1,!0))metaBook.icon=c;if(c=C("SBOOKS.id")||C("SBOOKS.prefix")||C("SBOOKS.baseid"))metaBook.baseid=c;if(c=C("SBOOKS.prefix")||c)metaBook.prefix=c;d=C("SBOOKS.targetprefix");metaBook.targetids=d&&"*"===d?!1:d&&"/"===d[0]?new RegExp(d.slice(1,d.length-1)):d?new RegExp("^"+
d):c?new RegExp("^"+c):!1;c=A.getMeta("SBOOKS.adjustfont",!0);c.length&&(fdjt.DOM.autofont=fdjt.DOM.autofont+","+c.join(","));C("METABOOK.forcelayout")&&(R.forcelayout=!0);if(c=C("SBOOKS.autotoc"))metaBook.autotoc="y"===c[0]||"Y"===c[0]||"ON"===c||"on"===c||"1"===c||"enable"===c?!0:!1;metaBook.nologin||(metaBook.mycopyid=C("SBOOKS.mycopyid")||Q("mycopy("+a+")")||!1);metaBook.persist&&w("metabook.refuris",b,!0)}function c(){var a=navigator.userAgent,b=y,c=document.body;2<J.startup&&F("Starting device setup for %s",
a);var d=E();!b.touch&&aa("touch")&&(b.touch=aa("touch"));fdjt.TapHold.default_opts.bubble=!1;if(b.touch){A.addClass(c,"_TOUCH");fdjt.TapHold.default_opts.fortouch=!0;metaBook.ui="touch";metaBook.touch=!0;metaBook.keyboard=!1;var e=A.getHEAD(),f=C("viewport",!1,!1,!0);f||(f=document.createElement("META"),f.setAttribute("name","viewport"),f.setAttribute("content",ua),e.appendChild(f));f=C("apple-mobile-web-app-capable",!1,!1,!0);f||(f=document.createElement("META"),f.setAttribute("name","apple-mobile-web-app-capable"),
f.setAttribute("content","yes"),e.appendChild(f))}b.android&&3<=b.android?(R.keyboardhelp=!1,metaBook.updatehash=!1,metaBook.iscroll=!1):b.android?(R.keyboardhelp=!1,metaBook.updatehash=!1,metaBook.iscroll=!0):0<a.search("Safari/")&&0<a.search("Mobile/")?(h(),metaBook.iscroll=!1,metaBook.updatehash=!1,R.keyboardhelp=!1,F.doformat=!0):b.touch?(A.addClass(c,"_TOUCH"),metaBook.ui="touch"):metaBook.ui||(A.addClass(c,"_MOUSE"),metaBook.ui="mouse");metaBook.iscroll&&(A.addClass(c,"_ISCROLL"),b.iscroll=
!0);b.string=b.string+" "+(metaBook.iscroll?"iScroll":"nativescroll");1<J.startup&&F("setupDevice done in %dms: %s/%dx%d %s",E()-d,metaBook.ui,A.viewWidth(),A.viewHeight(),b.string)}function z(){if(!metaBook.bookinfo){2<J.startup&&F("Book setup");var a=metaBook.bookinfo={},b=E();a.title=C("metaBook.title")||C("SBOOKS.title")||C("DC.title")||C("~TITLE")||document.title||"untitled";var c=C("SBOOKS.author",!0).concat(C("DC.creator",!0)).concat(C("AUTHOR")).concat(C("~AUTHOR"));c&&c.length&&(a.authors=
c);a.byline=C("metaBook.byline")||C("SBOOKS.byline")||C("BYLINE")||c&&c.length&&c[0];a.copyright=C("SBOOKS.copyright")||C("SBOOKS.rights")||C("DC.rights")||C("COPYRIGHT")||C("RIGHTS");a.publisher=C("SBOOKS.pubname")||C("DC.publisher")||C("PUBLISHER");a.pubyear=C("SBOOKS.pubyear")||C("DC.date");a.description=C("SBOOKS.description")||C("DC.description")||C("DESCRIPTION");a.digitized=C("SBOOKS.digitized")||C("DIGITIZED");a.converted=O("SBOOKS.converted")||C("SBOOKS.converted");1<J.startup&&F("setupBook done in %dms",
E()-b)}}function h(){window.scrollTo(0,1);setTimeout(function(){window.scrollTo(0,0)},0)}function B(){var a=Z("SBOOKS.refuri",!1,!0)||Z("refuri",!1,!0)||C("SBOOKS.refuri",!1,!0)||C("refuri",!1,!0)||Z("canonical",!1,!0);if(a)return decodeURI(a);var a=document.location.href,b=a.indexOf("?");0<=b&&(a=a.slice(0,b));b=a.indexOf("#");0<=b&&(a=a.slice(0,b));return decodeURI(a)}function v(a){return a.toclevel||a.getAttributeNS&&a.getAttributeNS("toclevel","http://sbooks.net/")||a.getAttribute("toclevel")||
a.getAttribute("data-toclevel")||a.className&&(0<=a.className.search(/\bsbook\dhead\b/)||0<=a.className.search(/\bsbooknotoc\b/)||0<=a.className.search(/\bsbookignore\b/))?!0:!1}function H(){var a=metaBook.Zoom=A("div#METABOOKZOOM.metabookzoom.metabookcontent",A("div#METABOOKZOOMBOX",A("div#METABOOKZOOMTARGET")),A("div#METABOOKZOOMCONTROLS",A("div#METABOOKZOOMCLOSE"),A("div#METABOOKUNZOOM"),A("div#METABOOKZOOMIN"),A("div#METABOOKZOOMOUT"),A("div#METABOOKZOOMHELP"),A("div#METABOOKZOOMHELPTEXT","Drag to pan, use two fingers to zoom")));
a.metabookui=!0;document.body.appendChild(a)}function G(){var a=metaBook.Media=A("div#METABOOKMEDIA.metabookmedia.metabookcontent",A("div#METABOOKMEDIATARGET"),A("div#METABOOKCLOSEMEDIA"));a.metabookui=!0;document.body.appendChild(a)}var x=fdjt.String,y=fdjt.device,D=fdjt.State,N=fdjt.Async,E=fdjt.Time,F=fdjt.Log,A=fdjt.DOM,L=fdjt.UI,O=fdjt.ID,P=fdjt.RefDB,S=metaBook.ID,t=fdjt.CodexLayout,Q=D.getLocal,aa=D.getQuery,X=D.getCookie,C=A.getMeta,Z=A.getLink,ja=A.addClass,U=A.swapClass,ka=A.dropClass,T=
metaBook,J=metaBook.Trace,n=metaBook.readLocal,w=metaBook.saveLocal;metaBook.startupMessage=function(){J.startup&&"number"===typeof J.startup&&1<J.startup&&F.apply(null,arguments)};metaBook.setSync=function(a){if(!a)return!1;var b=metaBook.sync;if(b&&b>a)return b;metaBook.sync=a;metaBook.persist&&w("metabook.sync("+metaBook.docuri+")",a);return a};var sa=/G[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i;metaBook.Startup=b;var R=metaBook.default_config;metaBook.getBookInfo=function(){metaBook.bookinfo||
z();return metaBook.bookinfo};var ua="width=device-width,initial-scale=1.0,user-scalable=no";metaBook.hasTOCLevel=v;var ab="not A B C D E F G H I J K L".split(" ");metaBook.setupZoom=H;metaBook.setupMedia=G;metaBook.addConfig("uisound",function(a,b){metaBook.uisound=b&&!0});metaBook.addConfig("readsound",function(a,b){metaBook.readsound=b&&!0});metaBook.addConfig("bodycontrast",function(a,b){var c=fdjt.ID("METABOOKBODY");b?U(c,/\bmetabookcontrast[a-z]+\b/g,"metabookcontrast"+b):ka(c,/\bmetabookcontrast[a-z]+\b/g)});
metaBook.enableOpenSans=function(){var a=fdjt.ID("METABOOKFRAME");a&&(a.style.fontFamily="'Open Sans',Verdana, Tahoma, Arial, Helvetica, sans-serif, sans",metaBook.resizeUI())};metaBook.StartupHandler=function(){metaBook.Startup()};return b}();metaBook.Setup=metaBook.StartupHandler;(function(){function a(a,e){var f=window.scrollLeft||0,k=window.scrollTop||0;a?(a.frag&&(a=a.frag),"string"===typeof a&&(a=p(a)),a&&(d=a,l||(l={x:0,y:k}),f=r.getGeometry(a,metaBook.content),b.flips&&g("startScrollPreview/%s to %d for %o",e||"nocaller",f.top-100,a),f=f.top-(r.viewHeight()-50)/2,0>f&&(f=0),window.scrollTo(0,f))):(l?(b.flips&&g("stopScrollPreview/%s to %j from %d,%d(%o)",e||"nocaller",l,f,k,d),d=!1,window.scrollTo(l.x,l.y)):(b.flips&&g("stopScrollPreview/%s to %j from %d,%d(%o)",e||
"nocaller",l,f,k,d),d=!1),l=!1)}var r=fdjt.DOM,g=fdjt.Log,m=r.dropClass,k=r.addClass,q=r.hasClass,u=metaBook,p=u.ID,f=u.getTarget,b=metaBook.Trace,e=u.GoTo,l=!1,d=!1;metaBook.startPreview=function(c,d){var e=c.nodeType?c:p(c);b.flips&&g("startPreview %o (%s)",e,d);if(e!==metaBook.previewing)if(metaBook.layout instanceof fdjt.CodexLayout){var l=f(e)&&metaBook.getDups(e);metaBook.startPagePreview(e,d);k(e,"mbpreviewing");l&&k(l,"mbpreviewing")}else a(e,d),k(e,"mbpreviewing");metaBook.previewing=e;k(document.body,
"mbPREVIEW");q(e,"codexpage")&&k(document.body,"mbPAGEPREVIEW");return e};metaBook.stopPreview=function(c,d){for(var f=r.$(".mbpreviewing"),k=0,q=f.length;k<q;){var p=f[k++];m(p,"mbpreviewing");metaBook.clearHighlights(p)}d&&!d.nodeType&&(d=metaBook.previewTarget||metaBook.previewing);b.flips&&g("stopPreview/%s jump to %o, pt=%o, p=%o",c||"nocaller",d,metaBook.previewTarget,metaBook.previewing);metaBook.layout instanceof fdjt.CodexLayout?metaBook.stopPagePreview(c,d):(d&&d===metaBook.previewing&&
(l=!1),a(!1,c));metaBook.previewing=!1;metaBook.previewTarget=!1;m(document.body,"mbPREVIEW");m(document.body,"mbPAGEPREVIEW");d&&(metaBook.hudup&&metaBook.setHUD(!1),e(d));return!1}})();metaBook.setMode=function(){function a(a){if(!a.frag)d.warn("Warning: skipping gloss %o with no fragment identifier",a.uuid);else if(v(a.frag)){var b=metaBook.UI.addGlossmark;P.addCards(a);var c=metaBook.getDups(a.frag);x(c,"glossed");for(var e=0,f=c.length;e<f;)b(c[e++],a);a.excerpt&&(b=metaBook.findExcerpt(c,a.excerpt,a.exoff))&&z.Highlight(b,"mbexcerpt",a.note,{"data-glossid":a._id});if(a.tags)for(b=metaBook.gloss_cloud,c=a.tags,e=0,f=c.length;e<f;)metaBook.cloudEntry(c[e++],b);a.tstamp>metaBook.syncstamp&&
(metaBook.syncstamp=a.tstamp)}}function r(a,b){"undefined"===typeof b&&(b=!0);(H.gestures||H.mode)&&d("setHUD %o mode=%o hudup=%o bc=%o hc=%o",a,metaBook.mode,metaBook.hudup,document.body.className,A.className);if(a)metaBook.hudup=!0,y(document.body,"mbSKIMMING"),x(document.body,"hudup");else{metaBook.hudup=!1;metaBook.scrolling=!1;metaBook.previewing&&metaBook.stopPreview("setHUD");y(document.body,"mbSHRINK");if(b){if(metaBook.popmode){var c=metaBook.popmode;metaBook.popmode=!1;c()}y(A,"openheart");
y(A,"openhead");y(A,"full");y(A,S);y(document.body,"mbSKIMMING");y(document.body,"mbSKIMSTART");y(document.body,"mbSKIMEND");metaBook.mode=!1}y(document.body,"hudup");y(document.body,"openhud");metaBook.focusBody()}}function g(){metaBook._setup&&l.dropLocal("metabook.opened("+metaBook.docuri+")");r(!1);x(document.body,"mbCOVER")}function m(){metaBook._setup&&l.setLocal("metabook.opened("+metaBook.docuri+")",e());y(document.body,"mbCOVER")}function k(a,b){var k=metaBook.mode;if("undefined"===typeof a)return k;
"last"===a&&(a=metaBook.last_mode);!a&&metaBook.mode&&0<=metaBook.mode.search(aa)&&(a=metaBook.last_mode);"none"===a&&(a=!1);"heart"===a&&(a=metaBook.heart_mode||"about");H.mode&&d("setMode %o, cur=%o dbc=%o",a,metaBook.mode,document.body.className);a!==metaBook.mode&&metaBook.previewing&&metaBook.stopPreview("setMode");a!==metaBook.mode&&metaBook.popmode&&(k=metaBook.popmode,metaBook.popmode=!1,k());D(document.body,"mbCOVER")&&(a?0<=a.search(X)&&m():m(),X.lastIndex=0);"addgloss"===metaBook.mode&&
"addgloss"!==a&&D("METABOOKLIVEGLOSS","modified")&&metaBook.submitGloss(fdjt.ID("METABOOKLIVEGLOSS"));if(a){"search"===a&&(a=metaBook.search_mode||"refinesearch");"addgloss"!==a&&y(document.body,"mbSHRINK");if(a!==metaBook.mode)if(!0===a)metaBook.hideCover(),Z[metaBook.mode]&&(k=Z[metaBook.mode],k=0<=k.search(/[.#]/)?c.$1(k):h(k),k.blur()),y(A,S),metaBook.mode=!1,metaBook.last_mode=!0;else{if("string"!==typeof a)throw Error("mode arg not a string");if(0<=a.search(X)){h("METABOOKCOVER").className=
a;"console"===a&&d.update();g();metaBook.mode=a;metaBook.modechange=e();return}metaBook.hideCover();metaBook.modechange=e();Z[metaBook.mode]&&(k=Z[metaBook.mode],k=0<=k.search(/[.#]/)?c.$1(k):h(k),k.blur());a!==metaBook.mode&&(metaBook.last_mode=metaBook.mode);metaBook.mode=a}"sbooksapp"!==a||h("SBOOKSAPP").src||metaBook.appinit||f();metaBook.scrolling="string"!==typeof a?!1:C[a]?C[a]:!1;if("refinesearch"===a||"searchresults"===a||"expandsearch"===a)metaBook.search_mode=a;"addgloss"===a||"openglossmark"===
a?x(document.body,"openhud"):b||r(!0);!0===a?(y(A,"openhead"),y(A,"openheart"),c.swapClass(A,S,"minimal")):"addgloss"===a?(x(A,"openhead"),y(A,"openheart")):(0>a.search(t)&&y(A,"openheart"),0>a.search(Q)&&y(A,"openhead"),0<=a.search(t)&&(metaBook.heart_mode=a,x(A,"openheart")),0<=a.search(Q)&&(metaBook.head_mode=a,x(A,"openhead")));u(a)}else metaBook.last_mode=metaBook.mode,"openglossmark"===metaBook.mode&&h("METABOOKOPENGLOSSMARK")&&(h("METABOOKOPENGLOSSMARK").id=""),metaBook.textinput&&metaBook.setFocus(!1),
metaBook.focusBody(),metaBook.skimming&&(k=metaBook.getDups(metaBook.target),metaBook.clearHighlights(k),y(k,"mbhighlightpassage")),y(A,"openheart"),y(A,"openhead"),y(document.body,"dimmed"),y(document.body,"mbSHOWHELP"),y(document.body,"mbPREVIEW"),y(document.body,"mbSHRINK"),y(A,S),metaBook.cxthelp=!1,b?metaBook.setHUD(!1):r(!1)}function q(a){"allglosses"===a?(metaBook.skimming||metaBook.point)&&metaBook.UI.scrollSlice(metaBook.skimming||metaBook.point,metaBook.glosses):"searchresults"===a&&(metaBook.skimming||
metaBook.point)&&metaBook.UI.scrollSlice(metaBook.skimming||metaBook.point,metaBook.query.listing)}function u(a){H.mode&&d("changeMode %o, cur=%o dbc=%o",a,metaBook.mode,document.body.className);c.dropClass(A,S);c.addClass(A,a);q(a);if("statictoc"===a){var b=metaBook.head&&metaBook.head.id&&metaBook.docinfo[metaBook.head.id],e=b.head,f=b.prev,b=fdjt.ID("METABOOKSTATICTOC4"+b.frag),e=e&&fdjt.ID("METABOOKSTATICTOC4"+e.frag),f=f&&fdjt.ID("METABOOKSTATICTOC4"+f.frag);b&&b.scrollIntoView&&(e&&e.scrollIntoView(),
f&&f.scrollIntoViewIfNeeded&&f.scrollIntoViewIfNeeded(),b.scrollIntoViewIfNeeded?b.scrollIntoViewIfNeeded():b.scrollIntoView())}else if("allglosses"===a){var f=metaBook.location,b=metaBook.DOM.allglosses.childNodes,e=0,g=b.length,k=!1,l=!1,m=!1;for(metaBook.glosses&&metaBook.glosses.setLive(!0);e<g;){var r=b[e++];if(1===r.nodeType&&(l=k,k=r,D(k,"newhead")&&(m=k),(r=k.getAttribute("data-location"))&&(r=parseInt(r,10)),r>=f))break}e>=g&&(k=l=!1);k&&m&&metaBook.iscroll?(metaBook.heartscroller.scrollToElement(m,
0),metaBook.heartscroller.scrollToElement(k,0)):k&&metaBook.iscroll?metaBook.heartscroller.scrollToElement(k,0):k&&m&&k.scrollIntoViewIfNeeded?(m.scrollIntoView(),k.scrollIntoViewIfNeeded()):k&&l.scrollIntoView&&k.scrollIntoView()}if(metaBook.scrolling&&metaBook.iscroll){var v=h(metaBook.scrolling);H.iscroll&&d("Updating scroller for #%s s=%o",metaBook.scrolling,v);setTimeout(function(){p(v)},2E3)}if(Z[a]){a=Z[metaBook.mode];var t=0<=a.search(/[.#]/)?c.$1(a):h(a);t&&!metaBook.touch&&setTimeout(function(){metaBook.setFocus(t)},
50)}else"addgloss"===a&&metaBook.glossform?(a=metaBook.glossform,f=metaBook.getGlossMode(a),metaBook.setGlossMode(f,a)):setTimeout(metaBook.focusBody,50)}function p(a){if(metaBook.iscroll){a&&H.scrolling&&d("Updating scroller for %o",a);if(!metaBook.heartscroller){a=h("METABOOKHEARTBODY");var b=h("METABOOKHEARTCONTENT");b||(b=c("div#METABOOKHEARTCONTENT"),c(b,c.Array(a.childNodes)),c(a,b));metaBook.heartscroller=new G(a)}metaBook.heartscroller.refresh()}}function f(){if(!ja&&!metaBook.appinit){var a=
"";document.location.search&&(a="?"===document.location.search[0]?a+document.location.search.slice(1):a+document.location.search);a.length&&"&"!==a[a.length-1]&&(a+="&");var b=metaBook.refuri,c="https://"+metaBook.server+"/flyleaf?"+a;0>a.search("REFURI=")&&(c=c+"REFURI="+encodeURIComponent(b));0>a.search("TOPURI=")&&(c=c+"&TOPURI="+encodeURIComponent(document.location.href));document.title&&(c=c+"&DOCTITLE="+encodeURIComponent(document.title));metaBook.user&&(c=c+"&BOOKUSER="+encodeURIComponent(metaBook.user._id));
document.location.hash&&(c=c+"&HASH="+document.location.hash.slice(1));h("SBOOKSAPP").src=c;ja=!0}}function b(){var a={},b=h("METABOOKSETTINGS"),d=c.getInputValues(b,"METABOOKLAYOUT");a.layout=d&&d.length&&d[0]||!1;(d=c.getInputValues(b,"METABOOKBODYSIZE"))&&d.length&&(a.bodysize=d[0]);(d=c.getInputValues(b,"METABOOKUISIZE"))&&d.length&&(a.uisize=d[0]);(d=c.getInputValues(b,"METABOOKBODYCONTRAST"))&&d.length&&(a.bodycontrast=d[0]);d=c.getInputValues(b,"METABOOKDYSLEXICAL");a.dyslexical=d&&d.length?
d[0]:!1;d=c.getInputValues(b,"METABOOKHIDESPLASH");a.hidesplash=d&&d.length||!1;d=c.getInputValues(b,"METABOOKSHOWCONSOLE");a.showconsole=d&&d.length&&!0||!1;(d=c.getInputValues(b,"METABOOKLOCSYNC"))&&d.length&&(a.locsync=!0);d=c.getInputValues(b,"METABOOKJUSTIFY");a.justify=d&&d.length?!0:!1;d=c.getInputValues(b,"METABOOKCACHEGLOSSES");a.cacheglosses=d&&d.length?!0:!1;d=c.getInputValues(b,"METABOOKANIMATECONTENT");a.animatecontent=d&&d.length&&d[0]?!0:!1;b=c.getInputValues(b,"METABOOKANIMATEHUD");
a.animatehud=b&&b.length&&b[0]?!0:!1;return a}var e=fdjt.Time,l=fdjt.State,d=fdjt.Log,c=fdjt.DOM,z=fdjt.UI,h=fdjt.ID,B=z.TapHold,v=metaBook.ID,H=metaBook.Trace,G=window.IScroll,x=c.addClass,y=c.dropClass,D=c.hasClass,N=c.getParent,E=fdjt.String.hasSuffix,F=metaBook.fixStaticRefs,A=!1,L=!1,O=!1,P=!1;metaBook.initHUD=function(){function b(a){var e=a.origin;H.messages&&d("Got a message from %s with payload %o",e,a.data);0!==e.search(/https:\/\/[^\/]+.sbooks.net/)?d.warn("Rejecting insecure message from %s",
e):"sbooksapp"===a.data?k("sbooksapp"):"loggedin"===a.data?metaBook.user||metaBook.userSetup():"string"===typeof a.data&&0===a.data.search("setuser=")?metaBook.user||(metaBook.userinfo=JSON.parse(a.data.slice(8)),metaBook.loginUser(metaBook.userinfo),metaBook.setMode("welcome"),metaBook.userSetup()):a.data.updateglosses?metaBook.updateInfo():a.data.addlayer?metaBook.updateInfo():a.data.droplayer||a.data.hidelayer||a.data.showlayer?metaBook.refreshOffline():a.data.userinfo?metaBook.user||(metaBook.userinfo=
a.data.userinfo,metaBook.loginUser(metaBook.userinfo),metaBook.setMode("welcome"),metaBook.userSetup()):a.data&&c("METABOOKINTRO",a.data)}if(!h("METABOOKHUD")){var f=e(),g=c("div#METABOOKSTARTUPMESSAGES.startupmessages");g.innerHTML=F(metaBook.HTML.messages);2<H.startup&&d("Initializing HUD layout");metaBook.HUD=A=O=c("div#METABOOKHUD.metabookhud");O.innerHTML=F(metaBook.HTML.hud);O.metabookui=!0;c.append(g);h("METABOOKFRAME")?L=h("METABOOKFRAME"):(L=c("div#METABOOKFRAME"),c.prepend(document.body,
L));x(L,"metabookframe");L.appendChild(g);L.appendChild(O);metaBook.Frame=L;h("METABOOKHUDHELP").innerHTML=F(metaBook.HTML.hudhelp);h("METABOOKAPPHELP").innerHTML=F(metaBook.HTML.help);g=h("METABOOKHEARTBODY");g.innerHTML=F(metaBook.HTML.heart);metaBook.DOM.heart=g;h("METABOOKGLOSSATTACH").innerHTML=F(metaBook.HTML.attach);metaBook.DOM.heart=g;metaBook.DOM.top=h("METABOOKHEAD");metaBook.DOM.heart=h("METABOOKHEARTBODY");metaBook.DOM.head=h("METABOOKTOPBAR");metaBook.DOM.foot=h("METABOOKFOOT");metaBook.DOM.tabs=
h("METABOOKTABS");metaBook.DOM.noteshud=h("METABOOKNOTETEXT");metaBook.DOM.asidehud=h("METABOOKASIDE");metaBook.DOM.pagebar=h("METABOOKPAGEBAR");h("METABOOKSEARCH").innerHTML=F(metaBook.HTML.searchbox);x(metaBook.HUD,"emptysearch");h("METABOOKADDGLOSSPROTOTYPE").innerHTML=F(metaBook.HTML.addgloss);metaBook.UI.addHandlers(O,"hud");1<H.startup&&d("Created basic HUD in %dms",e()-f);if(!metaBook.svg){var g=c.getChildren(O,"img"),l=0,n=g.length;for(H.startup&&d("Switching images to SVG");l<n;){var m=g[l++];
m.src&&(E(m.src,".svg")||E(m.src,".svgz"))&&m.getAttribute("bmp")&&(m.src=m.getAttribute("bmp"))}}metaBook.hudtick=e();c.setInputs(".metabookrefuri",metaBook.refuri);c.setInputs(".metabookdocuri",metaBook.docuri);c.setInputs(".metabooktopuri",metaBook.topuri);metaBook.DOM.allglosses=h("METABOOKALLGLOSSES");2<H.startup&&metaBook.DOM.allglosses&&d("Setting up gloss UI %o",P);metaBook.glosses=P=new metaBook.Slice(metaBook.DOM.allglosses);metaBook.glossdb.onAdd("maker",function(a,b,c){metaBook.sourcedb.ref(c).oninit(metaBook.UI.addGlossSource,
"newsource")});metaBook.glossdb.onAdd("sources",function(a,b,c){metaBook.sourcedb.ref(c).oninit(metaBook.UI.addGlossSource,"newsource")});metaBook.glossdb.onLoad(a);H.messages&&d("Setting up message listener");c.addListener(window,"message",b);metaBook.TapHold.foot=new z.TapHold(metaBook.DOM.foot,{override:!0,holdfast:!0,taptapthresh:0,holdthresh:500});metaBook.TapHold.head=new z.TapHold(metaBook.DOM.head,{override:!0,taptapthresh:0});metaBook.DOM.skimmer=h("METABOOKSKIMMER");metaBook.TapHold.skimmer=
new B(metaBook.DOM.skimmer);(metaBook.DOM.help=h("METABOOKHELP")).innerHTML=F(metaBook.HTML.help);metaBook.scrollers={};g=h("METABOOKGLOSSCLOUD");metaBook.gloss_cloud=new z.Completions(g,h("METABOOKADDTAGINPUT"),z.FDJT_COMPLETE_OPTIONS|z.FDJT_COMPLETE_CLOUD|z.FDJT_COMPLETE_ANYWORD);p("METABOOKGLOSSCLOUD");metaBook.TapHold.gloss_cloud=new B(metaBook.gloss_cloud.dom);metaBook.empty_cloud=new z.Completions(h("METABOOKALLTAGS"),!1,z.FDJT_COMPLETE_OPTIONS|z.FDJT_COMPLETE_CLOUD|z.FDJT_COMPLETE_ANYWORD);
metaBook.adjustCloudFont&&(metaBook.empty_cloud.updated=function(){metaBook.adjustCloudFont(this)});metaBook.DOM.empty_cloud=h("METABOOKALLTAGS");p("METABOOKALLTAGS");metaBook.TapHold.empty_cloud=new B(metaBook.empty_cloud.dom);g=h("METABOOKSHARECLOUD");metaBook.share_cloud=new z.Completions(g,h("METABOOKADDSHAREINPUT"),z.FDJT_COMPLETE_OPTIONS|z.FDJT_COMPLETE_CLOUD|z.FDJT_COMPLETE_ANYWORD);metaBook.DOM.share_cloud=g;p("METABOOKSHARECLOUD");metaBook.TapHold.share_cloud=new B(metaBook.share_cloud.dom);
c.setupCustomInputs(h("METABOOKHUD"));1<H.startup&&d("Initialized basic HUD in %dms",e()-f)}};metaBook.resizeHUD=function(){var a=c.viewHeight();h("METABOOKHEARTBODY").style.maxHeight=a-100+"px";fdjt.DOM.adjustFonts(metaBook.HUD)};metaBook.addGloss2UI=a;metaBook.setupTOC=function(a){for(var b=a,d=b;d;)if(d.sub&&0!==d.sub.length)if(1<d.sub.length){b=d;break}else d=d.sub[0];else break;b=metaBook.TOC(b,0,!1,"METABOOKTOC4",!0);b=c("div#METABOOKTOC.hudpanel",b);metaBook.UI.addHandlers(b,"toc");h("METABOOKTOCBUTTON").style.visibility=
"";metaBook.DOM.toc=b;for(c.replace("METABOOKTOC",b);a;)if(a.sub&&0!==a.sub.length)if(1<a.sub.length)break;else a=a.sub[0];else break;a=metaBook.TOC(a,0,!1,"METABOOKSTATICTOC4");a=c("div#METABOOKSTATICTOC.hudpanel",a);b=metaBook.touch;metaBook.UI.addHandlers(a,"toc");a.title=(b?"Tap":"Click on")+" a section to go to its start; press and hold to simply preview it.";metaBook.Statictoc=a;c.replace("METABOOKSTATICTOC",a)};metaBook.setHUD=r;metaBook.showCover=g;metaBook.hideCover=m;metaBook.toggleCover=
function(){D(document.body,"mbCOVER")?m():g()};var S=/\b((search)|(refinesearch)|(expandsearch)|(searchresults)|(overtoc)|(openglossmark)|(allglosses)|(context)|(statictoc)|(minimal)|(addgloss)|(gotoloc)|(gotoref)|(gotopage)|(shownote)|(showaside)|(glossdetail))\b/g,t=/\b((statictoc)|(search)|(refinesearch)|(expandsearch)|(searchresults)|(allglosses)|(showaside)|(glossaddtag)|(glossaddtag)|(glossaddoutlet)|(glossdetail))\b/g,Q=/\b((overtoc)|(search)|(refinesearch)|(expandsearch)|(searchresults)|(allglosses)|(addgloss)|(shownote))\b/g,
aa=/\b((glossdetail))\b/g,X=/\b((welcome)|(help)|(layers)|(login)|(settings)|(cover)|(aboutsbooks)|(console)|(aboutbook)|(titlepage))\b/g;metaBook.searchModes=/((refinesearch)|(searchresults)|(expandsearch))/;var C={allglosses:"METABOOKALLGLOSSES",searchresults:"METABOOKSEARCHRESULTS",expandsearch:"METABOOKALLTAGS",search:"METABOOKSEARCHCLOUD",refinesearch:"METABOOKSEARCHCLOUD",openglossmark:"METABOOKPOINTGLOSSES",statictoc:"METABOOKSTATICTOC"},Z={gotopage:"METABOOKPAGEINPUT",gotoloc:"METABOOKLOCINPUT",
gotoref:"METABOOKREFINPUT",search:"METABOOKSEARCHINPUT",refinesearch:"METABOOKSEARCHINPUT",expandsearch:"METABOOKSEARCHINPUT"};metaBook.scrollSlices=q;metaBook.UI.updateScroller=p;metaBook.toggleMode=function(a,b){metaBook.mode?a===metaBook.mode?b?k(!0):k(!1):"heart"===a&&0===metaBook.mode.search(t)?b?k(!0):k(!1):k(a):k(a)};metaBook.dropHUD=function(){return k(!1)};metaBook.toggleHUD=function(a){a=a||window.event;a&&z.isClickable(z.T(a))||(d("toggle HUD %o hudup=%o",a,metaBook.hudup),metaBook.hudup?
r(!1,!1):r(!0))};var ja=!1;metaBook.initIFrameApp=f;metaBook.selectApp=function(){"sbooksapp"===metaBook.mode?k(!1):k("sbooksapp")};metaBook.Skim=function(a,b,e,f){var g=metaBook.nextSlice,k=metaBook.prevSlice,l=metaBook.skimming,m=0,q=0;"number"!==typeof e&&(e=0);x(document.body,"mbSKIMMING");r(!1,!1);H.mode&&d("metaBookSkim() %o (src=%o) mode=%o scn=%o/%o dir=%o",a,b,metaBook.mode,metaBook.skimming,metaBook.target,e);if(metaBook.skimming!==b){var p=h("METABOOKSKIMMER"),m=b.cloneNode(!0),q=g(b),
t=k(b),u=0,C=0,E=t,B=0>e?"-120%":0<e?"120%":!1;y(p,"transimate");c.replace("METABOOKSKIM",m);var A=function(){y(p,"transanimate");c.removeListener(p,"transitionend",A)};metaBook.skimming&&B&&(p.style[c.transform]="translate("+B+",0)",setTimeout(function(){x(p,"transanimate");c.addListener(p,"transitionend",A);setTimeout(function(){p.style[c.transform]=""},0)},0));q?y(document.body,"mbSKIMEND"):x(document.body,"mbSKIMEND");for(t?y(document.body,"mbSKIMSTART"):x(document.body,"mbSKIMSTART");E;)u++,
E=k(E);for(E=q;E;)C++,E=g(E);h("METABOOKSKIMINFO").innerHTML=u+1+"/"+(u+C+1);l&&y(l,"metabookskimpoint");b&&x(b,"metabookskimpoint");"undefined"!==typeof f&&(f?x("METABOOKSKIMMER","expanded"):y("METABOOKSKIMMER","expanded"));metaBook.skimming=b}f=[];metaBook.target&&metaBook.clearHighlights(metaBook.getDups(metaBook.target));y("METABOOKSKIMMER","mbfoundhighlights");metaBook.setTarget(a);if(b&&D(b,"gloss"))if(m=metaBook.glossdb.ref(b.name),m.excerpt){if(q=metaBook.getDups(a.id),m=metaBook.findExcerpt(q,
m.excerpt,m.exoff))f=z.Highlight(m,"mbhighlightexcerpt"),x("METABOOKSKIMMER","mbfoundhighlights")}else"#"===b.about[0]?x(metaBook.getDups(b.about.slice(1)),"mbhighlightpassage"):x(metaBook.getDups(b.about),"mbhighlightpassage");else if(b&&N(b,".sbookresults")&&(b=v(b.about)))if(g=metaBook.docinfo[b.id],k=metaBook.query.tags,l=g.knodeterms,m=0,q=k.length,0===q)x(metaBook.getDups(b),"mbhighlightpassage");else for(;m<q;)t=k[m++],t=metaBook.highlightTerm(t,b,g,l),f=f.concat(t);delete metaBook.skimpoints;
delete metaBook.skimoff;if(f&&1===f.length&&N(f[0],a))metaBook.GoTo(a,"Skim");else if(f&&f.length)if(b=metaBook.getDups(a.id),b.length){a=[];m=0;for(q=b.length;m<q;)for(g=b[m++],k=0,l=f.length;k<l;)if(N(f[k++],g)){a.push(g);break}metaBook.skimpoints=a.length?a:b;metaBook.skimoff=0>e?metaBook.skimpoints.length-1:0;metaBook.GoTo(metaBook.skimpoints[metaBook.skimoff])}else metaBook.GoTo(a,"Skim");else metaBook.GoTo(a,"Skim")};metaBook.stopSkimming=function(){var a=metaBook.skimming;a&&(y(document.body,
"mbSKIMMING"),N(a,h("METABOOKALLGLOSSES"))?metaBook.setMode("allglosses"):N(a,h("METABOOKSEARCHRESULTS"))&&metaBook.setMode("searchresults"))};metaBook.addConfig("uisize",function(a,b){c.swapClass(metaBook.Frame,/metabookuifont\w+/g,"metabookuifont"+b)});metaBook.addConfig("dyslexical",function(a,b){if(b&&"string"===typeof b&&/yes|on|t/i.exec(b)){if(D(document.body,"_DYSLEXICAL"))return;metaBook.dyslexical=!0;x(document.body,"_DYSLEXICAL")}else if(D(document.body,"_DYSLEXICAL"))metaBook.dyslexical=
!0,c.dropClass(document.body,"_DYSLEXICAL");else return;setTimeout(function(){metaBook.resizeUI();metaBook.layout&&metaBook.Paginate("typechange")},10)});metaBook.addConfig("animatecontent",function(a,b){metaBook.dontanimate||(b?x(document.body,"_ANIMATE"):y(metaBook.page,"_ANIMATE"))});metaBook.addConfig("animatehud",function(a,b){metaBook.dontanimate||(b?x("METABOOKFRAME","_ANIMATE"):y("METABOOKFRAME","_ANIMATE"))});metaBook.UI.settingsUpdate=function(){var a=b();metaBook.setConfig(a)};metaBook.UI.settingsSave=
function(a){"undefined"===typeof a&&(a=window.event);a&&fdjt.UI.cancel(a);a=b();metaBook.setConfig(a);metaBook.saveConfig(a);c.dropClass("METABOOKSETTINGS","changed");c.replace("METABOOKSETTINGSMESSAGE",c("span.message#METABOOKSETTINGSMESSAGE","Your settings have been saved."))};metaBook.UI.settingsReset=function(a){"undefined"===typeof a&&(a=window.event);a&&fdjt.UI.cancel(a);metaBook.resetConfig();c.dropClass("METABOOKSETTINGS","changed");c.replace("METABOOKSETTINGSMESSAGE",c("span.message#METABOOKSETTINGSMESSAGE",
"Your settings have been reset."))};metaBook.UI.settingsOK=function(a){"undefined"===typeof a&&(a=window.event);a&&fdjt.UI.cancel(a);a=b();metaBook.setConfig(a);c.replace("METABOOKSETTINGSMESSAGE",c("span.message#METABOOKSETTINGSMESSAGE","Your settings have been applied."))};metaBook.UI.settingsCancel=function(a){"undefined"===typeof a&&(a=window.event);a&&fdjt.UI.cancel(a);metaBook.setConfig(metaBook.getConfig());c.replace("METABOOKSETTINGSMESSAGE",c("span.message#METABOOKSETTINGSMESSAGE","Your changes have been discarded."))};
metaBook.keyboardHelp=function(a,b){if(!0===a)metaBook.keyboardHelp.timer&&(clearTimeout(metaBook.keyboardHelp.timer),metaBook.keyboardHelp.timer=!1),y("METABOOKKEYBOARDHELPBOX","closing"),y("METABOOKKEYBOARDHELPBOX","closed");else if(!1===a)metaBook.keyboardHelp.timer&&(clearTimeout(metaBook.keyboardHelp.timer),metaBook.keyboardHelp.timer=!1),x("METABOOKKEYBOARDHELPBOX","closed"),y("METABOOKKEYBOARDHELPBOX","closing");else if(b||metaBook.keyboardhelp)if("string"===typeof a&&(a=h(a)),a&&a.nodeType){var d=
h("METABOOKKEYBOARDHELPBOX"),e=a.cloneNode(!0);e.id="METABOOKKEYBOARDHELP";c.replace("METABOOKKEYBOARDHELP",e);c.dropClass(d,"closed");metaBook.keyboardHelp.timer=setTimeout(function(){c.addClass(d,"closing");metaBook.keyboardHelp.timer=setTimeout(function(){metaBook.keyboardHelp.timer=!1;c.swapClass(d,"closing","closed")},5E3)},5E3)}};metaBook.showGloss=function(a){if(!metaBook.glossdb.ref(a))return!1;var b=document.getElementsByName(a);if(b&&b.length)for(var d=c.hasParent,e=0,f=b.length;e<f;)if(a=
b[e++],d(a,P))return b=v(a.about),k("allglosses"),metaBook.Skim(b,a),!0;return!1};metaBook.hideHelp=function(){c.dropClass(document.body,"mbSHOWHELP")};metaBook.showHelp=function(){c.addClass(document.body,"mbSHOWHELP")};return k}();metaBook.TOC=function(){function a(a){switch(a){case "right":return e("skim_right",64,64);case "left":return e("skim_left",64,64);case "start":return e("skim_left_stop",64,64);case "end":return e("skim_right_stop",64,64);default:return!1}}function r(b,c,d,e,f){var k=u("HR.sizebar"),l=u("HR.progressbar"),q=f?!1:u("A.sectname",b.title);d=d||"DIV.metabooktoc";var z=q&&(b.next?u.Image(a("right"),!1,"next"):u.Image(a("end"),!1,"nextstop"));z&&b.next&&(z.frag=b.next.frag);var E=q&&(b.prev?u.Image(a("left"),
!1,"back"):u.Image(a("start"),!1,"backstop"));E&&b.prev&&(E.frag=b.prev.frag);var F=q&&u("DIV.head",l,k,q),z=u(d,z,E,F,m(b),g(b)),E=b.sub;c||(c=0);q&&(F.setAttribute("name","SBR"+b.frag),q.name="SBR"+b.frag,q.frag=b.frag);z.sbook_start=b.starts_at;z.sbook_end=b.ends_at;F=b.head;k&&F?(q=F.starts_at,F=F.ends_at-q,k.style.width=100*(b.ends_at-b.starts_at)/F+"%",k.style.left=100*(b.starts_at-q)/F+"%",l.style.left=100*(b.starts_at-q)/F+"%"):k&&(k.style.width="100%");u.addClass(z,"metabooktoc"+c);z.id=
(e||"METABOOKTOC4")+b.frag;if(!E||!E.length)return u.addClass(z,"metabooktocleaf"),z;b=0;for(k=E.length;b<k;)z.appendChild(new r(E[b++],c+1,d,e,f));0===c&&(e?metaBook.TapHold[e]=p.TapHold(z,{id:e||"TOC",holdclass:!1,taptapthresh:0,touchtoo:function(a){a=a||window.event;metaBook.previewing&&metaBook.stopPreview("touchtoo",!0);this.abort(a,"touchtoo")},noslip:"METABOOKSTATICTOC4"===e}):p.TapHold(z,{holdfast:!0}),metaBook.UI.addHandlers(z,"toc"));return z}function g(a){a=a.sub;if(!a||!a.length)return!1;
for(var b=u("div.sub"),c=0,d=a.length;c<d;){var e=a[c],f=u("A.sectname",e.title);f.frag=e.frag;f.name="SBR"+e.frag;u(b,0<c&&" \u00b7 ",f);c++}return b}function m(a){var c=u("div.spanbar.metabookslice"),e=u("div.spans"),f=!1,g=a.starts_at,l=a.ends_at,m=l-g,q=a.sub,p,r=0,z=a.elt||b(a.frag);c.starts=g;c.ends=l;if(!q||0===q.length)return!1;var A=u("div.progressbox","\u00a0"),L=!1,O=!1;u(c,A,e);u(e,!1);A.style.left="0%";for(A=0;A<q.length;){p=q[A++];var O=p.elt||b(p.frag),P,S=!0;0===r&&0<p.starts_at-g?
(f=g,P=p.starts_at,p=a,O=a.elt||b(a.frag),A--,r++,S=!1):(f=p.starts_at,P=p.ends_at,r++);f=k(r,O,p.title,f,P,m,"SBR"+p.frag,g);L||(L=f,d(L,"metabookfirstspan"));O=f;e.appendChild(f);S&&(S=u("A.metabooktitle",p.title),S.name="SBR"+p.frag,e.appendChild(S))}0<l-p.ends_at?(f=k(r,z,a.title,p.ends_at,l,m,g),d(f,"metabooklastspan"),c.appendChild(f)):O&&d(O,"metabooklastspan");return c}function k(a,b,c,d,e,f,g,k){e-=d;a=u("A.brick","\u00b7");c=u("DIV.metabookhudspan",a);e=Math.round(e/f*1E8)/1E6;d=Math.round((d-
k)/f*1E8)/1E6;c.style.left=d+"%";c.style.width=e+"%";c.frag=b.id;g&&(a.name=g);return c}function q(a,b){var e;e=b.id;var f=e.indexOf("4");e=f?e.slice(0,f+1):e;var f=z(b,".metabookcurhead"),g=z(b,".metabooklivehead"),k=z(b,".metabookcxthead");c(b,"metabookcxthead");c(b,"metabookcurhead");c(f,"metabookcurhead");c(g,"metabooklivehead");c(k,"metabookcxthead");if(a){f=document.getElementById(e+a.frag);g=[];for(k=a;a;){var l=document.getElementById(e+a.frag),m=fdjt.DOM.getChild(l,".progressbar");l&&g.push(l);
if(m&&metaBook.location&&a.ends_at){var l=metaBook.location-a.starts_at,q=a.ends_at-a.starts_at;(l=q&&l&&l/q*100)&&0<=l&&100>=l&&(m.style.left=l+"%")}a=a.head}e=g.length-1;for(k.sub&&k.sub.length?d(f,"metabookcxthead"):g[1]&&d(g[1],"metabookcxthead");0<=e;)k=g[e--],"A"===k.tagName&&0<=k.className.search(/\bbrick\b/)&&d(k.parentNode,"metabooklivehead"),d(k,"metabooklivehead");d(f,"metabookcurhead")}}var u=fdjt.DOM,p=fdjt.UI,f=u.getParent,b=metaBook.ID,e=metaBook.icon;metaBook.navicon=a;var l=u.hasClass,
d=u.addClass,c=u.dropClass,z=u.getChildren;r.updateTOC=q;r.setHead=function(a){for(var b=u.$("a.metabooklivehead.metabooktitle"),c=0,e=b.length;c<e;)b[c++].style.fontSize="";b=u.$(".metabooktoc0");c=0;for(e=b.length;c<e;)q(a,b[c++]);if(a){for(c=a;c;){for(var e=c.level,b=document.getElementsByName("SBR"+c.frag),g=0,k=b.length;g<k;){var m=b[g++],p=f(m,".metabooktoc"),r="A"===m.tagName&&m.className&&0<=m.className.search(/\bbrick\b/);e&&r&&!l(p,"metabooktoc"+(e-1))||(d(m,"metabooklivehead"),r&&d(m.parentNode,
"metabooklivehead"))}c=c.head}setTimeout(function(){for(var b=a;b;){for(var c=document.getElementsByName("SBR"+b.frag),d=0,e=c.length;d<e;){var f=c[d++];if("A"===f.tagName&&l(f,"metabooktitle")){var g=f.clientWidth,k=f.scrollWidth;k>g&&(f.style.fontSize=g/k*80+"%")}}b=b.head}},200)}else d(b,"metabooklivehead"),d(b,"metabookcurhead")};return r}();(function(){function a(){var a=metaBook.layout;e&&(clearTimeout(e),e=!1);metaBook.resizeUI();metaBook.scaleLayout(!1);if(a)if(window.outerWidth===f&&window.outerHeight===p)metaBook.scaleLayout(!0);else{f=window.outerWidth;p=window.outerHeight;var l=u(k("CODEXPAGE"),!1,!0).width,h=u(k("CODEXPAGE"),!1,!0).inner_height;a&&a.width===l&&a.height===h||!a||!a.onresize||metaBook.freezelayout||(metaBook.long_layout_thresh&&a.started&&a.done-a.started<=metaBook.long_layout_thresh?e=setTimeout(r,50):metaBook.layoutCached()?
e=setTimeout(r,50):d||(a=g("div.title","Update layout?"),metaBook.scaleLayout(),d=!0,d=q.choose({choices:[{label:"Yes",handler:function(){d=!1;b=!0;metaBook.layout_choice_timeout=10;e=setTimeout(r,50)},isdefault:b},{label:"No",handler:function(){b=d=!1;metaBook.layout_choice_timeout=10},isdefault:!b}],timeout:metaBook.layout_choice_timeout||metaBook.choice_timeout||20,spec:"div.fdjtdialog.fdjtconfirm.updatelayout"},a)))}}function r(a){e&&clearTimeout(e);e=!1;metaBook.sizeContent();metaBook.layout.onresize(a)}
var g=fdjt.DOM,m=fdjt.Log,k=fdjt.ID,q=fdjt.UI,u=g.getGeometry,p=window.outerHeight,f=window.outerWidth,b=!1;metaBook.resizeUI=function(a){a||(a=100);setTimeout(function(){var a=fdjt.Time(),b=k("METABOOKHUD"),c=k("METABOOKCOVER");c&&metaBook.resizeCover(c);b&&metaBook.resizeHUD(b);(b||c)&&m("Resized UI in %fsecs",(fdjt.Time()-a)/1E3)},100)};metaBook.resize=a;var e=!1,l=!1,d=!1;metaBook.resizeHandler=function(b){l&&clearTimeout(l);d&&(fdjt.Dialog.close(d),d=!1);l=setTimeout(a,1E3)}})();metaBook.Slice=function(){function a(a,b){for(var c=b.id;a;){if(U(a,"codexpage")||a.getAttribute&&(a.id===c||a.getAttribute("data-baseid")===c))return a;a=a.parentNode}return b}function r(a,c,d,e){var h=a.frag||a.id,l=h&&A(h),q=metaBook.docinfo[h];if(!q)return!1;var r=q.level?q:q.head,v=r&&A(r.frag),z=c&&c.scores.get(a),C=a.excerpt?a.excerpt.length:0,E=a.note?a.note.length:0,y=k(a),B=a.shared||[];"string"===typeof B&&(B=[B]);y&&(B=N.remove(B,y._qid||y._id));var F;if(F=z)F=c&&c.max_score?x("span.score",
"(",z,"/",c.max_score,")"):x("span.score","(",z,")");var X=F,U;if(a.maker||a.tstamp){var L=a.maker,Z=L&&metaBook.sourcedb.load(L),P;var Q=a.modified||a.created||a.tstamp,ka=G.tick(),aa=new Date(1E3*Q);if(43200>ka-Q){var da=aa.getHours(),Xa=aa.getMinutes();P=""+da+":"+(10>Xa?"0":"")+Xa}else{var va=aa.getFullYear(),V=aa.getMonth(),K=aa.getDate();P=10>va?""+K+"/"+ja[V]+"/0"+va:""+K+"/"+ja[V]+"/"+va}var I=x("span.age",P);I.title=G.timeString(a.modified||a.created||a.tstamp);var Ua=x("span.tool",I," ",
x("span.label",L===metaBook.user||L===metaBook.user._id?"modify":"respond"),x.Image(L===metaBook.user||L===metaBook.user._id?S("gloss_edit_titled",64,64):S("gloss_respond_titled",64,64),"img.button",L===metaBook.user||L===metaBook.user._id?"edit":"reply",L===metaBook.user||L===metaBook.user._id?"tap to edit this gloss, hold to reply":"relay/reply to this gloss"),a.private&&x("span.private","Private"));t(Ua,"tap",b);t(Ua,"release",b);var Ka=u(a),ga=k(a),Ga;if(Ka)Ga=x.Image(Ka.src,Ka.classname,Ka.alt);
else{var ea=metaBook.sourcedb.loadref(a.maker),fa=x("div.sourcepic",ea&&ea.name?H.getInitials(ea.name):"?");O(fa,"sbooknopic");Ga=fa}var Aa=Ga;Aa&&x.addListener(Aa,"touchstart",fdjt.UI.noDefault);U=[Aa,ga&&ga.name&&x("span.overlay",ga.name),!ga&&Z&&(Z.name||Z.userid)&&x("span.user",Z.name||Z.userid),!ga&&Z&&(Z.name||Z.userid)&&" \u2014 ",Ua]}else U=!1;var ra=U,ya;if(ya=0<E){var pa;var W=a.note;if(0===W.search(/^{(md|markdown)}/)){var Fa=W.indexOf("}");pa=metaBook.md2DOM(W.slice(Fa+1),!0)}else pa=
W;ya=x("span.note",pa)}var M=ya,Y;if(Y=0<C){var ma=a.excerpt;if("string"===typeof ma)Y=D.Ellipsis("span.excerpt",ma,140);else if(1===ma.length)Y=D.Ellipsis("span.excerpt",ma[0],140);else{for(var Ba=x("div.excerpts"),Ta=0,Ya=ma.length;Ta<Ya;)x(Ba,0<Ta&&" ",x("span.excerpt","\u201c",ma[Ta++],"\u201d"));Y=Ba}}var qa=Y,Ja=a.detail&&x("span.glossbody","More"),La;if(La=a.alltags||a.tags){for(var Ma=x.Image(S("tagicon",64,64),"img.tagicon","tags"),wa=c&&x("span.matches"),$a=x("span.top"),ia=x("span.sectags"),
Za=x("span.other"),Ia=0,Ha={},Ca="**tags *tags +tags +tags* knodes tags **tags* *tags* tags* ^tags ^tags*".split(" "),Da=0,Sa=Ca.length;Da<Sa;){var fb=Ca[Da++],ca=a[fb];if(ca&&0!==ca.length)for(var hb=0,Ea=ca.length;hb<Ea;){var ba=ca[hb++];if(ba){var la="string"===typeof ba?ba:ba._qid||ba.getQID();if(!Ha[la]){Ia++;Ha[la]=ba;var ib=ba._qid&&"\u00a7"===ba._qid[0],ta;if(ib){var jb=ba,db=jb._id,gb=x("span.sectname",db);gb.setAttribute("data-value",jb._qid);20<db.length&&O(gb,"longterm");ta=gb}else ta=
Knodule.HTML(ba,metaBook.knodule);var qb=ta,nb;if(nb=wa)a:{for(var rb=ba,Lb=c.tags,Mb=0,ac=Lb.length;Mb<ac;){var Nb=Lb[Mb++];if(Nb===rb||rb.allways&&0<=rb.allways.indexOf(Nb)){nb=!0;break a}}nb=!1}nb?x(wa," ",qb):ib?x(ia," ",qb):4>Ia?x($a," ",qb):x(Za," ",qb)}}}}La=x("span.tags",Ma,wa,$a,Za,ia)}var bc=La,cc=a.links&&m(a.links),dc=a.attachments&&m(a.attachments,"span.attachments"),sb;if(sb=B&&B.length){var lb=B;lb instanceof Array||(lb=[lb]);if(0===lb.length)sb=!1;else{for(var Ob=x(1<lb.length?"div.audience":
"span.audience",1<lb.length&&x("span.count",lb.length," outlets")," "),yb=0,ec=lb.length;yb<ec;){var mb=metaBook.sourcedb.ref(lb[yb]),tb=x("span.outlet");mb._live?(x(tb,mb.name),tb.title=mb.about?"Shared with \u201c"+mb.name+"\u201d \u2014 "+mb.about:"Shared with \u201c"+mb.name+"\u201d"):(tb.setAttribute("NAME","OUTLETSPAN"+mb._id),mb.load().then(g));x.append(Ob," ",tb);yb++}sb=Ob}}var Pb=x("div.metabookcardbody",X,ra,M," ",qa," ",Ja," ",bc," ",cc," ",dc," ",sb),fc=a.maker?"div.metabookcard.gloss":
"div.metabookcard.passage",zb;if(zb=v){var ob=a.level&&a;ob||(ob=metaBook.getHead(v));var Ab=x("span");Ab.title="this location in the structure of the book";var Qb=metaBook.docinfo[v.id];if(ob){var Rb=metaBook.getTitle(ob,!0),Bb=x("span.headtext.tocref",x("span.spacer","\u00a7"),Rb);Bb.setAttribute("data-tocref",ob.frag);var ub=x("span.head",Bb);Bb.title="jump to the section: "+Rb;x.append(Ab," ",ub);var Cb=metaBook.Info(ob).heads;if(Cb)for(var Sb=Cb.length-1;0<Sb;){var pb=Cb[Sb--],Db=A(pb.frag);
if(Db&&pb.title&&Db!==metaBook.docroot&&Db!==document.body){var Eb=x("span.tocref.headtext",x("span.spacer","\u00a7"),pb.title);Eb.setAttribute("data-tocref",pb.frag);var vb=x("span.head"," ",Eb);vb.setAttribute("data-href",pb.frag);Eb.title=pb.title?"jump to the section: "+pb.title:"(jump to this section)";v===ob?x(ub,vb):x(ub," \u22ef ",vb);ub=vb}}}var Tb=x("div.tochead",p(Qb,!1),Ab);Tb.title=f(Qb,!1);zb=Tb}var gc=zb,Fb;if(Fb=r){var wb=r,Gb=metaBook.docinfo[l.id];wb||(wb=Gb.head);var Ub=x("div.idhead",
p(Gb,wb),x("span.spacer","\u00b6"),x("span",metaBook.getTitle(l,!0)));Ub.title=f(Gb,wb);Fb=Ub}var hc=Fb,Hb;if(Hb=e){var xb=void 0,Ib=x("HR"),Jb=x("DIV.locbar",Ib),Vb=q.starts_at,ic=q.ends_at-Vb;xb||(xb=metaBook.docinfo[document.body.id]);var Wb=xb.starts_at,Xb=xb.ends_at-Wb;Ib.style.width=ic/Xb*100+"%";Ib.style.left=(Vb-Wb)/Xb*100+"%";var Kb=q.id||q.frag;if(Kb){Jb.about="#"+Kb;var Yb,jc=A(Kb);Yb=metaBook.getTitle(jc,!0);Jb.title=Yb}Hb=Jb}var kb=x(fc,gc,hc,Hb,Pb,x("div.fdjtclearfloats")),Zb=a.maker;
metaBook.sourcedb.load(a.maker);var $b=a.tstamp||a.modified||a.created;$b&&(Pb.title="gloss from "+(Zb&&Zb.name||"someone")+" at "+G.shortString($b));kb.about="#"+a.frag;kb.setAttribute("data-passage",h);kb.setAttribute("data-location",q.starts_at);r&&kb.setAttribute("data-tochead",r.frag);if(a.maker||a.tstamp)kb.setAttribute("data-gloss",a._id),a.tstamp&&kb.setAttribute("data-timestamp",a.tstamp);z&&kb.setAttribute("data-searchscore",z);d&&(kb.id=d+a.id);a._id&&(kb.name=kb.qref=a._id,kb.setAttribute("name",
a._id));return kb}function g(a){for(var b=Z(document.getElementsByName("OUTLETSPAN"+a._id)),c=0,d=b.length;c<d;){var e=b[c++];e.removeAttribute("NAME");x(e,a.name);e.title=a.about?"Shared with \u201c"+a.name+"\u201d \u2014 "+a.about:"Shared with \u201c"+a.name+"\u201d"}}function m(a,b){var c=0,d;for(d in a)"_"!==d[0]&&c++;if(0===c)return!1;c=x(b||(1<c?"div.links":"span.links"),1<c&&x("span.count",c," links")," ");for(d in a)if("_"!==d[0]){var e=a[d],f=!1,f=0===d.search("https://glossdata.sbooks.net/")||
0===d.search("resources/"),h,g=!1,k=!1,l=!1;if(!f){h=metaBook.inbookurls;for(var m=0,q=h;m<q;){var p=h[m++];if("string"===typeof p){if(0===d.search(p)){f=!0;break}}else if(p.exec(d)){f=!0;break}}}"string"===typeof e?h=e:(h=e.title,g=e.icon,k=e.type);k||(k=metaBook.urlType(d));g||(g=metaBook.typeIcon(k));l||(l=metaBook.mediaTypeClass(k));e=x.Image(g);f?(f=x("span.mbmedia",e,h),f.setAttribute("data-src",d),k&&f.setAttribute("data-type",k),f.title="Reveal "+h):f=x.Anchor(d,{title:"Link to "+d,target:"_blank"},
e,h);l&&O(f,l);x(c,f,"\n")}return c}function k(a){if(a.sources){a=a.sources;"string"===typeof a&&(a=[a]);for(var b=0,c=a.length;b<c;){var d=metaBook.sourcedb.loadref(a[b++]);if(d&&":OVERLAY"===d.kind)return d}}return!1}function q(a){return a._pic?a._pic:a.pic?(a._pic=x.data2URL(a.pic),a._pic):!1}function u(a){var b,c;if(a.pic)return{src:q(a),alt:a.note||a.name};if(a.sources){var d=a.sources;"string"===typeof d&&(d=[d]);b=0;for(c=d.length;b<c;){var e=metaBook.sourcedb.loadref(d[b++]);if(e&&":OVERLAY"===
e.kind&&e.pic)return{src:q(e),alt:e.name,classname:"img.glosspic.sourcepic"}}}if(a.links)for(d=a.links,b=0,c=d.length;b<c;)if(e=d[b++],0<e.href.search(/\.(jpg|png|gif|jpeg)$/i))return{src:e.href,alt:"graphic",classname:"img.glosspic"};if(a.shared)for(d=a.shared,"string"===typeof d&&(d=[d]),b=0,c=d.length;b<c;)if((e=metaBook.sourcedb.loadref(d[b++]))&&":LAYER"===e.kind&&e.pic)return{src:q(e),alt:e.name,classname:"img.glosspic.sourcepic"};return a.maker?(a=metaBook.sourcedb.loadref(a.maker),a.pic?{src:q(a),
alt:a.name,classname:"img.glosspic.userpic"}:a.fbid?{src:"https://graph.facebook.com/"+a.fbid+"/picture?type=square",classname:"img.glosspic.userpic.fbpic"}:!1):!1}function p(a,b,c){var d=!b;b||(b=metaBook.docinfo[metaBook.content.id]);c=x(c||"hr.locrule");var e=b.starts_at;b=b.ends_at-e;var e=a.starts_at-e,f=a.ends_at-a.starts_at,h="~"+Math.ceil(f/5)+" words long ~"+Math.ceil(e/b*100)+"% along";c.setAttribute("about","#"+(a.id||a.frag));c.locstring=h+".";c.title=(d?"this section in the book":"this passage in the section, ")+
h+": click or hold to glimpse";c.style.width=f/b*100+"%";c.style.left=e/b*100+"%";return c}function f(a,b){var c=!b;b||(b=metaBook.docinfo[metaBook.content.id]);var d=b.starts_at,e=b.ends_at-d,d=a.starts_at-d,f=a.ends_at-a.starts_at;return c?"this section is ~"+Math.ceil(f/7)+" words long and ~"+Math.ceil(d/e*100)+"% into the book":"this passage is ~"+Math.ceil(f/7)+" words long and ~"+Math.ceil(d/e*100)+"% into the section"}function b(a){var b=D.T(a);for(D.cancel(a);b&&!b.qref;)b=b.parentNode;b&&
(b=metaBook.glossdb.ref(b.qref),metaBook.setGlossTarget(b,"hold"===a.type)&&metaBook.setMode("addgloss"))}function e(a,b,c){if(metaBook.iscroll)(c=metaBook.scrollers[a.id]||a.parentNode&&metaBook.scrollers[a.parentNode.id])&&c.scrollToElement(a,0);else if(a=b.getCard(a))a=a.dom,!a||!c&&x.isVisible(a)||a.scrollIntoView(!0)}function l(a,b,c){if("undefined"===typeof a)return!1;if(!(this instanceof l))return new l(a,b,c);if(!a)a=x("div.metabookslice");else if("string"===typeof a){if(ka.hasOwnProperty(a))return ka[a];
if(document.getElementById(a))a=document.getElementById(a);else return!1}else if(a.nodeType&&1===a.nodeType&&a.id){if(ka.hasOwnProperty(a.id))return ka[a.id];ka[a.id]=a}else if(!a.nodeType||1!==a.nodeType)return!1;var d={noslip:!0,id:a.id,holdclass:!1,touchtoo:function(a){a=a||window.event;metaBook.previewing&&metaBook.stopPreview("touchtoo",!0);this.abort(a,"touchtoo")}};metaBook.iscroll&&(d.override=!0,d.bubble=!0);a.id?metaBook.TapHold[a.id]=new D.TapHold(a,d):D.TapHold(a,d);metaBook.UI.addHandlers(a,
"summary");this.container=a;this.cards=[];c&&(this.sortfn=c);this.byid=new fdjt.RefMap;this.byfrag=new fdjt.RefMap;this.changed=this.live=!1;this.addCards(b);b&&b.length&&this.update();return this}function d(a){if(a.id)return a;if(a.childNodes){a=a.childNodes;for(var b=0,c=a.length;b<c;)if(1===a[b].nodeType){var e=d(a[b++]);if(e)return e}else b++}return!1}function c(a){return(U(a,"metabookcard")?a:Q(a,".metabookcard"))||X(a,".metabookcard")}function z(a){var b=D.T(a);L.gestures&&y("slice_tapped %o: %o",
a,b);if(metaBook.previewing)metaBook.stopPreview("slice_tapped",!0),D.cancel(a);else if(Q(b,".ellipsis")&&(Q(b,".elision")||Q(b,".delision")))D.Ellipsis.toggle(b),D.cancel(a);else if(Q(b,".tochead"))b=(b=Q(b,".tocref"))&&b.getAttribute("data-tocref"),metaBook.GoTOC(b),D.cancel(a);else{var d=Q(b,".mbmedia");if(d){var e=d.getAttribute("data-src"),f=!1,h=d.getAttribute("data-type");if(U(d,"imagelink"))metaBook.showMedia(e,h),f=!0;else if(U(d,"audiolink")||U(d,"musiclink"))metaBook.showMedia(e,h),f=!0;
if(f){D.cancel(a);return}}d=c(b);e=A(d.getAttribute("data-passage"));f=(f=d.getAttribute("data-gloss"))&&metaBook.glossdb.ref(f);if(Q(b,".glossbody")){if(b=f&&f.detail)return"<"===b[0]?fdjt.ID("METABOOKGLOSSDETAIL").innerHTML=f.detail:0===b.search(/^{(md|markdown)}/)?(d=b.indexOf("}"),fdjt.ID("METABOOKGLOSSDETAIL").innerHTML=metaBook.md2HTML(b.slice(d+1))):fdjt.ID("METABOOKGLOSSDETAIL").innerHTML=metaBook.md2HTML(b),metaBook.setMode("glossdetail"),D.cancel(a)}else{if(!f&&e)return metaBook.Skim(e,
d,0),D.cancel(a);if(f&&Q(b,".tool")){if(metaBook.setGlossTarget(f))return metaBook.setMode("addgloss"),D.cancel(a)}else if(f)return metaBook.Skim(e,d,0),D.cancel(a)}}}function h(b){b=b||window.event;var d=D.T(b),e=c(d);L.gestures&&y("slice_held %o: %o, skimming=%o",b,e,metaBook.skimming);if(e){d=e.cloneNode(!0);d.id="METABOOKSKIM";x.replace("METABOOKSKIM",d);metaBook.previewTarget&&(d=metaBook.getDups(metaBook.previewTarget),P(d,"mbpreviewing"),metaBook.clearHighlights(d),metaBook.previewTarget=!1);
var f=e.getAttribute("data-passage"),h=(d=e.getAttribute("data-gloss"))&&metaBook.glossdb.ref(d),d=A(f),g=!1,k=metaBook.getDups(f);metaBook.previewTarget=d;O(k,"mbpreviewing");h&&h.excerpt&&(h=metaBook.findExcerpt(k,h.excerpt,h.exoff))&&(k=h.startContainer,Q(k,d)||(g=a(k,d)),D.Highlight(h,"mbhighlightexcerpt"));if(Q(e,".sbookresults"))for(var e=metaBook.query.tags,f=metaBook.docinfo[f],h=f.knodeterms,k=0,l=e.length;k<l;){var m=e[k++],m=metaBook.highlightTerm(m,d,f,h);g||m&&m.length&&!Q(m[0],d)&&(g=
a(m[0],d))}metaBook.startPreview(g||d,"slice_held");return D.cancel(b)}}function B(a){var b=c(D.T(a||window.event));L.gestures&&y("slice_released %o: %o, skimming=%o",a,b);metaBook.stopPreview("slice_released")}function v(a){a=a||window.event;var b=a.relatedTarget||D.T(a);aa(b,".metabookslice")||metaBook.slipTimeout(function(){L.gestures&&y("slice_slipped/timeout %o",a);metaBook.stopPreview("slice_slipped")})}var H=fdjt.String,G=fdjt.Time,x=fdjt.DOM,y=fdjt.Log,D=fdjt.UI,N=fdjt.RefDB,E=N.Ref,F=metaBook,
A=F.ID,L=F.Trace,O=x.addClass,P=x.dropClass,S=metaBook.icon,t=x.addListener,Q=x.getParent,aa=x.hasParent,X=x.getChild,C=D.cancel,Z=x.toArray;metaBook.renderCard=r;var ja="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");metaBook.nextSlice=function(a){a=x.getParent(a,".metabookcard");if(!a)return!1;for(a=a.nextSibling;a;){if(1===a.nodeType&&U(a,"metabookcard"))return a;a=a.nextSibling}return!1};metaBook.prevSlice=function(a){a=x.getParent(a,".metabookcard");if(!a)return!1;for(a=a.previousSibling;a;){if(1===
a.nodeType&&U(a,"metabookcard"))return a;a=a.previousSibling}return!1};var U=x.hasClass;metaBook.UI.selectSources=function(a,b){var c=[],d=metaBook.sourcedb;if(b&&0!==b.length){for(var f=0,h=b.length;f<h;){var g=d.ref(b[f++]);g&&c.push(g)}a.filter(function(a){return(a=a.gloss)&&(N.contains(c,a.maker)||N.overlaps(c,a.sources)||N.overlaps(c,a.shared))});metaBook.UI.updateScroller(a.container);metaBook.target&&e(metaBook.target,a)}else a.filter(!1)};metaBook.UI.scrollSlice=e;var ka={};l.prototype.setLive=
function(a){if(a){if(this.live)return!1;this.changed&&this.update();return!0}return this.live?(this.live=!1,!0):!1};l.prototype.renderCard=function(a){return r(a)};l.prototype.sortfn=function(a,b){return a.location?b.location?a.location===b.location?a.timestamp?b.timestamp?a.timestamp-b.timestamp:-1:1:a.location-b.location:-1:1};l.prototype.getCard=function(a){if(1===a.nodeType&&U(a,"metabookcard"))return a=a.getAttribute("data-gloss")||a.getAttribute("data-passage"),this.byid.get(a);if(1===a.nodeType){if(a.id||
(a=d(a)),a)return this.byid.get(a.id)||this.byfrag.get(a.id)}else return a._qid&&this.byid.get(a._qid)||a._id&&this.byid.get(a._id)};l.prototype.display=l.prototype.update=function(a){if(this.changed||a){a=this.cards;var b=this.byfrag;a.sort(this.sortfn);var c=Z(x.$(".slicenewpassage",this.container)),d=Z(x.$(".slicenewhead",this.container));this.container.innerHTML="";P(c,"slicenewpassage");P(d,"slicenewhead");for(var d=c=!1,e=document.createDocumentFragment()||this.container,f=0,h=a.length;f<h;){var g=
a[f++];g.hidden||(g.passage!==d&&(d=g.passage,b[d]=g,O(g.dom,"slicenewpassage")),g.head!==c&&(c=g.head,O(g.dom,"slicenewhead")),e.appendChild(g.dom))}e!==this.container&&this.container.appendChild(e);this.changed=!1}};l.prototype.filter=function(a){var b=this.cards,c=0,d=b.length;if(a)for(;c<d;){var e=b[c++];a(e)?e.hidden=!1:e.hidden=!0}else for(;c<d;)delete b[c++].hidden;this.changed=!0;this.update()};l.prototype.addCards=function(a){if(a&&(a instanceof Array||(a=[a]),0!==a.length)){for(var b=this.byid,
c=this.cards,d=0,e=a.length;d<e;){var f=a[d++],h=!1,g,k,l=!1,m=!1;if(f.nodeType&&1===f.nodeType&&U(f,"metabookcard")){g=f;k=f.name||f.getAttribute("name");if(!k)continue;(h=b[k])?(h.dom!==f&&(m=b[k].dom),g=f,h.dom=f):g=f}else f instanceof E&&(k=f._qid||f.getQID(),l=f,b[k]?(h=b[k],g=h.dom):g=this.renderCard(f));g&&(l||(l=N.resolve(k)),h||(b[k]=h={added:G(),id:k,about:l}),h.dom=g,g.getAttribute("data-location")&&(h.location=parseInt(g.getAttribute("data-location"),10)),g.getAttribute("data-gloss")&&
(h.gloss=metaBook.glossdb.refs[g.getAttribute("data-gloss")]),g.getAttribute("data-searchscore")&&(h.score=parseInt(g.getAttribute("data-searchscore"),10)),g.getAttribute("data-timestamp")&&(h.timestamp=parseInt(g.getAttribute("data-timestamp"),10)),g.getAttribute("data-passage")&&(h.passage=g.getAttribute("data-passage")),g.getAttribute("data-tochead")&&(h.head=g.getAttribute("data-tochead")),m?this.container.replaceChild(g,m):c.push(h))}this.live?this.update():this.changed=!0}};metaBook.UI.getCard=
c;fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{summary:{tap:z,hold:h,release:B,click:function(a){a=a||window.event;var b=D.T(a);D.isClickable(b)||C(a)},slip:v}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{summary:{tap:z,hold:h,release:B,touchtoo:function(a){a=a||window.event;metaBook.previewTimeout(!1);metaBook.previewing&&(L.gestures&&y("slice_touchtoo %o noabout",a),metaBook.stopPreview("toc_touchtoo",!0),D.cancel(a))},slip:v}});return l}();(function(){function a(a,b,c,d,f,g,k){d=new Date;var m=metaBook.sourcedb,n=metaBook.knodule;g=g||!1;var q=0,t=a.length,x=!1;g&&g.parentNode&&(x=document.createTextNode(""),g.parentNode.replaceChild(x,g));g?F(g,"completions"):g=f&&f.dom?f.dom:v("div.completions.cloud.noinput",u(y,t));var y=v("div.maxcompletemsg","There are a lot ","(",v("span.completioncount","really"),")"," of completions.  "),A=v("div.nomatchmsg","(no matches)");v.prepend(g,A,y);f||(f=new E(g));var m=p(a,b,n,m),y=17<t&&(0<m.n_primes||
m.max!==m.min||17>m.normals._count||4<t/m.normals._count);y||v.addClass(g,"showall");O(g,".showall")||v.prepend(g,u(y,t));a=[].concat(a);e(a);for(m=0;q<t;)(n=b.get(a[q++]))&&(m+=n);for(q=0;q<t;)n=a[q++],n=r(n,f,b,c,m/t),g.appendChild(n),g.appendChild(document.createTextNode(" "));l(f,b,k);b=new Date;h.clouds&&B("Made cloud for %d tags in %f seconds",a.length,(b.getTime()-d.getTime())/1E3);x&&x.parentNode.replaceChild(g,x);f.updated=function(){z(this)};return f}function r(a,b,c,d){d=d.get(a)||1;c=
c.get(a);a=k(a,b);b=a.title;d&&(b=b?b+"; count="+d:"count="+d);c&&c!==d&&(b=b+"; s="+c);a.title=b;1===d?F(a,"singleton"):2===d&&F(a,"doubleton");return a}function g(a,b,c,d){var e=!1,f=!1;if(a instanceof N){var h=a.dterm,g=!1;a._db===metaBook.knodule?g="index":(g=a._db.fullname?a._db.fullname:(g=metaBook.sourcedb.probe(a._db.name))?a._db.fullname=g.name:"glosses",f=v("sup","*"));b.setAttribute("data-key",h);"string"===typeof f?b.innerHTML=h+f:f?(b.innerHTML=h,b.appendChild(f)):b.innerHTML=h;(d=a[d])&&
"string"===typeof d&&(d=[d]);if(d)for(f=0;f<d.length;){var k=d[f++];if(k!==h){var l=v("span.variation",k,"=");l.setAttribute("data-key",k);e||(e=v("span.variations"));e.appendChild(l)}}a.prime?(F(b,"prime"),F(b,"cue")):a.weak&&F(b,"weak");h=0<h.search(/\.\.\.$/)?"root form":"concept";h=(a.prime?"key ":a.weak?"weak ":"")+("index"===g?"index "+h+" ":h+" (from "+g+") ");h=a.about?h+a.dterm+": "+a.about:(g=a.toPlaintext())&&g!==a.dterm?h+a.dterm+"="+a.toPlaintext():h+"'"+a.dterm+"'";b.title=h}else a.name?
(F(b,"source"),F(b,"account"),b.setAttribute("data-key",a.name),b.innerHTML=a.name):a.refuri&&(F(b,"doc"),b.setAttribute("data-key",a.refuri),c&&b.title&&c.addKeys(b,b.title),b.innerHTML=a.refuri);e&&v.prepend(b,e);c&&c.addKeys(b)}function m(a){var b=a.droplets;if(b){for(var c=0,d=b.length;c<d;){var e=b[c++];g(a,e.entry,e.cloud,e.lang)}delete a.droplets}}function k(a,b,c,d){var e;d||(d="span.completion");"string"!==typeof c&&(c=metaBook.language||Knodule.language||"EN");var f=b&&b.getByValue(a,".completion");
if(f&&f.length)return f[0];if("string"===typeof a)return c=0<a.search(/\.\.\.$/),e=v(d+(c?".rootform":".rawterm")+(20<a.length?".longterm":""),v("span.text","\u201c"+a+"\u201d")),e.setAttribute("data-key",a),e.setAttribute("data-value",a),e.title=c?"forms "+a:a,b&&b.addCompletion(e,a,a),e;if(a instanceof D){f=a._qid||a.getQID();e=a._id||a.dterm;if(a._db===metaBook.docdb)return c=a.title,40<c.length?v("span.name.ellipsis",c.slice(0,17),v("span.elision","\u2026"),v("span.elided",c.slice(c.length-17))):
25<c.length?v("span.name.longname",c):v("span.name",c),e=v("span.name",c),e=v(d+".sectname","\u00a7",e),e.setAttribute("data-key",c),e.setAttribute("data-value",a._qid||a.getQID()),24<c.length&&F(e,"longterm"),20<c.length&&(e.title=c),b&&b.addCompletion(e,c,a),e;e=a instanceof N?v(20<e.length?d+".dterm.longterm":d+".dterm",f):v(20<e.length?d+".longterm":d,f);a.cssclass&&F(e,a.cssclass);e.setAttribute("data-value",f);b&&b.addCompletion(e,!1,a);if(a._live)return g(a,e,b,c),e;if(a.droplets)a.droplets.push({entry:e,
lang:c,cloud:b});else return a.droplets=[{entry:e,lang:c,cloud:b}],a.onLoad(m),e}else return c=e.toString(),e=v(20<c.length?d+".weirdterm.longterm":d+".weirdterm","?"+c+"\u00bf"),e.title=c,b&&b.addCompletion(e,c,a),e}function q(a,b,c,d,e,f){c||(c=metaBook.knodule);if(a)if(a instanceof Array)for(var h=0,g=a.length;h<g;)q(a[h++],b,c,d,e,f);else return h=b.dom,a="string"===typeof a&&c?y.resolve(a,c,Knodule,!1)||a:a,b=d?r(a,b,d,e,f):k(a,b),S(b,h)||v(h,b," "),b}function u(a,b){var c=a&&v("span.showall",
v("span.showmore","more"),v("span.showless","fewer"));b&&c&&(c.title="There are "+b+" in all");c&&(c.onclick=f);return c}function p(a,b,c,d){for(var e=c=!1,f={},h=0,g=0,k=0;k<a.length;){var l=a[k++];l instanceof D&&(l.prime&&g++,l._db===d||l.weak||(f[l]=!0,h++));b&&(l=b.get(l))&&(!1===c?c=l:l<c&&(c=l),l>e&&(e=l))}f._count=h;return{normals:f,n_primes:g,min:c,max:e}}function f(a){var b=H.T(a),c=P(b,".completions");c&&(H.cancel(a),v.toggleClass(c,"showall"),setTimeout(function(){metaBook.UI.updateScroller(c)},
100))}function b(b){if("expandsearch"===metaBook.mode)return metaBook.empty_cloud;if(!b.cloud)if(0===b.tags.length)b.cloud=metaBook.empty_cloud;else{var c=b.getRefiners(),d=a(c,b.tagscores,b.tagfreqs,c.length,!1,!1,b.tags),e=d.dom;d.taphold||(d.taphold=new x(e));F(e,"searchcloud");metaBook.setupGestures(e);if(c.length>metaBook.show_refiners){var c=[].concat(c),f=b.tagscores;c.sort(function(a,b){if("string"===typeof a&&"string"===typeof b||a instanceof D&&b instanceof D){var c=f.get(a),d=f.get(b);
return"number"===typeof c&&"number"===typeof d?d-c:"number"===typeof c?-1:1}return"string"===typeof a?1:-1});for(var e=0,h=metaBook.show_refiners;e<h;){var g=c[e++],g=d.getByValue(g);F(g,"cue")}}else F(e,"showall");b.cloud=d}return b.cloud}function e(a){a.sort(function(a,b){var c=a,d=b;if(a instanceof N)if(b instanceof N)c=a.dterm,d=b.dterm;else return-1;else{if(b instanceof N)return 1;if(a instanceof D)if(b instanceof D)c=a._qid||a.getQID(),d=b._qid||b.getQID();else return-1;else{if(b instanceof
D)return 1;if("string"!==typeof a||"string"!==typeof b){if("string"===typeof a)return-1;if("string"===typeof b)return 1;if(typeof a===typeof b)return a<b?-1:a>b?1:0;c=typeof a;d=typeof b;return c<d?-1:c>d?1:0}}}if("\u00a7"===c[0]&&"\u00a7"!==d[0])return 1;if("\u00a7"===d[0]&&"\u00a7"!==c[0])return-1;0<c.search(/\w/)&&(c=c.slice(c.search(/\w/)));0<d.search(/\w/)&&(d=d.slice(d.search(/\w/)));return c<d?-1:c>d?1:0})}function l(a,b,c){var d=metaBook.tagscores,e=metaBook.tagweights,f=a.values,g=a.byvalue,
k=Array(f.length),l=0,m=f.length,q=Infinity,p=-1;for(h.clouds&&B("Sizing %d tags in cloud %o with roots %o",f.length,a.dom,c);l<m;){var r=f[l];if(c&&c.length&&0<=c.indexOf(r))k[l++]=!1;else{if(b)var t=b.get(r),v=d.get(r),r=t/v*e.get(r);else r=d.get(r);"number"!==typeof r||!r&&0!==r?k[l]=!1:(k[l]=r,r<q&&(q=r),r>p&&(p=r));l++}}h.clouds&&B("Sizing %d tags in %o with scores in [%o,%o]",f.length,a.dom,q,p);a.dom.style.display="none";for(l=0;l<m;)d=f[l],e=k[l],b=g.get(d),d.prime&&(F(b,"prime"),F(b,"cue")),
c&&c.length&&0<=c.indexOf(d)&&F(b,"cloudroot"),e?(d=50+(e-q)/(p-q)*150,b.style.fontSize=200>d?Math.round(d)+"%":"200%"):(F(b,"unscored"),b.style.fontSize=""),l++;h.clouds&&B("Finished computing sizes for %o using scores [%o,%o]",a.dom,q,p);a.dom.style.display="";A(a.dom,"working");h.clouds&&B("Rendered new cloud %o using scores [%o,%o]",a.dom,q,p);a.dom.parentNode&&setTimeout(function(){z(a)},50);h.clouds&&B("Finished sizing tags in %o using scores [%o,%o]",a.dom,q,p)}function d(a){metaBook.setQuery(metaBook.extendQuery(metaBook.query,
a))}function c(a,b){for(var c=L(a.dom,".cue.softcue"),d=0,e=c.length;d<e;){var f=c[d++];A(f,"cue");A(f,"softcue")}c=a.getByValue(b);d=0;for(e=c.length;d<e;)f=c[d++],t(f,"cue")||(F(f,"cue"),F(f,"softcue"))}function z(a){var b=Math.round,c=Math.sqrt;a=a.dom;var d=a.parentNode;if(d){var e=100;a.style.fontSize="";var f=a.scrollHeight,d=d.clientHeight;h.clouds&&B("Adjusting cloud %o: %o/%o",a,f,d);0===d||0===f||f<d&&f>.8*d||f>2*d||(d*=.9,e=f<d?b(c(d/f)*(e/100)*100):b(d/f*(e/100)*100),a.style.fontSize=
200<e?"200%":e+"%",h.clouds&&B("Adjusted cloud %o: %o/%o to %o%%",a,f,d,e))}else a.style.fontSize=""}var h=metaBook.Trace,B=fdjt.Log,v=fdjt.DOM,H=fdjt.UI,G=fdjt.ID,x=fdjt.TapHold,y=fdjt.RefDB,D=fdjt.Ref,N=Knodule.KNode;metaBook.search_cloud=!1;metaBook.empty_cloud||(metaBook.empty_cloud=!1);metaBook.show_refiners||(metaBook.show_refiners=25);metaBook.search_gotlucky||(metaBook.search_gotlucky=7);var E=H.Completions,F=v.addClass,A=v.dropClass,L=v.getChildren,O=v.getChild,P=v.getParent,S=v.hasParent,
t=v.hasClass,Q=B,aa=y.resolve;metaBook.makeCloud=a;metaBook.cloudEntry=k;metaBook.addTag2Cloud=q;metaBook.UI.getShowAll=u;metaBook.queryCloud=b;y.Query.prototype.getCloud=function(){return b(this)};metaBook.tag_sorter=function(a,b,c){if(a instanceof N){if(!(b instanceof N))return-1}else{if(b instanceof N)return 1;if(a instanceof D){if(!(b instanceof D))return-1}else{if(b instanceof D)return 1;if("string"!==typeof a||"string"!==typeof b){if(typeof a===typeof b)return a<b?-1:a>b?1:0;a=typeof a;b=typeof b;
return a<b?-1:a>b?1:0}}}var d=c.get(a);c=c.get(b);return"undefined"===typeof d?"undefined"===typeof c?("string"!==typeof a&&(a=a._qid||a.getQID(),b=b._qid||b.getQID()),a<b?-1:b>a?1:0):1:"undefined"===typeof c?-1:d===c?a<b?-1:a>b?1:0:d>c?-1:1};metaBook.sortTags=e;metaBook.sortCloud=function(a){var b=[].concat(a.values);e(b);for(var c=a.byvalue,d=document.createDocumentFragment(),f=0,h=b.length;f<h;){var g=b[f++];if(g=c.get(g))1<f&&d.appendChild(document.createTextNode(" ")),d.appendChild(g)}a.dom.appendChild(d)};
metaBook.sizeCloud=l;metaBook.UI.handlers.searchcloud_select=function(a){a=a||window.event;var b=v.T(a),c=P(b,".completion");if(t(c,"cloudroot"))h.gestures&&Q("cloud tap on cloudroot %o",c);else{h.gestures&&Q("cloud tap on %o",c);var e=P(b,".completions");c?(b=metaBook.query.cloud.getValue(c),"string"!==typeof b?d(b):0!==b.length&&(0<=b.indexOf("@")?d(aa(b)):metaBook.knodule&&metaBook.knodule.probe(b)?d(metaBook.knodule.probe(b)):d(b)),H.cancel(a)):v.inherits(b,".resultcounts")?(metaBook.showSearchResults(metaBook.query),
metaBook.setMode("searchresults"),G("METABOOKSEARCHINPUT").blur(),G("METABOOKSEARCHRESULTS").focus(),H.cancel(a)):v.inherits(b,".refinercounts")?(v.toggleClass(e,"showall"),v.cancel(a)):v.inherits(b,".maxcompletemsg")&&(G("METABOOKSEARCHINPUT").focus(),v.toggleClass(e,"showall"),v.cancel(a))}};metaBook.UI.searchCloudToggle=function(){v.toggleClass(G("METABOOKSEARCHCLOUD"),"showall");metaBook.UI.updateScroller(G("METABOOKSEARCHCLOUD"))};metaBook.setCloudCues=c;metaBook.setCloudCuesFromTarget=function(a,
b){var d=[],e=b.codexbaseid||b.id||b.frag,f=metaBook.docinfo[e],e=metaBook.glossdb.find("frag",e),h=metaBook.knodule;f&&f.tags&&(d=d.concat(f.tags));if(f&&f.autotags&&f.autotags.length)for(var f=f.autotags,g=0,k=f.length;g<k;){var l=h.probe(f[g]);l&&d.push(l.tagString());g++}h=0;for(f=e.length;h<f;)(g=e[h++].tags)&&(d=d.concat(g));c(a,d)};metaBook.adjustCloudFont=z;E.prototype.adjustCloudFont=function(){return z(this)}})();(function(){function a(a,b){"string"===typeof a&&(a=p.resolve(a));var g=a.humid;if(a.name){if(b){var h=f("SBOOKSOURCEICON"+g);if(!h){var h=a.pic||a.fbid&&"https://graph.facebook.com/"+a.fbid+"/picture?type=square",l=a.kind;h||(h=":CIRCLE"===l||a.iscircle?e("readingcircle",64,64):e("sideguide",64,64));h=h?q.Image(h,".button.source",a.name|a.kind,"click to show/hide glosses from "+a.name):q("div.button.source",k.getInitials(a.name));h.title=(":CIRCLE"===l?"the reading circle ":":OVERLAY"===l?"the reading guide ":
"the layer ")+(a.name?"\u201c"+a.name+"\u201d":"")+(a.about?": ":"")+(a.about?a.about:"");h.oid=a._id;h.id="SBOOKSOURCEICON"+g;q(f("METABOOKSOURCES")," ",h)}}return a}}function r(a){return a.pic||a.fb_pic||a.twitter_pic||a.gplus_pic||a.fbid&&"https://graph.facebook.com/"+a.fbid+"/picture?type=square"}function g(a,b,e){var f=metaBook.sourcedb,g=metaBook.glossdb;e||(e=q.getChild(a,".wedge"));var k=e.getAttribute("data-images").split("|");1===k.length&&""===k[0]&&(k=[]);for(var l=0,m=b.length;l<m;){var p=
b[l++];"string"!==typeof p&&(p=p._id);if(p){var u=g.ref(p),D=a.glosses,N=u.maker&&f.ref(u.maker);(N=N&&r(N))&&k.push(N);D?0>D.indexOf(p)&&D.push(p):a.glosses=[p];p=u.sources||[];"string"===typeof p&&(p=[p]);u=0;for(D=p.length;u<D;)N=f.ref(p[u++]),(N=r(N))&&k.push(N)}}e.setAttribute("data-images",k.join("|"));return a}function m(a,b){return a.location&&b.location?a.location>b.location?-1:a.location<b.location?1:0:a.exoff&&b.exoff?a.exoff>b.exoff?-1:a.exoff<b.exoff?1:0:a.created>b.created?-1:a.created<
b.created?1:0}var k=fdjt.String,q=fdjt.DOM,u=fdjt.UI,p=fdjt.RefDB,f=fdjt.ID,b=q.hasClass,e=metaBook.icon;metaBook.UI.addSource=a;metaBook.UI.addGlossSource=function(b){a(b,!0)};metaBook.UI.handlers.everyone_ontap=function(a){a=a||window.event||null;var b=q.T(a),e=f("METABOOKSOURCES"),h=f("METABOOKALLGLOSSES");e&&h&&(q.hasClass(b,"selected")?metaBook.setMode(!1):(e=q.$(".selected",e),q.toggleClass(e,"selected"),q.addClass(b,"selected"),metaBook.UI.selectSources(metaBook.glosses,!1)),q.cancel(a))};
metaBook.UI.handlers.sources_ontap=function(a){a=a||window.event||null;var b=q.T(a),e=f("METABOOKSOURCES"),h=f("METABOOKALLGLOSSES"),g=[];if(e&&h&&b.oid){if(a.shiftKey||q.hasClass(b,"selected")){q.toggleClass(b,"selected");for(var b=q.$(".selected",e),h=0,k=b.length;h<k;){var l=b[h++].oid;l&&g.push(l)}}else{g=q.$(".selected",e);h=0;for(k=g.length;h<k;)q.dropClass(g[h++],"selected");q.addClass(b,"selected");g=[b.oid]}e=q.$(".everyone",e)[0];g.length?(e&&q.dropClass(e,"selected"),metaBook.UI.selectSources(metaBook.glosses,
g)):(e&&q.addClass(e,"selected"),metaBook.UI.selectSources(metaBook.glosses,!1));q.cancel(a)}};metaBook.UI.addGlossmark=function(a,b){var f=metaBook.glossdb,h=q.getChild(a,".glossmark");if(h&&h.parentNode===a)return b&&g(h,[b]),h;var h=e("sbwedge",64,64),k=q.Image(h,"wedge","glosses"),l=q("a.glossmark.fdjtskiptext",k),m=a.getAttribute("data-baseid")||a.id,f=f.find("frag",m);l.title=1<f.length?"See "+f.length+" glosses on this passage":"See the gloss on this passage";k.defaultsrc=h;k.setAttribute("data-images",
"");g(l,f,k);metaBook.UI.addHandlers(l,"glossmark");q.addClass(a,"glossed");q.prepend(a,l);l.name="METABOOK_GLOSSMARK_"+m;return l};var l=metaBook.Slice;metaBook.showGlossmark=function(a,c){var e=a.codexbaseid||a.id;if(e){var g=metaBook.getDups(a.id),k=metaBook.glossdb.find("frag",e),p=[],e=q("div.metabookglosses.metabookslice");k&&k.length||q.addClass(e,"noglosses");metaBook.target&&metaBook.clearHighlights(metaBook.target);for(var r=0,G=k.length;r<G;){var x=metaBook.glossdb.ref(k[r++]);p.push(x)}for(r=
0;r<G;)k=p[r++],k.excerpt&&(k=metaBook.findExcerpt(g,k.excerpt,k.exoff))&&(b(k.startContainer,"mbhighlightexcerpt")||u.Highlight(k,"mbhighlightexcerpt"));g=new l(e,p,m);p=q("div.hudpanel#METABOOKPOINTGLOSSES",e);if(c){p.style.display="block";p.style.opacity=0;q.replace("METABOOKPOINTGLOSSES",p);r=q.getGeometry(e);q.getGeometry(p);var G=q.getGeometry(c),k=q.getGeometry(a),x=q.viewWidth(),y=q.viewHeight();if(metaBook.fullwidth)p.style.left="10px",p.style.width=p.style.maxWidth=p.style.minWidth=x-30+
"px";else if(r.width>x)p.style.maxWidth=x-20+"px",p.style.minWidth=Math.floor(x/2)+"px",p.style.left="10px";else if(r.height>y/2||500>x)500>x?(p.style.maxWidth=x-20+"px",p.style.minWidth=Math.floor(x/2)+"px",p.style.left="10px"):p.style.maxWidth=x-100+"px";r=q.getGeometry(e);q.getGeometry(p);!metaBook.fullwidth&&r.width>x-50&&(p.style.left="10px");var D=!1,D=r.height+15>y/2?y/2:r.height+10;!metaBook.fullwidth&&50<D&&(p.style.minHeight=D+"px");e.style.overflowX="hidden";e.style.overflowY="auto";var e=
G.top-60,N=y-60-G.bottom,E=y-60-k.bottom;k.bottom<G.bottom&&(k.bottom=G.bottom+10);D<e?p.style.top=G.top-(D+15)+"px":r.height<E?p.style.top=k.bottom+5+"px":r.height<N?p.style.top=G.bottom+15+"px":(metaBook.fullwidth||(p.style.right=x-G.left+10+"px",p.style.left="50px"),p.style.top=50>G.top-y/4?"50px":G.top-y/4+"px",p.style.bottom="auto",p.style.height=y/2+"px");!metaBook.fullwidth&&300>q.viewWidth()&&(p.style.minWidth=q.viewWidth()-10+"px");p.style.display="";p.style.opacity=""}else q.replace("METABOOKPOINTGLOSSES",
p);if(c){if(e=f("METABOOKOPENGLOSSMARK"))metaBook.target&&metaBook.clearHighlights(metaBook.target),e.id="";c.id="METABOOKOPENGLOSSMARK"}metaBook.setTarget(a);g.update();metaBook.setMode("openglossmark")}};metaBook.clearGlossmark=function(){"openglossmark"===metaBook.mode&&metaBook.setMode(!1,!0);var a=q("div.metabookglosses.metabookslice"),a=q("div.hudpanel#METABOOKPOINTGLOSSES",a);q.replace("METABOOKPOINTGLOSSES",a)}})();(function(){function a(a){p.search&&H("Setting working query to %o",a);var b=a.getString();b!==metaBook.qstring&&(metaBook.query=a,metaBook.qstring=b,0===a.tags.length?(h(metaBook.HUD,"emptysearch"),metaBook.empty_cloud.dom.style.fontSize="",metaBook.search_cloud=metaBook.empty_cloud):(b=metaBook.queryCloud(a),B(metaBook.HUD,"emptysearch"),e.replace("METABOOKSEARCHCLOUD",b.dom),metaBook.search_cloud=b),r(a,d("METABOOKSEARCH")));"refinesearch"===metaBook.mode&&0!==a.results.length&&(7>a.results.length?
m():d("METABOOKSEARCHINPUT").focus())}function r(a,b){a instanceof z||(a=new metaBook.Query(a));var c=a.getString();b&&"string"===typeof b&&(b=document.getElementById(b));var f=b||a._box||d("METABOOKSEARCH");a.dom&&f&&f!==a.dom&&e.replace(b,a.dom);f.setAttribute("qstring",c);a.execute();var g=a.getCoTags(),k=a.getRefiners(),l=v(f,".searchinput"),m=l.getAttribute("completions"),q=l.getAttribute("info"),r=v(f,".qtags")||d("METABOOKSEARCHTAGS"),u=m&&d(m),x=q&&d(q),y=v(x,".resultcount"),q=v(x,".refinecount");
l.value="";var l=a.tags,B=0,D=l.length;l.length?e.dropClass(metaBook.HUD,"emptysearch"):h(metaBook.HUD,"emptysearch");e.dropClass("METABOOKSEARCHINFO","notags");for(var N=e("div.qtags");B<D;){var T=l[B];"string"===typeof T&&(T=G(T)||T);T=metaBook.cloudEntry(T,!1,!1,"span.qelt");T.appendChild(e("span.redx","x"));e(N,0<B&&"\u00a0\u00b7 ",T);B++}r.id&&(N.id=r.id);e.replace(r,N);a.results.length?(y.innerHTML=a.results.length+" <br/>result"+(1===a.results.length?"":"s"),e.dropClass([f,x],"noresults")):
(y.innerHTML="no results",h([f,x],"noresults"));N.setAttribute("data-maxfont","120%");N.setAttribute("data-min","60%");fdjt.DOM.adjustFontSize(N);var g=k?k.length:g?g.length:0,J=metaBook.queryCloud(a);q.innerHTML=g+" <br/>"+(1===g?"co-tag":"co-tags");e.dropClass(f,"norefiners");0===a.tags.length?(e.replace("METABOOKSEARCHCLOUD",e("div#METABOOKSEARCHCLOUD")),metaBook.empty_cloud.dom.style.fontSize="",metaBook.empty_cloud.complete("")):(m&&(J.id=m),1<p.search&&H("Setting search cloud for %o to %o",
f,J.dom),m=u.id,h(J.dom,"hudpanel"),e.replace(u,J.dom),J.dom.style.fontSize="",J.complete("",function(){metaBook.adjustCloudFont(J)}));0===g&&(h(f,"norefiners"),q.innerHTML="no refiners");a._box=f;f.setAttribute("qstring",c);metaBook.UI.updateScroller(J.dom);return a}function g(a,b){var c=[].concat(a.tags);"string"===typeof b?0<=b.indexOf("@")?c.push(G(b)||b):c.push(b):c.push(b);return r(new metaBook.Query(c),a._box)}function m(){var a=metaBook.query.showResults();h(a,"hudpanel");e.replace("METABOOKSEARCHRESULTS",
a);metaBook.setMode("searchresults");d("METABOOKSEARCHINPUT").blur();d("METABOOKSEARCHRESULTS").focus();metaBook.UI.updateScroller(d("METABOOKSEARCHRESULTS"))}function k(a,b){a||(a=d("METABOOKSEARCHINPUT"));b||(b=metaBook.queryCloud(metaBook.query));0===a.value.length&&b.clearSelection();b.complete(a.value,function(c){0<a.value.length&&(!c||0===c.length||4<a.value.length)&&(q(b,a.value),setTimeout(function(){b.complete(a.value)},50));metaBook.UI.updateScroller("METABOOKSEARCHCLOUD")})}function q(a,
b,c,d){c||(c=metaBook.textindex.prefixTree());d||(d=42);b=f.prefixFind(c,b);if(0!==b.length&&!(b.length>d))for(d=0,c=b.length;d<c;)metaBook.cloudEntry(b[d++],a)}function u(a){if(!(this instanceof u))return new u(a);this.query=a;this.results=a.results;return N.call(this,e("div.metabookslice.sbookresults"),this.results)}var p=metaBook.Trace,f=fdjt.String,b=fdjt.Log,e=fdjt.DOM,l=fdjt.UI,d=fdjt.ID,c=fdjt.RefDB,z=c.Query;metaBook.search_cloud=!1;metaBook.empty_cloud||(metaBook.empty_cloud=!1);metaBook.show_refiners||
(metaBook.show_refiners=25);metaBook.search_gotlucky||(metaBook.search_gotlucky=7);var h=e.addClass,B=e.dropClass,v=e.getChild,H=b,G=c.resolve;metaBook.getQuery=function(){return metaBook.query};metaBook.setQuery=a;metaBook.useQuery=r;var x=e.hasParent,y=e.hasParent;metaBook.searchTags_onclick=function(c){var d=l.T(c),e=x(d,".redx");if(d=y(d,".qelt")){l.cancel(c);var d=d.getAttribute("data-value"),f;0<=d.indexOf("@")&&(f=G(d)||d);p.gestures&&b("searchTags_ontap %o: %s%o",c,e?"(onx) ":"",f);e=[].concat(metaBook.query.tags);
f=e.indexOf(f);0>f||(e.splice(f,1),0===e.length?(metaBook.empty_cloud.dom.style.fontSize="",a(metaBook.empty_query)):a(new metaBook.Query(e)),l.cancel(c))}};metaBook.extendQuery=g;metaBook.updateQuery=function(a){a=Knodule.Query.string2query(a.value);a!==metaBook.query.tags&&metaBook.setQuery(a,!1)};metaBook.showSearchResults=m;metaBook.startSearch=function(b){a([b]);metaBook.setMode("refinesearch")};var D=e.Selector;metaBook.UI.handlers.search_keydown=function(b){b=b||window.event||null;var c=b.charCode||
b.keyCode,d=e.T(b),h=!1,k=!1;if(13===c||13===c||59===c||93===c){d=d.value;if(f.isEmpty(d))m();else{h=metaBook.queryCloud(metaBook.query);h.timer&&(clearTimeout(h.timer),h.timer=!1);k=h.complete(d);k=h.selection||h.select(new D(".cue"))||h.select();if(!k){(b=metaBook.textindex.termindex[d])&&b.length&&a(g(metaBook.query,d));return}h=h.getValue(k);a(g(metaBook.query,h))}e.cancel(b);metaBook.search_gotlucky&&0<metaBook.query.results.length&&metaBook.query.results.length<=metaBook.search_gotlucky?m():
(h=metaBook.queryCloud(metaBook.query),h.complete(""));return!1}9===c&&(c=d.value,h=metaBook.queryCloud(metaBook.query),k=h.complete(c),l.cancel(b),k.prefix&&k.prefix!==c?(d.value=k.prefix,e.cancel(b),setTimeout(function(){metaBook.UI.updateScroller("METABOOKSEARCHCLOUD")},100),h.selectNext()):b.shiftKey?h.selectPrevious():h.selectNext())};metaBook.UI.handlers.search_keyup=function(a){a=a||window.event||null;var b=a.charCode||a.keyCode,c=e.T(a);13!==b&&13!==b&&59!==b&&93!==b&&9!==b&&(8===b?setTimeout(function(){k(c)},
100):k(c))};metaBook.UI.handlers.search_keypress=function(a){a=a||window.event||null;var b=a.charCode||a.keyCode;a=e.T(a);13!==b&&13!==b&&59!==b&&93!==b&&9!==b&&8!==b&&k(a)};metaBook.searchUpdate=k;metaBook.UI.handlers.search_focus=function(a){a=a||window.event||null;a=e.T(a);metaBook.setFocus(a);metaBook.mode&&"searchresults"===metaBook.mode&&metaBook.setMode("refinesearch");k(a)};metaBook.UI.handlers.search_blur=function(a){a=a||window.event||null;a=e.T(a);metaBook.clearFocus(a)};metaBook.UI.handlers.clearSearch=
function(b){var c=l.T(b||window.event),c=e.getParent(c,".searchbox"),c=v(c,".searchinput");l.cancel(b);0===metaBook.query.tags.length&&0===c.value.length?metaBook.setMode(!1):(metaBook.empty_cloud.dom.style.fontSize="",a(metaBook.empty_query),c.value="",metaBook.empty_cloud.clearSelection(),metaBook.empty_cloud.complete(""),c.focus())};metaBook.toggleSearch=function(a){a=a||window.event;"refinesearch"===metaBook.mode||"searchresults"===metaBook.mode?metaBook.setMode(!1):(metaBook.setMode("refinesearch"),
d("METABOOKSEARCHINPUT").focus());l.cancel(a)};var N=metaBook.Slice;metaBook.SearchResults=u;u.prototype=new N;u.prototype.renderCard=function(a){return metaBook.renderCard(a,this.query)};u.prototype.sortfn=function(a,b){if(a.score)if(b.score)if(a.score===b.score){if(a.location)return b.location?a.location===b.location?a.timestamp?b.timestamp?a.timestamp-b.timestamp:-1:1:a.location-b.location:-1}else return b.score-a.score;else return-1;else return 1};c.Query.prototype.showResults=function(){var a;
this.listing||(this.listing=new u(this));a=this.listing.container;return a}})();(function(){function a(a,b,c){function d(b){var e=W(f,".metabookglossform"),g=!1,g=K.getInput(f,"FRAG"),h=K.getInput(f,"UUID");(ea.mode||ea.glossing)&&V("setGlossMode %o%s: #%s #U%s",a,c?" (toggle)":"",g&&g.value,h&&h.value);c&&a===f.className&&(a=!1);a&&fa(e,"focused");if(a){if("addtag"===a)g=ga("METABOOKADDTAGINPUT");else if("attach"===a)ga("METABOOKUPLOADGLOSSID").value=h.value,ga("METABOOKUPLOADITEMID").value=Xa.getUUID(),g=ga("METABOOKATTACHURL");else if("addoutlet"===a)g=ga("METABOOKADDSHAREINPUT");
else return ra(f,Ma),ra("METABOOKHUD",/\bgloss\w+\b/),b(f);(ea.mode||ea.glossing)&&V("setGlossMode gm=%s input=%o",a,g);f.className=a;pa("METABOOKHUD",/\bgloss\w+\b/,"gloss"+a);metaBook.setHUD(!0);a&&/(addtag|addoutlet)/.exec(a)&&fa("METABOOKHUD","openheart");g&&metaBook.setFocus(g);return b(f)}ra(f,Ma);ra("METABOOKHUD",/\bgloss\w+\b/);ra("METABOOKHUD","openheart");metaBook.touch||((b=ma(f,"NOTE"))&&metaBook.setFocus(b),fa(e,"focused"))}var e,f;a&&b&&a.nodeType&&"string"===typeof b?(e=a,a=b):e=b?
"string"===typeof b?ga(b):b:ga("METABOOKLIVEGLOSS");if(e&&e.nodeType){if(f="FORM"===e.tagName?e:K.getParent(e,"form")||K.getChild(e,"form"))return new Promise(d);V.warn("Missing FORM for setGlossMode")}else return V.warn("Missing DOM arg for setGlossMode"),!1}function r(a,c){"string"===typeof a&&(a=ga(a)||metaBook.glossdb.ref(a)||!1);if(!a)return!1;var d=!a.nodeType&&(a.maker||a.gloss)&&a;d?a.maker&&a.maker!==metaBook.user&&(c=!0):c=!1;var f=d?Ga(d.frag):a,g=f.codexbaseid||f.id,h=d?c?"METABOOKRESPONDGLOSS_"+
d._id:"METABOOKEDITGLOSS_"+d._id:"METABOOKADDGLOSS_"+g,k=ga(h),g=k&&k.parentNode,k=ga("METABOOKADDGLOSSPROTOTYPE");if(g)k=M(g,"form")[0];else{g=k.cloneNode(!0);g.id="";K(ga("METABOOKADDGLOSS"),g);k=M(g,"form")[0];k.id=h;var h=k,k=c||!1,m=f.codexbaseid||f.id,n=metaBook.docinfo[m];if(h.getAttribute("sbooksetup"))k=!1;else if(n){h.onsubmit=F;ma(h,"REFURI").value=metaBook.refuri;ma(h,"DOCTITLE").value=document.title;ma(h,"DOCURI").value=document.location.href;ma(h,"FRAG").value=m;n.wsnid&&(ma(h,"WSNID").value=
n.wsnid);metaBook.user&&(ma(h,"MAKER").value=metaBook.user._id);metaBook.mycopyid&&(ma(h,"MYCOPYID").value=metaBook.mycopyid);d&&(m=Y(h,".glossdate"),K(m,va.shortString(d.created)),m.title=va.timeString(d.created));var m=ma(h,"NOTE"),p=Y(h,".notespan");m&&(m.onkeypress=v,m.onkeydown=H,m.onfocus=B,d&&!k?(m.value=d.note||"",p&&(p.innerHTML=m.value)):m.value="");metaBook.syncstamp&&(ma(h,"SYNC").value=metaBook.syncstamp+1);m=Y(h,".addglossmenu");fdjt.UI.TapHold(m,{override:!0});var q=ma(h,"LOCATION"),
r=ma(h,"LOCLEN"),hb=ma(h,"TAGLINE"),t=ma(h,"RE"),w=ma(h,"THREAD"),m=ma(h,"UUID"),p=ma(h,"DETAIL"),u=Y(h,"div.response");if(u&&k&&d){var x=Y(u,".respmaker"),y=Y(u,".respdate"),u=Y(u,".respnote"),J=metaBook.sourcedb.ref(d.maker);K(x,J.name);K(y,va.shortString(d.created));d.note?(42<d.note.length?K(u,d.note.slice(0,42)+"\u2026"):K(u,d.note),u.title=d.note):K.remove(u)}else K.remove(u);q&&(q.value=n.starts_at);r&&(r.value=n.ends_at-n.starts_at);k&&d?(w.disabled=!1,t.disabled=!1,w.value=d.thread||d._id,
t.value=d._id):(t.disabled=!0,w.disabled=!0);(n=f.getAttributeNS("tagline","https://sbooks.net/")||f.getAttribute("data-tagline")||f.getAttribute("tagline"))?f=n:(f=K.textify(f))?(f=da.stdspace(f),f=40<f.length?f.slice(0,40)+"...":f):f=!1;f&&(hb.value=f);if(d&&(f=ia(d),f.length))for(n=0,hb=f.length;n<hb;)z(h,f[n++],!1);if(d&&!k&&d.posted){if(f=Y(h,".wasposted"))f.disabled=!1;f=Y(h,".postgloss");I.setCheckspan(f,!0)}if(d&&!k&&d.links){var f=d.links,Ea;for(Ea in f)"_"!==Ea[0]&&(n=f[Ea],l(h,Ea,"string"===
typeof n?n:n.title))}d&&(p.value=d.detail||"");if(d&&d.share)for(Ea=d.share,"string"===typeof Ea&&(Ea=[Ea]),f=0,p=Ea.length;f<p;)z(h,Ea[f++],"SHARE");m.value=!k&&d&&d._id?d._id:Xa.getUUID(metaBook.nodeid);if(d){Ea=Y(h,".outlets");Ea=M(Ea,".checkspan");k=0;for(m=Ea.length;k<m;)f=Ea[k++],La(f,!1);Ea=d&&d.shared||[];"string"===typeof Ea&&(Ea=[Ea]);k=0;for(m=Ea.length;k<m;)e(h,Ea[k++],"SHARE",!0);Ea=Y(h,".private");La(Ea,d.private)}d&&d.excerpt&&metaBook.setExcerpt(h,d.excerpt,d.exoff);(Ea=K.getChild(h,
".cancelbutton"))&&K.addListener(Ea,"click",A);h.setAttribute("sbooksetup","yes");b(h);(Ea=W(h,".metabookglossform"))&&ra(Ea,"modified");k=h}else k=!1;metaBook.setupGestures(g)}d?c?fa(g,"glossreply"):(fa(g,"glossedit"),fa(metaBook.HUD,"editgloss")):fa(g,"glossadd");return k?g:!1}function g(a,b,d){ea.glossing&&V("setGlossTarget %o form=%o selecting=%o",a,b,d);metaBook.glosstarget&&ra(metaBook.glosstarget,"mbglosstarget");ra("METABOOKHUD",/\bgloss\w+\b/);ra("METABOOKHUD","editgloss");if(a){var e=!1;
"string"===typeof a&&Ga(a)?a=Ga(a):"string"===typeof a&&metaBook.glossdb.probe(a)?(e=metaBook.glossdb.ref(a),a=Ga(e.frag)):a._db===metaBook.glossdb&&(e=a,a=Ga(e.frag));e&&b&&!b.nodeType&&(b=r(e,!0));if(b){var h=K.getInput(b,"FRAG");h.value!==a.id&&(c(b,!1),K.addClass(W(b,".metabookglossform"),"modified"),h.value=a.id)}else if(b=e?r(e):r(a),!b)return I.alert("There was a problem adding a gloss"),!1;metaBook.glosstarget=a;metaBook.select_target=!1;fa(a,"mbglosstarget");e.exoff?metaBook.GoTo({target:a,
offset:e.exoff},"addgloss",!0):metaBook.GoTo(a,"addgloss",!0);metaBook.setCloudCuesFromTarget(metaBook.gloss_cloud,a);f(b);k(!1);metaBook.clearHighlights(a);d?k(d):k(u(a));e&&e.excerpt&&e.excerpt.length?metaBook.selecting.setString(e.excerpt):d&&q(b,d);metaBook.selecting.onchange=function(){q(b,this)};return b}if(a=ga("METABOOKLIVEGLOSS"))a.id="";metaBook.glosstarget=!1;metaBook.glossform=!1;k(!1)}function m(a){a=a.nodeType?a:I.T(a);a=W(a,"FORM");(a=W(a,".metabookglossform"))&&fa(a,"modified")}function k(a){metaBook.selecting!==
a&&(metaBook.selecting&&((ea.selection||ea.glossing)&&V("setSelecting, replacing %o with %o",metaBook.selecting,a),metaBook.selecting.clear()),metaBook.selecting=a)}function q(a,b){var c=b.getInfo();(ea.glossing||ea.selection)&&V("Updating excerpt for %o from %o: %s",a,b,b.getString());if(c){metaBook.setExcerpt(a,c.string,c.off);var d=$a(c.start,!0),e=d&&!Fa(metaBook.glosstarget,d)&&e;e&&(K.getInput(a,"FRAG").value=e.id,b&&"number"===typeof c.off&&(c=K.getInput(a,"EXOFF"),e=b.getOffset(e),c.value=
e))}else metaBook.setExcerpt(a,!1)}function u(a,b){a.nodeType&&(a=[a]);for(var c=[],d=0,e=a.length;d<e;)c=c.concat(metaBook.getDups(a[d++]));(ea.selection||ea.glossing)&&V("selectText %o, dups=%o",a,c);return new fdjt.UI.TextSelect(c,{ontap:p,onrelease:b&&b.onrelease,onslip:b&&b.onslip,fortouch:metaBook.touch,holdthresh:150,movethresh:250})}function p(a){a=a||window.event;(ea.selection||ea.glossing||ea.gestures)&&V("gloss_selecting_ontap %o, mode=%o, livegloss=%o",a,metaBook.mode,fdjt.ID("METABOOKLIVEGLOSS"));
"addgloss"!==metaBook.mode?metaBook.setMode("addgloss",!1):metaBook.modechange&&1500>va()-metaBook.modechange||metaBook.setHUD(!1);I.cancel(a)}function f(a){var b=ga("METABOOKLIVEGLOSS");b&&(b.id="");ea.glossing&&V("setGlossForm %o <== %o",a,metaBook.glossform);a?(a.id="METABOOKLIVEGLOSS",metaBook.glossform=a,fdjt.ID("METABOOKGLOSSBODYTEXT").value=K.getInputValue(a,"DETAIL")||"",ma(a,"SYNC").value=metaBook.syncstamp+1,metaBook.share_cloud.complete(),metaBook.gloss_cloud.complete()):metaBook.glossform=
!1}function b(a){a=Y(a,".glossetc");I.Overflow(a)}function e(a,b,c,d){"undefined"===typeof d&&(d=!0);var e=W(a,".metabookglossform");fa(e,"modified");ea.glossing&&V("addOutlet wrapper=%o form=%o outlet=%o formvar=%o checked=%o",e,a,b,c,d);var e=Y(a,".outlets"),f="string"===typeof b?b:b._id;"string"===typeof b?"@"===b[0]||":"===b[0]&&"@"===b[0]?b=metaBook.sourcedb.ref(b):(b={name:b},c||(c="EMAIL")):b.nodeType&&(c||(c="NETWORK"),f=b.getAttribute("data-value"),b={name:b.getAttribute("data-key")||f});
c||(c="SHARE");a=Ba(a,c);for(var h=0,g=a.length;h<g;){if(a[h].value===f)return b=W(a[h],".checkspan"),La(b,d),b;h++}a="span.checkspan.waschecked.ischecked.outlet."+c.toLowerCase();d=I.CheckSpan(a,c||"SHARE",f,d,K.Image(wa("share",32,32),"img.share","\u21a3"),b.nick||b.name,K.Image(wa("redx",32,32),"img.redx","x"));d.title=b.nick&&b.description?b.name+": "+b.description:b.description?b.description:b.name;K(e,d," ");ra(e,"empty");return d}function l(a,c,d,e){var f=Y(a,".links"),h=d?c+" "+d:c,g=metaBook.urlType(c),
k=metaBook.typeIcon(g),k=K.Image(k,"img"),l=K("span.linktext",d||c),h=K.Checkbox("LINKS",h,!0),h=K("span.checkspan.ischecked.waschecked.glosslink",k,h,l);h.title=d||c;h.setAttribute("data-href",c);0===c.search(/https:\/\/glossdata./)&&fa(h,"glossdata");g&&fa(h,metaBook.mediaTypeClass(g));g=W(a,".metabookglossform");ea.glossing&&V("addOutlet wrapper=%o form=%o url=%o title=%o",g,a,c,d);fa(g,"modified");e?K.replace(e,h):K(f,h," ");ra(f,"empty");b(a);return h}function d(a,b,c,d){b=K.getChild(a,"[data-href='"+
b+"']");l(a,c,d,b)}function c(a,c,d){var e=W(a,".metabookglossform"),f=Y(a,".excerpt"),h=!1,g=ma(a,"EXCERPT"),k=ma(a,"EXOFF");if(!c||da.isEmpty(c))g.value&&(h=!0),g.value="",k.value="",g.disabled=k.disabled=!0,f&&(f.innerHTML="");else if(g.disabled=k.disabled=!1,g.value=c,h=!0,"number"===typeof d?k.value=d:(k.value="",k.disabled=!0),f){var g=void 0,l=c.length;g||(g=20);if(l<g)g=c;else{var k=c.split(/\s+/),m=k.length;if(3>k.length)g=c.slice(0,Math.floor(g/2))+"..."+c.slice(Math.floor(l-g/2));else{for(var l=
1,n=k[0].length+1,p=m-2,m=k[m-1].length+1;l<p&&n+m<g;)n+=k[l++].length,m+=k[p--].length;g=k.slice(0,l).join(" ")+"..."+k.slice(p).join(" ")}}f.innerHTML=g;f.title=c}(ea.glossing||ea.selecting)&&V("setExcerpt %o form=%o excerpt=%o off=%o",e,a,c,d);b(a);h&&fa(e,"modified")}function z(a,c,d,e,f){var h=!1;c||(c=a);c.prefix&&(h=c.prefix,c=c.tag);"FORM"!==a.tagName&&(a=W(a,"form")||a);f||(f=metaBook.getMakerKnodule(metaBook.user));"undefined"===typeof e&&(e=!0);var g=W(a,".metabookglossform");ea.glossing&&
V("AddTag %o form=%o tag=%o var=%o checked=%o kno=%o",g,a,c,d,e,f);fa(g,"modified");var g=Y(a,".tags"),k=!1,l="span.term";d||(d="TAGS");c.nodeType&&Aa(c,"completion")&&(Aa(c,"outlet")?(d="SHARED",l="span.outlet"):Aa(c,"source")&&(d="SHARE",l="span.source"),c.title&&(k=c.title),c=metaBook.gloss_cloud.getValue(c));var m=c instanceof Ka?c:"string"===typeof c&&f.handleSubjectEntry(c),n=m?m.toHTML&&m.toHTML()||m.name||m.dterm||m.title||m.norm||"string"===typeof m.EN||m.EN||m.EN instanceof Array||m.EN[0]||
m._qid||m._id:"string"===typeof c?c:c.toString(),p=c;m&&(p=m.knodule===f?m.dterm:m._qid||m.getQID());h&&(p=h+p);m&&m._db===metaBook.sourcedb&&(d="SHARED");f=M(g,".checkspan");h=0;for(m=f.length;h<m;){var q=f[h++];if(q.getAttribute("data-varname")===d&&q.getAttribute("data-tagval")===p)return e&&fa(q,"waschecked"),q}p=I.CheckSpan("span.checkspan",d,p,e);e&&fa(p,"waschecked");k&&(p.title=k);p.setAttribute("data-varname",d);p.setAttribute("data-tagval",c);fa(p,"glosstag");fa(p,d.toLowerCase()+"var");
"string"===typeof n?K.append(p,K(l,n)):K.append(p,n);K.append(p,K.Image(wa("redx",32,32),"img.redx","x"));K.append(g,p," ");ra(g,"empty");b(a);return p}function h(a,b,c,d){if(a&&a.length&&0<b){for(var e=!1,f=b-1,h=!1,g=!1,k=a[f],l=a[f-1];0<=f;){if("\\"!==l)if(/\s/.test(k))e=f;else if("@"===k||"#"===k)break;else if(0===f)return!1;f--;k=l;l=a[f-1]}var k=a[f],m=a[f+1],l=a.length;if(Ca[m]){d=Ca[m];h=m;e=a.slice(f+2).indexOf(d);if(0>e)if(c)l=b,g=d;else return!1;else l=f+2+e;if(l<b)return!1}else{if(d&&
e)return!1;d=a.slice(f).search(Da);0<d&&(l=f+d)}a={text:a.slice(f,l),start:f,end:l,pos:b,prefix:k,content:h&&g?a.slice(f+2,l):h?a.slice(f+2,l-1):a.slice(f+1,l)};h&&(a.delim=h);h&&c&&(a.needs=Ca[h]);return a}return!1}function B(a){var b=I.T(a),c=b.value,d=b.selectionStart,e=h(c,d);(ea.glossing||ea.gestures)&&V("glossinput_onfocus %o text=%o pos=%o taginfo=%o",a,c,d,e);T(a);e&&(Sa&&clearTimeout(Sa),Sa=setTimeout(function(){G(b)},150))}function v(a){var b=I.T(a),c=W(b,"FORM"),d=b.value,e=b.selectionStart||
0,f=a.charCode,g=String.fromCharCode(f),k=h(d,e,!0);(ea.glossing||2<ea.gestures)&&V("glossinput_onkeypress '%o' %o text=%o pos=%o taginfo=%o",f,a,d,e,k);13!==f&&(fa(W(c,".metabookglossform"),"focused"),fa(W(c,".metabookglossform"),"modified"));if(13===f)if(k)b.value=d.slice(0,k.start)+d.slice(k.end),x(b,k.content,a.ctrlKey,"@"===k.prefix),fdjt.UI.cancel(a);else{if(a.shiftKey)return b.value=d.slice(0,e)+"\n"+d.slice(e),b.selectionStart++,I.cancel(a);I.cancel(a);F(c)}else k&&(Da.test(g)?(k=h(d,e,!0))&&
k.needs===g&&(b.value=d.slice(0,k.start)+d.slice(k.end),x(b,k.content,a.ctrlKey,"@"===k.prefix),I.cancel(a)):(Sa&&clearTimeout(Sa),Sa=setTimeout(function(){G(b)},150)))}function H(a){var b=a.keyCode,c=I.T(a);if(27===b)metaBook.cancelGloss(),I.cancel(a);else if(9===b||13===b){var d=W(c,"FORM"),e=c.value,f=h(e,c.selectionStart||0,!0),g="@"===f.prefix?metaBook.share_cloud:metaBook.gloss_cloud;(ea.glossing||2<ea.gestures)&&V("glossinput_onkeydown '%o' %o taginfo=%o cloud=%o",b,a,f,g);f&&(9===b?(d=f.content,
g.complete(d),g.prefix&&g.prefix!==d?(a=f.start+(f.delim?2:1),d=f.end-(f.needs?0:1),0<=g.prefix.search(/\s/)?c.value=e.slice(0,a)+(f.delim?"":'"')+g.prefix+(f.needs?f.needs:"")+e.slice(d):c.value=e.slice(0,a)+g.prefix+e.slice(d),setTimeout(function(){metaBook.UI.updateScroller("METABOOKGLOSSCLOUD")},100)):(a.shiftKey?g.selectPrevious():g.selectNext(),I.cancel(a))):g.selection&&("@"===f.prefix?(b=g.selection.getAttribute("data-value"),metaBook.addOutlet2Form(d,b,"SHARE")):metaBook.addTag2Form(d,g.selection),
c.value=e.slice(0,f.start)+e.slice(f.end),ra("METABOOKHUD",/gloss(tagging|tagoutlet)/g),setTimeout(function(){g.complete("")},10),g.clearSelection(),I.cancel(a)))}else if(8===b||46===b||35<=b&&40>=b)m(a),Sa&&clearTimeout(Sa),Sa=setTimeout(function(){G(c)},150)}function G(a){if(a=h(a.value,a.selectionStart||0,!0)){var b;(b="@"===a.prefix)?pa("METABOOKHUD",/gloss(tagging|tagoutlet)/g,"glosstagoutlet"):pa("METABOOKHUD",/gloss(tagging|tagoutlet)/g,"glosstagging");b=b?metaBook.share_cloud.complete(a.content):
metaBook.gloss_cloud.complete(a.content);ea.glossing&&V("Got %d completions for %s",b.length,a.content)}else ra("METABOOKHUD",/gloss(tagging|addoutlet)/g)}function x(a,b,c,d){a=W(a,"FORM");var f=!1;!d&&c?metaBook.knodule.def(b):0<b.indexOf("|")?d?V.warn("Can't define outlets (sources) from %s",b):metaBook.knodule.def(b):(c=(d?metaBook.share_cloud:metaBook.gloss_cloud).complete(b),0!==c.length&&1===c.length&&(f=c[0]),d&&!f?V.warn("Unknown outlet %s",b):d?e(a,f):f?z(a,f):(f=metaBook.knodule.ref(b))?
z(a,f):z(a,b));ra("METABOOKHUD",/gloss(tagging|addoutlet)/)}function y(a,b){var c=a.getAttribute("data-tagval");if(c){var d=c.indexOf("@");return metaBook.knodule&&0<d&&c.slice(d+1)===metaBook.knodule.name?c.slice(0,d):c}c=b.indexOf("|");return 0<c?b.slice(0,c):b}function D(a,b,c){return function(d){return N(d,a,b,c)}}function N(a,b,c){(ea.network||ea.glossing)&&V("Got AJAX gloss response %o from %o",a,a.responseURL);ea.savegloss&&V("Gloss %o successfully added (status %d) to %o",ma(b,"UUID").value,
a.status,ma(b,"FRAG").value);ra(b.parentNode,"submitting");c?fa(b.parentNode,"submitdone"):fa(b.parentNode,"submitclose");a=JSON.parse(a.responseText);var d=metaBook.glossdb.Import(a,!1,Ua.REFINDEX|Ua.REFSTRINGS|Ua.REFLOAD);a=document.getElementsByName(d._id);for(var e=0,f=a.length;e<f;){var h=a[e++];if(Aa(h,"metabookcard")){var k=metaBook.renderCard(d);k&&K.replace(h,k)}}d.save();metaBook.selecting&&(metaBook.selecting.onclear?metaBook.selecting.onclear.push(function(){metaBook.addGloss2UI(d)}):
metaBook.selecting.onclear=[function(){metaBook.addGloss2UI(d)}]);b&&!c?setTimeout(function(){Aa(b.parentNode,"submitclose")&&(b.parentNode&&b.parentNode&&K.remove(b.parentNode),g(!1),metaBook.setTarget(!1),metaBook.setMode(!1))},1500):b&&setTimeout(function(){ra(b.parentNode,"submitdone")},1500)}function E(a){var b=ma(a,"UUID");b&&(b.value="");if(b=ma(a,"NOTE"))b.value="";if(b=ma(a,"HREF"))b.value="";(a=M(a,".tags"))&&a.length&&(a=M(a[0],".checkspan"),K.remove(K.Array(a)))}function F(a,b){var c=
!1,d=!1;if("undefined"===typeof a){c=ga("METABOOKLIVEGLOSS");if(!c)return;d=Y(c,"FORM")}else a.nodeType||(a=I.T(a)),a.nodeType&&1===a.nodeType&&"FORM"===a.tagName?(d=a,c=W(d,".metabookglossform")):a.nodeType&&1===a.nodeType&&"DIV"===a.tagName&&Aa(a,"metabookglossform")&&(c=a,d=Y(c,"FORM"));if(d){var e=ma(d,"DETAIL"),f=ga("METABOOKGLOSSBODYTEXT");e.value=f.value||"";fa(c,"submitting");Fa(d,".glossedit")||Fa(d,".glossreply")||O(d,Y("METABOOKADDGLOSSPROTOTYPE","FORM"));e=ma(d,"UUID");e&&e.value&&5<e.value.length||
(V.warn("missing UUID"),e&&(e.value=Xa.getUUID(metaBook.nodeid)));e=Ba(d,"NOTE")[0];if(0===e.value.search(Za)){var f=e.value,h=f.search(/\s/);0>h?l(d,f):l(d,f.slice(0,h),f.slice(h+1));e.value=""}ca||navigator.onLine&&metaBook.connected?navigator.onLine&&metaBook.connected&&metaBook.user&&fdjt.Ajax.onsubmit(d,D(d,b))?ra(c,"modified"):P(d,a&&a.type&&a,b):(c=[],navigator.onLine&&c.push({label:"Login",isdefault:!0,handler:function(){setTimeout(function(){metaBook.setMode("login")},0);var a=function(){F(d,
b)};metaBook._onconnect?metaBook._onconnect.push(a):metaBook._onconnect=[a];ca=!0}}),metaBook.user&&metaBook.persist?c.push({label:"Queue",isdefault:!navigator.onLine&&metaBook.cacheglosses,handler:function(){metaBook.nocache&&metaBook.setConfig("cacheglosses",!0);ca=!0;navigator.onLine&&metaBook.connected?F(d,b):P(d,!1,b)}}):(c.push({label:"Cache",isdefault:!navigator.onLine&&metaBook.cacheglosses,handler:function(){metaBook.nocache&&metaBook.setConfig("cacheglosses",!0,!0);ca=!0;P(d,!1,b)}}),metaBook.nocache&&
c.push({label:"Lose",isdefault:!navigator.onLine&&metaBook.nocache,handler:function(){var a=d,b=fdjt.Ajax.formJSON(a,!0),c={refuri:b.refuri,frag:b.frag,maker:b.user,_id:b.uuid,uuid:b.uuid,qid:b.uuid,gloss:b.uuid,created:va()};c.tstamp=va.tick();b.note&&!da.isEmpty(b.note)&&(c.note=b.note);b.excerpt&&!da.isEmpty(b.excerpt)&&(c.excerpt=b.excerpt,c.exoff=b.exoff);b.detail&&!da.isEmpty(b.detail)&&(c.detail=b.detail);b.tags&&0<b.tags.length&&(c.tags=b.tags);b.xrefs&&0<b.xrefs.length&&(c.xrefs=b.xrefs);
metaBook.glossdb.Import(c,!1,!1,!0);E(a);ra(a.parentNode,"submitting");g(!1);metaBook.setTarget(!1);metaBook.setMode(!1);ca=!0}})),c.push({label:"Cancel",handler:function(){K.remove(d.parentNode);g(!1);metaBook.setTarget(!1);metaBook.setMode(!1)}}),I.choose(c,navigator.onLine&&!metaBook.user&&[K("p.smaller","This book isn't currently associated with an sBooks account, ","so any highlights or glosses you add will not be permanently saved ","until you login."),K("p.smaller","You may either login now, cache your changes ",
"on this machine until you do login, ","lose your changes when this page closes, ","or cancel the change you're about to make.")],navigator.onLine&&metaBook.user&&[K("p.smaller","You aren't currently logged into your sBooks account from ","this machine, so any highlights or glosses you add won't ","be saved until you do."),K("p.smaller","In addition, you won't get updated glosses from ","your networks or layers."),K("p.smaller","You may either login now, queue any changes you make until ","you do login, or cancel the change you were trying to make.")],
!navigator.onLine&&metaBook.nocache&&[K("p.smaller","You are currently offline and have elected to not save ","highlights or glosses locally on this computer."),K("p.smaller","You can either queue your changes by storing information locally, ","lose your changes when this page closes,","or cancel the change you were about to make.")]))}}function A(a){a=a||window.event;var b=I.T(a);L(b);I.cancel(a)}function L(a){var b=a||window.event||null,c=a?a.nodeType?a:I.T(a):ga("METABOOKLIVEGLOSS"),c=c&&K.getParent(c,
".metabookglossform");g(!1);metaBook.setMode(!1);a&&(a.cancelable||a.bubbles)&&I.cancel(b);c&&K.remove(c)}function O(a,b){var c,d;pa(b,Ma,a.className);c=ma(a,"POSTGLOSS");d=ma(a,"POSTGLOSS");La(d,c.checked);var f=Ba(a,"NETWORKS");c=0;for(d=f.length;c<d;){var h=f[c++],g=Ta(a,"NETWORKS",h.value);La(g,h.checked)}c=Y(b,".outlets");K.replace(c,K("span.outlets"));c=Y(a,".outlets");f=M(c,"INPUT");c=0;d=f.length;for(h=0;c<d;)if(g=f[c++],g.checked||5>=h){var k=e(b,g.value,g.name,g.checked);g.checked?fa(k,
"waschecked"):h++}}function P(a,b,c){var d=fdjt.Ajax.formJSON(a,!0),e=fdjt.Ajax.formParams(a),f=metaBook.queued;f.push(d.uuid);metaBook.cacheglosses?(Xa.setLocal("metabook.params("+d.uuid+")",e),Xa.setLocal("metabook.queued("+metaBook.refuri+")",f,!0)):hb[d.uuid]=e;e={refuri:d.refuri,frag:d.frag,_id:d.uuid,uuid:d.uuid,maker:d.user||metaBook.user,qid:d.uuid,gloss:d.uuid,created:d.created||va()};e.tstamp=va.tick();d.note&&!da.isEmpty(d.note)&&(e.note=d.note);d.excerpt&&!da.isEmpty(d.excerpt)&&(e.excerpt=
d.excerpt,e.exoff=d.exoff);d.detail&&!da.isEmpty(d.detail)&&(e.detail=d.detail);d.tags&&0<d.tags.length&&(e.tags=d.tags);d.xrefs&&0<d.xrefs.length&&(e.xrefs=d.xrefs);metaBook.glossdb.Import(e,!1,Ua.REFLOAD|Ua.REFSTRINGS|Ua.REFINDEX,!0);b&&I.cancel(b);ra(a.parentNode,"submitting");c||(E(a),g(!1),metaBook.setTarget(!1),metaBook.setMode(!1))}function S(){if(metaBook.queued.length){var a=Y(ga("METABOOKADDGLOSSPROTOTYPE"),"form").getAttribute("ajaxaction"),b=metaBook.queued[0],c=metaBook.nocache?hb[b]:
Xa.getLocal("metabook.params("+b+")");if(c){var d=new XMLHttpRequest;d.open("POST",a);d.withCredentials="yes";d.onreadystatechange=function(){if(4===d.readyState&&200<=d.status&&300>d.status){Xa.dropLocal("metabook.params("+b+")");var a=metaBook.queued;if(a&&a.length){var c=a.indexOf(b);0<=c&&(a.splice(c,1),metaBook.cacheglosses&&Xa.setLocal("metabook.queued("+metaBook.refuri+")",a,!0),metaBook.queued=a)}N(d,!1,!1);a.length&&setTimeout(S,200);Xa.dropLocal("metabook.queued("+metaBook.refuri+")")}else 4===
d.readyState&&metaBook.setConnected(!1)};try{d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(c)}catch(e){metaBook.setConnected(!1)}}}}function t(a){a=a||window.event;var b=I.T(a);if(W(b,".checkspan"))return fdjt.UI.CheckSpan.onclick(a);W(b,".sharing")&&ya(W(b,".sharing"),"expanded")}function Q(a){var b=I.T(a);if(b=W(b,".outlet")||W(b,".source")){var c=ga("METABOOKLIVEGLOSS"),c=c&&Y(c,"form"),b=metaBook.share_cloud.getValue(b);metaBook.addOutlet2Form(c,b);I.cancel(a)}}
function aa(a){a=a||window.event;var b=I.T(a),c=b.alt;if(c){var d=W(b,".addglossmenu"),b=W(b,"form"),e=W(b,"div.metabookglossform");"downmenu"===c?(fa(d,"expanded"),ra(d,"held")):"upmenu"===c?(ra(d,"expanded"),ra(d,"held")):"glossdelete"===c?ja(d,b,!1,!0):"glosscancel"===c?U(d,b,e):"glosspush"===c?(metaBook.submitGloss(b,!1),ra(d,"expanded")):"glossupdate"===c?(metaBook.submitGloss(b,!1),ra(d,"expanded")):"glossrespond"===c?ka(d,b):"glosscancel"===c?U(d,b,e):c===b.className?(metaBook.setGlossMode(!1,
b),ra(d,"expanded")):metaBook.glossmodes.exec(c)?(metaBook.setGlossMode(c,b),ra(d,"expanded")):V.warn("Bad alt=%s in glossmode_tap",c);I.cancel(a)}}function X(a){a=a||window.event;a=I.T(a);if(a.alt){Ea&&(clearTimeout(Ea),Ea=!1);var b=W(a,".addglossmenu");Aa(b,"expanded")?(fa(b,"held"),fa(a,"held")):(fa(b,"expanded"),fa(b,"held"))}}function C(a){a=a||window.event;a=I.T(a);var b=W(a,".addglossmenu"),c=W(a,"form"),d=W(c,"div.metabookglossform"),e=a.alt;ra(a,"held");Aa(a,"menutop")?metaBook.setGlossMode(!1,
c):"glossdelete"===e?ja(b,c):"glosscancel"===e?U(b,c,d):"glosspush"===e?metaBook.submitGloss(c,!1):"glossupdate"===e?metaBook.submitGloss(c,!1):"glossrespond"===e?ka(b,c):metaBook.glossmodes.exec(e)?metaBook.setGlossMode(e,c):V.warn("Bad alt=%s in glossmode_release",e);ra(b,"expanded");ra(b,"held")}function Z(a){a=a||window.event;a=I.T(a);var b=W(a,".addglossmenu");ra(a,"held");Ea||(Ea=setTimeout(function(){ra(b,"expanded")},500))}function ja(a,b,c,d){b||(b=W(a,"FORM"));c||(c=W(b,".metabookglossform"));
var e=K.hasClass(c,"modified");ra(c,"modified");ra(a,"expanded");var f=qa(b,"UUID")[0];(a=metaBook.glossdb.probe(f))&&a.created?d?(w(f),metaBook.setMode(!1),K.remove(c),g(!1),metaBook.setTarget(!1)):fdjt.UI.choose([{label:"Delete",handler:function(){w(f);metaBook.setMode(!1);K.remove(c);g(!1);metaBook.setTarget(!1)},isdefault:!0},{label:"Cancel"}],e?"Delete this gloss?  Discard your changes?":"Delete this gloss?",K("div.smaller","(Created ",va.shortString(a.created),")")):(w(f),metaBook.setMode(!1),
K.remove(c),g(!1),metaBook.setTarget(!1))}function U(a,b,c){b||(b=W(a,"FORM"));c||(c=W(b,".metabookglossform"));metaBook.cancelGloss();metaBook.setMode(!1);K.remove(c);g(!1);metaBook.setTarget(!1)}function ka(a){(a=W(a,".metabookglossform"))&&(a=ma(a,"UUID"))&&(a=metaBook.glossdb.probe(a.value))&&g(a,metaBook.getGlossForm(a,!0))&&metaBook.setMode("addgloss")}function T(a){a=a||window.event;a=I.T(a);var b=(a=(a=W(a,"FORM"))&&W(a,".metabookglossform"))&&Y(a,"TEXTAREA");a&&metaBook.setGlossMode(!1);
b&&metaBook.setFocus(b);metaBook.setHUD(!0);metaBook.freezelayout=!0}function J(a){a=a||window.event;var b=I.T(a),c=W(b,".submitclose");c&&ra(c,"submitclose");var d=(c=(c=W(b,"FORM"))&&W(c,".metabookglossform"))&&Y(c,"TEXTAREA");Aa(c,"focused")?setTimeout(function(){d&&(metaBook.setFocus(d),d.focus())},150):Fa(b,".addglossmenu")||Fa(b,".glossexposure")||(Fa(b,".textbox")||I.cancel(a),fa(c,"focused"),metaBook.setHUD(!0),T(a))}function n(a,b,c){if(a===b){metaBook.glossdb.drop(b);if(a=ga("METABOOKEDITGLOSS_"+
b))a=a.parentNode,a===ga("METABOOKLIVEGLOSS")&&(metaBook.glosstarget=!1,metaBook.setMode(!1)),K.remove(a);var d=K.Array(document.getElementsByName(b));a=0;var e=d.length;if(d)for(;a<e;){var f=d[a++];"METABOOKSKIM"===f.id?K.replace(f,K("div.metabookcard.deletedgloss")):K.remove(f)}c=document.getElementsByName("METABOOK_GLOSSMARK_"+c);c=K.Array(c);a=0;for(e=c.length;a<e;)d=c[a++],f=Ua.remove(d.glosses,b),0===f.length?K.remove(d):d.glosses=f;b=K.$(".mbexcerpt[data-glossid='"+b+"']");b=K.Array(b);a=0;
for(e=b.length;a<e;)I.Highlight.remove(b[a++])}else I.alert(a)}function w(a){var b=metaBook.glossdb.probe(a);if(b&&b.created&&b.maker){var c=b.get("frag");fdjt.Ajax.jsonCall(function(b){n(b,a,c)},"https://"+metaBook.server+"/1/delete","gloss",a)}else b&&b.frag&&n(a,a,b.frag)}function sa(a){a=a||window.event;var b=I.T(a),c=b.value,d=ga("METABOOKLIVEGLOSS");if(d){var d=Y(d,"FORM"),e=metaBook.share_cloud,f=a.keyCode||a.charCode;da.isEmpty(c)&&13===f?e.selection?metaBook.addOutlet2Form(d,e.selection.getAttribute("data-value")):
metaBook.setGlossMode("editnote"):13===f&&e.selection?(metaBook.addOutlet2Form(d,e.selection),e.complete(""),b.value=""):13===f?(f=e.complete(c),f.length?metaBook.addOutlet2Form(d,f[0].getAttribute("data-value")):metaBook.addOutlet2Form(d,c),I.cancel(a),b.value="",e.complete("")):9===f?(e.complete(c),I.cancel(a),e.prefix&&e.prefix!==c?(b.value=e.prefix,K.cancel(a),setTimeout(function(){metaBook.UI.updateScroller("METABOOKGLOSSOUTLETS")},100)):a.shiftKey?e.selectPrevious():e.selectNext()):setTimeout(function(){e.complete(b.value)},
100)}}function R(a){a=a||window.event;var b=I.T(a),c=b.value,d=ga("METABOOKLIVEGLOSS");if(d){var d=Y(d,"FORM"),e=metaBook.gloss_cloud,f=a.keyCode||a.charCode;da.isEmpty(c)&&13===f?(e.selection?metaBook.addTag2Form(d,e.selection):metaBook.setGlossMode(!1),e.clearSelection()):13===f&&e.selection?(metaBook.addTag2Form(d,e.selection),e.complete(""),e.clearSelection(),b.value=""):13===f?(e.complete(c),0<=c.indexOf("|")||0<=c.indexOf("@")?metaBook.addTag2Form(d,c):metaBook.handleTagInput(c,d,!0),I.cancel(a),
b.value="",e.complete("")):9===f?(e.complete(c),I.cancel(a),e.prefix&&e.prefix!==c?(b.value=e.prefix,K.cancel(a),setTimeout(function(){metaBook.UI.updateScroller("METABOOKGLOSSCLOUD")},100)):a.shiftKey?e.selectPrevious():e.selectNext()):setTimeout(function(){e.complete(b.value)},100)}}function ua(a){var b=ga("METABOOKLIVEGLOSS"),b=K.getChild(b,"FORM");K.swapClass(b,ba,a);b=ga("METABOOKATTACHFORM");a=K.getInputFor(b,"ATTACHTYPE",a);fdjt.UI.CheckSpan.set(a,!0)}function ab(a){a=a||window.event;var b=
I.T(a);"FORM"!==b.tagName&&(b=W(b,"form"));var c=ga("METABOOKLIVEGLOSS"),e=K.getInput(b,"URL"),f=K.getInput(b,"TITLE"),h=f.value&&da.stdspace(f.value),g=K.getInput(b,"FILEOKAY"),f=e.value;I.cancel(a);if(c)if(!h&&f&&(a=0<=f.indexOf("/")?f.search(/\/[^\/]+$/):0,h=0>a?f:f.slice(a)),Aa(b,"link"))/https?:[\/][\/](\w+[.])+\w+[\/]/.exec(e.value)?(metaBook.editlink?(d(b,metaBook.editlink,e.value,h),metaBook.editlink=!1):l(b,e.value,h),K.addClass(c,"modified"),metaBook.setGlossMode("editnote"),eb()):I.alert("This URL doesn't look right");
else if(Aa(b,"upload"))if(metaBook.glossattach||metaBook.editlink)if(metaBook.glossattach&&!g.checked)fdjt.UI.choose([{label:"Yes",handler:function(){I.CheckSpan.set(g,!0);bb(h,c)}},{label:"Cancel"}],K("P","By choosing 'Yes,' I affirm that ","I have the right to use and share this ","file according to the sBooks ",K.Anchor("https://www.sbooks.net/legalia/TOS/","A[target='_blank']","Terms of Service"),"."));else if(metaBook.glossattach){var k=metaBook.glossattach.name;xa(metaBook.glossattach,h||metaBook.glossattach.name,
c).then(function(a){metaBook.editlink?(d(c,metaBook.editlink,a.responseURL,h),metaBook.editlink=!1):l(c,a.responseURL,h||k||"attachment");K.addClass("METABOOKLIVEGLOSS","modified");metaBook.setGlossMode("editnote");eb()}).catch(function(a){V("Trouble attaching file %o (%o)",metaBook.glossattach,a)})}else metaBook.editlink?(K.addClass("METABOOKLIVEGLOSS","modified"),d(c,metaBook.editlink,metaBook.editlink,h),eb(),metaBook.editlink=!1):V.warn("Fall through in attach_submit");else I.alert("You need to specify a file!");
else V.warn("Fall through in attach_submit")}function Pa(a){var b=ga("METABOOKLIVEGLOSS");eb();I.cancel(a);b&&metaBook.setGlossMode("editnote")}function Na(a){a=a||window.event;13===(a.keyCode||a.charCode)&&(I.cancel(a),ga("METABOOKLIVEGLOSS")&&(ab(a),metaBook.setGlossMode("editnote")))}function bb(a,b){var c=metaBook.glossattach.name;xa(metaBook.glossattach,a||metaBook.glossattach.name,b).then(function(e){metaBook.editlink?(d(b,metaBook.editlink,e.responseURL,a),metaBook.editlink=!1):l(b,e.responseURL,
a||c||"attachment");metaBook.setGlossMode("editnote");fa(b,"modified");eb()}).catch(function(a){V("Trouble attaching file %o (%o)",metaBook.glossattach,a)})}function Oa(a){var b=ga("METABOOKFILEINPUT"),c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,a.view);b.dispatchEvent(c);I.cancel(a)}function eb(){var a=ga("METABOOKATTACHURL"),b=ga("METABOOKATTACHTITLE"),c=fdjt.ID("METABOOKUPLOADRIGHTS"),d=fdjt.ID("METABOOKFILEINPUT");a.value="";b.value="";K.dropClass("METABOOKGLOSSATTACH",
"haveupload");fdjt.ID("METABOOKATTACHFILE").className="nofile";fdjt.ID("METABOOKATTACHFILENAME").innerHTML="";fdjt.UI.CheckSpan.set(c,!1);metaBook.glossattach=!1;metaBook.editlink=!1;d.value=""}function Wa(b){var c=metaBook.editlink,d=ga("METABOOKLIVEGLOSS"),c=K.getChild(d,"[data-href='"+c+"']");I.cancel(b);c&&(fa(d,"modified"),I.CheckSpan.set(c,!1));eb();a("editnote")}function xa(a,b,c){b=K.getInputValue(c,"UUID");c=Xa.getUUID();var d=a.type,e=new XMLHttpRequest,f="https://glossdata.sbooks.net/"+
b+"/"+c+"/"+a.name,h=!1,g=!1;return new Promise(function(b,c){e.onreadystatechange=function(){h||g||4!==e.readyState||(200===e.status?(metaBook.glossattach=!1,g=!0,b(e)):(g=h=!0,c(e)))};e.ontimeout=function(a){c(a)};e.open("POST",f);e.setRequestHeader("content-type",d);e.withCredentials=!0;e.send(a)})}function Ra(b){var c=I.T(b),d=W(c,".glosslink");if(d){c=d.getAttribute("data-href");d=d.title;metaBook.editlink=c;a("attach");if(0===c.search(/https:\/\/glossdata\./)){var e=/\/([^\/]+)$/.exec(c);ua("upload");
fa("METABOOKGLOSSATTACH","haveupload");fdjt.ID("METABOOKATTACHFILENAME").innerHTML=e[1]}else 0<=c.search(/\/capture\.[A-Za-z0-9]+$/)?ua("capture"):(ua("link"),ga("METABOOKATTACHURL").value=c);fdjt.UI.CheckSpan.set(ga("METABOOKUPLOADRIGHTS"),!0);ga("METABOOKATTACHTITLE").value=d||c;fa(ga("METABOOKATTACHFORM"),"editlink");ga("METABOOKATTACHTITLE").focus();I.cancel(b)}else I.CheckSpan.onclick(b),b=W(c,"form"),ma(b,"NOTE").focus()}function na(a){a=a||window.event;var b=a.dataTransfer.types;b&&(0<=b.indexOf("Files")?
fdjt.UI.cancel(a):0<=b.indexOf("text/uri-list")?fdjt.UI.cancel(a):0<=b.indexOf("text/plain")&&0===a.dataTransfer.getData("text/plain").search(/^\s*https?:\/\//)&&fdjt.UI.cancel(a))}function ha(a){a=a||window.event;var b=fdjt.ID("METABOOKATTACHFORM"),c=a.dataTransfer.types;if(c)if(0<=c.indexOf("Files"))c=a.dataTransfer.files[0],I.cancel(a),metaBook.glossattach=c,ua("uploadfile"),ga("METABOOKATTACHFILENAME").innerHTML=c.name,K.addClass("METABOOKGLOSSATTACH","haveupload"),Aa(b,"editlink")&&fdjt.UI.CheckSpan.set(ga("METABOOKUPLOADRIGHTS"),
!1);else if(0<=c.indexOf("text/uri-list")){if(b=a.dataTransfer.getData("URL")||a.dataTransfer.getData("text/uri-list"))fdjt.UI.cancel(a),metaBook.setGlossMode("attach"),ua("linkurl"),fdjt.ID("METABOOKATTACHURL").value=b,fdjt.ID("METABOOKATTACHTITLE").focus()}else 0<=c.indexOf("text/plain")&&(c=a.dataTransfer.getData("text/plain"),fdjt.UI.cancel(a),0===c.search(/^\s*https?:\/\//)?(metaBook.setGlossMode("attach"),Aa(b,"linkurl")||Aa(b,"copyurl")||ua("linkurl"),fdjt.ID("METABOOKATTACHURL").value=c,fdjt.ID("METABOOKATTACHTITLE").focus()):
(a=fdjt.ID("METABOOKLIVEGLOSS"),a=K.getInput(a,"NOTE"),metaBook.setGlossMode(!1),a.value=c,a.focus()))}function cb(a){if(a=I.T(a).files[0])metaBook.glossattach=a,ga("METABOOKATTACHFILENAME").innerHTML=a.name,K.addClass("METABOOKGLOSSATTACH","haveupload"),Aa("METABOOKATTACHFORM","editlink")&&fdjt.UI.CheckSpan.set(ga("METABOOKUPLOADRIGHTS"),!1)}function za(a){a=a||window.event;metaBook.setGlossMode("editnote");I.cancel(a)}function oa(a,b,c){if(metaBook.glosstarget===a)(ea.gestures||ea.glossing)&&V("startAddGloss/resume %o %o form=%o",
c,a,metaBook.glossform),b&&metaBook.setGlossMode(b,metaBook.glossform),metaBook.setMode("addgloss",!0),c&&I.cancel(c);else{var d=Ha[a.id];Qa(d);var d=g(a,"addgloss"===metaBook.mode&&metaBook.glossform,d),e=Y(d,"form");e&&(c&&I.cancel(c),(ea.gestures||ea.glossing)&&V("startAddGloss (%o) %o f=%o/%o",c,a,d,e),f(d),b&&(e.className=b),metaBook.setMode("addgloss",!1))}}function Va(){var a=K("div.message","Save gloss?");Ia=!0;return Ia=I.choose({choices:[{label:"Save",handler:function(){metaBook.submitGloss();
Ia=!1},isdefault:!0},{label:"Discard",handler:function(){metaBook.cancelGloss();Ia=!1}}],timeout:metaBook.save_gloss_timeout||metaBook.choice_timeout||7,spec:"div.fdjtdialog.fdjtconfirm.savegloss"},a)}function Qa(a){for(var b=0,c=Ha.length;b<c;){var d=Ha[b++];d!==a&&d.clear()}Ha=[];metaBook.select_target=!1}var da=fdjt.String,Xa=fdjt.State,va=fdjt.Time,V=fdjt.Log,K=fdjt.DOM,I=fdjt.UI,Ua=fdjt.RefDB,Ka=fdjt.Ref,ga=fdjt.ID,Ga=metaBook.ID,ea=metaBook.Trace,fa=K.addClass,Aa=K.hasClass,ra=K.dropClass,ya=
K.toggleClass,pa=K.swapClass,W=K.getParent,Fa=K.hasParent,M=K.getChildren,Y=K.getChild,ma=K.getInput,Ba=K.getInputs,Ta=K.getInputFor,Ya=K.getInputsFor,qa=K.getInputValues,Ja=I.cancel,La=I.CheckSpan.set,Ma=metaBook.glossmodes,wa=metaBook.icon,$a=metaBook.getTarget,ia=metaBook.getGlossTags,Za=/(http:)|(https:)|(ftp:)|(urn:)/,Ia=!1,Ha=[];metaBook.getGlossMode=function(a){a||(a=ga("METABOOKLIVEGLOSS"));"string"===typeof a&&(a=ga(a));if(!a||!a.nodeType)return!1;"FORM"!==a.tagName&&(a=Y(a,"FORM"));return(a=
Ma.exec(a.className))&&0!==a.length&&a[0]?a[0]:!1};metaBook.setGlossMode=a;metaBook.getGlossForm=r;metaBook.setGlossTarget=g;metaBook.setSelecting=k;metaBook.UI.selectText=u;metaBook.setGlossForm=f;metaBook.addOutlet2Form=e;metaBook.setExcerpt=c;metaBook.addTag2Form=z;metaBook.setGlossNetwork=function(a,b,c){"string"===typeof a&&(a=ga(a));a&&(a=ma(a,"NETWORKS",b))&&(a=W(a,".checkspan"))&&La(a,c)};var Ca={'"':'"',"'":"'","/":"/","<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"},Da=/["'\/\[(<{}>)\]\u00ab\u00bb]/g,
Sa=!1;metaBook.findTag=h;var fb=da.stdspace;metaBook.handleTagInput=function(a,b,c){var d="@"===a[0],f=d?metaBook.share_cloud:metaBook.gloss_cloud,h="@"===a[0]||"#"===a[0]?a.slice(1):a;a=f.complete(h);h=fb(h);if(d){for(var g=[],k=0,l=a.length;k<l;){var m=a[k++];Aa(m,"outlet")&&g.push(m)}a=g}if(a&&0!==a.length){d=!1;if(1===a.length)d=a[0];else if(a.exact&&1===a.exact.length)d=a.exact[0];else for(d=a[0],f=0,g=a.length;f<g;)if(a[f++]!==d){d=!1;break}if(d&&d===a[0]&&(a=metaBook.gloss_cloud.getKey(a.matches[0]),
c?a.toLowerCase()!==h.toLowerCase():0!==a.toLowerCase().search()))return z(b,h),metaBook.gloss_cloud.complete(""),h;if(d)return b=z(b,d),metaBook.gloss_cloud.complete(""),y(b,metaBook.gloss_cloud.getKey(d));z(b,h);metaBook.gloss_cloud.complete("");return h}d?e(b,h):z(b,h);f.complete("");return h};metaBook.UI.handlers.glosscloud_select=function(a){var b=I.T(a);if(b=W(b,".completion")){var c=ga("METABOOKLIVEGLOSS"),c=c&&Y(c,"form"),d=z(c,b);!Aa("METABOOKHUD","glossaddtag")&&(d=y(d,metaBook.gloss_cloud.getKey(b)),
(b=ma(c,"NOTE"))&&d&&(d=void 0,c=b.value,d||(d=b.selectionStart),d=h(c,d)))&&(b.value=c.slice(0,d.start)+c.slice(d.end))}I.cancel(a)};metaBook.UI.sharecloud_ontap=function(a){var b=I.T(a);if(b=W(b,".completion")){var c=ga("METABOOKLIVEGLOSS"),c=c&&Y(c,"form"),d=b.getAttribute("data-value");Aa(b,"source")?d&&e(c,metaBook.sourcedb.ref(d),"SHARE"):Aa(b,"network")?e(c,b,"NETWORK"):Aa(b,"email")&&(d?e(c,b,"EMAIL"):e(c,b))}I.cancel(a)};var ca=!1;metaBook.submitGloss=F;metaBook.cancelGloss=L;var hb={};metaBook.writeQueuedGlosses=
S;metaBook.UI.glossform_outlets_tapped=t;var Ea=!1;metaBook.UI.changeGlossNetwork=function(a){a=a||window.event;a=I.T(a);var b=ga(K.hasParent(a,".metabookglossform")?"METABOOKNETWORKBUTTONS":"METABOOKLIVEGLOSS"),b=Ya(b,"NETWORK",a.value);I.CheckSpan.set(b,a.checked)};metaBook.UI.changeGlossPosting=function(a){a=I.T(a||window.event);var b=W(a,".metabookglossform");a.checked?K.addClass(b,"posted"):K.dropClass(b,"posted")};metaBook.UI.changeGlossPrivacy=function(a){a=a||window.event;a=I.T(a||window.event);
var b=W(a,".metabookglossform"),c=Y(b,".postgloss"),d=c&&ma(c,"POSTGLOSS");c&&(a.checked?d&&(d.disabled=!0):d&&(d.disabled=!1));a.checked?K.addClass(b,"private"):K.dropClass(b,"private")};metaBook.UI.glossFormFocus=T;metaBook.UI.glossform_touch=J;metaBook.UI.glossform_focus=T;metaBook.UI.glossform_blur=function(a){a=a||window.event;a=I.T(a);var b=(a=(a=W(a,"FORM"))&&W(a,".metabookglossform"))&&Y(a,"TEXTAREA");a&&ra(a,"focused");b&&metaBook.clearFocus(b);metaBook.setHUD(!1,!1);va();metaBook.freezelayout=
!1};var ba=/\b(link|upload|body|capture)\b/g;metaBook.UI.changeAttachment=function(a){a=a||window.event;a=I.T(a);var b=W(a,"form"),c=a.value;a.checked?K.swapClass(b,ba,c):ra(b,a.value)};metaBook.setAttachType=ua;metaBook.startGloss=function(a){var b=metaBook.UI.selectText(a);metaBook.TapHold.page&&metaBook.TapHold.page.abort&&metaBook.TapHold.page.abort();metaBook.TapHold.content&&metaBook.TapHold.page.content&&metaBook.TapHold.content.abort();metaBook.select_target=a;Ha.push(b);Ha[a.id]=b;I.TapHold.clear();
oa(a,!1,!1)};metaBook.startAddGloss=oa;metaBook.saveGlossDialog=Va;metaBook.startSelect=function(a,b){var c=metaBook.UI.selectText(a);metaBook.TapHold.page&&metaBook.TapHold.page.abort&&metaBook.TapHold.page.abort();metaBook.TapHold.content&&metaBook.TapHold.page.content&&metaBook.TapHold.content.abort();metaBook.select_target=a;Ha.push(c);Ha[a.id]=c;I.TapHold.clear();(ea.gestures||ea.selecting)&&V("body_held/select_wait %o %o %o",c,a,b);setTimeout(function(){(ea.gestures||ea.selecting)&&V("body_held/select_start %o %o %o",
c,a,b);c.startEvent(b,250)},0)};metaBook.abortSelect=Qa;metaBook.getTextSelectors=function(){return Ha};metaBook.closeGlossForm=function(a,b){a||(a=metaBook.glossform);a&&!Ia&&(Aa(a,"modified")?Aa(a,"glossadd")?Va():metaBook.submitGloss(a):metaBook.cancelGloss(),b&&I.cancel(b))};fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{".metabookglossform":{click:J,touchstart:J},glossbutton:{mouseup:function(a){a=a||window.event;var b=I.T(a),b=$a(b);"addgloss"===metaBook.mode&&metaBook.glosstarget===b?(I.cancel(a),
metaBook.setMode(!0)):b&&(I.cancel(a),a=g(b))&&(metaBook.setMode("addgloss"),f(a))},mousedown:Ja},"span.metabooksharegloss":{tap:fdjt.UI.CheckSpan.onclick},".metabookglossform .response":{click:metaBook.toggleHUD},".addglossmenu":{tap:aa,hold:X,slip:Z,release:C,click:Ja},"div.glossetc":{click:Ra},"div.glossetc div.sharing":{click:t},"div.glossetc div.notetext":{click:za},"#METABOOKADDGLOSS":{dragenter:na,dragover:na,drop:ha},"#METABOOKATTACHFILE":{click:Oa},"#METABOOKGLOSSATTACH":{dragenter:na,dragover:na,
drop:ha},"#METABOOKADDTAGINPUT":{keydown:R},"#METABOOKADDSHAREINPUT":{keydown:sa},"#METABOOKATTACHFORM":{submit:ab},"#METABOOKATTACHURL":{keydown:Na},"#METABOOKATTACHTITLE":{keydown:Na},"#METABOOKATTACHCANCEL":{click:Pa},"#METABOOKATTACHDELETE":{click:Wa},"#METABOOKFILEINPUT":{change:cb},"#METABOOKGLOSSCLOUD":{tap:metaBook.UI.handlers.glosscloud_select,release:metaBook.UI.handlers.glosscloud_select},"#METABOOKSHARECLOUD":{tap:Q,release:Q}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{".metabookglossform .response":{click:metaBook.toggleHUD},
".addglossmenu":{tap:aa,hold:X,slip:Z,release:C,click:Ja},"div.glossetc":{touchstart:Ra,touchend:Ja},"div.glossetc div.sharing":{touchend:t,click:Ja},"div.glossetc div.notetext":{touchend:za,click:Ja},"#METABOOKADDTAGINPUT":{keydown:R},"#METABOOKADDSHAREINPUT":{keydown:sa},"#METABOOKATTACHFORM":{submit:ab},"#METABOOKATTACHURL":{keydown:Na},"#METABOOKATTACHTITLE":{keydown:Na},"#METABOOKATTACHFILE":{click:Oa},"#METABOOKATTACHCANCEL":{click:Pa},"#METABOOKATTACHDELETE":{click:Wa},"#METABOOKADDGLOSS":{dragenter:na,
dragover:na,drop:ha},"#METABOOKFILEINPUT":{change:cb},"#METABOOKGLOSSCLOUD":{tap:metaBook.UI.handlers.glosscloud_select,release:metaBook.UI.handlers.glosscloud_select},"#METABOOKSHARECLOUD":{tap:Q,release:Q}})})();(function(){function a(a,b){if(!0===a)return qa;a?qa||setTimeout(function(){qa=!1;a()},b||400):qa&&(clearTimeout(qa),qa=!1)}function r(a,b){if(!0===a)return Ja;a?Ja||setTimeout(function(){Ja=!1;a()},b||500):Ja&&(clearTimeout(Ja),Ja=!1)}function g(a,b){K.addListeners(a,metaBook.UI.handlers[metaBook.ui][b])}function m(a){var b=I.T(a);return(b=ya(b,"A"))&&b.href?"#"===b.href[0]?!1:"#"===b.getAttribute("href")[0]?!1:!0:W(a)}function k(a){a=a||window.event;var b=I.T(a),c=a.clientX,d=a.clientY,e=va(),f=
!1;da.gestures&&V("body_tapped %o c=%d,%d now=%o p=%o",a,c,d,e,metaBook.previewing);if(metaBook.previewing)return b=ra(b),metaBook.stopPreview("body_tapped/stop_preview",b||!0),I.TapHold.clear(),fdjt.UI.cancel(a),!1;if(pa(b,".glossmark"))return ca(a),!1;if(metaBook.touch&&metaBook.textinput)metaBook.clearFocus(metaBook.textinput),ca(a);else if(ea(document.body,"mbSHOWHELP"))fa(document.body,"mbSHOWHELP"),ca(a);else{metaBook.glosstarget&&(e=metaBook.glossform,pa(b,metaBook.glosstarget)?metaBook.setMode("addgloss",
!1):metaBook.closeGlossForm(e));if(metaBook.hudup||metaBook.mode)return metaBook.setMode(!1),metaBook.setHUD(!1),Ka("METABOOKOPENGLOSSMARK")&&(metaBook.target&&metaBook.clearHighlights(metaBook.target),Ka("METABOOKOPENGLOSSMARK").id=""),I.cancel(a),Ma=va(),!1;if(pa(b,".glossmark")||u(b))return I.cancel(a),!1;Ka("METABOOKOPENGLOSSMARK")?(Ka("METABOOKOPENGLOSSMARK").id="",metaBook.target&&metaBook.clearHighlights(metaBook.target)):(a.changedTouches&&a.changedTouches.length&&(f=a.changedTouches[0],c=
f.clientX,d=f.clientY),da.gestures&&V("body_tapped/fallthrough (%o) %o, m=%o, @%o,%o, vw=%o",a,b,metaBook.mode,c,d,K.viewWidth()),metaBook.fullheight&&!metaBook.hudup&&(50>d||d>K.viewHeight()-50)?metaBook.setHUD(!0):c<K.viewWidth()/3?metaBook.Backward(a):metaBook.Forward(a));I.cancel(a)}}function q(a){var b=ga(a);if(b)return b;a=document.getElementsByName(a);if(0===a.length)return!1;if(1===a.length)return a[0];for(var c=b=0,d=a.length,e=metaBook.page;c<d;){var f=a[c++];if(ea(f,"metabookdupstart"))return f;
b||pa(f,e)&&(b=4)}return b?b:a[0]}function u(a){if(Ma&&1E3>va()-Ma)return!0;var b=ya(a,"A"),c,d=!1;if(b&&b.href&&(c=b.getAttribute("href"))){da.gestures&&V("ctouch: follow link %s",c);a=b.rel;var e=b.className;if("#"===c[0]&&(a&&0<=a.search(/\b((sbooknote)|(footnote)|(endnote)|(note))\b/)||e&&0<=e.search(/\b((sbooknote)|(sbooknoteref))\b/)||metaBook.sbooknoterefs&&metaBook.sbooknoterefs.match(b))){a:{e=c.slice(1);a=ga(e);b=fdjt.ID("METABOOKBODY");d=document.body;if(!a){var f=document.getElementsByName(e);
if(!b){b=!1;break a}if(f.length)for(e=0,f=f.length;e<f;)if(pa(a[e],b)){a=a[e];break}else e++}if(a){for(var e=a,f=K.getStyle(a),h=!1,g=metaBook.sbooknotes;e&&e!==b&&e!==d;){if(g&&g.match(e)){b=e;break a}h||"block"===f.display&&(h=e);e=e.parentNode;f=K.getStyle(e)}b=h?h:a}else b=void 0}a=b.id;metaBook.DOM.noteshud.innerHTML="";b=b.cloneNode(!0);K.stripIDs(b);fa(b,/\bmetabook\S+/g);Ga(b,"metabooknotebody");metaBook.DOM.noteshud.setAttribute("data-note",a||c.slice(1));K.append(metaBook.DOM.noteshud,b);
metaBook.setMode("shownote");Ma=va();return!0}if("#"===c[0]&&a&&0<=a.search(/\b((sidebar)|(breakout)|(tangent))\b/))return c=fdjt.ID(c.slice(1)),K.removeChildren(metaBook.DOM.asidehud),K.append(metaBook.DOM.asidehud,c.cloneNode(!0)),metaBook.setMode("showaside"),Ma=va(),!0;if("#"===c[0]&&metaBook.xtargets[c.slice(1)])return c=metaBook.xtargets[c.slice(1)],Ma=va(),c(),!0;if("#"===c[0]&&(d=q(c.slice(1))))return metaBook.JumpTo(d),Ma=va(),!0;b.target||(b.target="_blank");Ma=va();return!1}if(c=ya(a,"details,.html5details,.sbookdetails"))return K.removeChildren(metaBook.DOM.notehud),
metaBook.DOM.notehud.innerHTML=c.innerHTML,metaBook.setMode("showdetails"),Ma=va(),!0;if(c=ya(a,"aside,.html5aside,.sbookaside"))return K.removeChildren(metaBook.DOM.asidehud),metaBook.DOM.asidehud.innerHTML=c.innerHTML,metaBook.setMode("showaside"),Ma=va(),!0;if(c=ya(a,"[data-glossid]")){c=c.getAttribute("data-glossid");b=metaBook.glossdb.ref(c);if(!b)return!1;c=K("div.metabookglosses.metabookslice");b=new wa(c,[b]);c=K("div.hudpanel#METABOOKPOINTGLOSSES",c);K.replace("METABOOKPOINTGLOSSES",c);metaBook.setTarget(a);
b.update();metaBook.setMode("openglossmark");return!0}return!1}function p(a){a=a||window.event;var b=fdjt.UI.T(a);ya(b,"A[href]")||(fdjt.UI.cancel(a),a=metaBook.DOM.noteshud,(b=a.getAttribute("data-note"))?(a.removeAttribute("data-note"),a.innerHTML="",metaBook.setMode(!1),metaBook.GoTo(b,"jumpToNote",!0,!0)):metaBook.setMode(!1))}function f(a){a=a||window.event;var b=I.T(a),c=ra(b);da.gestures&&V("body_held %o p=%o p.p=%o bc=%s hc=%s",a,c,c&&c.parentNode,document.body.className,metaBook.HUD.className);
if(!metaBook.previewing){if(pa(b,"A")){var d=(b=ya(b,"A"))&&b.getAttribute("href");I.cancel(a);if(d&&"#"===d[0]&&ga(d.slice(1))){da.gestures&&V("anchor_preview/body_held %o %o %o",a,b,d);metaBook.startPreview(d.slice(1),"content/anchor_held");return}}c&&(metaBook.glosstarget===c?"addgloss"!==metaBook.mode&&metaBook.setMode("addgloss",!1):metaBook.hudup?(I.cancel(a),metaBook.setHUD(!1)):(metaBook.startSelect(c,a),metaBook.startAddGloss(c,!1,a)))}}function b(a){var b=I.T(a),c=ra(b);da.gestures&&V("body_taptap %o p=%o p.p=%o bc=%s hc=%s t=%o gt=%o",
a,c,c&&c.parentNode,document.body.className,metaBook.HUD.className,b,metaBook.glosstarget);if(pa(b,"IMG,AUDIO,VIDEO,OBJECT"))metaBook.startZoom(ya(b,"IMG,AUDIO,VIDEO,OBJECT")),fdjt.UI.cancel(a);else if(metaBook.glosstarget&&(pa(b,metaBook.glosstarget)?metaBook.setMode("addgloss",!1):metaBook.closeGlossForm()),c)if(metaBook.glosstarget===c)"addgloss"!==metaBook.mode&&metaBook.setMode("addgloss",!1);else if(b=[{label:"Add Gloss",handler:function(){metaBook.startGloss(c)},isdefault:!0}],b.push({label:"Zoom content",
handler:function(){metaBook.startZoom(c);fdjt.UI.cancel(a)}}),e(c,b),1===b.length)I.cancel(a),metaBook.startGloss(c);else{I.cancel(a);b.push({label:"Cancel",handler:function(){metaBook.cancelGloss()}});for(var d=0,f=0,h=b.length;f<h;){var g=b[f++].label.length;g>d&&(d=g)}I.choose({choices:b,spec:"div.fdjtdialog.metabooktaptap",style:"width: "+.8*d+"em"})}}function e(a,b){for(var c=a;c;){var d=a.getAttribute("data-xref");if(d){var e=d.indexOf(" "),f=0<e?d.slice(e+1):d,d=0<e?d.slice(0,e):d,d=d.replace("{{ID}}",
a.id),f={label:f,handler:l(d)};b.push(f)}c=c.parentNode}}function l(a){return function(){window.open(a)}}function d(a){a=a||window.event;metaBook.zoomed||"METABOOKBODY"===I.T(a).id&&($a=va())}function c(a){a=a||window.event;if(!metaBook.zoomed&&"METABOOKBODY"===I.T(a).id&&$a){metaBook.TapHold.body&&metaBook.TapHold.body.abort();I.cancel(a);var b=a.clientX||a.changedTouches&&a.changedTouches.length&&a.changedTouches[0].clientX,c=K.viewWidth();b>c/2?O(a):P(a)}}function z(a){a=a||window.event;if(!metaBook.zoomed){var b=
I.T(a),c=!1;da.gestures&&V("body_released %o",a);if(metaBook.previewing)metaBook.stopPreview("body_released"),I.cancel(a);else if(pa(b,"A"))I.cancel(a);else{c=pa(b,".fdjtselecting")&&ra(b);if(!c){c=M(b,".fdjtselected");if(0===c.length){metaBook.abortSelect();return}b=c[0];c=ra(b)}da.gestures&&V("body_released %o p=%o gt=%o gf=%o",a,c,metaBook.glosstarget,metaBook.glossform);metaBook.glosstarget===c?(metaBook.glossform&&(metaBook.glossform.id="METABOOKLIVEGLOSS"),"addgloss"!==metaBook.mode&&metaBook.setMode("addgloss")):
metaBook.startAddGloss(c,a.shiftKey&&"addtag",a)}}}function h(a){for(var b=document.body;a&&a!==b&&1===a.nodeType;){if(a.name&&0===a.name.search("SBR")||a.getAttribute("name")&&0===a.getAttribute("name").search("SBR"))return a;a=a.parentNode}return!1}function B(a,b){for(var c=M(a,".metabooktitle"),d=0,e=c.length;d<e;){var f=c[d++];if(f.name===b)return f}return!1}function v(a){a=a||window.event;var b=I.T(a);if(metaBook.previewing)metaBook.stopPreview("toc_tapped"),I.cancel(a);else if(b=h(b)){var c=
(b.name||b.getAttribute("name")).slice(3),d=metaBook.docinfo[c].elt||ga(c);d.id!==c&&(d=ga(c));da.gestures&&V("toc_tapped %o about=%o ref=%s target=%o",a,b,c,d);metaBook.JumpTo(d);I.cancel(a)}else da.gestures&&V("toc_tapped %o noabout",a)}function H(b){b=b||window.event;var c=I.T(b),d=h(c);a(!1);r(!1);if(d){var e=d.name||d.getAttribute("name"),c=e.slice(3),f=ya(d,".metabooktoc"),e=B(f,e);da.gestures&&V("toc_held %o about=%o ref=%s toc=%o title=%s",b,d,c,f,e);Ga(e,"metabookpreviewtitle");Ga(d.parentNode,
"metabookheld");d=ya(d,".spanbar")||Fa(f,".spanbar");Ga(d,"metabookvisible");Ga(f,"metabookheld");metaBook.startPreview(ga(c),"toc_held");return I.cancel(b)}da.gestures&&V("toc_held %o noabout",b)}function G(b){b=b||window.event;var c=h(I.T(b));a(!1);if(c){var d=c.name||c.getAttribute("name"),e=d.slice(3),f=ya(c,".metabooktoc"),d=B(f,d);da.gestures&&V("toc_released %o ref=%o about=%o toc=%o title=%s",b,e,c,f,d);fa(d,"metabookpreviewtitle");fa(c.parentNode,"metabookheld");c=ya(c,".spanbar")||Fa(f,
".spanbar");fa(c,"metabookvisible");fa(f,"metabookheld");metaBook.previewing&&metaBook.stopPreview("toc_released")}else da.gestures&&V("toc_released %o noabout",b),metaBook.stopPreview("toc_released");I.cancel(b)}function x(a){a=a||window.event;Ja||r(function(){Ja=!1;da.gestures&&V("toc_slipped/timeout %o",a);metaBook.stopPreview("toc_slipped")})}function y(a){a=a||window.event||null;var b=a.keyCode,c=I.T(a);if(27===a.keyCode)metaBook.previewing&&(metaBook.stopPreview("escape_key"),I.TapHold.clear()),
fa(document.body,"mbZOOM"),fa(document.body,"mbMEDIA"),"addgloss"===metaBook.mode&&metaBook.cancelGloss(),metaBook.mode&&(metaBook.last_mode=metaBook.mode,metaBook.setMode(!1),metaBook.setTarget(!1),Ka("METABOOKSEARCHINPUT").blur());else if("TEXTAREA"!==c.tagName&&"INPUT"!==c.tagName&&"BUTTON"!==c.tagName&&!ea(document.body,"mbZOOM")){if(metaBook.controlc&&a.ctrlKey&&(99===b||67===b))metaBook.previewing&&metaBook.stopPreview("onkeydown",!0),I.TapHold.clear(),metaBook.setMode("console"),fdjt.UI.cancel(a);
else{if(a.altKey||a.ctrlKey||a.metaKey)return!0;if(metaBook.previewing)return metaBook.stopPreview("onkeydown",!0),I.TapHold.clear(),metaBook.setHUD(!1),fdjt.UI.cancel(a),!1;if(ea(document.body,"mbCOVER"))return metaBook.clearStateDialog(),metaBook.hideCover(),fdjt.UI.cancel(a),!1;if(metaBook.glossform){c=fdjt.DOM.getInput(metaBook.glossform,"NOTE");metaBook.UI.glossFormFocus(metaBook.glossform);metaBook.setFocus(c);c.focus();var d=document.createEvent("UIEvent");d.initUIEvent("keydown",!0,!0,window);
d.keyCode=b;c.dispatchEvent(d);I.cancel(a);return}if(34===b)metaBook.pageForward(a);else if(33===b)metaBook.pageBackward(a);else if(40===b)metaBook.setHUD(!1),metaBook.pageForward(a);else if(38===b)metaBook.setHUD(!1),metaBook.pageBackward(a);else if(37===b)metaBook.skimBackward(a);else if(39===b)metaBook.skimForward(a);else{if(K.isTextInput(K.T(a)))return!0;if(32===b)metaBook.Forward(a);else if(8===b||45===b)metaBook.Backward(a);else if(36===b)metaBook.JumpTo(metaBook.head);else if("addgloss"===
metaBook.mode){if(metaBook.getGlossMode())return;c=(c=Ka("METABOOKLIVEGLOSS"))&&Fa(c,"FORM");if(!c)return;13===b?Ta(c):35===b||91===b?metaBook.setGlossMode("addtag",c):32===b?metaBook.setGlossMode("editnote",c):47===b||58===b?metaBook.setGlossMode("attach",c):64===b&&metaBook.setGlossMode("addoutlet",c)}else return}}I.cancel(a)}}function D(a){a=a||window.event||null;if(K.isTextInput(K.T(a))||a.ctrlKey||a.altKey||a.metaKey)return!0}function N(a){var b=!1;a=a||window.event||null;b=a.charCode||a.keyCode;
if(K.isTextInput(K.T(a))||a.altKey||a.ctrlKey||a.metaKey)return!0;if(72===b||104===b)return metaBook.clearStateDialog(),metaBook.hideCover(),K.toggleClass(document.body,"metabookhelp"),!1;if(67===b||99===b)return metaBook.clearStateDialog(),metaBook.toggleCover(),!1;b=ia[b];"openheart"===b&&(b=metaBook.last_heartmode||"about");var c=metaBook.setMode();b&&(c===b?(metaBook.setMode(!1),c=!1):(metaBook.setMode(b),c=b));"searching"===c?metaBook.setFocus(Ka("METABOOKSEARCHINPUT")):metaBook.clearFocus(Ka("METABOOKSEARCHINPUT"));
K.cancel(a)}function E(a){a=a||window.event;var b=I.T(a),c=b.getAttribute("hudmode");da.gestures&&V("hudmodebutton() %o mode=%o cl=%o skim=%o sbh=%o mode=%o",a,c,W(b),metaBook.skimming,metaBook.hudup,metaBook.setMode());metaBook.clearStateDialog();Ya.live&&Ya.flash();I.cancel(a);if(c)if("click"===a.type||"tap"===a.type||"release"===a.type){fa(document.body,"_HOLDING");if(metaBook.skimming&&!metaBook.hudup){if("refinesearch"===c||"searchresults"===c){metaBook.setMode("searchresults");return}if("allglosses"===
c){metaBook.setMode("allglosses");return}}K.hasClass(metaBook.HUD,c)?metaBook.setMode(!1,!0):"search"===c&&K.hasClass(metaBook.HUD,metaBook.searchModes)?metaBook.setMode(!1,!0):metaBook.setMode(c)}else"tap"===a.type?metaBook.setHUD(!0):"hold"===a.type?Ga(document.body,"_HOLDING"):fa(document.body,"_HOLDING")}function F(a){a=a||window.event||null;La&&La&&(clearTimeout(La),La=!1,da.gestures&&V("clear_hold from %s","glossmark_tapped"));if(!(a.ctrlKey||a.altKey||a.metaKey||a.shiftKey)){var b=I.T(a),c=
ya(b,".glossmark"),d=c.name&&0===c.name.search("GLOSSMARK_NAME_")&&fdjt.ID(c.name.slice(15))||ra(c.parentNode,!0);d&&d.getAttribute("data-baseid")&&(d=ga(d.getAttribute("data-baseid")));da.gestures&&V("glossmark_tapped (%o) on %o gmark=%o passage=%o mode=%o target=%o",a,b,c,d,metaBook.mode,metaBook.target);if(!c)return!1;I.cancel(a);"openglossmark"===metaBook.mode&&metaBook.target===d?(metaBook.setMode(!1),metaBook.clearGlossmark()):metaBook.select_target||metaBook.showGlossmark(d,c)}}function A(a,
b){if(a&&b){var c=ea(a,"glossmark")?a:ya(a,".glossmark");if(c&&Za!==c){Ia&&(clearInterval(Ia),Ia=Za=!1,Ha&&I.ImageSwap.reset(Ha));var d=Fa(c,"img.wedge");d&&(Za=c,Ha=d,Ia=I.ImageSwap(d,750))}}else Ia&&(clearInterval(Ia),Ia=Za=!1,Ha&&I.ImageSwap.reset(Ha),Ha=!1)}function L(a){metaBook.previewing&&I.noDefault(a)}function O(a){a=a||window.event;fa(document.body,/\bmb(PAGE)?PREVIEW/g);var b=va();Ca&&100>b-Ca||(Ca=b,fa(document.body,/\bmb(PAGE)?PREVIEW/g),metaBook.readsound&&K.playAudio("METABOOKPAGEORWARDAUDIO"),
(da.gestures||da.flips)&&V("pageForward (on %o) c=%o n=%o",a,metaBook.curpage,metaBook.pagecount),metaBook.bypage&&"number"===typeof metaBook.curpage?metaBook.curpage>=(metaBook.bypage&&(metaBook.pagecount||metaBook.layout.pagenum-1))||metaBook.GoToPage(metaBook.curpage+1,"pageForward",!0,!1):(a=K.viewHeight()-50,0>a&&(a=K.viewHeight()),a=K.viewTop()+a,window.scrollTo(K.viewLeft(),a)))}function P(a){var b=va();fa(document.body,/\bmb(PAGE)?PREVIEW/g);Ca&&100>b-Ca||(Ca=b,a=a||window.event,metaBook.readsound&&
K.playAudio("METABOOKPAGEBACKWARDAUDIO"),(da.gestures||da.flips)&&V("pageBackward (on %o) c=%o n=%o",a,metaBook.curpage,metaBook.pagecount),metaBook.bypage&&"number"===typeof metaBook.curpage?(a=!1,0!==metaBook.curpage&&(a=metaBook.curpage-1,metaBook.GoToPage(a,"pageBackward",!0,!1))):(a=K.viewHeight()-50,0>a&&(a=K.viewHeight()),a=K.viewTop()-a,window.scrollTo(K.viewLeft(),a)))}function S(a){var b=va();fa(document.body,/\bmb(PAGE)?PREVIEW/g);if(!(Ca&&100>b-Ca)){Ca=b;a=a||window.event;metaBook.uisound&&
K.playAudio("METABOOKSKIMFORWARDAUDIO");if(!ea(document.body,"mbSKIMMING")){if("openglossmark"===metaBook.mode){a=metaBook.docinfo._ids;var c=metaBook.target&&metaBook.target.id,b=metaBook.glossdb,d,e=a.length;if(c&&0<(d=Ua.position(a,c)))for(d++;d<e;){if((c=b.find("frag",a[d]))&&c.length){d=ga(a[d]);a=Fa(d,".glossmark");metaBook.GoTo(d,"skimForward/glosses",!0);metaBook.showGlossmark(d,a);return}d++}metaBook.setMode(!1);return}if(!metaBook.skimming)return}metaBook.uisound&&K.playAudio("METABOOKSKIMFORWARDAUDIO");
Ga("METABOOKSKIMMER","flash");Ga("METABOOKNEXTSKIM","flash");setTimeout(function(){fa("METABOOKSKIMMER","flash");fa("METABOOKNEXTSKIM","flash")},200);if("statictoc"===metaBook.mode)d=metaBook.head,a=metaBook.docinfo[d.codexbaseid||d.id],da.nav&&V("skimForward/toc() head=%o info=%o n=%o h=%o",d,a,a.next,a.head),a.next?metaBook.GoTo(a.next.frag,"skimForward"):a.head&&a.head.next?metaBook.GoTo(a.head.next.frag,"skimForward"):a.head&&a.head.head&&a.head.head.next?metaBook.GoTo(a.head.head.next.frag,"skimForward"):
metaBook.setMode(!1);else if(metaBook.skimpoints&&metaBook.skimoff+1<metaBook.skimpoints.length)metaBook.skimoff++,metaBook.GoTo(metaBook.skimpoints[metaBook.skimoff]);else return d=metaBook.skimming,e=(b=metaBook.nextSlice(d))&&metaBook.getRef(b),(da.gestures||da.flips||da.nav)&&V("scanForward (on %o) from %o/%o to %o/%o under %o",a,d,metaBook.getRef(d),b,e,metaBook.skimming),e&&b&&metaBook.Skim(e,b,1),b}}function t(a){var b=va();fa(document.body,/\bmb(PAGE)?PREVIEW/g);if(!(Ca&&100>b-Ca)){Ca=b;metaBook.uisound&&
K.playAudio("METABOOKSKIMBACKWARDAUDIO");if(!ea(document.body,"mbSKIMMING")){if("openglossmark"===metaBook.mode){a=metaBook.docinfo._ids;var c=metaBook.target&&metaBook.target.id,b=metaBook.glossdb,d=a.length;if(c&&0<(d=Ua.position(a,c)))for(d--;0<=d;){if((c=b.find("frag",a[d]))&&c.length){a=ga(a[d]);b=Fa(a,".glossmark");metaBook.GoTo(a,"skimBackward/glosses",!0);metaBook.showGlossmark(a,b);return}d--}metaBook.setMode(!1);return}if(!metaBook.skimming)return!1}Ga("METABOOKPREVSKIM","flash");Ga("METABOOKSKIMMER",
"flash");setTimeout(function(){fa("METABOOKSKIMMER","flash");fa("METABOOKPREVSKIM","flash")},200);if("statictoc"===metaBook.mode)a=metaBook.head,b=metaBook.docinfo[a.codexbaseid||a.id],da.nav&&V("skimBackward/toc() head=%o info=%o p=%o h=%o",a,b,b.prev,b.head),b.prev?metaBook.GoTo(b.prev.frag,"skimBackward"):b.head?metaBook.GoTo(b.head.frag,"skimBackward"):metaBook.setMode(!1);else if(metaBook.skimpoints&&0<metaBook.skimoff)metaBook.skimoff--,metaBook.GoTo(metaBook.skimpoints[metaBook.skimoff]);else return b=
metaBook.skimming,c=(d=metaBook.prevSlice(b))&&metaBook.getRef(d),(da.gestures||da.flips||da.nav)&&V("skimBackward (on %o) from %o/%o to %o/%o under %o",a,b,metaBook.getRef(b),d,c,metaBook.skimming),c&&d&&metaBook.Skim(c,d,-1),d}}function Q(a){a=a||window.event;var b=I.T(a);if(!W(b)){if(ya(b,".ellipsis")&&(ya(b,".elision")||ya(b,".delision")))K.toggleClass("METABOOKSKIMMER","expanded");else{if(ya(b,".tool")){if((a=Ba(b))&&(a.name||a.getAttribute("name"))){a=a.name||a.getAttribute("name");a=Ua.resolve(a,
metaBook.glossdb);if(!a||!metaBook.setGlossTarget(a))return;metaBook.stopSkimming();metaBook.setMode("addgloss")}return}ya(b,".tochead")?(b=(b=ya(b,".tocref"))&&b.getAttribute("data-tocref"))?metaBook.GoTOC(b):Aa("METABOOKSKIMMER","expanded"):Aa("METABOOKSKIMMER","expanded")}I.cancel(a)}}function aa(a){a=a||window.event;metaBook.hudup||metaBook.mode||metaBook.cxthelp?(I.cancel(a),metaBook.setMode(!1)):(I.cancel(a),metaBook.hudup?metaBook.setMode(!1):metaBook.setMode("gotopage",!0))}function X(a){a=
a||window.event;metaBook.hudup||metaBook.mode||metaBook.cxthelp?(I.cancel(a),metaBook.setMode(!1)):(I.cancel(a),metaBook.hudup?metaBook.setMode(!1):metaBook.setMode("gotoref",!0))}function C(a){a=a||window.event;metaBook.hudup||metaBook.mode||metaBook.cxthelp?(I.cancel(a),metaBook.setMode(!1)):(I.cancel(a),metaBook.hudup?metaBook.setMode(!1):metaBook.setMode("gotoloc",!0))}function Z(a){a=a||window.event;metaBook.hudup||metaBook.mode||metaBook.cxthelp?(I.cancel(a),metaBook.setMode(!1)):(I.cancel(a),
metaBook.hudup?metaBook.setMode(!1):metaBook.setMode("gotoloc",!0))}function ja(a){a=a||window.event;var b=I.T(a);da.gestures&&V("head_tap %o t=%o",a,b);metaBook.previewing?(metaBook.stopPreview("head_tap"),ca(a)):I.isClickable(b)||b!==metaBook.DOM.head&&b!==metaBook.DOM.tabs||(metaBook.mode?(I.cancel(a),metaBook.setMode(!1)):K.hasClass(document.body,"mbSHOWHELP")?(I.cancel(a),K.dropClass(document.body,"mbSHOWHELP")):metaBook.hudup?(I.cancel(a),metaBook.setMode(!1)):(I.cancel(a),metaBook.setMode(!0)))}
function U(a){da.gestures&&V("foot_tap %o",a);metaBook.previewing?(metaBook.stopPreview("foot_tap"),ca(a)):W(a)||pa(I.T(a),"hudbutton")||!(metaBook.hudup||metaBook.mode||metaBook.cxthelp)||(I.cancel(a),metaBook.setMode(!1))}function ka(b,c){b=b||window.event;c||(c=I.T(b));var d=Ka("METABOOKPAGEBAR");a(!1);if(!metaBook.hudup&&!metaBook.mode||metaBook.fullheight){if(3===c.nodeType&&(c=c.parentNode),!pa(c,d)||"SPAN"===c.tagName){var e=parseInt(c.innerHTML,10);(da.gestures||ea(d,"metabooktrace"))&&V("pagebar_span_hold %o t=%o gopage: %o=>%o/%o, start=%o",
b,c,Da,e,metaBook.pagecount,Sa);Sa||(Sa=e);Da!==e&&e&&(d.title=Da?Xa("Release to go to this page (%d), move away to return to page %d",e,metaBook.curpage):Xa(metaBook.touch?"Release to return to page %d, tap the content or margin to settle here (page %d)":"Release to return to page %d, tap a key to settle here (page %d)",metaBook.curpage,e),Da=e,metaBook.startPreview("CODEXPAGE"+Da,"pagebar_span_hold/timeout"))}}else I.cancel(b),metaBook.setMode(!1)}function T(b,c){b=b||window.event;c||(c=I.T(b));
var d=Ka("METABOOKPAGEBAR");(da.gestures||ea(d,"metabooktrace"))&&V("pagebar_tap %o",b);a(!1);metaBook.previewing&&!Da?metaBook.stopPreview("pagebar_tap",!0):metaBook.hudup||metaBook.mode||metaBook.cxthelp?(da.gestures&&V("clearHUD %s %s %s",metaBook.mode,metaBook.hudup?"hudup":"",metaBook.cxthelp?"hudup":""),I.cancel(b),metaBook.setMode(!1)):(3===c.nodeType&&(c=c.parentNode),pa(c,d)&&"SPAN"!==c.tagName||(d=parseInt(c.innerHTML,10),Da!==d&&(metaBook.GoToPage(d,"pagebar_tap",!0),metaBook.setMode(!1))))}
function J(b,c){b=b||window.event;c||(c=I.T(b));var d=Ka("METABOOKPAGEBAR");(da.gestures||ea(d,"metabooktrace"))&&V("pagebar_release %o, previewing=%o, ptarget=%o start=%o",b,metaBook.previewing,metaBook.previewTarget,Sa);a(!1);3===c.nodeType&&(c=c.parentNode);metaBook.previewing?(fa(c,"preview"),metaBook.stopPreview("pagebar_release",!0),Da=Sa=!1,I.cancel(b),pa(c,d)):Sa=!1}function n(b,c){b=b||window.event;c||(c=I.T(b));var d=b.relatedTarget,e=Ka("METABOOKPAGEBAR");a(!1);(da.gestures||ea(e,"metabooktrace"))&&
V("pagebar_slip %o, previewing=%o, target=%o start=%o",b,metaBook.previewing,metaBook.previewTarget,Sa);metaBook.previewing&&(d&&pa(d,metaBook.body)?a(function(){Ka("METABOOKPAGEBAR").title="";qa=!1;metaBook.GoTo(d,b)}):a(function(){Ka("METABOOKPAGEBAR").title="";qa=!1;fa(c,"preview");metaBook.stopPagePreview("pagebar_slip/timeout")}),Da=!1)}function w(a){a=a||window.event;I.cancel(a);"addgloss"===metaBook.mode&&metaBook.cancelGloss();metaBook.setMode(!1);K.dropClass(document.body,"mbSHOWHELP")}function sa(a){metaBook.setMode(!1)}
function R(a){a?metaBook.textinput!==a&&(metaBook.textinput=a,metaBook.freezelayout=!0,a.focus()):(a=metaBook.textinput,metaBook.textinput=!1,metaBook.freezelayout=!1,a&&a.blur())}function ua(a){a||(a=metaBook.textinput);a&&metaBook.textinput===a&&(metaBook.textinput=!1,metaBook.freezelayout=!1,a.blur())}function ab(a){a=a||window.event;a=I.T(a);var b=ya(a,"textarea");b||(b=ya(a,"input"));b&&"string"===typeof b.type&&0===b.type.search(K.text_types)&&R(b)}function Pa(a){a=a||window.event;a=a.nodeType?
a:I.T(a);var b=ya(a,"textarea");b||(b=ya(a,"input"));b&&"string"===typeof b.type&&0===b.type.search(K.text_types)&&ua(b)}function Na(a){a?(K.addClass(document.body,"mbSHOWHELP"),metaBook.cxthelp=!0):(K.dropClass(document.body,"mbSHOWHELP"),metaBook.cxthelp=!1);return!1}function bb(a){a=a||window.event;I.cancel(a);metaBook.cxthelp?(K.dropClass(document.body,"mbSHOWHELP"),metaBook.cxthelp=!1):(K.addClass(document.body,"mbSHOWHELP"),metaBook.cxthelp=!0);return!1}function Oa(a){a=a||window.event;var b=
I.T(a);b.href&&"#"===b.href[0]&&metaBook.xtargets[b.href.slice(1)]&&(b=metaBook.xtargets[b.href.slice(1)],I.cancel(a),b())}function eb(a){a=a||window.event;if(!metaBook.touch||metaBook.hudup){if(!(a.shiftKey||a.touches&&2<=a.touches.length)){var b=metaBook.readLocal("metabook.opened("+metaBook.docuri+")",!0);b&&6E5<b-va()&&(Ka("METABOOKCOVERHOLDER")?Ka("METABOOKCOVER").className="bookcover":Ka("METABOOKCOVER").className="titlepage")}metaBook.clearStateDialog();metaBook.showCover();I.cancel(a)}}function Wa(a){a=
a||window.event;a.shiftKey||a.touches&&2<=a.touches.length||(Ka("METABOOKCOVER").className="bookcover");metaBook.clearStateDialog();metaBook.showCover();I.cancel(a)}function xa(a){a=a||window.event;metaBook.setHUD(!0);fdjt.UI.cancel(a);return!1}function Ra(a){metaBook.submitGloss()}function na(a){a=a||window.event;ca(a);metaBook.refreshLayout()}function ha(a){a=a||window.event;ca(a);metaBook.resetState()}function cb(a){a=a||window.event;ca(a);metaBook.refreshOffline()}function za(a){a=a||window.event;
ca(a);metaBook.clearOffline()}function oa(a){a=a||window.event;metaBook.consolefn(a)}function Va(a){a=a||window.event;metaBook.UI.settingsSave(a)}function Qa(a){a=a||window.event;metaBook.UI.settingsReset(a)}var da=metaBook.Trace,Xa=fdjt.String,va=fdjt.Time,V=fdjt.Log,K=fdjt.DOM,I=fdjt.UI,Ua=fdjt.RefDB,Ka=fdjt.ID,ga=metaBook.ID,Ga=K.addClass,ea=K.hasClass,fa=K.dropClass,Aa=K.toggleClass,ra=metaBook.getTarget,ya=K.getParent,pa=K.hasParent,W=I.isClickable,Fa=K.getChild,M=K.getChildren,Y=K.getInput,
ma=K.Selector,Ba=metaBook.UI.getCard,Ta=I.submitEvent,Ya=I.Reticle,qa=!1;metaBook.previewTimeout=a;var Ja=!1;metaBook.slipTimeout=r;metaBook.uiclasses=/\b(metabookui|glossmark)\b/gi;metaBook.addConfig("controlc",function(a,b){metaBook.controlc=b});metaBook.UI.addHandlers=g;metaBook.setupGestures=function(a){var b=metaBook.ui;b||(metaBook.ui=b="mouse");!a&&(1<da.startup||da.gestures)&&V("Setting up basic handlers for %s UI",b);a&&da.gestures&&V("Setting up %s UI handlers for %o",b,a);a||(g(!1,"window"),
g(document,"document"),g(document.body,"body"),g(Ka("METABOOKBODY"),"content"),metaBook.TapHold.body=I.TapHold(fdjt.ID("METABOOKBODY"),{override:!0,noslip:!0,id:"METABOOKBODY",maxtouches:2,taptapthresh:350,untouchable:m,movethresh:10}),g(metaBook.HUD,"hud"));if(b){var b=metaBook.UI.handlers[b],c=[],d=[],e;for(e in b)b.hasOwnProperty(e)&&(0<=e.indexOf(".")||0<=e.indexOf("#"))&&c.push(e);for(var c=c.sort(function(a,b){return b.length-a.length}),f=0,h=c.length;f<h;){e=c[f++];var k=K.$(e,a),l=b[e];e=
new ma(e);a&&e.match(a)&&K.addListeners(a,l);e=0;for(var n=k.length;e<n;){var p=k[e++];0>d.indexOf(p)&&(d.push(p),K.addListeners(p,l))}}}2<da.startup&&V("Done with handler setup")};var La=!1,Ma=!1,wa=metaBook.Slice,$a=!1;metaBook.initGlossMode=function(){var a=Fa("METABOOKLIVEGLOSS","form");if(a){var b=Y(a,"NOTE");b&&metaBook.setFocus(b);metaBook.setGlossMode(a.className)}};metaBook.highlightTerm=function(a,b,c,d){var e=[],f=[];if("string"===typeof a)e=d&&d[a]||[a];else{(c=c.knodes)?c instanceof Array||
(c=[c]):c=[];for(var h=0,g=c.length;h<g;){var k=c[h++];if(k===a||Ua.contains(k.allways,a)){var l=k._qid,m=k.dterm;(l=d&&(d[l]||d[m]))?"string"===typeof l?e.push(l):e=e.concat(l):((l=k.EN)&&("string"===typeof l?e.push(l):e=e.concat(l)),(k=k.hooks)&&("string"===typeof k?e.push(k):e=e.concat(k)))}}0===e.length&&(e=!1)}if(!e)return[];"string"===typeof e&&(e=[e]);a=0;for(d=e.length;a<d;)if(h=e[a++],g=new K.textRegExp(h,!0,!0),c=metaBook.getDups(b),c=K.findMatches(c,g),da.highlight&&V("Trying to highlight %s (using %o) in %o, ranges=%o",
h,g,b,c),c&&c.length)for(h=0;h<c.length;)g=I.Highlight(c[h++],"mbhighlightsearch"),f=f.concat(g);return f};metaBook.UI.handlers.onkeyup=D;var ia={63:"searching",102:"searching",65:"openheart",97:"openheart",83:"searching",115:"searching",80:"gotopage",112:"gotopage",76:"gotoloc",108:"gotoloc",70:"searching",100:"device",68:"device",110:"overtoc",78:"overtoc",116:"statictoc",84:"statictoc",72:"help",103:"allglosses",71:"allglosses",67:"console",99:"console"};metaBook.UI.handlers.onkeypress=N;metaBook.UI.goto_keypress=
function(a){a=a||window.event||null;var b=I.T(a),c=a.charCode||a.keyCode,d=!1;"GOTOLOC"!==b.name&&"GOTOPAGE"!==b.name&&13===c&&I.cancel(a);if(13===c){if("GOTOPAGE"===b.name)a=parseInt(b.value,10),"number"===typeof a&&(d=!0,metaBook.GoToPage(a));else if("GOTOREF"===b.name){if(a=metaBook.layout.pagemap[b.value])metaBook.GoToPage(a),d=!0}else"GOTOLOC"===b.name&&(a=parseFloat(b.value),"number"===typeof a&&0<=a&&100>=a&&(a=Math.floor(a/100*metaBook.ends_at)+1,metaBook.JumpTo(a),d=!0));d&&(b.value="",metaBook.setMode(!1))}};
metaBook.UI.hudmodebutton=E;metaBook.UI.dropHUD=function(a){var b=I.T(a);W(b)?da.gestures&&V("Clickable: don't dropHUD %o",a):(da.gestures&&V("dropHUD %o",a),I.cancel(a),metaBook.setMode(!1))};var Za=!1,Ia=!1,Ha=!1;metaBook.UI.setTarget=function(a){a?(a=Fa(a,".glossmark"))?A(a,!0):A(!1,!1):A(!1,!1)};metaBook.UI.forceSyncAction=function(a){a=a||window.event;I.cancel(a);metaBook.forceSync();navigator.onLine?metaBook.connected?I.alertFor(7,"Sychronizing glosses, etc with the remote server"):I.alertFor(15,
"You're not currently logged into sBooks.  Information will be synchronized when you've logged in."):I.alertFor(15,"You're currently offline; information will be synchronized when you're back online");return!1};var Ca=!1;metaBook.Forward=function(a){a||(a=window.event||!1);a&&I.cancel(a);da.nav&&V("Forward e=%o h=%o t=%o",a,metaBook.head,metaBook.target);a&&a.shiftKey?S(a):O(a)};metaBook.Backward=function(a){a||(a=window.event||!1);a&&I.cancel(a);da.nav&&V("Backward e=%o h=%o t=%o",a,metaBook.head,
metaBook.target);a&&a.shiftKey?t():P()};metaBook.pageForward=O;metaBook.pageBackward=P;metaBook.skimForward=S;metaBook.skimBackward=t;var Da=!1,Sa=!1;metaBook.setFocus=R;metaBook.clearFocus=ua;metaBook.UI.focus=ab;metaBook.UI.blur=Pa;var fb=fdjt.UI.noDefault,ca=I.cancel;metaBook.setHelp=Na;metaBook.toggleHelp=bb;metaBook.UI.highlightSetting=function(a,b){var c=Ka(a);b&&fdjt.UI.cancel(b);a?(Ga(c,"metabookhighlightsetting"),"device"!==metaBook.mode&&(metaBook.popmode&&(c=metaBook.popmode,fa(K.$(".metabookhighlightsetting"),
"metabookhighlightsetting"),metaBook.popmode=void 0,c()),metaBook.setMode("device"))):(V.warn("Couldn't resolve setting %s",a),fa(K.$(".metabookhighlightsetting"),"metabookhighlightsetting"),metaBook.setMode("device"))};metaBook.raiseHUD=xa;metaBook.lowerHUD=function(a){a=a||window.event;metaBook.setHUD(!1);fdjt.UI.cancel(a);return!1};fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{window:{keyup:D,keydown:y,keypress:N,focus:ab,blur:Pa},"#METABOOKBODY":{mouseup:function(a){a=a||window.event;metaBook.zoomed||
(metaBook.page_turner?(clearInterval(metaBook.page_turner),metaBook.page_turner=!1):metaBook.select_target&&(metaBook.startAddGloss(metaBook.select_target,a.shiftKey&&"addtag",a),metaBook.select_target=!1))}},content:{tap:k,taptap:b,hold:f,release:z,mousedown:d,mouseup:c,click:ca},toc:{tap:v,hold:H,release:G,slip:x,mouseover:I.CoHi.onmouseover,mouseout:I.CoHi.onmouseout,click:ca},glossmark:{mouseup:F,click:ca,mousedown:ca,mouseover:function(a){a=a||window.event;a=I.T(a);var b=ra(a);K.hasClass(b,"mbtarget")||
A(a,!0)},mouseout:function(a){a=a||window.event;a=I.T(a);var b=ra(a);K.hasClass(b,"mbtarget")||A(a,!1)}},hud:{click:Oa,tap:Oa},"#METABOOKSTARTPAGE":{click:metaBook.UI.dropHUD},"#METABOOKTOPBAR":{tap:xa},"#METABOOKSHOWCOVER":{tap:eb,release:Wa},"#METABOOKHUDHELP":{click:metaBook.UI.dropHUD},".helphud":{click:metaBook.UI.dropHUD},".metabookheart":{tap:function(a){W(a)||metaBook.setMode(!1)}},"#METABOOKPAGEBAR":{tap:T,hold:ka,release:J,slip:n,click:ca},"#METABOOKPAGEREFTEXT":{tap:X},"#METABOOKPAGENOTEXT":{tap:aa},
"#METABOOKLOCPCT":{tap:Z},"#METABOOKLOCOFF":{tap:C},"#METABOOKSKIMMER":{tap:Q},"#METABOOKPAGEHEAD":{click:ja},"#METABOOKTABS":{click:ja},"#METABOOKHEAD":{click:ja},"#METABOOKPAGEFOOT":{tap:U},".searchcloud":{tap:metaBook.UI.handlers.searchcloud_select,release:metaBook.UI.handlers.searchcloud_select},"#METABOOKHELPBUTTON":{tap:bb,hold:function(a){Na(!0);ca(a)},release:function(a){Na(!1);ca(a)},slip:function(a){Na(!1);ca(a)}},"#METABOOKHELP":{click:bb,mousedown:ca,mouseup:ca},"#METABOOKNEXTPAGE":{click:function(a){metaBook.pageForward(a);
ca(a)}},"#METABOOKPREVPAGE":{click:function(a){metaBook.pageBackward(a);ca(a)}},"#METABOOKNEXTSKIM":{click:function(a){metaBook.skimForward(a);ca(a)}},"#METABOOKPREVSKIM":{click:function(a){metaBook.skimBackward(a);ca(a)}},"#METABOOKSHOWTEXT":{click:w},"#METABOOKGLOSSDETAIL":{click:metaBook.UI.dropHUD},"#METABOOKNOTETEXT":{click:p},".hudmodebutton":{tap:E,hold:E,slip:E,release:E},".hudbutton[alt='save gloss']":{tap:Ra,hold:Ra},".metabookclosehud":{click:w},"#METABOOKSETTINGS":{click:fdjt.UI.CheckSpan.onclick},
".metabooktogglehelp":{click:bb},"#METABOOKCONSOLETEXTINPUT":{focus:function(){fdjt.DOM.addClass("METABOOKCONSOLEINPUT","uptop")},blur:function(){fdjt.DOM.dropClass("METABOOKCONSOLEINPUT","uptop")}},"#METABOOKCONSOLEBUTTON":{click:oa},"#METABOOKSAVESETTINGS":{click:Va},"#METABOOKAPPLYSETTINGS":{click:function(a){a=a||window.event;metaBook.UI.settingsOK(a)}},"#METABOOKRESETSETTINGS":{click:Qa},"#METABOOKSETTINGSTABLE":{},"#METABOOKREFRESHOFFLINE":{click:cb},"#METABOOKREFRESHLAYOUT":{click:na},"#METABOOKRESETSYNC":{click:ha},
".clearoffline":{click:za},".metabookclearmode":{click:sa},"#METABOOKGOTOREFHELP":{click:sa},"#METABOOKGOTOPAGEHELP":{click:sa},"#METABOOKGOTOLOCHELP":{click:sa},".metabookshowsearch":{click:function(a){metaBook.showSearchResults();fdjt.UI.cancel(a)}},".metabookrefinesearch":{click:function(a){metaBook.setMode("refinesearch");fdjt.UI.cancel(a)}},".metabookexpandsearch":{click:function(a){metaBook.setMode("expandsearch");fdjt.UI.cancel(a)}},".metabookclearsearch":{click:function(a){a=a||window.event;
metaBook.UI.handlers.clearSearch(a);fdjt.UI.cancel(a);return!1}},"#METABOOKSEARCHINFO":{click:metaBook.searchTags_onclick},"#METABOOKSOURCES":{click:metaBook.UI.handlers.sources_ontap},"#METABOOKSOURCES .button.everyone":{click:function(a){a=a||window.event;metaBook.UI.handlers.everyone_ontap(a);fdjt.UI.cancel(event)}}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{window:{keyup:D,keydown:y,keypress:N,touchmove:L,focus:ab,blur:Pa},content:{tap:k,hold:f,taptap:b,release:z,swipe:function(a){if(!metaBook.zoomed){var b=
a.deltaX,c=a.deltaY,d=K.viewWidth(),e=0>b?-b:b,f=0>c?-c:c,h=metaBook.head,h=h&&h.id&&metaBook.docinfo[h.id];da.gestures&&V("swiped d=%o,%o, ad=%o,%o, s=%o,%o vw=%o, n=%o",b,c,e,f,a.startX,a.startY,d,a.ntouches);e>2*f?b<-(metaBook.minswipe||10)?1<a.ntouches&&ea(document.body,"mbSKIMMING")?metaBook.skimForward(a):1<a.ntouches?h?h.sub&&h.sub.length?metaBook.GoTo(h.sub[0].frag,"doubleswipe"):h.next?metaBook.GoTo(h.next.frag,"doubleswipe"):h.head?metaBook.GoTo(h.head.frag,"doubleswipe"):metaBook.Forward(a):
metaBook.Forward(a):metaBook.Forward(a):b>(metaBook.minswipe||10)&&(1<a.ntouches&&ea(document.body,"mbSKIMMING")?metaBook.skimBackward(a):1<a.ntouches?window.history.back():metaBook.Backward(a)):f>2*e&&(metaBook.hudup?c<-(metaBook.minswipe||10)?metaBook.setMode("allglosses"):c>(metaBook.minswipe||10)&&metaBook.setMode("search"):f<=(metaBook.minswipe||10)||(a.startX<d/5&&0>c?metaBook.setMode("help"):a.startX<d/5&&0<c?metaBook.setMode("statictoc"):a.startX>.8*d&&0<c?metaBook.setMode("search"):a.startX>
.8*d&&0>c?metaBook.setMode("allglosses"):0<c?(metaBook.clearStateDialog(),metaBook.showCover()):metaBook.setHUD(!0)))}},touchstart:d,touchend:c,touchmove:fb,click:function(a){a=a||window.event;if(!metaBook.zoomed){var b=I.T(a);Ma&&3E3>va()-Ma?I.cancel(a):u(b)?I.cancel(a):W(b)||I.cancel(a)}}},hud:{touchend:Oa,tap:Oa},toc:{tap:v,hold:H,slip:x,release:G,touchtoo:function(b){b=b||window.event;a(!1);metaBook.previewing&&(da.gestures&&V("toc_touchtoo %o noabout",b),metaBook.stopPreview("toc_touchtoo",!0),
I.cancel(b))},touchmove:L},glossmark:{touchstart:F,touchend:ca},"#METABOOKSTARTPAGE":{touchend:metaBook.UI.dropHUD},"#METABOOKTOPBAR":{tap:xa},"#METABOOKSHOWCOVER":{tap:eb,release:Wa},"#METABOOKSOURCES":{touchstart:ca,touchend:metaBook.UI.handlers.sources_ontap},"#METABOOKSEARCHINFO":{click:metaBook.searchTags_onclick},"#METABOOKPAGEFOOT":{},"#METABOOKPAGEBAR":{tap:T,hold:ka,release:J,slip:n,touchtoo:function(a,b){a=a||window.event;b||I.T(a);if(metaBook.previewing)return metaBook.stopPreview("touchtoo"),
I.TapHold.clear(),metaBook.setHUD(!1),fdjt.UI.cancel(a),!1},click:ca},"#METABOOKPAGEREFTEXT":{tap:X},"#METABOOKPAGENOTEXT":{tap:aa},"#METABOOKLOCPCT":{tap:Z},"#METABOOKLOCOFF":{tap:C},"#METABOOKSKIMMER":{tap:Q},"#METABOOKPAGEHEAD":{touchstart:ja},"#METABOOKTABS":{touchstart:ja},"#METABOOKHEAD":{touchend:ja},"#METABOOKFOOT":{tap:U,touchstart:fb,touchmove:fb},"#METABOOKGLOSSDETAIL":{touchend:metaBook.UI.dropHUD,click:ca},".searchcloud":{tap:metaBook.UI.handlers.searchcloud_select,release:metaBook.UI.handlers.searchcloud_select},
"#METABOOKNEXTPAGE":{touchstart:function(a){metaBook.pageForward(a);ca(a)}},"#METABOOKPREVPAGE":{touchstart:function(a){metaBook.pageBackward(a);ca(a)}},"#METABOOKNEXTSKIM":{touchstart:function(a){metaBook.skimForward(a);ca(a)}},"#METABOOKPREVSKIM":{touchstart:function(a){metaBook.skimBackward(a);ca(a)}},"#METABOOKHELP":{tap:bb,swipe:ca},"#METABOOKHELPBUTTON":{tap:bb,hold:function(a){Na(!0);ca(a)},release:function(a){Na(!1);ca(a)},slip:function(a){Na(!1);ca(a)}},"#METABOOKNOTETEXT":{touchend:p,click:ca},
"#METABOOKSHOWTEXT":{touchstart:w,touchmove:ca,touchend:ca},".hudmodebutton":{tap:E,hold:E,release:E,slip:E},".hudbutton[alt='save gloss']":{tap:Ra,hold:Ra},".metabookclosehud":{click:w,touchmove:ca,touchend:ca},"#METABOOKSETTINGS":{touchend:fdjt.UI.CheckSpan.onclick},".metabooktogglehelp":{touchstart:ca,touchend:bb},"#METABOOKCONSOLETEXTINPUT":{touchstart:function(){fdjt.ID("METABOOKCONSOLETEXTINPUT").focus()},focus:function(){fdjt.DOM.addClass("METABOOKCONSOLEINPUT","ontop")},blur:function(){fdjt.DOM.dropClass("METABOOKCONSOLEINPUT",
"ontop")}},"#METABOOKCONSOLEBUTTON":{touchstart:ca,touchend:oa},"#METABOOKSAVESETTINGS":{touchstart:ca,touchend:Va},"#METABOOKAPPLYSETTINGS":{touchstart:ca,touchend:function(a){a=a||window.event;metaBook.UI.settingsUpdate(a)}},"#METABOOKRESETSETTINGS":{touchstart:ca,touchend:Qa},"#METABOOKSETTINGSTABLE":{},"#METABOOKREFRESHOFFLINE":{touchstart:ca,touchend:cb},"#METABOOKREFRESHLAYOUT":{touchstart:ca,touchend:na},"#METABOOKRESETSYNC":{touchstart:ca,touchend:ha},".clearoffline":{touchstart:ca,touchend:za},
".metabookclearmode":{touchstart:ca,touchend:sa},"#METABOOKGOTOREFHELP":{touchstart:ca,touchend:sa},"#METABOOKGOTOPAGEHELP":{touchstart:ca,touchend:sa},"#METABOOKGOTOLOCHELP":{touchstart:ca,touchend:sa},".metabookshowsearch":{touchstart:ca,touchend:function(a){metaBook.showSearchResults();fdjt.UI.cancel(a)}},".metabookrefinesearch":{touchstart:ca,touchend:function(a){metaBook.setMode("refinesearch");fdjt.UI.cancel(a)}},".metabookexpandsearch":{touchstart:ca,touchend:function(a){metaBook.setMode("expandsearch");
fdjt.UI.cancel(a)}},".metabookclearsearch":{touchstart:ca,touchend:function(a){a=a||window.event;metaBook.UI.handlers.clearSearch(a);fdjt.UI.cancel(a);return!1}},summary:{touchmove:L},"#METABOOKSOURCES .button.everyone":{touchstart:ca,touchend:function(a){a=a||window.event;metaBook.UI.handlers.everyone_ontap(a);fdjt.UI.cancel(event)}}})})();(function(){function a(a){l(document.body,"mbZOOM");metaBook.zoomed=!1;a&&fdjt.UI.cancel(a)}function r(a){a=a||window.event;var b=fdjt.ID("METABOOKZOOMBOX"),d=metaBook.zoomscale;d||(d=metaBook.zoomscale=1);d*=1.1;metaBook.zoomscale=d;b.style[fdjt.DOM.transform]="scale("+d+")";fdjt.UI.cancel(a)}function g(a){a=a||window.event;var b=fdjt.ID("METABOOKZOOMBOX"),d=metaBook.zoomscale;d||(d=metaBook.zoomscale=1);d/=1.1;metaBook.zoomscale=d;b.style[fdjt.DOM.transform]="scale("+d+")";fdjt.UI.cancel(a)}function m(a){a=
a||window.event;fdjt.ID("METABOOKZOOMBOX").style[fdjt.DOM.transform]="";metaBook.zoomscale=!1;fdjt.UI.cancel(a)}function k(){l(document.body,"mbMEDIA")}function q(a){a=a||window.event;var b=fdjt.ID("METABOOKMEDIATARGET");d?(clearTimeout(d),d=!1,l(document.body,"mbMEDIA")):a.shiftKey?(clearTimeout(d),d=!1,l(document.body,"mbMEDIA")):b&&b.pause&&!b.paused?d=setTimeout(function(){b.pause();d=!1;l(document.body,"mbMEDIA")},1500):l(document.body,"mbMEDIA");fdjt.UI.cancel(a)}var u=fdjt.DOM,p=fdjt.State,
f=fdjt.Log,b=metaBook,e=u.addClass,l=u.dropClass;metaBook.startZoom=function(b){var d=fdjt.ID("METABOOKZOOMTARGET"),f;if(!b)return a();metaBook.zoomtarget===b&&(metaBook.zoomed=b,e(document.body,"mbZOOM"));metaBook.zoomtarget=b;if(metaBook.layout){var g=metaBook.layout,k=b.getAttribute("data-baseid")||b.id;g.lostids&&g.lostids[k]?f=g.lostids[k].cloneNode(!0):g.splits[k]&&(f=g.splits[k].cloneNode(!0))}f||(f=b.cloneNode(!0));u.stripIDs(f,!1,"data-baseid");f.setAttribute("style","");f.id="METABOOKZOOMTARGET";
fdjt.DOM.replace(d,f);e(document.body,"mbZOOM")};metaBook.stopZoom=a;fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{"#METABOOKZOOMCLOSE":{click:a},"#METABOOKZOOMHELP":{click:metaBook.toggleHelp},"#METABOOKZOOMIN":{click:r},"#METABOOKZOOMOUT":{click:g},"#METABOOKUNZOOM":{click:m}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{"#METABOOKZOOMCLOSE":{click:metaBook.stopZoom},"#METABOOKZOOMHELP":{click:metaBook.toggleHelp},"#METABOOKZOOMIN":{click:r},"#METABOOKZOOMOUT":{click:g},"#METABOOKUNZOOM":{click:m}});
metaBook.showMedia=function(a,d){function h(){k?fdjt.DOM.replace(g,k):fdjt.ID("METABOOKMEDIA").appendChild(g);e(document.body,"mbMEDIA")}var g=fdjt.ID("METABOOKMEDIATARGET"),k=!1,m=!1;if(metaBook.showing===a)e(document.body,"mbMEDIA");else if(0===d.search("image")?m=k=u("IMG"):0===d.search("audio")?(m=u("SOURCE"),k=u("AUDIO",m),k.setAttribute("CONTROLS","CONTROLS"),k.setAttribute("AUTOPLAY","AUTOPLAY"),m.type=d):0===d.search("video")?(m=u("SOURCE"),m.type=d,k=u("VIDEO",m),k.setAttribute("CONTROLS",
"CONTROLS"),k.setAttribute("AUTOPLAY","AUTOPLAY")):0===a.search("https://www.youtube.com/embed/")?(a="https://www.youtube-nocookie.com/"+a.slice(24),a=0<a.indexOf("?")?a+"&rel=0":a+"?rel=0"):m=k=u("IFRAME"),k.id="METABOOKMEDIATARGET",metaBook.showing=a,m&&b.glossdata[a])m.src=b.glossdata[a],h();else if(m){var q=p.getLocal("glossdata("+a+")");q?"data:"===q.slice(0,5)?m.src=q:"cached"===q?(e(fdjt.ID("METABOOKMEDIA"),"loadingcontent"),e(m,"loadingcontent"),q=b.metaBookDB.transaction(["glossdata"]).objectStore("glossdata").get(a),
q.onsuccess=function(b){b=(b=b.target)&&b.result;l(fdjt.ID("METABOOKMEDIA"),"loadingcontent");l(m,"loadingcontent");b&&b.datauri?(b=metaBook.gotGlossData(a,b.datauri),m.src=b):m.src=a;h()},q.onerror=function(b){f("Retrieval of %s from indexedDB failed: %o",a,b.errorCode);l(fdjt.ID("METABOOKMEDIA"),"loadingcontent");l(m,"loadingcontent");m.src=a;h()}):(metaBook.srcloading[a]?metaBook.srcloading[a].push(m):metaBook.srcloading[a]=[m],h()):(m.src=a,h())}else h()};metaBook.hideMedia=k;var d=!1;metaBook.hideMedia=
k;fdjt.DOM.defListeners(metaBook.UI.handlers.mouse,{"#METABOOKCLOSEMEDIA":{mousedown:q}});fdjt.DOM.defListeners(metaBook.UI.handlers.touch,{"#METABOOKCLOSEMEDIA":{touchstart:q}})})();metaBook.Paginate=function(){function a(a,b){var c=D("METABOOKLAYOUTMESSAGE");fdjt.UI.ProgressBar.setMessage(c,a);"number"===typeof b&&fdjt.UI.ProgressBar.setProgress(c,b)}function r(b){var c=b.tracelevel,d=b.started,e=b.pagenum;if(e){var f=G(),d=C((f-d)/1E3),f=D("METABOOKLAYOUTINDICATOR");if(b.done)f&&(f.style.width=Math.floor(h)+"%"),y.replace("METABOOKPAGENOTEXT",y("div.metabookpageno#METABOOKPAGENOTEXT",metaBook.curpage||"?","/",e," (",Math.floor(h),"%)")),a(B("Finished laying out %d %dx%d pages in %s",
e,C((b.done-b.started)/1E3)),100),x("Finished laying out %d %dx%d pages in %s",e,b.width,b.height,C((b.done-b.started)/1E3));else if(b.lastid&&metaBook.docinfo&&metaBook.docinfo[b.lastid]){var h=metaBook.docinfo,h=100*h[b.lastid].starts_at/h._maxloc,g=Math.floor(h);f&&(f.style.width=g+"%");y.replace("METABOOKPAGENOTEXT",y("div.metabookpageno#METABOOKPAGENOTEXT",metaBook.curpage||"?","/",e," (",g,"%)"));a(B("Formatted %d %dx%d pages (%d%%)",e,b.width,b.height,g),h);c&&x("Formatted %d %dx%d pages (%d%%) in %s",
e,b.width,b.height,g,d)}else a(B("Formatted %d %dx%d pages in %s",b.pagenum,b.width,b.height,d)),c&&x("Formatted %d pages in %s",b.pagenum,d)}}function g(b,c){function d(a){D("CODEXPAGE").style.visibility="";D("CODEXCONTENT").style.visibility="";S(document.body,"mbLAYOUT");metaBook.layout=a;metaBook.pagecount=a.pages.length;h.startup&&x("Restored %d-page layout %s, adding glosses",a.pages.length,G);a=a.lostids._all_ids;for(var b=0,c=a.length;b<c;){var f=metaBook.UI.addGlossmark,g=a[b++];if((g=metaBook.glossdb.find("frag",
g))&&g.length)for(var k=0,l=g.length;k<l;){var m=metaBook.glossdb.probe(g[k++]);if(m){var n=metaBook.getDups(m.frag);P(n,"glossed");for(var p=0,q=n.length;p<q;)f(n[p++],m)}}}h.startup&&x("Finished adding glossmarks to saved layout");e();metaBook.layoutdone&&(a=metaBook.layoutdone,metaBook.layoutdone=!1,a());metaBook.state&&metaBook.restoreState(metaBook.state,"layoutRestored");return metaBook.layout.running=!1}function f(a,b){var c="metabook.layouts("+b+")",d=Z(c,!0);if(d){var e=d.indexOf(a);0<=e&&
d.splice(e,1);d.push(a);if(3<d.length){for(e=d.length-3-1;0<=e;)x("Dropping layout #%d %s",e,d[e]),E.dropLayout(d[e--]);d=d.slice(d.length-3)}ja(c,d,!0)}else ja(c,[a],!0)}function g(){function c(){if(l>=m){C.Finish();r(C);var a=metaBook.cache_layout_thresh;if(a){var b=C.done-C.started;("number"===typeof a?b>a:5E3<b)&&C.saveLayout(function(a){f(a.layout_id,metaBook.sourceid)})}D("CODEXPAGE").style.visibility="";D("CODEXCONTENT").style.visibility="";S(document.body,"mbLAYOUT");metaBook.layout=C;metaBook.pagecount=
C.pages.length;e();metaBook.layoutdone&&(a=metaBook.layoutdone,metaBook.layoutdone=!1,a());metaBook.state&&metaBook.restoreState(metaBook.state,"layoutDone");metaBook.layout.running=!1;setTimeout(z,100);return!1}var a=k[l++],b=C.hasOwnProperty("timeslice")?C.timeslice:E.timeslice||100,d=C.hasOwnProperty("timeskip")?C.timeskip:E.timeskip||50;if(3===a.nodeType&&!X(a.nodeValue)||1===a.nodeType&&"LINK"!==a.tagName&&"META"!==a.tagName&&"SCRIPT"!==a.tagName&&"BASE"!==a.tagName)C.addContent(a,b,d,C.tracelevel,
r,c);else return c()}S(document.body,"_SCROLL");P(document.body,"_BYPAGE");D("CODEXCONTENT").style.visibility="hidden";var d=metaBook.content.style.width;metaBook.content.style.width=F(metaBook.page).width+"px";var h=metaBook.content,k=t(h.childNodes);x("Laying out %d root nodes into %dx%d pages (%s), id=%s",k.length,C.width,C.height,b||"",G);a("Starting new layout",0);fdjt.DOM.adjustFonts(h);metaBook.content.style.width=d;var l=0,m=k.length;c()}if(!metaBook.layout||metaBook.layout.done){b||(b="because");
a("Preparing your book",0);S(document.body,"_SCROLL");P(document.body,"mbLAYOUT");p(!1);var k=c&&c.forced,l=F(D("CODEXPAGE"),!1,!0),m=l.inner_height,u=l.width,v=metaBook.justify,y=metaBook.bodyspacing,l=metaBook.bodysize||"normal",A=metaBook.dyslexical||!1;!metaBook.layout&&h.startup&&x("Page layout requires %dx%d %s pages",u,m,l);if(metaBook.layout){var B=metaBook.layout;if(!(k||u!==B.width||m!==B.height||l!==B.bodysize||A!==B.dyslexical||y&&y!==B.bodyspacing)&&(v&&B.justify||!v&&!B.justify)){S(document.body,
"mbLAYOUT");x("Skipping redundant pagination for %s",B.layout_id);return}metaBook.layout.Revert();metaBook.layout=!1}metaBook.sizeContent();var m=q(),C=new E(m);C.bodysize=l;C.dyslexical=A;metaBook.layout=C;var G=C.layout_id;!metaBook.cache_layout_thresh||metaBook.forcelayout||k?setTimeout(g,10):(h.layout&&x("Fetching layout %s",G),E.fetchLayout(G).then(function(b){if(!b)return g();h.layout&&x("Got layout %s",G);f(G,metaBook.sourceid);try{x("Using saved layout %s",G),D("CODEXCONTENT").style.display=
"none",a("Using cached layout",0),S(document.body,"_SCROLL"),P(document.body,"_BYPAGE"),C.restoreLayout(b).then(d)}catch(c){return x("Layout restore error: %o",c),g()}}).catch(function(){return g()}))}}function m(a,b){!0===b?y.addClass(metaBook.body,"metabook"+a):b?y.swapClass(metaBook.body,new RegExp("metabook"+a+"\\w*"),"metabook"+a+b):y.dropClass(metaBook.body,new RegExp("metabook"+a+"\\w*"));metaBook[a]=b;metaBook.postconfig&&metaBook.content?(0>metaBook.postconfig.indexOf(metaBook.sizeContent)&&
(metaBook.sized=!1),metaBook.postconfig.push(metaBook.sizeContent)):metaBook.content&&metaBook.sizeContent();metaBook.layout&&(metaBook.postconfig?metaBook.postconfig.push(function(){metaBook.Paginate(a)}):metaBook.Paginate(a))}function k(a,b,c,d,e,f,h){var g=D("CODEXPAGE"),k=g.style.left,l=g.style.right,m=fdjt.CodexLayout.sourcehash;g.style.left="";g.style.right="";a||(a=F(g,!1,!0).width);b||(b=F(D("CODEXPAGE"),!1,!0).inner_height);d||(d=metaBook.bodysize||"normal");h||(h=metaBook.sourceid||H.hex_md5(metaBook.docuri));
f||(f=metaBook.justify);e||(f=metaBook.bodyspacing);g.style.left=k;g.style.right=l;return B("%dx%d-%s-%s%s%s(%s)%s",a,b,c?"dyslexical":"",d,e?"-"+e:"",f?"-j":"",h,m?"["+m+"]":"")}function q(){function a(b){var c=!1;O(b,"codexpage")||(b.id&&r[b.id]||b.codexbaseid&&r[b.codexbaseid])&&aa(b,!0)&&(c=b);if(b=b.childNodes)for(var d=0,e=b.length;d<e;){var f=b[d++];if(1===f.nodeType&&(f=a(f)))return f}return c}function b(a,c){!O(a,"codexpage")&&a.id&&!a.codexbaseid&&metaBook.docinfo[a.id]&&(c=a.id);if(1!==
a.nodeType)return c;var d=a.childNodes;if(d)for(var e=0,f=d.length;e<f;){var g=d[e++];1===g.nodeType&&(c=b(g,c))}return c}function c(a,b){var d;if(1!==a.nodeType)return!1;if(a.codexbaseid===b)return a;if(d=a.childNodes)if(d.length)for(var e=0,f=d.length;e<f;){var g=c(d[e++],b);if(g)return g}else return!1;else return!1}function d(a,b,e){for(var f=b.id,g=0,h=b,k=b;h&&!O(h,"codexpage");)h=h.parentNode;if(h)b=parseInt(h.getAttribute("data-pagenum"),10);else return g;for(;k&&k!==e;)if((h=Q(k))&&(g+=h),
h=a[b++])k=c(h,f);else break;return g}var e=F(D("CODEXPAGE"),!1,!0).width,f=F(D("CODEXPAGE"),!1,!0).inner_height,g=y("div#CODEXCONTENT"),k=y("div.metabookpages#METABOOKPAGES"),l=metaBook.dyslexical||!1,m=metaBook.bodysize||"normal",p=metaBook.sourceid||H.hex_md5(metaBook.docuri),q=fdjt.CodexLayout.sourcehash,l=B("%dx%d-%s-%s%s(%s)%s",e,f,l?"dyslexical":"",m,metaBook.justify?"-j":"",p||metaBook.refuri,q?"["+q+"]":""),r=metaBook.docinfo,t=!1,u=y.getChild,z=B.stripMarkup,A=v.getLocal("metabook.sourceid("+
metaBook.refuri+")");if(A&&p&&p!==p){m=v.getLocal("fdjtmetaBook.layouts",!0);q=[];if(m)for(var A=new RegExp("\\("+A+"\\)$"),C=0,G=m.length;C<G;){var L=m[C++];0<L.search(A)?E.dropLayout(L):q.push(L)}q.length?v.setLocal("fdjtmetaBook.layouts",q):v.dropLocal("fdjtmetaBook.layouts",q)}p&&v.setLocal("metabook.sourceid("+metaBook.refuri+")",p);e={page_height:f,page_width:e,orientation:y.getOrientation(window),container:k,origin:g,pagerule:metaBook.CSS.pagerule,tracelevel:h.layout,layout_id:l,pagefn:function(c,
e){var f=e.pages,g=e.pagenum,h=a(c),k=h.codexbaseid||h.id,l=b(c),m=g&&1<g&&f[g-2],p=u(c,".staticpageref,.sbookstaticpageref"),q=!1;if(p){var w=p.getAttribute("data-pageref");w||(w=z(p.innerHTML));w&&(e.pagemap||(e.pagemap={}),c.setAttribute("data-staticpageref",w),e.pagemap[w]||(e.laststaticref=w),e.pagemap[w]=c)}else m&&(p=m.getAttribute("data-staticpageref"))&&c.setAttribute("data-staticpageref",p);l&&c.setAttribute("data-lastid",l);h?(q=N(k),q=q===h?0:d(f,q,h),q=r[k].starts_at+q,k&&c.setAttribute("data-topid",
k),c.setAttribute("data-sbookloc",q)):m&&((k=(k=m.getAttribute("data-lastid"))&&r[k])?(q=k.starts_at,c.setAttribute("data-sbookloc",k.ends_at)):(k=m.getAttribute("data-sbookloc"))?c.setAttribute("data-sbookloc",k):c.setAttribute("data-sbookloc","0"));"number"===typeof q&&g&&!metaBook.curpage&&metaBook.state&&t!==metaBook.state&&metaBook.state.hasOwnProperty("location")&&q>=metaBook.state.location&&(t=metaBook.state,setTimeout(function(){metaBook.GoToPage(g,"layout",!1)},10))},logfn:x};y.replace("METABOOKPAGES",
k);metaBook.pages=k;k=/\b(sbookfullpage)|(sbooktitlepage)|(stanza)\b/;e.avoidbreakinside=[k];(k=y.sel(y.getMeta("avoidbreakinside",!0)))&&e.avoidbreakinside.push(k);(k=y.sel(y.getMeta("SBOOKS.avoidbreakinside",!0)))&&e.avoidbreakinside.push(k);(k=y.getMeta("alwaysbreakbefore",!0).concat(y.getMeta("SBOOKS.alwaysbreakbefore",!0)).concat(y.getMeta("forcebreakbefore",!0)).concat(y.getMeta("SBOOKS.forcebreakbefore",!0)))&&k.length&&(e.forcebreakbefore=y.sel(k));(k=y.getMeta("alwaysbreakafter",!0).concat(y.getMeta("SBOOKS.alwaysbreakafter",
!0)).concat(y.getMeta("forcebreakafter",!0)).concat(y.getMeta("SBOOKS.forcebreakafter",!0)))&&k.length&&(e.forcebreakafter=y.sel(k));(k=y.getMeta("avoidbreakbefore",!0).concat(y.getMeta("SBOOKS.avoidbreakbefore",!0)).concat(y.getMeta("dontbreakbefore",!0)).concat(y.getMeta("SBOOKS.dontbreakbefore",!0)))&&k.length&&(e.avoidbreakbefore=y.sel(k));(k=y.getMeta("avoidbreakafter",!0).concat(y.getMeta("SBOOKS.avoidbreakafter",!0)).concat(y.getMeta("dontbreakafter",!0)).concat(y.getMeta("SBOOKS.dontbreakafter",
!0)))&&k.length&&(e.avoidbreakafter=y.sel(k));(k=y.getMeta("avoidbreakinside",!0).concat(y.getMeta("SBOOKS.avoidbreakinside",!0)).concat(y.getMeta("dontbreakinside",!0)).concat(y.getMeta("SBOOKS.dontbreakinside",!0)))&&k.length&&(e.avoidbreakinside=y.sel(k));(k=[".sbookfullpage",".sbooktitlepage",".sbookpage"].concat(y.getMeta("SBOOKS.fullpage",!0)).concat(y.getMeta("SBOOKS.fullpage",!0)).concat(y.getMeta("sbookfullpage",!0)))&&k.length&&(e.fullpages=y.sel(k));(k=[".sbookfloatpage"].concat(y.getMeta("SBOOKS.floatpage",
!0)).concat(y.getMeta("SBOOKS.floatpage",!0)).concat(y.getMeta("sbookfloatpage",!0)))&&k.length&&(e.floatpages=y.sel(k));(k=[".sbookfloatpage"].concat(y.getMeta("SBOOKS.floatpage",!0)).concat(y.getMeta("SBOOKS.floatpage",!0)).concat(y.getMeta("sbookfloatpage",!0)))&&k.length&&(e.floating=y.sel(k));(k=y.getMeta("sbookscaletopage",!0))&&k.length?k.concat([".sbookscaletopage",".sbookpagescaled"]):k=[".sbookscaletopage",".sbookpagescaled"];e.scaletopage=k;y.getMeta("metaBook.dontbreakblocks")||y.getMeta("metaBook.keepblocks")||
y.getMeta("~=metaBook.dontbreakblocks")||y.getMeta("~=metaBook.keepblocks")||y.getMeta("~dontbreakblocks")||y.getMeta("~keepblocks")?e.break_blocks=!1:e.break_blocks=!0;y.getMeta("metaBook.dontscalepages")||y.getMeta("~=metaBook.dontscalepages")||y.getMeta("dontscalepages")?e.scale_pages=!1:e.scale_pages=!0;e.dontsave=fdjt.DOM.Selector(".glossmark");return e}function u(){var a=metaBook.page,b=F(a),c=b.height,d=y.viewHeight(),b=b.width,b=y.viewWidth()-b;50!==b?(a.style.left=b/2+"px",a.style.right=
b/2+"px"):a.style.left=a.style.right="";metaBook.fullheight=80>d-c?!0:!1;metaBook.fullwidth=80>b?!0:!1;metaBook.fullwidth?P(document.body,"_FULLWIDTH"):S(document.body,"_FULLWIDTH");metaBook.fullheight?P(document.body,"_FULLHEIGHT"):S(document.body,"_FULLHEIGHT")}function p(a){var b=metaBook.CSS.resizerule;"undefined"===typeof a&&(a=!0);if(!a||!O(document.body,"_SCALEDLAYOUT"))if(a||O(document.body,"_SCALEDLAYOUT"))if(b&&(b.style[y.transform]="",b.style[y.transformOrigin]="",b.style.left="",b.style.top=
""),a){u();var c=metaBook.layout,d=F(D("CODEXPAGE"),!1,!0);a=d.width;var d=d.inner_height,e=c.width,c=c.height,f=d/c,g=a/e,f=f<g?f:g;b||(metaBook.CSS.resizerule=b=y.addCSSRule("#CODEXPAGE div.codexpage, body._ANIMATE.mbPREVIEW #CODEXPAGE div.codexpage",""));b.style[y.transformOrigin]="left top";b.style[y.transform]="scale("+f+","+f+")";e*=f;e<a&&(b.style.left=(a-e)/2+"px");c*f<d&&(b.style.top="0px");b=metaBook.pagecount;b=D("METABOOKPAGEBAR").offsetWidth/b;1>b&&(b=1);metaBook.CSS.pagespanrule?metaBook.CSS.pagespanrule.style.width=
b+"px":metaBook.CSS.pagespanrule=y.addCSSRule("div.metabookpagespans > span","width: "+b+"px;");P(document.body,"_SCALEDLAYOUT")}else S(document.body,"_SCALEDLAYOUT"),u()}function f(a,c,d,e){var f=!e;e||(e="current");var g=metaBook.pagecount,h=metaBook.layout.laststaticref,k=fdjt.ID("METABOOKPAGESPAN"+a),l=L("METABOOKPAGEBAR","."+e);l[0]!==k&&(S(l,e),P(k,e));"number"===typeof d?(k=metaBook.ends_at,e=100*d/k,l=Math.round(Math.log(k/40)/Math.log(10))-2,0>l&&(l=0),e=y("span.metabookloc#METABOOKLOCPCT",
(0===l?Math.floor(e):B.precString(e,l))+"%"),e.title=d+"/"+k):e=y("span.metabookloc#METABOOKLOCPCT");d=y("span#METABOOKPAGENOTEXT.metabookpageno",a,"/",g);d.title="select to change page number";y.replace("METABOOKPAGENOTEXT",d);if(c=c&&h&&y("span#METABOOKPAGEREFTEXT.metabookpageno",c+"("+h+")"))c.title="Reference page number (from some print version)",y.replace("METABOOKPAGEREFTEXT",c);y.replace("METABOOKLOCPCT",e);e.title=(e.title||"")+(e.title?"; ":"")+" select to change %";f&&(h=D("METABOOKPAGEPROGRESS"))&&
(h.style.width=100*(a-1)/g+"%");if(f&&(a=(a=(a=D("CODEXPAGE"+a))&&a.getAttribute("data-topid"))&&metaBook.docinfo[a])){k=(f=(a=a.level?a:a.head)&&a.head)&&f.head;a=a&&b(a);f=f&&b(f);for(h=k&&b(k);h&&f&&1>=a.width;){l=k.head&&b(k.head);if(!l)break;k=k.head;a=f;f=h;h=l}var k=D("METABOOKSECTMARKER1"),l=D("METABOOKSECTMARKER2"),m=D("METABOOKSECTMARKER3");a&&a.width?(k.style.left=(a.start-1)/g*100+"%",k.style.width=a.width/g*100+"%",k.style.display="block"):k.style.display="none";f&&f.width?(l.style.left=
(f.start-1)/g*100+"%",l.style.width=f.width/g*100+"%",l.style.display="block"):l.style.display="none";h&&h.width?(m.style.left=(h.start-1)/g*100+"%",m.style.width=h.width/g*100+"%",m.style.display="block"):m.style.display="none"}g=metaBook.UI.handlers[metaBook.ui];y.addListeners(e,g["#METABOOKLOCPCT"]);y.addListeners(d,g["#METABOOKPAGENOTEXT"]);c&&y.addListeners(c,g["#METABOOKPAGEREFTEXT"])}function b(a){for(var b=a,c,e={};b;)if(b.next){c=b.next;break}else b=b.head;if(a=d(a.frag,a.starts_at))e.start=
parseInt(a.getAttribute("data-pagenum"),10);else return!1;c&&(c=d(c.frag,c.starts_at))&&(e.end=parseInt(c.getAttribute("data-pagenum"),10));e.end||(e.end=metaBook.layout.pages.length+1);e.width=e.end-e.start;return e}function e(){var a=metaBook.layout,b=a.pages,c=0,d=b.length,e=[],f=fdjt.ID("METABOOKGOTOPAGEMAX");f&&(f.innerHTML=""+d);f=D("METABOOKPAGEBAR").offsetWidth/d;1>f&&(f=1);for(metaBook.CSS.pagespanrule?metaBook.CSS.pagespanrule.style.width=f+"px":metaBook.CSS.pagespanrule=y.addCSSRule("div.metabookpagespans > span",
"width: "+f+"px;");c<d;){var g=(f=b[c])&&f.getAttribute("data-topid"),g=g&&metaBook.docinfo[g];e.push("<span id='METABOOKPAGESPAN"+(c+1)+"' class='metabookpagespan' title='p"+(c+1)+". Hold to glimpse, tap to jump' style='left: "+c/d*100+"%"+(g&&g.level?"; z-index: 50;":"")+"'>"+(c+1)+"</span>");if(g=f.getAttribute("data-staticpageref")){var h=a.pagemap,k=fdjt.ID("METABOOKGOTOPAGEREFMAX");k&&(k.innerHTML=""+g);h||(a.pagemap=h={});a.laststaticref=g;h[g]=f}c++}a.laststaticref?P(document.body,"mbPAGEREFS"):
S(document.body,"mbPAGEREFS");a=D("METABOOKPAGESPANS");a.innerHTML=e.join("");e=F(a);b=fdjt.DOM.getInsideBounds(a);a.style[fdjt.DOM.transform]="scale("+e/b+",1)"}function l(a){if(a){if("string"===typeof a){if(metaBook.layout&&metaBook.layout.dups){var b=metaBook.layout.dups[a];return b?[N(a)].concat(b):[N(a)]}return[N(a)]}return l(a.codexbaseid||a.id)}return!1}function d(a,b){var c=a&&(a.nodeType?a:"string"===typeof a?N(a):!1),c=c&&A(c,".codexpage");if(!b||!c)return c;var d=parseInt(c.getAttribute("data-sbookloc"),
10);if(d===b)return c;var e=metaBook.layout.pages,f=e.length,g=c?parseInt(c.getAttribute("data-pagenum"),10):1;g--;for(var h=c;g<f;){var k=e[g++],d=parseInt(k.getAttribute("data-sbookloc"),10);if("number"!==typeof d)return h;if(d===b)return k;if(d>b)return h;h=k}return c}function c(a){metaBook.Paginate(a,{forced:!0})}function z(){var a=F(D("CODEXPAGE"),!1,!0),b=a.width;metaBook.layout.height===a.inner_height&&metaBook.layout.width===b||c("sync_resize")}var h=metaBook.Trace,B=fdjt.String,v=fdjt.State,
H=fdjt.Hash,G=fdjt.Time,x=fdjt.Log,y=fdjt.DOM,D=fdjt.ID,N=metaBook.ID,E=fdjt.CodexLayout,F=y.getGeometry,A=y.getParent,L=y.getChildren,O=y.hasClass,P=y.addClass,S=y.dropClass,t=y.toArray,Q=y.textWidth,aa=y.hasContent,X=B.isEmpty,C=G.secs2short,Z=v.getLocal,ja=v.setLocal,U=parseInt;metaBook.Paginate=g;E.prototype.onresize=function(){metaBook.bypage?metaBook.Paginate("resize"):fdjt.DOM.adjustFonts(metaBook.content)};metaBook.addConfig("layout",function(a,b){metaBook.page_style=b;"bypage"===b?metaBook.docinfo?
metaBook.bypage||(metaBook.bypage=!0,metaBook.postconfig?metaBook.postconfig.push(g):metaBook.Paginate("config")):metaBook.bypage=!0:(metaBook.layout?(metaBook.layout.Revert(),metaBook.layout=!1):metaBook.layout&&!metaBook.layout.done&&(metaBook.layout.timer&&(clearTimeout(metaBook.layout.timer),metaBook.layout.timer=!1),metaBook.layout.Revert(),metaBook.layout=!1),metaBook.bypage=!1,metaBook.layout&&(metaBook.layout.Revert(),metaBook.layout=!1),S(document.body,"_BYPAGE"),P(document.body,"_SCROLL"),
fdjt.DOM.adjustFonts(metaBook.content))});metaBook.addConfig("bodysize",m);metaBook.addConfig("bodyspacing",m);metaBook.addConfig("justify",m);metaBook.getLayoutID=k;metaBook.layoutCached=function(a){a?"number"===typeof a&&(a=k.apply(null,arguments)):a=k();var b=Z("metabook.layouts("+metaBook.sourceid+")",!0);return b&&0<=b.indexOf(a)};metaBook.clearLayouts=function(a){"undefined"===typeof a&&(a=metaBook.sourceid);if(a){a=Z("metabook.layouts("+metaBook.sourceid+")",!0);for(var b=0,c=a.length;b<c;){var d=
a[b++];x("Dropping layout %s",d);E.dropLayout(d)}v.dropLocal("metabook.layouts("+metaBook.sourceid+")")}else E.clearLayouts(),E.clearAll(),v.dropLocal(/^metabook.layouts\(/g)};E.getLayoutArgs=q;metaBook.sizeCodexPage=u;metaBook.scaleLayout=p;metaBook.updatePageDisplay=f;metaBook.setupPagebar=e;metaBook.getDups=l;var ka=!1;metaBook.GoToPage=function(a,b,c,d){"undefined"===typeof c&&(c=!0);metaBook.previewing&&metaBook.stopPreview("GoToPage",!1);S(document.body,"mbSHOWHELP");metaBook.clearGlossmark&&
metaBook.clearGlossmark();"addgloss"===metaBook.mode&&metaBook.setMode(!1,!1);var e=metaBook.layout&&(metaBook.layout.getPage(a)||metaBook.layout.getPage(1));if(e){var g=parseInt(e.getAttribute("data-pagenum"),10);c&&metaBook.clearStateDialog();h.flips&&x("GoToPage/%s Flipping to %o (%d) for %o",b,e,g,a);if(ka){b=ka.getAttribute("data-pagenum");b=parseInt(b,10);S(ka,/(oldpage|newpage|onleft|onright)/g);S(e,/(oldpage|newpage|onleft|onright)/g);P(e,g<b?"onleft":"onright");P(ka,"oldpage");P(e,"newpage");
var k=ka;setTimeout(function(){var a=metaBook.pages.getElementsByClassName("curpage");a.length&&S(t(a),"curpage");S(k,"curpage");P(e,"curpage");S(e,"newpage");S(e,"onright")},50);setTimeout(function(){S(k,"oldpage")},500)}else b=metaBook.pages.getElementsByClassName("curpage"),b.length&&S(t(b),"curpage"),P(e,"curpage");"number"===typeof a&&(a=(a=e.getAttribute("data-sbookloc"))&&parseInt(a,10))&&metaBook.setLocation(a);a=e.getAttribute("data-staticpageref");f(g,a,metaBook.location);ka=e;metaBook.curpage=
g;(g=N(e.getAttribute("data-lastid"))||N(e.getAttribute("data-topid")))&&metaBook.setHead(g);c&&(metaBook.point=g,metaBook.hudup||metaBook.mode||(metaBook.skimming=!1));c&&e&&(c=e.getAttribute("data-sbookloc"),a=e.getAttribute("data-pagenum"),metaBook.saveState({location:U(c,10),page:U(a,10),target:g&&(g.getAttribute("data-baseid")||g.id)},d));if(d=y.$(".glossed",e))for(c=metaBook.UI.addGlossmark,g=0,a=d.length;g<a;)c(d[g++])}};var T=!1;metaBook.startPagePreview=function(a,b){var c=a.nodeType&&A(a,
".codexpage")||metaBook.layout.getPage(a)||metaBook.layout.getPage(1);if(c){var d=parseInt(c.getAttribute("data-pagenum"),10),e=parseInt(c.getAttribute("data-sbookloc"),10);T!==c&&(T&&S(T,"previewpage"),S(L(metaBook.pages,".previewpage"),"previewpage"),(h.flips||h.gestures)&&x("startPagePreview/%s to %o (%d) for %o",b||"nocaller",c,d,a),ka&&P(ka,"hidepage"),P(c,"previewpage"),metaBook.previewing=T=c,P(document.body,"mbPREVIEW"),c=c.getAttribute("data-staticpageref"),f(d,c,e,"preview"))}};metaBook.stopPagePreview=
function(a,b){var c=parseInt(ka.getAttribute("data-pagenum"),10);(h.flips||h.gestures)&&x("stopPagePreview/%s from %o to %o (%d)",a||"nocaller",T,ka,c);var d=!1;if(T){b&&b.nodeType?(S(ka,"curpage"),S(ka,"hidepage"),P(T,"curpage"),d=O(b,"codexpage")?b:A(b,".codexpage")):b?(S(ka,"curpage"),S(ka,"hidepage"),P(T,"curpage"),d=ka):(S(T,"preview"),S(ka,"hidepage"));S(T,"previewpage");S(L(metaBook.pages,".previewpage"),"previewpage");metaBook.previewing=T=!1;S(document.body,"mbPREVIEW");S(document.body,"mbPAGEPREVIEW");
if(d){var c=parseInt(d.getAttribute("data-pagenum"),10),e=metaBook.getLocInfo(b);f(c,d.getAttribute("data-staticpageref"),e&&e.starts_at,"current")}else f(c,ka.getAttribute("data-staticpageref"),metaBook.location,"current");"number"===typeof d&&metaBook.GoToPage(d)}};metaBook.getPage=d;metaBook.refreshLayout=c;metaBook.displaySync=function(){metaBook.pagecount&&metaBook.curpage&&metaBook.GoToPage(metaBook.curpage,"displaySync",!1)};return g}();"undefined"!==typeof _metabook_suppressed&&_metabook_suppressed||(window.onload=function(a){metaBook.Setup()});metaBook.HTML.searchbox='<div class=\'query\'>\n  <input id="METABOOKSEARCHINPUT"\n         type="TEXT" class="autoprompt searchinput"\n         name="QTEXT" value="" isempty="yes" autocomplete="off"\n         onfocus="metaBook.UI.handlers.search_focus(event);"\n         onblur="metaBook.UI.handlers.search_blur(event);"\n         onkeydown="metaBook.UI.handlers.search_keydown(event);"\n         onkeyup="metaBook.UI.handlers.search_keyup(event);"\n         onkeypress="metaBook.UI.handlers.search_keypress(event);"\n         completeopts="anywhere cloud" enterchars=";" maxcomplete="45"\n         placeholder="type or tap tags or terms"\n         completions="METABOOKSEARCHCLOUD"\n         results="METABOOKSEARCHRESULTS"\n         info="METABOOKSEARCHINFO"/>\n  <img class="metabookclearsearch" alt="X" title="clear search"\n       svg="{{bmg}}metabook/redx.svgz"\n       src="{{bmg}}metabook/redx64x64.png"/>\n</div>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n\n';metaBook.HTML.addgloss='<form action="https://glosses.sbooks.net/glosses"\n      ajaxaction="https://glosses.sbooks.net/glosses"\n      method="POST" target="addgloss"\n      accept-charset="utf-8">\n  <div class="messageoverlay">\n    <div class="saving">Saving...</div>\n    <div class="saved">Saved</div>\n  </div>\n  <div class="hidden">\n    <input type="HIDDEN" name="FRAG"/>\n    <input type="HIDDEN" name="WSNID"/>\n    <input type="HIDDEN" name="REFURI"/>\n    <input type="HIDDEN" name="DOCURI"/>\n    <input type="HIDDEN" name="SYNC"/>\n    <input type="HIDDEN" name="UUID"/>\n    <input type="HIDDEN" name="TAGLINE"/>\n    <input type="HIDDEN" name="LOCATION"/>\n    <input type="HIDDEN" name="LOCLEN"/>\n    <input type="HIDDEN" name="DOCTITLE"/>\n    <input type="HIDDEN" name="MYCOPYID"/>\n    <input type="HIDDEN" name="MAKER"/>\n    <input type="HIDDEN" name="RE"/>\n    <input type="HIDDEN" name="THREAD"/>\n    <input TYPE="HIDDEN" NAME="DETAIL" VALUE=""/>\n    <input TYPE="HIDDEN" NAME="EXCERPT" VALUE=""/>\n    <input TYPE="HIDDEN" NAME="EXOFF" VALUE=""/>\n    \x3c!-- Force IE to send the form in UTF-8 --\x3e\n    <input type="HIDDEN" name="IEHACK" VALUE="&#9760;"/>\n  </div>\n  <div class="response">\n    Responding to <span class="respmaker"></span>\n    <span class="respdate"></span> <span class="respnote"></span> \n    <span class="resptags"></span> <span class="resplinks"></span>\n  </div>\n  <div class="metabookglossformbody">\n    <div class="addglossmenu" data-touchable="img">\n      <img svg="{{bmg}}metabook/upmenu.svgz"\n           src="{{bmg}}metabook/upmenu64x64.png"\n           class="button menutop" alt="upmenu"/>\n      <img svg="{{bmg}}metabook/downmenu.svgz"\n           src="{{bmg}}metabook/downmenu64x64.png"\n           class="button menutop" alt="downmenu"/>\n      <img svg="{{bmg}}metabook/holdmenu.svgz"\n           src="{{bmg}}metabook/holdmenu64x64.png"\n           class="button menutop" alt="holdmenu"/>\n      <img svg="{{bmg}}metabook/gloss_save_titled.svgz"\n           src="{{bmg}}metabook/gloss_save_titled64x64.png"\n           title="save this gloss" class="button" alt="glosspush"\n           tabindex="2"/>\n      <img svg="{{bmg}}metabook/gloss_save_titled.svgz"\n           src="{{bmg}}metabook/gloss_save_titled64x64.png"\n           title="update this gloss" class="button" alt="glossupdate"\n           tabindex="2"/>\n      <img svg="{{bmg}}metabook/gloss_tag_titled.svgz"\n           src="{{bmg}}metabook/gloss_tag_titled64x64.png"\n           title="add tags" class="button" alt="addtag"\n           tabindex="3"/>\n      <img svg="{{bmg}}metabook/gloss_attach_titled.svgz"\n           src="{{bmg}}metabook/gloss_attach_titled64x64.png"\n           title="attach files" class="button" alt="attach"\n           tabindex="4"/>\n      <img svg="{{bmg}}metabook/gloss_share_titled.svgz"\n           src="{{bmg}}metabook/gloss_share_titled64x64.png"\n           title="add outlets/share this gloss" class="button" alt="addoutlet"\n           tabindex="6"/>\n      <img svg="{{bmg}}metabook/gloss_respond_toptitle.svgz"\n           src="{{bmg}}metabook/gloss_respond_toptitle64x64.png"\n           title="respond to this gloss" class="button" alt="glossrespond"\n           tabindex="7"/>\n      <img svg="{{bmg}}metabook/gloss_delete_titled.svgz"\n           src="{{bmg}}metabook/gloss_delete_titled64x64.png"\n           title="delete gloss" class="button" alt="glossdelete"\n           tabindex="9"/>\n      <img svg="{{bmg}}metabook/gloss_cancel_titled.svgz"\n           src="{{bmg}}metabook/gloss_cancel_titled64x64.png"\n           title=" cancel gloss" class="button" alt="glosscancel"\n           tabindex="8"/>\n    </div>\n    <div class="textbox">\n      <textarea\n         name="NOTE"\n         placeholder="Use #tag or @share or to add tags or shares.  Markdown to format, Enter to save, Escape to cancel."\n         title="Add text (using markdown), using @share and #tag to add outlets and tags."\n         class="markdowninput"\n         wrap="virtual"\n         tabindex="0"></textarea>\n    </div>\n    <div class="glossetc">\n      <span class="glossexposure">\n        <span class="checkspan private" tabindex="5">\n          <input type="CHECKBOX" name="PRIVATE" value="yes"\n                 onchange="metaBook.UI.changeGlossPrivacy(event);"/>\n          <span class="checked"\n                title="this gloss won\'t be shared with my associated networks">\n            Private</span>\n          <span class="unchecked"\n                title="this gloss will be shared with my associated networks">\n            Shared</span>\n        </span>\n      </span>\n      <span class="glossdate"></span>\n      <span class="tags empty"></span>    \n      <span class="links empty"></span>\n      <span class="outlets empty"></span>\n      <span class="excerpt"></span>\n    </div>\n  </div>\n</form>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.hud='<div id="METABOOKTOPBAR">\n  <img svg="{{bmg}}metabook/tocicon.svgz"\n       src="{{bmg}}metabook/tocicon50x50.png"\n       alt="toc" title="navigate sections"\n       class="hudbutton hudmodebutton topleft"\n       id="METABOOKTOCBUTTON"\n       hudmode="statictoc"/>\n  <div id="METABOOKTOPCENTER">\n    <div id="METABOOKTOOLTAB" class="hudbutton"\n         title="Open the meta layer for navigation, search, etc.">\n      &nbsp;</div>\n    <div class="hudbutton" id="METABOOKSHOWCOVER">\n      <span class="text">Cover</span></div>\n  </div>\n  <img svg="{{bmg}}metabook/tagsearch.svgz"\n       src="{{bmg}}metabook/tagsearch50x50.png"\n       alt="search" title="search tags"\n       class="hudbutton hudmodebutton topright"\n       hudmode="search"/>\n</div>\n<div id="METABOOKHEAD">\n  <div id="METABOOKTOC" class="hudpanel"></div>\n  <div id="METABOOKSEARCH" class="searchbox hudpanel notags">\n    \x3c!-- This content comes from searchbox.html --\x3e\n  </div>\n  <div id="METABOOKNOTETEXT" class="hudpanel"\n       title="tap/click to jump to the note">\n    \x3c!-- This displays the text for a "note" --\x3e\n  </div>\n  <div id="METABOOKGLOSS" class="hudpanel">\n    <div class="editbar">\n      <span class="deletebutton">Delete</span>\n      <span class="deletebutton">Edit</span>\n      <span class="deletebutton">Reply</span>\n    </div>\n    <div id="METABOOKTARGETGLOSS">\n      \x3c!-- This is generated on demand --\x3e\n    </div>\n  </div>\n  <div id="METABOOKSOURCES" class="hudpanel metabooksources">\n    <img svg="{{bmg}}metabook/sbookspeople.svgz"\n         src="{{bmg}}metabook/sbookspeople50x50.png"\n         class="button everyone selected"\n         alt="show all" title="show all glosses"/>\n  </div>\n  <div id="METABOOKADDGLOSS" class="metabookaddgloss hudpanel">\n  </div>\n  <div class="metabookglossform" id="METABOOKADDGLOSSPROTOTYPE">\n    \x3c!-- This content comes from addgloss.html --\x3e\n  </div>\n</div>\n<div id="METABOOKSKIMMER">\n  <span class="metabookskiminfo" id="METABOOKSKIMINFO">\n    skim info</span>\n  <div id="METABOOKSKIM"></div>\n</div>\n<div id="METABOOKTOPHELPCONTENT">\n  <div id="METABOOKSLICEHELP" class="hudpanel">\n    Press to see the context, tap to start skimming\n  </div>\n  <div id="METABOOKSEETHRUHELP" class="metabookhelp helpbox">\n    <p><dfn>See Thru:</dfn>  <span class="action">Release</span> to\n      <span class="result">return to the overview</span>.\n      <span class="notouch action">Hit a key</span>\n      <span class="fortouch action">Tap anywhere else</span>\n      to <span class="result">settle</span> here.</p>\n  </div>\n  <div id="METABOOKPAGEBARHELP" class="metabookhelp helpbox">\n    <p><span class="action">Release</span> <span class="fortouch\n                                                        action">or tap the text</span>\n      to <span class="result">settle</span> here.  <span class="action\n                                                                notouch">Press any key</span> <span class="notouch">or</span>\n      <span class="notouch action">move the pointer away</span>\n      <span class="action fortouch">Move your finger away</span>\n      to <span class="result">return</span> to where you were.</p>\n  </div>\n  <div id="METABOOKPREVIEWHELP" class="helpbox">\n    <p>You\'re <em>previewing</em> a reference. <strong>Let go</strong>\n      to <em>go back</em> to the\n      reference, <strong class="fortouch">tap anywhere\n        else</strong> <strong class="notouch">tap any key</strong>\n      to <em>settle here</em>.</p>\n  </div>\n</div>\n</div>\n<div id="METABOOKHEART">\n  <div id="METABOOKRIBBON">\n    <div class="inputbox" ID="METABOOKADDTAGHOLDER">\n      <input TYPE="TEXT" NAME="TAG" VALUE=""\n             placeholder="Type or define a tag, with completion"\n             autocomplete="off"\n             ID="METABOOKADDTAGINPUT"/>\n    </div>\n    <div class="inputbox" ID="METABOOKADDSHAREHOLDER">\n      <input TYPE="TEXT" NAME="OUTLET" VALUE=""\n             placeholder="Type a group or individual name"\n             autocomplete="off"\n             ID="METABOOKADDSHAREINPUT"/>\n    </div>\n    <div class="resultinfo notags noresults" id="METABOOKSEARCHINFO">\n      <span class="noresults">No results</span>\n      <span class="noquery">Add tags to see or refine results</span>\n      <span class="stats">\n        <span class="resultcount metabookshowsearch"></span>\n        <span class="refinecount metabookrefinesearch"></span>\n        <span class="showalltags metabookexpandsearch">all<br/>tags</span>\n      </span>\n      <span id="METABOOKSEARCHTAGS" class="qtags"></span>\n    </div>\n  </div>\n  <div id="METABOOKHEARTBODY"></div>\n</div>\n<div id="METABOOKPOINTGLOSSES" class="hudpanel">\n  \x3c!-- This is populated when a glosspoint is tapped.\n       It contains the glosses for a particular passage. --\x3e\n</div>\n<div id="METABOOKHELPCONTENT">\n  <div id="METABOOKHELP" class="hudpanel metabookhelp">\n    \x3c!-- This is the help text for reading the book as a whole (it get\'s\n         displayed for help when there isn\'t an active reader mode) --\x3e\n    <div id="METABOOKAPPHELP"></div>\n  </div>\n  <div id="METABOOKHUDHELP"></div>\n  <div id="METABOOKKEYBOARDHELPBOX" class="closed">\n    <span class="keep" onclick="metaBook.keyboardHelp(true);">keep</span>\n    <span class="close" onclick="metaBook.keyboardHelp(false);">close</span>\n    <div id="METABOOKKEYBOARDHELP"></div>\n    <div class="checkspan">\n      <input TYPE="CHECKBOX" NAME="METABOOKKEYBOARDHELP" VALUE="yes"\n             CHECKED>\n      Show keyboard help\n    </div>\n  </div>\n  <div class="helphud topcenter">\n    <span class="fortouch">Tap</span><span class="notouch">Click</span>\n    at the top of the page to see the &metaBook; <em>tools</em>\n  </div>\n  <div class="helphud topleft" data-hudmode="toc">\n    <span class="nobreak"><span class="arrow">&#x2190;</span>navigate</span><br/>\n    <span class="nobreak">outline</span></div>\n  <div class="helphud topright" data-hudmode="search">\n    <span class="nobreak"><span class="arrow">&#x2192;</span>search</span><br/>\n    for&nbsp;tags\n  </div>\n  <div class="helphud leftmiddle">\n    back page\n  </div>\n  <div class="helphud rightmiddle">\n    next page\n  </div>\n</div>\n<div id="METABOOKFOOT" data-touchable="span.metabookpagespan,span.metabookpageno,span.metabookloc,img.hudbutton">\n  <div id="METABOOKSHOWTEXT">\n    <span>\n      <span class="justreading">close tools</span>\n      <span class="stopskimming">stop skimming</span>\n      <span class="cancelgloss">cancel gloss</span>\n      <span class="cancelchanges">discard changes</span>\n    </span>\n  </div>\n  <div class="helphud botcenter">\n    <span style="font-size: 200%; font-weight: bold; position: absolute; left: 2px; bottom: 2px;">\n      &#x2193;</span> this bar shows where you are in the book:\n    <span class="fortouch">tap</span><span class="notouch">click</span>\n    to jump, press to preview,\n    or <span style="white-space: nowrap;"><span class="fortouch">tap</span>\n      <span class="notouch">click</span> numbers to change them</span>\n  </div>\n  <div id="METABOOKPAGEBAR">\n    <div class="textfoot">\n      <div id="METABOOKLAYOUTADJUST">Updating layout</div>\n      <hr class="metabooklayoutindicator" id="METABOOKLAYOUTINDICATOR"/>\n      <span id="METABOOKPAGEREFTEXT" class="metabookpageno"></span>\n      <span id="METABOOKPAGENOTEXT" class="metabookpageno">p/n</span>\n      <span class="metabookloc" id="METABOOKLOCPCT">??.??%</span>\n      <div id="METABOOKGOTOLOC" class="metabookgoto">\n        <span class="gototext">\n          <input type="text" name="GOTOLOC" value="" placeholder="loc"\n                 title="Enter a percent (<= 100) or an immediate location (> 100)"\n                 id="METABOOKLOCINPUT"\n                 onkeypress="metaBook.UI.goto_keypress(event);"/>%</span>\n      </div>\n      <div id="METABOOKGOTOPAGE" class="metabookgoto">\n        <span class="gototext">\n          <input type="text" name="GOTOPAGE" value=""\n                 id="METABOOKPAGEINPUT" placeholder="page#"\n                 onkeypress="metaBook.UI.goto_keypress(event);"/>/\n          <span id="METABOOKGOTOPAGEMAX"></span></span>\n      </div>\n      <div id="METABOOKGOTOREF" class="metabookgoto">\n        <span class="gototext">\n          <input type="text" name="GOTOREF" value=""\n                 id="METABOOKREFINPUT" placeholder="pg ref#"\n                 onkeypress="metaBook.UI.goto_keypress(event);"/>/\n          <span id="METABOOKGOTOPAGEREFMAX"></span></span>\n      </div>\n    </div>\n    <div class="metabookpageprogress" id="METABOOKPAGEPROGRESS"></div>\n    <div class="metabooksectmarker" id="METABOOKSECTMARKER1"></div>\n    <div class="metabooksectmarker" id="METABOOKSECTMARKER2"></div>\n    <div class="metabooksectmarker" id="METABOOKSECTMARKER3"></div>\n    <div class="metabookpagespans" id="METABOOKPAGESPANS">\n    </div>\n  </div>\n  <img svg="{{bmg}}metabook/allglosses.svgz"\n       src="{{bmg}}metabook/allglosses50x50.png"\n       alt="allglosses" title="show all glosses"\n       class="hudbutton hudmodebutton botright"\n       id="METABOOKALLGLOSSESBUTTON"\n       hudmode="allglosses"/>\n  <img svg="{{bmg}}metabook/tagsearch.svgz"\n       src="{{bmg}}metabook/tagsearch50x50.png"\n       alt="searchresults" title="show searchresults"\n       class="hudbutton hudmodebutton botright"\n       hudmode="searchresults"/>\n  <img svg="{{bmg}}metabook/gloss_save_titled.svgz"\n       src="{{bmg}}metabook/gloss_save_titled50x50.png"\n       alt="save gloss" title="save gloss"\n       class="hudbutton botright"/>\n  <img svg="{{bmg}}metabook/help.svgz"\n       src="{{bmg}}metabook/help50x50.png"\n       alt="help" title="show contextual help"\n       class="hudbutton hudmodebutton botleft"\n       id="METABOOKHELPBUTTON"\n       hudmode="help"/>\n  <div class="helphud botright" data-hudmode="toc">\n    <span class="nobreak">browse</span><br/>\n    <span class="nobreak">glosses<span class="arrow">&#x2192;</span></span></div>\n  <div class="helphud botleft">\n    <span class="nobreak">toggle</span><br/>\n    <span class="nobreak"><span class="arrow">&#x2190;</span>help</span></div>\n</div>\n<div id="METABOOKAUDIO">\n  <audio id="METABOOKPAGEFORWARDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/pageforward.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/pageforward.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKPAGEBACKWARDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/pagebackward.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/pagebackward.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKSKIMFORWARDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/skimforward.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/skimforward.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKSKIMBACKWARDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/skimbackward.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/skimbackward.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKSKIMSTOPAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/skimstop.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/skimstop.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKTEXTSELECTAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/selecting.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/selecting.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKRAISEHUDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/raisehud.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/raisehud.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKDROPHUDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/drophud.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/drophud.ogg" type="audio/ogg"/>\n  </audio>\n  <audio id="METABOOKGLOSSEDAUDIO" volume="0.5" preload="auto">\n    <source src="{{bmg}}metabook/glossed.wav" type="audio/wave"/>\n    <source src="{{bmg}}metabook/glossed.ogg" type="audio/ogg"/>\n  </audio>\n</div>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\n    >\n';metaBook.HTML.heart='<div id="METABOOKALLGLOSSES" class="metabookslice hudpanel">\n  \x3c!-- This is filled in on startup --\x3e\n</div>\n<div id="METABOOKGLOSSDETAIL" class="hudpanel">\n  \x3c!-- This displays detail text for a gloss --\x3e\n</div>\n<div id="METABOOKASIDE" class="hudpanel">\n  \x3c!-- This displays the text for an aside --\x3e\n</div>\n<div id="METABOOKGLOSSEDITDETAIL" class="hudpanel">\n  \x3c!-- This is for editing the detail text for a gloss --\x3e\n  <textarea NAME="METABOOKDETAILTEXT" class="markdowninput"\n            ID="METABOOKDETAILTEXT">\n  </textarea>\n</div>\n<div id="METABOOKGLOSSATTACH" class="hudpanel">\n  <form id="METABOOKATTACHFORM" target="METABOOKGLOSSCOMM"\n\tmethod="POST" enctype="multipart/form-data" accept-charset="utf-8"\n        action="https://glosses.sbooks.net/1/attach"\n        class="link">\n    <table class="fdjtform"\n           onclick="fdjt.UI.CheckSpan.onclick(event);">\n      <input TYPE="HIDDEN" NAME="GLOSSID" VALUE="" id="METABOOKUPLOADGLOSSID"/>\n      <input TYPE="HIDDEN" NAME="ITEMID" VALUE="" id="METABOOKUPLOADITEMID"/>\n      <tr class="attachtype">\n        <th class="headcell">\n          Attach<img src="{{bmg}}metabook/gloss_attach.svgz"/></th>\n        <td>\n          <button id="METABOOKATTACHDELETE" NAME="ATTACH" VALUE="DELETE">\n            Delete</button>\n          <span class="checkspan ischecked"\n                title="Attach a link to this gloss">\n            <input type="RADIO" NAME="ATTACHTYPE" VALUE="link"\n                   onchange="metaBook.UI.changeAttachment(event);"\n                   CHECKED/>\n            Link</span>\n          <span class="checkspan"\n                title="Upload a file and attach it to this gloss">\n            <input type="RADIO" NAME="ATTACHTYPE" VALUE="upload"\n                   onchange="metaBook.UI.changeAttachment(event);"/>\n            File</span>\n          <span class="checkspan"\n                title="Create or edit a \'body\' for this gloss">\n            <input type="RADIO" NAME="ATTACHTYPE" VALUE="body"\n                   onchange="metaBook.UI.changeAttachment(event);"/>\n            Body</span>\n          <span class="checkspan disabled"\n                title="Attach audio or video recorded on this device">\n            <input type="RADIO" NAME="ATTACHTYPE" VALUE="capture"\n                   onchange="metaBook.UI.changeAttachment(event);"\n                   disabled="DISABLED"/>\n            Capture</span>\n        </td>\n        <th class="button">\n          <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="LINK">\n            Link</button>\n          <button id="METABOOKUPLOADOK" NAME="ATTACH" VALUE="UPLOAD">\n            Save</button>\n          <button id="METABOOKUPLOADOK" NAME="ATTACH" VALUE="SAVE">\n            Save</button>\n          <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="BODY">\n            Save</button>\n          <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="DONE">\n            Done</button>\n          <button id="METABOOKATTACHCANCEL" VALUE="CANCEL">\n            Cancel</button></th>\n      </tr>\n      <tr class="title">\n        <th>Label</th>\n        <td colspan="2">\n          <INPUT TYPE="TEXT" NAME="TITLE" VALUE="" ID="METABOOKATTACHTITLE"\n                 placeholder="a descriptive label"/></tr>\n      <tr class="checkspan uploadrights"\n          id="METABOOKUPLOADRIGHTS">\n        <th><input TYPE="CHECKBOX" NAME="FILEOKAY" VALUE="yes"/></th>\n        <td colspan="2">\n          I affirm that I have the right to use and share this\n          content according to the &sBooks;\n          <a href="https://www.sbooks.net/legalia/TOS/" target="_blank">\n            Terms of Service</a>.</td>\n      </tr>\n      <tr class="url">\n        <th>URL</th>\n        <td colspan="2">\n          <input TYPE="TEXT" NAME="URL" VALUE=""\n                 ID="METABOOKATTACHURL" class="fdjturlinput"\n                 placeholder="a URL to attach"/>\n        </td>\n      </tr>\n      <tr class="uploadfile">\n        <th>Upload<input TYPE="FILE" NAME="UPLOAD" ID="METABOOKFILEINPUT"/></th>\n        <td id="METABOOKATTACHFILE" class="nofile" colspan="2">\n          <span class="mbdragmessage">Drag a file here or click to browse</span>\n          <span class="mbmessage">Tap to find files or media</span>\n          <span class="mbfilename" id="METABOOKATTACHFILENAME"></span>\n        </td></tr>\n      <tbody class="glossbody" id="METABOOKGLOSSBODY">\n        <tr>\n          <td colspan="3">\n            <textarea NAME="BODYTEXT" ID="METABOOKGLOSSBODYTEXT"></textarea>\n        </td></tr>\n      </tbody>\n    </table>\n  </form>\n</div>\n<div id="METABOOKGLOSSATTACH" class="hudpanel"></div>\n<div id="METABOOKSEARCHCLOUD" class="completions cloud searchcloud"></div>\n<div id="METABOOKALLTAGS" class="completions searchcloud cloud noinput">\n</div>\n<div id="METABOOKSEARCHRESULTS" class="metabookslice hudpanel"></div>\n<div id="METABOOKSHARECLOUD" class="hudpanel completions cloud showall"></div>\n<div id="METABOOKGLOSSCLOUD" class="hudpanel completions cloud showall">\n  <div class="nomatchmsg">(no matches)</div>\n</div>\n<div class="tabcontent flyleaftab hudpanel" id="METABOOKSTATICTOC"></div>\n<iframe name="METABOOKGLOSSCOMM" id="METABOOKGLOSSCOMM"\n        frameborder="0" scrolling="auto"\n        class="hudpanel tabcontent"></iframe>\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.attach='<form id="METABOOKATTACHFORM" target="METABOOKGLOSSCOMM"\n      method="POST" enctype="multipart/form-data" accept-charset="utf-8"\n      action="https://glosses.sbooks.net/1/attach"\n      class="link">\n  <table class="fdjtform"\n         onclick="fdjt.UI.CheckSpan.onclick(event);">\n    <input TYPE="HIDDEN" NAME="GLOSSID" VALUE="" id="METABOOKUPLOADGLOSSID"/>\n    <input TYPE="HIDDEN" NAME="ITEMID" VALUE="" id="METABOOKUPLOADITEMID"/>\n    <tr class="attachtype">\n      <th class="headcell">\n        Attach<img src="{{bmg}}metabook/gloss_attach.svgz"/></th>\n      <td>\n        <button id="METABOOKATTACHDELETE" NAME="ATTACH" VALUE="DELETE">\n          Delete</button>\n        <span class="checkspan ischecked"\n              title="Attach a link to this gloss">\n          <input type="RADIO" NAME="ATTACHTYPE" VALUE="link"\n                 onchange="metaBook.UI.changeAttachment(event);"\n                 CHECKED/>\n          Link</span>\n        <span class="checkspan"\n              title="Upload a file and attach it to this gloss">\n          <input type="RADIO" NAME="ATTACHTYPE" VALUE="upload"\n                 onchange="metaBook.UI.changeAttachment(event);"/>\n          File</span>\n        <span class="checkspan"\n              title="Create or edit a \'body\' for this gloss">\n          <input type="RADIO" NAME="ATTACHTYPE" VALUE="body"\n                 onchange="metaBook.UI.changeAttachment(event);"/>\n          Body</span>\n        <span class="checkspan disabled"\n              title="Attach audio or video recorded on this device">\n          <input type="RADIO" NAME="ATTACHTYPE" VALUE="capture"\n                 onchange="metaBook.UI.changeAttachment(event);"\n                 disabled="DISABLED"/>\n          Capture</span>\n      </td>\n      <th class="button">\n        <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="LINK">\n          Link</button>\n        <button id="METABOOKUPLOADOK" NAME="ATTACH" VALUE="UPLOAD">\n          Save</button>\n        <button id="METABOOKUPLOADOK" NAME="ATTACH" VALUE="SAVE">\n          Save</button>\n        <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="BODY">\n          Save</button>\n        <button id="METABOOKATTACHLINK" NAME="ATTACH" VALUE="DONE">\n          Done</button>\n        <button id="METABOOKATTACHCANCEL" VALUE="CANCEL">\n          Cancel</button></th>\n    </tr>\n    <tr class="title">\n      <th>Label</th>\n      <td colspan="2">\n        <INPUT TYPE="TEXT" NAME="TITLE" VALUE="" ID="METABOOKATTACHTITLE"\n               placeholder="a descriptive label"/></tr>\n    <tr class="checkspan uploadrights"\n        id="METABOOKUPLOADRIGHTS">\n      <th><input TYPE="CHECKBOX" NAME="FILEOKAY" VALUE="yes"/></th>\n      <td colspan="2">\n        I affirm that I have the right to use and share this\n        content according to the &sBooks;\n        <a href="https://www.sbooks.net/legalia/TOS/" target="_blank">\n          Terms of Service</a>.</td>\n    </tr>\n    <tr class="url">\n      <th>URL</th>\n      <td colspan="2">\n        <input TYPE="TEXT" NAME="URL" VALUE=""\n               ID="METABOOKATTACHURL" class="fdjturlinput"\n               placeholder="a URL to attach"/>\n      </td>\n    </tr>\n    <tr class="uploadfile">\n      <th>Upload<input TYPE="FILE" NAME="UPLOAD" ID="METABOOKFILEINPUT"/></th>\n      <td id="METABOOKATTACHFILE" class="nofile" colspan="2">\n        <span class="mbdragmessage">Drag a file here or click to browse</span>\n        <span class="mbmessage">Tap to find files or media</span>\n        <span class="mbfilename" id="METABOOKATTACHFILENAME"></span>\n    </td></tr>\n    <tbody class="glossbody" id="METABOOKGLOSSBODY">\n      <tr>\n        <td colspan="3">\n          <textarea NAME="BODYTEXT" ID="METABOOKGLOSSBODYTEXT"></textarea>\n      </td></tr>\n    </tbody>\n  </table>\n</form>\n';metaBook.HTML.help='<h1><span class="metabooktogglehelp">Ok</span>Using &metaBook;</h1>\n\n<p><img src="{{bmg}}metabook/browser_edges.svgz" alt="top of browser" class="svg floatright"/>\n  <img src="{{bmg}}metabook/browser_edges32x32.png" alt="top of browser" class="nosvg floatright"/>\n  <strong>Move by pages</strong> <span class="fortouch">by swiping left or right</span>\n  <span class="notouch">using the Space or Backspace keys</span> or\n  <span class="fortouch">tapping</span> <span class="notouch">clicking</span>\n  on the left or right of the page.</p>\n<p><img src="{{bmg}}metabook/browser_corners.svgz" alt="top of browser" class="svg floatright"/>\n  <img src="{{bmg}}metabook/browser_corners32x32.png" alt="top of browser" class="nosvg floatright"/>\n  <strong>Open the <dfn>book tools</dfn></strong> by\n  <span class="fortouch">tapping</span>\n  <span class="notouch">clicking</span> at the top of the\n  page.  <strong>Navigate, search, or skim</strong> using the icons\n  in the corners of the page.</p>\n<p><strong>Show this and other help</strong> by\n  <span class="fortouch">tapping</span><span class="notouch">clicking</span>\n  the <img src="{{bmg}}metabook/help.svgz" alt="top of browser"\n           class="svg inline"/> <img src="{{bmg}}metabook/help50x50.png"\n                                     alt="top of browser" class="nosvg inline"/> icon in the lower left\n  corner of the page.</p>\n<p><strong>Mark up your book</strong> by pressing and holding or\n  double <span class="fortouch">tapping</span>\n  <span class="notouch">clicking</span> on the\ncontent.  <strong>Enter notes, tags, links, etc</strong> in\nthe <dfn>gloss box</dfn> at the top of the\npage. <strong>Drag <span class="fortouch">your finger</span>\n  <span class="notouch">the pointer</span></strong> to highlight an\nexcerpt.</p>\n<p style="text-indent: 0px;">\n  <span class="glossbarbox">\u00a0</span>\n  <strong>Blue <dfn>gloss bars</dfn></strong> in the right margin\n  indicate glosses already overlaid on your\n  book.  <strong><span class="fortouch">Tap or drag\n      left</span> <span class="notouch">Click to the left</span></strong>\n  of the blue bar to see associated notes, tags, links, etc.</p>\n\n<p class="tightbottom">\n  <img src="{{bmg}}metabook/docs/pagebar_zoom.png" class="floatright"/>\n  <strong>Browse the book</strong> using the <dfn>pagebar</dfn> along\n  the bottom.  The dark blue line show the current location with\n  lighter regions around for the current section and its parent.\n  <img src="{{bmg}}metabook/docs/pagebar_wide.png" class="wideimage"/>\n  <img src="{{bmg}}metabook/docs/pagebar_wide.png"\n  class="narrowimage"/><br/>\n  <span class="subpara">\n    <span class="fortouch">Tap</span><span class="notouch">Click</span>\n    the page number (in the middle) or percentage (on the right) to move\n    precisely.  Press and hold the pagebar to see a particular page,\n    moving <span class="fortouch">your\n      finger</span> <span class="notouch">the pointer</span> to skim\n    through pages.  <span class="notouch">Release</span>\n    <span class="fortouch">Lift your finger</span> to settle where you\n    are or <span class="fortouch">move\n      it</span> <span class="notouch">drag the mouse</span> out of the\n    pagebar to return to where you were.</span></p>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.hudhelp='<div id="METABOOKTOCHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Navigating your &sBook;</h2>\n  <p>The <strong>outline overleaf</strong> at the top of the page\n    shows a partial map of your book centered on the current location.\n    You can use it to browse or navigate the book.\n    The <span style="color: blue;">blue regions</span> indicate your\n    current location.</p>\n  <p><strong class="fortouch">Tapping</strong>\n    <strong class="notouch">Clicking</strong> on the map jumps to the\n    corresponding location in the book;</p>\n  <p><strong>Pressing or holding</strong> lets you glimpse the\n    location without actually jumping there.</p>\n  <p><strong>Layout stripes</strong> <img class="screenshot right"\n    src="{{bmg}}metabook/tocstripe_screenshot.png"/>\n    display the arrangement and sizes of divisions at a particular\n    level in the book.  The segment for the current section is light\n    blue and contains a red bar indicating your relative position.</p>\n  <p><strong>Subsection clouds</strong> appear when you\'re at the\n    beginning of a section which has its own subsections.  It consists\n    of a layout stripe for all of its subsections together with a\n    cloud of subsection names.\n    <span class="fortouch">Tapping</span><span class="notouch">Clicking</span>\n    a name or segment jumps to that subsection.\n    <span class="fortouch">Pressing</span><span class="notouch">Clicking</span>\n    and holding a name shows the corresponding segment;\n    <span class="fortouch">Tapping</span><span class="notouch">Clicking</span>\n    the segment lets you glimpse the start of that section.</p>\n</div>\n<div id="METABOOKADDGLOSSHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Add your own gloss to this passage</h2>\n  <blockquote>\n    <p><img svg="{{bmg}}metabook/remark.svgz"\n            src="{{bmg}}metabook/remark64x64.png"\n            class="inline" alt="the balloon icon"/>\n      Type your comments, ending with <kbd>Enter</kbd> and using\n      <kbd>Shift-Enter</kbd> to insert a newline.</p>\n    <p><img svg="{{bmg}}metabook/diaglink.svgz"\n            src="{{bmg}}metabook/diaglink64x64.png"\n            class="inline" alt="the link icon"/>\n      <strong>Add links</strong>\n      as <strong>[@</strong><em><tt>uri</tt></em>\n      <em>title</em><strong>]</strong>,\n      e.g. <strong>[@</strong><tt>http://www.whitehouse.gov/</tt>\n      The White House<strong>]</strong>.</p>\n    <p><img svg="{{bmg}}metabook/tagicon.svgz"\n            src="{{bmg}}metabook/tagicon64x64.png"\n            class="inline" alt="the tag icon"/>\n      <strong>Add tags</strong> by typing in the tags field, enclosing\n      note text in <strong>[</strong>brackets<strong>]</strong>\n      or <span class="fortouch">tapping</span><span class="notouch">clicking</span>\n      <span class="tag">suggested tag</span>s in the <em>cloud</em>.</p>\n    <p><img svg="{{bmg}}metabook/tagicon.svgz"\n            src="{{bmg}}metabook/tagicon64x64.png"\n            class="inline" alt="the tag icon"/>\n      Specify <strong>synonyms</strong> for your tags (e.g.\n      <span class="tagsample"><strong>[</strong>airplane|plane|aircraft<strong>]</strong></span>)\n      or describe <strong>relations</strong>\n      (e.g. <span class="tagsample">\n        <strong>[</strong>sloop|^sailboat|^boat<strong>]</strong></span>)\n      to make your tags <strong>more useful</strong> for browsing\n      and search by yourself or others.</p>\n</blockauote>\n</div>\n<div id="METABOOKTOCSKIMHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Skimming by Sections</h2>\n  <blockquote>\n    <p>The <strong>overleaf</strong> at the top of the page shows the\n      <strong>current section</strong> with the arrangement and sizes of\n      its surrounding sections.</p>\n    <p><strong class="notouch">Clicking</strong>\n      <strong class="fortouch">Tapping</strong> on a segment jumps to\n      the beginning of that section.  <strong class="notouch">Holding\n      the mouse button down\n      over</strong><strong class="fortouch">Pressing on</strong> a\n      segment shows you a preview of the section without going\n      there.  <strong>Releasing</strong> jumps to the section\n      and <strong class="fortouch">tapping the tablet\n      edges</strong><strong class="notouch">tapping a key</strong> brings\n      you back.</p>\n\n    <p><strong class=\'fortouch\'>Tap</strong>\n      <strong class=\'notouch\'>Click</strong> the\n      <img svg="{{bmg}}metabook/skim_left.svgz"\n           src="{{bmg}}metabook/skim_left100x100.png"\n           class="inline"/>\n      <img svg="{{bmg}}metabook/skim_right.svgz"\n           src="{{bmg}}metabook/skim_right100x100.png"\n           class="inline"/>\n      buttons to move forward or back by sections at the current level.\n      <span class="notouch"><strong>Shift-clicking</strong> (holding the\n        shift key while clicking) in the right or left margin moves\n        forward or backward by section at the current level.</span>\n      <span class="fortouch"><strong>Swiping</strong> with <strong>two\n          fingers</strong> advances by sections at the current level, as\n        does double-tapping the left or right edge.</span>\n    </p>\n  </blockquote>\n</div>\n<div id="METABOOKSKIMMINGHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Skimming Glosses or Results</h2>\n  <blockquote>\n    <p>You\'re now <strong>skimming</strong> through your book based on\n      a list of glosses or search results.  The current gloss or\n      search result is shown in the <strong>overleaf</strong> at the\n      top of the page.</p>\n    <p><span class="fortouch">Tap</span>\n      <span class="notouch">Click on</span>\n      the <strong>overleaf</strong> to expand it;\n      <span class="fortouch">Tap</span>\n      <span class="notouch">Click on</span>\n      the <strong>content</strong> to stop\n      skimming.  <span class="fortouch"><em>Press and hold</em> the\n      overleaf to return to the list of results or glosses.</p>\n    <p>The <img svg="{{bmg}}metabook/skim_left.svgz"\n        src="{{bmg}}metabook/skim_left100x100.png" class="inline"/> double\n        arrows <img svg="{{bmg}}metabook/skim_right.svgz"\n        src="{{bmg}}metabook/skim_right100x100.png" class="inline"/>\n        and <span class="fortouch"><strong>swiping\n        horizontally</strong> (right or\n        left)</span> <strong class="notouch">the left and right arrow\n        keys</strong> move forward or back through the glosses or\n        search results.</p>\n    <p>The <em>top line</em> of the overleaf shows the location of the\n      result in the book overall, both in the outline (the text\n      links), in content as a whole (the gold-edged span), and the\n      list of results or glosses (the number on the\n      right).  <span class="fortouch">Tapping</span>\n      <span class="notouch">Clicking</span> on the top line returns\n      to the results/gloss list.</p>\n  </blockquote>\n</div>\n<div id="METABOOKGOTOPAGEHELP" class="helpbox atfoot">\n  <p>Enter a page number at the top of the page to jump directly to that\n  page.<br/> Use the escape key or <strong class="fortouch">tap</strong>\n  <strong class="notouch">click</strong> at the bottom of the page to\n  cancel.</p>\n</div>\n<div id="METABOOKGOTOREFHELP" class="helpbox atfoot">\n  <p>Enter a reference page number (from the reference version of the\n  book) at the top of the page to jump to that part of the book.<br/>\n  Use the escape key or <strong class="fortouch">tap</strong>\n  <strong class="notouch">click</strong> at the bottom of the page to\n  cancel.</p>\n</div>\n<div id="METABOOKGOTOLOCHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Got to a specific location</h2>\n  <p>Enter a numeric percentage (in the field at the top of the page)\n  to jump directly to that point within the book.<br/>  These\n  percentages will remain stable even as page layout or font size\n  changes.  Use the escape key\n  or <strong class="fortouch">tap</strong>\n  <strong class="notouch">click</strong> at the bottom of the page to\n  cancel and return to the text.</p>\n</div>\n<div id="METABOOKSEARCHINPUTHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Searching your sBook</h2>\n  <p>You are searching for passages or glosses within your book, using\n    either semantic <span class="dterm">tags</span>\n    or literal <span class="rawterm">terms</span>.  As you type or edit in\n    the search box, the cloud of tags and phrases will grow or shrink\n    to display matching phrases, tags, or synonyms of tags.</p>\n  <p><strong class="fortouch">Tapping</strong>\n    <strong class="notouch">Clicking</strong>\n    <em>adds a term or tag</em> to the current search, generating\n    both results and an updated cloud of terms and tags.  Tags may\n    be related to other tags (for\n    example, <span class="dterm">dachshund</span>\n    to <span class="dterm">dog</span>) and those relationships are\n    used in your search.</p>\n  <p>Once you have specified <em>at least one tag or term</em>, you\n    can see the matching results by\n    either <span class="fortouch">tapping</span>\n    <span class="notouch">clicking</span> on the result count or\n    using the <kbd>Enter</kbd> key in an empty input box.  If there\n    are few enough results, it will switch to them automatically.</p>\n</div>\n<div id="METABOOKSEARCHRESULTSHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Browsing search results</h2>\n  <blockquote>\n    <p>These are the <em>results of your search</em>, ordered by\n      relevance and position within the book.  You can return to\n      the <strong>tag/phrase cloud</strong>\n      by <span class="fortouch">tapping</span>\n      <span class="notouch">clicking</span> in the text box or on the\n      \u201c<em>DDD co-tags</em>\u201d beneath it.</p>\n    <p><strong class="fortouch">Tap</strong>\n      <strong class="notouch">Click</strong> a result to jump to that\n      part of the book and begin <strong>skimming</strong> the book\n      based on the results.  When skimming, you can use the\n      double-arrow buttons on the edges to move through the results\n      (you can also use <span class="fortouch">two-fingered\n      swipes</span>\n      <span class="notouch">your keyboard\'s arrow keys</span>).\n    </p>\n    <p><strong class="notouch">Holding the mouse button down\n        on</strong><strong class="fortouch">Pressing and holding\n        </strong> a result shows you a glimpse of the result\'s context\n        without leaving the list of results.</p>\n  </blockquote>\n</div>\n<div id="METABOOKALLGLOSSESHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Browsing all glosses</h2>\n  <blockquote>\n    <p>These are <strong>all of the glosses</strong> applied to your\n      copy of this book, displayed as a series of <strong>cards</strong>\n      in the center of the browser page.</p>\n    <p><strong>The pictures or icons at the top of the browser\n      page</strong> show the <em>creators or layers</em> where they\n      originate; <span class="fortouch">tap</span>\n      <span class="notouch">click</span> an icon to see only the\n      glosses added by a particular person or shared thorough a\n      particular layer.  <span class="notouch">Using\n      the <kbd>Shift</kbd> key adds that individual or layer to the\n      displayed list.</span>\n      <span class="fortouch">Tap</span>\n      <span class="notouch">Click</span> again to clear your\n      selection.\n    </p>\n    <p><strong class="fortouch">Tap</strong>\n      <strong class="notouch">Click</strong> a card to jump to the\n      location where the gloss is applied; you\n      can <strong>skim</strong> through the book based on the selected\n      glosses.  When skimming, you can use the double-arrow buttons on\n      the edges to move through the glosses (you can also\n      use <span class="fortouch">two-fingered swipes</span>\n      your keyboard\'s arrow keys</span>).\n    </p>\n    <p><strong class="notouch">Holding the mouse button down\n        on</strong><strong class="fortouch">Pressing and holding\n        </strong> a card will show you a glimpse of the gloss\'\n        context without actually leaving the list of glosses.</p>\n\n  </blockquote>\n</div>\n<div id="METABOOKSTATICTOCHELP" class="helpbox atfoot">\n  <h2><span class="metabooktogglehelp">Ok</span>\n    Browsing the outline</h2>\n  <p>The <strong>table of contents</strong> provides a visually\n    annotated hierarchical map of your book.  Red lines indicate your\n    current reading location and the blue bars indicate the size and\n    relative position of a subsection within its section.</p>\n  <p><span class="action fortouch">Touch</span><span class="notouch\n      action"> Click</span> a section to <span class="result">go\n      there</span>; <span class="action\n      fortouch">Press and hold</span><span class="notouch action">Click and hold</span>\n    to see the beginning of the section without actually going there.</p>\n</div>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.console='<h1>metaBook Console</h1>\n<div class=\'message\' id=\'METABOOKCONSOLEMESSAGE\'></div>\n<div id="METABOOKCONSOLELOG" class=\'sbookmessagelog\'></div>\n<div id="METABOOKCONSOLEINPUT">\n  <span class="button" id="METABOOKCONSOLEBUTTON">run</span>\n  <textarea id="METABOOKCONSOLETEXTINPUT">\n  </textarea>\n</div>\n\n\x3c!--\n/* Emacs local variables\n;;;  Local variables: ***\n;;;  compile-command: "cd ../..; make" ***\n;;;  indent-tabs-mode: nil ***\n;;;  End: ***\n*/\n--\x3e\n\n';metaBook.HTML.messages='<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPSCAN">\n  <div class="indicator"></div>\n  <div class="message">\n    Scanning the book content for structure and metadata.</div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPTOC">\n  <div class="indicator"></div>\n  <div class="message">\n    Setting up tables of content for book navigation.</div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPKNO">\n  <div class="indicator"></div>\n  <div class="message">\n    Processing embedded or referenced knowledge bases.\n    <div id="METABOOKSTARTUPKNODETAILS"></div>\n  </div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPTAGGING">\n  <div class="indicator"></div>\n  <div class="message">Indexing with published tags.</div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKSTARTUPCLOUDS">\n  <div class="indicator"></div>\n  <div class="message">Setting up tag clouds for search and glossing.</div>\n</div>\n</div>\n<div class="startupmessage fdjtprogress" id="METABOOKNEWGLOSSES">\n  <div class="indicator"></div>\n  <div class="message">Applying your glosses to your book.</div>\n</div>\n\x3c!--\n     /* Emacs local variables\n     ;;;  Local variables: ***\n     ;;;  compile-command: "cd ../..; make" ***\n     ;;;  End: ***\n     */\n  --\x3e\n\n';metaBook.HTML.cover='<div id="METABOOKCOVERMESSAGE" class="controls">\n  <div id="METABOOKOPENTAB"\n       style="width: 7em; margin-left: auto; margin-right: auto; color: white; background-color: gray; margin-top: 0.2ex; padding:  0px 1em 0px 1em; border: solid transparent 2px; font-variant: small-caps; border-radius: 1ex; box-sizing: border-box;">\n    Open</div>\n  <div id="METABOOKREADYMESSAGE"\n       style="width: 7em; margin-left: auto; margin-right: auto; color: white; background-color: gray; margin-top: 0.2ex; padding:  0px 1em 0px 1em; border: solid transparent 2px; font-variant: small-caps; border-radius: 1ex; box-sizing: border-box;">\n    Loading\n  </div>\n  <div id="METABOOKBUSYMESSAGE"\n       style="width: 7em; margin-left: auto; margin-right: auto; color: white; background-color: gray; margin-top: 0.7ex; padding:  0px 1em 0px 1em; border: solid transparent 2px; font-variant: small-caps; border-radius: 1ex; box-sizing: border-box;">\n    Busy\n  </div>\n  <div class="metabookstatus" id="METABOOKLAYOUTMESSAGE">\n    <div class="metabookprogressbox"><div class="indicator"></div></div>\n    <div class="message" style="font-size: 24px; font-size: 5vmin;"></div>\n  </div>\n  <div class="metabookstatus" id="METABOOKINDEXMESSAGE">\n    <div class="metabookprogressbox"><div class="indicator"></div></div>\n    <div class="message" style="font-size: 24px; font-size: 5vmin;"></div>\n  </div>\n  <div class="metabookstatus" id="METABOOKGLOSSMESSAGE">\n    <div class="metabookprogressbox"><div class="indicator"></div></div>\n    <div class="message" style="font-size: 24px; font-size: 5vmin;"></div>\n  </div>\n</div>\n<div id="METABOOKCOVERPAGE"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto; overflow: hidden;">\n  <img src="{{coverimage|}}" alt="{{covertext|}}"\n       style="max-width: 95%; width: auto; height: 90%;"\n       id="METABOOKCOVERIMAGE"/>\n</div>\n<div id="METABOOKTITLEPAGE" class="metabooktitlepage"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto; overflow: hidden;">\n</div>\n<div id="METABOOKCREDITSPAGE"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto; overflow: hidden;">\n</div>\n<div id="METABOOKBLURB" class="scrolling"\n     style="position: absolute; top: 50px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n</div>\n<div id="METABOOKAPPHELP" class="metabookhelp scrolling"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n  <h1><span class="adjustfont">Welcome to &metaBook;,\n      the &sBooks; e-reader</span></h1>\n  \n  <p>You\'re using &metaBook;, a web-based e-reader created to deepen\n    reading and engagement while connecting to networks of knowledge,\n    conversation, and commmunity.  &metaBook; aims to reclaim the\n    virtues of physical books for electronic books, making them\n    natural to navigate, annotate, search, and personalize.</p>\n  <div id="METABOOKCOVERHELP"></div>\n</div>\n<div id="METABOOKSETTINGS" class="scrolling"\n     style="position: absolute; top: 50px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n</div>\n<div id="METABOOKCONSOLE" class="scrolling"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n</div>\n<div id="METABOOKLAYERS" class="scrolling"\n     style="position: absolute; top: 75px; left: 50px; right: 50px; width: auto; bottom: 100px; height: auto;">\n  <iframe name="SBOOKSAPP" id="SBOOKSAPP" frameborder="0" scrolling="auto"></iframe>\n</div>\n<div id="METABOOKCOVERCONTROLS"\n     style="position: absolute; bottom: 40px; left: 50px; right: 50px; width: auto; height: 60px; top: auto; font-size: 0.8em; font-size: 1.5rem; font-size: 3vw;">\n  <span class="control" data-mode="coverpage" title="see the cover"\n        tabindex="1">\n    Cover</span>\n  <span class="control" data-mode="titlepage"\n        title="this book\'s title page and other information"\n        tabindex="2">\n    Title</span>\n  <span class="control" data-mode="creditspage"\n        title="Credits to people and organizations contributing to this book, including bibliographic information"\n        tabindex="3">\n    Credits</span>\n  <span class="control" data-mode="blurb"\n        title="learn more about this book and its background"\n        tabindex="4">\n    About</span>\n  <span class="control" data-mode="layers"\n        title="manage added layers of glosses for your sBook"\n        tabindex="5">\n    Layers</span>\n  <span class="control" data-mode="console"\n        title="the debugging console (advanced)"\n        tabindex="6">\n    Console</span>\n  <span class="control" data-mode="settings"\n        title="alter this e-reader\'s appearance and interactions"\n        tabindex="7">\n    Settings</span>\n  <span class="control" data-mode="help"\n        title="simple help for using metaBook"\n        tabindex="8">\n    Help</span>\n</div>\n<div class="userbox controls"\n     data-maxfont="120%" id="METABOOKUSERBOX">\n  <span class="bookplate">\n    <span class="text">This</span>\n    <a class="sbooks" href="https://www.sbooks.net/" target="_blank"\n       title="Learn more about sBooks" tabindex="9">\n      <em>s</em>Book</a>\n    <a class="sbookslogo" href="https://www.sbooks.net/" target="_blank"\n       title="Learn more about sBooks" tabindex="9">\n      <em>s</em>Books</a>\n    <span class="text">is personalized for</span>\n    <a href="https://admin.sbooks.net/account/" class="metabookusername"\n       title="Edit your profile, add social networks, etc"\n       target="_blank" tabindex="10">\n      you</a></span>\n</div>\n<div class="loginbox controls" data-maxfont="120%" id="METABOOKLOGINBOX">\n  <div class="loginmessage">\n    Login to &sBooks; to read smarter</div>\n  <form action="https://auth.sbooks.net/auth" method="POST">\n    <input TYPE="HIDDEN" NAME="FRESHLOGIN" VALUE="yes"/>\n    <input TYPE="HIDDEN" NAME="LOGINFORM" VALUE="yes"/>\n    <input TYPE="TEXT" NAME="LOGIN" VALUE=""\n           PLACEHOLDER="email/cell login"\n           ONKEYPRESS="fdjt.UI.submitOnEnter(event);"\n           AUTOCOMPLETE="off"\n           tabindex="9"/>\n    <span>or use</span>\n    <select NAME="AUTHORITY">\n      <option value="" selected="SELECTED">Using account</option>\n      <option value=":FACEBOOK">Facebook</option>\n      <option value=":TWITTER">Twitter</option>\n      <option value=":YAHOO">Yahoo!</option>\n      <option value=":GOOGLE">Google</option>\n      <option value=":GPLUS">Google+</option>\n      <option value=":LINKEDIN">Linked In</option>\n      <option value=":AMAZON">Amazon</option>\n      <option value=":PAYPAL">PayPal</option>\n    </select>\n    <button name="AUTHORITY" TABINDEX="11"\n            value=":FACEBOOK">\n      <img src="{{bmg}}metabook/facebook64x64.png" class="nosvg"\n           alt="Facebook" class="noautoscale"/>\n      <img src="{{bmg}}metabook/facebook.svgz" class="svg"\n           alt="Facebook" class="noautoscale"/>\n    </button>\n    <button NAME="AUTHORITY" TABINDEX="12"\n            VALUE=":TWITTER">\n      <img src="{{bmg}}metabook/twitter64x64.png"\n           alt="Twitter" title="login with Twitter"\n           class="nosvg"/>\n      <img src="{{bmg}}metabook/twitter.svgz"\n           alt="Twitter" title="login with Twitter"\n           class="svg"/>\n    </button>\n    <button NAME="AUTHORITY" TABINDEX="13"\n            VALUE="https://open.login.yahooapis.com/openid/op/auth">\n      <img src="{{bmg}}metabook/yahoo64x64.png" class="nosvg"\n           alt="Yahoo!" title="login using Yahoo!"/>\n      <img src="{{bmg}}metabook/yahoo.svgz" class="svg"\n           alt="Yahoo!" title="login using Yahoo!"/>\n    </button>\n    <button NAME="AUTHORITY" TABINDEX="14"\n            VALUE=":GOOGLE">\n      <img src="{{bmg}}metabook/google64x64.png"\n           alt="Google" title="login using your Google account"\n           class="nosvg"/>\n      <img src="{{bmg}}metabook/google.svgz"\n           alt="Google" title="login using your Google account"\n           class="svg"/>\n    </button>\n    <button NAME="AUTHORITY" TABINDEX="15"\n            VALUE=":GPLUS">\n      <img src="{{bmg}}metabook/googleplus64x64.png"\n           alt="Google" title="login using Google+"\n           class="nosvg"/>\n      <img src="{{bmg}}metabook/googleplus.svgz"\n           alt="Google" title="login using Google+"\n           class="svg"/>\n    </button>\n    <button NAME="AUTHORITY" VALUE=":LINKEDIN" TABINDEX="16">\n      <img src="{{bmg}}metabook/linkedin64x64.png"\n           alt="Linked In" title="login with Linked In"\n           class="nosvg"/>\n      <img src="{{bmg}}metabook/linkedin.svgz"\n           alt="Linked In" title="login with Linked In"\n           class="svg"/>\n    </button>\n    <button name="AUTHORITY" TABINDEX="17"\n            value=":AMAZON">\n      <img src="{{bmg}}metabook/amazon64x64.png"\n           alt="Amazon" title="login with your Amazon account"/>\n    </button>\n    <button name="AUTHORITY" TABINDEX="18"\n            value=":PAYPAL">\n      <img src="{{bmg}}metabook/paypalsquare64x64.png" class="nosvg"\n           alt="PayPal" title="login with PayPal"/>\n      <img src="{{bmg}}metabook/paypalsquare.svgz" class="svg"\n           alt="PayPal" title="login with PayPal"/>\n    </button>\n  </form>\n</div>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.settings='<form onsubmit="fdjt.UI.cancel(event); return false;">\n  <h1 class="cf">\n    <span class="button" id="METABOOKSAVESETTINGS">Save</span>\n    <span class="button" id="METABOOKAPPLYSETTINGS">Apply</span>\n    \x3c!--\n    <span class="exit button" id="METABOOKLOGOUT"\n          title="Logout of sBooks and erase any local data">Logout</span>\n    <span class="button" id="METABOOKRESETSETTINGS">Reset</span>\n    --\x3e\n    Settings\n    <span class="message metabooksettingschanged">\n      Your changes have been applied but not saved</span>\n    <span class="message" ID="METABOOKSETTINGSMESSAGE"></span></h1>\n  <table class="settings" id="METABOOKSETTINGSTABLE">\n    <tbody id="METABOOKSYNCSETTINGS">\n      <tr>\n        <th>Storage</th>\n        <td>\n          <button id="METABOOKREFRESHOFFLINE" class="refresh floatright"\n                  title="Reload glosses and layers for this book from the sBooks cloud.">\n            Glosses</button>\n          <span class="checkspan longspan ischecked">\n            <input TYPE="CHECKBOX" NAME="METABOOKCACHEGLOSSES"\n                   VALUE="true" CHECKED/>\n            Save copies of this book\'s glosses on this device</span></td>\n      </tr>\n      <tr>\n        <th>Sync</th>\n        <td>\n          <button id="METABOOKRESETSYNC" name="SYNC" VALUE="RESET"\n                  class="reset floatright"\n                  title="Reset synchronized location information.">\n            Reset</button>\n          <span class="checkspan longspan ischecked">\n            <input TYPE="CHECKBOX" NAME="METABOOKLOCSYNC" VALUE="true"/>\n            Sync your reading location with other devices</span><br/>\n          <span class="checkspan longspan disabled">\n            <input TYPE="CHECKBOX" NAME="METABOOKSPOILERGUARD" VALUE="false"\n                   DISABLED="DISABLED"/>\n            Enable <em>SpoilerGuard</em> for this title (NYI)</span>\n        </td>\n      </tr>\n    </tbody>\n    <tr class="padding"></tr>\n    <tbody id="METABOOKFONTSETTINGS">\n      <tr class="checkspan">\n        <th><input TYPE="CHECKBOX" NAME="METABOOKDYSLEXICAL" VALUE="yes"/></th>\n        <td>Use <a href="http://opendyslexic.org/" title="The Open Dyslexic font size">\n            Open Dyslexic</a> and other styling to maximize readability</td></tr>\n      <tr><th>Body text</th>\n        <td>\n          <button id="METABOOKREFRESHLAYOUT" class="refresh floatright"\n                  title="Update the page layout for this book.">\n            Layout</button>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYSIZE" VALUE="xlarge"/>x-large</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYSIZE" VALUE="large"/>large</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYSIZE" VALUE="normal"/>normal</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYSIZE" VALUE="small"/>small</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYSIZE" VALUE="tiny"/>tiny</span>\n          \x3c!--\n          <br/>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYFAMILY" VALUE="serif"/>serif</span\n>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYFAMILY" VALUE="sans"/>sans-serif</span>\n          --\x3e\n          <br/>\n          <span class="checkspan">\n            <input TYPE="CHECKBOX" NAME="METABOOKJUSTIFY" VALUE="true"/>\n            justify paragraphs</span>\n          \x3c!--\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="linespacing" VALUE="single"/>single</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="linespacing" VALUE="double"/>double</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="linespacing" VALUE="onefive"/>1.5</span>\n          --\x3e\n      </td></tr>\n      <tr><th>Contrast</th>\n        <td>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYCONTRAST" VALUE="high"/>high</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYCONTRAST" VALUE="medium"/>medium</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKBODYCONTRAST" VALUE="low"/>low</span>\n      </td></tr>\n      <tr><th>Interface</th>\n        <td colspan="2">\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKUISIZE" VALUE="large"/>large</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKUISIZE" VALUE="normal"/>normal</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKUISIZE" VALUE="small"/>small</span>\n      </td></tr>\n    </tbody>\n    <tr class="padding"></tr>\n    <tbody id="METABOOKINTERACTIONSETTINGS">\n      <tr class="metabooklayoutsettings">\n        <th>Layout</th>\n        <td colspan="2">\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKLAYOUT" VALUE="bypage"/>by pages</span>\n          <span class="checkspan">\n            <input TYPE="RADIO" NAME="METABOOKLAYOUT" VALUE="scrolling"/>just scroll</span>\n        </td>\n      </tr>\n      <tr><th>Animate</th>\n        <td colspan="2">\n          <span class="checkspan">\n            <input TYPE="CHECKBOX" NAME="METABOOKANIMATECONTENT" VALUE="true"/>content (page flips, etc)</span>\n          <span class="checkspan">\n            <input TYPE="CHECKBOX" NAME="METABOOKANIMATEHUD" VALUE="true"/>interface (HUD, etc)</span></td></tr>\n    </tbody>\n    <tr class="padding"></tr>\n    \x3c!--\n    <tbody id="METABOOKHELPSETTINGS" >\n      <tr class="checkspan" id="METABOOKHIDESPLASHSETTING">\n        <th><input TYPE="CHECKBOX" NAME="METABOOKHIDESPLASH" VALUE="true"\n                   id="METABOOKHIDESPLASHSETTING"\n                   CHECKED/></th>\n        <td colspan="2">\n          Hide the application splash page after startup</td></tr>\n      <tr class="checkspan">\n        <th><input TYPE="CHECKBOX" NAME="METABOOKKEYBOARDHELP" VALUE="true"\n                   id="METABOOKKEYBOARDHELPSETTING"\n                   CHECKED/></th>\n        <td colspan="2">\n          Show keyboard help for metaBook</td></tr>\n      <tr class="padding"></tr>\n    </tbody>\n    --\x3e\n    <tbody id="METABOOKHACKERSETTINGS">\n      <tr title="A name to display for this device when recording changes">\n        <th>Device name</th>\n        <td colspan="2">\n          <input TYPE="TEXT" NAME="METABOOKDEVICENAME" value=""\n                 PLACEHOLDER="a name for this device (browser)"\n                 onfocus="metaBook.UI.focus(event);"\n                 onblur="metaBook.UI.blur(event);"/></td>\n      </tr>\n      <tr class="padding"></tr>\n      <tr class="checkspan">\n        <th><input TYPE="CHECKBOX" NAME="METABOOKSHOWCONSOLE" VALUE="true"/></th>\n        <td colspan="2">Show the metaBook console</td></tr>\n    </tbody>\n    <tr class="padding"></tr>\n    <tbody class="buttons">\n      <tr class="buttons">\n        <th/>\n        <td colspan="2">\n        </td>\n      </tr>\n    </tbody>\n    <tbody class="bookinfo">\n      <tr><th>Info</th>\n        <td id="METABOOKINFO" class="metabookinfo" colspan="2"></tr>\n    </tbody>\n  </table>\n</form>\n<div>\n</div>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.pageleft='<img svg="{{bmg}}metabook/page_left.svgz"\n     src="{{bmg}}metabook/page_left100h.png"\n     id="METABOOKPREVPAGE" class="metabookpagebutton" alt="prev"\n     title="go to the previous page"/>\n<img svg="{{bmg}}metabook/skim_left.svgz"\n     src="{{bmg}}metabook/skim_left100x100.png"\n     id="METABOOKPREVSKIM" class="metabookskimbutton" alt="prev"\n     title="go to the previous result/gloss"/>\n<img svg="{{bmg}}metabook/skim_left_stop.svgz"\n     src="{{bmg}}metabook/skim_left_stop100x100.png"\n     id="METABOOKSTARTSKIM" class="metabookskimbutton"\n     alt="beginning"/>\n<img svg="{{bmg}}metabook/page_right.svgz"\n     src="{{bmg}}metabook/page_right100h.png"\n     id="METABOOKNEXTPAGE" class="metabookpagebutton" alt="next"\n     title="go to the next page"/>\n<img svg="{{bmg}}metabook/skim_right_stop.svgz"\n     src="{{bmg}}metabook/skim_right_stop100x100.png"\n     id="METABOOKENDSKIM" class="metabookskimbutton"\n     alt="end"/>\n<img svg="{{bmg}}metabook/skim_right.svgz"\n     src="{{bmg}}metabook/skim_right100x100.png"\n     id="METABOOKNEXTSKIM" class="metabookskimbutton" alt="next"\n     title="go to the next result/gloss"/>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.HTML.pageright='<img svg="{{bmg}}metabook/page_right.svgz"\n     src="{{bmg}}metabook/page_right100h.png"\n     id="METABOOKNEXTPAGE" class="metabookpagebutton" alt="next"\n     title="go to the next page"/>\n<img svg="{{bmg}}metabook/skim_right_stop.svgz"\n     src="{{bmg}}metabook/skim_right_stop100x100.png"\n     id="METABOOKENDSKIM" class="metabookskimbutton"\n     alt="end"/>\n<img svg="{{bmg}}metabook/skim_right.svgz"\n     src="{{bmg}}metabook/skim_right100x100.png"\n     id="METABOOKNEXTSKIM" class="metabookskimbutton" alt="next"\n     title="go to the next result/gloss"/>\n\n\x3c!--\n    /* Emacs local variables\n    ;;;  Local variables: ***\n    ;;;  compile-command: "cd ../..; make" ***\n    ;;;  indent-tabs-mode: nil ***\n    ;;;  End: ***\n    */\n  --\x3e\n';metaBook.version="v0.5-2468-g45706b9";metaBook.buildhost="moby.dot.beingmeta.com";metaBook.buildtime="Mon Feb 23 09:51:50 EST 2015";metaBook.buildid="af97124e-192f-477f-95fd-c88096c5631d";Knodule.version="v0.8-145-gf3ac2cb";
